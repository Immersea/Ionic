{"version":3,"names":["popoverChatParticipantsCss","PopoverChatParticipantsStyle0","PopoverChatParticipants","this","usersList","participantsList","addedParticipantsList","removedParticipantsList","userNotFound","modifiedParticipants","componentWillLoad","chatParticipants","Object","keys","chat","participants","id","participant","collectionId","publicProfile","UserService","getPublicProfileUserDetails","uid","push","Environment","isUdive","concat","DivingCentersService","divingCentersList","DivingSchoolsService","divingSchoolsList","ServiceCentersService","serviceCentersList","orderBy","filter","includes","userIds","users","ownersIds","userId","editable","userProfile","selectedServiceCenterId","selectedDivingCenterId","selectedDivingSchoolId","searchUsers","ev","searchFilter","target","value","toLowerCase","showList","getEmailValidator","validate","user","searchUserByEmail","updateView","resetShowList","addUser","findIndex","part","removeUser","splice","val","changeName","name","close","popoverController","dismiss","save","chatName","added","removed","render","h","Host","key","length","color","mode","placeholder","TranslationService","getTransl","onIonInput","undefined","translucent","tag","text","map","photoURL","slot","src","displayName","fill","onClick","inputmode","type","enterkeyhint","clearIcon","autocomplete","onIonClear","onIonCancel","onIonChange","onCancelEmit","disableSave","onSaveEmit"],"sources":["src/components/common/popovers/popover-chat-participants/popover-chat-participants.scss?tag=popover-chat-participants","src/components/common/popovers/popover-chat-participants/popover-chat-participants.tsx"],"sourcesContent":["popover-chat-participants {\n  /* Component styles go here */\n}\n","import {Component, h, Host, State, Element, Prop} from \"@stencil/core\";\nimport {UserService} from \"../../../../services/common/user\";\nimport {DivingCentersService} from \"../../../../services/udive/divingCenters\";\nimport {DivingSchoolsService} from \"../../../../services/udive/divingSchools\";\nimport {ServiceCentersService} from \"../../../../services/udive/serviceCenters\";\nimport {popoverController} from \"@ionic/core\";\nimport {TranslationService} from \"../../../../services/common/translations\";\nimport {Chat} from \"../../../../interfaces/common/chat/chat\";\nimport {Environment} from \"../../../../global/env\";\nimport {getEmailValidator} from \"../../../../validators/email-validator\";\nimport {orderBy} from \"lodash\";\n\n@Component({\n  tag: \"popover-chat-participants\",\n  styleUrl: \"popover-chat-participants.scss\",\n})\nexport class PopoverChatParticipants {\n  @Element() el: HTMLElement;\n  @Prop() chat: Chat;\n  @State() editable: boolean = true;\n  usersList: any[] = [];\n  participantsList: any[] = [];\n  addedParticipantsList: any[] = [];\n  removedParticipantsList: any[] = [];\n  @State() showList: any[] = [];\n  searchFilter: string;\n  userNotFound = false;\n  modifiedParticipants = false;\n  @State() updateView = false;\n  ownersIds: string[];\n\n  async componentWillLoad() {\n    const chatParticipants = Object.keys(this.chat.participants);\n\n    this.usersList = [];\n    for (let id of chatParticipants) {\n      const participant = this.chat.participants[id];\n      if (participant.collectionId == \"userProfiles\") {\n        const publicProfile = await UserService.getPublicProfileUserDetails(\n          participant.id\n        );\n        if (publicProfile && publicProfile.uid) {\n          this.usersList.push(publicProfile);\n        }\n      }\n    }\n    if (Environment.isUdive()) {\n      this.usersList = this.usersList.concat(\n        DivingCentersService.divingCentersList\n      );\n      this.usersList = this.usersList.concat(\n        DivingSchoolsService.divingSchoolsList\n      );\n      this.usersList = this.usersList.concat(\n        ServiceCentersService.serviceCentersList\n      );\n    }\n    this.participantsList = orderBy(\n      this.usersList.filter(\n        (participant) =>\n          chatParticipants.includes(participant.id) ||\n          chatParticipants.includes(participant.uid)\n      ),\n      \"displayName\"\n    );\n    const userIds = Object.keys(this.chat.users);\n    this.ownersIds = userIds.filter((userId) =>\n      this.chat.users[userId].includes(\"owner\")\n    );\n\n    if (Environment.isUdive()) {\n      this.editable =\n        this.ownersIds.includes(UserService.userProfile.uid) ||\n        this.ownersIds.includes(\n          ServiceCentersService.selectedServiceCenterId\n        ) ||\n        this.ownersIds.includes(DivingCentersService.selectedDivingCenterId) ||\n        this.ownersIds.includes(DivingSchoolsService.selectedDivingSchoolId);\n    }\n  }\n\n  async searchUsers(ev) {\n    this.searchFilter = ev.target.value.toLowerCase();\n    this.showList = [];\n    if (getEmailValidator().validate(this.searchFilter)) {\n      const user = await UserService.searchUserByEmail(this.searchFilter);\n      if (user && user.uid) {\n        this.showList.push(user);\n        this.userNotFound = false;\n      } else {\n        this.showList = [];\n        this.userNotFound = true;\n      }\n      this.updateView = !this.updateView;\n    }\n  }\n\n  resetShowList() {\n    this.userNotFound = false;\n    this.showList = [];\n  }\n\n  addUser(user) {\n    if (this.participantsList.findIndex((part) => user.uid === part.id) == -1) {\n      this.participantsList.push(user);\n      this.addedParticipantsList.push(user);\n    }\n    this.searchFilter = \"\";\n    this.resetShowList();\n    this.modifiedParticipants = true;\n  }\n\n  removeUser(user) {\n    this.participantsList.splice(\n      this.participantsList.findIndex(\n        (val) => val.uid === user.uid || val.id === user.id\n      ),\n      1\n    );\n    this.addedParticipantsList.splice(\n      this.addedParticipantsList.findIndex(\n        (val) => val.uid === user.uid || val.id === user.id\n      ),\n      1\n    );\n    this.removedParticipantsList.push(user);\n    this.searchFilter = \"\";\n    this.resetShowList();\n    this.modifiedParticipants = true;\n  }\n\n  changeName(ev) {\n    this.chat.name = ev.target.value;\n  }\n\n  close() {\n    popoverController.dismiss();\n  }\n\n  save() {\n    popoverController.dismiss({\n      chatName: this.chat.name,\n      added: this.addedParticipantsList,\n      removed: this.removedParticipantsList,\n    });\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-content>\n          <ion-list>\n            {this.editable && Object.keys(this.chat.participants).length > 2 ? (\n              <ion-item color=\"chat\">\n                <ion-input\n                  mode=\"ios\"\n                  placeholder={TranslationService.getTransl(\n                    \"chat-name\",\n                    \"Insert Chat Name\"\n                  )}\n                  value={this.chat.name}\n                  onIonInput={(ev) => this.changeName(ev)}\n                ></ion-input>\n              </ion-item>\n            ) : undefined}\n            {this.editable\n              ? [\n                  <ion-header translucent>\n                    <ion-toolbar>\n                      <ion-title>\n                        <my-transl\n                          tag=\"edit-chat-participants\"\n                          text=\"Edit Chat Participants\"\n                        />\n                      </ion-title>\n                    </ion-toolbar>\n                  </ion-header>,\n                ]\n              : undefined}\n            {this.participantsList.map((user) => (\n              <ion-item>\n                {user.photoURL ? (\n                  <ion-avatar slot=\"start\">\n                    <ion-img src={user.photoURL} />\n                  </ion-avatar>\n                ) : undefined}\n                <ion-label>{user.displayName}</ion-label>\n                {this.editable &&\n                !this.ownersIds.includes(user.uid) &&\n                !this.ownersIds.includes(user.id) ? (\n                  <ion-button\n                    slot=\"end\"\n                    icon-only\n                    fill=\"clear\"\n                    color=\"danger\"\n                    onClick={() => this.removeUser(user)}\n                  >\n                    <ion-icon name=\"person-remove-outline\"></ion-icon>\n                  </ion-button>\n                ) : undefined}\n              </ion-item>\n            ))}\n          </ion-list>\n          {this.editable\n            ? [\n                <ion-header translucent>\n                  <ion-toolbar>\n                    <ion-title>\n                      <my-transl\n                        tag=\"add-chat-participants\"\n                        text=\"Add Chat Participants\"\n                      />\n                    </ion-title>\n                  </ion-toolbar>\n                </ion-header>,\n                <ion-header translucent>\n                  <ion-toolbar>\n                    <ion-searchbar\n                      value={this.searchFilter}\n                      placeholder=\"Email\"\n                      inputmode=\"email\"\n                      type=\"email\"\n                      enterkeyhint=\"search\"\n                      clearIcon=\"close-circle\"\n                      autocomplete=\"email\"\n                      onIonInput={() => this.resetShowList()}\n                      onIonClear={() => this.resetShowList()}\n                      onIonCancel={() => this.resetShowList()}\n                      onIonChange={(ev) => this.searchUsers(ev)}\n                    ></ion-searchbar>\n                  </ion-toolbar>\n                </ion-header>,\n              ]\n            : undefined}\n          <ion-list>\n            {this.showList.map((user) => (\n              <ion-item>\n                {user.photoURL ? (\n                  <ion-avatar slot=\"start\">\n                    <ion-img src={user.photoURL} />\n                  </ion-avatar>\n                ) : undefined}\n                <ion-label>{user.displayName}</ion-label>\n                <ion-button\n                  slot=\"end\"\n                  icon-only\n                  fill=\"clear\"\n                  color=\"success\"\n                  onClick={() => this.addUser(user)}\n                >\n                  <ion-icon name=\"person-add-outline\"></ion-icon>\n                </ion-button>\n              </ion-item>\n            ))}\n            {this.userNotFound ? (\n              <ion-item>\n                <ion-label>\n                  <my-transl tag=\"user-not-found\" text=\"User Not Found\" />\n                </ion-label>\n              </ion-item>\n            ) : undefined}\n          </ion-list>\n        </ion-content>\n        <app-modal-footer\n          onCancelEmit={() => this.close()}\n          disableSave={!this.modifiedParticipants}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"mappings":"yfAAA,MAAMA,EAA6B,8BACnC,MAAAC,EAAeD,E,MCeFE,EAAuB,M,yBAIlCC,KAAAC,UAAmB,GACnBD,KAAAE,iBAA0B,GAC1BF,KAAAG,sBAA+B,GAC/BH,KAAAI,wBAAiC,GAGjCJ,KAAAK,aAAe,MACfL,KAAAM,qBAAuB,M,kCARM,K,cAKF,G,gBAIL,K,CAGtB,uBAAMC,GACJ,MAAMC,EAAmBC,OAAOC,KAAKV,KAAKW,KAAKC,cAE/CZ,KAAKC,UAAY,GACjB,IAAK,IAAIY,KAAML,EAAkB,CAC/B,MAAMM,EAAcd,KAAKW,KAAKC,aAAaC,GAC3C,GAAIC,EAAYC,cAAgB,eAAgB,CAC9C,MAAMC,QAAsBC,EAAYC,4BACtCJ,EAAYD,IAEd,GAAIG,GAAiBA,EAAcG,IAAK,CACtCnB,KAAKC,UAAUmB,KAAKJ,E,GAI1B,GAAIK,EAAYC,UAAW,CACzBtB,KAAKC,UAAYD,KAAKC,UAAUsB,OAC9BC,EAAqBC,mBAEvBzB,KAAKC,UAAYD,KAAKC,UAAUsB,OAC9BG,EAAqBC,mBAEvB3B,KAAKC,UAAYD,KAAKC,UAAUsB,OAC9BK,EAAsBC,mB,CAG1B7B,KAAKE,iBAAmB4B,kBACtB9B,KAAKC,UAAU8B,QACZjB,GACCN,EAAiBwB,SAASlB,EAAYD,KACtCL,EAAiBwB,SAASlB,EAAYK,OAE1C,eAEF,MAAMc,EAAUxB,OAAOC,KAAKV,KAAKW,KAAKuB,OACtClC,KAAKmC,UAAYF,EAAQF,QAAQK,GAC/BpC,KAAKW,KAAKuB,MAAME,GAAQJ,SAAS,WAGnC,GAAIX,EAAYC,UAAW,CACzBtB,KAAKqC,SACHrC,KAAKmC,UAAUH,SAASf,EAAYqB,YAAYnB,MAChDnB,KAAKmC,UAAUH,SACbJ,EAAsBW,0BAExBvC,KAAKmC,UAAUH,SAASR,EAAqBgB,yBAC7CxC,KAAKmC,UAAUH,SAASN,EAAqBe,uB,EAInD,iBAAMC,CAAYC,GAChB3C,KAAK4C,aAAeD,EAAGE,OAAOC,MAAMC,cACpC/C,KAAKgD,SAAW,GAChB,GAAIC,IAAoBC,SAASlD,KAAK4C,cAAe,CACnD,MAAMO,QAAalC,EAAYmC,kBAAkBpD,KAAK4C,cACtD,GAAIO,GAAQA,EAAKhC,IAAK,CACpBnB,KAAKgD,SAAS5B,KAAK+B,GACnBnD,KAAKK,aAAe,K,KACf,CACLL,KAAKgD,SAAW,GAChBhD,KAAKK,aAAe,I,CAEtBL,KAAKqD,YAAcrD,KAAKqD,U,EAI5B,aAAAC,GACEtD,KAAKK,aAAe,MACpBL,KAAKgD,SAAW,E,CAGlB,OAAAO,CAAQJ,GACN,GAAInD,KAAKE,iBAAiBsD,WAAWC,GAASN,EAAKhC,MAAQsC,EAAK5C,OAAQ,EAAG,CACzEb,KAAKE,iBAAiBkB,KAAK+B,GAC3BnD,KAAKG,sBAAsBiB,KAAK+B,E,CAElCnD,KAAK4C,aAAe,GACpB5C,KAAKsD,gBACLtD,KAAKM,qBAAuB,I,CAG9B,UAAAoD,CAAWP,GACTnD,KAAKE,iBAAiByD,OACpB3D,KAAKE,iBAAiBsD,WACnBI,GAAQA,EAAIzC,MAAQgC,EAAKhC,KAAOyC,EAAI/C,KAAOsC,EAAKtC,KAEnD,GAEFb,KAAKG,sBAAsBwD,OACzB3D,KAAKG,sBAAsBqD,WACxBI,GAAQA,EAAIzC,MAAQgC,EAAKhC,KAAOyC,EAAI/C,KAAOsC,EAAKtC,KAEnD,GAEFb,KAAKI,wBAAwBgB,KAAK+B,GAClCnD,KAAK4C,aAAe,GACpB5C,KAAKsD,gBACLtD,KAAKM,qBAAuB,I,CAG9B,UAAAuD,CAAWlB,GACT3C,KAAKW,KAAKmD,KAAOnB,EAAGE,OAAOC,K,CAG7B,KAAAiB,GACEC,EAAkBC,S,CAGpB,IAAAC,GACEF,EAAkBC,QAAQ,CACxBE,SAAUnE,KAAKW,KAAKmD,KACpBM,MAAOpE,KAAKG,sBACZkE,QAASrE,KAAKI,yB,CAIlB,MAAAkE,GACE,OACEC,EAACC,EAAI,CAAAC,IAAA,4CACHF,EAAA,eAAAE,IAAA,4CACEF,EAAA,YAAAE,IAAA,4CACGzE,KAAKqC,UAAY5B,OAAOC,KAAKV,KAAKW,KAAKC,cAAc8D,OAAS,EAC7DH,EAAA,YAAUI,MAAM,QACdJ,EAAA,aACEK,KAAK,MACLC,YAAaC,EAAmBC,UAC9B,YACA,oBAEFjC,MAAO9C,KAAKW,KAAKmD,KACjBkB,WAAarC,GAAO3C,KAAK6D,WAAWlB,MAGtCsC,UACHjF,KAAKqC,SACF,CACEkC,EAAA,cAAYW,YAAW,MACrBX,EAAA,mBACEA,EAAA,iBACEA,EAAA,aACEY,IAAI,yBACJC,KAAK,+BAMfH,UACHjF,KAAKE,iBAAiBmF,KAAKlC,GAC1BoB,EAAA,gBACGpB,EAAKmC,SACJf,EAAA,cAAYgB,KAAK,SACfhB,EAAA,WAASiB,IAAKrC,EAAKmC,YAEnBL,UACJV,EAAA,iBAAYpB,EAAKsC,aAChBzF,KAAKqC,WACLrC,KAAKmC,UAAUH,SAASmB,EAAKhC,OAC7BnB,KAAKmC,UAAUH,SAASmB,EAAKtC,IAC5B0D,EAAA,cACEgB,KAAK,MAAK,iBAEVG,KAAK,QACLf,MAAM,SACNgB,QAAS,IAAM3F,KAAK0D,WAAWP,IAE/BoB,EAAA,YAAUT,KAAK,2BAEfmB,cAITjF,KAAKqC,SACF,CACEkC,EAAA,cAAYW,YAAW,MACrBX,EAAA,mBACEA,EAAA,iBACEA,EAAA,aACEY,IAAI,wBACJC,KAAK,6BAKbb,EAAA,cAAYW,YAAW,MACrBX,EAAA,mBACEA,EAAA,iBACEzB,MAAO9C,KAAK4C,aACZiC,YAAY,QACZe,UAAU,QACVC,KAAK,QACLC,aAAa,SACbC,UAAU,eACVC,aAAa,QACbhB,WAAY,IAAMhF,KAAKsD,gBACvB2C,WAAY,IAAMjG,KAAKsD,gBACvB4C,YAAa,IAAMlG,KAAKsD,gBACxB6C,YAAcxD,GAAO3C,KAAK0C,YAAYC,QAK9CsC,UACJV,EAAA,YAAAE,IAAA,4CACGzE,KAAKgD,SAASqC,KAAKlC,GAClBoB,EAAA,gBACGpB,EAAKmC,SACJf,EAAA,cAAYgB,KAAK,SACfhB,EAAA,WAASiB,IAAKrC,EAAKmC,YAEnBL,UACJV,EAAA,iBAAYpB,EAAKsC,aACjBlB,EAAA,cACEgB,KAAK,MAAK,iBAEVG,KAAK,QACLf,MAAM,UACNgB,QAAS,IAAM3F,KAAKuD,QAAQJ,IAE5BoB,EAAA,YAAUT,KAAK,2BAIpB9D,KAAKK,aACJkE,EAAA,gBACEA,EAAA,iBACEA,EAAA,aAAWY,IAAI,iBAAiBC,KAAK,qBAGvCH,YAGRV,EAAA,oBAAAE,IAAA,2CACE2B,aAAc,IAAMpG,KAAK+D,QACzBsC,aAAcrG,KAAKM,qBACnBgG,WAAY,IAAMtG,KAAKkE,S","ignoreList":[]}