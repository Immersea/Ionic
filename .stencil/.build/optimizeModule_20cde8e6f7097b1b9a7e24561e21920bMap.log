{"version":3,"names":["modalDiveTripUpdateCss","ModalDiveTripUpdateStyle0","ModalDiveTripUpdate","undefined","tag","componentWillLoad","this","loadDiveTrip","placeholder","TranslationService","getTransl","diveTripId","diveTrip","DiveTripsService","getDiveTrip","DiveTrip","organiser","collectionId","id","organiserId","users","UserService","userRoles","uid","componentDidLoad","slider","Swiper","speed","spaceBetween","allowTouchMove","autoHeight","on","slideChange","updateAutoHeight","validateTrip","addDiveTrip","tripIndex","diveIndex","removeDiveTrip","index","removeTripDive","updateView","setTitle","ev","displayName","target","value","tripDives","orderBy","validTrip","isString","length","save","updateDiveTrip","modalController","dismiss","cancel","render","h","Host","key","color","inputmode","onIonInput","swiper","titles","class","map","trip","i","tripDive","editable","onAddDiveEmit","onRemoveDiveTripEmit","onRemoveTripDiveEmit","toNumber","detail","onUpdateDiveEmit","onClick","name","style","fontSize","item","show","Object","keys","tripDiveIndex","disableSave","onCancelEmit","onSaveEmit"],"sources":["src/components/udive/modals/dive-trip/modal-dive-trip-update/modal-dive-trip-update.scss?tag=modal-dive-trip-update","src/components/udive/modals/dive-trip/modal-dive-trip-update/modal-dive-trip-update.tsx"],"sourcesContent":["modal-dive-trip-update {\n  ion-list {\n    width: 100%;\n  }\n  ion-segment-button {\n    --color-checked: var(--ion-color-divetrip-contrast);\n  }\n}\n","import {Component, h, Host, Prop, State, Element} from \"@stencil/core\";\nimport {DiveTrip} from \"../../../../../interfaces/udive/dive-trip/diveTrip\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {modalController} from \"@ionic/core\";\nimport {isString, orderBy, toNumber} from \"lodash\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {DiveTripsService} from \"../../../../../services/udive/diveTrips\";\nimport Swiper from \"swiper\";\n\n@Component({\n  tag: \"modal-dive-trip-update\",\n  styleUrl: \"modal-dive-trip-update.scss\",\n})\nexport class ModalDiveTripUpdate {\n  @Element() el: HTMLElement;\n  @Prop() diveTripId: string = undefined;\n  @Prop() collectionId: string;\n  @Prop() organiserId: string;\n  @State() diveTrip: DiveTrip;\n  @State() updateView = true;\n  @State() validTrip = false;\n  placeholder: string;\n  @State() titles = [{tag: \"dives\"}, {tag: \"team\"}, {tag: \"bookings\"}];\n  @State() slider: Swiper;\n\n  async componentWillLoad() {\n    await this.loadDiveTrip();\n    this.placeholder = TranslationService.getTransl(\n      \"insert-title\",\n      \"Insert title\"\n    );\n  }\n\n  async loadDiveTrip() {\n    if (this.diveTripId) {\n      this.diveTrip = await DiveTripsService.getDiveTrip(this.diveTripId);\n    } else {\n      this.diveTrip = new DiveTrip();\n      this.diveTrip.organiser = {\n        collectionId: this.collectionId,\n        id: this.organiserId,\n      };\n      this.diveTrip.users = {\n        [UserService.userRoles.uid]: [\"owner\"],\n      };\n    }\n  }\n\n  async componentDidLoad() {\n    this.slider = new Swiper(\".slider-dive-trip\", {\n      speed: 400,\n      spaceBetween: 100,\n      allowTouchMove: false,\n      autoHeight: true,\n      on: {\n        slideChange: () => {\n          this.slider ? this.slider.updateAutoHeight() : null;\n        },\n      },\n    });\n    this.validateTrip();\n  }\n\n  async addDiveTrip(tripIndex?: number, diveIndex?: number) {\n    this.diveTrip = await DiveTripsService.addDiveTrip(\n      this.diveTrip,\n      tripIndex,\n      diveIndex\n    );\n    this.validateTrip();\n  }\n\n  removeDiveTrip(index) {\n    this.diveTrip = DiveTripsService.removeDiveTrip(this.diveTrip, index);\n    this.validateTrip();\n  }\n\n  removeTripDive(tripIndex, diveIndex) {\n    this.diveTrip = DiveTripsService.removeTripDive(\n      this.diveTrip,\n      tripIndex,\n      diveIndex\n    );\n    this.updateView = !this.updateView;\n  }\n\n  setTitle(ev) {\n    this.diveTrip.displayName = ev.target.value;\n    this.validateTrip();\n  }\n\n  validateTrip() {\n    this.diveTrip.tripDives = orderBy(\n      this.diveTrip.tripDives,\n      \"divePlan.dives[0].date\"\n    );\n    this.validTrip =\n      isString(this.diveTrip.displayName) &&\n      this.diveTrip.displayName.length > 3 &&\n      this.diveTrip.tripDives.length > 0;\n    this.updateView = !this.updateView;\n  }\n\n  async save() {\n    await DiveTripsService.updateDiveTrip(this.diveTripId, this.diveTrip);\n    return modalController.dismiss(false);\n  }\n\n  async cancel() {\n    return modalController.dismiss(true);\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-header>\n          <ion-toolbar color=\"divetrip\">\n            <ion-title>\n              <ion-input\n                placeholder={this.placeholder + \"...\"}\n                inputmode=\"text\"\n                onIonInput={(ev) => this.setTitle(ev)}\n                value={this.diveTrip.displayName}\n              ></ion-input>\n            </ion-title>\n          </ion-toolbar>\n        </ion-header>\n        <app-header-segment-toolbar\n          color=\"divetrip\"\n          swiper={this.slider}\n          titles={this.titles}\n        ></app-header-segment-toolbar>\n        <ion-content class=\"slides\">\n          <swiper-container class=\"slider-dive-trip swiper\">\n            <swiper-wrapper class=\"swiper-wrapper\">\n              <swiper-slide class=\"swiper-slide\">\n                <ion-grid>\n                  <ion-row class=\"ion-text-start\">\n                    {this.diveTrip.tripDives.map((trip, i) => (\n                      <ion-col size-sm=\"12\" size-md=\"6\" size-lg=\"4\">\n                        <app-dive-trip-card\n                          tripDive={trip}\n                          editable={true}\n                          updateView={this.updateView}\n                          onAddDiveEmit={() => this.addDiveTrip(i)}\n                          onRemoveDiveTripEmit={() => this.removeDiveTrip(i)}\n                          onRemoveTripDiveEmit={(ev) =>\n                            this.removeTripDive(i, toNumber(ev.detail))\n                          }\n                          onUpdateDiveEmit={(ev) =>\n                            this.addDiveTrip(i, toNumber(ev.detail))\n                          }\n                        />\n                      </ion-col>\n                    ))}\n                    <ion-col size-sm=\"12\" size-md=\"6\" size-lg=\"4\">\n                      <ion-card onClick={() => this.addDiveTrip()}>\n                        <ion-card-content class=\"ion-text-center\">\n                          <ion-icon\n                            name=\"add-circle-outline\"\n                            style={{fontSize: \"130px\"}}\n                          ></ion-icon>\n                        </ion-card-content>\n                      </ion-card>\n                    </ion-col>\n                  </ion-row>\n                </ion-grid>\n              </swiper-slide>\n              <swiper-slide class=\"swiper-slide\">\n                <app-users-list\n                  item={this.diveTrip}\n                  editable\n                  show={[\"owner\", \"divemaster\", \"instructor\"]}\n                />\n              </swiper-slide>\n\n              <swiper-slide class=\"swiper-slide\">\n                <ion-grid>\n                  <ion-row>\n                    {Object.keys(this.diveTrip.tripDives).map((i) => (\n                      <ion-col size-sm=\"12\" size-md=\"12\" size-lg=\"12\">\n                        <app-dive-trip-bookings\n                          diveTrip={this.diveTrip}\n                          diveTripId={this.diveTripId}\n                          tripDiveIndex={toNumber(i)}\n                          editable={true}\n                        />\n                      </ion-col>\n                    ))}\n                  </ion-row>\n                </ion-grid>\n              </swiper-slide>\n            </swiper-wrapper>\n          </swiper-container>\n        </ion-content>\n        <app-modal-footer\n          disableSave={!this.validTrip}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}