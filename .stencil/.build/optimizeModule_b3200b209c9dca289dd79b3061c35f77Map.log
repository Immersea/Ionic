{"version":3,"names":["appUsersListCss","AppUsersListStyle0","AppUsersList","this","isOwner","componentWillLoad","groups","owner","show","includes","tag","text","editor","instructor","divemaster","userProfile","UserService","isArray","item","users","uid","setUsers","userId","Object","keys","push","getMapDataUserDetails","orderBy","addUser","role","popover","popoverController","create","component","translucent","onDidDismiss","then","ev","data","user","present","removeUser","index","findIndex","splice","length","render","h","key","map","group","editable","lines","isLabel","userRoles","isSuperAdmin","color","fill","slot","onClick","name","undefined","disabled","photoURL","src","displayName"],"sources":["src/components/common/app/common/app-users-list/app-users-list.scss?tag=app-users-list","src/components/common/app/common/app-users-list/app-users-list.tsx"],"sourcesContent":["app-users-list {\n  width: 100%;\n}\n","import {Component, h, Prop, State} from \"@stencil/core\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {UserProfile} from \"../../../../../interfaces/common/user/user-profile\";\nimport {popoverController} from \"@ionic/core\";\nimport {isArray, orderBy} from \"lodash\";\n\n@Component({\n  tag: \"app-users-list\",\n  styleUrl: \"app-users-list.scss\",\n})\nexport class AppUsersList {\n  @Prop() item: any;\n  @Prop() editable: boolean = false;\n  @Prop() show: string[];\n  userProfile: UserProfile;\n  @State() owner: any[] = [];\n  @State() editor: any[] = [];\n  @State() instructor: any[] = [];\n  @State() divemaster: any[] = [];\n  isOwner = false;\n  groups: {\n    owner: {show: boolean; tag: string; text: string};\n    editor: {show: boolean; tag: string; text: string};\n    instructor: {show: boolean; tag: string; text: string};\n    divemaster: {show: boolean; tag: string; text: string};\n  };\n\n  async componentWillLoad() {\n    this.groups = {\n      owner: {\n        show: this.show.includes(\"owner\"),\n        tag: \"admin\",\n        text: \"Administrator\",\n      },\n      editor: {\n        show: this.show.includes(\"editor\"),\n        tag: \"editor\",\n        text: \"Editor\",\n      },\n      instructor: {\n        show: this.show.includes(\"instructor\"),\n        tag: \"instructor\",\n        text: \"Instructor\",\n      },\n      divemaster: {\n        show: this.show.includes(\"divemaster\"),\n        tag: \"divemaster\",\n        text: \"Divemaster\",\n      },\n    };\n    this.userProfile = UserService.userProfile;\n    this.isOwner =\n      isArray(this.item.users[this.userProfile.uid]) &&\n      this.item.users[this.userProfile.uid].includes(\"owner\");\n    await this.setUsers();\n  }\n\n  async setUsers() {\n    this.owner = [];\n    this.editor = [];\n    this.instructor = [];\n    for (let userId of Object.keys(this.item.users)) {\n      if (this.item.users[userId].includes(\"owner\")) {\n        this.owner.push(await UserService.getMapDataUserDetails(userId));\n      }\n      if (this.item.users[userId].includes(\"editor\")) {\n        this.editor.push(await UserService.getMapDataUserDetails(userId));\n      }\n      if (this.item.users[userId].includes(\"instructor\")) {\n        this.instructor.push(await UserService.getMapDataUserDetails(userId));\n      }\n      if (this.item.users[userId].includes(\"divemaster\")) {\n        this.divemaster.push(await UserService.getMapDataUserDetails(userId));\n      }\n    }\n    this.owner = orderBy(this.owner, \"displayName\");\n    this.editor = orderBy(this.editor, \"displayName\");\n    this.instructor = orderBy(this.instructor, \"displayName\");\n    this.divemaster = orderBy(this.divemaster, \"displayName\");\n  }\n\n  async addUser(role) {\n    const popover = await popoverController.create({\n      component: \"popover-search-user\",\n      translucent: true,\n    });\n    popover.onDidDismiss().then((ev) => {\n      const userId = ev.data;\n      let user = this.item.users[userId];\n      if (user && !this.item.users[userId].includes(role)) {\n        this.item.users[userId].push(role);\n      } else if (!user) {\n        this.item.users[userId] = [role];\n      }\n      this.setUsers();\n    });\n    popover.present();\n  }\n\n  removeUser(user, role) {\n    const index = this.item.users[user.uid].findIndex((item) => item == role);\n    this.item.users[user.uid].splice(index, 1);\n    if (this.item.users[user.uid].length == 0) {\n      delete this.item.users[user.uid];\n    }\n    this.setUsers();\n  }\n\n  render() {\n    return [\n      <ion-list>\n        {Object.keys(this.groups).map((group) => [\n          this.groups[group].show && (this[group].length > 0 || this.editable)\n            ? [\n                <ion-item lines=\"full\">\n                  <my-transl\n                    tag={this.groups[group].tag}\n                    text={this.groups[group].text}\n                    isLabel\n                  ></my-transl>\n                  {this.editable &&\n                  (this.isOwner || UserService.userRoles.isSuperAdmin()) ? (\n                    <ion-button\n                      color=\"primary\"\n                      fill=\"clear\"\n                      slot=\"end\"\n                      onClick={() => this.addUser(group)}\n                    >\n                      <ion-icon name=\"add-circle\"></ion-icon>\n                    </ion-button>\n                  ) : undefined}\n                </ion-item>,\n              ]\n            : undefined,\n          this[group].length > 0\n            ? [\n                this[group].map((user) => (\n                  <ion-item>\n                    {this.editable &&\n                    (this.isOwner || UserService.userRoles.isSuperAdmin()) ? (\n                      <ion-button\n                        icon-only\n                        slot=\"end\"\n                        color=\"danger\"\n                        fill=\"clear\"\n                        disabled={UserService.userRoles.uid == user.uid}\n                        onClick={() => this.removeUser(user, group)}\n                      >\n                        <ion-icon name=\"trash-bin-outline\"></ion-icon>\n                      </ion-button>\n                    ) : undefined}\n                    {user.photoURL ? (\n                      <ion-avatar slot=\"start\">\n                        <ion-img src={user.photoURL} />\n                      </ion-avatar>\n                    ) : undefined}\n                    <ion-label>{user.displayName}</ion-label>\n                  </ion-item>\n                )),\n              ]\n            : undefined,\n        ])}\n      </ion-list>,\n    ];\n  }\n}\n"],"mappings":"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","ignoreList":[]}