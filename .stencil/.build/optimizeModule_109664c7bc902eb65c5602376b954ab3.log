import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as n}from"./p-5d4a8e1f.js";import{l as s}from"./p-1af05547.js";import{S as o}from"./p-a75993af.js";import{U as m,n as l,am as d,ap as p,aw as r,R as b,k as f,S as h,T as c}from"./p-30358c9d.js";import{E as u}from"./p-a9f4af61.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-2578d979.js";import"./p-7ee16e8d.js";const v="modal-shape-update ion-list{width:100%}";const x=v;const y=class{constructor(t){e(this,t);this.validShape=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"drawing",text:"Drawing",disabled:false}];this.shapeId=undefined;this.duplicateShape=undefined;this.shape=undefined;this.updateView=true;this.scrollTop=0;this.shapeTypes=undefined;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=m.userProfile$.subscribe((e=>{this.userProfile=new l(e)}));await this.loadShape()}async loadShape(){this.shapeTypes=await d.getShapeTypes();if(this.shapeId){const e=await d.getShape(this.shapeId);this.shape=e}else{this.shape=new p(this.duplicateShape?this.duplicateShape.shape:null);if(this.duplicateShape){this.shape.shapeName="NEW - "+this.duplicateShape.shape.shapeName}this.shape.users={[m.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new o(".slider-edit-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,breakpoints:{768:{slidesPerView:1},992:{slidesPerView:2}}});if(this.shape.shapeName)this.validateShape();this.updateSlider()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){const t=e.detail.name;const a=e.detail.value;this.shape[t]=a;if((t=="A"||t=="B"||t=="H"||t=="L")&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0){this.shape.volume=this.shape.getVolume();this.shape.radius=this.shape.getInternalRadius()}this.validateShape()}validateShape(){this.validShape=s.exports.isString(this.shape.shapeTypeId)&&s.exports.isString(this.shape.shapeName)&&s.exports.isNumber(this.shape.A)&&s.exports.isNumber(this.shape.B)&&s.exports.isNumber(this.shape.H)&&s.exports.isNumber(this.shape.L)&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0;this.updateSlider()}async selectType(e){this.shape.shapeTypeId=e.detail.value;await d.setDwgForShape(this.shape);this.validateShape()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editDrawing(){if(!this.shape.dwg){this.shape.dwg=new r}this.shape.dwg.id=this.shapeId;this.shape.dwg.name=this.shape.shapeName;const e=await b.openPopover("popover-media-loading",{media:this.shape.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const t={[e.data.media.id]:e.data};const a=e.data.media;const i=await b.openPopover("popover-media-uploader",{files:t,itemId:this.shapeId,collectionId:f});i.onDidDismiss().then((e=>{if(e&&e.data){const t=e.data;this.shape.dwg=a;Object.keys(t).forEach((e=>{this.shape.dwg.url=t[e]}));this.save(false);this.updateSlider()}}))}}))}async deleteShape(){try{await d.deleteShape(this.shapeId);n.dismiss()}catch(e){if(e)h.presentAlertError(e)}}async save(e=true){const t=await d.updateShape(this.shapeId,this.shape,this.userProfile.uid);if(!this.shapeId){this.shapeId=t.id}e?n.dismiss():undefined}async cancel(){return n.dismiss()}render(){return t(a,{key:"fba9f1e4be210cc0e8327bec4abab6b45eeb6d60"},t("app-header-segment-toolbar",{key:"eed07095cc53cf1265c57e044c7a7bed714be94c",color:u.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"c51b983c404acf79c689164b2008e5114b1108dd",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},t("swiper-container",{key:"2efd06ead0d6cc84e36a4dd7408629c61b047c6c",class:"slider-edit-shape swiper"},t("swiper-wrapper",{key:"d9e7753df50a47dae4c1fcb9fc7f0dcb023f6b78",class:"swiper-wrapper"},t("swiper-slide",{key:"1e2b3a0ab4cf853632c48fe58d620ab2034b8e0e",class:"swiper-slide"},t("ion-list",{key:"14f4e5e2317f95061cab058016140e69d35ad1fd",class:"ion-no-padding"},this.shapeTypes?t("app-select-search",{color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.shape&&this.shape.shapeTypeId?this.shape.shapeTypeId:null,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"]}):undefined,t("app-form-item",{key:"c9ed761866afc94ac9b46f34cf20da6f028f0678",lines:"inset","label-tag":"name","label-text":"Name",value:this.shape.shapeName,name:"shapeName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"2d004d8db0a1218891f65284f02b742616bc6157",lines:"inset","label-tag":"shortName","label-text":"Short Name",value:this.shape.shapeShortName,name:"shapeShortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"dec2826aa35896bb6e983f2fd4a2810081299aeb","label-text":"H",value:this.shape.H,appendText:" (mm)",name:"H","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"1e6e292c440836178615cf6c0da627d351a2ec03","label-text":"H1",value:this.shape.H1,appendText:" (mm)",name:"H1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"22320e3c5fbd538a16df60a9347e7e68369c436b","label-text":"H2",value:this.shape.H2,appendText:" (mm)",name:"H2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"7d99d56a3a7190be73ecde31afcb7f4ea946abbb","label-text":"L",value:this.shape.L,appendText:" (mm)",name:"L","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"552252b31bbe8638993cc271fc9c864fd6f8275d","label-text":"L1",appendText:" (mm)",value:this.shape.L1,name:"L1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"d1046208f77579f65695992f249853578a8ba114","label-text":"La",appendText:" (mm)",value:this.shape.La,name:"La","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"0c19abed97f81e6c96c9409814b13371c6d0fcf3","label-text":"Lb",appendText:" (mm)",value:this.shape.Lb,name:"Lb","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"9142e313bb638123a46f2aa8368bafcef96ac107","label-text":"A",appendText:" (mm)",value:this.shape.A,name:"A","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"0575544a07905b412ab8923b3eaa7e2a8cda1c09","label-text":"A1",appendText:" (mm)",value:this.shape.A1,name:"A1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"b2b96e0f376bccc9c4fb005b8970297770b2c9d5","label-text":"B",appendText:" (mm)",value:this.shape.B,name:"B","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"48b0d49564b0ed3d9c3192db260c6a427a432150","label-text":"B1",appendText:" (mm)",value:this.shape.B1,name:"B1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"ce23d5a455c331667c13d0653b9912ef3b35875c","label-text":"ANG",appendText:" (°)",value:this.shape.ANG,name:"ANG","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"666f7d0577330b0787136e8b5c9d50ff66523d7b","label-text":"ANG1",appendText:" (°)",value:this.shape.ANG1,name:"ANG1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"dd418e70089537cabbb7d58c8256fe7ddb3c252b","label-text":"D",appendText:" (mm)",value:this.shape.D,name:"D","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"c1fcb40e66de647f7fffc204f3b435f33e99f8d6","label-text":"D1",appendText:" (mm)",value:this.shape.D1,name:"D1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"8ed7d74920ad9a237d195b83f30fd2d2964c07a3","label-text":"D2",appendText:" (mm)",value:this.shape.D2,name:"D2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"90788eecc7e0943465c07b993b7a58c393868d65","label-text":"D3",appendText:" (mm)",value:this.shape.D3,name:"D3","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"981105a1f27b40f0ca908341a6618488844a5451","label-text":"D4",appendText:" (mm)",value:this.shape.D4,name:"D4","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"91fdd5109a02b229a9b1f40a5852f42fb8dd31fb","label-text":"De",appendText:" (mm)",value:this.shape.De,name:"De","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"f1a489b5c26ef25e959e38c808cfed83ca47b500","label-text":"Di",appendText:" (mm)",value:this.shape.Di,name:"Di","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"17484ba1299bf2f9cf021737d9fdbdfa49adfe91","label-text":"N",appendText:" (mm)",value:this.shape.N,name:"N","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"3cae6645142ff4dbb43ac6dea65dbd230105b609","label-text":"Decimals",value:this.shape.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:0}}]}),t("app-form-item",{key:"9fb0fb33b43f3d20fb841a14df582dbf12480b3b","label-text":"Radius",appendText:(this.shape.shapeTypeId=="su-brick"?" MIN":"")+" (mm)",value:this.shape.radius,name:"radius","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),this.shape.shapeTypeId=="su-brick"?t("app-form-item",{"label-text":"Radius",appendText:" MAX (mm)",value:this.shape.radius_max,name:"radius_max","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:this.shape.radius}}]}):undefined,t("app-form-item",{key:"e742393df9c2f84545284e49ece24117ae40ed2b","label-text":"Volume",appendText:" (dm3)",value:this.shape.volume,name:"volume","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]})),this.shapeId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteShape()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"a4aa1c02cc333e61f43638d45870f10096291e75",class:"swiper-slide"},t("app-banner",{key:"3f9ad4c1c60edc6f51c3086827fbce2b0b412ed9",scrollTopValue:this.scrollTop,backgroundCoverFill:false,heightPx:500,link:this.shape.dwg?this.shape.dwg.url:null}),t("ion-footer",{key:"18612bac0f5aa76a8d4a95d64aca26b8c81932fe",class:"ion-no-border"},t("ion-toolbar",{key:"04ebed427421a49e9240afd3184da3dcc78be371"},t("ion-button",{key:"f98210a5f2be056df81652f1c3686611f451c568",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeId,onClick:()=>this.editDrawing()},t("ion-icon",{key:"292b4641e1704e76765af53fe3e9e31754eb4292",slot:"start",name:"create"}),t("ion-label",{key:"8c3c5772671739fe54e73eac7c95717f67ac33b4"},!this.shapeId?c.getTransl("media-loader-error","Please save the item to upload new media."):c.getTransl("edit_dwg","Edit Drawing"))))))))),t("app-modal-footer",{key:"3e351e36b2651637bd2afb8c6f39e42cd1e8ca9c",color:u.getAppColor(),disableSave:!this.validShape,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=x;export{y as modal_shape_update};