import{r as e,h as t,f as i,e as n}from"./p-cbe60c68.js";import{U as s,T as o,aa as a,w as l,z as d,c as h,aE as c}from"./p-736235c6.js";import{l as r}from"./p-1af05547.js";import{E as f}from"./p-46038295.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-c7ee7cfe.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const u="app-dive-trip-bookings{width:100%;height:100%}";const b=u;const m=class{constructor(t){e(this,t);this.availableSpots=[];this.diveTrip=undefined;this.diveTripId=undefined;this.tripDiveIndex=undefined;this.editable=false;this.isEditing=false;this.segment=0;this.tripDive=undefined;this.bookingsList=undefined;this.waitingRequest=false;this.updateView=false;this.userBooking=undefined}componentWillLoad(){this.tripDive=this.diveTrip.tripDives[this.tripDiveIndex];this.userSub=s.userProfile$.subscribe((e=>{this.userId=e&&e.uid?e.uid:null;this.updateBookingsList()}));this.userId=s.userProfile&&s.userProfile.uid?s.userProfile.uid:null;this.updateBookingsList();this.segmentTitles={notinterested:o.getTransl("not-interested","Not Interested"),interested:o.getTransl("interested","Interested"),attend:o.getTransl("attend","Attend")}}disconnectedCallback(){this.userSub.unsubscribe()}async updateBookingsList(){this.bookingsList=[];this.availableSpots=[];this.usersList=[];let e=r.exports.orderBy(this.tripDive.bookings,["team"]);let t=0;let i=e[0]&&e[0].team?e[0].team:0;e.map((e=>{if(e.team>i){t++;i=e.team}e.team=t}));this.tripDive.bookings=e;i=-1;console.log("this.tripDive",this.tripDive);for(let t of e){if(t.team>i){this.bookingsList.push(t.team);i=t.team}let e=Object.assign(Object.assign({},t),{user:await s.getMapDataUserDetails(t.uid)});this.bookingsList.push(e);if(this.userId&&t.uid===this.userId){this.userBooking=t}}let n=0;this.tripDive.bookings.map((e=>{if(e.confirmedOrganiser){n++}}));for(let e=0;e<this.tripDive.numberOfParticipants-n;e++){this.availableSpots.push(0)}this.updateView=!this.updateView}segmentChanged(e){if(e.detail.value){this.segment=r.exports.toNumber(e.detail.value)}}async addBooking(e){const t=e.detail.value=="true"?true:e.detail.value=="false"?false:null;let i=this.userBooking?this.userBooking:{role:"diver",team:0,uid:this.userId,confirmedUser:t,confirmedOrganiser:false};try{this.waitingRequest=true;const e=await a.sendBookingRequest(this.diveTripId,this.tripDiveIndex,i.role,i.team,i.uid,t,i.confirmedOrganiser);this.waitingRequest=false;this.tripDive.bookings=e;this.updateBookingsList()}catch(e){this.waitingRequest=false}}updateBooking(e,t){const i=this.bookingsList[e];const n=this.tripDive.bookings.find((e=>e.uid===i.uid));n.confirmedOrganiser=t.detail.value=="true"?true:t.detail.value=="false"?false:null}editBookings(){this.isEditing=true}saveBookings(){this.isEditing=false;this.updateBookingsList()}addTeam(){let e=0;this.bookingsList.map((t=>{if(r.exports.isNumber(t))e=t}));this.bookingsList.push(e+1);this.updateView=!this.updateView}reorderTeams(e){const t=e.detail.from;const i=e.detail.to;const n=this.bookingsList[t];const s=this.tripDive.bookings.find((e=>e.uid===n.uid));let o=false;let a=0;this.bookingsList.map(((e,t)=>{if(r.exports.isNumber(e))a=e;if(i<=t&&!o){s.team=a;o=true}}));this.bookingsList=e.detail.complete(this.bookingsList)}render(){return t("ion-card",{key:"085bf06507ebc9d26be3b9c93218c2e29b2e0b42"},t("ion-card-header",{key:"1ae2cb6ad8e540c1e8be100b3cf95621153bfa7a"},t("ion-card-title",{key:"44dd578a9979e28f0e33affa2162a8ec574b2da6"},t("ion-item",{key:"3ed6739eb7936e3078af6eef43a2110ae483641d",class:"ion-no-padding",lines:"none"},t("ion-label",{key:"b0fb6e563f779710ff1e14bbb31bd6e5cbf826b8"},l.format(this.tripDive.divePlan.dives[0].date,"PP")))),t("ion-card-subtitle",{key:"18fb6b692177589f1e9dc6da11df54d2489dfb0a"},t("ion-item",{key:"5df44397e094eb13a5a84922c61aa72cf897ab24",class:"ion-no-padding",lines:"none"},t("ion-label",{key:"66aa10d78f7098e5f07a2a986bffdfe1d6cb4923"},this.tripDive.divePlan.title+" -> "+o.getTransl("max-participants","Max xxx participants",{xxx:this.tripDive.numberOfParticipants})),this.editable&&this.tripDive.bookings&&this.tripDive.bookings.length>0?!this.isEditing?t("ion-button",{slot:"end",onClick:()=>this.editBookings()},t("my-transl",{tag:"edit",text:"Edit"})):[t("ion-button",{slot:"end",onClick:()=>this.addTeam()},t("my-transl",{tag:"add-team",text:"Add Team"})),t("ion-button",{slot:"end",onClick:()=>this.saveBookings()},t("my-transl",{tag:"save",text:"Save"}))]:undefined))),t("ion-card-content",{key:"b8a04bae5747275bbc3380e516b1cdb2a7e696fd"},!this.editable?t("ion-segment",{mode:"ios",color:f.getAppColor(),disabled:this.waitingRequest,onIonChange:e=>this.addBooking(e),value:this.userBooking?this.userBooking.confirmedUser.toString():""},t("ion-segment-button",{value:"",layout:"icon-start"},t("ion-icon",{name:"close-outline"}),t("ion-label",null,this.segmentTitles.notinterested)),t("ion-segment-button",{value:"false",layout:"icon-start"},t("ion-icon",{name:"help-outline"}),t("ion-label",null,this.segmentTitles.interested)),t("ion-segment-button",{value:"true",layout:"icon-start"},t("ion-icon",{name:"checkmark-outline"}),t("ion-label",null,this.segmentTitles.attend))):undefined,t("ion-list",{key:"8ab0d19995f67a093138ec87daf7fb886c9cce69"},t("ion-reorder-group",{key:"5cf7f5090d1d1006a785e88654036fcec1c1b009",disabled:!this.isEditing,onIonItemReorder:e=>this.reorderTeams(e)},this.waitingRequest&&!this.userBooking?t("app-skeletons",{skeleton:"diveTripBooking"}):undefined,this.bookingsList.map(((e,i)=>r.exports.isNumber(e)?t("ion-item-divider",null,t("ion-label",null,"Team ",e+1)):e.uid==this.userId&&this.waitingRequest?t("app-skeletons",{skeleton:"diveTripBooking"}):t("ion-item",null,!this.isEditing&&e.user.photoURL?t("ion-avatar",{slot:"start"},t("ion-img",{src:e.user.photoURL})):t("ion-reorder",{slot:"start"}),t("ion-label",null,e.user.displayName),e.confirmedUser?t("ion-icon",{slot:"end",color:"success",name:"checkmark-outline"}):t("ion-icon",{slot:"end",color:"warning",name:"help-outline"}),!this.isEditing?e.confirmedOrganiser?t("ion-icon",{slot:"end",color:"success",name:"checkmark-outline"}):t("ion-icon",{slot:"end",color:"warning",name:"help-outline"}):t("ion-segment",{style:{maxWidth:"40%",marginLeft:"15%"},slot:"end",mode:"ios",color:f.getAppColor(),onIonChange:e=>this.updateBooking(i,e),value:e.confirmedOrganiser.toString()},t("ion-segment-button",{value:""},t("ion-icon",{color:"danger",name:"close-outline"})),t("ion-segment-button",{value:"false"},t("ion-icon",{color:"warning",name:"help-outline"})),t("ion-segment-button",{value:"true"},t("ion-icon",{color:"success",name:"checkmark-outline"}))))))),this.availableSpots.map((()=>t("ion-item",null,t("ion-icon",{slot:"start",name:"person-add-outline"}),t("ion-label",null,t("my-transl",{tag:"available",text:"Available"}))))))))}get el(){return i(this)}};m.style=b;const p="app-dive-trip-card{width:100%;height:100%}";const g=p;const k=class{constructor(t){e(this,t);this.updateDiveEmit=n(this,"updateDiveEmit",7);this.addDiveEmit=n(this,"addDiveEmit",7);this.removeDiveTripEmit=n(this,"removeDiveTripEmit",7);this.removeTripDiveEmit=n(this,"removeTripDiveEmit",7);this.diveSites=[];this.divingCenters=[];this.tripDive=undefined;this.editable=false;this.updateView=false;this.segment=0;this.loogBookButton=undefined}update(){this.findDiveSites()}componentWillLoad(){this.findDiveSites();this.userSub=s.userProfile$.subscribe((e=>{this.userId=e&&e.uid?e.uid:null;this.activateLogbook()}));this.userId=s.userProfile&&s.userProfile.uid?s.userProfile.uid:null;this.activateLogbook()}activateLogbook(){this.loogBookButton=false;this.tripDive.bookings.map((e=>{if(e.uid==this.userId){this.loogBookButton=true}}))}findDiveSites(){this.diveSites=[];this.divingCenters=[];this.tripDive.divePlan.dives.forEach((e=>{this.diveSites.push(d.diveSitesList.find((t=>t.id===e.diveSiteId)));this.divingCenters.push(h.divingCentersList.find((t=>t.id===e.divingCenterId)))}))}updateDivePlan(e,t){e.stopPropagation();this.updateDiveEmit.emit(t)}removeDiveTrip(){this.removeDiveTripEmit.emit()}addDivePlan(){this.addDiveEmit.emit()}removeDivePlan(e,t){e.stopPropagation();this.segment=this.segment-1;this.removeTripDiveEmit.emit(t)}segmentChanged(e){if(e.detail.value){this.segment=r.exports.toNumber(e.detail.value)}}createDivePlan(e){if(e.configuration){c.createNewDivePlan(e)}else{c.createNewDivePlanWithConfiguration(e)}}render(){return t("ion-card",{key:"e01b781ff0bb2b7ec7d0634cb273f7000afbd431"},t("ion-card-header",{key:"046358e1aadc1e1ad9352380410d8983c0c407be"},t("ion-card-title",{key:"7923af5ef5b8b7329619f37724d788e392df3d71"},t("ion-item",{key:"79254aa01ce4ac4879a712d857cbdbe97d2416f7",class:"ion-no-padding",lines:"none"},t("ion-label",{key:"7dd3955f151acd30e4a1f72306889d4b62e07234"},l.format(this.tripDive.divePlan.dives[0].date,"PP")),this.editable?[t("ion-button",{"icon-only":true,slot:"end",color:"danger",fill:"clear",onClick:()=>this.removeDiveTrip()},t("ion-icon",{name:"trash-bin-outline"})),t("ion-button",{"icon-only":true,slot:"end",color:"divetrip",fill:"clear",onClick:()=>this.addDivePlan()},t("ion-icon",{name:"add-circle"}))]:undefined)),t("ion-card-subtitle",{key:"93041d8dfd6029a07fd23cd34f8ddb9acd3a792a"},this.tripDive.divePlan.title+" -> "+o.getTransl("max-participants","Max xxx participants",{xxx:this.tripDive.numberOfParticipants}))),t("ion-card-content",{key:"f7b7694e12619294ef6e1521de5d88804b00202d"},this.tripDive.divePlan.dives.length>1?t("ion-toolbar",null,t("ion-segment",{mode:"md",color:f.getAppColor(),onIonChange:e=>this.segmentChanged(e),value:this.segment.toString()},Object.keys(this.tripDive.divePlan.dives).map((e=>t("ion-segment-button",{value:e},t("ion-label",null,t("my-transl",{tag:"dive",text:"Dive"})," "+(r.exports.toNumber(e)+1)+": "+l.format(this.tripDive.divePlan.dives[e].date,"p"))))))):undefined,t("ion-card",{key:"378c857a1c515a07b9a838bcfa3b36752c185b90"},this.diveSites[this.segment]?t("app-item-cover",{item:this.diveSites[this.segment]}):undefined,t("ion-card-header",{key:"dde4eb328343162d766f19c844f6683dcd2de951"},t("ion-card-subtitle",{key:"cdbb9800d2d1f3d169037444bcf7abe0480b7ec0"},this.diveSites[this.segment]?t("h2",null,this.diveSites[this.segment].displayName):undefined,this.divingCenters[this.segment]?t("h3",null,this.divingCenters[this.segment].displayName):undefined),t("ion-card-title",{key:"bae76c383f7e3f9a57c36264c3d0f97692d6a21c"},t("ion-item",{key:"d5190a90c447ab616275c9d70b79e175c154b262",class:"ion-no-padding",lines:"none"},t("ion-label",{key:"6d2d2f98bedeb8b1b1e25855b0efdaeace9c67d8"},l.format(this.tripDive.divePlan.dives[this.segment].date,"p")),this.editable?[this.segment>0?t("ion-button",{"icon-only":true,slot:"end",color:"danger",fill:"clear",onClick:e=>this.removeDivePlan(e,this.segment)},t("ion-icon",{name:"trash-bin-outline"})):undefined,t("ion-button",{"icon-only":true,slot:"end",color:"primary",fill:"clear",onClick:e=>this.updateDivePlan(e,this.segment)},t("ion-icon",{name:"create"}))]:undefined))),this.tripDive.divePlan.configuration?t("ion-card-content",null,this.tripDive.divePlan.dives[this.segment].getProfilePointsDetails().map((e=>t("p",{class:"ion-text-start"},e)))):undefined)),!this.editable&&this.loogBookButton?t("ion-button",{expand:"full",color:"secondary",onClick:()=>this.createDivePlan(this.tripDive.divePlan)},this.tripDive.divePlan.dives.length==1?t("my-transl",{tag:"log-dive",text:"Log Dive"}):t("my-transl",{tag:"log-dives",text:"Log Dives"})):undefined)}get el(){return i(this)}static get watchers(){return{updateView:["update"]}}};k.style=g;export{m as app_dive_trip_bookings,k as app_dive_trip_card};