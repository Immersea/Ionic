import{r as t,g as e,a as i,_ as n,b as s,c as r,C as o,d as a,S as h,F as c,e as u,i as l,f,q as d,h as p,j as m,E as _,k as v,l as g,m as b,n as w,o as y,p as x,L as M,s as T,t as O,u as E,v as A,w as S,x as k,y as I,z as C,A as j,B as D,D as R,G as P,H as N,I as F,J as z,K as L,M as $,N as U,O as B,P as G,Q as H,R as V,T as W,U as q,V as Y,W as X,X as Z,Y as J,Z as K,$ as Q,a0 as tt,a1 as et,a2 as it,a3 as nt,a4 as st,a5 as rt,a6 as ot,a7 as at}from"./p-2578d979.js";import{E as ht,C as ct,L as ut,a as lt,r as ft}from"./p-a9f4af61.js";import{l as dt}from"./p-1af05547.js";import"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as pt,o as mt,n as _t,q as vt,a as gt,t as bt}from"./p-5d4a8e1f.js";import{U as wt}from"./p-7ee16e8d.js";import{c as yt,g as xt,a as Mt}from"./p-e9c4f463.js";import{i as Tt}from"./p-694b8ade.js";function Ot(t,e){var i={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0)i[n]=t[n];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++){if(e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s]))i[n[s]]=t[n[s]]}return i}typeof SuppressedError==="function"?SuppressedError:function(t,e,i){var n=new Error(i);return n.name="SuppressedError",n.error=t,n.suppressed=e,n};var Et="firebase";var At="10.13.1";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */t(Et,At,"app");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const St="firebasestorage.googleapis.com";const kt="storageBucket";const It=2*60*1e3;const Ct=10*60*1e3;const jt=1e3;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt extends c{constructor(t,e,i=0){super(Pt(t),`Firebase Storage: ${e} (${Pt(t)})`);this.status_=i;this.customData={serverResponse:null};this._baseMessage=this.message;Object.setPrototypeOf(this,Dt.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return Pt(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t;if(this.customData.serverResponse){this.message=`${this._baseMessage}\n${this.customData.serverResponse}`}else{this.message=this._baseMessage}}}var Rt;(function(t){t["UNKNOWN"]="unknown";t["OBJECT_NOT_FOUND"]="object-not-found";t["BUCKET_NOT_FOUND"]="bucket-not-found";t["PROJECT_NOT_FOUND"]="project-not-found";t["QUOTA_EXCEEDED"]="quota-exceeded";t["UNAUTHENTICATED"]="unauthenticated";t["UNAUTHORIZED"]="unauthorized";t["UNAUTHORIZED_APP"]="unauthorized-app";t["RETRY_LIMIT_EXCEEDED"]="retry-limit-exceeded";t["INVALID_CHECKSUM"]="invalid-checksum";t["CANCELED"]="canceled";t["INVALID_EVENT_NAME"]="invalid-event-name";t["INVALID_URL"]="invalid-url";t["INVALID_DEFAULT_BUCKET"]="invalid-default-bucket";t["NO_DEFAULT_BUCKET"]="no-default-bucket";t["CANNOT_SLICE_BLOB"]="cannot-slice-blob";t["SERVER_FILE_WRONG_SIZE"]="server-file-wrong-size";t["NO_DOWNLOAD_URL"]="no-download-url";t["INVALID_ARGUMENT"]="invalid-argument";t["INVALID_ARGUMENT_COUNT"]="invalid-argument-count";t["APP_DELETED"]="app-deleted";t["INVALID_ROOT_OPERATION"]="invalid-root-operation";t["INVALID_FORMAT"]="invalid-format";t["INTERNAL_ERROR"]="internal-error";t["UNSUPPORTED_ENVIRONMENT"]="unsupported-environment"})(Rt||(Rt={}));function Pt(t){return"storage/"+t}function Nt(){const t="An unknown error occurred, please check the error payload for "+"server response.";return new Dt(Rt.UNKNOWN,t)}function Ft(t){return new Dt(Rt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function zt(t){return new Dt(Rt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on "+"https://firebase.google.com/pricing/.")}function Lt(){const t="User is not authenticated, please authenticate using Firebase "+"Authentication and try again.";return new Dt(Rt.UNAUTHENTICATED,t)}function $t(){return new Dt(Rt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Ut(t){return new Dt(Rt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function Bt(){return new Dt(Rt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Gt(){return new Dt(Rt.CANCELED,"User canceled the upload/download.")}function Ht(t){return new Dt(Rt.INVALID_URL,"Invalid URL '"+t+"'.")}function Vt(t){return new Dt(Rt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Wt(){return new Dt(Rt.NO_DEFAULT_BUCKET,"No default bucket "+"found. Did you set the '"+kt+"' property when initializing the app?")}function qt(){return new Dt(Rt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Yt(){return new Dt(Rt.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Xt(){return new Dt(Rt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Zt(t){return new Dt(Rt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Jt(t){return new Dt(Rt.INVALID_ARGUMENT,t)}function Kt(){return new Dt(Rt.APP_DELETED,"The Firebase app was deleted.")}function Qt(t){return new Dt(Rt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root "+"reference using child, such as .child('file.png').")}function te(t,e){return new Dt(Rt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function ee(t){throw new Dt(Rt.INTERNAL_ERROR,"Internal error: "+t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(t,e){this.bucket=t;this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let i;try{i=ie.makeFromUrl(t,e)}catch(e){return new ie(t,"")}if(i.path===""){return i}else{throw Vt(t)}}static makeFromUrl(t,e){let i=null;const n="([A-Za-z0-9.\\-_]+)";function s(t){if(t.path.charAt(t.path.length-1)==="/"){t.path_=t.path_.slice(0,-1)}}const r="(/(.*))?$";const o=new RegExp("^gs://"+n+r,"i");const a={bucket:1,path:3};function h(t){t.path_=decodeURIComponent(t.path)}const c="v[A-Za-z0-9_]+";const u=e.replace(/[.]/g,"\\.");const l="(/([^?#]*).*)?$";const f=new RegExp(`^https?://${u}/${c}/b/${n}/o${l}`,"i");const d={bucket:1,path:3};const p=e===St?"(?:storage.googleapis.com|storage.cloud.google.com)":e;const m="([^?#]*)";const _=new RegExp(`^https?://${p}/${n}/${m}`,"i");const v={bucket:1,path:2};const g=[{regex:o,indices:a,postModify:s},{regex:f,indices:d,postModify:h},{regex:_,indices:v,postModify:h}];for(let e=0;e<g.length;e++){const n=g[e];const s=n.regex.exec(t);if(s){const t=s[n.indices.bucket];let e=s[n.indices.path];if(!e){e=""}i=new ie(t,e);n.postModify(i);break}}if(i==null){throw Ht(t)}return i}}class ne{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=false){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function se(t,e,i){let n=1;let s=null;let r=null;let o=false;let a=0;function h(){return a===2}let c=false;function u(...t){if(!c){c=true;e.apply(null,t)}}function l(e){s=setTimeout((()=>{s=null;t(d,h())}),e)}function f(){if(r){clearTimeout(r)}}function d(t,...e){if(c){f();return}if(t){f();u.call(null,t,...e);return}const i=h()||o;if(i){f();u.call(null,t,...e);return}if(n<64){n*=2}let s;if(a===1){a=2;s=0}else{s=(n+Math.random())*1e3}l(s)}let p=false;function m(t){if(p){return}p=true;f();if(c){return}if(s!==null){if(!t){a=2}clearTimeout(s);l(0)}else{if(!t){a=1}}}l(0);r=setTimeout((()=>{o=true;m(true)}),i);return m}function re(t){t(false)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oe(t){return t!==void 0}function ae(t){return typeof t==="function"}function he(t){return typeof t==="object"&&!Array.isArray(t)}function ce(t){return typeof t==="string"||t instanceof String}function ue(t){return le()&&t instanceof Blob}function le(){return typeof Blob!=="undefined"}function fe(t,e,i,n){if(n<e){throw Jt(`Invalid value for '${t}'. Expected ${e} or greater.`)}if(n>i){throw Jt(`Invalid value for '${t}'. Expected ${i} or less.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(t,e,i){let n=e;if(i==null){n=`https://${e}`}return`${i}://${n}/v0${t}`}function pe(t){const e=encodeURIComponent;let i="?";for(const n in t){if(t.hasOwnProperty(n)){const s=e(n)+"="+e(t[n]);i=i+s+"&"}}i=i.slice(0,-1);return i}var me;(function(t){t[t["NO_ERROR"]=0]="NO_ERROR";t[t["NETWORK_ERROR"]=1]="NETWORK_ERROR";t[t["ABORT"]=2]="ABORT"})(me||(me={}));
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _e(t,e){const i=t>=500&&t<600;const n=[408,429];const s=n.indexOf(t)!==-1;const r=e.indexOf(t)!==-1;return i||s||r}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(t,e,i,n,s,r,o,a,h,c,u,l=true){this.url_=t;this.method_=e;this.headers_=i;this.body_=n;this.successCodes_=s;this.additionalRetryCodes_=r;this.callback_=o;this.errorCallback_=a;this.timeout_=h;this.progressCallback_=c;this.connectionFactory_=u;this.retry=l;this.pendingConnection_=null;this.backoffId_=null;this.canceled_=false;this.appDelete_=false;this.promise_=new Promise(((t,e)=>{this.resolve_=t;this.reject_=e;this.start_()}))}start_(){const t=(t,e)=>{if(e){t(false,new ge(false,null,true));return}const i=this.connectionFactory_();this.pendingConnection_=i;const n=t=>{const e=t.loaded;const i=t.lengthComputable?t.total:-1;if(this.progressCallback_!==null){this.progressCallback_(e,i)}};if(this.progressCallback_!==null){i.addUploadProgressListener(n)}i.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{if(this.progressCallback_!==null){i.removeUploadProgressListener(n)}this.pendingConnection_=null;const e=i.getErrorCode()===me.NO_ERROR;const s=i.getStatus();if(!e||_e(s,this.additionalRetryCodes_)&&this.retry){const e=i.getErrorCode()===me.ABORT;t(false,new ge(false,null,e));return}const r=this.successCodes_.indexOf(s)!==-1;t(true,new ge(r,i))}))};const e=(t,e)=>{const i=this.resolve_;const n=this.reject_;const s=e.connection;if(e.wasSuccessCode){try{const t=this.callback_(s,s.getResponse());if(oe(t)){i(t)}else{i()}}catch(t){n(t)}}else{if(s!==null){const t=Nt();t.serverResponse=s.getErrorText();if(this.errorCallback_){n(this.errorCallback_(s,t))}else{n(t)}}else{if(e.canceled){const t=this.appDelete_?Kt():Gt();n(t)}else{const t=Bt();n(t)}}}};if(this.canceled_){e(false,new ge(false,null,true))}else{this.backoffId_=se(t,e,this.timeout_)}}getPromise(){return this.promise_}cancel(t){this.canceled_=true;this.appDelete_=t||false;if(this.backoffId_!==null){re(this.backoffId_)}if(this.pendingConnection_!==null){this.pendingConnection_.abort()}}}class ge{constructor(t,e,i){this.wasSuccessCode=t;this.connection=e;this.canceled=!!i}}function be(t,e){if(e!==null&&e.length>0){t["Authorization"]="Firebase "+e}}function we(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e!==null&&e!==void 0?e:"AppManager")}function ye(t,e){if(e){t["X-Firebase-GMPID"]=e}}function xe(t,e){if(e!==null){t["X-Firebase-AppCheck"]=e}}function Me(t,e,i,n,s,r,o=true){const a=pe(t.urlParams);const h=t.url+a;const c=Object.assign({},t.headers);ye(c,e);be(c,i);we(c,r);xe(c,n);return new ve(h,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Te(){if(typeof BlobBuilder!=="undefined"){return BlobBuilder}else if(typeof WebKitBlobBuilder!=="undefined"){return WebKitBlobBuilder}else{return undefined}}function Oe(...t){const e=Te();if(e!==undefined){const i=new e;for(let e=0;e<t.length;e++){i.append(t[e])}return i.getBlob()}else{if(le()){return new Blob(t)}else{throw new Dt(Rt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}}function Ee(t,e,i){if(t.webkitSlice){return t.webkitSlice(e,i)}else if(t.mozSlice){return t.mozSlice(e,i)}else if(t.slice){return t.slice(e,i)}return null}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ae(t){if(typeof atob==="undefined"){throw Zt("base-64")}return atob(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Se={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class ke{constructor(t,e){this.data=t;this.contentType=e||null}}function Ie(t,e){switch(t){case Se.RAW:return new ke(Ce(e));case Se.BASE64:case Se.BASE64URL:return new ke(De(t,e));case Se.DATA_URL:return new ke(Pe(e),Ne(e))}throw Nt()}function Ce(t){const e=[];for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);if(n<=127){e.push(n)}else{if(n<=2047){e.push(192|n>>6,128|n&63)}else{if((n&64512)===55296){const s=i<t.length-1&&(t.charCodeAt(i+1)&64512)===56320;if(!s){e.push(239,191,189)}else{const s=n;const r=t.charCodeAt(++i);n=65536|(s&1023)<<10|r&1023;e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|n&63)}}else{if((n&64512)===56320){e.push(239,191,189)}else{e.push(224|n>>12,128|n>>6&63,128|n&63)}}}}}return new Uint8Array(e)}function je(t){let e;try{e=decodeURIComponent(t)}catch(t){throw te(Se.DATA_URL,"Malformed data URL.")}return Ce(e)}function De(t,e){switch(t){case Se.BASE64:{const i=e.indexOf("-")!==-1;const n=e.indexOf("_")!==-1;if(i||n){const e=i?"-":"_";throw te(t,"Invalid character '"+e+"' found: is it base64url encoded?")}break}case Se.BASE64URL:{const i=e.indexOf("+")!==-1;const n=e.indexOf("/")!==-1;if(i||n){const e=i?"+":"/";throw te(t,"Invalid character '"+e+"' found: is it base64 encoded?")}e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=Ae(e)}catch(e){if(e.message.includes("polyfill")){throw e}throw te(t,"Invalid character found")}const n=new Uint8Array(i.length);for(let t=0;t<i.length;t++){n[t]=i.charCodeAt(t)}return n}class Re{constructor(t){this.base64=false;this.contentType=null;const e=t.match(/^data:([^,]+)?,/);if(e===null){throw te(Se.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>")}const i=e[1]||null;if(i!=null){this.base64=Fe(i,";base64");this.contentType=this.base64?i.substring(0,i.length-";base64".length):i}this.rest=t.substring(t.indexOf(",")+1)}}function Pe(t){const e=new Re(t);if(e.base64){return De(Se.BASE64,e.rest)}else{return je(e.rest)}}function Ne(t){const e=new Re(t);return e.contentType}function Fe(t,e){const i=t.length>=e.length;if(!i){return false}return t.substring(t.length-e.length)===e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(t,e){let i=0;let n="";if(ue(t)){this.data_=t;i=t.size;n=t.type}else if(t instanceof ArrayBuffer){if(e){this.data_=new Uint8Array(t)}else{this.data_=new Uint8Array(t.byteLength);this.data_.set(new Uint8Array(t))}i=this.data_.length}else if(t instanceof Uint8Array){if(e){this.data_=t}else{this.data_=new Uint8Array(t.length);this.data_.set(t)}i=t.length}this.size_=i;this.type_=n}size(){return this.size_}type(){return this.type_}slice(t,e){if(ue(this.data_)){const i=this.data_;const n=Ee(i,t,e);if(n===null){return null}return new ze(n)}else{const i=new Uint8Array(this.data_.buffer,t,e-t);return new ze(i,true)}}static getBlob(...t){if(le()){const e=t.map((t=>{if(t instanceof ze){return t.data_}else{return t}}));return new ze(Oe.apply(null,e))}else{const e=t.map((t=>{if(ce(t)){return Ie(Se.RAW,t).data}else{return t.data_}}));let i=0;e.forEach((t=>{i+=t.byteLength}));const n=new Uint8Array(i);let s=0;e.forEach((t=>{for(let e=0;e<t.length;e++){n[s++]=t[e]}}));return new ze(n,true)}}uploadData(){return this.data_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(t){let e;try{e=JSON.parse(t)}catch(t){return null}if(he(e)){return e}else{return null}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $e(t){if(t.length===0){return null}const e=t.lastIndexOf("/");if(e===-1){return""}const i=t.slice(0,e);return i}function Ue(t,e){const i=e.split("/").filter((t=>t.length>0)).join("/");if(t.length===0){return i}else{return t+"/"+i}}function Be(t){const e=t.lastIndexOf("/",t.length-2);if(e===-1){return t}else{return t.slice(e+1)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ge(t,e){return e}class He{constructor(t,e,i,n){this.server=t;this.local=e||t;this.writable=!!i;this.xform=n||Ge}}let Ve=null;function We(t){if(!ce(t)||t.length<2){return t}else{return Be(t)}}function qe(){if(Ve){return Ve}const t=[];t.push(new He("bucket"));t.push(new He("generation"));t.push(new He("metageneration"));t.push(new He("name","fullPath",true));function e(t,e){return We(e)}const i=new He("name");i.xform=e;t.push(i);function n(t,e){if(e!==undefined){return Number(e)}else{return e}}const s=new He("size");s.xform=n;t.push(s);t.push(new He("timeCreated"));t.push(new He("updated"));t.push(new He("md5Hash",null,true));t.push(new He("cacheControl",null,true));t.push(new He("contentDisposition",null,true));t.push(new He("contentEncoding",null,true));t.push(new He("contentLanguage",null,true));t.push(new He("contentType",null,true));t.push(new He("metadata","customMetadata",true));Ve=t;return Ve}function Ye(t,e){function i(){const i=t["bucket"];const n=t["fullPath"];const s=new ie(i,n);return e._makeStorageReference(s)}Object.defineProperty(t,"ref",{get:i})}function Xe(t,e,i){const n={};n["type"]="file";const s=i.length;for(let t=0;t<s;t++){const s=i[t];n[s.local]=s.xform(n,e[s.server])}Ye(n,t);return n}function Ze(t,e,i){const n=Le(e);if(n===null){return null}const s=n;return Xe(t,s,i)}function Je(t,e,i,n){const s=Le(e);if(s===null){return null}if(!ce(s["downloadTokens"])){return null}const r=s["downloadTokens"];if(r.length===0){return null}const o=encodeURIComponent;const a=r.split(",");const h=a.map((e=>{const s=t["bucket"];const r=t["fullPath"];const a="/b/"+o(s)+"/o/"+o(r);const h=de(a,i,n);const c=pe({alt:"media",token:e});return h+c}));return h[0]}function Ke(t,e){const i={};const n=e.length;for(let s=0;s<n;s++){const n=e[s];if(n.writable){i[n.server]=t[n.local]}}return JSON.stringify(i)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qe="prefixes";const ti="items";function ei(t,e,i){const n={prefixes:[],items:[],nextPageToken:i["nextPageToken"]};if(i[Qe]){for(const s of i[Qe]){const i=s.replace(/\/$/,"");const r=t._makeStorageReference(new ie(e,i));n.prefixes.push(r)}}if(i[ti]){for(const s of i[ti]){const i=t._makeStorageReference(new ie(e,s["name"]));n.items.push(i)}}return n}function ii(t,e,i){const n=Le(i);if(n===null){return null}const s=n;return ei(t,e,s)}class ni{constructor(t,e,i,n){this.url=t;this.method=e;this.handler=i;this.timeout=n;this.urlParams={};this.headers={};this.body=null;this.errorHandler=null;this.progressCallback=null;this.successCodes=[200];this.additionalRetryCodes=[]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(t){if(!t){throw Nt()}}function ri(t,e){function i(i,n){const s=Ze(t,n,e);si(s!==null);return s}return i}function oi(t,e){function i(i,n){const s=ii(t,e,n);si(s!==null);return s}return i}function ai(t,e){function i(i,n){const s=Ze(t,n,e);si(s!==null);return Je(s,n,t.host,t._protocol)}return i}function hi(t){function e(e,i){let n;if(e.getStatus()===401){if(e.getErrorText().includes("Firebase App Check token is invalid")){n=$t()}else{n=Lt()}}else{if(e.getStatus()===402){n=zt(t.bucket)}else{if(e.getStatus()===403){n=Ut(t.path)}else{n=i}}}n.status=e.getStatus();n.serverResponse=i.serverResponse;return n}return e}function ci(t){const e=hi(t);function i(i,n){let s=e(i,n);if(i.getStatus()===404){s=Ft(t.path)}s.serverResponse=n.serverResponse;return s}return i}function ui(t,e,i){const n=e.fullServerUrl();const s=de(n,t.host,t._protocol);const r="GET";const o=t.maxOperationRetryTime;const a=new ni(s,r,ri(t,i),o);a.errorHandler=ci(e);return a}function li(t,e,i,n,s){const r={};if(e.isRoot){r["prefix"]=""}else{r["prefix"]=e.path+"/"}if(i&&i.length>0){r["delimiter"]=i}if(n){r["pageToken"]=n}if(s){r["maxResults"]=s}const o=e.bucketOnlyServerUrl();const a=de(o,t.host,t._protocol);const h="GET";const c=t.maxOperationRetryTime;const u=new ni(a,h,oi(t,e.bucket),c);u.urlParams=r;u.errorHandler=hi(e);return u}function fi(t,e,i){const n=e.fullServerUrl();const s=de(n,t.host,t._protocol);const r="GET";const o=t.maxOperationRetryTime;const a=new ni(s,r,ai(t,i),o);a.errorHandler=ci(e);return a}function di(t,e){const i=e.fullServerUrl();const n=de(i,t.host,t._protocol);const s="DELETE";const r=t.maxOperationRetryTime;function o(t,e){}const a=new ni(n,s,o,r);a.successCodes=[200,204];a.errorHandler=ci(e);return a}function pi(t,e){return t&&t["contentType"]||e&&e.type()||"application/octet-stream"}function mi(t,e,i){const n=Object.assign({},i);n["fullPath"]=t.path;n["size"]=e.size();if(!n["contentType"]){n["contentType"]=pi(null,e)}return n}function _i(t,e,i,n,s){const r=e.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};function a(){let t="";for(let e=0;e<2;e++){t=t+Math.random().toString().slice(2)}return t}const h=a();o["Content-Type"]="multipart/related; boundary="+h;const c=mi(e,n,s);const u=Ke(c,i);const l="--"+h+"\r\n"+"Content-Type: application/json; charset=utf-8\r\n\r\n"+u+"\r\n--"+h+"\r\n"+"Content-Type: "+c["contentType"]+"\r\n\r\n";const f="\r\n--"+h+"--";const d=ze.getBlob(l,n,f);if(d===null){throw qt()}const p={name:c["fullPath"]};const m=de(r,t.host,t._protocol);const _="POST";const v=t.maxUploadRetryTime;const g=new ni(m,_,ri(t,i),v);g.urlParams=p;g.headers=o;g.body=d.uploadData();g.errorHandler=hi(e);return g}class vi{constructor(t,e,i,n){this.current=t;this.total=e;this.finalized=!!i;this.metadata=n||null}}function gi(t,e){let i=null;try{i=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){si(false)}const n=e||["active"];si(!!i&&n.indexOf(i)!==-1);return i}function bi(t,e,i,n,s){const r=e.bucketOnlyServerUrl();const o=mi(e,n,s);const a={name:o["fullPath"]};const h=de(r,t.host,t._protocol);const c="POST";const u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n.size()}`,"X-Goog-Upload-Header-Content-Type":o["contentType"],"Content-Type":"application/json; charset=utf-8"};const l=Ke(o,i);const f=t.maxUploadRetryTime;function d(t){gi(t);let e;try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){si(false)}si(ce(e));return e}const p=new ni(h,c,d,f);p.urlParams=a;p.headers=u;p.body=l;p.errorHandler=hi(e);return p}function wi(t,e,i,n){const s={"X-Goog-Upload-Command":"query"};function r(t){const e=gi(t,["active","final"]);let i=null;try{i=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){si(false)}if(!i){si(false)}const s=Number(i);si(!isNaN(s));return new vi(s,n.size(),e==="final")}const o="POST";const a=t.maxUploadRetryTime;const h=new ni(i,o,r,a);h.headers=s;h.errorHandler=hi(e);return h}const yi=256*1024;function xi(t,e,i,n,s,r,o,a){const h=new vi(0,0);if(o){h.current=o.current;h.total=o.total}else{h.current=0;h.total=n.size()}if(n.size()!==h.total){throw Yt()}const c=h.total-h.current;let u=c;if(s>0){u=Math.min(u,s)}const l=h.current;const f=l+u;let d="";if(u===0){d="finalize"}else if(c===u){d="upload, finalize"}else{d="upload"}const p={"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":`${h.current}`};const m=n.slice(l,f);if(m===null){throw qt()}function _(t,i){const s=gi(t,["active","final"]);const o=h.current+u;const a=n.size();let c;if(s==="final"){c=ri(e,r)(t,i)}else{c=null}return new vi(o,a,s==="final",c)}const v="POST";const g=e.maxUploadRetryTime;const b=new ni(i,v,_,g);b.headers=p;b.body=m.uploadData();b.progressCallback=a||null;b.errorHandler=hi(t);return b}const Mi={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ti(t){switch(t){case"running":case"pausing":case"canceling":return Mi.RUNNING;case"paused":return Mi.PAUSED;case"success":return Mi.SUCCESS;case"canceled":return Mi.CANCELED;case"error":return Mi.ERROR;default:return Mi.ERROR}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(t,e,i){const n=ae(t)||e!=null||i!=null;if(n){this.next=t;this.error=e!==null&&e!==void 0?e:undefined;this.complete=i!==null&&i!==void 0?i:undefined}else{const e=t;this.next=e.next;this.error=e.error;this.complete=e.complete}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ei(t){return(...e)=>{Promise.resolve().then((()=>t(...e)))}}class Ai{constructor(){this.sent_=false;this.xhr_=new XMLHttpRequest;this.initXhr();this.errorCode_=me.NO_ERROR;this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=me.ABORT;t()}));this.xhr_.addEventListener("error",(()=>{this.errorCode_=me.NETWORK_ERROR;t()}));this.xhr_.addEventListener("load",(()=>{t()}))}))}send(t,e,i,n){if(this.sent_){throw ee("cannot .send() more than once")}this.sent_=true;this.xhr_.open(e,t,true);if(n!==undefined){for(const t in n){if(n.hasOwnProperty(t)){this.xhr_.setRequestHeader(t,n[t].toString())}}}if(i!==undefined){this.xhr_.send(i)}else{this.xhr_.send()}return this.sendPromise_}getErrorCode(){if(!this.sent_){throw ee("cannot .getErrorCode() before sending")}return this.errorCode_}getStatus(){if(!this.sent_){throw ee("cannot .getStatus() before sending")}try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_){throw ee("cannot .getResponse() before sending")}return this.xhr_.response}getErrorText(){if(!this.sent_){throw ee("cannot .getErrorText() before sending")}return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){if(this.xhr_.upload!=null){this.xhr_.upload.addEventListener("progress",t)}}removeUploadProgressListener(t){if(this.xhr_.upload!=null){this.xhr_.upload.removeEventListener("progress",t)}}}class Si extends Ai{initXhr(){this.xhr_.responseType="text"}}function ki(){return new Si}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ii{constructor(t,e,i=null){this._transferred=0;this._needToFetchStatus=false;this._needToFetchMetadata=false;this._observers=[];this._error=undefined;this._uploadUrl=undefined;this._request=undefined;this._chunkMultiplier=1;this._resolve=undefined;this._reject=undefined;this._ref=t;this._blob=e;this._metadata=i;this._mappings=qe();this._resumable=this._shouldDoResumable(this._blob);this._state="running";this._errorHandler=t=>{this._request=undefined;this._chunkMultiplier=1;if(t._codeEquals(Rt.CANCELED)){this._needToFetchStatus=true;this.completeTransitions_()}else{const e=this.isExponentialBackoffExpired();if(_e(t.status,[])){if(e){t=Bt()}else{this.sleepTime=Math.max(this.sleepTime*2,jt);this._needToFetchStatus=true;this.completeTransitions_();return}}this._error=t;this._transition("error")}};this._metadataErrorHandler=t=>{this._request=undefined;if(t._codeEquals(Rt.CANCELED)){this.completeTransitions_()}else{this._error=t;this._transition("error")}};this.sleepTime=0;this.maxSleepTime=this._ref.storage.maxUploadRetryTime;this._promise=new Promise(((t,e)=>{this._resolve=t;this._reject=e;this._start()}));this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(t){return t.size()>256*1024}_start(){if(this._state!=="running"){return}if(this._request!==undefined){return}if(this._resumable){if(this._uploadUrl===undefined){this._createResumable()}else{if(this._needToFetchStatus){this._fetchStatus()}else{if(this._needToFetchMetadata){this._fetchMetadata()}else{this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=undefined;this._continueUpload()}),this.sleepTime)}}}}else{this._oneShotUpload()}}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([e,i])=>{switch(this._state){case"running":t(e,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}}))}_createResumable(){this._resolveToken(((t,e)=>{const i=bi(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const n=this._ref.storage._makeRequest(i,ki,t,e);this._request=n;n.getPromise().then((t=>{this._request=undefined;this._uploadUrl=t;this._needToFetchStatus=false;this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const t=this._uploadUrl;this._resolveToken(((e,i)=>{const n=wi(this._ref.storage,this._ref._location,t,this._blob);const s=this._ref.storage._makeRequest(n,ki,e,i);this._request=s;s.getPromise().then((t=>{t=t;this._request=undefined;this._updateProgress(t.current);this._needToFetchStatus=false;if(t.finalized){this._needToFetchMetadata=true}this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const t=yi*this._chunkMultiplier;const e=new vi(this._transferred,this._blob.size());const i=this._uploadUrl;this._resolveToken(((n,s)=>{let r;try{r=xi(this._ref._location,this._ref.storage,i,this._blob,t,this._mappings,e,this._makeProgressCallback())}catch(t){this._error=t;this._transition("error");return}const o=this._ref.storage._makeRequest(r,ki,n,s,false);this._request=o;o.getPromise().then((t=>{this._increaseMultiplier();this._request=undefined;this._updateProgress(t.current);if(t.finalized){this._metadata=t.metadata;this._transition("success")}else{this.completeTransitions_()}}),this._errorHandler)}))}_increaseMultiplier(){const t=yi*this._chunkMultiplier;if(t*2<32*1024*1024){this._chunkMultiplier*=2}}_fetchMetadata(){this._resolveToken(((t,e)=>{const i=ui(this._ref.storage,this._ref._location,this._mappings);const n=this._ref.storage._makeRequest(i,ki,t,e);this._request=n;n.getPromise().then((t=>{this._request=undefined;this._metadata=t;this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((t,e)=>{const i=_i(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const n=this._ref.storage._makeRequest(i,ki,t,e);this._request=n;n.getPromise().then((t=>{this._request=undefined;this._metadata=t;this._updateProgress(this._blob.size());this._transition("success")}),this._errorHandler)}))}_updateProgress(t){const e=this._transferred;this._transferred=t;if(this._transferred!==e){this._notifyObservers()}}_transition(t){if(this._state===t){return}switch(t){case"canceling":case"pausing":this._state=t;if(this._request!==undefined){this._request.cancel()}else if(this.pendingTimeout){clearTimeout(this.pendingTimeout);this.pendingTimeout=undefined;this.completeTransitions_()}break;case"running":const e=this._state==="paused";this._state=t;if(e){this._notifyObservers();this._start()}break;case"paused":this._state=t;this._notifyObservers();break;case"canceled":this._error=Gt();this._state=t;this._notifyObservers();break;case"error":this._state=t;this._notifyObservers();break;case"success":this._state=t;this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const t=Ti(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,e,i,n){const s=new Oi(e||undefined,i||undefined,n||undefined);this._addObserver(s);return()=>{this._removeObserver(s)}}then(t,e){return this._promise.then(t,e)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t);this._notifyObserver(t)}_removeObserver(t){const e=this._observers.indexOf(t);if(e!==-1){this._observers.splice(e,1)}}_notifyObservers(){this._finishPromise();const t=this._observers.slice();t.forEach((t=>{this._notifyObserver(t)}))}_finishPromise(){if(this._resolve!==undefined){let t=true;switch(Ti(this._state)){case Mi.SUCCESS:Ei(this._resolve.bind(null,this.snapshot))();break;case Mi.CANCELED:case Mi.ERROR:const e=this._reject;Ei(e.bind(null,this._error))();break;default:t=false;break}if(t){this._resolve=undefined;this._reject=undefined}}}_notifyObserver(t){const e=Ti(this._state);switch(e){case Mi.RUNNING:case Mi.PAUSED:if(t.next){Ei(t.next.bind(t,this.snapshot))()}break;case Mi.SUCCESS:if(t.complete){Ei(t.complete.bind(t))()}break;case Mi.CANCELED:case Mi.ERROR:if(t.error){Ei(t.error.bind(t,this._error))()}break;default:if(t.error){Ei(t.error.bind(t,this._error))()}}}resume(){const t=this._state==="paused"||this._state==="pausing";if(t){this._transition("running")}return t}pause(){const t=this._state==="running";if(t){this._transition("pausing")}return t}cancel(){const t=this._state==="running"||this._state==="pausing";if(t){this._transition("canceling")}return t}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(t,e){this._service=t;if(e instanceof ie){this._location=e}else{this._location=ie.makeFromUrl(e,t.host)}}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new Ci(t,e)}get root(){const t=new ie(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Be(this._location.path)}get storage(){return this._service}get parent(){const t=$e(this._location.path);if(t===null){return null}const e=new ie(this._location.bucket,t);return new Ci(this._service,e)}_throwIfRoot(t){if(this._location.path===""){throw Qt(t)}}}function ji(t,e,i){t._throwIfRoot("uploadBytesResumable");return new Ii(t,new ze(e),i)}function Di(t){const e={prefixes:[],items:[]};return Ri(t,e).then((()=>e))}async function Ri(t,e,i){const n={pageToken:i};const s=await Pi(t,n);e.prefixes.push(...s.prefixes);e.items.push(...s.items);if(s.nextPageToken!=null){await Ri(t,e,s.nextPageToken)}}function Pi(t,e){if(e!=null){if(typeof e.maxResults==="number"){fe("options.maxResults",1,1e3,e.maxResults)}}const i=e||{};const n=li(t.storage,t._location,"/",i.pageToken,i.maxResults);return t.storage.makeRequestWithTokens(n,ki)}function Ni(t){t._throwIfRoot("getDownloadURL");const e=fi(t.storage,t._location,qe());return t.storage.makeRequestWithTokens(e,ki).then((t=>{if(t===null){throw Xt()}return t}))}function Fi(t){t._throwIfRoot("deleteObject");const e=di(t.storage,t._location);return t.storage.makeRequestWithTokens(e,ki)}function zi(t,e){const i=Ue(t._location.path,e);const n=new ie(t._location.bucket,i);return new Ci(t.storage,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(t){return/^[A-Za-z]+:\/\//.test(t)}function $i(t,e){return new Ci(t,e)}function Ui(t,e){if(t instanceof Vi){const i=t;if(i._bucket==null){throw Wt()}const n=new Ci(i,i._bucket);if(e!=null){return Ui(n,e)}else{return n}}else{if(e!==undefined){return zi(t,e)}else{return t}}}function Bi(t,e){if(e&&Li(e)){if(t instanceof Vi){return $i(t,e)}else{throw Jt("To use ref(service, url), the first argument must be a Storage instance.")}}else{return Ui(t,e)}}function Gi(t,e){const i=e===null||e===void 0?void 0:e[kt];if(i==null){return null}return ie.makeFromBucketSpec(i,t)}function Hi(t,e,i,n={}){t.host=`${e}:${i}`;t._protocol="http";const{mockUserToken:s}=n;if(s){t._overrideAuthToken=typeof s==="string"?s:a(s,t.app.options.projectId)}}class Vi{constructor(t,e,i,n,s){this.app=t;this._authProvider=e;this._appCheckProvider=i;this._url=n;this._firebaseVersion=s;this._bucket=null;this._host=St;this._protocol="https";this._appId=null;this._deleted=false;this._maxOperationRetryTime=It;this._maxUploadRetryTime=Ct;this._requests=new Set;if(n!=null){this._bucket=ie.makeFromBucketSpec(n,this._host)}else{this._bucket=Gi(this._host,this.app.options)}}get host(){return this._host}set host(t){this._host=t;if(this._url!=null){this._bucket=ie.makeFromBucketSpec(this._url,t)}else{this._bucket=Gi(t,this.app.options)}}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){fe("time",0,Number.POSITIVE_INFINITY,t);this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){fe("time",0,Number.POSITIVE_INFINITY,t);this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken){return this._overrideAuthToken}const t=this._authProvider.getImmediate({optional:true});if(t){const e=await t.getToken();if(e!==null){return e.accessToken}}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:true});if(t){const e=await t.getToken();return e.token}return null}_delete(){if(!this._deleted){this._deleted=true;this._requests.forEach((t=>t.cancel()));this._requests.clear()}return Promise.resolve()}_makeStorageReference(t){return new Ci(this,t)}_makeRequest(t,e,i,n,s=true){if(!this._deleted){const r=Me(t,this._appId,i,n,e,this._firebaseVersion,s);this._requests.add(r);r.getPromise().then((()=>this._requests.delete(r)),(()=>this._requests.delete(r)));return r}else{return new ne(Kt())}}async makeRequestWithTokens(t,e){const[i,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,i,n).getPromise()}}const Wi="@firebase/storage";const qi="0.13.1";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yi="storage";function Xi(t,e,n){t=i(t);return ji(t,e,n)}function Zi(t){t=i(t);return Di(t)}function Ji(t){t=i(t);return Ni(t)}function Ki(t){t=i(t);return Fi(t)}function Qi(t,e){t=i(t);return Bi(t,e)}function tn(t=e(),r){t=i(t);const o=n(t,Yi);const a=o.getImmediate({identifier:r});const h=s("storage");if(h){en(a,...h)}return a}function en(t,e,i,n={}){Hi(t,e,i,n)}function nn(t,{instanceIdentifier:e}){const i=t.getProvider("app").getImmediate();const n=t.getProvider("auth-internal");const s=t.getProvider("app-check-internal");return new Vi(i,n,s,e,h)}function sn(){r(new o(Yi,nn,"PUBLIC").setMultipleInstances(true));t(Wi,qi,"");t(Wi,qi,"esm2017")}sn();function rn(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is "+"initialized. Please be sure to call `initializeAuth` or `getAuth` before "+"starting any other Firebase SDK."}}const on=rn;const an=new _("auth","Firebase",rn());
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hn=new M("@firebase/auth");function cn(t,...e){if(hn.logLevel<=T.WARN){hn.warn(`Auth (${h}): ${t}`,...e)}}function un(t,...e){if(hn.logLevel<=T.ERROR){hn.error(`Auth (${h}): ${t}`,...e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ln(t,...e){throw _n(t,...e)}function fn(t,...e){return _n(t,...e)}function dn(t,e,i){const n=Object.assign(Object.assign({},on()),{[e]:i});const s=new _("auth","Firebase",n);return s.create(e,{appName:t.name})}function pn(t){return dn(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function mn(t,e,i){const n=i;if(!(e instanceof n)){if(n.name!==e.constructor.name){ln(t,"argument-error")}throw dn(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.`+`Did you pass a reference from a different Auth SDK?`)}}function _n(t,...e){if(typeof t!=="string"){const i=e[0];const n=[...e.slice(1)];if(n[0]){n[0].appName=t.name}return t._errorFactory.create(i,...n)}return an.create(t,...e)}function vn(t,e,...i){if(!t){throw _n(e,...i)}}function gn(t){const e=`INTERNAL ASSERTION FAILED: `+t;un(e);throw new Error(e)}function bn(t,e){if(!t){gn(e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(){var t;return typeof self!=="undefined"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function yn(){return xn()==="http:"||xn()==="https:"}function xn(){var t;return typeof self!=="undefined"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mn(){if(typeof navigator!=="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine==="boolean"&&(yn()||v()||"connection"in navigator)){return navigator.onLine}return true}function Tn(){if(typeof navigator==="undefined"){return null}const t=navigator;return t.languages&&t.languages[0]||t.language||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class On{constructor(t,e){this.shortDelay=t;this.longDelay=e;bn(e>t,"Short delay should be less than long delay!");this.isMobile=l()||f()}get(){if(!Mn()){return Math.min(5e3,this.shortDelay)}return this.isMobile?this.longDelay:this.shortDelay}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function En(t,e){bn(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;if(!e){return i}return`${i}${e.startsWith("/")?e.slice(1):e}`}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class An{static initialize(t,e,i){this.fetchImpl=t;if(e){this.headersImpl=e}if(i){this.responseImpl=i}}static fetch(){if(this.fetchImpl){return this.fetchImpl}if(typeof self!=="undefined"&&"fetch"in self){return self.fetch}if(typeof globalThis!=="undefined"&&globalThis.fetch){return globalThis.fetch}if(typeof fetch!=="undefined"){return fetch}gn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl){return this.headersImpl}if(typeof self!=="undefined"&&"Headers"in self){return self.Headers}if(typeof globalThis!=="undefined"&&globalThis.Headers){return globalThis.Headers}if(typeof Headers!=="undefined"){return Headers}gn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl){return this.responseImpl}if(typeof self!=="undefined"&&"Response"in self){return self.Response}if(typeof globalThis!=="undefined"&&globalThis.Response){return globalThis.Response}if(typeof Response!=="undefined"){return Response}gn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sn={["CREDENTIAL_MISMATCH"]:"custom-token-mismatch",["MISSING_CUSTOM_TOKEN"]:"internal-error",["INVALID_IDENTIFIER"]:"invalid-email",["MISSING_CONTINUE_URI"]:"internal-error",["INVALID_PASSWORD"]:"wrong-password",["MISSING_PASSWORD"]:"missing-password",["INVALID_LOGIN_CREDENTIALS"]:"invalid-credential",["EMAIL_EXISTS"]:"email-already-in-use",["PASSWORD_LOGIN_DISABLED"]:"operation-not-allowed",["INVALID_IDP_RESPONSE"]:"invalid-credential",["INVALID_PENDING_TOKEN"]:"invalid-credential",["FEDERATED_USER_ID_ALREADY_LINKED"]:"credential-already-in-use",["MISSING_REQ_TYPE"]:"internal-error",["EMAIL_NOT_FOUND"]:"user-not-found",["RESET_PASSWORD_EXCEED_LIMIT"]:"too-many-requests",["EXPIRED_OOB_CODE"]:"expired-action-code",["INVALID_OOB_CODE"]:"invalid-action-code",["MISSING_OOB_CODE"]:"internal-error",["CREDENTIAL_TOO_OLD_LOGIN_AGAIN"]:"requires-recent-login",["INVALID_ID_TOKEN"]:"invalid-user-token",["TOKEN_EXPIRED"]:"user-token-expired",["USER_NOT_FOUND"]:"user-token-expired",["TOO_MANY_ATTEMPTS_TRY_LATER"]:"too-many-requests",["PASSWORD_DOES_NOT_MEET_REQUIREMENTS"]:"password-does-not-meet-requirements",["INVALID_CODE"]:"invalid-verification-code",["INVALID_SESSION_INFO"]:"invalid-verification-id",["INVALID_TEMPORARY_PROOF"]:"invalid-credential",["MISSING_SESSION_INFO"]:"missing-verification-id",["SESSION_EXPIRED"]:"code-expired",["MISSING_ANDROID_PACKAGE_NAME"]:"missing-android-pkg-name",["UNAUTHORIZED_DOMAIN"]:"unauthorized-continue-uri",["INVALID_OAUTH_CLIENT_ID"]:"invalid-oauth-client-id",["ADMIN_ONLY_OPERATION"]:"admin-restricted-operation",["INVALID_MFA_PENDING_CREDENTIAL"]:"invalid-multi-factor-session",["MFA_ENROLLMENT_NOT_FOUND"]:"multi-factor-info-not-found",["MISSING_MFA_ENROLLMENT_ID"]:"missing-multi-factor-info",["MISSING_MFA_PENDING_CREDENTIAL"]:"missing-multi-factor-session",["SECOND_FACTOR_EXISTS"]:"second-factor-already-in-use",["SECOND_FACTOR_LIMIT_EXCEEDED"]:"maximum-second-factor-count-exceeded",["BLOCKING_FUNCTION_ERROR_RESPONSE"]:"internal-error",["RECAPTCHA_NOT_ENABLED"]:"recaptcha-not-enabled",["MISSING_RECAPTCHA_TOKEN"]:"missing-recaptcha-token",["INVALID_RECAPTCHA_TOKEN"]:"invalid-recaptcha-token",["INVALID_RECAPTCHA_ACTION"]:"invalid-recaptcha-action",["MISSING_CLIENT_TYPE"]:"missing-client-type",["MISSING_RECAPTCHA_VERSION"]:"missing-recaptcha-version",["INVALID_RECAPTCHA_VERSION"]:"invalid-recaptcha-version",["INVALID_REQ_TYPE"]:"invalid-req-type"};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kn=new On(3e4,6e4);function In(t,e){if(t.tenantId&&!e.tenantId){return Object.assign(Object.assign({},e),{tenantId:t.tenantId})}return e}async function Cn(t,e,i,n,s={}){return jn(t,s,(async()=>{let s={};let r={};if(n){if(e==="GET"){r=n}else{s={body:JSON.stringify(n)}}}const o=d(Object.assign({key:t.config.apiKey},r)).slice(1);const a=await t._getAdditionalHeaders();a["Content-Type"]="application/json";if(t.languageCode){a["X-Firebase-Locale"]=t.languageCode}return An.fetch()(Rn(t,t.config.apiHost,i,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},s))}))}async function jn(t,e,i){t._canInitEmulator=false;const n=Object.assign(Object.assign({},Sn),e);try{const e=new Nn(t);const s=await Promise.race([i(),e.promise]);e.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r){throw Fn(t,"account-exists-with-different-credential",r)}if(s.ok&&!("errorMessage"in r)){return r}else{const e=s.ok?r.errorMessage:r.error.message;const[i,o]=e.split(" : ");if(i==="FEDERATED_USER_ID_ALREADY_LINKED"){throw Fn(t,"credential-already-in-use",r)}else if(i==="EMAIL_EXISTS"){throw Fn(t,"email-already-in-use",r)}else if(i==="USER_DISABLED"){throw Fn(t,"user-disabled",r)}const a=n[i]||i.toLowerCase().replace(/[_\s]+/g,"-");if(o){throw dn(t,a,o)}else{ln(t,a)}}}catch(e){if(e instanceof c){throw e}ln(t,"network-request-failed",{message:String(e)})}}async function Dn(t,e,i,n,s={}){const r=await Cn(t,e,i,n,s);if("mfaPendingCredential"in r){ln(t,"multi-factor-auth-required",{_serverResponse:r})}return r}function Rn(t,e,i,n){const s=`${e}${i}?${n}`;if(!t.config.emulator){return`${t.config.apiScheme}://${s}`}return En(t.config,s)}function Pn(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Nn{constructor(t){this.auth=t;this.timer=null;this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(fn(this.auth,"network-request-failed"))),kn.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Fn(t,e,i){const n={appName:t.name};if(i.email){n.email=i.email}if(i.phoneNumber){n.phoneNumber=i.phoneNumber}const s=fn(t,e,n);s.customData._tokenResponse=i;return s}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zn(t){return t!==undefined&&t.getResponse!==undefined}function Ln(t){return t!==undefined&&t.enterprise!==undefined}class $n{constructor(t){this.siteKey="";this.recaptchaEnforcementState=[];if(t.recaptchaKey===undefined){throw new Error("recaptchaKey undefined")}this.siteKey=t.recaptchaKey.split("/")[3];this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0){return null}for(const e of this.recaptchaEnforcementState){if(e.provider&&e.provider===t){return Pn(e.enforcementState)}}return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Un(t){return(await Cn(t,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function Bn(t,e){return Cn(t,"GET","/v2/recaptchaConfig",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gn(t,e){return Cn(t,"POST","/v1/accounts:delete",e)}async function Hn(t,e){return Cn(t,"POST","/v1/accounts:update",e)}async function Vn(t,e){return Cn(t,"POST","/v1/accounts:lookup",e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wn(t){if(!t){return undefined}try{const e=new Date(Number(t));if(!isNaN(e.getTime())){return e.toUTCString()}}catch(t){}return undefined}async function qn(t,e=false){const n=i(t);const s=await n.getIdToken(e);const r=Xn(s);vn(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o=typeof r.firebase==="object"?r.firebase:undefined;const a=o===null||o===void 0?void 0:o["sign_in_provider"];return{claims:r,token:s,authTime:Wn(Yn(r.auth_time)),issuedAtTime:Wn(Yn(r.iat)),expirationTime:Wn(Yn(r.exp)),signInProvider:a||null,signInSecondFactor:(o===null||o===void 0?void 0:o["sign_in_second_factor"])||null}}function Yn(t){return Number(t)*1e3}function Xn(t){const[e,i,n]=t.split(".");if(e===undefined||i===undefined||n===undefined){un("JWT malformed, contained fewer than 3 sections");return null}try{const t=O(i);if(!t){un("Failed to decode base64 JWT payload");return null}return JSON.parse(t)}catch(t){un("Caught error parsing JWT payload as JSON",t===null||t===void 0?void 0:t.toString());return null}}function Zn(t){const e=Xn(t);vn(e,"internal-error");vn(typeof e.exp!=="undefined","internal-error");vn(typeof e.iat!=="undefined","internal-error");return Number(e.exp)-Number(e.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jn(t,e,i=false){if(i){return e}try{return await e}catch(e){if(e instanceof c&&Kn(e)){if(t.auth.currentUser===t){await t.auth.signOut()}}throw e}}function Kn({code:t}){return t===`auth/${"user-disabled"}`||t===`auth/${"user-token-expired"}`}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qn{constructor(t){this.user=t;this.isRunning=false;this.timerId=null;this.errorBackoff=3e4}_start(){if(this.isRunning){return}this.isRunning=true;this.schedule()}_stop(){if(!this.isRunning){return}this.isRunning=false;if(this.timerId!==null){clearTimeout(this.timerId)}}getInterval(t){var e;if(t){const t=this.errorBackoff;this.errorBackoff=Math.min(this.errorBackoff*2,96e4);return t}else{this.errorBackoff=3e4;const t=(e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0;const i=t-Date.now()-3e5;return Math.max(0,i)}}schedule(t=false){if(!this.isRunning){return}const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(true)}catch(t){if((t===null||t===void 0?void 0:t.code)===`auth/${"network-request-failed"}`){this.schedule(true)}return}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(t,e){this.createdAt=t;this.lastLoginAt=e;this._initializeTime()}_initializeTime(){this.lastSignInTime=Wn(this.lastLoginAt);this.creationTime=Wn(this.createdAt)}_copy(t){this.createdAt=t.createdAt;this.lastLoginAt=t.lastLoginAt;this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function es(t){var e;const i=t.auth;const n=await t.getIdToken();const s=await Jn(t,Vn(i,{idToken:n}));vn(s===null||s===void 0?void 0:s.users.length,i,"internal-error");const r=s.users[0];t._notifyReloadListener(r);const o=((e=r.providerUserInfo)===null||e===void 0?void 0:e.length)?ss(r.providerUserInfo):[];const a=ns(t.providerData,o);const h=t.isAnonymous;const c=!(t.email&&r.passwordHash)&&!(a===null||a===void 0?void 0:a.length);const u=!h?false:c;const l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||false,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new ts(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(t,l)}async function is(t){const e=i(t);await es(e);await e.auth._persistUserIfCurrent(e);e.auth._notifyListenersIfCurrent(e)}function ns(t,e){const i=t.filter((t=>!e.some((e=>e.providerId===t.providerId))));return[...i,...e]}function ss(t){return t.map((t=>{var{providerId:e}=t,i=Ot(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rs(t,e){const i=await jn(t,{},(async()=>{const i=d({grant_type:"refresh_token",refresh_token:e}).slice(1);const{tokenApiHost:n,apiKey:s}=t.config;const r=Rn(t,n,"/v1/token",`key=${s}`);const o=await t._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";return An.fetch()(r,{method:"POST",headers:o,body:i})}));return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function os(t,e){return Cn(t,"POST","/v2/accounts:revokeToken",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(){this.refreshToken=null;this.accessToken=null;this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){vn(t.idToken,"internal-error");vn(typeof t.idToken!=="undefined","internal-error");vn(typeof t.refreshToken!=="undefined","internal-error");const e="expiresIn"in t&&typeof t.expiresIn!=="undefined"?Number(t.expiresIn):Zn(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){vn(t.length!==0,"internal-error");const e=Zn(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=false){if(!e&&this.accessToken&&!this.isExpired){return this.accessToken}vn(this.refreshToken,t,"user-token-expired");if(this.refreshToken){await this.refresh(t,this.refreshToken);return this.accessToken}return null}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:n,expiresIn:s}=await rs(t,e);this.updateTokensAndExpiration(i,n,Number(s))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null;this.accessToken=t||null;this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){const{refreshToken:i,accessToken:n,expirationTime:s}=e;const r=new as;if(i){vn(typeof i==="string","internal-error",{appName:t});r.refreshToken=i}if(n){vn(typeof n==="string","internal-error",{appName:t});r.accessToken=n}if(s){vn(typeof s==="number","internal-error",{appName:t});r.expirationTime=s}return r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken;this.refreshToken=t.refreshToken;this.expirationTime=t.expirationTime}_clone(){return Object.assign(new as,this.toJSON())}_performRefresh(){return gn("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(t,e){vn(typeof t==="string"||typeof t==="undefined","internal-error",{appName:e})}class cs{constructor(t){var{uid:e,auth:i,stsTokenManager:n}=t,s=Ot(t,["uid","auth","stsTokenManager"]);this.providerId="firebase";this.proactiveRefresh=new Qn(this);this.reloadUserInfo=null;this.reloadListener=null;this.uid=e;this.auth=i;this.stsTokenManager=n;this.accessToken=n.accessToken;this.displayName=s.displayName||null;this.email=s.email||null;this.emailVerified=s.emailVerified||false;this.phoneNumber=s.phoneNumber||null;this.photoURL=s.photoURL||null;this.isAnonymous=s.isAnonymous||false;this.tenantId=s.tenantId||null;this.providerData=s.providerData?[...s.providerData]:[];this.metadata=new ts(s.createdAt||undefined,s.lastLoginAt||undefined)}async getIdToken(t){const e=await Jn(this,this.stsTokenManager.getToken(this.auth,t));vn(e,this.auth,"internal-error");if(this.accessToken!==e){this.accessToken=e;await this.auth._persistUserIfCurrent(this);this.auth._notifyListenersIfCurrent(this)}return e}getIdTokenResult(t){return qn(this,t)}reload(){return is(this)}_assign(t){if(this===t){return}vn(this.uid===t.uid,this.auth,"internal-error");this.displayName=t.displayName;this.photoURL=t.photoURL;this.email=t.email;this.emailVerified=t.emailVerified;this.phoneNumber=t.phoneNumber;this.isAnonymous=t.isAnonymous;this.tenantId=t.tenantId;this.providerData=t.providerData.map((t=>Object.assign({},t)));this.metadata._copy(t.metadata);this.stsTokenManager._assign(t.stsTokenManager)}_clone(t){const e=new cs(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));e.metadata._copy(this.metadata);return e}_onReload(t){vn(!this.reloadListener,this.auth,"internal-error");this.reloadListener=t;if(this.reloadUserInfo){this._notifyReloadListener(this.reloadUserInfo);this.reloadUserInfo=null}}_notifyReloadListener(t){if(this.reloadListener){this.reloadListener(t)}else{this.reloadUserInfo=t}}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=false){let i=false;if(t.idToken&&t.idToken!==this.stsTokenManager.accessToken){this.stsTokenManager.updateFromServerResponse(t);i=true}if(e){await es(this)}await this.auth._persistUserIfCurrent(this);if(i){this.auth._notifyListenersIfCurrent(this)}}async delete(){if(p(this.auth.app)){return Promise.reject(pn(this.auth))}const t=await this.getIdToken();await Jn(this,Gn(this.auth,{idToken:t}));this.stsTokenManager.clearRefreshToken();return this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||undefined,emailVerified:this.emailVerified,displayName:this.displayName||undefined,isAnonymous:this.isAnonymous,photoURL:this.photoURL||undefined,phoneNumber:this.phoneNumber||undefined,tenantId:this.tenantId||undefined,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,n,s,r,o,a,h,c;const u=(i=e.displayName)!==null&&i!==void 0?i:undefined;const l=(n=e.email)!==null&&n!==void 0?n:undefined;const f=(s=e.phoneNumber)!==null&&s!==void 0?s:undefined;const d=(r=e.photoURL)!==null&&r!==void 0?r:undefined;const p=(o=e.tenantId)!==null&&o!==void 0?o:undefined;const m=(a=e._redirectEventId)!==null&&a!==void 0?a:undefined;const _=(h=e.createdAt)!==null&&h!==void 0?h:undefined;const v=(c=e.lastLoginAt)!==null&&c!==void 0?c:undefined;const{uid:g,emailVerified:b,isAnonymous:w,providerData:y,stsTokenManager:x}=e;vn(g&&x,t,"internal-error");const M=as.fromJSON(this.name,x);vn(typeof g==="string",t,"internal-error");hs(u,t.name);hs(l,t.name);vn(typeof b==="boolean",t,"internal-error");vn(typeof w==="boolean",t,"internal-error");hs(f,t.name);hs(d,t.name);hs(p,t.name);hs(m,t.name);hs(_,t.name);hs(v,t.name);const T=new cs({uid:g,auth:t,email:l,emailVerified:b,displayName:u,isAnonymous:w,photoURL:d,phoneNumber:f,tenantId:p,stsTokenManager:M,createdAt:_,lastLoginAt:v});if(y&&Array.isArray(y)){T.providerData=y.map((t=>Object.assign({},t)))}if(m){T._redirectEventId=m}return T}static async _fromIdTokenResponse(t,e,i=false){const n=new as;n.updateFromServerResponse(e);const s=new cs({uid:e.localId,auth:t,stsTokenManager:n,isAnonymous:i});await es(s);return s}static async _fromGetAccountInfoResponse(t,e,i){const n=e.users[0];vn(n.localId!==undefined,"internal-error");const s=n.providerUserInfo!==undefined?ss(n.providerUserInfo):[];const r=!(n.email&&n.passwordHash)&&!(s===null||s===void 0?void 0:s.length);const o=new as;o.updateFromIdToken(i);const a=new cs({uid:n.localId,auth:t,stsTokenManager:o,isAnonymous:r});const h={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||false,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new ts(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(s===null||s===void 0?void 0:s.length)};Object.assign(a,h);return a}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const us=new Map;function ls(t){bn(t instanceof Function,"Expected a class definition");let e=us.get(t);if(e){bn(e instanceof t,"Instance stored in cache mismatched with class");return e}e=new t;us.set(t,e);return e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(){this.type="NONE";this.storage={}}async _isAvailable(){return true}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===undefined?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){return}_removeListener(t,e){return}}fs.type="NONE";const ds=fs;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ps(t,e,i){return`${"firebase"}:${t}:${e}:${i}`}class ms{constructor(t,e,i){this.persistence=t;this.auth=e;this.userKey=i;const{config:n,name:s}=this.auth;this.fullUserKey=ps(this.userKey,n.apiKey,s);this.fullPersistenceKey=ps("persistence",n.apiKey,s);this.boundEventHandler=e._onStorageEvent.bind(e);this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?cs._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t){return}const e=await this.getCurrentUser();await this.removeCurrentUser();this.persistence=t;if(e){return this.setCurrentUser(e)}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length){return new ms(ls(ds),t,i)}const n=(await Promise.all(e.map((async t=>{if(await t._isAvailable()){return t}return undefined})))).filter((t=>t));let s=n[0]||ls(ds);const r=ps(i,t.config.apiKey,t.name);let o=null;for(const i of e){try{const e=await i._get(r);if(e){const n=cs._fromJSON(t,e);if(i!==s){o=n}s=i;break}}catch(t){}}const a=n.filter((t=>t._shouldAllowMigration));if(!s._shouldAllowMigration||!a.length){return new ms(s,t,i)}s=a[0];if(o){await s._set(r,o.toJSON())}await Promise.all(e.map((async t=>{if(t!==s){try{await t._remove(r)}catch(t){}}})));return new ms(s,t,i)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _s(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/")){return"Opera"}else if(ws(e)){return"IEMobile"}else if(e.includes("msie")||e.includes("trident/")){return"IE"}else if(e.includes("edge/")){return"Edge"}else if(vs(e)){return"Firefox"}else if(e.includes("silk/")){return"Silk"}else if(xs(e)){return"Blackberry"}else if(Ms(e)){return"Webos"}else if(gs(e)){return"Safari"}else if((e.includes("chrome/")||bs(e))&&!e.includes("edge/")){return"Chrome"}else if(ys(e)){return"Android"}else{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/;const i=t.match(e);if((i===null||i===void 0?void 0:i.length)===2){return i[1]}}return"Other"}function vs(t=E()){return/firefox\//i.test(t)}function gs(t=E()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function bs(t=E()){return/crios\//i.test(t)}function ws(t=E()){return/iemobile/i.test(t)}function ys(t=E()){return/android/i.test(t)}function xs(t=E()){return/blackberry/i.test(t)}function Ms(t=E()){return/webos/i.test(t)}function Ts(t=E()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Os(t=E()){var e;return Ts(t)&&!!((e=window.navigator)===null||e===void 0?void 0:e.standalone)}function Es(){return x()&&document.documentMode===10}function As(t=E()){return Ts(t)||ys(t)||Ms(t)||xs(t)||/windows phone/i.test(t)||ws(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(t,e=[]){let i;switch(t){case"Browser":i=_s(E());break;case"Worker":i=`${_s(E())}-${t}`;break;default:i=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${i}/${"JsCore"}/${h}/${n}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(t){this.auth=t;this.queue=[]}pushCallback(t,e){const i=e=>new Promise(((i,n)=>{try{const n=t(e);i(n)}catch(t){n(t)}}));i.onAbort=e;this.queue.push(i);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t){return}const e=[];try{for(const i of this.queue){await i(t);if(i.onAbort){e.push(i.onAbort)}}}catch(t){e.reverse();for(const t of e){try{t()}catch(t){}}throw this.auth._errorFactory.create("login-blocked",{originalMessage:t===null||t===void 0?void 0:t.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Is(t,e={}){return Cn(t,"GET","/v2/passwordPolicy",In(t,e))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cs=6;class js{constructor(t){var e,i,n,s;const r=t.customStrengthOptions;this.customStrengthOptions={};this.customStrengthOptions.minPasswordLength=(e=r.minPasswordLength)!==null&&e!==void 0?e:Cs;if(r.maxPasswordLength){this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength}if(r.containsLowercaseCharacter!==undefined){this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter}if(r.containsUppercaseCharacter!==undefined){this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter}if(r.containsNumericCharacter!==undefined){this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter}if(r.containsNonAlphanumericCharacter!==undefined){this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter}this.enforcementState=t.enforcementState;if(this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"){this.enforcementState="OFF"}this.allowedNonAlphanumericCharacters=(n=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&n!==void 0?n:"";this.forceUpgradeOnSignin=(s=t.forceUpgradeOnSignin)!==null&&s!==void 0?s:false;this.schemaVersion=t.schemaVersion}validatePassword(t){var e,i,n,s,r,o;const a={isValid:true,passwordPolicy:this};this.validatePasswordLengthOptions(t,a);this.validatePasswordCharacterOptions(t,a);a.isValid&&(a.isValid=(e=a.meetsMinPasswordLength)!==null&&e!==void 0?e:true);a.isValid&&(a.isValid=(i=a.meetsMaxPasswordLength)!==null&&i!==void 0?i:true);a.isValid&&(a.isValid=(n=a.containsLowercaseLetter)!==null&&n!==void 0?n:true);a.isValid&&(a.isValid=(s=a.containsUppercaseLetter)!==null&&s!==void 0?s:true);a.isValid&&(a.isValid=(r=a.containsNumericCharacter)!==null&&r!==void 0?r:true);a.isValid&&(a.isValid=(o=a.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:true);return a}validatePasswordLengthOptions(t,e){const i=this.customStrengthOptions.minPasswordLength;const n=this.customStrengthOptions.maxPasswordLength;if(i){e.meetsMinPasswordLength=t.length>=i}if(n){e.meetsMaxPasswordLength=t.length<=n}}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,false,false,false,false);let i;for(let n=0;n<t.length;n++){i=t.charAt(n);this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}}updatePasswordCharacterOptionsStatuses(t,e,i,n,s){if(this.customStrengthOptions.containsLowercaseLetter){t.containsLowercaseLetter||(t.containsLowercaseLetter=e)}if(this.customStrengthOptions.containsUppercaseLetter){t.containsUppercaseLetter||(t.containsUppercaseLetter=i)}if(this.customStrengthOptions.containsNumericCharacter){t.containsNumericCharacter||(t.containsNumericCharacter=n)}if(this.customStrengthOptions.containsNonAlphanumericCharacter){t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=s)}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds{constructor(t,e,i,n){this.app=t;this.heartbeatServiceProvider=e;this.appCheckServiceProvider=i;this.config=n;this.currentUser=null;this.emulatorConfig=null;this.operations=Promise.resolve();this.authStateSubscription=new Ps(this);this.idTokenSubscription=new Ps(this);this.beforeStateQueue=new ks(this);this.redirectUser=null;this.isProactiveRefreshEnabled=false;this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1;this._canInitEmulator=true;this._isInitialized=false;this._deleted=false;this._initializationPromise=null;this._popupRedirectResolver=null;this._errorFactory=an;this._agentRecaptchaConfig=null;this._tenantRecaptchaConfigs={};this._projectPasswordPolicy=null;this._tenantPasswordPolicies={};this.lastNotifiedUid=undefined;this.languageCode=null;this.tenantId=null;this.settings={appVerificationDisabledForTesting:false};this.frameworks=[];this.name=t.name;this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,e){if(e){this._popupRedirectResolver=ls(e)}this._initializationPromise=this.queue((async()=>{var i,n;if(this._deleted){return}this.persistenceManager=await ms.create(this,t);if(this._deleted){return}if((i=this._popupRedirectResolver)===null||i===void 0?void 0:i._shouldInitProactively){try{await this._popupRedirectResolver._initialize(this)}catch(t){}}await this.initializeCurrentUser(e);this.lastNotifiedUid=((n=this.currentUser)===null||n===void 0?void 0:n.uid)||null;if(this._deleted){return}this._isInitialized=true}));return this._initializationPromise}async _onStorageEvent(){if(this._deleted){return}const t=await this.assertedPersistence.getCurrentUser();if(!this.currentUser&&!t){return}if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t);await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,true)}async initializeCurrentUserFromIdToken(t){try{const e=await Vn(this,{idToken:t});const i=await cs._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t);await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(p(this.app)){const t=this.app.settings.authIdToken;if(t){return new Promise((e=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(t).then(e,e)))}))}else{return this.directlySetCurrentUser(null)}}const i=await this.assertedPersistence.getCurrentUser();let n=i;let s=false;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId;const r=n===null||n===void 0?void 0:n._redirectEventId;const o=await this.tryRedirectSignIn(t);if((!i||i===r)&&(o===null||o===void 0?void 0:o.user)){n=o.user;s=true}}if(!n){return this.directlySetCurrentUser(null)}if(!n._redirectEventId){if(s){try{await this.beforeStateQueue.runMiddleware(n)}catch(t){n=i;this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}}if(n){return this.reloadAndSetCurrentUserOrClear(n)}else{return this.directlySetCurrentUser(null)}}vn(this._popupRedirectResolver,this,"argument-error");await this.getOrInitRedirectPersistenceManager();if(this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId){return this.directlySetCurrentUser(n)}return this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,true)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await es(t)}catch(t){if((t===null||t===void 0?void 0:t.code)!==`auth/${"network-request-failed"}`){return this.directlySetCurrentUser(null)}}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Tn()}async _delete(){this._deleted=true}async updateCurrentUser(t){if(p(this.app)){return Promise.reject(pn(this))}const e=t?i(t):null;if(e){vn(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token")}return this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=false){if(this._deleted){return}if(t){vn(this.tenantId===t.tenantId,this,"tenant-id-mismatch")}if(!e){await this.beforeStateQueue.runMiddleware(t)}return this.queue((async()=>{await this.directlySetCurrentUser(t);this.notifyAuthListeners()}))}async signOut(){if(p(this.app)){return Promise.reject(pn(this))}await this.beforeStateQueue.runMiddleware(null);if(this.redirectPersistenceManager||this._popupRedirectResolver){await this._setRedirectUser(null)}return this._updateCurrentUser(null,true)}setPersistence(t){if(p(this.app)){return Promise.reject(pn(this))}return this.queue((async()=>{await this.assertedPersistence.setPersistence(ls(t))}))}_getRecaptchaConfig(){if(this.tenantId==null){return this._agentRecaptchaConfig}else{return this._tenantRecaptchaConfigs[this.tenantId]}}async validatePassword(t){if(!this._getPasswordPolicyInternal()){await this._updatePasswordPolicy()}const e=this._getPasswordPolicyInternal();if(e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION){return Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{}))}return e.validatePassword(t)}_getPasswordPolicyInternal(){if(this.tenantId===null){return this._projectPasswordPolicy}else{return this._tenantPasswordPolicies[this.tenantId]}}async _updatePasswordPolicy(){const t=await Is(this);const e=new js(t);if(this.tenantId===null){this._projectPasswordPolicy=e}else{this._tenantPasswordPolicies[this.tenantId]=e}}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new _("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise(((t,e)=>{if(this.currentUser){t()}else{const i=this.onAuthStateChanged((()=>{i();t()}),e)}}))}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken();const i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};if(this.tenantId!=null){i.tenantId=this.tenantId}await os(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&ls(t)||this._popupRedirectResolver;vn(e,this,"argument-error");this.redirectPersistenceManager=await ms.create(this,[ls(e._redirectPersistence)],"redirectUser");this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,i;if(this._isInitialized){await this.queue((async()=>{}))}if(((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t){return this._currentUser}if(((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t){return this.redirectUser}return null}async _persistUserIfCurrent(t){if(t===this.currentUser){return this.queue((async()=>this.directlySetCurrentUser(t)))}}_notifyListenersIfCurrent(t){if(t===this.currentUser){this.notifyAuthListeners()}}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=true;if(this.currentUser){this._currentUser._startProactiveRefresh()}}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=false;if(this.currentUser){this._currentUser._stopProactiveRefresh()}}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized){return}this.idTokenSubscription.next(this.currentUser);const i=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;if(this.lastNotifiedUid!==i){this.lastNotifiedUid=i;this.authStateSubscription.next(this.currentUser)}}registerStateListener(t,e,i,n){if(this._deleted){return()=>{}}const s=typeof e==="function"?e:e.next.bind(e);let r=false;const o=this._isInitialized?Promise.resolve():this._initializationPromise;vn(o,this,"internal-error");o.then((()=>{if(r){return}s(this.currentUser)}));if(typeof e==="function"){const s=t.addObserver(e,i,n);return()=>{r=true;s()}}else{const i=t.addObserver(e);return()=>{r=true;i()}}}async directlySetCurrentUser(t){if(this.currentUser&&this.currentUser!==t){this._currentUser._stopProactiveRefresh()}if(t&&this.isProactiveRefreshEnabled){t._startProactiveRefresh()}this.currentUser=t;if(t){await this.assertedPersistence.setCurrentUser(t)}else{await this.assertedPersistence.removeCurrentUser()}}queue(t){this.operations=this.operations.then(t,t);return this.operations}get assertedPersistence(){vn(this.persistenceManager,this,"internal-error");return this.persistenceManager}_logFramework(t){if(!t||this.frameworks.includes(t)){return}this.frameworks.push(t);this.frameworks.sort();this.clientVersion=Ss(this.config.clientPlatform,this._getFrameworks())}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={["X-Client-Version"]:this.clientVersion};if(this.app.options.appId){e["X-Firebase-gmpid"]=this.app.options.appId}const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:true}))===null||t===void 0?void 0:t.getHeartbeatsHeader());if(i){e["X-Firebase-Client"]=i}const n=await this._getAppCheckToken();if(n){e["X-Firebase-AppCheck"]=n}return e}async _getAppCheckToken(){var t;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:true}))===null||t===void 0?void 0:t.getToken());if(e===null||e===void 0?void 0:e.error){cn(`Error while retrieving App Check token: ${e.error}`)}return e===null||e===void 0?void 0:e.token}}function Rs(t){return i(t)}class Ps{constructor(t){this.auth=t;this.observer=null;this.addObserver=g((t=>this.observer=t))}get next(){vn(this.observer,this.auth,"internal-error");return this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ns={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Fs(t){Ns=t}function zs(t){return Ns.loadJS(t)}function Ls(){return Ns.recaptchaV2Script}function $s(){return Ns.recaptchaEnterpriseScript}function Us(){return Ns.gapiScript}function Bs(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const Gs="recaptcha-enterprise";const Hs="NO_RECAPTCHA";class Vs{constructor(t){this.type=Gs;this.auth=Rs(t)}async verify(t="verify",e=false){async function i(t){if(!e){if(t.tenantId==null&&t._agentRecaptchaConfig!=null){return t._agentRecaptchaConfig.siteKey}if(t.tenantId!=null&&t._tenantRecaptchaConfigs[t.tenantId]!==undefined){return t._tenantRecaptchaConfigs[t.tenantId].siteKey}}return new Promise((async(e,i)=>{Bn(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((n=>{if(n.recaptchaKey===undefined){i(new Error("recaptcha Enterprise site key undefined"))}else{const i=new $n(n);if(t.tenantId==null){t._agentRecaptchaConfig=i}else{t._tenantRecaptchaConfigs[t.tenantId]=i}return e(i.siteKey)}})).catch((t=>{i(t)}))}))}function n(e,i,n){const s=window.grecaptcha;if(Ln(s)){s.enterprise.ready((()=>{s.enterprise.execute(e,{action:t}).then((t=>{i(t)})).catch((()=>{i(Hs)}))}))}else{n(Error("No reCAPTCHA enterprise script loaded."))}}return new Promise(((t,s)=>{i(this.auth).then((i=>{if(!e&&Ln(window.grecaptcha)){n(i,t,s)}else{if(typeof window==="undefined"){s(new Error("RecaptchaVerifier is only supported in browser"));return}let e=$s();if(e.length!==0){e+=i}zs(e).then((()=>{n(i,t,s)})).catch((t=>{s(t)}))}})).catch((t=>{s(t)}))}))}}async function Ws(t,e,i,n=false){const s=new Vs(t);let r;try{r=await s.verify(i)}catch(t){r=await s.verify(i,true)}const o=Object.assign({},e);if(!n){Object.assign(o,{captchaResponse:r})}else{Object.assign(o,{captchaResp:r})}Object.assign(o,{clientType:"CLIENT_TYPE_WEB"});Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"});return o}async function qs(t,e,i,n){var s;if((s=t._getRecaptchaConfig())===null||s===void 0?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Ws(t,e,i,i==="getOobCode");return n(t,s)}else{return n(t,e).catch((async s=>{if(s.code===`auth/${"missing-recaptcha-token"}`){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Ws(t,e,i,i==="getOobCode");return n(t,s)}else{return Promise.reject(s)}}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(t,e){const i=n(t,"auth");if(i.isInitialized()){const t=i.getImmediate();const n=i.getOptions();if(b(n,e!==null&&e!==void 0?e:{})){return t}else{ln(t,"already-initialized")}}const s=i.initialize({options:e});return s}function Xs(t,e){const i=(e===null||e===void 0?void 0:e.persistence)||[];const n=(Array.isArray(i)?i:[i]).map(ls);if(e===null||e===void 0?void 0:e.errorMap){t._updateErrorMap(e.errorMap)}t._initializeWithPersistence(n,e===null||e===void 0?void 0:e.popupRedirectResolver)}function Zs(t,e,i){const n=Rs(t);vn(n._canInitEmulator,n,"emulator-config-failed");vn(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const s=!!(i===null||i===void 0?void 0:i.disableWarnings);const r=Js(e);const{host:o,port:a}=Ks(e);const h=a===null?"":`:${a}`;n.config.emulator={url:`${r}//${o}${h}/`};n.settings.appVerificationDisabledForTesting=true;n.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!s){tr()}}function Js(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Ks(t){const e=Js(t);const i=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!i){return{host:"",port:null}}const n=i[2].split("@").pop()||"";const s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const t=s[1];return{host:t,port:Qs(n.substr(t.length+1))}}else{const[t,e]=n.split(":");return{host:t,port:Qs(e)}}}function Qs(t){if(!t){return null}const e=Number(t);if(isNaN(e)){return null}return e}function tr(){function t(){const t=document.createElement("p");const e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.";e.position="fixed";e.width="100%";e.backgroundColor="#ffffff";e.border=".1em solid #000000";e.color="#b50000";e.bottom="0px";e.left="0px";e.margin="0px";e.zIndex="10000";e.textAlign="center";t.classList.add("firebase-emulator-warning");document.body.appendChild(t)}if(typeof console!=="undefined"&&typeof console.info==="function"){console.info("WARNING: You are using the Auth Emulator,"+" which is intended for local testing only.  Do not use with"+" production credentials.")}if(typeof window!=="undefined"&&typeof document!=="undefined"){if(document.readyState==="loading"){window.addEventListener("DOMContentLoaded",t)}else{t()}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(t,e){this.providerId=t;this.signInMethod=e}toJSON(){return gn("not implemented")}_getIdTokenResponse(t){return gn("not implemented")}_linkToIdToken(t,e){return gn("not implemented")}_getReauthenticationResolver(t){return gn("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ir(t,e){return Cn(t,"POST","/v1/accounts:resetPassword",In(t,e))}async function nr(t,e){return Cn(t,"POST","/v1/accounts:update",e)}async function sr(t,e){return Cn(t,"POST","/v1/accounts:signUp",e)}async function rr(t,e){return Cn(t,"POST","/v1/accounts:update",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function or(t,e){return Dn(t,"POST","/v1/accounts:signInWithPassword",In(t,e))}async function ar(t,e){return Cn(t,"POST","/v1/accounts:sendOobCode",In(t,e))}async function hr(t,e){return ar(t,e)}async function cr(t,e){return ar(t,e)}async function ur(t,e){return ar(t,e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lr(t,e){return Dn(t,"POST","/v1/accounts:signInWithEmailLink",In(t,e))}async function fr(t,e){return Dn(t,"POST","/v1/accounts:signInWithEmailLink",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr extends er{constructor(t,e,i,n=null){super("password",i);this._email=t;this._password=e;this._tenantId=n}static _fromEmailAndPassword(t,e){return new dr(t,e,"password")}static _fromEmailAndCode(t,e,i=null){return new dr(t,e,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e=typeof t==="string"?JSON.parse(t):t;if((e===null||e===void 0?void 0:e.email)&&(e===null||e===void 0?void 0:e.password)){if(e.signInMethod==="password"){return this._fromEmailAndPassword(e.email,e.password)}else if(e.signInMethod==="emailLink"){return this._fromEmailAndCode(e.email,e.password,e.tenantId)}}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const e={returnSecureToken:true,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return qs(t,e,"signInWithPassword",or);case"emailLink":return lr(t,{email:this._email,oobCode:this._password});default:ln(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":const i={idToken:e,returnSecureToken:true,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return qs(t,i,"signUpPassword",sr);case"emailLink":return fr(t,{idToken:e,email:this._email,oobCode:this._password});default:ln(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pr(t,e){return Dn(t,"POST","/v1/accounts:signInWithIdp",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mr="http://localhost";class _r extends er{constructor(){super(...arguments);this.pendingToken=null}static _fromParams(t){const e=new _r(t.providerId,t.signInMethod);if(t.idToken||t.accessToken){if(t.idToken){e.idToken=t.idToken}if(t.accessToken){e.accessToken=t.accessToken}if(t.nonce&&!t.pendingToken){e.nonce=t.nonce}if(t.pendingToken){e.pendingToken=t.pendingToken}}else if(t.oauthToken&&t.oauthTokenSecret){e.accessToken=t.oauthToken;e.secret=t.oauthTokenSecret}else{ln("argument-error")}return e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t==="string"?JSON.parse(t):t;const{providerId:i,signInMethod:n}=e,s=Ot(e,["providerId","signInMethod"]);if(!i||!n){return null}const r=new _r(i,n);r.idToken=s.idToken||undefined;r.accessToken=s.accessToken||undefined;r.secret=s.secret;r.nonce=s.nonce;r.pendingToken=s.pendingToken||null;return r}_getIdTokenResponse(t){const e=this.buildRequest();return pr(t,e)}_linkToIdToken(t,e){const i=this.buildRequest();i.idToken=e;return pr(t,i)}_getReauthenticationResolver(t){const e=this.buildRequest();e.autoCreate=false;return pr(t,e)}buildRequest(){const t={requestUri:mr,returnSecureToken:true};if(this.pendingToken){t.pendingToken=this.pendingToken}else{const e={};if(this.idToken){e["id_token"]=this.idToken}if(this.accessToken){e["access_token"]=this.accessToken}if(this.secret){e["oauth_token_secret"]=this.secret}e["providerId"]=this.providerId;if(this.nonce&&!this.pendingToken){e["nonce"]=this.nonce}t.postBody=d(e)}return t}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vr(t,e){return Cn(t,"POST","/v1/accounts:sendVerificationCode",In(t,e))}async function gr(t,e){return Dn(t,"POST","/v1/accounts:signInWithPhoneNumber",In(t,e))}async function br(t,e){const i=await Dn(t,"POST","/v1/accounts:signInWithPhoneNumber",In(t,e));if(i.temporaryProof){throw Fn(t,"account-exists-with-different-credential",i)}return i}const wr={["USER_NOT_FOUND"]:"user-not-found"};async function yr(t,e){const i=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Dn(t,"POST","/v1/accounts:signInWithPhoneNumber",In(t,i),wr)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr extends er{constructor(t){super("phone","phone");this.params=t}static _fromVerification(t,e){return new xr({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new xr({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return gr(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return br(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return yr(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:i,verificationCode:n}=this.params;if(t&&e){return{temporaryProof:t,phoneNumber:e}}return{sessionInfo:i,code:n}}toJSON(){const t={providerId:this.providerId};if(this.params.phoneNumber){t.phoneNumber=this.params.phoneNumber}if(this.params.temporaryProof){t.temporaryProof=this.params.temporaryProof}if(this.params.verificationCode){t.verificationCode=this.params.verificationCode}if(this.params.verificationId){t.verificationId=this.params.verificationId}return t}static fromJSON(t){if(typeof t==="string"){t=JSON.parse(t)}const{verificationId:e,verificationCode:i,phoneNumber:n,temporaryProof:s}=t;if(!i&&!e&&!n&&!s){return null}return new xr({verificationId:e,verificationCode:i,phoneNumber:n,temporaryProof:s})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mr(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Tr(t){const e=w(y(t))["link"];const i=e?w(y(e))["deep_link_id"]:null;const n=w(y(t))["deep_link_id"];const s=n?w(y(n))["link"]:null;return s||n||i||e||t}class Or{constructor(t){var e,i,n,s,r,o;const a=w(y(t));const h=(e=a["apiKey"])!==null&&e!==void 0?e:null;const c=(i=a["oobCode"])!==null&&i!==void 0?i:null;const u=Mr((n=a["mode"])!==null&&n!==void 0?n:null);vn(h&&c&&u,"argument-error");this.apiKey=h;this.operation=u;this.code=c;this.continueUrl=(s=a["continueUrl"])!==null&&s!==void 0?s:null;this.languageCode=(r=a["languageCode"])!==null&&r!==void 0?r:null;this.tenantId=(o=a["tenantId"])!==null&&o!==void 0?o:null}static parseLink(t){const e=Tr(t);try{return new Or(e)}catch(t){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(){this.providerId=Er.PROVIDER_ID}static credential(t,e){return dr._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const i=Or.parseLink(e);vn(i,"argument-error");return dr._fromEmailAndCode(t,i.code,i.tenantId)}}Er.PROVIDER_ID="password";Er.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Er.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(t){this.providerId=t;this.defaultLanguageCode=null;this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){this.customParameters=t;return this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr extends Ar{constructor(){super(...arguments);this.scopes=[]}addScope(t){if(!this.scopes.includes(t)){this.scopes.push(t)}return this}getScopes(){return[...this.scopes]}}class kr extends Sr{static credentialFromJSON(t){const e=typeof t==="string"?JSON.parse(t):t;vn("providerId"in e&&"signInMethod"in e,"argument-error");return _r._fromParams(e)}credential(t){return this._credential(Object.assign(Object.assign({},t),{nonce:t.rawNonce}))}_credential(t){vn(t.idToken||t.accessToken,"argument-error");return _r._fromParams(Object.assign(Object.assign({},t),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(t){return kr.oauthCredentialFromTaggedObject(t)}static credentialFromError(t){return kr.oauthCredentialFromTaggedObject(t.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:t}){if(!t){return null}const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:n,pendingToken:s,nonce:r,providerId:o}=t;if(!i&&!n&&!e&&!s){return null}if(!o){return null}try{return new kr(o)._credential({idToken:e,accessToken:i,nonce:r,pendingToken:s})}catch(t){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir extends Sr{constructor(){super("facebook.com")}static credential(t){return _r._fromParams({providerId:Ir.PROVIDER_ID,signInMethod:Ir.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ir.credentialFromTaggedObject(t)}static credentialFromError(t){return Ir.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)){return null}if(!t.oauthAccessToken){return null}try{return Ir.credential(t.oauthAccessToken)}catch(t){return null}}}Ir.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ir.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr extends Sr{constructor(){super("google.com");this.addScope("profile")}static credential(t,e){return _r._fromParams({providerId:Cr.PROVIDER_ID,signInMethod:Cr.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Cr.credentialFromTaggedObject(t)}static credentialFromError(t){return Cr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t){return null}const{oauthIdToken:e,oauthAccessToken:i}=t;if(!e&&!i){return null}try{return Cr.credential(e,i)}catch(t){return null}}}Cr.GOOGLE_SIGN_IN_METHOD="google.com";Cr.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr extends Sr{constructor(){super("github.com")}static credential(t){return _r._fromParams({providerId:jr.PROVIDER_ID,signInMethod:jr.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return jr.credentialFromTaggedObject(t)}static credentialFromError(t){return jr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)){return null}if(!t.oauthAccessToken){return null}try{return jr.credential(t.oauthAccessToken)}catch(t){return null}}}jr.GITHUB_SIGN_IN_METHOD="github.com";jr.PROVIDER_ID="github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dr extends Sr{constructor(){super("twitter.com")}static credential(t,e){return _r._fromParams({providerId:Dr.PROVIDER_ID,signInMethod:Dr.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Dr.credentialFromTaggedObject(t)}static credentialFromError(t){return Dr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t){return null}const{oauthAccessToken:e,oauthTokenSecret:i}=t;if(!e||!i){return null}try{return Dr.credential(e,i)}catch(t){return null}}}Dr.TWITTER_SIGN_IN_METHOD="twitter.com";Dr.PROVIDER_ID="twitter.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rr(t,e){return Dn(t,"POST","/v1/accounts:signUp",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(t){this.user=t.user;this.providerId=t.providerId;this._tokenResponse=t._tokenResponse;this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,i,n=false){const s=await cs._fromIdTokenResponse(t,i,n);const r=Nr(i);const o=new Pr({user:s,providerId:r,_tokenResponse:i,operationType:e});return o}static async _forOperation(t,e,i){await t._updateTokensIfNecessary(i,true);const n=Nr(i);return new Pr({user:t,providerId:n,_tokenResponse:i,operationType:e})}}function Nr(t){if(t.providerId){return t.providerId}if("phoneNumber"in t){return"phone"}return null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fr(t){var e;if(p(t.app)){return Promise.reject(pn(t))}const i=Rs(t);await i._initializationPromise;if((e=i.currentUser)===null||e===void 0?void 0:e.isAnonymous){return new Pr({user:i.currentUser,providerId:null,operationType:"signIn"})}const n=await Rr(i,{returnSecureToken:true});const s=await Pr._fromIdTokenResponse(i,"signIn",n,true);await i._updateCurrentUser(s.user);return s}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr extends c{constructor(t,e,i,n){var s;super(e.code,e.message);this.operationType=i;this.user=n;Object.setPrototypeOf(this,zr.prototype);this.customData={appName:t.name,tenantId:(s=t.tenantId)!==null&&s!==void 0?s:undefined,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,n){return new zr(t,e,i,n)}}function Lr(t,e,i,n){const s=e==="reauthenticate"?i._getReauthenticationResolver(t):i._getIdTokenResponse(t);return s.catch((i=>{if(i.code===`auth/${"multi-factor-auth-required"}`){throw zr._fromErrorAndOperation(t,i,e,n)}throw i}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $r(t){return new Set(t.map((({providerId:t})=>t)).filter((t=>!!t)))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ur(t,e){const n=i(t);await Gr(true,n,e);const{providerUserInfo:s}=await Hn(n.auth,{idToken:await n.getIdToken(),deleteProvider:[e]});const r=$r(s||[]);n.providerData=n.providerData.filter((t=>r.has(t.providerId)));if(!r.has("phone")){n.phoneNumber=null}await n.auth._persistUserIfCurrent(n);return n}async function Br(t,e,i=false){const n=await Jn(t,e._linkToIdToken(t.auth,await t.getIdToken()),i);return Pr._forOperation(t,"link",n)}async function Gr(t,e,i){await es(e);const n=$r(e.providerData);const s=t===false?"provider-already-linked":"no-such-provider";vn(n.has(i)===t,e.auth,s)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hr(t,e,i=false){const{auth:n}=t;if(p(n.app)){return Promise.reject(pn(n))}const s="reauthenticate";try{const r=await Jn(t,Lr(n,s,e,t),i);vn(r.idToken,n,"internal-error");const o=Xn(r.idToken);vn(o,n,"internal-error");const{sub:a}=o;vn(t.uid===a,n,"user-mismatch");return Pr._forOperation(t,s,r)}catch(t){if((t===null||t===void 0?void 0:t.code)===`auth/${"user-not-found"}`){ln(n,"user-mismatch")}throw t}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vr(t,e,i=false){if(p(t.app)){return Promise.reject(pn(t))}const n="signIn";const s=await Lr(t,n,e);const r=await Pr._fromIdTokenResponse(t,n,s);if(!i){await t._updateCurrentUser(r.user)}return r}async function Wr(t,e){return Vr(Rs(t),e)}async function qr(t,e){const n=i(t);await Gr(false,n,e.providerId);return Br(n,e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yr(t,e){return Dn(t,"POST","/v1/accounts:signInWithCustomToken",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xr(t,e){if(p(t.app)){return Promise.reject(pn(t))}const i=Rs(t);const n=await Yr(i,{token:e,returnSecureToken:true});const s=await Pr._fromIdTokenResponse(i,"signIn",n);await i._updateCurrentUser(s.user);return s}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zr(t,e,i){var n;vn(((n=i.url)===null||n===void 0?void 0:n.length)>0,t,"invalid-continue-uri");vn(typeof i.dynamicLinkDomain==="undefined"||i.dynamicLinkDomain.length>0,t,"invalid-dynamic-link-domain");e.continueUrl=i.url;e.dynamicLinkDomain=i.dynamicLinkDomain;e.canHandleCodeInApp=i.handleCodeInApp;if(i.iOS){vn(i.iOS.bundleId.length>0,t,"missing-ios-bundle-id");e.iOSBundleId=i.iOS.bundleId}if(i.android){vn(i.android.packageName.length>0,t,"missing-android-pkg-name");e.androidInstallApp=i.android.installApp;e.androidMinimumVersionCode=i.android.minimumVersion;e.androidPackageName=i.android.packageName}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jr(t){const e=Rs(t);if(e._getPasswordPolicyInternal()){await e._updatePasswordPolicy()}}async function Kr(t,e,i){const n=Rs(t);const s={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};if(i){Zr(n,s,i)}await qs(n,s,"getOobCode",cr)}async function Qr(t,e,n){await ir(i(t),{oobCode:e,newPassword:n}).catch((async e=>{if(e.code===`auth/${"password-does-not-meet-requirements"}`){void Jr(t)}throw e}))}async function to(t,e){await rr(i(t),{oobCode:e})}async function eo(t,e,i){if(p(t.app)){return Promise.reject(pn(t))}const n=Rs(t);const s={returnSecureToken:true,email:e,password:i,clientType:"CLIENT_TYPE_WEB"};const r=qs(n,s,"signUpPassword",Rr);const o=await r.catch((e=>{if(e.code===`auth/${"password-does-not-meet-requirements"}`){void Jr(t)}throw e}));const a=await Pr._fromIdTokenResponse(n,"signIn",o);await n._updateCurrentUser(a.user);return a}function io(t,e,n){if(p(t.app)){return Promise.reject(pn(t))}return Wr(i(t),Er.credential(e,n)).catch((async e=>{if(e.code===`auth/${"password-does-not-meet-requirements"}`){void Jr(t)}throw e}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function no(t,e,i){const n=Rs(t);const s={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function r(t,e){vn(e.handleCodeInApp,n,"argument-error");if(e){Zr(n,t,e)}}r(s,i);await qs(n,s,"getOobCode",ur)}function so(t,e){const i=Or.parseLink(e);return(i===null||i===void 0?void 0:i.operation)==="EMAIL_SIGNIN"}async function ro(t,e,n){if(p(t.app)){return Promise.reject(pn(t))}const s=i(t);const r=Er.credentialWithLink(e,n||wn());vn(r._tenantId===(s.tenantId||null),s,"tenant-id-mismatch");return Wr(s,r)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oo(t,e){return Cn(t,"POST","/v1/accounts:createAuthUri",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ao(t,e){const n=yn()?wn():"http://localhost";const s={identifier:e,continueUri:n};const{signinMethods:r}=await oo(i(t),s);return r||[]}async function ho(t,e){const n=i(t);const s=await t.getIdToken();const r={requestType:"VERIFY_EMAIL",idToken:s};if(e){Zr(n.auth,r,e)}const{email:o}=await hr(n.auth,r);if(o!==t.email){await t.reload()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function co(t,e){return Cn(t,"POST","/v1/accounts:update",e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uo(t,{displayName:e,photoURL:n}){if(e===undefined&&n===undefined){return}const s=i(t);const r=await s.getIdToken();const o={idToken:r,displayName:e,photoUrl:n,returnSecureToken:true};const a=await Jn(s,co(s.auth,o));s.displayName=a.displayName||null;s.photoURL=a.photoUrl||null;const h=s.providerData.find((({providerId:t})=>t==="password"));if(h){h.displayName=s.displayName;h.photoURL=s.photoURL}await s._updateTokensIfNecessary(a)}function lo(t,e){const n=i(t);if(p(n.auth.app)){return Promise.reject(pn(n.auth))}return po(n,e,null)}function fo(t,e){return po(i(t),null,e)}async function po(t,e,i){const{auth:n}=t;const s=await t.getIdToken();const r={idToken:s,returnSecureToken:true};if(e){r.email=e}if(i){r.password=i}const o=await Jn(t,nr(n,r));await t._updateTokensIfNecessary(o,true)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mo(t){var e,i;if(!t){return null}const{providerId:n}=t;const s=t.rawUserInfo?JSON.parse(t.rawUserInfo):{};const r=t.isNewUser||t.kind==="identitytoolkit#SignupNewUserResponse";if(!n&&(t===null||t===void 0?void 0:t.idToken)){const n=(i=(e=Xn(t.idToken))===null||e===void 0?void 0:e.firebase)===null||i===void 0?void 0:i["sign_in_provider"];if(n){const t=n!=="anonymous"&&n!=="custom"?n:null;return new _o(r,t)}}if(!n){return null}switch(n){case"facebook.com":return new go(r,s);case"github.com":return new bo(r,s);case"google.com":return new wo(r,s);case"twitter.com":return new yo(r,s,t.screenName||null);case"custom":case"anonymous":return new _o(r,null);default:return new _o(r,n,s)}}class _o{constructor(t,e,i={}){this.isNewUser=t;this.providerId=e;this.profile=i}}class vo extends _o{constructor(t,e,i,n){super(t,e,i);this.username=n}}class go extends _o{constructor(t,e){super(t,"facebook.com",e)}}class bo extends vo{constructor(t,e){super(t,"github.com",e,typeof(e===null||e===void 0?void 0:e.login)==="string"?e===null||e===void 0?void 0:e.login:null)}}class wo extends _o{constructor(t,e){super(t,"google.com",e)}}class yo extends vo{constructor(t,e,i){super(t,"twitter.com",e,i)}}function xo(t){const{user:e,_tokenResponse:i}=t;if(e.isAnonymous&&!i){return{providerId:null,isNewUser:false,profile:null}}return mo(i)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mo(t,e){return i(t).setPersistence(e)}function To(t,e,n,s){return i(t).onIdTokenChanged(e,n,s)}function Oo(t,e,n){return i(t).beforeAuthStateChanged(e,n)}function Eo(t,e,n,s){return i(t).onAuthStateChanged(e,n,s)}function Ao(t){return i(t).signOut()}function So(t,e){const i=Rs(t);return i.revokeAccessToken(e)}async function ko(t){return i(t).delete()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(t,e){return Cn(t,"POST","/v2/accounts/mfaEnrollment:start",In(t,e))}const Co="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(t,e){this.storageRetriever=t;this.type=e}_isAvailable(){try{if(!this.storage){return Promise.resolve(false)}this.storage.setItem(Co,"1");this.storage.removeItem(Co);return Promise.resolve(true)}catch(t){return Promise.resolve(false)}}_set(t,e){this.storage.setItem(t,JSON.stringify(e));return Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){this.storage.removeItem(t);return Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Do=1e3;const Ro=10;class Po extends jo{constructor(){super((()=>window.localStorage),"LOCAL");this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e);this.listeners={};this.localCache={};this.pollTimer=null;this.fallbackToPolling=As();this._shouldAllowMigration=true}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const i=this.storage.getItem(e);const n=this.localCache[e];if(i!==n){t(e,n,i)}}}onStorageEvent(t,e=false){if(!t.key){this.forAllChangedKeys(((t,e,i)=>{this.notifyListeners(t,i)}));return}const i=t.key;if(e){this.detachListener()}else{this.stopPolling()}const n=()=>{const t=this.storage.getItem(i);if(!e&&this.localCache[i]===t){return}this.notifyListeners(i,t)};const s=this.storage.getItem(i);if(Es()&&s!==t.newValue&&t.newValue!==t.oldValue){setTimeout(n,Ro)}else{n()}}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i){for(const t of Array.from(i)){t(e?JSON.parse(e):e)}}}startPolling(){this.stopPolling();this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:i}),true)}))}),Do)}stopPolling(){if(this.pollTimer){clearInterval(this.pollTimer);this.pollTimer=null}}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){if(Object.keys(this.listeners).length===0){if(this.fallbackToPolling){this.startPolling()}else{this.attachListener()}}if(!this.listeners[t]){this.listeners[t]=new Set;this.localCache[t]=this.storage.getItem(t)}this.listeners[t].add(e)}_removeListener(t,e){if(this.listeners[t]){this.listeners[t].delete(e);if(this.listeners[t].size===0){delete this.listeners[t]}}if(Object.keys(this.listeners).length===0){this.detachListener();this.stopPolling()}}async _set(t,e){await super._set(t,e);this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);this.localCache[t]=JSON.stringify(e);return e}async _remove(t){await super._remove(t);delete this.localCache[t]}}Po.type="LOCAL";const No=Po;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo extends jo{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){return}_removeListener(t,e){return}}Fo.type="SESSION";const zo=Fo;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lo(t){return Promise.all(t.map((async t=>{try{const e=await t;return{fulfilled:true,value:e}}catch(t){return{fulfilled:false,reason:t}}})))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $o{constructor(t){this.eventTarget=t;this.handlersMap={};this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e){return e}const i=new $o(t);this.receivers.push(i);return i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t;const{eventId:i,eventType:n,data:s}=e.data;const r=this.handlersMap[n];if(!(r===null||r===void 0?void 0:r.size)){return}e.ports[0].postMessage({status:"ack",eventId:i,eventType:n});const o=Array.from(r).map((async t=>t(e.origin,s)));const a=await Lo(o);e.ports[0].postMessage({status:"done",eventId:i,eventType:n,response:a})}_subscribe(t,e){if(Object.keys(this.handlersMap).length===0){this.eventTarget.addEventListener("message",this.boundEventHandler)}if(!this.handlersMap[t]){this.handlersMap[t]=new Set}this.handlersMap[t].add(e)}_unsubscribe(t,e){if(this.handlersMap[t]&&e){this.handlersMap[t].delete(e)}if(!e||this.handlersMap[t].size===0){delete this.handlersMap[t]}if(Object.keys(this.handlersMap).length===0){this.eventTarget.removeEventListener("message",this.boundEventHandler)}}}$o.receivers=[];
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uo(t="",e=10){let i="";for(let t=0;t<e;t++){i+=Math.floor(Math.random()*10)}return t+i}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(t){this.target=t;this.handlers=new Set}removeMessageHandler(t){if(t.messageChannel){t.messageChannel.port1.removeEventListener("message",t.onMessage);t.messageChannel.port1.close()}this.handlers.delete(t)}async _send(t,e,i=50){const n=typeof MessageChannel!=="undefined"?new MessageChannel:null;if(!n){throw new Error("connection_unavailable")}let s;let r;return new Promise(((o,a)=>{const h=Uo("",20);n.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),i);r={messageChannel:n,onMessage(t){const e=t;if(e.data.eventId!==h){return}switch(e.data.status){case"ack":clearTimeout(c);s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s);o(e.data.response);break;default:clearTimeout(c);clearTimeout(s);a(new Error("invalid_response"));break}}};this.handlers.add(r);n.port1.addEventListener("message",r.onMessage);this.target.postMessage({eventType:t,eventId:h,data:e},[n.port2])})).finally((()=>{if(r){this.removeMessageHandler(r)}}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(){return window}function Ho(t){Go().location.href=t}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vo(){return typeof Go()["WorkerGlobalScope"]!=="undefined"&&typeof Go()["importScripts"]==="function"}async function Wo(){if(!(navigator===null||navigator===void 0?void 0:navigator.serviceWorker)){return null}try{const t=await navigator.serviceWorker.ready;return t.active}catch(t){return null}}function qo(){var t;return((t=navigator===null||navigator===void 0?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Yo(){return Vo()?self:null}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="firebaseLocalStorageDb";const Zo=1;const Jo="firebaseLocalStorage";const Ko="fbase_key";class Qo{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)}));this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function ta(t,e){return t.transaction([Jo],e?"readwrite":"readonly").objectStore(Jo)}function ea(){const t=indexedDB.deleteDatabase(Xo);return new Qo(t).toPromise()}function ia(){const t=indexedDB.open(Xo,Zo);return new Promise(((e,i)=>{t.addEventListener("error",(()=>{i(t.error)}));t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(Jo,{keyPath:Ko})}catch(t){i(t)}}));t.addEventListener("success",(async()=>{const i=t.result;if(!i.objectStoreNames.contains(Jo)){i.close();await ea();e(await ia())}else{e(i)}}))}))}async function na(t,e,i){const n=ta(t,true).put({[Ko]:e,value:i});return new Qo(n).toPromise()}async function sa(t,e){const i=ta(t,false).get(e);const n=await new Qo(i).toPromise();return n===undefined?null:n.value}function ra(t,e){const i=ta(t,true).delete(e);return new Qo(i).toPromise()}const oa=800;const aa=3;class ha{constructor(){this.type="LOCAL";this._shouldAllowMigration=true;this.listeners={};this.localCache={};this.pollTimer=null;this.pendingWrites=0;this.receiver=null;this.sender=null;this.serviceWorkerReceiverAvailable=false;this.activeServiceWorker=null;this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){if(this.db){return this.db}this.db=await ia();return this.db}async _withRetries(t){let e=0;while(true){try{const e=await this._openDb();return await t(e)}catch(t){if(e++>aa){throw t}if(this.db){this.db.close();this.db=undefined}}}}async initializeServiceWorkerMessaging(){return Vo()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$o._getInstance(Yo());this.receiver._subscribe("keyChanged",(async(t,e)=>{const i=await this._poll();return{keyProcessed:i.includes(e.key)}}));this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;this.activeServiceWorker=await Wo();if(!this.activeServiceWorker){return}this.sender=new Bo(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);if(!i){return}if(((t=i[0])===null||t===void 0?void 0:t.fulfilled)&&((e=i[0])===null||e===void 0?void 0:e.value.includes("keyChanged"))){this.serviceWorkerReceiverAvailable=true}}async notifyServiceWorker(t){if(!this.sender||!this.activeServiceWorker||qo()!==this.activeServiceWorker){return}try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB){return false}const t=await ia();await na(t,Co,"1");await ra(t,Co);return true}catch(t){}return false}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>{await this._withRetries((i=>na(i,t,e)));this.localCache[t]=e;return this.notifyServiceWorker(t)}))}async _get(t){const e=await this._withRetries((e=>sa(e,t)));this.localCache[t]=e;return e}async _remove(t){return this._withPendingWrite((async()=>{await this._withRetries((e=>ra(e,t)));delete this.localCache[t];return this.notifyServiceWorker(t)}))}async _poll(){const t=await this._withRetries((t=>{const e=ta(t,false).getAll();return new Qo(e).toPromise()}));if(!t){return[]}if(this.pendingWrites!==0){return[]}const e=[];const i=new Set;if(t.length!==0){for(const{fbase_key:n,value:s}of t){i.add(n);if(JSON.stringify(this.localCache[n])!==JSON.stringify(s)){this.notifyListeners(n,s);e.push(n)}}}for(const t of Object.keys(this.localCache)){if(this.localCache[t]&&!i.has(t)){this.notifyListeners(t,null);e.push(t)}}return e}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i){for(const t of Array.from(i)){t(e)}}}startPolling(){this.stopPolling();this.pollTimer=setInterval((async()=>this._poll()),oa)}stopPolling(){if(this.pollTimer){clearInterval(this.pollTimer);this.pollTimer=null}}_addListener(t,e){if(Object.keys(this.listeners).length===0){this.startPolling()}if(!this.listeners[t]){this.listeners[t]=new Set;void this._get(t)}this.listeners[t].add(e)}_removeListener(t,e){if(this.listeners[t]){this.listeners[t].delete(e);if(this.listeners[t].size===0){delete this.listeners[t]}}if(Object.keys(this.listeners).length===0){this.stopPolling()}}}ha.type="LOCAL";const ca=ha;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ua(t,e){return Cn(t,"POST","/v2/accounts/mfaSignIn:start",In(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const la=500;const fa=6e4;const da=1e12;class pa{constructor(t){this.auth=t;this.counter=da;this._widgets=new Map}render(t,e){const i=this.counter;this._widgets.set(i,new ma(t,this.auth.name,e||{}));this.counter++;return i}reset(t){var e;const i=t||da;void((e=this._widgets.get(i))===null||e===void 0?void 0:e.delete());this._widgets.delete(i)}getResponse(t){var e;const i=t||da;return((e=this._widgets.get(i))===null||e===void 0?void 0:e.getResponse())||""}async execute(t){var e;const i=t||da;void((e=this._widgets.get(i))===null||e===void 0?void 0:e.execute());return""}}class ma{constructor(t,e,i){this.params=i;this.timerId=null;this.deleted=false;this.responseToken=null;this.clickHandler=()=>{this.execute()};const n=typeof t==="string"?document.getElementById(t):t;vn(n,"argument-error",{appName:e});this.container=n;this.isVisible=this.params.size!=="invisible";if(this.isVisible){this.execute()}else{this.container.addEventListener("click",this.clickHandler)}}getResponse(){this.checkIfDeleted();return this.responseToken}delete(){this.checkIfDeleted();this.deleted=true;if(this.timerId){clearTimeout(this.timerId);this.timerId=null}this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted();if(this.timerId){return}this.timerId=window.setTimeout((()=>{this.responseToken=_a(50);const{callback:t,"expired-callback":e}=this.params;if(t){try{t(this.responseToken)}catch(t){}}this.timerId=window.setTimeout((()=>{this.timerId=null;this.responseToken=null;if(e){try{e()}catch(t){}}if(this.isVisible){this.execute()}}),fa)}),la)}checkIfDeleted(){if(this.deleted){throw new Error("reCAPTCHA mock was already deleted!")}}}function _a(t){const e=[];const i="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<t;n++){e.push(i.charAt(Math.floor(Math.random()*i.length)))}return e.join("")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const va=Bs("rcb");const ga=new On(3e4,6e4);class ba{constructor(){var t;this.hostLanguage="";this.counter=0;this.librarySeparatelyLoaded=!!((t=Go().grecaptcha)===null||t===void 0?void 0:t.render)}load(t,e=""){vn(wa(e),t,"argument-error");if(this.shouldResolveImmediately(e)&&zn(Go().grecaptcha)){return Promise.resolve(Go().grecaptcha)}return new Promise(((i,n)=>{const s=Go().setTimeout((()=>{n(fn(t,"network-request-failed"))}),ga.get());Go()[va]=()=>{Go().clearTimeout(s);delete Go()[va];const r=Go().grecaptcha;if(!r||!zn(r)){n(fn(t,"internal-error"));return}const o=r.render;r.render=(t,e)=>{const i=o(t,e);this.counter++;return i};this.hostLanguage=e;i(r)};const r=`${Ls()}?${d({onload:va,render:"explicit",hl:e})}`;zs(r).catch((()=>{clearTimeout(s);n(fn(t,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(t){var e;return!!((e=Go().grecaptcha)===null||e===void 0?void 0:e.render)&&(t===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function wa(t){return t.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(t)}class ya{async load(t){return new pa(t)}clearedOneInstance(){}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xa="recaptcha";const Ma={theme:"light",type:"image"};class Ta{constructor(t,e,i=Object.assign({},Ma)){this.parameters=i;this.type=xa;this.destroyed=false;this.widgetId=null;this.tokenChangeListeners=new Set;this.renderPromise=null;this.recaptcha=null;this.auth=Rs(t);this.isInvisible=this.parameters.size==="invisible";vn(typeof document!=="undefined",this.auth,"operation-not-supported-in-this-environment");const n=typeof e==="string"?document.getElementById(e):e;vn(n,this.auth,"argument-error");this.container=n;this.parameters.callback=this.makeTokenCallback(this.parameters.callback);this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new ya:new ba;this.validateStartingState()}async verify(){this.assertNotDestroyed();const t=await this.render();const e=this.getAssertedRecaptcha();const i=e.getResponse(t);if(i){return i}return new Promise((i=>{const n=t=>{if(!t){return}this.tokenChangeListeners.delete(n);i(t)};this.tokenChangeListeners.add(n);if(this.isInvisible){e.execute(t)}}))}render(){try{this.assertNotDestroyed()}catch(t){return Promise.reject(t)}if(this.renderPromise){return this.renderPromise}this.renderPromise=this.makeRenderPromise().catch((t=>{this.renderPromise=null;throw t}));return this.renderPromise}_reset(){this.assertNotDestroyed();if(this.widgetId!==null){this.getAssertedRecaptcha().reset(this.widgetId)}}clear(){this.assertNotDestroyed();this.destroyed=true;this._recaptchaLoader.clearedOneInstance();if(!this.isInvisible){this.container.childNodes.forEach((t=>{this.container.removeChild(t)}))}}validateStartingState(){vn(!this.parameters.sitekey,this.auth,"argument-error");vn(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error");vn(typeof document!=="undefined",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(t){return e=>{this.tokenChangeListeners.forEach((t=>t(e)));if(typeof t==="function"){t(e)}else if(typeof t==="string"){const i=Go()[t];if(typeof i==="function"){i(e)}}}}assertNotDestroyed(){vn(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){await this.init();if(!this.widgetId){let t=this.container;if(!this.isInvisible){const e=document.createElement("div");t.appendChild(e);t=e}this.widgetId=this.getAssertedRecaptcha().render(t,this.parameters)}return this.widgetId}async init(){vn(yn()&&!Vo(),this.auth,"internal-error");await Oa();this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||undefined);const t=await Un(this.auth);vn(t,this.auth,"internal-error");this.parameters.sitekey=t}getAssertedRecaptcha(){vn(this.recaptcha,this.auth,"internal-error");return this.recaptcha}}function Oa(){let t=null;return new Promise((e=>{if(document.readyState==="complete"){e();return}t=()=>e();window.addEventListener("load",t)})).catch((e=>{if(t){window.removeEventListener("load",t)}throw e}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(t,e){this.verificationId=t;this.onConfirmation=e}confirm(t){const e=xr._fromVerification(this.verificationId,t);return this.onConfirmation(e)}}async function Aa(t,e,n){if(p(t.app)){return Promise.reject(pn(t))}const s=Rs(t);const r=await ka(s,e,i(n));return new Ea(r,(t=>Wr(s,t)))}async function Sa(t,e,n){const s=i(t);await Gr(false,s,"phone");const r=await ka(s.auth,e,i(n));return new Ea(r,(t=>qr(s,t)))}async function ka(t,e,i){var n;const s=await i.verify();try{vn(typeof s==="string",t,"argument-error");vn(i.type===xa,t,"argument-error");let r;if(typeof e==="string"){r={phoneNumber:e}}else{r=e}if("session"in r){const e=r.session;if("phoneNumber"in r){vn(e.type==="enroll",t,"internal-error");const i=await Io(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return i.phoneSessionInfo.sessionInfo}else{vn(e.type==="signin",t,"internal-error");const i=((n=r.multiFactorHint)===null||n===void 0?void 0:n.uid)||r.multiFactorUid;vn(i,t,"missing-multi-factor-info");const o=await ua(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:i,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}else{const{sessionInfo:e}=await vr(t,{phoneNumber:r.phoneNumber,recaptchaToken:s});return e}}finally{i._reset()}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ia(t,e){if(e){return ls(e)}vn(t._popupRedirectResolver,t,"argument-error");return t._popupRedirectResolver}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca extends er{constructor(t){super("custom","custom");this.params=t}_getIdTokenResponse(t){return pr(t,this._buildIdpRequest())}_linkToIdToken(t,e){return pr(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return pr(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:true,returnIdpCredential:true};if(t){e.idToken=t}return e}}function ja(t){return Vr(t.auth,new Ca(t),t.bypassAuthState)}function Da(t){const{auth:e,user:i}=t;vn(i,e,"internal-error");return Hr(i,new Ca(t),t.bypassAuthState)}async function Ra(t){const{auth:e,user:i}=t;vn(i,e,"internal-error");return Br(i,new Ca(t),t.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(t,e,i,n,s=false){this.auth=t;this.resolver=i;this.user=n;this.bypassAuthState=s;this.pendingPromise=null;this.eventManager=null;this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth);await this.onExecution();this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:i,postBody:n,tenantId:s,error:r,type:o}=t;if(r){this.reject(r);return}const a={auth:this.auth,requestUri:e,sessionId:i,tenantId:s||undefined,postBody:n||undefined,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return ja;case"linkViaPopup":case"linkViaRedirect":return Ra;case"reauthViaPopup":case"reauthViaRedirect":return Da;default:ln(this.auth,"internal-error")}}resolve(t){bn(this.pendingPromise,"Pending promise was never set");this.pendingPromise.resolve(t);this.unregisterAndCleanUp()}reject(t){bn(this.pendingPromise,"Pending promise was never set");this.pendingPromise.reject(t);this.unregisterAndCleanUp()}unregisterAndCleanUp(){if(this.eventManager){this.eventManager.unregisterConsumer(this)}this.pendingPromise=null;this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na=new On(2e3,1e4);async function Fa(t,e,i){if(p(t.app)){return Promise.reject(fn(t,"operation-not-supported-in-this-environment"))}const n=Rs(t);mn(t,e,Ar);const s=Ia(n,i);const r=new La(n,"signInViaPopup",e,s);return r.executeNotNull()}async function za(t,e,n){const s=i(t);mn(s.auth,e,Ar);const r=Ia(s.auth,n);const o=new La(s.auth,"linkViaPopup",e,r,s);return o.executeNotNull()}class La extends Pa{constructor(t,e,i,n,s){super(t,e,n,s);this.provider=i;this.authWindow=null;this.pollId=null;if(La.currentPopupAction){La.currentPopupAction.cancel()}La.currentPopupAction=this}async executeNotNull(){const t=await this.execute();vn(t,this.auth,"internal-error");return t}async onExecution(){bn(this.filter.length===1,"Popup operations only handle one event");const t=Uo();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t);this.authWindow.associatedEvent=t;this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)}));this.resolver._isIframeWebStorageSupported(this.auth,(t=>{if(!t){this.reject(fn(this.auth,"web-storage-unsupported"))}}));this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(fn(this.auth,"cancelled-popup-request"))}cleanUp(){if(this.authWindow){this.authWindow.close()}if(this.pollId){window.clearTimeout(this.pollId)}this.authWindow=null;this.pollId=null;La.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,i;if((i=(e=this.authWindow)===null||e===void 0?void 0:e.window)===null||i===void 0?void 0:i.closed){this.pollId=window.setTimeout((()=>{this.pollId=null;this.reject(fn(this.auth,"popup-closed-by-user"))}),8e3);return}this.pollId=window.setTimeout(t,Na.get())};t()}}La.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $a="pendingRedirect";const Ua=new Map;class Ba extends Pa{constructor(t,e,i=false){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,undefined,i);this.eventId=null}async execute(){let t=Ua.get(this.auth._key());if(!t){try{const e=await Ga(this.resolver,this.auth);const i=e?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}Ua.set(this.auth._key(),t)}if(!this.bypassAuthState){Ua.set(this.auth._key(),(()=>Promise.resolve(null)))}return t()}async onAuthEvent(t){if(t.type==="signInViaRedirect"){return super.onAuthEvent(t)}else if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e){this.user=e;return super.onAuthEvent(t)}else{this.resolve(null)}}}async onExecution(){}cleanUp(){}}async function Ga(t,e){const i=qa(e);const n=Wa(t);if(!await n._isAvailable()){return false}const s=await n._get(i)==="true";await n._remove(i);return s}async function Ha(t,e){return Wa(t)._set(qa(e),"true")}function Va(t,e){Ua.set(t._key(),e)}function Wa(t){return ls(t._redirectPersistence)}function qa(t){return ps($a,t.config.apiKey,t.name)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ya(t,e,i){return Xa(t,e,i)}async function Xa(t,e,i){if(p(t.app)){return Promise.reject(pn(t))}const n=Rs(t);mn(t,e,Ar);await n._initializationPromise;const s=Ia(n,i);await Ha(s,n);return s._openRedirect(n,e,"signInViaRedirect")}function Za(t,e,i){return Ja(t,e,i)}async function Ja(t,e,n){const s=i(t);mn(s.auth,e,Ar);await s.auth._initializationPromise;const r=Ia(s.auth,n);await Gr(false,s,e.providerId);await Ha(r,s.auth);const o=await th(s);return r._openRedirect(s.auth,e,"linkViaRedirect",o)}async function Ka(t,e){await Rs(t)._initializationPromise;return Qa(t,e,false)}async function Qa(t,e,i=false){if(p(t.app)){return Promise.reject(pn(t))}const n=Rs(t);const s=Ia(n,e);const r=new Ba(n,s,i);const o=await r.execute();if(o&&!i){delete o.user._redirectEventId;await n._persistUserIfCurrent(o.user);await n._setRedirectUser(null,e)}return o}async function th(t){const e=Uo(`${t.uid}:::`);t._redirectEventId=e;await t.auth._setRedirectUser(t);await t.auth._persistUserIfCurrent(t);return e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eh=10*60*1e3;class ih{constructor(t){this.auth=t;this.cachedEventUids=new Set;this.consumers=new Set;this.queuedRedirectEvent=null;this.hasHandledPotentialRedirect=false;this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t);if(this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)){this.sendToConsumer(this.queuedRedirectEvent,t);this.saveEventToCache(this.queuedRedirectEvent);this.queuedRedirectEvent=null}}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t)){return false}let e=false;this.consumers.forEach((i=>{if(this.isEventForConsumer(t,i)){e=true;this.sendToConsumer(t,i);this.saveEventToCache(t)}}));if(this.hasHandledPotentialRedirect||!rh(t)){return e}this.hasHandledPotentialRedirect=true;if(!e){this.queuedRedirectEvent=t;e=true}return e}sendToConsumer(t,e){var i;if(t.error&&!sh(t)){const n=((i=t.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";e.onError(fn(this.auth,n))}else{e.onAuthEvent(t)}}isEventForConsumer(t,e){const i=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){if(Date.now()-this.lastProcessedEventTime>=eh){this.cachedEventUids.clear()}return this.cachedEventUids.has(nh(t))}saveEventToCache(t){this.cachedEventUids.add(nh(t));this.lastProcessedEventTime=Date.now()}}function nh(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function sh({type:t,error:e}){return t==="unknown"&&(e===null||e===void 0?void 0:e.code)===`auth/${"no-auth-event"}`}function rh(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return true;case"unknown":return sh(t);default:return false}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oh(t,e={}){return Cn(t,"GET","/v1/projects",e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;const hh=/^https?/;async function ch(t){if(t.config.emulator){return}const{authorizedDomains:e}=await oh(t);for(const t of e){try{if(uh(t)){return}}catch(t){}}ln(t,"unauthorized-domain")}function uh(t){const e=wn();const{protocol:i,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const s=new URL(t);if(s.hostname===""&&n===""){return i==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://","")}return i==="chrome-extension:"&&s.hostname===n}if(!hh.test(i)){return false}if(ah.test(t)){return n===t}const s=t.replace(/\./g,"\\.");const r=new RegExp("^(.+\\."+s+"|"+s+")$","i");return r.test(n)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lh=new On(3e4,6e4);function fh(){const t=Go().___jsl;if(t===null||t===void 0?void 0:t.H){for(const e of Object.keys(t.H)){t.H[e].r=t.H[e].r||[];t.H[e].L=t.H[e].L||[];t.H[e].r=[...t.H[e].L];if(t.CP){for(let e=0;e<t.CP.length;e++){t.CP[e]=null}}}}}function dh(t){return new Promise(((e,i)=>{var n,s,r;function o(){fh();gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{fh();i(fn(t,"network-request-failed"))},timeout:lh.get()})}if((s=(n=Go().gapi)===null||n===void 0?void 0:n.iframes)===null||s===void 0?void 0:s.Iframe){e(gapi.iframes.getContext())}else if(!!((r=Go().gapi)===null||r===void 0?void 0:r.load)){o()}else{const e=Bs("iframefcb");Go()[e]=()=>{if(!!gapi.load){o()}else{i(fn(t,"network-request-failed"))}};return zs(`${Us()}?onload=${e}`).catch((t=>i(t)))}})).catch((t=>{ph=null;throw t}))}let ph=null;function mh(t){ph=ph||dh(t);return ph}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h=new On(5e3,15e3);const vh="__/auth/iframe";const gh="emulator/auth/iframe";const bh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"};const wh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yh(t){const e=t.config;vn(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?En(e,gh):`https://${t.config.authDomain}/${vh}`;const n={apiKey:e.apiKey,appName:t.name,v:h};const s=wh.get(t.config.apiHost);if(s){n.eid=s}const r=t._getFrameworks();if(r.length){n.fw=r.join(",")}return`${i}?${d(n).slice(1)}`}async function xh(t){const e=await mh(t);const i=Go().gapi;vn(i,t,"internal-error");return e.open({where:document.body,url:yh(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bh,dontclear:true},(e=>new Promise((async(i,n)=>{await e.restyle({setHideOnLeave:false});const s=fn(t,"network-request-failed");const r=Go().setTimeout((()=>{n(s)}),_h.get());function o(){Go().clearTimeout(r);i(e)}e.ping(o).then(o,(()=>{n(s)}))}))))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mh={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};const Th=500;const Oh=600;const Eh="_blank";const Ah="http://localhost";class Sh{constructor(t){this.window=t;this.associatedEvent=null}close(){if(this.window){try{this.window.close()}catch(t){}}}}function kh(t,e,i,n=Th,s=Oh){const r=Math.max((window.screen.availHeight-s)/2,0).toString();const o=Math.max((window.screen.availWidth-n)/2,0).toString();let a="";const h=Object.assign(Object.assign({},Mh),{width:n.toString(),height:s.toString(),top:r,left:o});const c=E().toLowerCase();if(i){a=bs(c)?Eh:i}if(vs(c)){e=e||Ah;h.scrollbars="yes"}const u=Object.entries(h).reduce(((t,[e,i])=>`${t}${e}=${i},`),"");if(Os(c)&&a!=="_self"){Ih(e||"",a);return new Sh(null)}const l=window.open(e||"",a,u);vn(l,t,"popup-blocked");try{l.focus()}catch(t){}return new Sh(l)}function Ih(t,e){const i=document.createElement("a");i.href=t;i.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,1,null);i.dispatchEvent(n)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ch="__/auth/handler";const jh="emulator/auth/handler";const Dh=encodeURIComponent("fac");async function Rh(t,e,i,n,s,r){vn(t.config.authDomain,t,"auth-domain-config-required");vn(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:n,v:h,eventId:s};if(e instanceof Ar){e.setDefaultLanguage(t.languageCode);o.providerId=e.providerId||"";if(!A(e.getCustomParameters())){o.customParameters=JSON.stringify(e.getCustomParameters())}for(const[t,e]of Object.entries(r||{})){o[t]=e}}if(e instanceof Sr){const t=e.getScopes().filter((t=>t!==""));if(t.length>0){o.scopes=t.join(",")}}if(t.tenantId){o.tid=t.tenantId}const a=o;for(const t of Object.keys(a)){if(a[t]===undefined){delete a[t]}}const c=await t._getAppCheckToken();const u=c?`#${Dh}=${encodeURIComponent(c)}`:"";return`${Ph(t)}?${d(a).slice(1)}${u}`}function Ph({config:t}){if(!t.emulator){return`https://${t.authDomain}/${Ch}`}return En(t,jh)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nh="webStorageSupport";class Fh{constructor(){this.eventManagers={};this.iframes={};this.originValidationPromises={};this._redirectPersistence=zo;this._completeRedirectFn=Qa;this._overrideRedirectResult=Va}async _openPopup(t,e,i,n){var s;bn((s=this.eventManagers[t._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const r=await Rh(t,e,i,wn(),n);return kh(t,r,Uo())}async _openRedirect(t,e,i,n){await this._originValidation(t);const s=await Rh(t,e,i,wn(),n);Ho(s);return new Promise((()=>{}))}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:i}=this.eventManagers[e];if(t){return Promise.resolve(t)}else{bn(i,"If manager is not set, promise should be");return i}}const i=this.initAndGetManager(t);this.eventManagers[e]={promise:i};i.catch((()=>{delete this.eventManagers[e]}));return i}async initAndGetManager(t){const e=await xh(t);const i=new ih(t);e.register("authEvent",(e=>{vn(e===null||e===void 0?void 0:e.authEvent,t,"invalid-auth-event");const n=i.onEvent(e.authEvent);return{status:n?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER);this.eventManagers[t._key()]={manager:i};this.iframes[t._key()]=e;return i}_isIframeWebStorageSupported(t,e){const i=this.iframes[t._key()];i.send(Nh,{type:Nh},(i=>{var n;const s=(n=i===null||i===void 0?void 0:i[0])===null||n===void 0?void 0:n[Nh];if(s!==undefined){e(!!s)}ln(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();if(!this.originValidationPromises[e]){this.originValidationPromises[e]=ch(t)}return this.originValidationPromises[e]}get _shouldInitProactively(){return As()||gs()||Ts()}}const zh=Fh;var Lh="@firebase/auth";var $h="1.7.8";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uh{constructor(t){this.auth=t;this.internalListeners=new Map}getUid(){var t;this.assertAuthConfigured();return((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){this.assertAuthConfigured();await this.auth._initializationPromise;if(!this.auth.currentUser){return null}const e=await this.auth.currentUser.getIdToken(t);return{accessToken:e}}addAuthTokenListener(t){this.assertAuthConfigured();if(this.internalListeners.has(t)){return}const e=this.auth.onIdTokenChanged((e=>{t((e===null||e===void 0?void 0:e.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e);this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);if(!e){return}this.internalListeners.delete(t);e();this.updateProactiveRefresh()}assertAuthConfigured(){vn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){if(this.internalListeners.size>0){this.auth._startProactiveRefresh()}else{this.auth._stopProactiveRefresh()}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return undefined}}function Gh(e){r(new o("auth",((t,{options:i})=>{const n=t.getProvider("app").getImmediate();const s=t.getProvider("heartbeat");const r=t.getProvider("app-check-internal");const{apiKey:o,authDomain:a}=n.options;vn(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const h={apiKey:o,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ss(e)};const c=new Ds(n,s,r,h);Xs(c,i);return c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,i)=>{const n=t.getProvider("auth-internal");n.initialize()})));r(new o("auth-internal",(t=>{const e=Rs(t.getProvider("auth").getImmediate());return(t=>new Uh(t))(e)}),"PRIVATE").setInstantiationMode("EXPLICIT"));t(Lh,$h,Bh(e));t(Lh,$h,"esm2017")}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh=5*60;const Vh=u("authIdTokenMaxAge")||Hh;let Wh=null;const qh=t=>async e=>{const i=e&&await e.getIdTokenResult();const n=i&&((new Date).getTime()-Date.parse(i.issuedAtTime))/1e3;if(n&&n>Vh){return}const s=i===null||i===void 0?void 0:i.token;if(Wh===s){return}Wh=s;await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}})};function Yh(t=e()){const i=n(t,"auth");if(i.isInitialized()){return i.getImmediate()}const s=Ys(t,{popupRedirectResolver:zh,persistence:[ca,No,zo]});const r=u("authTokenSyncURL");if(r&&typeof isSecureContext==="boolean"&&isSecureContext){const t=new URL(r,location.origin);if(location.origin===t.origin){const e=qh(t.toString());Oo(s,e,(()=>e(s.currentUser)));To(s,(t=>e(t)))}}const o=m("auth");if(o){Zs(s,`http://${o}`)}return s}function Xh(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Fs({loadJS(t){return new Promise(((e,i)=>{const n=document.createElement("script");n.setAttribute("src",t);n.onload=e;n.onerror=t=>{const e=fn("internal-error");e.customData=t;i(e)};n.type="text/javascript";n.charset="UTF-8";Xh().appendChild(n)}))},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Gh("Browser");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh="type.googleapis.com/google.protobuf.Int64Value";const Jh="type.googleapis.com/google.protobuf.UInt64Value";function Kh(t,e){const i={};for(const n in t){if(t.hasOwnProperty(n)){i[n]=e(t[n])}}return i}function Qh(t){if(t==null){return null}if(t instanceof Number){t=t.valueOf()}if(typeof t==="number"&&isFinite(t)){return t}if(t===true||t===false){return t}if(Object.prototype.toString.call(t)==="[object String]"){return t}if(t instanceof Date){return t.toISOString()}if(Array.isArray(t)){return t.map((t=>Qh(t)))}if(typeof t==="function"||typeof t==="object"){return Kh(t,(t=>Qh(t)))}throw new Error("Data cannot be encoded in JSON: "+t)}function tc(t){if(t==null){return t}if(t["@type"]){switch(t["@type"]){case Zh:case Jh:{const e=Number(t["value"]);if(isNaN(e)){throw new Error("Data cannot be decoded from JSON: "+t)}return e}default:{throw new Error("Data cannot be decoded from JSON: "+t)}}}if(Array.isArray(t)){return t.map((t=>tc(t)))}if(typeof t==="function"||typeof t==="object"){return Kh(t,(t=>tc(t)))}return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ec="functions";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ic={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nc extends c{constructor(t,e,i){super(`${ec}/${t}`,e||"");this.details=i}}function sc(t){if(t>=200&&t<300){return"ok"}switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function rc(t,e){let i=sc(t);let n=i;let s=undefined;try{const t=e&&e.error;if(t){const e=t.status;if(typeof e==="string"){if(!ic[e]){return new nc("internal","internal")}i=ic[e];n=e}const r=t.message;if(typeof r==="string"){n=r}s=t.details;if(s!==undefined){s=tc(s)}}}catch(t){}if(i==="ok"){return null}return new nc(i,n,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(t,e,i){this.auth=null;this.messaging=null;this.appCheck=null;this.auth=t.getImmediate({optional:true});this.messaging=e.getImmediate({optional:true});if(!this.auth){t.get().then((t=>this.auth=t),(()=>{}))}if(!this.messaging){e.get().then((t=>this.messaging=t),(()=>{}))}if(!this.appCheck){i.get().then((t=>this.appCheck=t),(()=>{}))}}async getAuthToken(){if(!this.auth){return undefined}try{const t=await this.auth.getToken();return t===null||t===void 0?void 0:t.accessToken}catch(t){return undefined}}async getMessagingToken(){if(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"){return undefined}try{return await this.messaging.getToken()}catch(t){return undefined}}async getAppCheckToken(t){if(this.appCheck){const e=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();if(e.error){return null}return e.token}return null}async getContext(t){const e=await this.getAuthToken();const i=await this.getMessagingToken();const n=await this.getAppCheckToken(t);return{authToken:e,messagingToken:i,appCheckToken:n}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac="us-central1";function hc(t){let e=null;return{promise:new Promise(((i,n)=>{e=setTimeout((()=>{n(new nc("deadline-exceeded","deadline-exceeded"))}),t)})),cancel:()=>{if(e){clearTimeout(e)}}}}class cc{constructor(t,e,i,n,s=ac,r){this.app=t;this.fetchImpl=r;this.emulatorOrigin=null;this.contextProvider=new oc(e,i,n);this.cancelAllRequests=new Promise((t=>{this.deleteService=()=>Promise.resolve(t())}));try{const t=new URL(s);this.customDomain=t.origin+(t.pathname==="/"?"":t.pathname);this.region=ac}catch(t){this.customDomain=null;this.region=s}}_delete(){return this.deleteService()}_url(t){const e=this.app.options.projectId;if(this.emulatorOrigin!==null){const i=this.emulatorOrigin;return`${i}/${e}/${this.region}/${t}`}if(this.customDomain!==null){return`${this.customDomain}/${t}`}return`https://${this.region}-${e}.cloudfunctions.net/${t}`}}function uc(t,e,i){t.emulatorOrigin=`http://${e}:${i}`}function lc(t,e,i){return n=>dc(t,e,n,i||{})}async function fc(t,e,i,n){i["Content-Type"]="application/json";let s;try{s=await n(t,{method:"POST",body:JSON.stringify(e),headers:i})}catch(t){return{status:0,json:null}}let r=null;try{r=await s.json()}catch(t){}return{status:s.status,json:r}}function dc(t,e,i,n){const s=t._url(e);return pc(t,s,i,n)}async function pc(t,e,i,n){i=Qh(i);const s={data:i};const r={};const o=await t.contextProvider.getContext(n.limitedUseAppCheckTokens);if(o.authToken){r["Authorization"]="Bearer "+o.authToken}if(o.messagingToken){r["Firebase-Instance-ID-Token"]=o.messagingToken}if(o.appCheckToken!==null){r["X-Firebase-AppCheck"]=o.appCheckToken}const a=n.timeout||7e4;const h=hc(a);const c=await Promise.race([fc(e,s,r,t.fetchImpl),h.promise,t.cancelAllRequests]);h.cancel();if(!c){throw new nc("cancelled","Firebase Functions instance was deleted.")}const u=rc(c.status,c.json);if(u){throw u}if(!c.json){throw new nc("internal","Response is not valid JSON object.")}let l=c.json.data;if(typeof l==="undefined"){l=c.json.result}if(typeof l==="undefined"){throw new nc("internal","Response is missing data field.")}const f=tc(l);return{data:f}}const mc="@firebase/functions";const _c="0.11.7";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vc="auth-internal";const gc="app-check-internal";const bc="messaging-internal";function wc(e,i){const n=(t,{instanceIdentifier:i})=>{const n=t.getProvider("app").getImmediate();const s=t.getProvider(vc);const r=t.getProvider(bc);const o=t.getProvider(gc);return new cc(n,s,r,o,i,e)};r(new o(ec,n,"PUBLIC").setMultipleInstances(true));t(mc,_c,i);t(mc,_c,"esm2017")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yc(t=e(),r=ac){const o=n(i(t),ec);const a=o.getImmediate({identifier:r});const h=s("functions");if(h){xc(a,...h)}return a}function xc(t,e,n){uc(i(t),e,n)}function Mc(t,e,n){return lc(i(t),e,n)}wc(fetch.bind(self));const Tc="@firebase/installations";const Oc="0.6.8";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec=1e4;const Ac=`w:${Oc}`;const Sc="FIS_v2";const kc="https://firebaseinstallations.googleapis.com/v1";const Ic=60*60*1e3;const Cc="installations";const jc="Installations";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."};const Rc=new _(Cc,jc,Dc);function Pc(t){return t instanceof c&&t.code.includes("request-failed")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nc({projectId:t}){return`${kc}/projects/${t}/installations`}function Fc(t){return{token:t.token,requestStatus:2,expiresIn:Bc(t.expiresIn),creationTime:Date.now()}}async function zc(t,e){const i=await e.json();const n=i.error;return Rc.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Lc({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function $c(t,{refreshToken:e}){const i=Lc(t);i.append("Authorization",Gc(e));return i}async function Uc(t){const e=await t();if(e.status>=500&&e.status<600){return t()}return e}function Bc(t){return Number(t.replace("s","000"))}function Gc(t){return`${Sc} ${t}`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hc({appConfig:t,heartbeatServiceProvider:e},{fid:i}){const n=Nc(t);const s=Lc(t);const r=e.getImmediate({optional:true});if(r){const t=await r.getHeartbeatsHeader();if(t){s.append("x-firebase-client",t)}}const o={fid:i,authVersion:Sc,appId:t.appId,sdkVersion:Ac};const a={method:"POST",headers:s,body:JSON.stringify(o)};const h=await Uc((()=>fetch(n,a)));if(h.ok){const t=await h.json();const e={fid:t.fid||i,registrationStatus:2,refreshToken:t.refreshToken,authToken:Fc(t.authToken)};return e}else{throw await zc("Create Installation",h)}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vc(t){return new Promise((e=>{setTimeout(e,t)}))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wc(t){const e=btoa(String.fromCharCode(...t));return e.replace(/\+/g,"-").replace(/\//g,"_")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc=/^[cdef][\w-]{21}$/;const Yc="";function Xc(){try{const t=new Uint8Array(17);const e=self.crypto||self.msCrypto;e.getRandomValues(t);t[0]=112+t[0]%16;const i=Zc(t);return qc.test(i)?i:Yc}catch(t){return Yc}}function Zc(t){const e=Wc(t);return e.substr(0,22)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jc(t){return`${t.appName}!${t.appId}`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kc=new Map;function Qc(t,e){const i=Jc(t);tu(i,e);eu(i,e)}function tu(t,e){const i=Kc.get(t);if(!i){return}for(const t of i){t(e)}}function eu(t,e){const i=nu();if(i){i.postMessage({key:t,fid:e})}su()}let iu=null;function nu(){if(!iu&&"BroadcastChannel"in self){iu=new BroadcastChannel("[Firebase] FID Change");iu.onmessage=t=>{tu(t.data.key,t.data.fid)}}return iu}function su(){if(Kc.size===0&&iu){iu.close();iu=null}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru="firebase-installations-database";const ou=1;const au="firebase-installations-store";let hu=null;function cu(){if(!hu){hu=S(ru,ou,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(au)}}})}return hu}async function uu(t,e){const i=Jc(t);const n=await cu();const s=n.transaction(au,"readwrite");const r=s.objectStore(au);const o=await r.get(i);await r.put(e,i);await s.done;if(!o||o.fid!==e.fid){Qc(t,e.fid)}return e}async function lu(t){const e=Jc(t);const i=await cu();const n=i.transaction(au,"readwrite");await n.objectStore(au).delete(e);await n.done}async function fu(t,e){const i=Jc(t);const n=await cu();const s=n.transaction(au,"readwrite");const r=s.objectStore(au);const o=await r.get(i);const a=e(o);if(a===undefined){await r.delete(i)}else{await r.put(a,i)}await s.done;if(a&&(!o||o.fid!==a.fid)){Qc(t,a.fid)}return a}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function du(t){let e;const i=await fu(t.appConfig,(i=>{const n=pu(i);const s=mu(t,n);e=s.registrationPromise;return s.installationEntry}));if(i.fid===Yc){return{installationEntry:await e}}return{installationEntry:i,registrationPromise:e}}function pu(t){const e=t||{fid:Xc(),registrationStatus:0};return bu(e)}function mu(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const t=Promise.reject(Rc.create("app-offline"));return{installationEntry:e,registrationPromise:t}}const i={fid:e.fid,registrationStatus:1,registrationTime:Date.now()};const n=_u(t,i);return{installationEntry:i,registrationPromise:n}}else if(e.registrationStatus===1){return{installationEntry:e,registrationPromise:vu(t)}}else{return{installationEntry:e}}}async function _u(t,e){try{const i=await Hc(t,e);return uu(t.appConfig,i)}catch(i){if(Pc(i)&&i.customData.serverCode===409){await lu(t.appConfig)}else{await uu(t.appConfig,{fid:e.fid,registrationStatus:0})}throw i}}async function vu(t){let e=await gu(t.appConfig);while(e.registrationStatus===1){await Vc(100);e=await gu(t.appConfig)}if(e.registrationStatus===0){const{installationEntry:e,registrationPromise:i}=await du(t);if(i){return i}else{return e}}return e}function gu(t){return fu(t,(t=>{if(!t){throw Rc.create("installation-not-found")}return bu(t)}))}function bu(t){if(wu(t)){return{fid:t.fid,registrationStatus:0}}return t}function wu(t){return t.registrationStatus===1&&t.registrationTime+Ec<Date.now()}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yu({appConfig:t,heartbeatServiceProvider:e},i){const n=xu(t,i);const s=$c(t,i);const r=e.getImmediate({optional:true});if(r){const t=await r.getHeartbeatsHeader();if(t){s.append("x-firebase-client",t)}}const o={installation:{sdkVersion:Ac,appId:t.appId}};const a={method:"POST",headers:s,body:JSON.stringify(o)};const h=await Uc((()=>fetch(n,a)));if(h.ok){const t=await h.json();const e=Fc(t);return e}else{throw await zc("Generate Auth Token",h)}}function xu(t,{fid:e}){return`${Nc(t)}/${e}/authTokens:generate`}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mu(t,e=false){let i;const n=await fu(t.appConfig,(n=>{if(!Au(n)){throw Rc.create("not-registered")}const s=n.authToken;if(!e&&Su(s)){return n}else if(s.requestStatus===1){i=Tu(t,e);return n}else{if(!navigator.onLine){throw Rc.create("app-offline")}const e=Iu(n);i=Eu(t,e);return e}}));const s=i?await i:n.authToken;return s}async function Tu(t,e){let i=await Ou(t.appConfig);while(i.authToken.requestStatus===1){await Vc(100);i=await Ou(t.appConfig)}const n=i.authToken;if(n.requestStatus===0){return Mu(t,e)}else{return n}}function Ou(t){return fu(t,(t=>{if(!Au(t)){throw Rc.create("not-registered")}const e=t.authToken;if(Cu(e)){return Object.assign(Object.assign({},t),{authToken:{requestStatus:0}})}return t}))}async function Eu(t,e){try{const i=await yu(t,e);const n=Object.assign(Object.assign({},e),{authToken:i});await uu(t.appConfig,n);return i}catch(i){if(Pc(i)&&(i.customData.serverCode===401||i.customData.serverCode===404)){await lu(t.appConfig)}else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await uu(t.appConfig,i)}throw i}}function Au(t){return t!==undefined&&t.registrationStatus===2}function Su(t){return t.requestStatus===2&&!ku(t)}function ku(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Ic}function Iu(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function Cu(t){return t.requestStatus===1&&t.requestTime+Ec<Date.now()}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ju(t){const e=t;const{installationEntry:i,registrationPromise:n}=await du(e);if(n){n.catch(console.error)}else{Mu(e).catch(console.error)}return i.fid}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Du(t,e=false){const i=t;await Ru(i);const n=await Mu(i,e);return n.token}async function Ru(t){const{registrationPromise:e}=await du(t);if(e){await e}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pu(t){if(!t||!t.options){throw Nu("App Configuration")}if(!t.name){throw Nu("App Name")}const e=["projectId","apiKey","appId"];for(const i of e){if(!t.options[i]){throw Nu(i)}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Nu(t){return Rc.create("missing-app-config-values",{valueName:t})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fu="installations";const zu="installations-internal";const Lu=t=>{const e=t.getProvider("app").getImmediate();const i=Pu(e);const s=n(e,"heartbeat");const r={app:e,appConfig:i,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()};return r};const $u=t=>{const e=t.getProvider("app").getImmediate();const i=n(e,Fu).getImmediate();const s={getId:()=>ju(i),getToken:t=>Du(i,t)};return s};function Uu(){r(new o(Fu,Lu,"PUBLIC"));r(new o(zu,$u,"PRIVATE"))}Uu();t(Tc,Oc);t(Tc,Oc,"esm2017");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bu="analytics";const Gu="firebase_id";const Hu="origin";const Vu=60*1e3;const Wu="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig";const qu="https://www.googletagmanager.com/gtag/js";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yu=new M("@firebase/analytics");
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xu={["already-exists"]:"A Firebase Analytics instance with the appId {$id} "+" already exists. "+"Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those "+"it was initially called with. It can be called again with the same options to "+"return the existing instance, or getAnalytics() can be used "+"to get a reference to the already-initialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized."+"settings() must be called before initializing any Analytics instance"+"or it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. "+"Wrap initialization of analytics in analytics.isSupported() "+"to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. "+"Wrap initialization of analytics in analytics.isSupported() "+"to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state."+" Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field to'+"contain a valid API key.",["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field to'+"contain a valid app ID.",["no-client-id"]:'The "client_id" field is empty.',["invalid-gtag-resource"]:"Trusted Types detected an invalid gtag resource: {$gtagURL}."};const Zu=new _("analytics","Analytics",Xu);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ju(t){if(!t.startsWith(qu)){const e=Zu.create("invalid-gtag-resource",{gtagURL:t});Yu.warn(e.message);return""}return t}function Ku(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}function Qu(t,e){let i;if(window.trustedTypes){i=window.trustedTypes.createPolicy(t,e)}return i}function tl(t,e){const i=Qu("firebase-js-sdk-policy",{createScriptURL:Ju});const n=document.createElement("script");const s=`${qu}?l=${t}&id=${e}`;n.src=i?i===null||i===void 0?void 0:i.createScriptURL(s):s;n.async=true;document.head.appendChild(n)}function el(t){let e=[];if(Array.isArray(window[t])){e=window[t]}else{window[t]=e}return e}async function il(t,e,i,n,s,r){const o=n[s];try{if(o){await e[o]}else{const t=await Ku(i);const n=t.find((t=>t.measurementId===s));if(n){await e[n.appId]}}}catch(t){Yu.error(t)}t("config",s,r)}async function nl(t,e,i,n,s){try{let r=[];if(s&&s["send_to"]){let t=s["send_to"];if(!Array.isArray(t)){t=[t]}const n=await Ku(i);for(const i of t){const t=n.find((t=>t.measurementId===i));const s=t&&e[t.appId];if(s){r.push(s)}else{r=[];break}}}if(r.length===0){r=Object.values(e)}await Promise.all(r);t("event",n,s||{})}catch(t){Yu.error(t)}}function sl(t,e,i,n){async function s(s,...r){try{if(s==="event"){const[n,s]=r;await nl(t,e,i,n,s)}else if(s==="config"){const[s,o]=r;await il(t,e,i,n,s,o)}else if(s==="consent"){const[e,i]=r;t("consent",e,i)}else if(s==="get"){const[e,i,n]=r;t("get",e,i,n)}else if(s==="set"){const[e]=r;t("set",e)}else{t(s,...r)}}catch(t){Yu.error(t)}}return s}function rl(t,e,i,n,s){let r=function(...t){window[n].push(arguments)};if(window[s]&&typeof window[s]==="function"){r=window[s]}window[s]=sl(r,t,e,i);return{gtagCore:r,wrappedGtag:window[s]}}function ol(t){const e=window.document.getElementsByTagName("script");for(const i of Object.values(e)){if(i.src&&i.src.includes(qu)&&i.src.includes(t)){return i}}return null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const al=30;const hl=1e3;class cl{constructor(t={},e=hl){this.throttleMetadata=t;this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}}const ul=new cl;function ll(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function fl(t){var e;const{appId:i,apiKey:n}=t;const s={method:"GET",headers:ll(n)};const r=Wu.replace("{app-id}",i);const o=await fetch(r,s);if(o.status!==200&&o.status!==304){let t="";try{const i=await o.json();if((e=i.error)===null||e===void 0?void 0:e.message){t=i.error.message}}catch(t){}throw Zu.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}async function dl(t,e=ul,i){const{appId:n,apiKey:s,measurementId:r}=t.options;if(!n){throw Zu.create("no-app-id")}if(!s){if(r){return{measurementId:r,appId:n}}throw Zu.create("no-api-key")}const o=e.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const a=new vl;setTimeout((async()=>{a.abort()}),i!==undefined?i:Vu);return pl({appId:n,apiKey:s,measurementId:r},o,a,e)}async function pl(t,{throttleEndTimeMillis:e,backoffCount:i},n,s=ul){var r;const{appId:o,measurementId:a}=t;try{await ml(n,e)}catch(t){if(a){Yu.warn(`Timed out fetching this Firebase app's measurement ID from the server.`+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${t===null||t===void 0?void 0:t.message}]`);return{appId:o,measurementId:a}}throw t}try{const e=await fl(t);s.deleteThrottleMetadata(o);return e}catch(e){const h=e;if(!_l(h)){s.deleteThrottleMetadata(o);if(a){Yu.warn(`Failed to fetch this Firebase app's measurement ID from the server.`+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${h===null||h===void 0?void 0:h.message}]`);return{appId:o,measurementId:a}}else{throw e}}const c=Number((r=h===null||h===void 0?void 0:h.customData)===null||r===void 0?void 0:r.httpStatus)===503?j(i,s.intervalMillis,al):j(i,s.intervalMillis);const u={throttleEndTimeMillis:Date.now()+c,backoffCount:i+1};s.setThrottleMetadata(o,u);Yu.debug(`Calling attemptFetch again in ${c} millis`);return pl(t,u,n,s)}}function ml(t,e){return new Promise(((i,n)=>{const s=Math.max(e-Date.now(),0);const r=setTimeout(i,s);t.addEventListener((()=>{clearTimeout(r);n(Zu.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}function _l(t){if(!(t instanceof c)||!t.customData){return false}const e=Number(t.customData["httpStatus"]);return e===429||e===500||e===503||e===504}class vl{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}async function gl(t,e,i,n,s){if(s&&s.global){t("event",i,n);return}else{const s=await e;const r=Object.assign(Object.assign({},n),{send_to:s});t("event",i,r)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bl(){if(!k()){Yu.warn(Zu.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message);return false}else{try{await I()}catch(t){Yu.warn(Zu.create("indexeddb-unavailable",{errorInfo:t===null||t===void 0?void 0:t.toString()}).message);return false}}return true}async function wl(t,e,i,n,s,r,o){var a;const h=dl(t);h.then((e=>{i[e.measurementId]=e.appId;if(t.options.measurementId&&e.measurementId!==t.options.measurementId){Yu.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+` To ensure analytics events are always sent to the correct Analytics property,`+` update the`+` measurement ID field in the local config or remove it from the local config.`)}})).catch((t=>Yu.error(t)));e.push(h);const c=bl().then((t=>{if(t){return n.getId()}else{return undefined}}));const[u,l]=await Promise.all([h,c]);if(!ol(r)){tl(r,u.measurementId)}s("js",new Date);const f=(a=o===null||o===void 0?void 0:o.config)!==null&&a!==void 0?a:{};f[Hu]="firebase";f.update=true;if(l!=null){f[Gu]=l}s("config",u.measurementId,f);return u.measurementId}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(t){this.app=t}_delete(){delete xl[this.app.options.appId];return Promise.resolve()}}let xl={};let Ml=[];const Tl={};let Ol="dataLayer";let El="gtag";let Al;let Sl;let kl=false;function Il(){const t=[];if(v()){t.push("This is a browser extension environment.")}if(!C()){t.push("Cookies are not available.")}if(t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" ");const i=Zu.create("invalid-analytics-context",{errorInfo:e});Yu.warn(i.message)}}function Cl(t,e,i){Il();const n=t.options.appId;if(!n){throw Zu.create("no-app-id")}if(!t.options.apiKey){if(t.options.measurementId){Yu.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest`+` measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId}`+` provided in the "measurementId" field in the local Firebase config.`)}else{throw Zu.create("no-api-key")}}if(xl[n]!=null){throw Zu.create("already-exists",{id:n})}if(!kl){el(Ol);const{wrappedGtag:t,gtagCore:e}=rl(xl,Ml,Tl,Ol,El);Sl=t;Al=e;kl=true}xl[n]=wl(t,Ml,Tl,e,Al,Ol,i);const s=new yl(t);return s}function jl(t=e()){t=i(t);const s=n(t,Bu);if(s.isInitialized()){return s.getImmediate()}return Dl(t)}function Dl(t,e={}){const i=n(t,Bu);if(i.isInitialized()){const t=i.getImmediate();if(b(e,i.getOptions())){return t}else{throw Zu.create("already-initialized")}}const s=i.initialize({options:e});return s}function Rl(t,e,n,s){t=i(t);gl(Sl,xl[t.app.options.appId],e,n,s).catch((t=>Yu.error(t)))}const Pl="@firebase/analytics";const Nl="0.10.7";function Fl(){r(new o(Bu,((t,{options:e})=>{const i=t.getProvider("app").getImmediate();const n=t.getProvider("installations-internal").getImmediate();return Cl(i,n,e)}),"PUBLIC"));r(new o("analytics-internal",e,"PRIVATE"));t(Pl,Nl);t(Pl,Nl,"esm2017");function e(t){try{const e=t.getProvider(Bu).getImmediate();return{logEvent:(t,i,n)=>Rl(e,t,i,n)}}catch(t){throw Zu.create("interop-component-reg-failed",{reason:t})}}}Fl();const zl=D(ht.getFirebaseSettings());function Ll(){let t;if(ct.isNativePlatform()&&ct.getPlatform()!=="electron"){t=Ys(zl,{persistence:ca})}else{t=Yh(zl)}return t}const $l=Ll();R(zl,{localCache:P({tabManager:F(),cacheSizeBytes:z})});const Ul=N(zl);const Bl=tn(zl);const Gl=yc(zl,"europe-west1");const Hl=null;jl(zl);var Vl={};var Wl={};var ql={};var Yl={};Yl.toDate=Xl;function Xl(t){const e=Object.prototype.toString.call(t);if(t instanceof Date||typeof t==="object"&&e==="[object Date]"){return new t.constructor(+t)}else if(typeof t==="number"||e==="[object Number]"||typeof t==="string"||e==="[object String]"){return new Date(t)}else{return new Date(NaN)}}var Zl={};Zl.constructFrom=Jl;function Jl(t,e){if(t instanceof Date){return new t.constructor(e)}else{return new Date(e)}}ql.addDays=tf;var Kl=Yl;var Ql=Zl;function tf(t,e){const i=(0,Kl.toDate)(t);if(isNaN(e))return(0,Ql.constructFrom)(t,NaN);if(!e){return i}i.setDate(i.getDate()+e);return i}var ef={};ef.addMonths=rf;var nf=Yl;var sf=Zl;function rf(t,e){const i=(0,nf.toDate)(t);if(isNaN(e))return(0,sf.constructFrom)(t,NaN);if(!e){return i}const n=i.getDate();const s=(0,sf.constructFrom)(t,i.getTime());s.setMonth(i.getMonth()+e+1,0);const r=s.getDate();if(n>=r){return s}else{i.setFullYear(s.getFullYear(),s.getMonth(),n);return i}}Wl.add=uf;var of=ql;var af=ef;var hf=Zl;var cf=Yl;function uf(t,e){const{years:i=0,months:n=0,weeks:s=0,days:r=0,hours:o=0,minutes:a=0,seconds:h=0}=e;const c=(0,cf.toDate)(t);const u=n||i?(0,af.addMonths)(c,n+i*12):c;const l=r||s?(0,of.addDays)(u,r+s*7):u;const f=a+o*60;const d=h+f*60;const p=d*1e3;const m=(0,hf.constructFrom)(t,l.getTime()+p);return m}var lf={};var ff={};ff.isSaturday=pf;var df=Yl;function pf(t){return(0,df.toDate)(t).getDay()===6}var mf={};mf.isSunday=vf;var _f=Yl;function vf(t){return(0,_f.toDate)(t).getDay()===0}var gf={};gf.isWeekend=wf;var bf=Yl;function wf(t){const e=(0,bf.toDate)(t).getDay();return e===0||e===6}lf.addBusinessDays=Ef;var yf=Zl;var xf=ff;var Mf=mf;var Tf=gf;var Of=Yl;function Ef(t,e){const i=(0,Of.toDate)(t);const n=(0,Tf.isWeekend)(i);if(isNaN(e))return(0,yf.constructFrom)(t,NaN);const s=i.getHours();const r=e<0?-1:1;const o=Math.trunc(e/5);i.setDate(i.getDate()+o*7);let a=Math.abs(e%5);while(a>0){i.setDate(i.getDate()+r);if(!(0,Tf.isWeekend)(i))a-=1}if(n&&(0,Tf.isWeekend)(i)&&e!==0){if((0,xf.isSaturday)(i))i.setDate(i.getDate()+(r<0?2:-1));if((0,Mf.isSunday)(i))i.setDate(i.getDate()+(r<0?1:-2))}i.setHours(s);return i}var Af={};var Sf={};Sf.addMilliseconds=Cf;var kf=Yl;var If=Zl;function Cf(t,e){const i=+(0,kf.toDate)(t);return(0,If.constructFrom)(t,i+e)}var jf={};jf.secondsInYear=jf.secondsInWeek=jf.secondsInQuarter=jf.secondsInMonth=jf.secondsInMinute=jf.secondsInHour=jf.secondsInDay=jf.quartersInYear=jf.monthsInYear=jf.monthsInQuarter=jf.minutesInYear=jf.minutesInMonth=jf.minutesInHour=jf.minutesInDay=jf.minTime=jf.millisecondsInWeek=jf.millisecondsInSecond=jf.millisecondsInMinute=jf.millisecondsInHour=jf.millisecondsInDay=jf.maxTime=jf.daysInYear=jf.daysInWeek=void 0;jf.daysInWeek=7;const Df=jf.daysInYear=365.2425;const Rf=jf.maxTime=Math.pow(10,8)*24*60*60*1e3;jf.minTime=-Rf;jf.millisecondsInWeek=6048e5;jf.millisecondsInDay=864e5;jf.millisecondsInMinute=6e4;jf.millisecondsInHour=36e5;jf.millisecondsInSecond=1e3;jf.minutesInYear=525600;jf.minutesInMonth=43200;jf.minutesInDay=1440;jf.minutesInHour=60;jf.monthsInQuarter=3;jf.monthsInYear=12;jf.quartersInYear=4;const Pf=jf.secondsInHour=3600;jf.secondsInMinute=60;const Nf=jf.secondsInDay=Pf*24;jf.secondsInWeek=Nf*7;const Ff=jf.secondsInYear=Nf*Df;const zf=jf.secondsInMonth=Ff/12;jf.secondsInQuarter=zf*3;Af.addHours=Uf;var Lf=Sf;var $f=jf;function Uf(t,e){return(0,Lf.addMilliseconds)(t,e*$f.millisecondsInHour)}var Bf={};var Gf={};var Hf={};var Vf={};var Wf={};Wf.getDefaultOptions=Yf;Wf.setDefaultOptions=Xf;let qf={};function Yf(){return qf}function Xf(t){qf=t}Vf.startOfWeek=Kf;var Zf=Yl;var Jf=Wf;function Kf(t,e){const i=(0,Jf.getDefaultOptions)();const n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0;const s=(0,Zf.toDate)(t);const r=s.getDay();const o=(r<n?7:0)+r-n;s.setDate(s.getDate()-o);s.setHours(0,0,0,0);return s}Hf.startOfISOWeek=td;var Qf=Vf;function td(t){return(0,Qf.startOfWeek)(t,{weekStartsOn:1})}Gf.getISOWeekYear=sd;var ed=Zl;var id=Hf;var nd=Yl;function sd(t){const e=(0,nd.toDate)(t);const i=e.getFullYear();const n=(0,ed.constructFrom)(t,0);n.setFullYear(i+1,0,4);n.setHours(0,0,0,0);const s=(0,id.startOfISOWeek)(n);const r=(0,ed.constructFrom)(t,0);r.setFullYear(i,0,4);r.setHours(0,0,0,0);const o=(0,id.startOfISOWeek)(r);if(e.getTime()>=s.getTime()){return i+1}else if(e.getTime()>=o.getTime()){return i}else{return i-1}}var rd={};var od={};var ad={};ad.startOfDay=cd;var hd=Yl;function cd(t){const e=(0,hd.toDate)(t);e.setHours(0,0,0,0);return e}var ud={};ud.getTimezoneOffsetInMilliseconds=fd;var ld=Yl;function fd(t){const e=(0,ld.toDate)(t);const i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));i.setUTCFullYear(e.getFullYear());return+t-+i}od.differenceInCalendarDays=_d;var dd=jf;var pd=ad;var md=ud;function _d(t,e){const i=(0,pd.startOfDay)(t);const n=(0,pd.startOfDay)(e);const s=+i-(0,md.getTimezoneOffsetInMilliseconds)(i);const r=+n-(0,md.getTimezoneOffsetInMilliseconds)(n);return Math.round((s-r)/dd.millisecondsInDay)}var vd={};vd.startOfISOWeekYear=yd;var gd=Gf;var bd=Hf;var wd=Zl;function yd(t){const e=(0,gd.getISOWeekYear)(t);const i=(0,wd.constructFrom)(t,0);i.setFullYear(e,0,4);i.setHours(0,0,0,0);return(0,bd.startOfISOWeek)(i)}rd.setISOWeekYear=Ed;var xd=Zl;var Md=od;var Td=vd;var Od=Yl;function Ed(t,e){let i=(0,Od.toDate)(t);const n=(0,Md.differenceInCalendarDays)(i,(0,Td.startOfISOWeekYear)(i));const s=(0,xd.constructFrom)(t,0);s.setFullYear(e,0,4);s.setHours(0,0,0,0);i=(0,Td.startOfISOWeekYear)(s);i.setDate(i.getDate()+n);return i}Bf.addISOWeekYears=kd;var Ad=Gf;var Sd=rd;function kd(t,e){return(0,Sd.setISOWeekYear)(t,(0,Ad.getISOWeekYear)(t)+e)}var Id={};Id.addMinutes=Dd;var Cd=Sf;var jd=jf;function Dd(t,e){return(0,Cd.addMilliseconds)(t,e*jd.millisecondsInMinute)}var Rd={};Rd.addQuarters=Nd;var Pd=ef;function Nd(t,e){const i=e*3;return(0,Pd.addMonths)(t,i)}var Fd={};Fd.addSeconds=Ld;var zd=Sf;function Ld(t,e){return(0,zd.addMilliseconds)(t,e*1e3)}var $d={};$d.addWeeks=Bd;var Ud=ql;function Bd(t,e){const i=e*7;return(0,Ud.addDays)(t,i)}var Gd={};Gd.addYears=Vd;var Hd=ef;function Vd(t,e){return(0,Hd.addMonths)(t,e*12)}var Wd={};Wd.areIntervalsOverlapping=Yd;var qd=Yl;function Yd(t,e,i){const[n,s]=[+(0,qd.toDate)(t.start),+(0,qd.toDate)(t.end)].sort(((t,e)=>t-e));const[r,o]=[+(0,qd.toDate)(e.start),+(0,qd.toDate)(e.end)].sort(((t,e)=>t-e));if(i?.inclusive)return n<=o&&r<=s;return n<o&&r<s}var Xd={};var Zd={};Zd.max=Kd;var Jd=Yl;function Kd(t){let e;t.forEach((function(t){const i=(0,Jd.toDate)(t);if(e===undefined||e<i||isNaN(Number(i))){e=i}}));return e||new Date(NaN)}var Qd={};Qd.min=ep;var tp=Yl;function ep(t){let e;t.forEach((t=>{const i=(0,tp.toDate)(t);if(!e||e>i||isNaN(+i)){e=i}}));return e||new Date(NaN)}Xd.clamp=sp;var ip=Zd;var np=Qd;function sp(t,e){return(0,np.min)([(0,ip.max)([t,e.start]),e.end])}var rp={};rp.closestIndexTo=ap;var op=Yl;function ap(t,e){const i=(0,op.toDate)(t);if(isNaN(Number(i)))return NaN;const n=i.getTime();let s;let r;e.forEach((function(t,e){const i=(0,op.toDate)(t);if(isNaN(Number(i))){s=NaN;r=NaN;return}const o=Math.abs(n-i.getTime());if(s==null||o<r){s=e;r=o}}));return s}var hp={};hp.closestTo=lp;var cp=Zl;var up=Yl;function lp(t,e){const i=(0,up.toDate)(t);if(isNaN(Number(i)))return(0,cp.constructFrom)(t,NaN);const n=i.getTime();let s;let r;e.forEach((e=>{const i=(0,up.toDate)(e);if(isNaN(Number(i))){s=(0,cp.constructFrom)(t,NaN);r=NaN;return}const o=Math.abs(n-i.getTime());if(s==null||o<r){s=i;r=o}}));return s}var fp={};fp.compareAsc=pp;var dp=Yl;function pp(t,e){const i=(0,dp.toDate)(t);const n=(0,dp.toDate)(e);const s=i.getTime()-n.getTime();if(s<0){return-1}else if(s>0){return 1}else{return s}}var mp={};mp.compareDesc=vp;var _p=Yl;function vp(t,e){const i=(0,_p.toDate)(t);const n=(0,_p.toDate)(e);const s=i.getTime()-n.getTime();if(s>0){return-1}else if(s<0){return 1}else{return s}}var gp={};gp.constructNow=wp;var bp=Zl;function wp(t){return(0,bp.constructFrom)(t,Date.now())}var yp={};yp.daysToWeeks=Mp;var xp=jf;function Mp(t){const e=t/xp.daysInWeek;const i=Math.trunc(e);return i===0?0:i}var Tp={};var Op={};Op.isSameDay=Ap;var Ep=ad;function Ap(t,e){const i=(0,Ep.startOfDay)(t);const n=(0,Ep.startOfDay)(e);return+i===+n}var Sp={};var kp={};kp.isDate=Ip;function Ip(t){return t instanceof Date||typeof t==="object"&&Object.prototype.toString.call(t)==="[object Date]"}Sp.isValid=Dp;var Cp=kp;var jp=Yl;function Dp(t){if(!(0,Cp.isDate)(t)&&typeof t!=="number"){return false}const e=(0,jp.toDate)(t);return!isNaN(Number(e))}Tp.differenceInBusinessDays=$p;var Rp=ql;var Pp=od;var Np=Op;var Fp=Sp;var zp=gf;var Lp=Yl;function $p(t,e){const i=(0,Lp.toDate)(t);let n=(0,Lp.toDate)(e);if(!(0,Fp.isValid)(i)||!(0,Fp.isValid)(n))return NaN;const s=(0,Pp.differenceInCalendarDays)(i,n);const r=s<0?-1:1;const o=Math.trunc(s/7);let a=o*5;n=(0,Rp.addDays)(n,o*7);while(!(0,Np.isSameDay)(i,n)){a+=(0,zp.isWeekend)(n)?0:r;n=(0,Rp.addDays)(n,r)}return a===0?0:a}var Up={};Up.differenceInCalendarISOWeekYears=Gp;var Bp=Gf;function Gp(t,e){return(0,Bp.getISOWeekYear)(t)-(0,Bp.getISOWeekYear)(e)}var Hp={};Hp.differenceInCalendarISOWeeks=Yp;var Vp=jf;var Wp=Hf;var qp=ud;function Yp(t,e){const i=(0,Wp.startOfISOWeek)(t);const n=(0,Wp.startOfISOWeek)(e);const s=+i-(0,qp.getTimezoneOffsetInMilliseconds)(i);const r=+n-(0,qp.getTimezoneOffsetInMilliseconds)(n);return Math.round((s-r)/Vp.millisecondsInWeek)}var Xp={};Xp.differenceInCalendarMonths=Jp;var Zp=Yl;function Jp(t,e){const i=(0,Zp.toDate)(t);const n=(0,Zp.toDate)(e);const s=i.getFullYear()-n.getFullYear();const r=i.getMonth()-n.getMonth();return s*12+r}var Kp={};var Qp={};Qp.getQuarter=em;var tm=Yl;function em(t){const e=(0,tm.toDate)(t);const i=Math.trunc(e.getMonth()/3)+1;return i}Kp.differenceInCalendarQuarters=sm;var im=Qp;var nm=Yl;function sm(t,e){const i=(0,nm.toDate)(t);const n=(0,nm.toDate)(e);const s=i.getFullYear()-n.getFullYear();const r=(0,im.getQuarter)(i)-(0,im.getQuarter)(n);return s*4+r}var rm={};rm.differenceInCalendarWeeks=cm;var om=jf;var am=Vf;var hm=ud;function cm(t,e,i){const n=(0,am.startOfWeek)(t,i);const s=(0,am.startOfWeek)(e,i);const r=+n-(0,hm.getTimezoneOffsetInMilliseconds)(n);const o=+s-(0,hm.getTimezoneOffsetInMilliseconds)(s);return Math.round((r-o)/om.millisecondsInWeek)}var um={};um.differenceInCalendarYears=fm;var lm=Yl;function fm(t,e){const i=(0,lm.toDate)(t);const n=(0,lm.toDate)(e);return i.getFullYear()-n.getFullYear()}var dm={};dm.differenceInDays=_m;var pm=od;var mm=Yl;function _m(t,e){const i=(0,mm.toDate)(t);const n=(0,mm.toDate)(e);const s=vm(i,n);const r=Math.abs((0,pm.differenceInCalendarDays)(i,n));i.setDate(i.getDate()-s*r);const o=Number(vm(i,n)===-s);const a=s*(r-o);return a===0?0:a}function vm(t,e){const i=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();if(i<0){return-1}else if(i>0){return 1}else{return i}}var gm={};var bm={};bm.getRoundingMethod=wm;function wm(t){return e=>{const i=t?Math[t]:Math.trunc;const n=i(e);return n===0?0:n}}var ym={};ym.differenceInMilliseconds=Mm;var xm=Yl;function Mm(t,e){return+(0,xm.toDate)(t)-+(0,xm.toDate)(e)}gm.differenceInHours=Am;var Tm=bm;var Om=jf;var Em=ym;function Am(t,e,i){const n=(0,Em.differenceInMilliseconds)(t,e)/Om.millisecondsInHour;return(0,Tm.getRoundingMethod)(i?.roundingMethod)(n)}var Sm={};var km={};km.subISOWeekYears=Cm;var Im=Bf;function Cm(t,e){return(0,Im.addISOWeekYears)(t,-e)}Sm.differenceInISOWeekYears=Nm;var jm=fp;var Dm=Up;var Rm=km;var Pm=Yl;function Nm(t,e){let i=(0,Pm.toDate)(t);const n=(0,Pm.toDate)(e);const s=(0,jm.compareAsc)(i,n);const r=Math.abs((0,Dm.differenceInCalendarISOWeekYears)(i,n));i=(0,Rm.subISOWeekYears)(i,s*r);const o=Number((0,jm.compareAsc)(i,n)===-s);const a=s*(r-o);return a===0?0:a}var Fm={};Fm.differenceInMinutes=Um;var zm=bm;var Lm=jf;var $m=ym;function Um(t,e,i){const n=(0,$m.differenceInMilliseconds)(t,e)/Lm.millisecondsInMinute;return(0,zm.getRoundingMethod)(i?.roundingMethod)(n)}var Bm={};var Gm={};var Hm={};Hm.endOfDay=Wm;var Vm=Yl;function Wm(t){const e=(0,Vm.toDate)(t);e.setHours(23,59,59,999);return e}var qm={};qm.endOfMonth=Xm;var Ym=Yl;function Xm(t){const e=(0,Ym.toDate)(t);const i=e.getMonth();e.setFullYear(e.getFullYear(),i+1,0);e.setHours(23,59,59,999);return e}Gm.isLastDayOfMonth=Qm;var Zm=Hm;var Jm=qm;var Km=Yl;function Qm(t){const e=(0,Km.toDate)(t);return+(0,Zm.endOfDay)(e)===+(0,Jm.endOfMonth)(e)}Bm.differenceInMonths=s_;var t_=fp;var e_=Xp;var i_=Gm;var n_=Yl;function s_(t,e){const i=(0,n_.toDate)(t);const n=(0,n_.toDate)(e);const s=(0,t_.compareAsc)(i,n);const r=Math.abs((0,e_.differenceInCalendarMonths)(i,n));let o;if(r<1){o=0}else{if(i.getMonth()===1&&i.getDate()>27){i.setDate(30)}i.setMonth(i.getMonth()-s*r);let e=(0,t_.compareAsc)(i,n)===-s;if((0,i_.isLastDayOfMonth)((0,n_.toDate)(t))&&r===1&&(0,t_.compareAsc)(t,n)===1){e=false}o=s*(r-Number(e))}return o===0?0:o}var r_={};r_.differenceInQuarters=h_;var o_=bm;var a_=Bm;function h_(t,e,i){const n=(0,a_.differenceInMonths)(t,e)/3;return(0,o_.getRoundingMethod)(i?.roundingMethod)(n)}var c_={};c_.differenceInSeconds=f_;var u_=bm;var l_=ym;function f_(t,e,i){const n=(0,l_.differenceInMilliseconds)(t,e)/1e3;return(0,u_.getRoundingMethod)(i?.roundingMethod)(n)}var d_={};d_.differenceInWeeks=__;var p_=bm;var m_=dm;function __(t,e,i){const n=(0,m_.differenceInDays)(t,e)/7;return(0,p_.getRoundingMethod)(i?.roundingMethod)(n)}var v_={};v_.differenceInYears=y_;var g_=fp;var b_=um;var w_=Yl;function y_(t,e){const i=(0,w_.toDate)(t);const n=(0,w_.toDate)(e);const s=(0,g_.compareAsc)(i,n);const r=Math.abs((0,b_.differenceInCalendarYears)(i,n));i.setFullYear(1584);n.setFullYear(1584);const o=(0,g_.compareAsc)(i,n)===-s;const a=s*(r-+o);return a===0?0:a}var x_={};x_.eachDayOfInterval=T_;var M_=Yl;function T_(t,e){const i=(0,M_.toDate)(t.start);const n=(0,M_.toDate)(t.end);let s=+i>+n;const r=s?+i:+n;const o=s?n:i;o.setHours(0,0,0,0);let a=e?.step??1;if(!a)return[];if(a<0){a=-a;s=!s}const h=[];while(+o<=r){h.push((0,M_.toDate)(o));o.setDate(o.getDate()+a);o.setHours(0,0,0,0)}return s?h.reverse():h}var O_={};O_.eachHourOfInterval=S_;var E_=Af;var A_=Yl;function S_(t,e){const i=(0,A_.toDate)(t.start);const n=(0,A_.toDate)(t.end);let s=+i>+n;const r=s?+i:+n;let o=s?n:i;o.setMinutes(0,0,0);let a=e?.step??1;if(!a)return[];if(a<0){a=-a;s=!s}const h=[];while(+o<=r){h.push((0,A_.toDate)(o));o=(0,E_.addHours)(o,a)}return s?h.reverse():h}var k_={};var I_={};I_.startOfMinute=j_;var C_=Yl;function j_(t){const e=(0,C_.toDate)(t);e.setSeconds(0,0);return e}k_.eachMinuteOfInterval=N_;var D_=Id;var R_=I_;var P_=Yl;function N_(t,e){const i=(0,R_.startOfMinute)((0,P_.toDate)(t.start));const n=(0,P_.toDate)(t.end);let s=+i>+n;const r=s?+i:+n;let o=s?n:i;let a=e?.step??1;if(!a)return[];if(a<0){a=-a;s=!s}const h=[];while(+o<=r){h.push((0,P_.toDate)(o));o=(0,D_.addMinutes)(o,a)}return s?h.reverse():h}var F_={};F_.eachMonthOfInterval=L_;var z_=Yl;function L_(t,e){const i=(0,z_.toDate)(t.start);const n=(0,z_.toDate)(t.end);let s=+i>+n;const r=s?+i:+n;const o=s?n:i;o.setHours(0,0,0,0);o.setDate(1);let a=e?.step??1;if(!a)return[];if(a<0){a=-a;s=!s}const h=[];while(+o<=r){h.push((0,z_.toDate)(o));o.setMonth(o.getMonth()+a)}return s?h.reverse():h}var $_={};var U_={};U_.startOfQuarter=G_;var B_=Yl;function G_(t){const e=(0,B_.toDate)(t);const i=e.getMonth();const n=i-i%3;e.setMonth(n,1);e.setHours(0,0,0,0);return e}$_.eachQuarterOfInterval=q_;var H_=Rd;var V_=U_;var W_=Yl;function q_(t,e){const i=(0,W_.toDate)(t.start);const n=(0,W_.toDate)(t.end);let s=+i>+n;const r=s?+(0,V_.startOfQuarter)(i):+(0,V_.startOfQuarter)(n);let o=s?(0,V_.startOfQuarter)(n):(0,V_.startOfQuarter)(i);let a=e?.step??1;if(!a)return[];if(a<0){a=-a;s=!s}const h=[];while(+o<=r){h.push((0,W_.toDate)(o));o=(0,H_.addQuarters)(o,a)}return s?h.reverse():h}var Y_={};Y_.eachWeekOfInterval=K_;var X_=$d;var Z_=Vf;var J_=Yl;function K_(t,e){const i=(0,J_.toDate)(t.start);const n=(0,J_.toDate)(t.end);let s=+i>+n;const r=s?(0,Z_.startOfWeek)(n,e):(0,Z_.startOfWeek)(i,e);const o=s?(0,Z_.startOfWeek)(i,e):(0,Z_.startOfWeek)(n,e);r.setHours(15);o.setHours(15);const a=+o.getTime();let h=r;let c=e?.step??1;if(!c)return[];if(c<0){c=-c;s=!s}const u=[];while(+h<=a){h.setHours(0);u.push((0,J_.toDate)(h));h=(0,X_.addWeeks)(h,c);h.setHours(15)}return s?u.reverse():u}var Q_={};Q_.eachWeekendOfInterval=iv;var tv=x_;var ev=gf;function iv(t){const e=(0,tv.eachDayOfInterval)(t);const i=[];let n=0;while(n<e.length){const t=e[n++];if((0,ev.isWeekend)(t))i.push(t)}return i}var nv={};var sv={};sv.startOfMonth=ov;var rv=Yl;function ov(t){const e=(0,rv.toDate)(t);e.setDate(1);e.setHours(0,0,0,0);return e}nv.eachWeekendOfMonth=uv;var av=Q_;var hv=qm;var cv=sv;function uv(t){const e=(0,cv.startOfMonth)(t);const i=(0,hv.endOfMonth)(t);return(0,av.eachWeekendOfInterval)({start:e,end:i})}var lv={};var fv={};fv.endOfYear=pv;var dv=Yl;function pv(t){const e=(0,dv.toDate)(t);const i=e.getFullYear();e.setFullYear(i+1,0,0);e.setHours(23,59,59,999);return e}var mv={};mv.startOfYear=gv;var _v=Yl;var vv=Zl;function gv(t){const e=(0,_v.toDate)(t);const i=(0,vv.constructFrom)(t,0);i.setFullYear(e.getFullYear(),0,1);i.setHours(0,0,0,0);return i}lv.eachWeekendOfYear=xv;var bv=Q_;var wv=fv;var yv=mv;function xv(t){const e=(0,yv.startOfYear)(t);const i=(0,wv.endOfYear)(t);return(0,bv.eachWeekendOfInterval)({start:e,end:i})}var Mv={};Mv.eachYearOfInterval=Ov;var Tv=Yl;function Ov(t,e){const i=(0,Tv.toDate)(t.start);const n=(0,Tv.toDate)(t.end);let s=+i>+n;const r=s?+i:+n;const o=s?n:i;o.setHours(0,0,0,0);o.setMonth(0,1);let a=e?.step??1;if(!a)return[];if(a<0){a=-a;s=!s}const h=[];while(+o<=r){h.push((0,Tv.toDate)(o));o.setFullYear(o.getFullYear()+a)}return s?h.reverse():h}var Ev={};Ev.endOfDecade=Sv;var Av=Yl;function Sv(t){const e=(0,Av.toDate)(t);const i=e.getFullYear();const n=9+Math.floor(i/10)*10;e.setFullYear(n,11,31);e.setHours(23,59,59,999);return e}var kv={};kv.endOfHour=Cv;var Iv=Yl;function Cv(t){const e=(0,Iv.toDate)(t);e.setMinutes(59,59,999);return e}var jv={};var Dv={};Dv.endOfWeek=Nv;var Rv=Yl;var Pv=Wf;function Nv(t,e){const i=(0,Pv.getDefaultOptions)();const n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0;const s=(0,Rv.toDate)(t);const r=s.getDay();const o=(r<n?-7:0)+6-(r-n);s.setDate(s.getDate()+o);s.setHours(23,59,59,999);return s}jv.endOfISOWeek=zv;var Fv=Dv;function zv(t){return(0,Fv.endOfWeek)(t,{weekStartsOn:1})}var Lv={};Lv.endOfISOWeekYear=Gv;var $v=Gf;var Uv=Hf;var Bv=Zl;function Gv(t){const e=(0,$v.getISOWeekYear)(t);const i=(0,Bv.constructFrom)(t,0);i.setFullYear(e+1,0,4);i.setHours(0,0,0,0);const n=(0,Uv.startOfISOWeek)(i);n.setMilliseconds(n.getMilliseconds()-1);return n}var Hv={};Hv.endOfMinute=Wv;var Vv=Yl;function Wv(t){const e=(0,Vv.toDate)(t);e.setSeconds(59,999);return e}var qv={};qv.endOfQuarter=Xv;var Yv=Yl;function Xv(t){const e=(0,Yv.toDate)(t);const i=e.getMonth();const n=i-i%3+3;e.setMonth(n,0);e.setHours(23,59,59,999);return e}var Zv={};Zv.endOfSecond=Kv;var Jv=Yl;function Kv(t){const e=(0,Jv.toDate)(t);e.setMilliseconds(999);return e}var Qv={};Qv.endOfToday=eg;var tg=Hm;function eg(){return(0,tg.endOfDay)(Date.now())}var ig={};ig.endOfTomorrow=ng;function ng(){const t=new Date;const e=t.getFullYear();const i=t.getMonth();const n=t.getDate();const s=new Date(0);s.setFullYear(e,i,n+1);s.setHours(23,59,59,999);return s}var sg={};sg.endOfYesterday=rg;function rg(){const t=new Date;const e=t.getFullYear();const i=t.getMonth();const n=t.getDate();const s=new Date(0);s.setFullYear(e,i,n-1);s.setHours(23,59,59,999);return s}var og={};var ag={};var hg={};var cg={};cg.formatDistance=void 0;const ug={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};const lg=(t,e,i)=>{let n;const s=ug[t];if(typeof s==="string"){n=s}else if(e===1){n=s.one}else{n=s.other.replace("{{count}}",e.toString())}if(i?.addSuffix){if(i.comparison&&i.comparison>0){return"in "+n}else{return n+" ago"}}return n};cg.formatDistance=lg;var fg={};var dg={};dg.buildFormatLongFn=pg;function pg(t){return(e={})=>{const i=e.width?String(e.width):t.defaultWidth;const n=t.formats[i]||t.formats[t.defaultWidth];return n}}fg.formatLong=void 0;var mg=dg;const _g={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"};const vg={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"};const gg={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"};fg.formatLong={date:(0,mg.buildFormatLongFn)({formats:_g,defaultWidth:"full"}),time:(0,mg.buildFormatLongFn)({formats:vg,defaultWidth:"full"}),dateTime:(0,mg.buildFormatLongFn)({formats:gg,defaultWidth:"full"})};var bg={};bg.formatRelative=void 0;const wg={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};const yg=(t,e,i,n)=>wg[t];bg.formatRelative=yg;var xg={};var Mg={};Mg.buildLocalizeFn=Tg;function Tg(t){return(e,i)=>{const n=i?.context?String(i.context):"standalone";let s;if(n==="formatting"&&t.formattingValues){const e=t.defaultFormattingWidth||t.defaultWidth;const n=i?.width?String(i.width):e;s=t.formattingValues[n]||t.formattingValues[e]}else{const e=t.defaultWidth;const n=i?.width?String(i.width):t.defaultWidth;s=t.values[n]||t.values[e]}const r=t.argumentCallback?t.argumentCallback(e):e;return s[r]}}xg.localize=void 0;var Og=Mg;const Eg={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]};const Ag={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]};const Sg={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]};const kg={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]};const Ig={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}};const Cg={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}};const jg=(t,e)=>{const i=Number(t);const n=i%100;if(n>20||n<10){switch(n%10){case 1:return i+"st";case 2:return i+"nd";case 3:return i+"rd"}}return i+"th"};xg.localize={ordinalNumber:jg,era:(0,Og.buildLocalizeFn)({values:Eg,defaultWidth:"wide"}),quarter:(0,Og.buildLocalizeFn)({values:Ag,defaultWidth:"wide",argumentCallback:t=>t-1}),month:(0,Og.buildLocalizeFn)({values:Sg,defaultWidth:"wide"}),day:(0,Og.buildLocalizeFn)({values:kg,defaultWidth:"wide"}),dayPeriod:(0,Og.buildLocalizeFn)({values:Ig,defaultWidth:"wide",formattingValues:Cg,defaultFormattingWidth:"wide"})};var Dg={};var Rg={};Rg.buildMatchFn=Pg;function Pg(t){return(e,i={})=>{const n=i.width;const s=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth];const r=e.match(s);if(!r){return null}const o=r[0];const a=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth];const h=Array.isArray(a)?Fg(a,(t=>t.test(o))):Ng(a,(t=>t.test(o)));let c;c=t.valueCallback?t.valueCallback(h):h;c=i.valueCallback?i.valueCallback(c):c;const u=e.slice(o.length);return{value:c,rest:u}}}function Ng(t,e){for(const i in t){if(Object.prototype.hasOwnProperty.call(t,i)&&e(t[i])){return i}}return undefined}function Fg(t,e){for(let i=0;i<t.length;i++){if(e(t[i])){return i}}return undefined}var zg={};zg.buildMatchPatternFn=Lg;function Lg(t){return(e,i={})=>{const n=e.match(t.matchPattern);if(!n)return null;const s=n[0];const r=e.match(t.parsePattern);if(!r)return null;let o=t.valueCallback?t.valueCallback(r[0]):r[0];o=i.valueCallback?i.valueCallback(o):o;const a=e.slice(s.length);return{value:o,rest:a}}}Dg.match=void 0;var $g=Rg;var Ug=zg;const Bg=/^(\d+)(th|st|nd|rd)?/i;const Gg=/\d+/i;const Hg={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i};const Vg={any:[/^b/i,/^(a|c)/i]};const Wg={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i};const qg={any:[/1/i,/2/i,/3/i,/4/i]};const Yg={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i};const Xg={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]};const Zg={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i};const Jg={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]};const Kg={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i};const Qg={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}};Dg.match={ordinalNumber:(0,Ug.buildMatchPatternFn)({matchPattern:Bg,parsePattern:Gg,valueCallback:t=>parseInt(t,10)}),era:(0,$g.buildMatchFn)({matchPatterns:Hg,defaultMatchWidth:"wide",parsePatterns:Vg,defaultParseWidth:"any"}),quarter:(0,$g.buildMatchFn)({matchPatterns:Wg,defaultMatchWidth:"wide",parsePatterns:qg,defaultParseWidth:"any",valueCallback:t=>t+1}),month:(0,$g.buildMatchFn)({matchPatterns:Yg,defaultMatchWidth:"wide",parsePatterns:Xg,defaultParseWidth:"any"}),day:(0,$g.buildMatchFn)({matchPatterns:Zg,defaultMatchWidth:"wide",parsePatterns:Jg,defaultParseWidth:"any"}),dayPeriod:(0,$g.buildMatchFn)({matchPatterns:Kg,defaultMatchWidth:"any",parsePatterns:Qg,defaultParseWidth:"any"})};hg.enUS=void 0;var tb=cg;var eb=fg;var ib=bg;var nb=xg;var sb=Dg;hg.enUS={code:"en-US",formatDistance:tb.formatDistance,formatLong:eb.formatLong,formatRelative:ib.formatRelative,localize:nb.localize,match:sb.match,options:{weekStartsOn:0,firstWeekContainsDate:1}};(function(t){Object.defineProperty(t,"defaultLocale",{enumerable:true,get:function(){return e.enUS}});var e=hg})(ag);var rb={};var ob={};ob.getDayOfYear=ub;var ab=od;var hb=mv;var cb=Yl;function ub(t){const e=(0,cb.toDate)(t);const i=(0,ab.differenceInCalendarDays)(e,(0,hb.startOfYear)(e));const n=i+1;return n}var lb={};lb.getISOWeek=_b;var fb=jf;var db=Hf;var pb=vd;var mb=Yl;function _b(t){const e=(0,mb.toDate)(t);const i=+(0,db.startOfISOWeek)(e)-+(0,pb.startOfISOWeekYear)(e);return Math.round(i/fb.millisecondsInWeek)+1}var vb={};var gb={};var bb={};bb.getWeekYear=Tb;var wb=Zl;var yb=Vf;var xb=Yl;var Mb=Wf;function Tb(t,e){const i=(0,xb.toDate)(t);const n=i.getFullYear();const s=(0,Mb.getDefaultOptions)();const r=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1;const o=(0,wb.constructFrom)(t,0);o.setFullYear(n+1,0,r);o.setHours(0,0,0,0);const a=(0,yb.startOfWeek)(o,e);const h=(0,wb.constructFrom)(t,0);h.setFullYear(n,0,r);h.setHours(0,0,0,0);const c=(0,yb.startOfWeek)(h,e);if(i.getTime()>=a.getTime()){return n+1}else if(i.getTime()>=c.getTime()){return n}else{return n-1}}gb.startOfWeekYear=kb;var Ob=Zl;var Eb=bb;var Ab=Vf;var Sb=Wf;function kb(t,e){const i=(0,Sb.getDefaultOptions)();const n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1;const s=(0,Eb.getWeekYear)(t,e);const r=(0,Ob.constructFrom)(t,0);r.setFullYear(s,0,n);r.setHours(0,0,0,0);const o=(0,Ab.startOfWeek)(r,e);return o}vb.getWeek=Rb;var Ib=jf;var Cb=Vf;var jb=gb;var Db=Yl;function Rb(t,e){const i=(0,Db.toDate)(t);const n=+(0,Cb.startOfWeek)(i,e)-+(0,jb.startOfWeekYear)(i,e);return Math.round(n/Ib.millisecondsInWeek)+1}var Pb={};Pb.addLeadingZeros=Nb;function Nb(t,e){const i=t<0?"-":"";const n=Math.abs(t).toString().padStart(e,"0");return i+n}var Fb={};Fb.lightFormatters=void 0;var zb=Pb;Fb.lightFormatters={y(t,e){const i=t.getFullYear();const n=i>0?i:1-i;return(0,zb.addLeadingZeros)(e==="yy"?n%100:n,e.length)},M(t,e){const i=t.getMonth();return e==="M"?String(i+1):(0,zb.addLeadingZeros)(i+1,2)},d(t,e){return(0,zb.addLeadingZeros)(t.getDate(),e.length)},a(t,e){const i=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.toUpperCase();case"aaa":return i;case"aaaaa":return i[0];case"aaaa":default:return i==="am"?"a.m.":"p.m."}},h(t,e){return(0,zb.addLeadingZeros)(t.getHours()%12||12,e.length)},H(t,e){return(0,zb.addLeadingZeros)(t.getHours(),e.length)},m(t,e){return(0,zb.addLeadingZeros)(t.getMinutes(),e.length)},s(t,e){return(0,zb.addLeadingZeros)(t.getSeconds(),e.length)},S(t,e){const i=e.length;const n=t.getMilliseconds();const s=Math.trunc(n*Math.pow(10,i-3));return(0,zb.addLeadingZeros)(s,e.length)}};rb.formatters=void 0;var Lb=ob;var $b=lb;var Ub=Gf;var Bb=vb;var Gb=bb;var Hb=Pb;var Vb=Fb;const Wb={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"};rb.formatters={G:function(t,e,i){const n=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return i.era(n,{width:"abbreviated"});case"GGGGG":return i.era(n,{width:"narrow"});case"GGGG":default:return i.era(n,{width:"wide"})}},y:function(t,e,i){if(e==="yo"){const e=t.getFullYear();const n=e>0?e:1-e;return i.ordinalNumber(n,{unit:"year"})}return Vb.lightFormatters.y(t,e)},Y:function(t,e,i,n){const s=(0,Gb.getWeekYear)(t,n);const r=s>0?s:1-s;if(e==="YY"){const t=r%100;return(0,Hb.addLeadingZeros)(t,2)}if(e==="Yo"){return i.ordinalNumber(r,{unit:"year"})}return(0,Hb.addLeadingZeros)(r,e.length)},R:function(t,e){const i=(0,Ub.getISOWeekYear)(t);return(0,Hb.addLeadingZeros)(i,e.length)},u:function(t,e){const i=t.getFullYear();return(0,Hb.addLeadingZeros)(i,e.length)},Q:function(t,e,i){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return(0,Hb.addLeadingZeros)(n,2);case"Qo":return i.ordinalNumber(n,{unit:"quarter"});case"QQQ":return i.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return i.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,i){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return(0,Hb.addLeadingZeros)(n,2);case"qo":return i.ordinalNumber(n,{unit:"quarter"});case"qqq":return i.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return i.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,i){const n=t.getMonth();switch(e){case"M":case"MM":return Vb.lightFormatters.M(t,e);case"Mo":return i.ordinalNumber(n+1,{unit:"month"});case"MMM":return i.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return i.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,i){const n=t.getMonth();switch(e){case"L":return String(n+1);case"LL":return(0,Hb.addLeadingZeros)(n+1,2);case"Lo":return i.ordinalNumber(n+1,{unit:"month"});case"LLL":return i.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return i.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,i,n){const s=(0,Bb.getWeek)(t,n);if(e==="wo"){return i.ordinalNumber(s,{unit:"week"})}return(0,Hb.addLeadingZeros)(s,e.length)},I:function(t,e,i){const n=(0,$b.getISOWeek)(t);if(e==="Io"){return i.ordinalNumber(n,{unit:"week"})}return(0,Hb.addLeadingZeros)(n,e.length)},d:function(t,e,i){if(e==="do"){return i.ordinalNumber(t.getDate(),{unit:"date"})}return Vb.lightFormatters.d(t,e)},D:function(t,e,i){const n=(0,Lb.getDayOfYear)(t);if(e==="Do"){return i.ordinalNumber(n,{unit:"dayOfYear"})}return(0,Hb.addLeadingZeros)(n,e.length)},E:function(t,e,i){const n=t.getDay();switch(e){case"E":case"EE":case"EEE":return i.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return i.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(n,{width:"short",context:"formatting"});case"EEEE":default:return i.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,i,n){const s=t.getDay();const r=(s-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(r);case"ee":return(0,Hb.addLeadingZeros)(r,2);case"eo":return i.ordinalNumber(r,{unit:"day"});case"eee":return i.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return i.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(s,{width:"short",context:"formatting"});case"eeee":default:return i.day(s,{width:"wide",context:"formatting"})}},c:function(t,e,i,n){const s=t.getDay();const r=(s-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(r);case"cc":return(0,Hb.addLeadingZeros)(r,e.length);case"co":return i.ordinalNumber(r,{unit:"day"});case"ccc":return i.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return i.day(s,{width:"narrow",context:"standalone"});case"cccccc":return i.day(s,{width:"short",context:"standalone"});case"cccc":default:return i.day(s,{width:"wide",context:"standalone"})}},i:function(t,e,i){const n=t.getDay();const s=n===0?7:n;switch(e){case"i":return String(s);case"ii":return(0,Hb.addLeadingZeros)(s,e.length);case"io":return i.ordinalNumber(s,{unit:"day"});case"iii":return i.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return i.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return i.day(n,{width:"short",context:"formatting"});case"iiii":default:return i.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,i){const n=t.getHours();const s=n/12>=1?"pm":"am";switch(e){case"a":case"aa":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(t,e,i){const n=t.getHours();let s;if(n===12){s=Wb.noon}else if(n===0){s=Wb.midnight}else{s=n/12>=1?"pm":"am"}switch(e){case"b":case"bb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(t,e,i){const n=t.getHours();let s;if(n>=17){s=Wb.evening}else if(n>=12){s=Wb.afternoon}else if(n>=4){s=Wb.morning}else{s=Wb.night}switch(e){case"B":case"BB":case"BBB":return i.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return i.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(t,e,i){if(e==="ho"){let e=t.getHours()%12;if(e===0)e=12;return i.ordinalNumber(e,{unit:"hour"})}return Vb.lightFormatters.h(t,e)},H:function(t,e,i){if(e==="Ho"){return i.ordinalNumber(t.getHours(),{unit:"hour"})}return Vb.lightFormatters.H(t,e)},K:function(t,e,i){const n=t.getHours()%12;if(e==="Ko"){return i.ordinalNumber(n,{unit:"hour"})}return(0,Hb.addLeadingZeros)(n,e.length)},k:function(t,e,i){let n=t.getHours();if(n===0)n=24;if(e==="ko"){return i.ordinalNumber(n,{unit:"hour"})}return(0,Hb.addLeadingZeros)(n,e.length)},m:function(t,e,i){if(e==="mo"){return i.ordinalNumber(t.getMinutes(),{unit:"minute"})}return Vb.lightFormatters.m(t,e)},s:function(t,e,i){if(e==="so"){return i.ordinalNumber(t.getSeconds(),{unit:"second"})}return Vb.lightFormatters.s(t,e)},S:function(t,e){return Vb.lightFormatters.S(t,e)},X:function(t,e,i){const n=t.getTimezoneOffset();if(n===0){return"Z"}switch(e){case"X":return Yb(n);case"XXXX":case"XX":return Xb(n);case"XXXXX":case"XXX":default:return Xb(n,":")}},x:function(t,e,i){const n=t.getTimezoneOffset();switch(e){case"x":return Yb(n);case"xxxx":case"xx":return Xb(n);case"xxxxx":case"xxx":default:return Xb(n,":")}},O:function(t,e,i){const n=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+qb(n,":");case"OOOO":default:return"GMT"+Xb(n,":")}},z:function(t,e,i){const n=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+qb(n,":");case"zzzz":default:return"GMT"+Xb(n,":")}},t:function(t,e,i){const n=Math.trunc(t.getTime()/1e3);return(0,Hb.addLeadingZeros)(n,e.length)},T:function(t,e,i){const n=t.getTime();return(0,Hb.addLeadingZeros)(n,e.length)}};function qb(t,e=""){const i=t>0?"-":"+";const n=Math.abs(t);const s=Math.trunc(n/60);const r=n%60;if(r===0){return i+String(s)}return i+String(s)+e+(0,Hb.addLeadingZeros)(r,2)}function Yb(t,e){if(t%60===0){const e=t>0?"-":"+";return e+(0,Hb.addLeadingZeros)(Math.abs(t)/60,2)}return Xb(t,e)}function Xb(t,e=""){const i=t>0?"-":"+";const n=Math.abs(t);const s=(0,Hb.addLeadingZeros)(Math.trunc(n/60),2);const r=(0,Hb.addLeadingZeros)(n%60,2);return i+s+e+r}var Zb={};Zb.longFormatters=void 0;const Jb=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}};const Kb=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}};const Qb=(t,e)=>{const i=t.match(/(P+)(p+)?/)||[];const n=i[1];const s=i[2];if(!s){return Jb(t,e)}let r;switch(n){case"P":r=e.dateTime({width:"short"});break;case"PP":r=e.dateTime({width:"medium"});break;case"PPP":r=e.dateTime({width:"long"});break;case"PPPP":default:r=e.dateTime({width:"full"});break}return r.replace("{{date}}",Jb(n,e)).replace("{{time}}",Kb(s,e))};Zb.longFormatters={p:Kb,P:Qb};var tw={};tw.isProtectedDayOfYearToken=sw;tw.isProtectedWeekYearToken=rw;tw.warnOrThrowProtectedError=ow;const ew=/^D+$/;const iw=/^Y+$/;const nw=["D","DD","YY","YYYY"];function sw(t){return ew.test(t)}function rw(t){return iw.test(t)}function ow(t,e,i){const n=aw(t,e,i);console.warn(n);if(nw.includes(t))throw new RangeError(n)}function aw(t,e,i){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(function(t){t.format=t.formatDate=d;Object.defineProperty(t,"formatters",{enumerable:true,get:function(){return n.formatters}});Object.defineProperty(t,"longFormatters",{enumerable:true,get:function(){return s.longFormatters}});var e=ag;var i=Wf;var n=rb;var s=Zb;var r=tw;var o=Sp;var a=Yl;const h=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g;const c=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;const u=/^'([^]*?)'?$/;const l=/''/g;const f=/[a-zA-Z]/;function d(t,u,l){const d=(0,i.getDefaultOptions)();const m=l?.locale??d.locale??e.defaultLocale;const _=l?.firstWeekContainsDate??l?.locale?.options?.firstWeekContainsDate??d.firstWeekContainsDate??d.locale?.options?.firstWeekContainsDate??1;const v=l?.weekStartsOn??l?.locale?.options?.weekStartsOn??d.weekStartsOn??d.locale?.options?.weekStartsOn??0;const g=(0,a.toDate)(t);if(!(0,o.isValid)(g)){throw new RangeError("Invalid time value")}let b=u.match(c).map((t=>{const e=t[0];if(e==="p"||e==="P"){const i=s.longFormatters[e];return i(t,m.formatLong)}return t})).join("").match(h).map((t=>{if(t==="''"){return{isToken:false,value:"'"}}const e=t[0];if(e==="'"){return{isToken:false,value:p(t)}}if(n.formatters[e]){return{isToken:true,value:t}}if(e.match(f)){throw new RangeError("Format string contains an unescaped latin alphabet character `"+e+"`")}return{isToken:false,value:t}}));if(m.localize.preprocessor){b=m.localize.preprocessor(g,b)}const w={firstWeekContainsDate:_,weekStartsOn:v,locale:m};return b.map((e=>{if(!e.isToken)return e.value;const i=e.value;if(!l?.useAdditionalWeekYearTokens&&(0,r.isProtectedWeekYearToken)(i)||!l?.useAdditionalDayOfYearTokens&&(0,r.isProtectedDayOfYearToken)(i)){(0,r.warnOrThrowProtectedError)(i,u,String(t))}const s=n.formatters[i[0]];return s(g,i,m.localize,w)})).join("")}function p(t){const e=t.match(u);if(!e){return t}return e[1].replace(l,"'")}})(og);var hw={};hw.formatDistance=vw;var cw=fp;var uw=jf;var lw=Bm;var fw=c_;var dw=Yl;var pw=ag;var mw=Wf;var _w=ud;function vw(t,e,i){const n=(0,mw.getDefaultOptions)();const s=i?.locale??n.locale??pw.defaultLocale;const r=2520;const o=(0,cw.compareAsc)(t,e);if(isNaN(o)){throw new RangeError("Invalid time value")}const a=Object.assign({},i,{addSuffix:i?.addSuffix,comparison:o});let h;let c;if(o>0){h=(0,dw.toDate)(e);c=(0,dw.toDate)(t)}else{h=(0,dw.toDate)(t);c=(0,dw.toDate)(e)}const u=(0,fw.differenceInSeconds)(c,h);const l=((0,_w.getTimezoneOffsetInMilliseconds)(c)-(0,_w.getTimezoneOffsetInMilliseconds)(h))/1e3;const f=Math.round((u-l)/60);let d;if(f<2){if(i?.includeSeconds){if(u<5){return s.formatDistance("lessThanXSeconds",5,a)}else if(u<10){return s.formatDistance("lessThanXSeconds",10,a)}else if(u<20){return s.formatDistance("lessThanXSeconds",20,a)}else if(u<40){return s.formatDistance("halfAMinute",0,a)}else if(u<60){return s.formatDistance("lessThanXMinutes",1,a)}else{return s.formatDistance("xMinutes",1,a)}}else{if(f===0){return s.formatDistance("lessThanXMinutes",1,a)}else{return s.formatDistance("xMinutes",f,a)}}}else if(f<45){return s.formatDistance("xMinutes",f,a)}else if(f<90){return s.formatDistance("aboutXHours",1,a)}else if(f<uw.minutesInDay){const t=Math.round(f/60);return s.formatDistance("aboutXHours",t,a)}else if(f<r){return s.formatDistance("xDays",1,a)}else if(f<uw.minutesInMonth){const t=Math.round(f/uw.minutesInDay);return s.formatDistance("xDays",t,a)}else if(f<uw.minutesInMonth*2){d=Math.round(f/uw.minutesInMonth);return s.formatDistance("aboutXMonths",d,a)}d=(0,lw.differenceInMonths)(c,h);if(d<12){const t=Math.round(f/uw.minutesInMonth);return s.formatDistance("xMonths",t,a)}else{const t=d%12;const e=Math.trunc(d/12);if(t<3){return s.formatDistance("aboutXYears",e,a)}else if(t<9){return s.formatDistance("overXYears",e,a)}else{return s.formatDistance("almostXYears",e+1,a)}}}var gw={};gw.formatDistanceStrict=Ew;var bw=ag;var ww=Wf;var yw=bm;var xw=ud;var Mw=fp;var Tw=jf;var Ow=Yl;function Ew(t,e,i){const n=(0,ww.getDefaultOptions)();const s=i?.locale??n.locale??bw.defaultLocale;const r=(0,Mw.compareAsc)(t,e);if(isNaN(r)){throw new RangeError("Invalid time value")}const o=Object.assign({},i,{addSuffix:i?.addSuffix,comparison:r});let a;let h;if(r>0){a=(0,Ow.toDate)(e);h=(0,Ow.toDate)(t)}else{a=(0,Ow.toDate)(t);h=(0,Ow.toDate)(e)}const c=(0,yw.getRoundingMethod)(i?.roundingMethod??"round");const u=h.getTime()-a.getTime();const l=u/Tw.millisecondsInMinute;const f=(0,xw.getTimezoneOffsetInMilliseconds)(h)-(0,xw.getTimezoneOffsetInMilliseconds)(a);const d=(u-f)/Tw.millisecondsInMinute;const p=i?.unit;let m;if(!p){if(l<1){m="second"}else if(l<60){m="minute"}else if(l<Tw.minutesInDay){m="hour"}else if(d<Tw.minutesInMonth){m="day"}else if(d<Tw.minutesInYear){m="month"}else{m="year"}}else{m=p}if(m==="second"){const t=c(u/1e3);return s.formatDistance("xSeconds",t,o)}else if(m==="minute"){const t=c(l);return s.formatDistance("xMinutes",t,o)}else if(m==="hour"){const t=c(l/60);return s.formatDistance("xHours",t,o)}else if(m==="day"){const t=c(d/Tw.minutesInDay);return s.formatDistance("xDays",t,o)}else if(m==="month"){const t=c(d/Tw.minutesInMonth);return t===12&&p!=="month"?s.formatDistance("xYears",1,o):s.formatDistance("xMonths",t,o)}else{const t=c(d/Tw.minutesInYear);return s.formatDistance("xYears",t,o)}}var Aw={};Aw.formatDistanceToNow=Iw;var Sw=gp;var kw=hw;function Iw(t,e){return(0,kw.formatDistance)(t,(0,Sw.constructNow)(t),e)}var Cw={};Cw.formatDistanceToNowStrict=Rw;var jw=gw;var Dw=gp;function Rw(t,e){return(0,jw.formatDistanceStrict)(t,(0,Dw.constructNow)(t),e)}var Pw={};Pw.formatDuration=Lw;var Nw=ag;var Fw=Wf;const zw=["years","months","weeks","days","hours","minutes","seconds"];function Lw(t,e){const i=(0,Fw.getDefaultOptions)();const n=e?.locale??i.locale??Nw.defaultLocale;const s=e?.format??zw;const r=e?.zero??false;const o=e?.delimiter??" ";if(!n.formatDistance){return""}const a=s.reduce(((e,i)=>{const s=`x${i.replace(/(^.)/,(t=>t.toUpperCase()))}`;const o=t[i];if(o!==undefined&&(r||t[i])){return e.concat(n.formatDistance(s,o))}return e}),[]).join(o);return a}var $w={};$w.formatISO=Gw;var Uw=Yl;var Bw=Pb;function Gw(t,e){const i=(0,Uw.toDate)(t);if(isNaN(i.getTime())){throw new RangeError("Invalid time value")}const n=e?.format??"extended";const s=e?.representation??"complete";let r="";let o="";const a=n==="extended"?"-":"";const h=n==="extended"?":":"";if(s!=="time"){const t=(0,Bw.addLeadingZeros)(i.getDate(),2);const e=(0,Bw.addLeadingZeros)(i.getMonth()+1,2);const n=(0,Bw.addLeadingZeros)(i.getFullYear(),4);r=`${n}${a}${e}${a}${t}`}if(s!=="date"){const t=i.getTimezoneOffset();if(t!==0){const e=Math.abs(t);const i=(0,Bw.addLeadingZeros)(Math.trunc(e/60),2);const n=(0,Bw.addLeadingZeros)(e%60,2);const s=t<0?"+":"-";o=`${s}${i}:${n}`}else{o="Z"}const e=(0,Bw.addLeadingZeros)(i.getHours(),2);const n=(0,Bw.addLeadingZeros)(i.getMinutes(),2);const s=(0,Bw.addLeadingZeros)(i.getSeconds(),2);const a=r===""?"":"T";const c=[e,n,s].join(h);r=`${r}${a}${c}${o}`}return r}var Hw={};Hw.formatISO9075=Yw;var Vw=Sp;var Ww=Yl;var qw=Pb;function Yw(t,e){const i=(0,Ww.toDate)(t);if(!(0,Vw.isValid)(i)){throw new RangeError("Invalid time value")}const n=e?.format??"extended";const s=e?.representation??"complete";let r="";const o=n==="extended"?"-":"";const a=n==="extended"?":":"";if(s!=="time"){const t=(0,qw.addLeadingZeros)(i.getDate(),2);const e=(0,qw.addLeadingZeros)(i.getMonth()+1,2);const n=(0,qw.addLeadingZeros)(i.getFullYear(),4);r=`${n}${o}${e}${o}${t}`}if(s!=="date"){const t=(0,qw.addLeadingZeros)(i.getHours(),2);const e=(0,qw.addLeadingZeros)(i.getMinutes(),2);const n=(0,qw.addLeadingZeros)(i.getSeconds(),2);const s=r===""?"":" ";r=`${r}${s}${t}${a}${e}${a}${n}`}return r}var Xw={};Xw.formatISODuration=Zw;function Zw(t){const{years:e=0,months:i=0,days:n=0,hours:s=0,minutes:r=0,seconds:o=0}=t;return`P${e}Y${i}M${n}DT${s}H${r}M${o}S`}var Jw={};Jw.formatRFC3339=ey;var Kw=Sp;var Qw=Yl;var ty=Pb;function ey(t,e){const i=(0,Qw.toDate)(t);if(!(0,Kw.isValid)(i)){throw new RangeError("Invalid time value")}const n=e?.fractionDigits??0;const s=(0,ty.addLeadingZeros)(i.getDate(),2);const r=(0,ty.addLeadingZeros)(i.getMonth()+1,2);const o=i.getFullYear();const a=(0,ty.addLeadingZeros)(i.getHours(),2);const h=(0,ty.addLeadingZeros)(i.getMinutes(),2);const c=(0,ty.addLeadingZeros)(i.getSeconds(),2);let u="";if(n>0){const t=i.getMilliseconds();const e=Math.trunc(t*Math.pow(10,n-3));u="."+(0,ty.addLeadingZeros)(e,n)}let l="";const f=i.getTimezoneOffset();if(f!==0){const t=Math.abs(f);const e=(0,ty.addLeadingZeros)(Math.trunc(t/60),2);const i=(0,ty.addLeadingZeros)(t%60,2);const n=f<0?"+":"-";l=`${n}${e}:${i}`}else{l="Z"}return`${o}-${r}-${s}T${a}:${h}:${c}${u}${l}`}var iy={};iy.formatRFC7231=hy;var ny=Sp;var sy=Yl;var ry=Pb;const oy=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];const ay=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function hy(t){const e=(0,sy.toDate)(t);if(!(0,ny.isValid)(e)){throw new RangeError("Invalid time value")}const i=oy[e.getUTCDay()];const n=(0,ry.addLeadingZeros)(e.getUTCDate(),2);const s=ay[e.getUTCMonth()];const r=e.getUTCFullYear();const o=(0,ry.addLeadingZeros)(e.getUTCHours(),2);const a=(0,ry.addLeadingZeros)(e.getUTCMinutes(),2);const h=(0,ry.addLeadingZeros)(e.getUTCSeconds(),2);return`${i}, ${n} ${s} ${r} ${o}:${a}:${h} GMT`}var cy={};cy.formatRelative=my;var uy=od;var ly=og;var fy=Yl;var dy=ag;var py=Wf;function my(t,e,i){const n=(0,fy.toDate)(t);const s=(0,fy.toDate)(e);const r=(0,py.getDefaultOptions)();const o=i?.locale??r.locale??dy.defaultLocale;const a=i?.weekStartsOn??i?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0;const h=(0,uy.differenceInCalendarDays)(n,s);if(isNaN(h)){throw new RangeError("Invalid time value")}let c;if(h<-6){c="other"}else if(h<-1){c="lastWeek"}else if(h<0){c="yesterday"}else if(h<1){c="today"}else if(h<2){c="tomorrow"}else if(h<7){c="nextWeek"}else{c="other"}const u=o.formatRelative(c,n,s,{locale:o,weekStartsOn:a});return(0,ly.format)(n,u,{locale:o,weekStartsOn:a})}var _y={};_y.fromUnixTime=gy;var vy=Yl;function gy(t){return(0,vy.toDate)(t*1e3)}var by={};by.getDate=yy;var wy=Yl;function yy(t){const e=(0,wy.toDate)(t);const i=e.getDate();return i}var xy={};xy.getDay=Ty;var My=Yl;function Ty(t){const e=(0,My.toDate)(t);const i=e.getDay();return i}var Oy={};Oy.getDaysInMonth=Sy;var Ey=Yl;var Ay=Zl;function Sy(t){const e=(0,Ey.toDate)(t);const i=e.getFullYear();const n=e.getMonth();const s=(0,Ay.constructFrom)(t,0);s.setFullYear(i,n+1,0);s.setHours(0,0,0,0);return s.getDate()}var ky={};var Iy={};Iy.isLeapYear=jy;var Cy=Yl;function jy(t){const e=(0,Cy.toDate)(t);const i=e.getFullYear();return i%400===0||i%4===0&&i%100!==0}ky.getDaysInYear=Py;var Dy=Iy;var Ry=Yl;function Py(t){const e=(0,Ry.toDate)(t);if(String(new Date(e))==="Invalid Date"){return NaN}return(0,Dy.isLeapYear)(e)?366:365}var Ny={};Ny.getDecade=zy;var Fy=Yl;function zy(t){const e=(0,Fy.toDate)(t);const i=e.getFullYear();const n=Math.floor(i/10)*10;return n}var Ly={};Ly.getDefaultOptions=Uy;var $y=Wf;function Uy(){return Object.assign({},(0,$y.getDefaultOptions)())}var By={};By.getHours=Hy;var Gy=Yl;function Hy(t){const e=(0,Gy.toDate)(t);const i=e.getHours();return i}var Vy={};Vy.getISODay=qy;var Wy=Yl;function qy(t){const e=(0,Wy.toDate)(t);let i=e.getDay();if(i===0){i=7}return i}var Yy={};Yy.getISOWeeksInYear=Ky;var Xy=$d;var Zy=jf;var Jy=vd;function Ky(t){const e=(0,Jy.startOfISOWeekYear)(t);const i=(0,Jy.startOfISOWeekYear)((0,Xy.addWeeks)(e,60));const n=+i-+e;return Math.round(n/Zy.millisecondsInWeek)}var Qy={};Qy.getMilliseconds=ex;var tx=Yl;function ex(t){const e=(0,tx.toDate)(t);const i=e.getMilliseconds();return i}var ix={};ix.getMinutes=sx;var nx=Yl;function sx(t){const e=(0,nx.toDate)(t);const i=e.getMinutes();return i}var rx={};rx.getMonth=ax;var ox=Yl;function ax(t){const e=(0,ox.toDate)(t);const i=e.getMonth();return i}var hx={};hx.getOverlappingDaysInIntervals=fx;var cx=ud;var ux=jf;var lx=Yl;function fx(t,e){const[i,n]=[+(0,lx.toDate)(t.start),+(0,lx.toDate)(t.end)].sort(((t,e)=>t-e));const[s,r]=[+(0,lx.toDate)(e.start),+(0,lx.toDate)(e.end)].sort(((t,e)=>t-e));const o=i<r&&s<n;if(!o)return 0;const a=s<i?i:s;const h=a-(0,cx.getTimezoneOffsetInMilliseconds)(a);const c=r>n?n:r;const u=c-(0,cx.getTimezoneOffsetInMilliseconds)(c);return Math.ceil((u-h)/ux.millisecondsInDay)}var dx={};dx.getSeconds=mx;var px=Yl;function mx(t){const e=(0,px.toDate)(t);const i=e.getSeconds();return i}var _x={};_x.getTime=gx;var vx=Yl;function gx(t){const e=(0,vx.toDate)(t);const i=e.getTime();return i}var bx={};bx.getUnixTime=yx;var wx=Yl;function yx(t){return Math.trunc(+(0,wx.toDate)(t)/1e3)}var xx={};xx.getWeekOfMonth=Ax;var Mx=by;var Tx=xy;var Ox=sv;var Ex=Wf;function Ax(t,e){const i=(0,Ex.getDefaultOptions)();const n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0;const s=(0,Mx.getDate)(t);if(isNaN(s))return NaN;const r=(0,Tx.getDay)((0,Ox.startOfMonth)(t));let o=n-r;if(o<=0)o+=7;const a=s-o;return Math.ceil(a/7)+1}var Sx={};var kx={};kx.lastDayOfMonth=Cx;var Ix=Yl;function Cx(t){const e=(0,Ix.toDate)(t);const i=e.getMonth();e.setFullYear(e.getFullYear(),i+1,0);e.setHours(0,0,0,0);return e}Sx.getWeeksInMonth=Px;var jx=rm;var Dx=kx;var Rx=sv;function Px(t,e){return(0,jx.differenceInCalendarWeeks)((0,Dx.lastDayOfMonth)(t),(0,Rx.startOfMonth)(t),e)+1}var Nx={};Nx.getYear=zx;var Fx=Yl;function zx(t){return(0,Fx.toDate)(t).getFullYear()}var Lx={};Lx.hoursToMilliseconds=Ux;var $x=jf;function Ux(t){return Math.trunc(t*$x.millisecondsInHour)}var Bx={};Bx.hoursToMinutes=Hx;var Gx=jf;function Hx(t){return Math.trunc(t*Gx.minutesInHour)}var Vx={};Vx.hoursToSeconds=qx;var Wx=jf;function qx(t){return Math.trunc(t*Wx.secondsInHour)}var Yx={};Yx.interval=Zx;var Xx=Yl;function Zx(t,e,i){const n=(0,Xx.toDate)(t);if(isNaN(+n))throw new TypeError("Start date is invalid");const s=(0,Xx.toDate)(e);if(isNaN(+s))throw new TypeError("End date is invalid");if(i?.assertPositive&&+n>+s)throw new TypeError("End date must be after start date");return{start:n,end:s}}var Jx={};Jx.intervalToDuration=oM;var Kx=Wl;var Qx=dm;var tM=gm;var eM=Fm;var iM=Bm;var nM=c_;var sM=v_;var rM=Yl;function oM(t){const e=(0,rM.toDate)(t.start);const i=(0,rM.toDate)(t.end);const n={};const s=(0,sM.differenceInYears)(i,e);if(s)n.years=s;const r=(0,Kx.add)(e,{years:n.years});const o=(0,iM.differenceInMonths)(i,r);if(o)n.months=o;const a=(0,Kx.add)(r,{months:n.months});const h=(0,Qx.differenceInDays)(i,a);if(h)n.days=h;const c=(0,Kx.add)(a,{days:n.days});const u=(0,tM.differenceInHours)(i,c);if(u)n.hours=u;const l=(0,Kx.add)(c,{hours:n.hours});const f=(0,eM.differenceInMinutes)(i,l);if(f)n.minutes=f;const d=(0,Kx.add)(l,{minutes:n.minutes});const p=(0,nM.differenceInSeconds)(i,d);if(p)n.seconds=p;return n}var aM={};aM.intlFormat=cM;var hM=Yl;function cM(t,e,i){let n;if(uM(e)){n=e}else{i=e}return new Intl.DateTimeFormat(i?.locale,n).format((0,hM.toDate)(t))}function uM(t){return t!==undefined&&!("locale"in t)}var lM={};lM.intlFormatDistance=xM;var fM=jf;var dM=od;var pM=Xp;var mM=Kp;var _M=rm;var vM=um;var gM=gm;var bM=Fm;var wM=c_;var yM=Yl;function xM(t,e,i){let n=0;let s;const r=(0,yM.toDate)(t);const o=(0,yM.toDate)(e);if(!i?.unit){const t=(0,wM.differenceInSeconds)(r,o);if(Math.abs(t)<fM.secondsInMinute){n=(0,wM.differenceInSeconds)(r,o);s="second"}else if(Math.abs(t)<fM.secondsInHour){n=(0,bM.differenceInMinutes)(r,o);s="minute"}else if(Math.abs(t)<fM.secondsInDay&&Math.abs((0,dM.differenceInCalendarDays)(r,o))<1){n=(0,gM.differenceInHours)(r,o);s="hour"}else if(Math.abs(t)<fM.secondsInWeek&&(n=(0,dM.differenceInCalendarDays)(r,o))&&Math.abs(n)<7){s="day"}else if(Math.abs(t)<fM.secondsInMonth){n=(0,_M.differenceInCalendarWeeks)(r,o);s="week"}else if(Math.abs(t)<fM.secondsInQuarter){n=(0,pM.differenceInCalendarMonths)(r,o);s="month"}else if(Math.abs(t)<fM.secondsInYear){if((0,mM.differenceInCalendarQuarters)(r,o)<4){n=(0,mM.differenceInCalendarQuarters)(r,o);s="quarter"}else{n=(0,vM.differenceInCalendarYears)(r,o);s="year"}}else{n=(0,vM.differenceInCalendarYears)(r,o);s="year"}}else{s=i?.unit;if(s==="second"){n=(0,wM.differenceInSeconds)(r,o)}else if(s==="minute"){n=(0,bM.differenceInMinutes)(r,o)}else if(s==="hour"){n=(0,gM.differenceInHours)(r,o)}else if(s==="day"){n=(0,dM.differenceInCalendarDays)(r,o)}else if(s==="week"){n=(0,_M.differenceInCalendarWeeks)(r,o)}else if(s==="month"){n=(0,pM.differenceInCalendarMonths)(r,o)}else if(s==="quarter"){n=(0,mM.differenceInCalendarQuarters)(r,o)}else if(s==="year"){n=(0,vM.differenceInCalendarYears)(r,o)}}const a=new Intl.RelativeTimeFormat(i?.locale,{localeMatcher:i?.localeMatcher,numeric:i?.numeric||"auto",style:i?.style});return a.format(n,s)}var MM={};MM.isAfter=OM;var TM=Yl;function OM(t,e){const i=(0,TM.toDate)(t);const n=(0,TM.toDate)(e);return i.getTime()>n.getTime()}var EM={};EM.isBefore=SM;var AM=Yl;function SM(t,e){const i=(0,AM.toDate)(t);const n=(0,AM.toDate)(e);return+i<+n}var kM={};kM.isEqual=CM;var IM=Yl;function CM(t,e){const i=(0,IM.toDate)(t);const n=(0,IM.toDate)(e);return+i===+n}var jM={};jM.isExists=DM;function DM(t,e,i){const n=new Date(t,e,i);return n.getFullYear()===t&&n.getMonth()===e&&n.getDate()===i}var RM={};RM.isFirstDayOfMonth=NM;var PM=Yl;function NM(t){return(0,PM.toDate)(t).getDate()===1}var FM={};FM.isFriday=LM;var zM=Yl;function LM(t){return(0,zM.toDate)(t).getDay()===5}var $M={};$M.isFuture=BM;var UM=Yl;function BM(t){return+(0,UM.toDate)(t)>Date.now()}var GM={};var HM={};var VM={};var WM={};var qM={};var YM={};var XM={};XM.transpose=JM;var ZM=Zl;function JM(t,e){const i=e instanceof Date?(0,ZM.constructFrom)(e,0):new e(0);i.setFullYear(t.getFullYear(),t.getMonth(),t.getDate());i.setHours(t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds());return i}YM.ValueSetter=YM.Setter=YM.DateToSystemTimezoneSetter=void 0;var KM=XM;var QM=Zl;const tT=10;class eT{subPriority=0;validate(t,e){return true}}YM.Setter=eT;class iT extends eT{constructor(t,e,i,n,s){super();this.value=t;this.validateValue=e;this.setValue=i;this.priority=n;if(s){this.subPriority=s}}validate(t,e){return this.validateValue(t,this.value,e)}set(t,e,i){return this.setValue(t,e,this.value,i)}}YM.ValueSetter=iT;class nT extends eT{priority=tT;subPriority=-1;set(t,e){if(e.timestampIsSet)return t;return(0,QM.constructFrom)(t,(0,KM.transpose)(t,Date))}}YM.DateToSystemTimezoneSetter=nT;qM.Parser=void 0;var sT=YM;class rT{run(t,e,i,n){const s=this.parse(t,e,i,n);if(!s){return null}return{setter:new sT.ValueSetter(s.value,this.validate,this.set,this.priority,this.subPriority),rest:s.rest}}validate(t,e,i){return true}}qM.Parser=rT;WM.EraParser=void 0;var oT=qM;class aT extends oT.Parser{priority=140;parse(t,e,i){switch(e){case"G":case"GG":case"GGG":return i.era(t,{width:"abbreviated"})||i.era(t,{width:"narrow"});case"GGGGG":return i.era(t,{width:"narrow"});case"GGGG":default:return i.era(t,{width:"wide"})||i.era(t,{width:"abbreviated"})||i.era(t,{width:"narrow"})}}set(t,e,i){e.era=i;t.setFullYear(i,0,1);t.setHours(0,0,0,0);return t}incompatibleTokens=["R","u","t","T"]}WM.EraParser=aT;var hT={};var cT={};var uT={};uT.timezonePatterns=uT.numericPatterns=void 0;uT.numericPatterns={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/};uT.timezonePatterns={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};cT.dayPeriodEnumToHours=bT;cT.isLeapYearIndex=yT;cT.mapValue=dT;cT.normalizeTwoDigitYear=wT;cT.parseAnyDigitsSigned=_T;cT.parseNDigits=vT;cT.parseNDigitsSigned=gT;cT.parseNumericPattern=pT;cT.parseTimezonePattern=mT;var lT=jf;var fT=uT;function dT(t,e){if(!t){return t}return{value:e(t.value),rest:t.rest}}function pT(t,e){const i=e.match(t);if(!i){return null}return{value:parseInt(i[0],10),rest:e.slice(i[0].length)}}function mT(t,e){const i=e.match(t);if(!i){return null}if(i[0]==="Z"){return{value:0,rest:e.slice(1)}}const n=i[1]==="+"?1:-1;const s=i[2]?parseInt(i[2],10):0;const r=i[3]?parseInt(i[3],10):0;const o=i[5]?parseInt(i[5],10):0;return{value:n*(s*lT.millisecondsInHour+r*lT.millisecondsInMinute+o*lT.millisecondsInSecond),rest:e.slice(i[0].length)}}function _T(t){return pT(fT.numericPatterns.anyDigitsSigned,t)}function vT(t,e){switch(t){case 1:return pT(fT.numericPatterns.singleDigit,e);case 2:return pT(fT.numericPatterns.twoDigits,e);case 3:return pT(fT.numericPatterns.threeDigits,e);case 4:return pT(fT.numericPatterns.fourDigits,e);default:return pT(new RegExp("^\\d{1,"+t+"}"),e)}}function gT(t,e){switch(t){case 1:return pT(fT.numericPatterns.singleDigitSigned,e);case 2:return pT(fT.numericPatterns.twoDigitsSigned,e);case 3:return pT(fT.numericPatterns.threeDigitsSigned,e);case 4:return pT(fT.numericPatterns.fourDigitsSigned,e);default:return pT(new RegExp("^-?\\d{1,"+t+"}"),e)}}function bT(t){switch(t){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function wT(t,e){const i=e>0;const n=i?e:1-e;let s;if(n<=50){s=t||100}else{const e=n+50;const i=Math.trunc(e/100)*100;const r=t>=e%100;s=t+i-(r?100:0)}return i?s:1-s}function yT(t){return t%400===0||t%4===0&&t%100!==0}hT.YearParser=void 0;var xT=qM;var MT=cT;class TT extends xT.Parser{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(t,e,i){const n=t=>({year:t,isTwoDigitYear:e==="yy"});switch(e){case"y":return(0,MT.mapValue)((0,MT.parseNDigits)(4,t),n);case"yo":return(0,MT.mapValue)(i.ordinalNumber(t,{unit:"year"}),n);default:return(0,MT.mapValue)((0,MT.parseNDigits)(e.length,t),n)}}validate(t,e){return e.isTwoDigitYear||e.year>0}set(t,e,i){const n=t.getFullYear();if(i.isTwoDigitYear){const e=(0,MT.normalizeTwoDigitYear)(i.year,n);t.setFullYear(e,0,1);t.setHours(0,0,0,0);return t}const s=!("era"in e)||e.era===1?i.year:1-i.year;t.setFullYear(s,0,1);t.setHours(0,0,0,0);return t}}hT.YearParser=TT;var OT={};OT.LocalWeekYearParser=void 0;var ET=bb;var AT=Vf;var ST=qM;var kT=cT;class IT extends ST.Parser{priority=130;parse(t,e,i){const n=t=>({year:t,isTwoDigitYear:e==="YY"});switch(e){case"Y":return(0,kT.mapValue)((0,kT.parseNDigits)(4,t),n);case"Yo":return(0,kT.mapValue)(i.ordinalNumber(t,{unit:"year"}),n);default:return(0,kT.mapValue)((0,kT.parseNDigits)(e.length,t),n)}}validate(t,e){return e.isTwoDigitYear||e.year>0}set(t,e,i,n){const s=(0,ET.getWeekYear)(t,n);if(i.isTwoDigitYear){const e=(0,kT.normalizeTwoDigitYear)(i.year,s);t.setFullYear(e,0,n.firstWeekContainsDate);t.setHours(0,0,0,0);return(0,AT.startOfWeek)(t,n)}const r=!("era"in e)||e.era===1?i.year:1-i.year;t.setFullYear(r,0,n.firstWeekContainsDate);t.setHours(0,0,0,0);return(0,AT.startOfWeek)(t,n)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}OT.LocalWeekYearParser=IT;var CT={};CT.ISOWeekYearParser=void 0;var jT=Hf;var DT=Zl;var RT=qM;var PT=cT;class NT extends RT.Parser{priority=130;parse(t,e){if(e==="R"){return(0,PT.parseNDigitsSigned)(4,t)}return(0,PT.parseNDigitsSigned)(e.length,t)}set(t,e,i){const n=(0,DT.constructFrom)(t,0);n.setFullYear(i,0,4);n.setHours(0,0,0,0);return(0,jT.startOfISOWeek)(n)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}CT.ISOWeekYearParser=NT;var FT={};FT.ExtendedYearParser=void 0;var zT=qM;var LT=cT;class $T extends zT.Parser{priority=130;parse(t,e){if(e==="u"){return(0,LT.parseNDigitsSigned)(4,t)}return(0,LT.parseNDigitsSigned)(e.length,t)}set(t,e,i){t.setFullYear(i,0,1);t.setHours(0,0,0,0);return t}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}FT.ExtendedYearParser=$T;var UT={};UT.QuarterParser=void 0;var BT=qM;var GT=cT;class HT extends BT.Parser{priority=120;parse(t,e,i){switch(e){case"Q":case"QQ":return(0,GT.parseNDigits)(e.length,t);case"Qo":return i.ordinalNumber(t,{unit:"quarter"});case"QQQ":return i.quarter(t,{width:"abbreviated",context:"formatting"})||i.quarter(t,{width:"narrow",context:"formatting"});case"QQQQQ":return i.quarter(t,{width:"narrow",context:"formatting"});case"QQQQ":default:return i.quarter(t,{width:"wide",context:"formatting"})||i.quarter(t,{width:"abbreviated",context:"formatting"})||i.quarter(t,{width:"narrow",context:"formatting"})}}validate(t,e){return e>=1&&e<=4}set(t,e,i){t.setMonth((i-1)*3,1);t.setHours(0,0,0,0);return t}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}UT.QuarterParser=HT;var VT={};VT.StandAloneQuarterParser=void 0;var WT=qM;var qT=cT;class YT extends WT.Parser{priority=120;parse(t,e,i){switch(e){case"q":case"qq":return(0,qT.parseNDigits)(e.length,t);case"qo":return i.ordinalNumber(t,{unit:"quarter"});case"qqq":return i.quarter(t,{width:"abbreviated",context:"standalone"})||i.quarter(t,{width:"narrow",context:"standalone"});case"qqqqq":return i.quarter(t,{width:"narrow",context:"standalone"});case"qqqq":default:return i.quarter(t,{width:"wide",context:"standalone"})||i.quarter(t,{width:"abbreviated",context:"standalone"})||i.quarter(t,{width:"narrow",context:"standalone"})}}validate(t,e){return e>=1&&e<=4}set(t,e,i){t.setMonth((i-1)*3,1);t.setHours(0,0,0,0);return t}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}VT.StandAloneQuarterParser=YT;var XT={};XT.MonthParser=void 0;var ZT=uT;var JT=qM;var KT=cT;class QT extends JT.Parser{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(t,e,i){const n=t=>t-1;switch(e){case"M":return(0,KT.mapValue)((0,KT.parseNumericPattern)(ZT.numericPatterns.month,t),n);case"MM":return(0,KT.mapValue)((0,KT.parseNDigits)(2,t),n);case"Mo":return(0,KT.mapValue)(i.ordinalNumber(t,{unit:"month"}),n);case"MMM":return i.month(t,{width:"abbreviated",context:"formatting"})||i.month(t,{width:"narrow",context:"formatting"});case"MMMMM":return i.month(t,{width:"narrow",context:"formatting"});case"MMMM":default:return i.month(t,{width:"wide",context:"formatting"})||i.month(t,{width:"abbreviated",context:"formatting"})||i.month(t,{width:"narrow",context:"formatting"})}}validate(t,e){return e>=0&&e<=11}set(t,e,i){t.setMonth(i,1);t.setHours(0,0,0,0);return t}}XT.MonthParser=QT;var tO={};tO.StandAloneMonthParser=void 0;var eO=uT;var iO=qM;var nO=cT;class sO extends iO.Parser{priority=110;parse(t,e,i){const n=t=>t-1;switch(e){case"L":return(0,nO.mapValue)((0,nO.parseNumericPattern)(eO.numericPatterns.month,t),n);case"LL":return(0,nO.mapValue)((0,nO.parseNDigits)(2,t),n);case"Lo":return(0,nO.mapValue)(i.ordinalNumber(t,{unit:"month"}),n);case"LLL":return i.month(t,{width:"abbreviated",context:"standalone"})||i.month(t,{width:"narrow",context:"standalone"});case"LLLLL":return i.month(t,{width:"narrow",context:"standalone"});case"LLLL":default:return i.month(t,{width:"wide",context:"standalone"})||i.month(t,{width:"abbreviated",context:"standalone"})||i.month(t,{width:"narrow",context:"standalone"})}}validate(t,e){return e>=0&&e<=11}set(t,e,i){t.setMonth(i,1);t.setHours(0,0,0,0);return t}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}tO.StandAloneMonthParser=sO;var rO={};var oO={};oO.setWeek=cO;var aO=vb;var hO=Yl;function cO(t,e,i){const n=(0,hO.toDate)(t);const s=(0,aO.getWeek)(n,i)-e;n.setDate(n.getDate()-s*7);return n}rO.LocalWeekParser=void 0;var uO=oO;var lO=Vf;var fO=uT;var dO=qM;var pO=cT;class mO extends dO.Parser{priority=100;parse(t,e,i){switch(e){case"w":return(0,pO.parseNumericPattern)(fO.numericPatterns.week,t);case"wo":return i.ordinalNumber(t,{unit:"week"});default:return(0,pO.parseNDigits)(e.length,t)}}validate(t,e){return e>=1&&e<=53}set(t,e,i,n){return(0,lO.startOfWeek)((0,uO.setWeek)(t,i,n),n)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}rO.LocalWeekParser=mO;var _O={};var vO={};vO.setISOWeek=wO;var gO=lb;var bO=Yl;function wO(t,e){const i=(0,bO.toDate)(t);const n=(0,gO.getISOWeek)(i)-e;i.setDate(i.getDate()-n*7);return i}_O.ISOWeekParser=void 0;var yO=vO;var xO=Hf;var MO=uT;var TO=qM;var OO=cT;class EO extends TO.Parser{priority=100;parse(t,e,i){switch(e){case"I":return(0,OO.parseNumericPattern)(MO.numericPatterns.week,t);case"Io":return i.ordinalNumber(t,{unit:"week"});default:return(0,OO.parseNDigits)(e.length,t)}}validate(t,e){return e>=1&&e<=53}set(t,e,i){return(0,xO.startOfISOWeek)((0,yO.setISOWeek)(t,i))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}_O.ISOWeekParser=EO;var AO={};AO.DateParser=void 0;var SO=uT;var kO=qM;var IO=cT;const CO=[31,28,31,30,31,30,31,31,30,31,30,31];const jO=[31,29,31,30,31,30,31,31,30,31,30,31];class DO extends kO.Parser{priority=90;subPriority=1;parse(t,e,i){switch(e){case"d":return(0,IO.parseNumericPattern)(SO.numericPatterns.date,t);case"do":return i.ordinalNumber(t,{unit:"date"});default:return(0,IO.parseNDigits)(e.length,t)}}validate(t,e){const i=t.getFullYear();const n=(0,IO.isLeapYearIndex)(i);const s=t.getMonth();if(n){return e>=1&&e<=jO[s]}else{return e>=1&&e<=CO[s]}}set(t,e,i){t.setDate(i);t.setHours(0,0,0,0);return t}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}AO.DateParser=DO;var RO={};RO.DayOfYearParser=void 0;var PO=uT;var NO=qM;var FO=cT;class zO extends NO.Parser{priority=90;subpriority=1;parse(t,e,i){switch(e){case"D":case"DD":return(0,FO.parseNumericPattern)(PO.numericPatterns.dayOfYear,t);case"Do":return i.ordinalNumber(t,{unit:"date"});default:return(0,FO.parseNDigits)(e.length,t)}}validate(t,e){const i=t.getFullYear();const n=(0,FO.isLeapYearIndex)(i);if(n){return e>=1&&e<=366}else{return e>=1&&e<=365}}set(t,e,i){t.setMonth(0,i);t.setHours(0,0,0,0);return t}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}RO.DayOfYearParser=zO;var LO={};var $O={};$O.setDay=HO;var UO=ql;var BO=Yl;var GO=Wf;function HO(t,e,i){const n=(0,GO.getDefaultOptions)();const s=i?.weekStartsOn??i?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0;const r=(0,BO.toDate)(t);const o=r.getDay();const a=e%7;const h=(a+7)%7;const c=7-s;const u=e<0||e>6?e-(o+c)%7:(h+c)%7-(o+c)%7;return(0,UO.addDays)(r,u)}LO.DayParser=void 0;var VO=$O;var WO=qM;class qO extends WO.Parser{priority=90;parse(t,e,i){switch(e){case"E":case"EE":case"EEE":return i.day(t,{width:"abbreviated",context:"formatting"})||i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"});case"EEEEE":return i.day(t,{width:"narrow",context:"formatting"});case"EEEEEE":return i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"});case"EEEE":default:return i.day(t,{width:"wide",context:"formatting"})||i.day(t,{width:"abbreviated",context:"formatting"})||i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"})}}validate(t,e){return e>=0&&e<=6}set(t,e,i,n){t=(0,VO.setDay)(t,i,n);t.setHours(0,0,0,0);return t}incompatibleTokens=["D","i","e","c","t","T"]}LO.DayParser=qO;var YO={};YO.LocalDayParser=void 0;var XO=$O;var ZO=qM;var JO=cT;class KO extends ZO.Parser{priority=90;parse(t,e,i,n){const s=t=>{const e=Math.floor((t-1)/7)*7;return(t+n.weekStartsOn+6)%7+e};switch(e){case"e":case"ee":return(0,JO.mapValue)((0,JO.parseNDigits)(e.length,t),s);case"eo":return(0,JO.mapValue)(i.ordinalNumber(t,{unit:"day"}),s);case"eee":return i.day(t,{width:"abbreviated",context:"formatting"})||i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"});case"eeeee":return i.day(t,{width:"narrow",context:"formatting"});case"eeeeee":return i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"});case"eeee":default:return i.day(t,{width:"wide",context:"formatting"})||i.day(t,{width:"abbreviated",context:"formatting"})||i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"})}}validate(t,e){return e>=0&&e<=6}set(t,e,i,n){t=(0,XO.setDay)(t,i,n);t.setHours(0,0,0,0);return t}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}YO.LocalDayParser=KO;var QO={};QO.StandAloneLocalDayParser=void 0;var tE=$O;var eE=qM;var iE=cT;class nE extends eE.Parser{priority=90;parse(t,e,i,n){const s=t=>{const e=Math.floor((t-1)/7)*7;return(t+n.weekStartsOn+6)%7+e};switch(e){case"c":case"cc":return(0,iE.mapValue)((0,iE.parseNDigits)(e.length,t),s);case"co":return(0,iE.mapValue)(i.ordinalNumber(t,{unit:"day"}),s);case"ccc":return i.day(t,{width:"abbreviated",context:"standalone"})||i.day(t,{width:"short",context:"standalone"})||i.day(t,{width:"narrow",context:"standalone"});case"ccccc":return i.day(t,{width:"narrow",context:"standalone"});case"cccccc":return i.day(t,{width:"short",context:"standalone"})||i.day(t,{width:"narrow",context:"standalone"});case"cccc":default:return i.day(t,{width:"wide",context:"standalone"})||i.day(t,{width:"abbreviated",context:"standalone"})||i.day(t,{width:"short",context:"standalone"})||i.day(t,{width:"narrow",context:"standalone"})}}validate(t,e){return e>=0&&e<=6}set(t,e,i,n){t=(0,tE.setDay)(t,i,n);t.setHours(0,0,0,0);return t}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}QO.StandAloneLocalDayParser=nE;var sE={};var rE={};rE.setISODay=cE;var oE=ql;var aE=Vy;var hE=Yl;function cE(t,e){const i=(0,hE.toDate)(t);const n=(0,aE.getISODay)(i);const s=e-n;return(0,oE.addDays)(i,s)}sE.ISODayParser=void 0;var uE=rE;var lE=qM;var fE=cT;class dE extends lE.Parser{priority=90;parse(t,e,i){const n=t=>{if(t===0){return 7}return t};switch(e){case"i":case"ii":return(0,fE.parseNDigits)(e.length,t);case"io":return i.ordinalNumber(t,{unit:"day"});case"iii":return(0,fE.mapValue)(i.day(t,{width:"abbreviated",context:"formatting"})||i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"}),n);case"iiiii":return(0,fE.mapValue)(i.day(t,{width:"narrow",context:"formatting"}),n);case"iiiiii":return(0,fE.mapValue)(i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"}),n);case"iiii":default:return(0,fE.mapValue)(i.day(t,{width:"wide",context:"formatting"})||i.day(t,{width:"abbreviated",context:"formatting"})||i.day(t,{width:"short",context:"formatting"})||i.day(t,{width:"narrow",context:"formatting"}),n)}}validate(t,e){return e>=1&&e<=7}set(t,e,i){t=(0,uE.setISODay)(t,i);t.setHours(0,0,0,0);return t}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}sE.ISODayParser=dE;var pE={};pE.AMPMParser=void 0;var mE=qM;var _E=cT;class vE extends mE.Parser{priority=80;parse(t,e,i){switch(e){case"a":case"aa":case"aaa":return i.dayPeriod(t,{width:"abbreviated",context:"formatting"})||i.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaaa":return i.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaa":default:return i.dayPeriod(t,{width:"wide",context:"formatting"})||i.dayPeriod(t,{width:"abbreviated",context:"formatting"})||i.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,e,i){t.setHours((0,_E.dayPeriodEnumToHours)(i),0,0,0);return t}incompatibleTokens=["b","B","H","k","t","T"]}pE.AMPMParser=vE;var gE={};gE.AMPMMidnightParser=void 0;var bE=qM;var wE=cT;class yE extends bE.Parser{priority=80;parse(t,e,i){switch(e){case"b":case"bb":case"bbb":return i.dayPeriod(t,{width:"abbreviated",context:"formatting"})||i.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbbb":return i.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbb":default:return i.dayPeriod(t,{width:"wide",context:"formatting"})||i.dayPeriod(t,{width:"abbreviated",context:"formatting"})||i.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,e,i){t.setHours((0,wE.dayPeriodEnumToHours)(i),0,0,0);return t}incompatibleTokens=["a","B","H","k","t","T"]}gE.AMPMMidnightParser=yE;var xE={};xE.DayPeriodParser=void 0;var ME=qM;var TE=cT;class OE extends ME.Parser{priority=80;parse(t,e,i){switch(e){case"B":case"BB":case"BBB":return i.dayPeriod(t,{width:"abbreviated",context:"formatting"})||i.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBBB":return i.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBB":default:return i.dayPeriod(t,{width:"wide",context:"formatting"})||i.dayPeriod(t,{width:"abbreviated",context:"formatting"})||i.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,e,i){t.setHours((0,TE.dayPeriodEnumToHours)(i),0,0,0);return t}incompatibleTokens=["a","b","t","T"]}xE.DayPeriodParser=OE;var EE={};EE.Hour1to12Parser=void 0;var AE=uT;var SE=qM;var kE=cT;class IE extends SE.Parser{priority=70;parse(t,e,i){switch(e){case"h":return(0,kE.parseNumericPattern)(AE.numericPatterns.hour12h,t);case"ho":return i.ordinalNumber(t,{unit:"hour"});default:return(0,kE.parseNDigits)(e.length,t)}}validate(t,e){return e>=1&&e<=12}set(t,e,i){const n=t.getHours()>=12;if(n&&i<12){t.setHours(i+12,0,0,0)}else if(!n&&i===12){t.setHours(0,0,0,0)}else{t.setHours(i,0,0,0)}return t}incompatibleTokens=["H","K","k","t","T"]}EE.Hour1to12Parser=IE;var CE={};CE.Hour0to23Parser=void 0;var jE=uT;var DE=qM;var RE=cT;class PE extends DE.Parser{priority=70;parse(t,e,i){switch(e){case"H":return(0,RE.parseNumericPattern)(jE.numericPatterns.hour23h,t);case"Ho":return i.ordinalNumber(t,{unit:"hour"});default:return(0,RE.parseNDigits)(e.length,t)}}validate(t,e){return e>=0&&e<=23}set(t,e,i){t.setHours(i,0,0,0);return t}incompatibleTokens=["a","b","h","K","k","t","T"]}CE.Hour0to23Parser=PE;var NE={};NE.Hour0To11Parser=void 0;var FE=uT;var zE=qM;var LE=cT;class $E extends zE.Parser{priority=70;parse(t,e,i){switch(e){case"K":return(0,LE.parseNumericPattern)(FE.numericPatterns.hour11h,t);case"Ko":return i.ordinalNumber(t,{unit:"hour"});default:return(0,LE.parseNDigits)(e.length,t)}}validate(t,e){return e>=0&&e<=11}set(t,e,i){const n=t.getHours()>=12;if(n&&i<12){t.setHours(i+12,0,0,0)}else{t.setHours(i,0,0,0)}return t}incompatibleTokens=["h","H","k","t","T"]}NE.Hour0To11Parser=$E;var UE={};UE.Hour1To24Parser=void 0;var BE=uT;var GE=qM;var HE=cT;class VE extends GE.Parser{priority=70;parse(t,e,i){switch(e){case"k":return(0,HE.parseNumericPattern)(BE.numericPatterns.hour24h,t);case"ko":return i.ordinalNumber(t,{unit:"hour"});default:return(0,HE.parseNDigits)(e.length,t)}}validate(t,e){return e>=1&&e<=24}set(t,e,i){const n=i<=24?i%24:i;t.setHours(n,0,0,0);return t}incompatibleTokens=["a","b","h","H","K","t","T"]}UE.Hour1To24Parser=VE;var WE={};WE.MinuteParser=void 0;var qE=uT;var YE=qM;var XE=cT;class ZE extends YE.Parser{priority=60;parse(t,e,i){switch(e){case"m":return(0,XE.parseNumericPattern)(qE.numericPatterns.minute,t);case"mo":return i.ordinalNumber(t,{unit:"minute"});default:return(0,XE.parseNDigits)(e.length,t)}}validate(t,e){return e>=0&&e<=59}set(t,e,i){t.setMinutes(i,0,0);return t}incompatibleTokens=["t","T"]}WE.MinuteParser=ZE;var JE={};JE.SecondParser=void 0;var KE=uT;var QE=qM;var tA=cT;class eA extends QE.Parser{priority=50;parse(t,e,i){switch(e){case"s":return(0,tA.parseNumericPattern)(KE.numericPatterns.second,t);case"so":return i.ordinalNumber(t,{unit:"second"});default:return(0,tA.parseNDigits)(e.length,t)}}validate(t,e){return e>=0&&e<=59}set(t,e,i){t.setSeconds(i,0);return t}incompatibleTokens=["t","T"]}JE.SecondParser=eA;var iA={};iA.FractionOfSecondParser=void 0;var nA=qM;var sA=cT;class rA extends nA.Parser{priority=30;parse(t,e){const i=t=>Math.trunc(t*Math.pow(10,-e.length+3));return(0,sA.mapValue)((0,sA.parseNDigits)(e.length,t),i)}set(t,e,i){t.setMilliseconds(i);return t}incompatibleTokens=["t","T"]}iA.FractionOfSecondParser=rA;var oA={};oA.ISOTimezoneWithZParser=void 0;var aA=Zl;var hA=ud;var cA=uT;var uA=qM;var lA=cT;class fA extends uA.Parser{priority=10;parse(t,e){switch(e){case"X":return(0,lA.parseTimezonePattern)(cA.timezonePatterns.basicOptionalMinutes,t);case"XX":return(0,lA.parseTimezonePattern)(cA.timezonePatterns.basic,t);case"XXXX":return(0,lA.parseTimezonePattern)(cA.timezonePatterns.basicOptionalSeconds,t);case"XXXXX":return(0,lA.parseTimezonePattern)(cA.timezonePatterns.extendedOptionalSeconds,t);case"XXX":default:return(0,lA.parseTimezonePattern)(cA.timezonePatterns.extended,t)}}set(t,e,i){if(e.timestampIsSet)return t;return(0,aA.constructFrom)(t,t.getTime()-(0,hA.getTimezoneOffsetInMilliseconds)(t)-i)}incompatibleTokens=["t","T","x"]}oA.ISOTimezoneWithZParser=fA;var dA={};dA.ISOTimezoneParser=void 0;var pA=Zl;var mA=ud;var _A=uT;var vA=qM;var gA=cT;class bA extends vA.Parser{priority=10;parse(t,e){switch(e){case"x":return(0,gA.parseTimezonePattern)(_A.timezonePatterns.basicOptionalMinutes,t);case"xx":return(0,gA.parseTimezonePattern)(_A.timezonePatterns.basic,t);case"xxxx":return(0,gA.parseTimezonePattern)(_A.timezonePatterns.basicOptionalSeconds,t);case"xxxxx":return(0,gA.parseTimezonePattern)(_A.timezonePatterns.extendedOptionalSeconds,t);case"xxx":default:return(0,gA.parseTimezonePattern)(_A.timezonePatterns.extended,t)}}set(t,e,i){if(e.timestampIsSet)return t;return(0,pA.constructFrom)(t,t.getTime()-(0,mA.getTimezoneOffsetInMilliseconds)(t)-i)}incompatibleTokens=["t","T","X"]}dA.ISOTimezoneParser=bA;var wA={};wA.TimestampSecondsParser=void 0;var yA=Zl;var xA=qM;var MA=cT;class TA extends xA.Parser{priority=40;parse(t){return(0,MA.parseAnyDigitsSigned)(t)}set(t,e,i){return[(0,yA.constructFrom)(t,i*1e3),{timestampIsSet:true}]}incompatibleTokens="*"}wA.TimestampSecondsParser=TA;var OA={};OA.TimestampMillisecondsParser=void 0;var EA=Zl;var AA=qM;var SA=cT;class kA extends AA.Parser{priority=20;parse(t){return(0,SA.parseAnyDigitsSigned)(t)}set(t,e,i){return[(0,EA.constructFrom)(t,i),{timestampIsSet:true}]}incompatibleTokens="*"}OA.TimestampMillisecondsParser=kA;VM.parsers=void 0;var IA=WM;var CA=hT;var jA=OT;var DA=CT;var RA=FT;var PA=UT;var NA=VT;var FA=XT;var zA=tO;var LA=rO;var $A=_O;var UA=AO;var BA=RO;var GA=LO;var HA=YO;var VA=QO;var WA=sE;var qA=pE;var YA=gE;var XA=xE;var ZA=EE;var JA=CE;var KA=NE;var QA=UE;var tS=WE;var eS=JE;var iS=iA;var nS=oA;var sS=dA;var rS=wA;var oS=OA;VM.parsers={G:new IA.EraParser,y:new CA.YearParser,Y:new jA.LocalWeekYearParser,R:new DA.ISOWeekYearParser,u:new RA.ExtendedYearParser,Q:new PA.QuarterParser,q:new NA.StandAloneQuarterParser,M:new FA.MonthParser,L:new zA.StandAloneMonthParser,w:new LA.LocalWeekParser,I:new $A.ISOWeekParser,d:new UA.DateParser,D:new BA.DayOfYearParser,E:new GA.DayParser,e:new HA.LocalDayParser,c:new VA.StandAloneLocalDayParser,i:new WA.ISODayParser,a:new qA.AMPMParser,b:new YA.AMPMMidnightParser,B:new XA.DayPeriodParser,h:new ZA.Hour1to12Parser,H:new JA.Hour0to23Parser,K:new KA.Hour0To11Parser,k:new QA.Hour1To24Parser,m:new tS.MinuteParser,s:new eS.SecondParser,S:new iS.FractionOfSecondParser,X:new nS.ISOTimezoneWithZParser,x:new sS.ISOTimezoneParser,t:new rS.TimestampSecondsParser,T:new oS.TimestampMillisecondsParser};(function(t){Object.defineProperty(t,"longFormatters",{enumerable:true,get:function(){return r.longFormatters}});t.parse=m;Object.defineProperty(t,"parsers",{enumerable:true,get:function(){return a.parsers}});var e=Zl;var i=Ly;var n=ag;var s=Yl;var r=Zb;var o=tw;var a=VM;var h=YM;const c=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g;const u=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;const l=/^'([^]*?)'?$/;const f=/''/g;const d=/\S/;const p=/[a-zA-Z]/;function m(t,l,f,m){const v=(0,i.getDefaultOptions)();const g=m?.locale??v.locale??n.defaultLocale;const b=m?.firstWeekContainsDate??m?.locale?.options?.firstWeekContainsDate??v.firstWeekContainsDate??v.locale?.options?.firstWeekContainsDate??1;const w=m?.weekStartsOn??m?.locale?.options?.weekStartsOn??v.weekStartsOn??v.locale?.options?.weekStartsOn??0;if(l===""){if(t===""){return(0,s.toDate)(f)}else{return(0,e.constructFrom)(f,NaN)}}const y={firstWeekContainsDate:b,weekStartsOn:w,locale:g};const x=[new h.DateToSystemTimezoneSetter];const M=l.match(u).map((t=>{const e=t[0];if(e in r.longFormatters){const i=r.longFormatters[e];return i(t,g.formatLong)}return t})).join("").match(c);const T=[];for(let i of M){if(!m?.useAdditionalWeekYearTokens&&(0,o.isProtectedWeekYearToken)(i)){(0,o.warnOrThrowProtectedError)(i,l,t)}if(!m?.useAdditionalDayOfYearTokens&&(0,o.isProtectedDayOfYearToken)(i)){(0,o.warnOrThrowProtectedError)(i,l,t)}const n=i[0];const s=a.parsers[n];if(s){const{incompatibleTokens:r}=s;if(Array.isArray(r)){const t=T.find((t=>r.includes(t.token)||t.token===n));if(t){throw new RangeError(`The format string mustn't contain \`${t.fullToken}\` and \`${i}\` at the same time`)}}else if(s.incompatibleTokens==="*"&&T.length>0){throw new RangeError(`The format string mustn't contain \`${i}\` and any other token at the same time`)}T.push({token:n,fullToken:i});const o=s.run(t,i,g.match,y);if(!o){return(0,e.constructFrom)(f,NaN)}x.push(o.setter);t=o.rest}else{if(n.match(p)){throw new RangeError("Format string contains an unescaped latin alphabet character `"+n+"`")}if(i==="''"){i="'"}else if(n==="'"){i=_(i)}if(t.indexOf(i)===0){t=t.slice(i.length)}else{return(0,e.constructFrom)(f,NaN)}}}if(t.length>0&&d.test(t)){return(0,e.constructFrom)(f,NaN)}const O=x.map((t=>t.priority)).sort(((t,e)=>e-t)).filter(((t,e,i)=>i.indexOf(t)===e)).map((t=>x.filter((e=>e.priority===t)).sort(((t,e)=>e.subPriority-t.subPriority)))).map((t=>t[0]));let E=(0,s.toDate)(f);if(isNaN(E.getTime())){return(0,e.constructFrom)(f,NaN)}const A={};for(const t of O){if(!t.validate(E,y)){return(0,e.constructFrom)(f,NaN)}const i=t.set(E,A,y);if(Array.isArray(i)){E=i[0];Object.assign(A,i[1])}else{E=i}}return(0,e.constructFrom)(f,E)}function _(t){return t.match(l)[1].replace(f,"'")}})(HM);GM.isMatch=cS;var aS=Sp;var hS=HM;function cS(t,e,i){return(0,aS.isValid)((0,hS.parse)(t,e,new Date,i))}var uS={};uS.isMonday=fS;var lS=Yl;function fS(t){return(0,lS.toDate)(t).getDay()===1}var dS={};dS.isPast=mS;var pS=Yl;function mS(t){return+(0,pS.toDate)(t)<Date.now()}var _S={};var vS={};vS.startOfHour=bS;var gS=Yl;function bS(t){const e=(0,gS.toDate)(t);e.setMinutes(0,0,0);return e}_S.isSameHour=yS;var wS=vS;function yS(t,e){const i=(0,wS.startOfHour)(t);const n=(0,wS.startOfHour)(e);return+i===+n}var xS={};var MS={};MS.isSameWeek=OS;var TS=Vf;function OS(t,e,i){const n=(0,TS.startOfWeek)(t,i);const s=(0,TS.startOfWeek)(e,i);return+n===+s}xS.isSameISOWeek=AS;var ES=MS;function AS(t,e){return(0,ES.isSameWeek)(t,e,{weekStartsOn:1})}var SS={};SS.isSameISOWeekYear=IS;var kS=vd;function IS(t,e){const i=(0,kS.startOfISOWeekYear)(t);const n=(0,kS.startOfISOWeekYear)(e);return+i===+n}var CS={};CS.isSameMinute=DS;var jS=I_;function DS(t,e){const i=(0,jS.startOfMinute)(t);const n=(0,jS.startOfMinute)(e);return+i===+n}var RS={};RS.isSameMonth=NS;var PS=Yl;function NS(t,e){const i=(0,PS.toDate)(t);const n=(0,PS.toDate)(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()}var FS={};FS.isSameQuarter=LS;var zS=U_;function LS(t,e){const i=(0,zS.startOfQuarter)(t);const n=(0,zS.startOfQuarter)(e);return+i===+n}var $S={};var US={};US.startOfSecond=GS;var BS=Yl;function GS(t){const e=(0,BS.toDate)(t);e.setMilliseconds(0);return e}$S.isSameSecond=VS;var HS=US;function VS(t,e){const i=(0,HS.startOfSecond)(t);const n=(0,HS.startOfSecond)(e);return+i===+n}var WS={};WS.isSameYear=YS;var qS=Yl;function YS(t,e){const i=(0,qS.toDate)(t);const n=(0,qS.toDate)(e);return i.getFullYear()===n.getFullYear()}var XS={};XS.isThisHour=KS;var ZS=gp;var JS=_S;function KS(t){return(0,JS.isSameHour)(t,(0,ZS.constructNow)(t))}var QS={};QS.isThisISOWeek=ik;var tk=gp;var ek=xS;function ik(t){return(0,ek.isSameISOWeek)(t,(0,tk.constructNow)(t))}var nk={};nk.isThisMinute=ok;var sk=gp;var rk=CS;function ok(t){return(0,rk.isSameMinute)(t,(0,sk.constructNow)(t))}var ak={};ak.isThisMonth=uk;var hk=gp;var ck=RS;function uk(t){return(0,ck.isSameMonth)(t,(0,hk.constructNow)(t))}var lk={};lk.isThisQuarter=pk;var fk=gp;var dk=FS;function pk(t){return(0,dk.isSameQuarter)(t,(0,fk.constructNow)(t))}var mk={};mk.isThisSecond=gk;var _k=gp;var vk=$S;function gk(t){return(0,vk.isSameSecond)(t,(0,_k.constructNow)(t))}var bk={};bk.isThisWeek=xk;var wk=gp;var yk=MS;function xk(t,e){return(0,yk.isSameWeek)(t,(0,wk.constructNow)(t),e)}var Mk={};Mk.isThisYear=Ek;var Tk=gp;var Ok=WS;function Ek(t){return(0,Ok.isSameYear)(t,(0,Tk.constructNow)(t))}var Ak={};Ak.isThursday=kk;var Sk=Yl;function kk(t){return(0,Sk.toDate)(t).getDay()===4}var Ik={};Ik.isToday=Dk;var Ck=gp;var jk=Op;function Dk(t){return(0,jk.isSameDay)(t,(0,Ck.constructNow)(t))}var Rk={};Rk.isTomorrow=zk;var Pk=ql;var Nk=gp;var Fk=Op;function zk(t){return(0,Fk.isSameDay)(t,(0,Pk.addDays)((0,Nk.constructNow)(t),1))}var Lk={};Lk.isTuesday=Uk;var $k=Yl;function Uk(t){return(0,$k.toDate)(t).getDay()===2}var Bk={};Bk.isWednesday=Hk;var Gk=Yl;function Hk(t){return(0,Gk.toDate)(t).getDay()===3}var Vk={};Vk.isWithinInterval=qk;var Wk=Yl;function qk(t,e){const i=+(0,Wk.toDate)(t);const[n,s]=[+(0,Wk.toDate)(e.start),+(0,Wk.toDate)(e.end)].sort(((t,e)=>t-e));return i>=n&&i<=s}var Yk={};var Xk={};Xk.subDays=Jk;var Zk=ql;function Jk(t,e){return(0,Zk.addDays)(t,-e)}Yk.isYesterday=eI;var Kk=gp;var Qk=Op;var tI=Xk;function eI(t){return(0,Qk.isSameDay)(t,(0,tI.subDays)((0,Kk.constructNow)(t),1))}var iI={};iI.lastDayOfDecade=sI;var nI=Yl;function sI(t){const e=(0,nI.toDate)(t);const i=e.getFullYear();const n=9+Math.floor(i/10)*10;e.setFullYear(n+1,0,0);e.setHours(0,0,0,0);return e}var rI={};var oI={};oI.lastDayOfWeek=cI;var aI=Yl;var hI=Wf;function cI(t,e){const i=(0,hI.getDefaultOptions)();const n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??i.weekStartsOn??i.locale?.options?.weekStartsOn??0;const s=(0,aI.toDate)(t);const r=s.getDay();const o=(r<n?-7:0)+6-(r-n);s.setHours(0,0,0,0);s.setDate(s.getDate()+o);return s}rI.lastDayOfISOWeek=lI;var uI=oI;function lI(t){return(0,uI.lastDayOfWeek)(t,{weekStartsOn:1})}var fI={};fI.lastDayOfISOWeekYear=_I;var dI=Gf;var pI=Hf;var mI=Zl;function _I(t){const e=(0,dI.getISOWeekYear)(t);const i=(0,mI.constructFrom)(t,0);i.setFullYear(e+1,0,4);i.setHours(0,0,0,0);const n=(0,pI.startOfISOWeek)(i);n.setDate(n.getDate()-1);return n}var vI={};vI.lastDayOfQuarter=bI;var gI=Yl;function bI(t){const e=(0,gI.toDate)(t);const i=e.getMonth();const n=i-i%3+3;e.setMonth(n,0);e.setHours(0,0,0,0);return e}var wI={};wI.lastDayOfYear=xI;var yI=Yl;function xI(t){const e=(0,yI.toDate)(t);const i=e.getFullYear();e.setFullYear(i+1,0,0);e.setHours(0,0,0,0);return e}var MI={};(function(t){t.lightFormat=h;Object.defineProperty(t,"lightFormatters",{enumerable:true,get:function(){return n.lightFormatters}});var e=Sp;var i=Yl;var n=Fb;const s=/(\w)\1*|''|'(''|[^'])+('|$)|./g;const r=/^'([^]*?)'?$/;const o=/''/g;const a=/[a-zA-Z]/;function h(t,r){const o=(0,i.toDate)(t);if(!(0,e.isValid)(o)){throw new RangeError("Invalid time value")}const h=r.match(s);if(!h)return"";const u=h.map((t=>{if(t==="''"){return"'"}const e=t[0];if(e==="'"){return c(t)}const i=n.lightFormatters[e];if(i){return i(o,t)}if(e.match(a)){throw new RangeError("Format string contains an unescaped latin alphabet character `"+e+"`")}return t})).join("");return u}function c(t){const e=t.match(r);if(!e){return t}return e[1].replace(o,"'")}})(MI);var TI={};TI.milliseconds=EI;var OI=jf;function EI({years:t,months:e,weeks:i,days:n,hours:s,minutes:r,seconds:o}){let a=0;if(t)a+=t*OI.daysInYear;if(e)a+=e*(OI.daysInYear/12);if(i)a+=i*7;if(n)a+=n;let h=a*24*60*60;if(s)h+=s*60*60;if(r)h+=r*60;if(o)h+=o;return Math.trunc(h*1e3)}var AI={};AI.millisecondsToHours=kI;var SI=jf;function kI(t){const e=t/SI.millisecondsInHour;return Math.trunc(e)}var II={};II.millisecondsToMinutes=jI;var CI=jf;function jI(t){const e=t/CI.millisecondsInMinute;return Math.trunc(e)}var DI={};DI.millisecondsToSeconds=PI;var RI=jf;function PI(t){const e=t/RI.millisecondsInSecond;return Math.trunc(e)}var NI={};NI.minutesToHours=zI;var FI=jf;function zI(t){const e=t/FI.minutesInHour;return Math.trunc(e)}var LI={};LI.minutesToMilliseconds=UI;var $I=jf;function UI(t){return Math.trunc(t*$I.millisecondsInMinute)}var BI={};BI.minutesToSeconds=HI;var GI=jf;function HI(t){return Math.trunc(t*GI.secondsInMinute)}var VI={};VI.monthsToQuarters=qI;var WI=jf;function qI(t){const e=t/WI.monthsInQuarter;return Math.trunc(e)}var YI={};YI.monthsToYears=ZI;var XI=jf;function ZI(t){const e=t/XI.monthsInYear;return Math.trunc(e)}var JI={};JI.nextDay=tC;var KI=ql;var QI=xy;function tC(t,e){let i=e-(0,QI.getDay)(t);if(i<=0)i+=7;return(0,KI.addDays)(t,i)}var eC={};eC.nextFriday=nC;var iC=JI;function nC(t){return(0,iC.nextDay)(t,5)}var sC={};sC.nextMonday=oC;var rC=JI;function oC(t){return(0,rC.nextDay)(t,1)}var aC={};aC.nextSaturday=cC;var hC=JI;function cC(t){return(0,hC.nextDay)(t,6)}var uC={};uC.nextSunday=fC;var lC=JI;function fC(t){return(0,lC.nextDay)(t,0)}var dC={};dC.nextThursday=mC;var pC=JI;function mC(t){return(0,pC.nextDay)(t,4)}var _C={};_C.nextTuesday=gC;var vC=JI;function gC(t){return(0,vC.nextDay)(t,2)}var bC={};bC.nextWednesday=yC;var wC=JI;function yC(t){return(0,wC.nextDay)(t,3)}var xC={};xC.parseISO=TC;var MC=jf;function TC(t,e){const i=e?.additionalDigits??2;const n=kC(t);let s;if(n.date){const t=IC(n.date,i);s=CC(t.restDateString,t.year)}if(!s||isNaN(s.getTime())){return new Date(NaN)}const r=s.getTime();let o=0;let a;if(n.time){o=DC(n.time);if(isNaN(o)){return new Date(NaN)}}if(n.timezone){a=PC(n.timezone);if(isNaN(a)){return new Date(NaN)}}else{const t=new Date(r+o);const e=new Date(0);e.setFullYear(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());e.setHours(t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds());return e}return new Date(r+o+a)}const OC={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/};const EC=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/;const AC=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/;const SC=/^([+-])(\d{2})(?::?(\d{2}))?$/;function kC(t){const e={};const i=t.split(OC.dateTimeDelimiter);let n;if(i.length>2){return e}if(/:/.test(i[0])){n=i[0]}else{e.date=i[0];n=i[1];if(OC.timeZoneDelimiter.test(e.date)){e.date=t.split(OC.timeZoneDelimiter)[0];n=t.substr(e.date.length,t.length)}}if(n){const t=OC.timezone.exec(n);if(t){e.time=n.replace(t[1],"");e.timezone=t[1]}else{e.time=n}}return e}function IC(t,e){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)");const n=t.match(i);if(!n)return{year:NaN,restDateString:""};const s=n[1]?parseInt(n[1]):null;const r=n[2]?parseInt(n[2]):null;return{year:r===null?s:r*100,restDateString:t.slice((n[1]||n[2]).length)}}function CC(t,e){if(e===null)return new Date(NaN);const i=t.match(EC);if(!i)return new Date(NaN);const n=!!i[4];const s=jC(i[1]);const r=jC(i[2])-1;const o=jC(i[3]);const a=jC(i[4]);const h=jC(i[5])-1;if(n){if(!UC(e,a,h)){return new Date(NaN)}return NC(e,a,h)}else{const t=new Date(0);if(!LC(e,r,o)||!$C(e,s)){return new Date(NaN)}t.setUTCFullYear(e,r,Math.max(s,o));return t}}function jC(t){return t?parseInt(t):1}function DC(t){const e=t.match(AC);if(!e)return NaN;const i=RC(e[1]);const n=RC(e[2]);const s=RC(e[3]);if(!BC(i,n,s)){return NaN}return i*MC.millisecondsInHour+n*MC.millisecondsInMinute+s*1e3}function RC(t){return t&&parseFloat(t.replace(",","."))||0}function PC(t){if(t==="Z")return 0;const e=t.match(SC);if(!e)return 0;const i=e[1]==="+"?-1:1;const n=parseInt(e[2]);const s=e[3]&&parseInt(e[3])||0;if(!GC(n,s)){return NaN}return i*(n*MC.millisecondsInHour+s*MC.millisecondsInMinute)}function NC(t,e,i){const n=new Date(0);n.setUTCFullYear(t,0,4);const s=n.getUTCDay()||7;const r=(e-1)*7+i+1-s;n.setUTCDate(n.getUTCDate()+r);return n}const FC=[31,null,31,30,31,30,31,31,30,31,30,31];function zC(t){return t%400===0||t%4===0&&t%100!==0}function LC(t,e,i){return e>=0&&e<=11&&i>=1&&i<=(FC[e]||(zC(t)?29:28))}function $C(t,e){return e>=1&&e<=(zC(t)?366:365)}function UC(t,e,i){return e>=1&&e<=53&&i>=0&&i<=6}function BC(t,e,i){if(t===24){return e===0&&i===0}return i>=0&&i<60&&e>=0&&e<60&&t>=0&&t<25}function GC(t,e){return e>=0&&e<=59}var HC={};HC.parseJSON=VC;function VC(t){const e=t.match(/(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2})(?:\.(\d{0,7}))?(?:Z|(.)(\d{2}):?(\d{2})?)?/);if(e){return new Date(Date.UTC(+e[1],+e[2]-1,+e[3],+e[4]-(+e[9]||0)*(e[8]=="-"?-1:1),+e[5]-(+e[10]||0)*(e[8]=="-"?-1:1),+e[6],+((e[7]||"0")+"00").substring(0,3)))}return new Date(NaN)}var WC={};WC.previousDay=XC;var qC=xy;var YC=Xk;function XC(t,e){let i=(0,qC.getDay)(t)-e;if(i<=0)i+=7;return(0,YC.subDays)(t,i)}var ZC={};ZC.previousFriday=KC;var JC=WC;function KC(t){return(0,JC.previousDay)(t,5)}var QC={};QC.previousMonday=ej;var tj=WC;function ej(t){return(0,tj.previousDay)(t,1)}var ij={};ij.previousSaturday=sj;var nj=WC;function sj(t){return(0,nj.previousDay)(t,6)}var rj={};rj.previousSunday=aj;var oj=WC;function aj(t){return(0,oj.previousDay)(t,0)}var hj={};hj.previousThursday=uj;var cj=WC;function uj(t){return(0,cj.previousDay)(t,4)}var lj={};lj.previousTuesday=dj;var fj=WC;function dj(t){return(0,fj.previousDay)(t,2)}var pj={};pj.previousWednesday=_j;var mj=WC;function _j(t){return(0,mj.previousDay)(t,3)}var vj={};vj.quartersToMonths=bj;var gj=jf;function bj(t){return Math.trunc(t*gj.monthsInQuarter)}var wj={};wj.quartersToYears=xj;var yj=jf;function xj(t){const e=t/yj.quartersInYear;return Math.trunc(e)}var Mj={};Mj.roundToNearestHours=Aj;var Tj=bm;var Oj=Zl;var Ej=Yl;function Aj(t,e){const i=e?.nearestTo??1;if(i<1||i>12)return(0,Oj.constructFrom)(t,NaN);const n=(0,Ej.toDate)(t);const s=n.getMinutes()/60;const r=n.getSeconds()/60/60;const o=n.getMilliseconds()/1e3/60/60;const a=n.getHours()+s+r+o;const h=e?.roundingMethod??"round";const c=(0,Tj.getRoundingMethod)(h);const u=c(a/i)*i;const l=(0,Oj.constructFrom)(t,n);l.setHours(u,0,0,0);return l}var Sj={};Sj.roundToNearestMinutes=jj;var kj=bm;var Ij=Zl;var Cj=Yl;function jj(t,e){const i=e?.nearestTo??1;if(i<1||i>30)return(0,Ij.constructFrom)(t,NaN);const n=(0,Cj.toDate)(t);const s=n.getSeconds()/60;const r=n.getMilliseconds()/1e3/60;const o=n.getMinutes()+s+r;const a=e?.roundingMethod??"round";const h=(0,kj.getRoundingMethod)(a);const c=h(o/i)*i;const u=(0,Ij.constructFrom)(t,n);u.setMinutes(c,0,0);return u}var Dj={};Dj.secondsToHours=Pj;var Rj=jf;function Pj(t){const e=t/Rj.secondsInHour;return Math.trunc(e)}var Nj={};Nj.secondsToMilliseconds=zj;var Fj=jf;function zj(t){return t*Fj.millisecondsInSecond}var Lj={};Lj.secondsToMinutes=Uj;var $j=jf;function Uj(t){const e=t/$j.secondsInMinute;return Math.trunc(e)}var Bj={};var Gj={};Gj.setMonth=qj;var Hj=Zl;var Vj=Oy;var Wj=Yl;function qj(t,e){const i=(0,Wj.toDate)(t);const n=i.getFullYear();const s=i.getDate();const r=(0,Hj.constructFrom)(t,0);r.setFullYear(n,e,15);r.setHours(0,0,0,0);const o=(0,Vj.getDaysInMonth)(r);i.setMonth(e,Math.min(s,o));return i}Bj.set=Jj;var Yj=Zl;var Xj=Gj;var Zj=Yl;function Jj(t,e){let i=(0,Zj.toDate)(t);if(isNaN(+i)){return(0,Yj.constructFrom)(t,NaN)}if(e.year!=null){i.setFullYear(e.year)}if(e.month!=null){i=(0,Xj.setMonth)(i,e.month)}if(e.date!=null){i.setDate(e.date)}if(e.hours!=null){i.setHours(e.hours)}if(e.minutes!=null){i.setMinutes(e.minutes)}if(e.seconds!=null){i.setSeconds(e.seconds)}if(e.milliseconds!=null){i.setMilliseconds(e.milliseconds)}return i}var Kj={};Kj.setDate=tD;var Qj=Yl;function tD(t,e){const i=(0,Qj.toDate)(t);i.setDate(e);return i}var eD={};eD.setDayOfYear=nD;var iD=Yl;function nD(t,e){const i=(0,iD.toDate)(t);i.setMonth(0);i.setDate(e);return i}var sD={};sD.setDefaultOptions=oD;var rD=Wf;function oD(t){const e={};const i=(0,rD.getDefaultOptions)();for(const t in i){if(Object.prototype.hasOwnProperty.call(i,t)){e[t]=i[t]}}for(const i in t){if(Object.prototype.hasOwnProperty.call(t,i)){if(t[i]===undefined){delete e[i]}else{e[i]=t[i]}}}(0,rD.setDefaultOptions)(e)}var aD={};aD.setHours=cD;var hD=Yl;function cD(t,e){const i=(0,hD.toDate)(t);i.setHours(e);return i}var uD={};uD.setMilliseconds=fD;var lD=Yl;function fD(t,e){const i=(0,lD.toDate)(t);i.setMilliseconds(e);return i}var dD={};dD.setMinutes=mD;var pD=Yl;function mD(t,e){const i=(0,pD.toDate)(t);i.setMinutes(e);return i}var _D={};_D.setQuarter=bD;var vD=Gj;var gD=Yl;function bD(t,e){const i=(0,gD.toDate)(t);const n=Math.trunc(i.getMonth()/3)+1;const s=e-n;return(0,vD.setMonth)(i,i.getMonth()+s*3)}var wD={};wD.setSeconds=xD;var yD=Yl;function xD(t,e){const i=(0,yD.toDate)(t);i.setSeconds(e);return i}var MD={};MD.setWeekYear=kD;var TD=Zl;var OD=od;var ED=gb;var AD=Yl;var SD=Wf;function kD(t,e,i){const n=(0,SD.getDefaultOptions)();const s=i?.firstWeekContainsDate??i?.locale?.options?.firstWeekContainsDate??n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1;let r=(0,AD.toDate)(t);const o=(0,OD.differenceInCalendarDays)(r,(0,ED.startOfWeekYear)(r,i));const a=(0,TD.constructFrom)(t,0);a.setFullYear(e,0,s);a.setHours(0,0,0,0);r=(0,ED.startOfWeekYear)(a,i);r.setDate(r.getDate()+o);return r}var ID={};ID.setYear=DD;var CD=Zl;var jD=Yl;function DD(t,e){const i=(0,jD.toDate)(t);if(isNaN(+i)){return(0,CD.constructFrom)(t,NaN)}i.setFullYear(e);return i}var RD={};RD.startOfDecade=ND;var PD=Yl;function ND(t){const e=(0,PD.toDate)(t);const i=e.getFullYear();const n=Math.floor(i/10)*10;e.setFullYear(n,0,1);e.setHours(0,0,0,0);return e}var FD={};FD.startOfToday=LD;var zD=ad;function LD(){return(0,zD.startOfDay)(Date.now())}var $D={};$D.startOfTomorrow=UD;function UD(){const t=new Date;const e=t.getFullYear();const i=t.getMonth();const n=t.getDate();const s=new Date(0);s.setFullYear(e,i,n+1);s.setHours(0,0,0,0);return s}var BD={};BD.startOfYesterday=GD;function GD(){const t=new Date;const e=t.getFullYear();const i=t.getMonth();const n=t.getDate();const s=new Date(0);s.setFullYear(e,i,n-1);s.setHours(0,0,0,0);return s}var HD={};var VD={};VD.subMonths=qD;var WD=ef;function qD(t,e){return(0,WD.addMonths)(t,-e)}HD.sub=JD;var YD=Xk;var XD=VD;var ZD=Zl;function JD(t,e){const{years:i=0,months:n=0,weeks:s=0,days:r=0,hours:o=0,minutes:a=0,seconds:h=0}=e;const c=(0,XD.subMonths)(t,n+i*12);const u=(0,YD.subDays)(c,r+s*7);const l=a+o*60;const f=h+l*60;const d=f*1e3;const p=(0,ZD.constructFrom)(t,u.getTime()-d);return p}var KD={};KD.subBusinessDays=tR;var QD=lf;function tR(t,e){return(0,QD.addBusinessDays)(t,-e)}var eR={};eR.subHours=nR;var iR=Af;function nR(t,e){return(0,iR.addHours)(t,-e)}var sR={};sR.subMilliseconds=oR;var rR=Sf;function oR(t,e){return(0,rR.addMilliseconds)(t,-e)}var aR={};aR.subMinutes=cR;var hR=Id;function cR(t,e){return(0,hR.addMinutes)(t,-e)}var uR={};uR.subQuarters=fR;var lR=Rd;function fR(t,e){return(0,lR.addQuarters)(t,-e)}var dR={};dR.subSeconds=mR;var pR=Fd;function mR(t,e){return(0,pR.addSeconds)(t,-e)}var _R={};_R.subWeeks=gR;var vR=$d;function gR(t,e){return(0,vR.addWeeks)(t,-e)}var bR={};bR.subYears=yR;var wR=Gd;function yR(t,e){return(0,wR.addYears)(t,-e)}var xR={};xR.weeksToDays=TR;var MR=jf;function TR(t){return Math.trunc(t*MR.daysInWeek)}var OR={};OR.yearsToDays=AR;var ER=jf;function AR(t){return Math.trunc(t*ER.daysInYear)}var SR={};SR.yearsToMonths=IR;var kR=jf;function IR(t){return Math.trunc(t*kR.monthsInYear)}var CR={};CR.yearsToQuarters=DR;var jR=jf;function DR(t){return Math.trunc(t*jR.quartersInYear)}(function(t){var e=Wl;Object.keys(e).forEach((function(i){if(i==="default"||i==="__esModule")return;if(i in t&&t[i]===e[i])return;Object.defineProperty(t,i,{enumerable:true,get:function(){return e[i]}})}));var i=lf;Object.keys(i).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===i[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return i[e]}})}));var n=ql;Object.keys(n).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===n[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return n[e]}})}));var s=Af;Object.keys(s).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===s[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return s[e]}})}));var r=Bf;Object.keys(r).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===r[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return r[e]}})}));var o=Sf;Object.keys(o).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===o[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return o[e]}})}));var a=Id;Object.keys(a).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===a[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return a[e]}})}));var h=ef;Object.keys(h).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===h[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return h[e]}})}));var c=Rd;Object.keys(c).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===c[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return c[e]}})}));var u=Fd;Object.keys(u).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===u[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return u[e]}})}));var l=$d;Object.keys(l).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===l[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return l[e]}})}));var f=Gd;Object.keys(f).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===f[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return f[e]}})}));var d=Wd;Object.keys(d).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===d[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return d[e]}})}));var p=Xd;Object.keys(p).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===p[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return p[e]}})}));var m=rp;Object.keys(m).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===m[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return m[e]}})}));var _=hp;Object.keys(_).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===_[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return _[e]}})}));var v=fp;Object.keys(v).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===v[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return v[e]}})}));var g=mp;Object.keys(g).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===g[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return g[e]}})}));var b=Zl;Object.keys(b).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===b[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return b[e]}})}));var w=gp;Object.keys(w).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===w[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return w[e]}})}));var y=yp;Object.keys(y).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===y[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return y[e]}})}));var x=Tp;Object.keys(x).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===x[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return x[e]}})}));var M=od;Object.keys(M).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===M[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return M[e]}})}));var T=Up;Object.keys(T).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===T[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return T[e]}})}));var O=Hp;Object.keys(O).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===O[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return O[e]}})}));var E=Xp;Object.keys(E).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===E[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return E[e]}})}));var A=Kp;Object.keys(A).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===A[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return A[e]}})}));var S=rm;Object.keys(S).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===S[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return S[e]}})}));var k=um;Object.keys(k).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===k[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return k[e]}})}));var I=dm;Object.keys(I).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===I[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return I[e]}})}));var C=gm;Object.keys(C).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===C[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return C[e]}})}));var j=Sm;Object.keys(j).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===j[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return j[e]}})}));var D=ym;Object.keys(D).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===D[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return D[e]}})}));var R=Fm;Object.keys(R).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===R[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return R[e]}})}));var P=Bm;Object.keys(P).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===P[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return P[e]}})}));var N=r_;Object.keys(N).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===N[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return N[e]}})}));var F=c_;Object.keys(F).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===F[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return F[e]}})}));var z=d_;Object.keys(z).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===z[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return z[e]}})}));var L=v_;Object.keys(L).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===L[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return L[e]}})}));var $=x_;Object.keys($).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===$[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return $[e]}})}));var U=O_;Object.keys(U).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===U[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return U[e]}})}));var B=k_;Object.keys(B).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===B[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return B[e]}})}));var G=F_;Object.keys(G).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===G[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return G[e]}})}));var H=$_;Object.keys(H).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===H[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return H[e]}})}));var V=Y_;Object.keys(V).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===V[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return V[e]}})}));var W=Q_;Object.keys(W).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===W[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return W[e]}})}));var q=nv;Object.keys(q).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===q[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return q[e]}})}));var Y=lv;Object.keys(Y).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Y[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Y[e]}})}));var X=Mv;Object.keys(X).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===X[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return X[e]}})}));var Z=Hm;Object.keys(Z).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Z[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Z[e]}})}));var J=Ev;Object.keys(J).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===J[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return J[e]}})}));var K=kv;Object.keys(K).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===K[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return K[e]}})}));var Q=jv;Object.keys(Q).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Q[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Q[e]}})}));var tt=Lv;Object.keys(tt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===tt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return tt[e]}})}));var et=Hv;Object.keys(et).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===et[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return et[e]}})}));var it=qm;Object.keys(it).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===it[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return it[e]}})}));var nt=qv;Object.keys(nt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===nt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return nt[e]}})}));var st=Zv;Object.keys(st).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===st[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return st[e]}})}));var rt=Qv;Object.keys(rt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===rt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return rt[e]}})}));var ot=ig;Object.keys(ot).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ot[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ot[e]}})}));var at=Dv;Object.keys(at).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===at[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return at[e]}})}));var ht=fv;Object.keys(ht).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ht[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ht[e]}})}));var ct=sg;Object.keys(ct).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ct[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ct[e]}})}));var ut=og;Object.keys(ut).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ut[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ut[e]}})}));var lt=hw;Object.keys(lt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===lt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return lt[e]}})}));var ft=gw;Object.keys(ft).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ft[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ft[e]}})}));var dt=Aw;Object.keys(dt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===dt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return dt[e]}})}));var pt=Cw;Object.keys(pt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===pt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return pt[e]}})}));var mt=Pw;Object.keys(mt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===mt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return mt[e]}})}));var _t=$w;Object.keys(_t).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===_t[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return _t[e]}})}));var vt=Hw;Object.keys(vt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===vt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return vt[e]}})}));var gt=Xw;Object.keys(gt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===gt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return gt[e]}})}));var bt=Jw;Object.keys(bt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===bt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return bt[e]}})}));var wt=iy;Object.keys(wt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===wt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return wt[e]}})}));var yt=cy;Object.keys(yt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===yt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return yt[e]}})}));var xt=_y;Object.keys(xt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===xt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return xt[e]}})}));var Mt=by;Object.keys(Mt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Mt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Mt[e]}})}));var Tt=xy;Object.keys(Tt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Tt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Tt[e]}})}));var Ot=ob;Object.keys(Ot).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ot[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ot[e]}})}));var Et=Oy;Object.keys(Et).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Et[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Et[e]}})}));var At=ky;Object.keys(At).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===At[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return At[e]}})}));var St=Ny;Object.keys(St).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===St[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return St[e]}})}));var kt=Ly;Object.keys(kt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===kt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return kt[e]}})}));var It=By;Object.keys(It).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===It[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return It[e]}})}));var Ct=Vy;Object.keys(Ct).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ct[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ct[e]}})}));var jt=lb;Object.keys(jt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===jt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return jt[e]}})}));var Dt=Gf;Object.keys(Dt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Dt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Dt[e]}})}));var Rt=Yy;Object.keys(Rt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Rt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Rt[e]}})}));var Pt=Qy;Object.keys(Pt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Pt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Pt[e]}})}));var Nt=ix;Object.keys(Nt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Nt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Nt[e]}})}));var Ft=rx;Object.keys(Ft).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ft[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ft[e]}})}));var zt=hx;Object.keys(zt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===zt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return zt[e]}})}));var Lt=Qp;Object.keys(Lt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Lt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Lt[e]}})}));var $t=dx;Object.keys($t).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===$t[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return $t[e]}})}));var Ut=_x;Object.keys(Ut).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ut[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ut[e]}})}));var Bt=bx;Object.keys(Bt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Bt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Bt[e]}})}));var Gt=vb;Object.keys(Gt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Gt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Gt[e]}})}));var Ht=xx;Object.keys(Ht).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ht[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ht[e]}})}));var Vt=bb;Object.keys(Vt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Vt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Vt[e]}})}));var Wt=Sx;Object.keys(Wt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Wt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Wt[e]}})}));var qt=Nx;Object.keys(qt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===qt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return qt[e]}})}));var Yt=Lx;Object.keys(Yt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Yt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Yt[e]}})}));var Xt=Bx;Object.keys(Xt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Xt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Xt[e]}})}));var Zt=Vx;Object.keys(Zt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Zt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Zt[e]}})}));var Jt=Yx;Object.keys(Jt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Jt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Jt[e]}})}));var Kt=Jx;Object.keys(Kt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Kt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Kt[e]}})}));var Qt=aM;Object.keys(Qt).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Qt[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Qt[e]}})}));var te=lM;Object.keys(te).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===te[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return te[e]}})}));var ee=MM;Object.keys(ee).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ee[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ee[e]}})}));var ie=EM;Object.keys(ie).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ie[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ie[e]}})}));var ne=kp;Object.keys(ne).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ne[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ne[e]}})}));var se=kM;Object.keys(se).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===se[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return se[e]}})}));var re=jM;Object.keys(re).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===re[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return re[e]}})}));var oe=RM;Object.keys(oe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===oe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return oe[e]}})}));var ae=FM;Object.keys(ae).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ae[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ae[e]}})}));var he=$M;Object.keys(he).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===he[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return he[e]}})}));var ce=Gm;Object.keys(ce).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ce[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ce[e]}})}));var ue=Iy;Object.keys(ue).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ue[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ue[e]}})}));var le=GM;Object.keys(le).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===le[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return le[e]}})}));var fe=uS;Object.keys(fe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===fe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return fe[e]}})}));var de=dS;Object.keys(de).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===de[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return de[e]}})}));var pe=Op;Object.keys(pe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===pe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return pe[e]}})}));var me=_S;Object.keys(me).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===me[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return me[e]}})}));var _e=xS;Object.keys(_e).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===_e[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return _e[e]}})}));var ve=SS;Object.keys(ve).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ve[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ve[e]}})}));var ge=CS;Object.keys(ge).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ge[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ge[e]}})}));var be=RS;Object.keys(be).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===be[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return be[e]}})}));var we=FS;Object.keys(we).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===we[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return we[e]}})}));var ye=$S;Object.keys(ye).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ye[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ye[e]}})}));var xe=MS;Object.keys(xe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===xe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return xe[e]}})}));var Me=WS;Object.keys(Me).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Me[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Me[e]}})}));var Te=ff;Object.keys(Te).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Te[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Te[e]}})}));var Oe=mf;Object.keys(Oe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Oe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Oe[e]}})}));var Ee=XS;Object.keys(Ee).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ee[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ee[e]}})}));var Ae=QS;Object.keys(Ae).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ae[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ae[e]}})}));var Se=nk;Object.keys(Se).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Se[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Se[e]}})}));var ke=ak;Object.keys(ke).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ke[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ke[e]}})}));var Ie=lk;Object.keys(Ie).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ie[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ie[e]}})}));var Ce=mk;Object.keys(Ce).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ce[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ce[e]}})}));var je=bk;Object.keys(je).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===je[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return je[e]}})}));var De=Mk;Object.keys(De).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===De[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return De[e]}})}));var Re=Ak;Object.keys(Re).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Re[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Re[e]}})}));var Pe=Ik;Object.keys(Pe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Pe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Pe[e]}})}));var Ne=Rk;Object.keys(Ne).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ne[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ne[e]}})}));var Fe=Lk;Object.keys(Fe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Fe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Fe[e]}})}));var ze=Sp;Object.keys(ze).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ze[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ze[e]}})}));var Le=Bk;Object.keys(Le).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Le[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Le[e]}})}));var $e=gf;Object.keys($e).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===$e[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return $e[e]}})}));var Ue=Vk;Object.keys(Ue).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ue[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ue[e]}})}));var Be=Yk;Object.keys(Be).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Be[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Be[e]}})}));var Ge=iI;Object.keys(Ge).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ge[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ge[e]}})}));var He=rI;Object.keys(He).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===He[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return He[e]}})}));var Ve=fI;Object.keys(Ve).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ve[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ve[e]}})}));var We=kx;Object.keys(We).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===We[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return We[e]}})}));var qe=vI;Object.keys(qe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===qe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return qe[e]}})}));var Ye=oI;Object.keys(Ye).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ye[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ye[e]}})}));var Xe=wI;Object.keys(Xe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Xe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Xe[e]}})}));var Ze=MI;Object.keys(Ze).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ze[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ze[e]}})}));var Je=Zd;Object.keys(Je).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Je[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Je[e]}})}));var Ke=TI;Object.keys(Ke).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ke[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ke[e]}})}));var Qe=AI;Object.keys(Qe).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Qe[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Qe[e]}})}));var ti=II;Object.keys(ti).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ti[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ti[e]}})}));var ei=DI;Object.keys(ei).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ei[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ei[e]}})}));var ii=Qd;Object.keys(ii).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ii[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ii[e]}})}));var ni=NI;Object.keys(ni).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ni[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ni[e]}})}));var si=LI;Object.keys(si).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===si[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return si[e]}})}));var ri=BI;Object.keys(ri).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ri[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ri[e]}})}));var oi=VI;Object.keys(oi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===oi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return oi[e]}})}));var ai=YI;Object.keys(ai).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ai[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ai[e]}})}));var hi=JI;Object.keys(hi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===hi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return hi[e]}})}));var ci=eC;Object.keys(ci).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ci[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ci[e]}})}));var ui=sC;Object.keys(ui).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ui[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ui[e]}})}));var li=aC;Object.keys(li).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===li[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return li[e]}})}));var fi=uC;Object.keys(fi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===fi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return fi[e]}})}));var di=dC;Object.keys(di).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===di[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return di[e]}})}));var pi=_C;Object.keys(pi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===pi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return pi[e]}})}));var mi=bC;Object.keys(mi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===mi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return mi[e]}})}));var _i=HM;Object.keys(_i).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===_i[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return _i[e]}})}));var vi=xC;Object.keys(vi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===vi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return vi[e]}})}));var gi=HC;Object.keys(gi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===gi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return gi[e]}})}));var bi=WC;Object.keys(bi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===bi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return bi[e]}})}));var wi=ZC;Object.keys(wi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===wi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return wi[e]}})}));var yi=QC;Object.keys(yi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===yi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return yi[e]}})}));var xi=ij;Object.keys(xi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===xi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return xi[e]}})}));var Mi=rj;Object.keys(Mi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Mi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Mi[e]}})}));var Ti=hj;Object.keys(Ti).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ti[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ti[e]}})}));var Oi=lj;Object.keys(Oi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Oi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Oi[e]}})}));var Ei=pj;Object.keys(Ei).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ei[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ei[e]}})}));var Ai=vj;Object.keys(Ai).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ai[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ai[e]}})}));var Si=wj;Object.keys(Si).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Si[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Si[e]}})}));var ki=Mj;Object.keys(ki).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ki[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ki[e]}})}));var Ii=Sj;Object.keys(Ii).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ii[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ii[e]}})}));var Ci=Dj;Object.keys(Ci).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ci[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ci[e]}})}));var ji=Nj;Object.keys(ji).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ji[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ji[e]}})}));var Di=Lj;Object.keys(Di).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Di[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Di[e]}})}));var Ri=Bj;Object.keys(Ri).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ri[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ri[e]}})}));var Pi=Kj;Object.keys(Pi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Pi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Pi[e]}})}));var Ni=$O;Object.keys(Ni).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ni[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ni[e]}})}));var Fi=eD;Object.keys(Fi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Fi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Fi[e]}})}));var zi=sD;Object.keys(zi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===zi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return zi[e]}})}));var Li=aD;Object.keys(Li).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Li[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Li[e]}})}));var $i=rE;Object.keys($i).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===$i[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return $i[e]}})}));var Ui=vO;Object.keys(Ui).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ui[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ui[e]}})}));var Bi=rd;Object.keys(Bi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Bi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Bi[e]}})}));var Gi=uD;Object.keys(Gi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Gi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Gi[e]}})}));var Hi=dD;Object.keys(Hi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Hi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Hi[e]}})}));var Vi=Gj;Object.keys(Vi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Vi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Vi[e]}})}));var Wi=_D;Object.keys(Wi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Wi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Wi[e]}})}));var qi=wD;Object.keys(qi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===qi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return qi[e]}})}));var Yi=oO;Object.keys(Yi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Yi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Yi[e]}})}));var Xi=MD;Object.keys(Xi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Xi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Xi[e]}})}));var Zi=ID;Object.keys(Zi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Zi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Zi[e]}})}));var Ji=ad;Object.keys(Ji).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ji[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ji[e]}})}));var Ki=RD;Object.keys(Ki).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Ki[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Ki[e]}})}));var Qi=vS;Object.keys(Qi).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Qi[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Qi[e]}})}));var tn=Hf;Object.keys(tn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===tn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return tn[e]}})}));var en=vd;Object.keys(en).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===en[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return en[e]}})}));var nn=I_;Object.keys(nn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===nn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return nn[e]}})}));var sn=sv;Object.keys(sn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===sn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return sn[e]}})}));var rn=U_;Object.keys(rn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===rn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return rn[e]}})}));var on=US;Object.keys(on).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===on[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return on[e]}})}));var an=FD;Object.keys(an).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===an[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return an[e]}})}));var hn=$D;Object.keys(hn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===hn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return hn[e]}})}));var cn=Vf;Object.keys(cn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===cn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return cn[e]}})}));var un=gb;Object.keys(un).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===un[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return un[e]}})}));var ln=mv;Object.keys(ln).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===ln[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return ln[e]}})}));var fn=BD;Object.keys(fn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===fn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return fn[e]}})}));var dn=HD;Object.keys(dn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===dn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return dn[e]}})}));var pn=KD;Object.keys(pn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===pn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return pn[e]}})}));var mn=Xk;Object.keys(mn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===mn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return mn[e]}})}));var _n=eR;Object.keys(_n).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===_n[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return _n[e]}})}));var vn=km;Object.keys(vn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===vn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return vn[e]}})}));var gn=sR;Object.keys(gn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===gn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return gn[e]}})}));var bn=aR;Object.keys(bn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===bn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return bn[e]}})}));var wn=VD;Object.keys(wn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===wn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return wn[e]}})}));var yn=uR;Object.keys(yn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===yn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return yn[e]}})}));var xn=dR;Object.keys(xn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===xn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return xn[e]}})}));var Mn=_R;Object.keys(Mn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Mn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Mn[e]}})}));var Tn=bR;Object.keys(Tn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Tn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Tn[e]}})}));var On=Yl;Object.keys(On).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===On[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return On[e]}})}));var En=XM;Object.keys(En).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===En[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return En[e]}})}));var An=xR;Object.keys(An).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===An[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return An[e]}})}));var Sn=OR;Object.keys(Sn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===Sn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return Sn[e]}})}));var kn=SR;Object.keys(kn).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===kn[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return kn[e]}})}));var In=CR;Object.keys(In).forEach((function(e){if(e==="default"||e==="__esModule")return;if(e in t&&t[e]===In[e])return;Object.defineProperty(t,e,{enumerable:true,get:function(){return In[e]}})}))})(Vl);function RR(t,e){const i=typeof t==="string"||t instanceof String?Vl.parseISO(t.toString()):new Date(t);let n=null;if(e&&typeof e.seconds==="number"){n=new Date(e.seconds*1e3)}else{n=typeof e==="string"||e instanceof String?Vl.parseISO(e.toString()):new Date(e)}const s=Vl.differenceInMilliseconds(i,n);return s}function PR(t,e,i,n,s=false){const r=6371;const o=(i-t)*Math.PI/180;const a=(n-e)*Math.PI/180;const h=Math.sin(o/2)*Math.sin(o/2)+Math.cos(t*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);const c=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));const u=r*c;if(!s){if(u>1)return Math.round(u)+"km";else if(u<=1)return Math.round(u*1e3)+"m"}else{if(u>1)return Math.round(u);else if(u<=1)return Math.round(u*1e3)}return u}async function NR(t,e){return new Promise((async(i,n)=>{const s="https://eu1.locationiq.com/v1/reverse.php?addressdetails=1&key="+ut+"&lat="+t+"&lon="+e+"&format=json&accept-language=en";const r=await fetch(s);if(r.ok){i(r.json())}else{n(r.text)}}))}function FR(t,e){if(!dt.exports.isNumber(dt.exports.toNumber(t)))t=0;return(new Intl.NumberFormat).format(t)}function zR(t,e=false){const i="/_,:;";const n="aaaaaaaaaacccddeeeeeeeegghiiiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------";const s=new RegExp(i.split("").join("|"),"g");return t.toString().toLowerCase().replace(/\s+/g,e?"+":"-").replace(s,(t=>n.charAt(i.indexOf(t)))).replace(/&/g,"-and-").replace(!e?/[^\w\-]+/g:"","").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function LR(t,e,i){let n=null;if(t){var s=new RegExp(e,"g");n=t.replace(s,i)}return n}function $R(t="USD,EUR,CHF"){return new Promise((async(e,i)=>{const n="https://corsproxy.io/?http://api.exchangeratesapi.io/v1/latest?access_key="+lt+"&symbols="+t+"&format=1";try{const t=await fetch(n,{method:"GET",mode:"cors",cache:"no-cache",credentials:"omit",redirect:"follow",referrerPolicy:"no-referrer"});if(t.ok){e(t.json())}else{i(t.text)}}catch(t){i(t)}}))}const UR=56;const BR=44;function GR(){document.documentElement.style.setProperty("--coverHeight",HR()+"px");document.documentElement.style.setProperty("--coverHeightModal",HR()-25+"px")}function HR(){return document.documentElement.clientHeight*25/100}function VR(t,e=false){let i=0;if(HL.deviceInfo.operatingSystem!=="ios"){i=window.innerHeight-(e?HR():t&&t.coverURL?HR():0)-UR*2}else{i=window.innerHeight-(e?HR():t&&t.coverURL?HR():0)-BR+UR}document.documentElement.style.setProperty("--mapHeight",i+"px");return i-20}function WR(t,e=2,i=false){const n=0;if(HL.deviceInfo.operatingSystem!=="ios"){return window.innerHeight-(t&&t.coverURL?HR():0)-UR*e-(i?document.documentElement.clientHeight*n/100:0)}else{return window.innerHeight-(t&&t.coverURL?HR():0)-BR+UR*(e-1)-(i?document.documentElement.clientHeight*n/100:0)}}function qR(t){if(HL.deviceInfo.operatingSystem!=="ios"){return t*UR+HR()}else{if(t==2){return BR+UR+HR()}else{return UR+HR()}}}function YR(t){return-qR(t)+"px"}async function XR(){const t="https://api.ipify.org/?format=json";let e=await fetch(t);return await e.json()}async function ZR(t=false){if(t){const t=await XR();const e="https://worldtimeapi.org/api/ip/"+t.ip+".json";const i=await fetch(e);try{const t=await i.json();return new Date(t.datetime)}catch(t){return new Date}}else{return new Date}}function JR(t){let e=null;switch(t){case 1:e={sm:12,md:12,lg:12};break;case 2:e={sm:12,md:6,lg:6};break;default:e={sm:12,md:6,lg:4};break}return e}function KR(){return"_"+Math.random().toString(36).slice(2,9)}function QR(t,e){e=dt.exports.toNumber(e);return dt.exports.toNumber(dt.exports.round(t,e).toFixed(e))}function tP(t){const e={};Object.keys(t).map((i=>{e[i.toLowerCase()]=t[i]}));return e}function eP(t,e){const i=dt.exports.reduce(t,((t,i,n)=>{if(!dt.exports.isEqual(i,e[n])){t[n]={object1:i,object2:e[n]}}return t}),{});dt.exports.forOwn(e,((e,n)=>{if(!(n in t)){i[n]={object1:undefined,object2:e}}}));return i}function iP(t,e,i=false){if(dt.exports.isString(t)){const n=Vl.parseISO(t);let s,r;switch(e){case"date":r=i?"dd/MM/yyyy":"PP";s=Vl.format(n,r);break;case"date-time":r=i?"dd/MM/yyyy HH:mm":"PPp";s=Vl.format(n,r);break;case"time-date":r=i?"HH:mm dd/MM/yyyy":"PPp";s=Vl.format(n,r);break;case"month":s=Vl.format(n,"MMM");break;case"month-year":s=Vl.format(n,"MMM/yyyy");break;case"time":r=i?"HH:mm:ss":"pp";s=Vl.format(n,r);break;case"year":s=Vl.format(n,"yyyy");break;default:s=n.toString()}return s}else{return t}}function nP(t){return!isNaN(new Date(t).getTime())}class sP{constructor(t){this.isTranslated={de:false,en:true,es:false,fr:false,it:false,ko:false,zh:false,pt:false,sv:false,ru:false};this.input=t}}const rP="translations";class oP{constructor(){this.currentSetLang="en";this.translations={};this.updatedTranslation=new L({});this.missingTranslationsList={};this.translationsLoaded=false}async init(t){t=t?t:this.currentSetLang;const e=await $L.getLocalDocument(rP);if(e&&Object.keys(e).length>0){this.translations=e;this.translationsLoaded=true;this.updateTranslations()}else{this.downloadData()}this.setLanguage(t);HL.systemPreferences$.subscribe((async t=>{const e=await $L.getLocalDocument("translationsUpdated");if(!e){this.downloadData()}else if(t.collectionsUpdate&&t.collectionsUpdate.translations){if(RR(e,t.collectionsUpdate.translations)<0){this.downloadData()}}}))}async downloadData(){const t=await $L.getFirebaseDocument(BL,rP);if(t){this.translations=t;this.saveLocalTranslations()}}saveLocalTranslations(){$L.saveLocalDocument(rP,this.translations);$L.saveLocalDocument("translationsUpdated",new Date);this.translationsLoaded=true;this.updateTranslations()}setLanguage(t){this.currentSetLang=t;$L.saveLocalDocument("language",t);this.updateTranslations()}async updateTranslations(){if(this.translations)this.updatedTranslation.next(this.translations)}getTransl(t,e,i,n){if(!n)n=this.currentSetLang;var s=null;if(!e){e=dt.exports.upperFirst(LR(t,"-"," "))}if(this.translations&&this.translations[t]){if(this.translations[t].translated&&this.translations[t].translated[n]){s=this.translations[t].translated[n]}else if(this.translations[t].translated&&this.translations[t].translated.en){s=this.translations[t].translated.en}else{this.missingTranslation(t,e);s=e}}else{this.missingTranslation(t,e);s=e}if(i&&Object.keys(i).length>0){Object.keys(i).map((t=>{s=s.replace(t,i[t])}))}return s}getTextMultiLanguageValue(t,e){if(t[e]){return t[e]}else if(t.en){return t.en}else{return t[Object.keys(t)[0]]}}async missingTranslation(t,e){if(this.translationsLoaded&&t&&!this.missingTranslationsList[t]){this.missingTranslationsList[t]=true;const i=new sP(e);ht.log("missingTranslation",[t,i]);try{await $L.mergeWithDocument(rP,t,i)}catch(t){ht.log("missingTranslation error",[t])}}}async makeTranslation(t){return new Promise((async(e,i)=>{HL.presentLoading("please-wait");const n="tempTranslation";const s=new sP(t);try{await $L.mergeWithDocument(rP,n,s);$L.getDocumentObservable(rP,n).then((t=>{const i=t.subscribe((t=>{if(t.translated){i.unsubscribe();$L.deleteDocument(rP,n,false);HL.dismissLoading();e(t.translated)}}))}),(t=>{HL.dismissLoading();i("Translation error:"+t)}))}catch(t){HL.dismissLoading();i("Translation error:"+t)}}))}}const aP=new oP;var hP=undefined&&undefined.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],i;return e?e.call(t):(t=typeof __values==="function"?__values(t):t[Symbol.iterator](),i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i);function n(e){i[e]=t[e]&&function(i){return new Promise((function(n,r){i=t[e](i),s(n,r,i.done,i.value)}))}}function s(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)}};class cP{updatePhotoURL(t,e,i,n,s){return new Promise(((r,o)=>{const a=t+"/"+i+"/"+e+"URL"+(s?"_"+s:"");const h=Qi(Bl,a);const c=Xi(h,n);c.on("state_changed",(t=>{const e=t.bytesTransferred/t.totalBytes*100;ht.log("Upload is "+e+"% done");switch(t.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}}),(t=>{this.showAlert(t);o(undefined)}),(()=>{Ji(c.snapshot.ref).then((t=>{ht.log("photoURL",[t]);r(t)}),(t=>{this.showAlert(t);o(undefined)}))}))}))}uploadFile(t,e,i,n){const s=this.getFilePath(t,e,i);const r=Qi(Bl,s);this.uploadTask=Xi(r,n);ht.log("uploadFile",[t,e,i,n]);this.uploadTask.on("state_changed",(t=>{let e=t.bytesTransferred/t.totalBytes*100;switch(t.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}ht.log("progress",[e]);this.emitUploadProgress({state:t.state,progress:e,error:null,url:null})}),(t=>{switch(t.code){case"storage/unauthorized":HL.presentAlertError("User doesn't have permission to access the object");break;case"storage/canceled":HL.presentAlertError("User canceled the upload");break;case"storage/unknown":HL.presentAlertError("Unknown error occurred");break}this.emitUploadProgress({state:"error",progress:0,error:t,url:null});return undefined}),(()=>{Ji(this.uploadTask.snapshot.ref).then((t=>{ht.log("downloadURL",[t]);this.emitUploadProgress({state:"completed",progress:100,error:null,url:t})}),(t=>{HL.presentAlertError(t);return undefined}))}))}cancelUploading(){}emitUploadProgress(t){window.dispatchEvent(new CustomEvent("uploadProgress",{bubbles:true,detail:t}))}getFilePath(t,e,i){return t+"/"+e+"/"+i.type+"/"+i.id}deleteFilePath(t,e,i){return this.deleteFile(this.getFilePath(t,e,i))}async deleteFile(t){const e=Qi(Bl,t);try{return await Ki(e)}catch(t){this.showAlert(t);return false}}async deleteFolderRecursive(t){var e,i,n,s,r,o,a,h;const c=Qi(Bl,t);const u=await Zi(c);let l=0;try{for(var f=true,d=hP(u.items),p;p=await d.next(),e=p.done,!e;f=true){s=p.value;f=false;const t=s;await this.deleteFile(t.fullPath);l++}}catch(t){i={error:t}}finally{try{if(!f&&!e&&(n=d.return))await n.call(d)}finally{if(i)throw i.error}}try{for(var m=true,_=hP(u.prefixes),v;v=await _.next(),r=v.done,!r;m=true){h=v.value;m=false;const t=h;l+=await this.deleteFolderRecursive(t.fullPath)}}catch(t){o={error:t}}finally{try{if(!m&&!r&&(a=_.return))await a.call(_)}finally{if(o)throw o.error}}return l}async deletePhotoURLs(t,e){try{const i=Qi(Bl,`${t}/${e}`);if(i&&i.fullPath){return this.deleteFolderRecursive(i.fullPath)}else{return true}}catch(t){this.showAlert(t);return undefined}}async showAlert(t){let e=aP.getTransl("storage","Storage");let i=aP.getTransl("storage-error","There was an error in the storage process. Please try again later.");const n=await pt.create({header:e,message:i+"->"+t,buttons:[{text:aP.getTransl("ok","OK")}]});n.present()}async getUrl(t){return new Promise(((e,i)=>{const n=Qi(Bl,t);Ji(n).then((t=>{e(t)}),(t=>{console.log(t);i(t)}))}))}}const uP=new cP;const lP=ft("Geolocation",{web:()=>import("./p-1d88281f.js").then((t=>new t.GeolocationWeb))});const fP="admin";class dP{constructor(){this.routerSub$=new L({});this.pageTo=[]}init(t){this.router=t}routerChanged(t){this.pageFrom=t.detail.from;this.pageTo=t.detail.to.split("/");this.routerSub$.next(this.pageTo)}async push(t,e){if(this.pageTo.join("/")!==t){await HL.presentLoading("loading",false);const i=this.router.push(t,e);i.then((()=>{HL.dismissLoading()}))}}pushToActualUrl(t,e){this.push(window.location.pathname+"/"+t,e)}goHome(){this.push("/","root")}goBack(){if(this.pageFrom!=null){this.router.back()}else{this.goHome()}}async openModal(t,e=null,i=false,n=true){await HL.presentLoading("loading",false);const s=await mt.create({component:t,componentProps:e,backdropDismiss:i,cssClass:n?"resize-modal":null});await s.present();HL.dismissLoading();return s}async openPopover(t,e=null,i=false,n=""){const s=await _t.create({component:t,componentProps:e,backdropDismiss:i,cssClass:n,translucent:true});await s.present();return s}}const pP=new dP;class mP{constructor(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t.position)this.position=$.setPosition(t.position)}else{this[e]=t[e]}}))}}class _P{constructor(t){this.displayName=t&&t.displayName?t.displayName:null;this.photoURL=t&&t.photoURL?t.photoURL:null;this.coverURL=t&&t.coverURL?t.coverURL:null;this.address=t&&t.address?t.address:null;this.position=null;if(t&&t.position){if(t.position)this.position=$.setPosition(t.position)}else if(this.address&&this.address.lat&&this.address.lon){this.position=$.getPosition(this.address.lat,this.address.lon)}this.description=t&&t.description?t.description:null;this.phoneNumber=t&&t.phoneNumber?t.phoneNumber:null;this.email=t&&t.email?t.email:null;this.website=t&&t.website?t.website:null;this.twitter=t&&t.twitter?t.twitter:null;this.facebook=t&&t.facebook?t.facebook:null;this.instagram=t&&t.instagram?t.instagram:null;this.diveSites=[];if(t&&t.diveSites){this.diveSites=t.diveSites}this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}setPosition(t,e){this.position=$.getPosition(t,e)}setAddress(t){this.address=t}}class vP{constructor(){this.depthToPressFactor=10.1325;this.depthToPressFactorMsw=10.1325;this.ltToCuFtFactor=1;this.conversions={feetPerMeter:3.25684678,celsiusPerFahrenheit:1.8,kilogramsPerPound:.45359237,barPerPsi:14.5037738,litersPerCuFt:.03351351351};this.units="Metric";this.depthUnit="mt";this.pressUnit="bar";this.volumeUnit="lt";this.liquidSamples={fresh:{density:function(){return this.density(1e3,1)}},salt:{density:function(){return this.density(1030,1)}},mercury:{density:function(){return this.density(13595.1,1)}}};this.gravitySamples={earth:9.80665,_current:9.80665,current:function(t){if(typeof t=="number"){this.gravitySamples._current=t}return this.gravitySamples._current}};this.surfacePressureSamples={earth:1,_current:1,current:function(t){if(typeof t=="number"){this.surfacePressureSamples._current=t}return this.surfacePressureSamples._current}};this.constants={vapourPressure:{water:{tempRange_1_100:[8.07131,1730.63,233.426],tempRange_99_374:[8.14019,1810.94,244,485]},lungsBreathing:{_current:null,current:function(){if(!this.constants.vapourPressure.lungsBreathing._current){let t=this.waterVapourPressureInBars(35.2);this.constants.vapourPressure.lungsBreathing._current=t}return this.constants.vapourPressure.lungsBreathing._current}}},altitudePressure:{sealevel:1,_current:1,current:function(t){if(typeof t=="number"){this.constants.altitudePressure._current=t}return this.constants.altitudePressure._current}}}}setMetric(t){if(t){this.depthToPressFactor=10.1325;this.ltToCuFtFactor=1;this.depthUnit="mt";this.pressUnit="bar";this.volumeUnit="lt";this.units="Metric"}else{this.depthToPressFactor=33;this.ltToCuFtFactor=.035315;this.depthUnit="ft";this.pressUnit="psi";this.volumeUnit="cuft";this.units="Imperial"}}getSegmentOTU(t,e,i,n,s,r,o,a){let h;let c=0;if(a!=="Metric"){t=this.feetToMeters(t);e=this.feetToMeters(e);s=this.feetToMeters(s);r=this.feetToMeters(r)}if(s>-1||r<1||t<0||e<0||o<0||i>1||i<0||n>1||n<0)return-1;if(t>e)h=s;else if(t<e)h=r;else h=1;let u=(e-t)/h;if(u>0){let n=t/this.depthToPressFactorMsw+1;let s=e/this.depthToPressFactorMsw+1;let r=Math.max(n,s);let o=Math.min(n,s);let a=r*i;let h=o*i;if(a>.5){let t=Math.max(.5,h);let e=u*(a-t)/(a-h);c=3/11*e/(a-t)*Math.pow((a-.5)/.5,11/6)-Math.pow((t-.5)/.5,11/6);if(c<0)c=0}}let l=o-u;let f=e/this.depthToPressFactorMsw+1;let d=f*n;if(d>.5&&l>0)c+=l*Math.pow(.5/(d-.5),-5/6);return c}getSegmentCNS(t,e,i,n,s,r,o,a){let h;let c=0;let u;let l=10;let f=new Array(.5,.6,.7,.8,.9,1.1,1.5,1.6,1.7,1.8);let d=new Array(.6,.7,.8,.9,1.1,1.5,1.6,1.7,1.8,2);let p=new Array(-1800,-1500,-1200,-900,-600,-300,-750,-280,-72,-44);let m=new Array(1800,1620,1410,1171,900,570,1245,493,139.4,89);if(a!=="Metric"){t=this.feetToMeters(t);e=this.feetToMeters(e);s=this.feetToMeters(s);r=this.feetToMeters(r)}if(s>-1||r<1||t<0||e<0||o<0||i>1||i<0||n>1||n<0)return-1;if(t>e)h=s;else if(t<e)h=r;else h=1;let _=(e-t)/h;if(_>0){let n=t/this.depthToPressFactorMsw+1;let s=e/this.depthToPressFactorMsw+1;let r=Math.max(n,s);let a=Math.min(n,s);let h=r*i;let v=a*i;if(h>2)return 5*o;if(h>.5){let i=Math.max(.5,v);let n=new Array;let s=new Array;let r=new Array;let o=new Array;for(u=0;u<l;u++){if(h>f[u]&&i<=d[u]){if(t>e){s[u]=Math.min(h,d[u]);r[u]=Math.max(i,f[u])}else{s[u]=Math.max(i,f[u]);r[u]=Math.min(h,d[u])}o[u]=r[u]-s[u];if(h!=i)n[u]=_*Math.abs(o[u])/(h-i);else n[u]=0}else{n[u]=0}}for(u=0;u<l;u++){let t,e;if(n[u]>0){t=p[u]*s[u]+m[u];e=p[u]*(o[u]/n[u]);c+=1/e*(Math.log(Math.abs(t+e*n[u]))-Math.log(Math.abs(t)))}}}}let v=o-_;if(v>0){let t=e/this.depthToPressFactorMsw+1;let i=t*n;let s=0;if(i>2)return c+5*v;if(i>.5){for(u=0;u<l;u++){if(i>f[u]&&i<=d[u]){s=p[u]*i+m[u];break}}if(s>0)c+=v/s;else return-1}}return c}getSegmentGas(t,e,i,n,s,r,o){let a;let h=0;if(this.units=="Imperial"){i=this.cuFtToLt(i);t=this.feetToMeters(t);e=this.feetToMeters(e);n=this.feetToMeters(n);s=this.feetToMeters(s)}if(n>-1||s<1||t<0||e<0||r<0)return-1;if(t>e)a=n;else if(t<e)a=s;else a=1;if(t!=e&&(e-t)/a>r)return-1;let c=(e-t)/a;if(c>0){let n=t/this.depthToPressFactorMsw+1;let s=e/this.depthToPressFactorMsw+1;if((o&1)==1)h=(n+s)/2*i*c}let u=r-c;let l=e/this.depthToPressFactorMsw+1;if((o&2)==2)h+=l*i*u;if(this.units=="Imperial"){h=this.ltToCuFt(h)}return h}depth2press(t){return t/this.depthToPressFactor+1}convertInlt(t){return t/this.ltToCuFtFactor}gasmixToString(t,e){let i="";if(t==1)return"Oxygen";if(t>=.209&&t<=.21&&e==0)return"Air";if(e==0)i+="Nx";else i+="Tx";if(Math.round(100*t)==100*t)i+=Math.round(100*t);else i+=Math.round(1e3*t)/10;if(e==0)return i;if(Math.round(100*e)==100*e)i+="/"+Math.round(100*e);else i+="/"+Math.round(1e3*e)/10;return i}calulateAverageDepthTime(t){let e=0,i=0,n=0,s=[],r=[],o=0,a=0,h=0,c=0,u=0;t[0].forEach((function(t){if(t=="Depth"){e=n}else if(t=="Time"){i=n}n++}));for(n=1;n<t.length;n++){s.push(t[n][e]);let a=n==1?t[n][i]:t[n][i]-t[n-1][i];r.push(a);c=t[n][i];u=t[n][e]>u?t[n][e]:u;o+=t[n][e]*a}o=o/c;let l=u*.75;for(n=0;n<s.length;n++){if(s[n]>=l){a+=s[n]*r[n];h+=r[n]}}a=a/h;let f;f.avgDepth=parseFloat(o.toFixed(1)),f.runtime=parseFloat((c/60).toFixed(1)),f.maxDepth=u,f.avgBottomDepth=parseFloat(a.toFixed(1)),f.avgBottomTime=parseFloat((h/60).toFixed(1));return f}mmHgToPascal(t){if(!t){t=1}return this.liquidSamples.mercury.density()/1e3*this.gravitySamples.current()*t}pascalToBar(t){return t/(this.surfacePressureSamples.current()*1e5)}barToPascal(t){if(!t){t=1}return t*(this.surfacePressureSamples.current()*1e5)}atmToBar(t){let e=this.atmToPascal(t);return this.pascalToBar(e)}atmToPascal(t){if(!t){t=1}return this.surfacePressureSamples.current()*101325*t}pascalToAtm(t){return t/(this.surfacePressureSamples.current()*101325)}density(t,e){return t/e}depthInMetersToBars(t,e){let i;if(e){i=this.liquidSamples.fresh.density()}else{i=this.liquidSamples.salt.density()}let n=i*this.gravitySamples.current();return this.pascalToBar(t*n)+this.constants.altitudePressure.current()}depthInMetersToAtm(t,e){let i;if(e){i=this.liquidSamples.fresh.density()}else{i=this.liquidSamples.salt.density()}let n=i*this.gravitySamples.current();return this.pascalToAtm(t*n)+this.constants.altitudePressure.current()}barToDepthInMeters(t,e){let i;if(e){i=this.liquidSamples.fresh.density()}else{i=this.liquidSamples.salt.density()}if(!t){t=1}let n=i*this.gravitySamples.current();let s=this.barToPascal(t);return s/n}atmToDepthInMeters(t,e){let i;if(e){i=this.liquidSamples.fresh.density()}else{i=this.liquidSamples.salt.density()}if(!t){t=1}let n=i*this.gravitySamples.current();let s=this.atmToPascal(t);return s/n}dac(t,e,i){return(t-e)/i}sac(t,e,i){let n=this.atmToDepthInMeters(1,i);return t/(e/n+1)}rmv(t,e,i){let n=e/i;return t*n}partialPressure(t,e){return t*e}partialPressureAtDepth(t,e,i){let n=this.depthInMetersToBars(t,i);return n*e}waterVapourPressure(t){let e;if(t>=1&&t<=100)e=this.constants.vapourPressure.water.tempRange_1_100;else if(t>=99&&t<=374)e=this.constants.vapourPressure.water.tempRange_99_374;else return NaN;let i=e[0]-e[1]/(e[2]+t);return Math.pow(10,i)}waterVapourPressureInBars(t){let e=this.waterVapourPressure(t);let i=this.mmHgToPascal(e);return this.pascalToBar(i)}maxOperatingDepth(t,e,i){let n=this.barToDepthInMeters(1,i);return n*(t/e-this.constants.altitudePressure.current())}equivNarcoticDepth(t,e,i,n,s){let r=this.partialPressureAtDepth(n,t,s);let o=this.partialPressureAtDepth(n,e,s);let a=this.partialPressureAtDepth(n,i,s);let h=r+o+a*.23;let c=this.partialPressure(1,.2095);let u=this.partialPressure(1,.7808);let l=this.partialPressure(1,.00934);let f=c*1+u*1+l*2.33;let d=h/f;return(d-this.constants.altitudePressure.current())*this.barToDepthInMeters(1,s)}depthChangeInBarsPerMinute(t,e,i,n){let s=(e-t)/i;return this.depthInMetersToBars(s,n)-this.constants.altitudePressure.current()}gasRateInBarsPerMinute(t,e,i,n,s){return Math.abs(this.depthChangeInBarsPerMinute(t,e,i,s))*n}gasPressureBreathingInBars(t,e,i){let n=this.depthInMetersToBars(t,i);n=n-this.constants.altitudePressure.current()-this.constants.vapourPressure.lungsBreathing.current();return n*e}feetToMeters(t,e){var i=Number(t);let n=i/this.conversions.feetPerMeter;if(dt.exports.isNumber(e)){n=dt.exports.round(n,e)}return n}metersToFeet(t,e){var i=Number(t);let n=i*this.conversions.feetPerMeter;if(dt.exports.isNumber(e)){n=dt.exports.round(n,e)}return n}celsiusToFahrenheit(t){var e=Number(t);return e*this.conversions.celsiusPerFahrenheit+32}fahrenheitToCelsius(t){var e=Number(t);return(e-32)/this.conversions.celsiusPerFahrenheit}barToPsi(t){var e=Number(t);return dt.exports.round(e*this.conversions.barPerPsi,-1)}psiToBar(t){var e=Number(t);return dt.exports.round(e/this.conversions.barPerPsi,0)}ltToCuFt(t){var e=Number(t);return dt.exports.round(e*this.conversions.litersPerCuFt,3)}cuFtToLt(t){var e=Number(t);return dt.exports.round(e/this.conversions.litersPerCuFt,1)}kilogramsToPound(t){var e=Number(t);return e/this.conversions.kilogramsPerPound}poundsToKilograms(t){var e=Number(t);return e*this.conversions.kilogramsPerPound}isMetric(){return this.units==="Metric"}isImperial(){return this.units==="Imperial"}}const gP=new vP;class bP{constructor(){this.METRIC=0;this.IMPERIAL=1;this.ALTITUDE_MAX=3e3;this.METERS_TO_FEET=gP.conversions.feetPerMeter;this.BRIEF=0;this.EXTENDED=1;this.CONST=1;this.stage_descr=["descent","bottom","ascent","waypoint","ascent","surface"];this.ASCENT=2;this.DESCENT=0;this.DECO=4;this.WAYPOINT=3;this.SURFACE=5;this.setDefaultPrefs()}getPrefs(){return this}setDefaultPrefs(){this.units=this.METRIC;this.disableModUpdate=false;this.lastStopDepth=3;this.stopDepthIncrement=3;this.stopTimeIncrement=1;this.extendedLimits=true;this.stopDepthMax=10;this.stopDepthMin=1;this.ascentRate=-9;this.ascentRateMin=-1;this.ascentRateMax=-10;this.descentRate=20;this.descentRateMin=5;this.descentRateMax=50;this.gfHigh=.85;this.gfLow=.2;this.gfHigh_bailout=.9;this.gfLow_bailout=.9;this.bailout=true;this.gfMin=0;this.gfMax=.95;this.diveRMV=20;this.decoRMV=15;this.pAmb=10.1325;this.pConversionmsw=10.1325;this.pConversion=this.pAmb;this.altitude=0;this.pH2O=.627;this.pH2Omsw=.627;this.ocDeco=false;this.forceAllStops=true;this.runtimeFlag=true;this.gfMultilevelMode=true;this.prefGases=[];this.prefSegments=[];this.maxDepth=330;this.maxSegmentTime=1e3;this.maxSetpoint=1.6;this.maxMOD=1.607;this.maxPO2=1.6;this.agreedToTerms=false;this.modifiers=[0,2,4,6,8];this.factorComp=1;this.factorDecomp=1;this.modelClass="ZHL16B";this.bottomppO2=1.2;this.decoppO2=1.2;this.oxygenppO2=1.5;this.configuration="OC";this.helium_half_time_multiplier=0;this.setExtendedLimits(8)}setLimits(t){if(t){this.gfMax=1;this.maxSegmentTime=1e4;this.maxSetpoint=1.6;this.maxMOD=1.607}else{this.maxSegmentTime=100;this.maxSetpoint=1.6;this.maxMOD=1.607;this.gfMax=.95}if(this.units==this.METRIC)this.maxDepth=t?330:100;else this.maxDepth=t?1100:330}setUnitsTo(t){if(this.units==t)return;if(t!=this.METRIC){this.units=this.IMPERIAL;this.lastStopDepth=10;this.stopDepthIncrement=10;this.stopDepthMax=33;this.stopDepthMin=3;this.ascentRate=-30;this.ascentRateMin=-3;this.ascentRateMax=-33;this.descentRate=60;this.descentRateMin=16;this.descentRateMax=160;this.pAmb=33;this.pH2O=2.0461;this.maxDepth=1e3}else{this.units=this.METRIC;this.lastStopDepth=3;this.stopDepthIncrement=3;this.stopDepthMax=10;this.stopDepthMin=1;this.ascentRate=-9;this.ascentRateMin=-1;this.ascentRateMax=-10;this.descentRate=20;this.descentRateMin=5;this.descentRateMax=50;this.pAmb=10.1325;this.pH2O=.627;this.maxDepth=330}this.pConversion=this.pAmb}setAltitude(t){if(this.units==this.METRIC){if(t<0||t>this.ALTITUDE_MAX)t=0;this.pAmb=this.altitudeToPressure(t);this.altitude=t}else{if(t<0||t>this.ALTITUDE_MAX*this.METERS_TO_FEET)t=0;this.pAmb=this.altitudeToPressure(t/this.METERS_TO_FEET)*this.METERS_TO_FEET;this.altitude=t}}altitudeToPressure(t){if(t==0)return this.pAmb;else if(t>0)return Math.pow((44330.8-t)/4946.54,5.25588)/10131;else return 0}isDisableModUpdate(){return this.disableModUpdate}getLastStopDepth(){return this.lastStopDepth}getStopDepthIncrement(){return this.stopDepthIncrement}getStopTimeIncrement(){return this.stopTimeIncrement}getStopDepthMax(){return this.stopDepthMax}getStopDepthMin(){return this.stopDepthMin}getAscentRate(){return this.ascentRate}getAscentRateMax(){return this.ascentRateMax}getAscentRateMin(){return this.ascentRateMin}getDescentRate(){return this.descentRate}getDescentRateMax(){return this.descentRateMax}getDescentRateMin(){return this.descentRateMin}getExtendedLimits(){return this.extendedLimits}getGfHigh(){if(this.getBailout()&&this.configuration!="OC"){return this.gfHigh_bailout}else{return this.gfHigh}}getGfLow(){if(this.getBailout()&&this.configuration!="OC"){return this.gfLow_bailout}else{return this.gfLow}}getGfMax(){return this.gfMax}getGfMin(){return this.gfMin}getDecoRMV(){return this.decoRMV}getDiveRMV(){return this.diveRMV}getOcDeco(){return this.ocDeco}getForceAllStops(){return this.forceAllStops}getRuntimeFlag(){return this.runtimeFlag}getGfMultilevelMode(){return this.gfMultilevelMode}getPrefGases(){return this.prefGases}getPrefSegments(){return this.prefSegments}getLastModelFile(){return this.lastModelFile}getPAmb(){return this.pAmb}getPConversion(){return this.pConversion}getPConversioninMsw(){return this.pConversionmsw}getPH2O(){return this.pH2O}getPH2Omsw(){return this.pH2Omsw}getAltitude(){return this.altitude}getAltitudeInMsw(){return this.units?gP.feetToMeters(this.altitude,0):this.altitude}getAgreedToTerms(){return this.agreedToTerms}getMaxDepth(){return this.maxDepth}getMaxSegmentTime(){return this.maxSegmentTime}getMaxSetpoint(){return this.maxSetpoint}getMaxMOD(){return this.maxMOD}getMaxPO2(){return this.maxPO2}getModifiers(){return this.modifiers}getFactorComp(){return this.factorComp}getFactorDecomp(){return this.factorDecomp}getBailout(){return this.bailout}setDisableModUpdate(t){this.disableModUpdate=t}setLastStopDepth(t){this.lastStopDepth=t}setStopDepthIncrement(t){this.stopDepthIncrement=t}setStopTimeIncrement(t){this.stopTimeIncrement=t}setAscentRate(t){this.ascentRate=-t}setDescentRate(t){this.descentRate=t}setGfHigh(t){this.gfHigh=t}setGfLow(t){this.gfLow=t}setGfHigh_bailout(t){this.gfHigh_bailout=t}setGfLow_bailout(t){this.gfLow_bailout=t}setDecoRMV(t){this.decoRMV=t}setDiveRMV(t){this.diveRMV=t}setOcDeco(t){this.ocDeco=t}setForceAllStops(t){this.forceAllStops=t}setRuntimeFlag(t){this.runtimeFlag=t}setGfMultilevelMode(t){this.gfMultilevelMode=t}setPrefGases(t){this.prefGases=t}setPrefSegments(t){this.prefSegments=t}setLastModelFile(t){this.lastModelFile=t}setPAmb(t){this.pAmb=t}setPH2O(t){this.pH2O=t}setAgreedToTerms(t){this.agreedToTerms=t}setModifiers(t){this.modifiers=t}setFactorComp(t){this.factorComp=t}setFactorDecomp(t){this.factorDecomp=t}setConfiguration(t){this.configuration=t}setBailout(t){this.bailout=t}setHelium_half_time_multiplier(t){this.helium_half_time_multiplier=parseFloat(t)}setExtendedLimits(t){this.extendedLimits=t;this.setLimits(this.extendedLimits)}getUnits(){return this.units}setUnits(t){this.units=t}}class wP{constructor(t=.32,e=0,i=(gP.isMetric()?30:100),n=1.2,s=gP.units){this.units="Metric";this.useAsDiluent=false;this.pref=new bP;this.updateGas(t,e,i,n,s)}updateGas(t,e,i,n,s){this.fHe=dt.exports.round(e,3);this.fO2=dt.exports.round(t,3);this.He=dt.exports.round(this.fHe*100,0);this.O2=dt.exports.round(this.fO2*100,0);if(n)this.ppO2=dt.exports.round(n,2);if(i){this.fromDepth=dt.exports.toNumber(i)}else{this.fromDepth=this.getModF(this.fO2,this.ppO2)}this.mod=this.getModF(this.fO2,this.ppO2);this.units=s?s:gP.units;this.pref.setUnitsTo(this.units==="Metric"?0:1)}validateField(t,e){if(t==="fHe"||t==="fO2")return e>=0&&e<=1;if(t==="mod")return e>=0&&e<=900;return false}validate(t,e,i){let n=true;n=n&&this.validateField("fHe",t);n=n&&this.validateField("fO2",e);n=n&&this.validateField("mod",i);if(!n)return false;n=n&&t+e<=1;if(!n)return false;if(e==0&&i==0)return n;if(gP!=null){let t=(i+gP.depthToPressFactor)/gP.depthToPressFactor*e;n=t<=this.pref.getMaxMOD()+.05}return n}checkGas(){if(this.getFO2()+this.getFHe()>1){this.setFHe(1-this.getFO2())}}getMaxMod(t){return this.pref.getMaxMOD()/t*gP.depthToPressFactor-gP.depthToPressFactor}getFromDepth(){return this.fromDepth}getModF(t,e){return dt.exports.round(e/t*gP.depthToPressFactor-gP.depthToPressFactor,1)}getppO2(t,e){return(e+gP.depthToPressFactor)*t/gP.depthToPressFactor}getpO2atDepth(t,e=2){t=dt.exports.toNumber(t);const i=dt.exports.round(gP.depth2press(t)*this.getFO2(),e);return i}getEND(t,e=true){var i=t+this.pref.getPAmb();var n=this.getFN2();var s=this.getFHe();var r;var o;var a;if(this.ppO2>0){r=s+n>0?i-this.ppO2*this.pref.getPConversion():0;o=r>0?r*n/(s+n):0;a=this.ppO2*this.pref.getPConversion()}else{o=i*n;a=i*(1-n-s)}var h=o+(e?a:0)-this.pref.getPAmb();return h>0?dt.exports.round(h,1):0}highPO2WarningatDepth(t,e){let i;if(e){i=1.6}else{if(t<40){i=1.4}else if(t<80){i=1.2}else{i=1}}return this.getpO2atDepth(t)>i}highPO2WarningatDepthWithTarget(t,e){return this.getpO2atDepth(t)>e}highENDWarningatDepth(t){const e=this.units==="Metric"?30:100;return this.getEND(t)>e}compareTo(t){return this.getFO2()==t.getFO2()&&this.getFHe()==t.getFHe()}getHe(){return dt.exports.round(this.He,0)}getO2(){return dt.exports.round(this.O2,0)}getFHe(){return dt.exports.round(this.fHe,2)}getFO2(){return dt.exports.round(this.fO2,2)}getFN2(){let t=1-dt.exports.round(this.fHe,2)-dt.exports.round(this.fO2,2);if(t<1e-4)return 0;else return t}getMod(){return this.mod}getUseAsDiluent(){return this.useAsDiluent}setFHe(t){this.fHe=dt.exports.round(t,2);this.He=this.fHe*100;if(this.fO2+this.fHe>1){this.setFO2(1-this.fHe)}}async setFO2(t){this.fO2=dt.exports.round(t,2);this.O2=this.fO2*100;if(this.fO2+this.fHe>1){if(await mz.checkLicence("trimix")){this.setFHe(1-this.fO2)}else{this.setFO2(1-this.fHe)}}}setMod(t){this.mod=t}setFromDepth(t){this.fromDepth=t}setUseAsDiluent(t){this.useAsDiluent=t}setGas(t,e,i){if(this.validate(t,e,i)){this.fHe=t;this.fO2=e;this.mod=i}else{this.fHe=0;this.fO2=.21;this.mod=gP.isMetric()?30:100}this.units=gP.units}isEqualTo(t){return this.getFO2()==t.getFO2()&&this.getFHe()==t.getFHe()}toString(){let t;let e;if(this.fHe==0)e=Math.round(this.fO2*100);else e=Math.round(this.fO2*100)+"/"+Math.round(this.fHe*100);if(this.fHe>0){if(this.fHe==1)t=aP.getTransl("helium","Helium");else if(this.fHe+this.fO2==1)t="Heliox "+e;else t="Tx "+e}else if(this.fO2==.21)t=aP.getTransl("air","Air");else if(this.fO2==1)t=aP.getTransl("oxygen","Oxygen");else t="Nx "+e;return t}getShortName(){return this.toString()}getForm(){let t={o2:this.getO2(),he:this.getHe(),fromDepth:this.getFromDepth(),ppO2:this.ppO2,useAsDiluent:this.getUseAsDiluent()};return t}getPresetValues(){let t={O2:{order:0,value:0,label:"O2",type:"input",format:"number"},He:{order:1,value:0,label:"He",type:"input",format:"number"},fromDepth:{order:2,value:0,label:"Used from depth",type:"input",format:"number"},ppO2:{order:3,value:1.2,label:"pO2 Set Point",type:"input",format:"number"}};return t}convertUnit(t){if(this.units==="Imperial"&&t||this.units==="Metric"&&!t){this.units=t?"Metric":"Imperial";this.fromDepth=t?gP.feetToMeters(this.fromDepth,0):gP.metersToFeet(this.fromDepth,-1);this.mod=t?gP.feetToMeters(this.mod,0):gP.metersToFeet(this.mod,-1);this.pref.setUnitsTo(t?0:1)}return this}}class yP{constructor(t=0,e=0,i=0,n=new wP,s=1.2){this.index=dt.exports.toNumber(t);this.depth=dt.exports.toNumber(e);this.gas=n;this.setpoint=dt.exports.toNumber(s);this.time=dt.exports.toNumber(i)}setGas(t,e){if(t+e>1){e=1-t}this.gas=new wP(t,e,this.depth,this.setpoint)}setValue(t,e){if(t=="o2"){this.gas.setFO2(dt.exports.round(dt.exports.toNumber(e),2)/100)}else if(t=="he"){this.gas.setFHe(dt.exports.round(dt.exports.toNumber(e),2)/100)}else if(t!="gas"){this[t]=dt.exports.toNumber(e)}}getForm(){let t={depth:this.depth,time:this.time,o2:this.gas.getO2(),he:this.gas.getHe(),setpoint:this.setpoint,index:this.index};return t}getPresetValues(){let t={depth:{order:0,value:0,label:"Depth",type:"input",format:"number"},time:{order:1,value:0,label:"Time",type:"input",format:"number"},O2:{order:2,value:0,label:"O2",type:"input",format:"number"},He:{order:3,value:0,label:"He",type:"input",format:"number"},setpoint:{order:4,value:1.2,label:"pO2 Set Point",type:"input",format:"number"},index:{type:"hidden"}};return t}}class xP{constructor(t){this.cellDate=[(new Date).toISOString(),(new Date).toISOString(),(new Date).toISOString()];this.airmVRange=[0,0,0];this.battHUD=false;this.settingsDone=false;this.lidCheck=false;this.loopCheck=false;this.negativePressCheck=false;this.o2LeakTest=false;this.positivePressCheck=false;this.diluentLeakTest=false;this.openO2Valve=false;this.loopInCC=false;this.hudOn=false;this.calController=false;this.calHUD=false;this.o2mVRange=[0,0,0];this.approved=false;if(t){if(t.cellDate){this.cellDate=[];t.cellDate.forEach((t=>{this.cellDate.push(new Date(t).toISOString())}))}if(t.airmVRange){this.airmVRange=[];t.airmVRange.forEach((t=>{this.airmVRange.push(dt.exports.toNumber(t))}))}if(t.battHUD){this.battHUD=t.battHUD}if(t.battINT){this.battINT=dt.exports.toNumber(t.battINT)}if(t.battEXT){this.battEXT=dt.exports.toNumber(t.battEXT)}if(t.settingsDone){this.settingsDone=t.settingsDone}if(t.scrubberTime){this.scrubberTime=dt.exports.toNumber(t.scrubberTime)}if(t.loopCheck){this.loopCheck=t.loopCheck}if(t.lidCheck){this.lidCheck=t.lidCheck}if(t.negativePressCheck){this.negativePressCheck=t.negativePressCheck}if(t.o2LeakTest){this.o2LeakTest=t.o2LeakTest}if(t.positivePressCheck){this.positivePressCheck=t.positivePressCheck}if(t.diluentLeakTest){this.diluentLeakTest=t.diluentLeakTest}if(t.openO2Valve){this.openO2Valve=t.openO2Valve}if(t.loopInCC){this.loopInCC=t.loopInCC}if(t.hudOn){this.hudOn=t.hudOn}if(t.calController){this.calController=t.calController}if(t.calHUD){this.calHUD=t.calHUD}if(t.airmVRange){this.o2mVRange=[];t.o2mVRange.forEach((t=>{this.o2mVRange.push(dt.exports.toNumber(t))}))}if(t.o2IP){this.o2IP=dt.exports.toNumber(t.o2IP)}if(t.dilIP){this.dilIP=dt.exports.toNumber(t.dilIP)}if(t.bailout){this.bailout=dt.exports.toNumber(t.bailout)}if(t.approved){this.approved=t.approved}}}checkCellDate(t){if(this.cellDate[t]){const e=Vl.differenceInDays(this.cellDate[t],new Date);const i=e/365.25;return i<-1?true:false}else{return false}}checkAirMvRange(t){if(this.airmVRange[t]){return this.airmVRange[t]<9||this.airmVRange[t]>13?true:false}else{return false}}checkO2MvRange(t){if(this.o2mVRange[t]){return Math.abs(this.airmVRange[t]*4.76-this.o2mVRange[t])>2?true:false}else{return false}}checkApproved(){this.approved=this.airmVRange[0]>0&&this.airmVRange[1]>0&&this.airmVRange[2]>0&&this.bailout>0&&this.battEXT>0&&this.battHUD&&this.battINT>0&&this.calController&&this.calHUD&&this.diluentLeakTest&&this.hudOn&&this.lidCheck&&this.loopCheck&&this.loopInCC&&this.negativePressCheck&&this.o2LeakTest&&this.o2mVRange[0]>0&&this.o2mVRange[1]>0&&this.o2mVRange[2]>0&&this.openO2Valve&&this.positivePressCheck&&this.scrubberTime>0&&this.settingsDone}}class MP{solve(){this.messages={add:aP.getTransl("add","ADD"),topup:aP.getTransl("top-up","TOP-UP"),drain:aP.getTransl("drain","DRAIN")};let t,e,i,n,s,r,o,a,h,c,u,l,f,d;this.blend={};this.supply=dt.exports.cloneDeep(this.have);this.pi=this.have.getPressure();this.mStartPressure=this.have.getPressure();this.mStart=this.have.getMix();t=this.mStart.getFO2();e=this.mStart.getFHe();i=this.mTopup.getFO2();n=this.mTopup.getFHe();s=1-i-n;this.mRich=new wP(1,0);r=this.mRich.getFO2();o=this.supply.getO2Amount();a=this.supply.getN2Amount();h=this.supply.getHeAmount();c=this.want.getO2Amount();u=this.want.getN2Amount();l=this.want.getHeAmount();this.blend.vi=this.supply.getGasAmount();f=[[r,0,i],[0,1,n],[1-r,0,s]];d=[[c-o],[l-h],[u-a]];this.m={a11:f[0][0],a12:f[0][1],a13:f[0][2],a14:d[0][0],a21:f[1][0],a22:f[1][1],a23:f[1][2],a24:d[1][0],a31:f[2][0],a32:f[2][1],a33:f[2][2],a34:d[2][0]};this.solveMatrix(this.m);this.blend.vo2a=this.m.a14;this.blend.vhea=this.m.a24;this.blend.vta=this.m.a34;if(this.blend.vo2a<0){this.blend.vo2a=0;this.m.a11=t;this.m.a21=e;this.m.a31=1-t-e;this.m.a14=c;this.m.a24=l;this.m.a34=u;this.solveMatrix(this.m);this.blend.vi=this.m.a14;this.blend.vhea=this.m.a24;this.blend.vta=this.m.a34}if(this.blend.vhea<0){this.blend.vhea=0;this.m.a12=t;this.m.a22=e;this.m.a32=1-t-e;this.m.a14=c;this.m.a24=l;this.m.a34=u;this.solveMatrix(this.m);this.blend.vo2a=this.m.a14;this.blend.vi=this.m.a24;this.blend.vta=this.m.a34}if(this.blend.vta<0){this.blend.vta=0;this.m.a13=t;this.m.a23=e;this.m.a33=1-t-e;this.m.a14=c;this.m.a24=l;this.m.a34=u;this.solveMatrix(this.m);this.blend.vo2a=this.m.a14;this.blend.vhea=this.m.a24;this.blend.vi=this.m.a34}if(this.blend.vi<0||this.blend.vi>this.supply.getGasAmount()){return false}let p=this.supply.drainToGasAmount(this.blend.vi).getPressure();this.mStartPressure=this.pi;if(this.pi-p>=Math.pow(10,0*-1)*.5){this.mStartPressure=p}return true}solveMatrix(t){let e=[0,dt.exports.toNumber(t.a11),dt.exports.toNumber(t.a12),dt.exports.toNumber(t.a13),dt.exports.toNumber(t.a14)];let i=[0,dt.exports.toNumber(t.a21),dt.exports.toNumber(t.a22),dt.exports.toNumber(t.a23),dt.exports.toNumber(t.a24)];let n=[0,dt.exports.toNumber(t.a31),dt.exports.toNumber(t.a32),dt.exports.toNumber(t.a33),dt.exports.toNumber(t.a34)];let s=e;let r=i;let o=n;if(e[1]==0){console.log("\rThere is a 0 in the first entry of the Matrix you entered\r\rI can't handle that at this time\r\rPlease Re-Enter the Matrix\r ");return}let a;if(e[1]!=0){a=e[1];for(let t=1;t<=4;t++){e[t]=e[t]/a}}a=-i[1];for(let t=1;t<=4;t++){i[t]=i[t]+e[t]*a}a=-n[1];for(let t=1;t<=4;t++){n[t]=n[t]+e[t]*a}if(i[2]==0){for(let t=2;t<=4;t++){a=i[t];i[t]=n[t];n[t]=a}}if(i[2]!=0){a=i[2];i[2]=i[2]/a;i[3]=i[3]/a;i[4]=i[4]/a;a=-n[2];for(let t=2;t<=4;t++){n[t]=n[t]+i[t]*a}a=-e[2];for(let t=2;t<=4;t++){e[t]=e[t]+i[t]*a}}if(n[3]!=0){a=n[3];n[3]=n[3]/a;n[4]=n[4]/a;a=-i[3];i[3]=i[3]+n[3]*a;i[4]=i[4]+n[4]*a;a=-e[3];e[3]=e[3]+n[3]*a;e[4]=e[4]+n[4]*a}this.m={a11:e[1],a12:e[2],a13:e[3],a14:e[4],a21:i[1],a22:i[2],a23:i[3],a24:i[4],a31:n[1],a32:n[2],a33:n[3],a34:n[4]};if(s[1]*e[4]+s[2]*i[4]+s[3]*n[4]!=s[4]){console.log("The Solution I found does not check out. You may have entered a system of equations which have no solution, or infinite solutions.")}if(r[1]*e[4]+r[2]*i[4]+r[3]*n[4]!=r[4]){console.log("\rThe Solution I found does not check out\r\rYou may have entered a system of equations which\r have no solution, or infinite solutions.")}if(o[1]*e[4]+o[2]*i[4]+o[3]*n[4]!=o[4]){console.log("\rThe Solution I found does not check out\r\rYou may have entered a system of equations which\r have no solution, or infinite solutions.")}}getPPSteps(t){let e,i,n=this.mStartPressure,s=this.have.getPressure(),r=dt.exports.cloneDeep(this.supply);let o=new Array;if(s>n){o.push({type:"drain",blend:this.messages.drain,mix:r.getMix(),startPress:s,pressToAdd:n-s,finalPress:n})}if(t){if(this.blend.vhea>0){e=parseFloat(r.addHe(this.blend.vhea).getPressure().toFixed(1));o.push({type:"add",blend:this.messages.add,mix:new wP(0,1),startPress:n,pressToAdd:e-n,finalPress:e})}else{e=n}if(this.blend.vo2a>0){i=parseFloat(r.addO2(this.blend.vo2a).getPressure().toFixed(1));o.push({type:"add",blend:this.messages.add,mix:new wP(1,0),startPress:e,pressToAdd:i-e,finalPress:i})}else{i=e}}else{if(this.blend.vo2a>0){e=parseFloat(r.addO2(this.blend.vo2a).getPressure().toFixed(1));o.push({type:"add",blend:this.messages.add,mix:new wP(1,0),startPress:n,pressToAdd:e-n,finalPress:e})}else{e=n}if(this.blend.vhea>0){i=parseFloat(r.addHe(this.blend.vhea).getPressure().toFixed(1));o.push({type:"add",blend:this.messages.add,mix:new wP(0,1),startPress:e,pressToAdd:i-e,finalPress:i})}else{i=e}}if(this.blend.vta>0){let t=Math.round(r.addGas(this.mTopup,this.blend.vta).getPressure()*10)/10;o.push({type:"topup",blend:this.messages.topup,mix:this.mTopup,startPress:i,pressToAdd:t-i,finalPress:t})}return o}getContinuousNxSteps(){let t,e,i=this.mStartPressure,n=this.have.getPressure(),s=dt.exports.cloneDeep(this.supply);let r=this.blend.vo2a+this.blend.vta;let o=new wP((this.blend.vo2a+this.blend.vta*this.mTopup.getFO2())/r,0);let a=new Array;if(n>i){a.push({type:"drain",blend:this.messages.drain,mix:s.getMix(),startPress:n,pressToAdd:i-n,finalPress:i})}if(this.blend.vhea>0){e=parseFloat(s.addHe(this.blend.vhea).getPressure().toFixed(1));a.push({type:"add",blend:this.messages.add,mix:new wP(0,1),startPress:i,pressToAdd:e-i,finalPress:e})}else{e=i}if(this.blend.vhea>0){t=parseFloat(s.addGas(o,r).getPressure().toFixed(1));a.push({type:"add",blend:this.messages.add,mix:o,startPress:e,pressToAdd:t-e,finalPress:t})}else{t=e}return a}getContinuousTmxSteps(){let t,e=this.mStartPressure,i=this.have.getPressure(),n=dt.exports.cloneDeep(this.supply);let s=this.blend.vo2a+this.blend.vhea+this.blend.vta;let r=new wP((this.blend.vo2a+this.blend.vta*this.mTopup.getFO2())/s,(this.blend.vhea+this.blend.vta*this.mTopup.getFHe())/s);let o=new Array;if(i>e){o.push({type:"drain",blend:this.messages.drain,mix:n.getMix(),startPress:i,pressToAdd:e-i,finalPress:e})}t=parseFloat(n.addGas(r,s).getPressure().toFixed(1));o.push({type:"add",blend:this.messages.add,mix:r,startPress:e,pressToAdd:t-e,finalPress:t});return o}getGasName(t){let e=t.getShortName();return e}}const TP=new MP;class OP{constructor(t){this.decoGases=[];this.bottomGases=[];this.profilePoints=[];this.surfaceInterval=3;this.selectedModel="BUHL";this.configuration="OC";this.units="Metric";this.date=new Date;if(t){for(let e in t){if(e=="profilePoints"){t.profilePoints.forEach((t=>{this.addProfilePoint(t.depth,t.time,t.gas.fO2,t.gas.fHe,t.setpoint)}))}else if(e=="decoGases"){t.decoGases.forEach((t=>{let e=t.setpoint?t.setpoint:t.ppO2;this.addDecoGas(t.fO2,t.fHe,t.fromDepth,e,t.useAsDiluent)}))}else if(e=="VPM"){this.VPM=this.getDiveProfileCalculations(t.VPM)}else if(e=="CCR"){this.CCR={BUHL:this.getDiveProfileCalculations(t.CCR.BUHL),VPM:this.getDiveProfileCalculations(t.CCR.VPM)}}else if(e=="BUHL"){this.BUHL=this.getDiveProfileCalculations(t.BUHL)}else if(e=="surfaceInterval"){this.surfaceInterval=t.surfaceInterval}else if(e=="introText"){this.introText=t.introText}else if(e=="offGassingDepth"){this.offGassingDepth=t.offGassingDepth}else if(e=="selectedModel"){this.selectedModel=t.selectedModel}else if(e=="configuration"){this.configuration=t.configuration}else if(e=="backgasHypoxicDepth"){this.backgasHypoxicDepth=t.backgasHypoxicDepth}else if(e=="arpc"){this[e]=new xP(t[e])}else if(e=="date"){this[e]=new Date(t.date)}else if(e=="units"){this.setUnits(t[e])}else if(e=="diveSiteId"||e=="divingCenterId"||e=="divingSchoolId"){this[e]=t[e]}}}}getDiveProfileCalculations(t){t.profile=t.profile.map((t=>{t.gas=new wP(t.gas.fO2,t.gas.fHe,t.gas.fromDepth,t.gas.ppO2,t.gas.units);return t}));return t}addProfilePoint(t,e,i,n,s=1.2){let r=new wP(i,n,t,s);let o=new yP(this.profilePoints.length,t,e,r,s);this.profilePoints.push(o);this.addBottomGas(i,n,t,s)}updateProfilePoint(t,e,i,n,s,r=1.2){let o=new wP(n,s,e,r);let a=new yP(this.profilePoints.length,e,i,o,r);this.profilePoints[t]=a;this.bottomGases[t]=new wP(n,s,e,r)}removeProfilePoint(t){this.profilePoints.splice(t,1);this.bottomGases.splice(t,1)}addDecoGas(t,e,i,n=1.4,s=false){let r=new wP(t,e,i,n);r.setUseAsDiluent(s);this.decoGases.push(r);this.decoGases=dt.exports.orderBy(this.decoGases,"fromDepth","desc")}updateDecoGas(t,e,i,n,s=1.4,r=false){let o=new wP(e,i,n,s);o.setUseAsDiluent(r);this.decoGases[t]=o;this.decoGases=dt.exports.orderBy(this.decoGases,"fromDepth","desc")}removeDecoGas(t){this.decoGases.splice(t,1)}addBottomGas(t,e,i,n=1.2){let s=new wP(t,e,i,n);this.bottomGases.push(s);this.bottomGases=dt.exports.orderBy(this.bottomGases,"fromDepth","desc")}getDiveDetails(){let t=[];t.push(this.configuration);this.profilePoints.forEach((e=>{t.push(e.time+"min @ "+e.depth+(this.units==="Metric"?"m":"ft")+" ("+TP.getGasName(e.gas)+")")}));this.decoGases.forEach((e=>{if(this.configuration=="CCR");else{t.push(TP.getGasName(e)+" --\x3e "+e.getFromDepth()+(this.units==="Metric"?"m":"ft"))}}));return t}getProfilePointsDetails(){let t=[];this.profilePoints.forEach((e=>{t.push(e.time+"min @ "+e.depth+(this.units==="Metric"?"m":"ft")+" ("+TP.getGasName(e.gas)+")")}));return t}getDecoTime(){let t=this.CCR?this.CCR[this.selectedModel]:this[this.selectedModel];if(t){return dt.exports.round(t.decotime,1)}}getRunTime(){let t=this.CCR?this.CCR[this.selectedModel]:this[this.selectedModel];if(t){return dt.exports.round(t.runtime,1)}}getMaxDepth(){let t=[];for(let e in this.profilePoints){t.push(this.profilePoints[e].depth)}return dt.exports.max(t)}getDecoStartDepth(){return this.getMaxDepth()*.74}getDecoProfileUnder(t){let e=[];let i=this.CCR?this.CCR[this.selectedModel]:this[this.selectedModel];if(i){i.profile.forEach((i=>{if(i.depth<=t&&i.depth!=0){e.push(dt.exports.round(i[i.rangeShape].stoptime,1)+"min @ "+dt.exports.round(i.depth,1)+(this.units==="Metric"?"m":"ft"))}}))}return e}getDecoProfileGroups(){let t=[];let e=this.CCR?this.CCR[this.selectedModel]:this[this.selectedModel];if(e){let i=dt.exports.reverse(Object.keys(e.rangeDescr));i.forEach((i=>{t.push(e.rangeDescr[i]+" "+i+(this.units==="Metric"?"m":"ft")+" -> "+dt.exports.round(e.rangeSums[i])+"min")}))}return t}setUnits(t){this.units=t;this.profilePoints=this.profilePoints.map((e=>{e.gas.units=t;return e}));this.bottomGases=this.bottomGases.map((e=>{e.units=t;return e}));this.decoGases=this.decoGases.map((e=>{e.units=t;return e}))}convertUnits(t){if(this.units!==t){this.profilePoints=this.profilePoints.map((e=>{e.depth=t=="Metric"?gP.feetToMeters(e.depth,0):gP.metersToFeet(e.depth,-1);e.gas=e.gas.convertUnit(t=="Metric");return e}));this.bottomGases=this.bottomGases.map((e=>{e.convertUnit(t=="Metric");return e}));this.decoGases=this.decoGases.map((e=>{e.convertUnit(t=="Metric");return e}));this.units=t}}}class EP{constructor(t){this.CCR_o2_consumption=2;this.CCR_separate_dil_tank=false;this.CCR_volume_for_consumption=10;this.IcdWarning=false;this.MAX_DECOMIX=4;this.MAX_DIVEPONTS=8;this.MAX_DIVES=5;this.altitude_dive_algorithm="off";this.altitude_of_dive=0;this.ascentRate=9;this.ascent_to_altitude_hours=12;this.buhlModel="ZHL16B";this.configuration="OC";this.conservatism=3;this.conservatism_bailout=1;this.critical_volume_algorithm=true;this.decoStepSize=3;this.deco_gas_reserve=30;this.descentppO2=.7;this.decoppO2=1.2;this.bottomppO2=1.2;this.oxygenppO2=1.5;this.depthUnit="m";this.descentRate=20;this.gasRule="1/1";this.gfHigh=85;this.gfHigh_bailout=90;this.gfLow=20;this.gfLow_bailout=30;this.hours_at_altitude_before_dive=12;this.lastStop6m20ft=false;this.maxPPO2bottom=1.4;this.maxPPO2deco=1.6;this.metabolic_o2_consumption=.8;this.metric=true;this.minPPO2=.16;this.number_of_divers_for_min_gas=2;this.pressureUnit="bar";this.pscrGasDivider=6;this.rmvBottom=20;this.rmvBottom_multiplier_for_min_gas=1.5;this.rmvDeco=15;this.selectedModel="BUHL";this.solubilityHe=.015;this.solubilityN2=.067;this.time_at_bottom_for_min_gas=2;this.time_at_gas_switch_for_min_gas=2;this.units="Metric";this.volumeUnit="ltr";this.helium_half_time_multiplier=0;this.VPM_gf_high=90;this.VPM_GFS=false;this.ace_time=250;if(t){this.setUnits(t.unit?t.unit:"Metric");for(let e in t){if(dt.exports.isNumber(this[e])){this[e]=dt.exports.toNumber(t[e])}else{this[e]=t[e]}}}else{this.setUnits("Metric")}}setUnits(t){this.units=t;if(t=="Imperial"){this.metric=false;this.depthUnit="ft";this.volumeUnit="cuft";this.pressureUnit="psi";this.descentRate=60;this.ascentRate=30;this.rmvBottom=.7;this.rmvDeco=.5;this.decoStepSize=10;this.metabolic_o2_consumption=.028;this.CCR_o2_consumption=.07;this.CCR_volume_for_consumption=.36}else{this.metric=true;this.depthUnit="mt";this.volumeUnit="ltr";this.pressureUnit="bar";this.descentRate=20;this.ascentRate=9;this.rmvBottom=20;this.rmvDeco=15;this.decoStepSize=3;this.metabolic_o2_consumption=.8;this.CCR_o2_consumption=2;this.CCR_volume_for_consumption=10}}}class AP{constructor(t){this.name="s80";this.volume=gP.isImperial()?gP.ltToCuFt(11.1):11.1;this.no_of_tanks=1;this.forDeco=false;this.pressure=gP.isImperial()?3e3:200;this.units=gP.units;if(t&&t.name)this.name=t.name;if(t&&t.volume)this.volume=dt.exports.toNumber(t.volume);if(t&&t.no_of_tanks)this.no_of_tanks=dt.exports.toNumber(t.no_of_tanks);if(t&&t.forDeco)this.forDeco=t.forDeco;if(t&&t.pressure){this.pressure=t.pressure}if(t&&t.gas)this.setGas(t.gas);if(t&&t.units)this.units=t.units}setGas(t){this.gas=t}setForDeco(t){this.forDeco=t}getTank(){return new BP(this.name,this.volume,this.no_of_tanks,this.gas,this.pressure,this.units)}}class SP{constructor(t){this.type="std_gas";this.deco=false;this.O2=32;this.He=0;this.fromDepth=30;this.ppO2=1.4;this.units="Metric";this.useAsDiluent=false;if(t&&t._id)this._id=t._id;if(t&&t._rev)this._rev=t._rev;this.type="std_gas";if(t&&t.created_at)this.created_at=new Date(t.created_at);if(t&&t.updated_at)this.updated_at=new Date(t.updated_at);if(t&&t.deco)this.deco=t.deco;if(t&&t.O2)this.O2=dt.exports.toNumber(t.O2);if(t&&t.He)this.He=dt.exports.toNumber(t.He);if(t&&t.fromDepth){this.fromDepth=dt.exports.toNumber(t.fromDepth)}else{this.fromDepth=gP.isMetric()?30:100}if(t&&t.useAsDiluent)this.useAsDiluent=t.useAsDiluent;if(t&&t.ppO2)this.ppO2=dt.exports.toNumber(t.ppO2);if(t&&t.units){this.units=t.units}else{this.units=gP.units}}getGas(){return new wP(this.O2/100,this.He/100,this.fromDepth,this.ppO2,this.units)}}class kP{constructor(){this.cns=0;this.otu=0;this.maxOx=0}addO2(t,e){var i;var n;t=Math.ceil(t);if(e>.5){i=t*Math.pow(.5/(e-.5),-.833333);this.otu+=i}if(e>1.8)n=1;else if(e>1.7)n=4;else if(e>1.6)n=12;else if(e>1.5)n=45;else if(e>1.4)n=120;else if(e>1.3)n=150;else if(e>1.2)n=180;else if(e>1.1)n=210;else if(e>1)n=240;else if(e>.9)n=300;else if(e>.8)n=360;else if(e>.7)n=450;else if(e>.6)n=570;else if(e>.5)n=720;else n=0;if(n>0)this.cns+=t/n;if(e>this.maxOx)this.maxOx=e}removeO2(t){if(t>=1440){this.otu=0}this.cns=this.cns*Math.exp(-t*.693147/90)}getMaxOx(){return this.maxOx}getCns(){return this.cns}getOtu(){return this.otu}setCns(t){this.cns=t}setOtu(t){this.otu=t}setMaxOx(t){this.maxOx=t}}class IP{constructor(t,e){this.gfHigh=e;this.gfLow=t;this.gfSlope=1;this.gf=t;this.gfSet=false}getGradientFactor(){if(this.gf>=this.gfLow)return this.gf;else return this.gfLow}setGfAtDepth(t){if(this.gfSlope<1&&t>=0)this.gf=t*this.gfSlope+this.gfHigh}setGfSlopeAtDepth(t){if(t>0){this.gfSlope=(this.gfHigh-this.gfLow)/(0-t);this.gfSet=true}}getGfHigh(){return this.gfHigh}setGfHigh(t){this.gfHigh=t}getGfLow(){return this.gfLow}setGfLow(t){this.gfLow=t}getGf(){return this.gf}setGf(t){this.gf=t}getGfSope(){return this.gfSlope}setGfSlope(t){this.gfSlope=t}isGfSet(){return this.gfSet}setGfSet(t){this.gfSet=t}}class CP{constructor(t,e){this.pref=t;this.ambientPressure=e;this.LOG2=.69315;this.compartmentChart=[];this.compartmentChartCCR=[];this.chartRunTime=0;this.kHe=null;this.kN2=null;this.aHe=null;this.bHe=null;this.aN2=null;this.bN2=null;this.ppHe=0;this.ppN2=0;this.factorComp=t.getFactorComp();this.factorDecomp=t.getFactorDecomp()}setCompartmentTimeConstants(t,e,i,n,s,r,o){this.index=t;this.kHe=this.LOG2/e;this.kN2=this.LOG2/i;this.aHe=n*(gP.isMetric()?1:gP.conversions.feetPerMeter);this.bHe=s;this.aN2=r*(gP.isMetric()?1:gP.conversions.feetPerMeter);this.bN2=o;return this.index}setpp(t,e){if(t<0||e<0){console.log("ERROR: setpp() is throwing exception, .ppHe="+t+" .ppN2="+e)}else{this.setPpHe(t);this.setPpN2(e)}}constDepth(t,e,i,n,s,r,o,a,h,c){if(t<0||e<0||i<0){t=t<0?0:t;e=e<0?0:e;i=i<0?0:i}let u=0;let l=1+i-Math.floor(i);do{u=u+l;let i={aHe:null,aN2:null};let f=this.kN2;let d=this.kHe;if(s=="surface"){if(u<=45){f=(.9-.005555*u)*this.kN2;d=(.9-.005555*u)*this.kHe}else if(u>45&&u<=60){f=.65*this.kN2;d=.65*this.kHe}else if(u>60&&u<=180){f=(.65+.0020833*(u-60))*this.kN2;d=(.65+.0020833*(u-60))*this.kHe}else{f=.9*this.kN2;d=.9*this.kHe}}i.aHe=(t-this.ppHe)*(1-Math.exp(-d*l));i.aN2=(e-this.ppN2)*(1-Math.exp(-f*l));i.aHe=i.aHe>0?i.aHe*this.factorComp:i.aHe*this.factorDecomp;i.aN2=i.aN2>0?i.aN2*this.factorComp:i.aN2*this.factorDecomp;this.ppHe=this.ppHe+i.aHe;this.ppN2=this.ppN2+i.aN2;l=1;let p=n+this.ambientPressure;let m=this.ppHe-t;let _=this.getHeMaxAmb(1);let v=this.getHeMvalueAt(p);let g=this.ppN2-e;let b=this.getN2MaxAmb(1);let w=this.getN2MvalueAt(p);let y=this.getMvalueAt(p);this.chartRunTime+=l;let x=a?this.compartmentChart:this.compartmentChartCCR;x.push({dive:parseInt(c),depth:n,runTime:this.chartRunTime,type:s,fO2:r*100,fHe:o*100,pO2:h,MV:this.getMV(p),MVHe:this.getHeMV(p),MVN2:this.getN2MV(p),mValue:y,mValueHe:v,mValueN2:w,maxAmb:this.getMaxAmb(1),maxAmbHe:_,maxAmbN2:b,ppHeInspired:t,ppN2Inspired:e,ssHe:m<0?-(100-this.ppHe/t*100):this.ppHe/v*100,ssN2:g<0||s=="surface"?-(100-this.ppN2/e*100):this.ppN2/w*100,ppHe:this.ppHe,ppN2:this.ppN2})}while(u<i)}ascDec(t,e,i,n,s,r,o,a,h,c){if(t<0||e<0||s<0){console.log("ERROR: ascDec() is throwing exception, ppHe="+t+" ppN2="+e+" segTime="+s,o,h)}if(r==0){let i=r+this.ambientPressure;let n=this.ppHe-t;let s=this.getHeMaxAmb(1);let o=this.getHeMvalueAt(i);let h=this.ppN2-e;let u=this.getN2MaxAmb(1);let l=this.getN2MvalueAt(i);let f=this.getMvalueAt(i);let d=a?this.compartmentChart:this.compartmentChartCCR;this.chartRunTime=0;d.push({dive:parseInt(c),depth:r,runTime:this.chartRunTime,type:"descent",fO2:21,fHe:0,pO2:.21,MV:this.getMV(i),MVHe:this.getHeMV(i),MVN2:this.getN2MV(i),mValue:f,mValueHe:o,mValueN2:l,maxAmb:this.getMaxAmb(1),maxAmbHe:s,maxAmbN2:u,ppHeInspired:t,ppN2Inspired:e,ssHe:n<0?-(100-this.ppHe/t*100):this.ppHe/o*100,ssN2:h<0?-(100-this.ppN2/e*100):this.ppN2/l*100,ppHe:this.ppHe,ppN2:this.ppN2})}this.ppHe=t+i*(s-1/this.kHe)-(t-this.ppHe-i/this.kHe)*Math.exp(-this.kHe*s);this.ppN2=e+n*(s-1/this.kN2)-(e-this.ppN2-n/this.kN2)*Math.exp(-this.kN2*s);this.chartRunTime+=s}getMvalueAt(t){var e,i;var n;n=this.ppHe+this.ppN2;e=(this.aHe*this.ppHe+this.aN2*this.ppN2)/n;i=(this.bHe*this.ppHe+this.bN2*this.ppN2)/n;return t/i+e}getHeMvalueAt(t){return t/this.bHe+this.aHe}getN2MvalueAt(t){return t/this.bN2+this.aN2}getMaxAmb(t){var e,i;var n;n=this.ppHe+this.ppN2;e=(this.aHe*this.ppHe+this.aN2*this.ppN2)/n;i=(this.bHe*this.ppHe+this.bN2*this.ppN2)/n;const s=(n-e*t)/(t/i-t+1);return s}getHeMaxAmb(t){return(this.ppHe-this.aHe*t)/(t/this.bHe-t+1)}getN2MaxAmb(t){return(this.ppN2-this.aN2*t)/(t/this.bN2-t+1)}getMV(t){var e,i;var n;n=this.ppHe+this.ppN2;e=(this.aHe*this.ppHe+this.aN2*this.ppN2)/n;i=(this.bHe*this.ppHe+this.bN2*this.ppN2)/n;return n/(t/i+e)}getHeMV(t){return this.ppHe/(t/this.bHe+this.aHe)}getN2MV(t){return this.ppN2/(t/this.bN2+this.aN2)}getPpHe(){return this.ppHe}getPpN2(){return this.ppN2}setPpHe(t){if(t<0){console.log("setPpHe",t);t=0}this.ppHe=t}setPpN2(t){if(t<0){console.log("setPpN2",t);t=0}this.ppN2=t}getKHe(){return this.kHe}getKN2(){return this.kN2}setKHe(t){this.kHe=t}setKN2(t){this.kN2=t}getAHe(){return this.aHe}getBHe(){return this.bHe}getAN2(){return this.aN2}getBN2(){return this.bN2}setAHe(t){this.aHe=t}setBHe(t){this.bHe=t}setAN2(t){this.aN2=t}setBN2(t){this.bN2=t}}class jP{constructor(t,e){this.pref=e;this.depth=t&&t.depth?this.pref.units==0?t.depth:t.depth/this.pref.METERS_TO_FEET:0;this.setpoint=t&&t.setpoint?t.setpoint:0;this.gas=t&&t.gas?new wP(t.gas.fO2,t.gas.fHe,t.gas.mod):new wP(.21,0);this.time=t&&t.time?t.time:0;this.runTime=t&&t.runTime?t.runTime:0;this.enable=t&&t.enable?t.enable:true;this.type=t&&t.type?t.type:this.pref.CONST}getEnd(){var t=this.depth+this.pref.getPAmb();var e=this.gas.getFN2();var i=this.gas.getFHe();var n;var s;if(this.setpoint>0){n=i+e>0?t-this.setpoint*this.pref.getPConversion():0;s=n>0?n*e/(i+e):0}else{s=t*e}var r=s/.79-this.pref.getPAmb();return r>0?r:0}getType(){return this.type}setType(t){this.type=t}getDepth(){return this.pref.units==0?this.depth:this.depth*this.pref.METERS_TO_FEET}getTime(){return this.time}getGas(){return this.gas}getSetpoint(){return this.setpoint}getRunTime(){return this.runTime}getEnable(){return this.enable}setEnable(t){this.enable=t}setDepth(t){this.depth=this.pref.units==0?t:t/this.pref.METERS_TO_FEET}setTime(t){this.time=t}setRunTime(t){this.runTime=t}setSetpoint(t){this.setpoint=t}setGas(t){this.gas=t}}class DP{constructor(t,e,i,n,s,r){this.pref=r;this.rate=i;this.depth=e;this.gas=n;this.setpoint=s;this.time=(e-t)/i;if(t<e)this.type=this.pref.DESCENT;else this.type=this.pref.ASCENT}gasUsed(){if(this.setpoint>0)return 0;var t;var e;var i;i=this.depth-this.rate*this.time;e=i+(this.depth-i)/2;t=(e+this.pref.getPAmb())/this.pref.getPConversion();return t*this.time*this.pref.getDiveRMV()}getRate(){return this.rate}}class RP{constructor(t,e,i,n,s){this.pref=s;this.depth=t;this.gas=i?i:new wP(.21,0);this.setpoint=n;this.type=this.pref.CONST;this.time=e}gasUsed(){if(this.setpoint>0)return 0;var t;t=(this.depth+this.pref.getPAmb())/this.pref.getPConversion();return t*this.time*this.pref.getDiveRMV()}toString(){}}class PP{constructor(t,e,i,n,s){this.pref=s;this.mvMax=0;this.gfUsed=0;this.controlCompartment=-1;this.depth=t;this.gas=i;this.setpoint=n;this.type=this.pref.DECO;this.time=e}gasUsed(){if(this.setpoint>0)return 0;var t;t=(this.depth+this.pref.getPAmb())/this.pref.getPConversion();return t*this.time*this.pref.getDecoRMV()}toStringLong(){}setControlCompartment(t){this.controlCompartment=t}setGfUsed(t){this.gfUsed=t}setMvMax(t){this.mvMax=t}}class NP{constructor(t,e){this.mv=20;this.fm=.8;this.mv=gP.convertInlt(t);this.fm=gP.convertInlt(e)/this.mv}getMv(){return this.mv}setMv(t){this.mv=gP.convertInlt(t)}getFm(){return this.fm}setFm(t){this.fm=gP.convertInlt(t)/this.mv}F(t,e){let i=0;let n=gP.depth2press(t);i=e/100-9*(this.fm/n)*(1-e/100);return i}PF(t,e){let i;let n=gP.depth2press(t);i=n*e/100-9*this.fm*(1-e/100);return i}PFd(t,e){let i=new Array;for(let n=1;n<=t;n++){let t=gP.depth2press(n);i[n]=t*e/100-9*this.fm*(1-e/100)}return i}hypoxicDepth(t){let e=1e3;for(let i=1;i<=e;i++){let e=gP.depth2press(i);let n=e*t/100-9*this.fm*(1-t/100);if(n>=.15)return i}return 0}Fn(t,e,i){let n=new Array;let s=gP.depth2press(t);if(e<=1){e=1}else{e=Math.round(e)}n[0]=1;for(let t=1;t<e;t++){n[t]=(.1+.9*(this.fm/s))*i/100+.9*(n[t-1]-this.fm/s)}return n}PFn(t,e,i){let n=new Array;let s=gP.depth2press(t);if(e<=1){e=1}else{e=Math.round(e)}n[0]=i/100*s;for(let t=1;t<e;t++){n[t]=(.1*s+.9*this.fm)*i/100+.9*(n[t-1]-this.fm)}return n}PFavg(t,e,i){let n=new Array;let s=gP.depth2press(t);let r=0;n[0]=i/100*s;r+=n[0];if(e<=1){e=1}else{e=Math.round(e)}for(let t=1;t<e;t++){n[t]=(.1*s+.9*this.fm)*i/100+.9*(n[t-1]-this.fm);r+=n[t]}return r/e}}class FP{constructor(){this.MODEL_VALIDATION_SUCCESS=0;this.MODEL_VALIDATION_FAILED=-1;this.METRIC=0;this.IMPERIAL=1;this.PROCESSING_ERROR=false;this.COMPS=16;this.pref=new bP;this.diveTools=new vP;this.bailout=true;this.diveIndex=0;this.tissues=[];this.unitsString="Metric";this.modelName="ZHL16B";this.setUnits("Metric");this.initGradient();this.initOxTox()}setUnits(t){this.pref.setUnitsTo(t=="Metric"?0:1)}initGradient(){this.gradient=new IP(this.pref.getGfLow(),this.pref.getGfHigh())}initOxTox(){this.oxTox=new kP}getGradient(){return this.gradient}setGradient(t){this.gradient=t}getOxTox(){return this.oxTox}setOxTox(t){this.oxTox=t}getTissues(){return this.tissues}setTissues(t){this.tissues=t}setModel(t,e){this.modelName=t;let i;this.gradient=new IP(this.pref.getGfLow(),this.pref.getGfHigh());this.oxTox=new kP;for(i=0;i<this.COMPS;i++){if(e)this.tissues[i]=new CP(this.pref,this.getAmbientPress());this.tissues[i].setPpHe(0);this.tissues[i].setPpN2(.79*(this.getAmbientPress()-this.pref.getPH2O()))}this.setTimeConstants()}controlCompartment(){let t;let e=0;let i=0;let n=0;for(t=0;t<this.COMPS;t++){n=this.tissues[t].getMaxAmb(this.gradient.getGradientFactor())-this.getAmbientPress();if(n>i){e=t;i=n}}return e+1}ceiling(){let t;let e=0;let i=0;for(t=0;t<this.COMPS;t++){i=this.tissues[t].getMaxAmb(this.gradient.getGradientFactor())-this.getAmbientPress();if(i>e)e=i}return e}mValue(t){let e;let i=t+this.getAmbientPress();let n=0;let s=0;for(e=0;e<this.COMPS;e++){n=this.tissues[e].getMV(i);if(n>s)s=n}return s}constDepth(t,e,i,n,s,r){let o;let a;let h;let c;let u=t+this.getAmbientPress();let l;if(s>0){if(i+n>0)c=u-this.pref.getPH2O()-s*this.pref.getPConversion();else c=0;if(c>0){o=c*i/(i+n);a=c*n/(i+n)}else{o=0;a=0}h=s*this.pref.getPConversion();if(h<=t+this.getAmbientPress()&&c>0)this.oxTox.addO2(e,s);else this.oxTox.addO2(e,(u-this.pref.getPH2O())/this.pref.getPConversion())}else{o=(u-this.pref.getPH2O())*i;a=(u-this.pref.getPH2O())*n;h=(u-this.pref.getPH2O())*(1-i-n);if(t==0){this.oxTox.removeO2(e)}else{this.oxTox.addO2(e,h/this.pref.getPConversion())}}if(e>0){for(l=0;l<this.COMPS;l++){this.tissues[l].constDepth(o,a,e,t,r,1-i-n,i,this.bailout,h/this.pref.getPConversion(),this.diveIndex)}}}ascDec(t,e,i,n,s,r){let o;let a;let h;let c;let u=Math.abs((e-t)/i);let l;let f;let d=t+this.getAmbientPress();let p=e+this.getAmbientPress();let m,_;if(u>0){if(r>0){m=d-r*this.pref.getPConversion()-this.pref.getPH2O();_=p-r*this.pref.getPConversion()-this.pref.getPH2O();if(m<0)m=0;if(_<0)_=0;if(n+s>0){a=m*n/(n+s);h=m*s/(n+s);l=(_*n/(n+s)-a)/u;f=(_*s/(n+s)-h)/u}else{a=0;h=0;l=0;f=0}this.oxTox.addO2(u,r)}else{a=(d-this.pref.getPH2O())*n;h=(d-this.pref.getPH2O())*s;l=i*n;f=i*s;c=((d-p)/2+p-this.pref.getPH2O())*(1-n-s)/this.pref.getPConversion();this.oxTox.addO2(u,c);r=c}for(o=0;o<this.COMPS;o++){this.tissues[o].ascDec(a,h,l,f,u,t,e,this.bailout,r,this.diveIndex)}}}setTimeConstants(t){if(!t)t=this.tissues;let e=[[1.88,5,16.189,.477,11.696,.5578],[3.02,8,13.83,.5747,10,.6514],[4.72,12.5,11.919,.6527,8.618,.7222],[6.99,18.5,10.458,.7223,7.562,.7825],[10.21,27,9.22,.7582,6.2,.8126],[14.48,38.3,8.205,.7957,5.043,.8434],[20.53,54.3,7.305,.8279,4.41,.8693],[29.11,77,6.502,.8553,4,.891],[41.2,109,5.95,.8757,3.75,.9092],[55.19,146,5.545,.8903,3.5,.9222],[70.69,187,5.333,.8997,3.295,.9319],[90.34,239,5.189,.9073,3.065,.9403],[115.29,305,5.181,.9122,2.835,.9477],[147.42,390,5.176,.9171,2.61,.9544],[188.24,498,5.172,.9217,2.48,.9602],[240.03,635,5.119,.9267,2.327,.9653]];let i=[];let n=[];let s=[];let r=[];let o=[];let a=[];const h=10.1;for(let t=0;t<16;t++){if(this.pref.helium_half_time_multiplier>=0){s[t]=(e[t][1]-e[t][0])/h*this.pref.helium_half_time_multiplier;i[t]=(e[t][4]-e[t][2])/h*this.pref.helium_half_time_multiplier;n[t]=(e[t][5]-e[t][3])/h*this.pref.helium_half_time_multiplier;r[t]=0;o[t]=0;a[t]=0}else{a[t]=(e[t][1]-e[t][0])/h*this.pref.helium_half_time_multiplier;r[t]=(e[t][4]-e[t][2])/h*this.pref.helium_half_time_multiplier;o[t]=(e[t][5]-e[t][3])/h*this.pref.helium_half_time_multiplier;s[t]=0;i[t]=0;n[t]=0}}if(this.modelName=="ZHL16C"){t[0].setCompartmentTimeConstants(0,1.88+s[0],5+a[0],16.189+i[0],.477+n[0],11.696+r[0],.5578+o[0]);t[1].setCompartmentTimeConstants(1,3.02+s[1],8+a[1],13.83+i[1],.5747+n[1],10+r[1],.6514+o[1]);t[2].setCompartmentTimeConstants(2,4.72+s[2],12.5+a[2],11.919+i[2],.6527+n[2],8.618+r[2],.7222+o[2]);t[3].setCompartmentTimeConstants(3,6.99+s[3],18.5+a[3],10.458+i[3],.7223+n[3],7.562+r[3],.7825+o[3]);t[4].setCompartmentTimeConstants(4,10.21+s[4],27+a[4],9.22+i[4],.7582+n[4],6.2+r[4],.8126+o[4]);t[5].setCompartmentTimeConstants(5,14.48+s[5],38.3+a[5],8.205+i[5],.7957+n[5],5.043+r[5],.8434+o[5]);t[6].setCompartmentTimeConstants(6,20.53+s[6],54.3+a[6],7.305+i[6],.8279+n[6],4.41+r[6],.8693+o[6]);t[7].setCompartmentTimeConstants(7,29.11+s[7],77+a[7],6.502+i[7],.8553+n[7],4+r[7],.891+o[7]);t[8].setCompartmentTimeConstants(8,41.2+s[8],109+a[8],5.95+i[8],.8757+n[8],3.75+r[8],.9092+o[8]);t[9].setCompartmentTimeConstants(9,55.19+s[9],146+a[9],5.545+i[9],.8903+n[9],3.5+r[9],.9222+o[9]);t[10].setCompartmentTimeConstants(10,70.69+s[10],187+a[10],5.333+i[10],.8997+n[10],3.295+r[10],.9319+o[10]);t[11].setCompartmentTimeConstants(11,90.34+s[11],239+a[11],5.189+i[11],.9073+n[11],3.065+r[11],.9403+o[11]);t[12].setCompartmentTimeConstants(12,115.29+s[12],305+a[12],5.181+i[12],.9122+n[12],2.835+r[12],.9477+o[12]);t[13].setCompartmentTimeConstants(13,147.42+s[13],390+a[13],5.176+i[13],.9171+n[13],2.61+r[13],.9544+o[13]);t[14].setCompartmentTimeConstants(14,188.24+s[14],498+a[14],5.172+i[14],.9217+n[14],2.48+r[14],.9602+o[14]);t[15].setCompartmentTimeConstants(15,240.03+s[15],635+a[15],5.119+i[15],.9267+n[15],2.327+r[15],.9653+o[15])}else if(this.modelName=="ZHL16B"){t[0].setCompartmentTimeConstants(0,1.88+s[0],5+a[0],16.189+i[0],.477+n[0],11.696+r[0],.5578+o[0]);t[1].setCompartmentTimeConstants(1,3.02+s[1],8+a[1],13.83+i[1],.5747+n[1],10+r[1],.6514+o[1]);t[2].setCompartmentTimeConstants(2,4.72+s[2],12.5+a[2],11.919+i[2],.6527+n[2],8.618+r[2],.7222+o[2]);t[3].setCompartmentTimeConstants(3,6.99+s[3],18.5+a[3],10.458+i[3],.7223+n[3],7.562+r[3],.7825+o[3]);t[4].setCompartmentTimeConstants(4,10.21+s[4],27+a[4],9.22+i[4],.7582+n[4],6.667+r[4],.8126+o[4]);t[5].setCompartmentTimeConstants(5,14.48+s[5],38.3+a[5],8.205+i[5],.7957+n[5],5.6+r[5],.8434+o[5]);t[6].setCompartmentTimeConstants(6,20.53+s[6],54.3+a[6],7.305+i[6],.8279+n[6],4.947+r[6],.8693+o[6]);t[7].setCompartmentTimeConstants(7,29.11+s[7],77+a[7],6.502+i[7],.8553+n[7],4.5+r[7],.891+o[7]);t[8].setCompartmentTimeConstants(8,41.2+s[8],109+a[8],5.95+i[8],.8757+n[8],4.187+r[8],.9092+o[8]);t[9].setCompartmentTimeConstants(9,55.19+s[9],146+a[9],5.545+i[9],.8903+n[9],3.798+r[9],.9222+o[9]);t[10].setCompartmentTimeConstants(10,70.69+s[10],187+a[10],5.333+i[10],.8997+n[10],3.497+r[10],.9319+o[10]);t[11].setCompartmentTimeConstants(11,90.34+s[11],239+a[11],5.189+i[11],.9073+n[11],3.223+r[11],.9403+o[11]);t[12].setCompartmentTimeConstants(12,115.29+s[12],305+a[12],5.181+i[12],.9122+n[12],2.85+r[12],.9477+o[12]);t[13].setCompartmentTimeConstants(13,147.42+s[13],390+a[13],5.176+i[13],.9171+n[13],2.737+r[13],.9544+o[13]);t[14].setCompartmentTimeConstants(14,188.24+s[14],498+a[14],5.172+i[14],.9217+n[14],2.523+r[14],.9602+o[14]);t[15].setCompartmentTimeConstants(15,240.03+s[15],635+a[15],5.119+i[15],.9267+n[15],2.327+r[15],.9653+o[15])}return t}getAmbientPress(){let t,e,i,n,s,r,o,a,h,c,u,l,f;f=6369;i=9.80665;e=28.9644;l=8.31432;r=288.15;h=33;c=10.1325;s=-6.5;a=i*e/l;t=this.pref.getAltitudeInMsw();n=t/1e3;o=n*f/(n+f);u=r+s*o;const d=c*Math.exp(Math.log(r/u)*a/s);const p=h*Math.exp(Math.log(r/u)*a/s);return gP.isImperial()?p:d}doSurfaceInterval(t){this.constDepth(0,t,0,.79,0,"surface");return true}calc_inspired_gas(t,e,i,n,s,r){if(!e||isNaN(e))e=0;if(!i||isNaN(i))i=0;let o=1-e-i;let a=this.pref.units==0?t:gP.feetToMeters(t);if(this.pref.configuration=="CCR"&&n!=0){let t=s?new wP(1-e-i,e):this.inputSegments[0].getGas();let r=t.getFHe()+t.getFN2();let h=t.getFHe()/r;let c=t.getFN2()/r;o=n/((a+this.pref.getPConversioninMsw())/this.pref.getPConversioninMsw());let u=1-o;let l=u*h;let f=u*c;if(o>1){o=1;e=0;i=0}else{e=l;i=f}}else if(this.pref.configuration=="pSCR"&&!this.pref.getOcDeco()){if(o<1&&r>0){let n=new NP(this.rmv,this.metabolic_o2_consumption);let s=(this.outputSegmentsGasRuntime[e+"/"+i]?this.outputSegmentsGasRuntime[e+"/"+i]:0)+r;let h=n.PFavg(t,s,o*100);let c=h/((a+this.pref.getPConversioninMsw())/this.pref.getPConversioninMsw());let u=1-c;let l=e/(e+i);let f=i/(e+i);let d=u*l;let p=u*f;e=d;i=p;o=c}else{o=1;e=0;i=0}}else;let h=new wP(o,e,parseInt(t),n);return h}addInspiredGasRuntime(t,e,i){if(!this.outputSegmentsGasRuntime[t+"/"+e])this.outputSegmentsGasRuntime[t+"/"+e]=0;this.outputSegmentsGasRuntime[t+"/"+e]+=i}doDive(t,e,i,n,s,r){this.diveIndex=r;this.bailout=s;if(!t.metric){this.pref.setUnitsTo(this.pref.IMPERIAL)}else{this.pref.setUnitsTo(this.pref.METRIC)}this.pref.setHelium_half_time_multiplier(t.helium_half_time_multiplier);this.pref.bottomppO2=t.bottomppO2;this.pref.decoppO2=t.decoppO2;this.pref.oxygenppO2=t.oxygenppO2;this.pref.setAltitude(dt.exports.toInteger(t.altitude_of_dive));this.pref.setGfLow(parseInt(t.gfLow)/100);this.pref.setGfHigh(parseInt(t.gfHigh)/100);this.pref.setGfLow_bailout(parseInt(t.gfLow_bailout)/100);this.pref.setGfHigh_bailout(parseInt(t.gfHigh_bailout)/100);let o=t.lastStop6m20ft?t.metric?6:20:t.metric?3:10;this.pref.setLastStopDepth(o);this.pref.setStopDepthIncrement(t.decoStepSize);this.pref.setAscentRate(t.ascentRate);this.pref.setDescentRate(t.descentRate);this.pref.setConfiguration(t.configuration);this.pref.setOcDeco(t.configuration!="OC"?false:true);this.pref.setBailout(s?true:false);this.metabolic_o2_consumption=t.metabolic_o2_consumption;this.rmv=t.rmvBottom;this.descentppO2=t.descentppO2;if(n===false){this.isRepetitiveDive=false;this.setModel(t.buhlModel,s)}else{this.isRepetitiveDive=true;this.initGradient()}this.inputSegments=[];this.outputSegments=[];this.outputSegmentsGasRuntime={};this.gases=[];this.runtime=0;e.forEach((e=>{let i=new jP({},this.pref);i.setDepth(parseFloat(e.depth));i.setTime(parseFloat(e.time));let n=e.gas;i.setGas(n);i.setSetpoint(e.setpoint&&t.configuration=="CCR"?parseFloat(e.setpoint):0);i.setEnable(true);this.inputSegments.push(i)}));for(let t in i){let e=i[t];this.gases.push(e)}this.gases=dt.exports.orderBy(this.gases,"fromDepth","desc");let a=null;let h=null;let c=null;let u=null;let l=null;let f=true;h=new jP(this.inputSegments[0],this.pref);this.currentGas=h.getGas();this.currentDepth=0;this.ppO2=h.getSetpoint()>0?this.descentppO2:0;this.inFinalAscent=false;this.inputSegments.forEach((t=>{h=t;if(h.getType()==this.pref.CONST){c=h;l=c.getDepth()-this.currentDepth;if(l>0){let t=l/this.pref.getDescentRate();let e=c.getDepth()-(c.getDepth()-this.currentDepth)/2;let i=this.calc_inspired_gas(e,this.currentGas.getFHe(),this.currentGas.getFN2(),this.ppO2,this.currentGas.getUseAsDiluent(),t);this.ascDec(this.currentDepth,c.getDepth(),this.pref.getDescentRate(),i.getFHe(),i.getFN2(),this.ppO2);this.outputSegments.push(new DP(this.currentDepth,c.getDepth(),this.pref.getDescentRate(),i,i.getpO2atDepth(c.getDepth()/2,1),this.pref));this.addInspiredGasRuntime(this.currentGas.getFHe(),this.currentGas.getFN2(),t);this.runtime+=t}else if(l<0){this.inFinalAscent=true;this.ascend(c.getDepth())}this.currentDepth=c.getDepth();this.ppO2=c.getSetpoint();this.currentGas=h.getGas();let t=this.currentGas;if(c.getTime()>0){if(f){t=this.calc_inspired_gas(this.currentDepth,this.currentGas.getFHe(),this.currentGas.getFN2(),this.ppO2,this.currentGas.getUseAsDiluent(),c.getTime()-this.runtime);f=false;try{this.constDepth(c.getDepth(),c.getTime()-this.runtime,t.getFHe(),t.getFN2(),this.ppO2,"bottom")}catch(t){return this.PROCESSING_ERROR}this.outputSegments.push(new RP(c.getDepth(),c.getTime()-this.runtime,t,this.pref.configuration=="CCR"?c.setpoint:t.getpO2atDepth(c.getDepth(),1),this.pref));this.addInspiredGasRuntime(this.currentGas.getFHe(),this.currentGas.getFN2(),Math.abs(c.getTime()-this.runtime));this.runtime=c.getTime()}else{t=this.calc_inspired_gas(this.currentDepth,this.currentGas.getFHe(),this.currentGas.getFN2(),this.ppO2,this.currentGas.getUseAsDiluent(),c.getTime());try{this.constDepth(c.getDepth(),c.getTime(),t.getFHe(),t.getFN2(),this.ppO2,"bottom")}catch(t){return this.PROCESSING_ERROR}this.outputSegments.push(new RP(c.getDepth(),c.getTime(),t,this.pref.configuration=="CCR"?c.setpoint:t.getpO2atDepth(c.getDepth(),1),this.pref));this.addInspiredGasRuntime(this.currentGas.getFHe(),this.currentGas.getFN2(),c.getTime());this.runtime+=c.getTime()}}else{this.outputSegments.push(new RP(c.getDepth(),c.getTime(),t,this.pref.configuration=="CCR"?c.setpoint:t.getpO2atDepth(c.getDepth(),1),this.pref))}}}));this.inFinalAscent=true;this.pref.setOcDeco(t.configuration!="OC"&&!s?false:true);a=this.ascend(0);if(a!=true)return a;u=0;let d=[];this.decotime=0;this.outputSegments.forEach((t=>{u+=t.time;t.runtime=u;if(t.type!=2){let e={depth:t.depth,equal:{},gas:t.gas,linear:{},mix:0,ppO2:t.setpoint>0?t.setpoint:t.gas.getpO2atDepth(this.currentDepth,1),rangeShape:"model",rmv:0,runtime:u,s:{},stage:this.pref.stage_descr[t.type],model:{runtime:u,stoptime:t.time}};d.push(e)}if(t.type==4){this.decotime+=t.time}this.runtime=u}));this.outputSegments=d;return this}ascend(t){let e=false;let i=false;let n=false;let s;let r=0;let o;let a=0;let h;let c=0;let u;let l;if(this.inFinalAscent&&this.pref.getOcDeco()){this.currentGasIndex=-1;this.setDecoGas(this.currentDepth)}if(this.currentDepth<t)return this.PROCESSING_ERROR;if(this.currentDepth%this.pref.getStopDepthIncrement()>0)h=this.currentDepth/this.pref.getStopDepthIncrement()*this.pref.getStopDepthIncrement();else h=this.currentDepth-this.pref.getStopDepthIncrement();if(h<t||this.currentDepth<this.pref.getStopDepthIncrement())h=t;else if(this.currentDepth==this.pref.getLastStopDepth())h=t;else if(h<this.pref.getLastStopDepth())h=this.pref.getLastStopDepth();o=this.currentDepth;i=true;this.getGradient().setGfAtDepth(h);a=this.mValue(this.currentDepth);c=this.controlCompartment();let f=this.currentGas;while(this.currentDepth>t){while(n||h<this.ceiling()){e=true;n=false;if(i){if(o>this.currentDepth){let t=new DP(o,this.currentDepth,this.pref.getAscentRate(),f,f.getpO2atDepth(this.currentDepth,1),this.pref);this.outputSegments.push(t)}i=false}if((!this.pref.getGfMultilevelMode()||this.inFinalAscent)&&!this.getGradient().isGfSet()){this.getGradient().setGfSlopeAtDepth(this.currentDepth);this.getGradient().setGfAtDepth(h)}if(r==0){let t=Math.round(this.runtime/this.pref.getStopTimeIncrement()+.5)*this.pref.getStopTimeIncrement();s=t-this.runtime}else{s=this.pref.getStopTimeIncrement()}if(s==0)s=this.pref.getStopTimeIncrement();if(s>0&&s<=1)s=1;r+=s;f=this.calc_inspired_gas(this.currentDepth,this.currentGas.getFHe(),this.currentGas.getFN2(),this.ppO2,this.currentGas.getUseAsDiluent(),r);this.constDepth(this.currentDepth,s,f.getFHe(),f.getFN2(),this.ppO2,"ascent");if(r>5e3){return false}}if(e){this.runtime+=r;n=true;l=new PP(this.currentDepth,r,f,f.getpO2atDepth(this.currentDepth,1),this.pref);l.setMvMax(a);l.setGfUsed(this.getGradient().getGf());l.setControlCompartment(c);this.outputSegments.push(l);this.addInspiredGasRuntime(this.currentGas.getFHe(),this.currentGas.getFN2(),r);e=false;r=0}else if(i){this.ascDec(this.currentDepth,h,this.pref.getAscentRate(),f.getFHe(),f.getFN2(),this.ppO2);this.runtime+=(this.currentDepth-h)/(-1*this.pref.getAscentRate())}this.currentDepth=h;a=this.mValue(this.currentDepth);c=this.controlCompartment();u=f;if(this.setDecoGas(this.currentDepth)==true){if(i){let t=new DP(o,this.currentDepth,this.pref.getAscentRate(),u,u.getpO2atDepth(this.currentDepth,1),this.pref);this.outputSegments.push(t);o=this.currentDepth}}h=this.roundUpMultiple(this.currentDepth-this.pref.getStopDepthIncrement(),this.pref.getStopDepthIncrement());if(h<t||this.currentDepth<this.pref.getLastStopDepth())h=t;else if(this.currentDepth==this.pref.getLastStopDepth())h=t;else if(h<this.pref.getLastStopDepth())h=this.pref.getLastStopDepth();if(this.getGradient().isGfSet()){this.getGradient().setGfAtDepth(h)}}if(i){let t=new DP(o,this.currentDepth,this.pref.getAscentRate(),f,f.getpO2atDepth(this.currentDepth,1),this.pref);this.outputSegments.push(t)}return true}roundUpMultiple(t,e){return t+(e-t%e)%e}setDecoGas(t){let e;let i=false;let n=false;if(!this.inFinalAscent)return false;if(this.gases.length==0)return false;if(this.pref.getOcDeco()||this.pref.configuration=="pSCR"){this.currentGas=this.gases[0];this.currentGasIndex=0;this.ppO2=0;while(!i&&this.currentGasIndex+1<this.gases.length){e=this.gases[this.currentGasIndex+1];if(e.getFromDepth()>=t){this.currentGasIndex+=1;if(this.currentGas.O2<=e.O2){this.currentGas=e;n=true}}else{i=true}}}else{this.ccr_currentGasIndex=0;while(!i&&this.ccr_currentGasIndex+1<this.gases.length){e=this.gases[this.ccr_currentGasIndex+1];if(e.getFromDepth()>=t||this.diveTools.depth2press(t)<=1.7){this.ccr_currentGasIndex+=1;this.currentGas=e;if(this.diveTools.depth2press(t)<=1.7&&e.O2<95){this.ppO2=this.pref.oxygenppO2}else{this.ppO2=e.ppO2}n=true}else{i=true}}}return n}}class zP{constructor(){this.critical_radius_n2_microns_basic=.55;this.critical_radius_he_microns_basic=.45;this.crit_volume_parameter_lambda=6500;this.gradient_onset_of_imperm_atm=8.2;this.surface_tension_gamma=.0179;this.skin_compression_gammac=.257;this.regeneration_time_constant=20160;this.pressure_other_gases_mmhg=102;this.MAX_DECO_MIXES=5;this.MAX_BOTTOM_MIXES=5;this.MAX_PROFILE_POINTS=10;this.MAX_OUTPUT_POINTS=70;this.MAX_DIVES=5;this.tissues=[];this.pref=new bP;this.diveBuhlmann=new FP;this.calc_deco_ceiling=function(){let t;let e,i;let n;let s=new Array;for(t=1;t<=16;++t){e=this.helium_pressure[t-1]+this.nitrogen_pressure[t-1];if(e>0){i=(this.deco_gradient_he[t-1]*this.helium_pressure[t-1]+this.deco_gradient_n2[t-1]*this.nitrogen_pressure[t-1])/(this.helium_pressure[t-1]+this.nitrogen_pressure[t-1]);n=e+this.constant_pressure_other_gases-i}else{i=Math.min(this.deco_gradient_he[t-1],this.deco_gradient_n2[t-1]);n=this.constant_pressure_other_gases-i}if(n<0){n=0}s[t-1]=n-this.barometric_pressure}this.deco_ceiling_depth=s[0];for(t=2;t<=16;++t){this.deco_ceiling_depth=Math.max(this.deco_ceiling_depth,s[t-1])}return 0};this.vpm_repetitive_algorithm=function(t){let e;let i;let n,s,r,o;for(i=1;i<=16;++i){e=this.max_actual_gradient[i-1]/this.units_factor*101325;r=this.adjusted_crushing_pressure_he[i-1]/this.units_factor*101325;n=this.adjusted_crushing_pressure_n2[i-1]/this.units_factor*101325;if(this.max_actual_gradient[i-1]>this.initial_allowable_gradient_n2[i-1]){s=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(e*this.skin_compression_gammac-this.surface_tension_gamma*n);this.adjusted_critical_radius_n2[i-1]=this.initial_critical_radius_n2[i-1]+(this.initial_critical_radius_n2[i-1]-s)*Math.exp(-t/this.regeneration_time_constant)}else{this.adjusted_critical_radius_n2[i-1]=this.initial_critical_radius_n2[i-1]}if(this.max_actual_gradient[i-1]>this.initial_allowable_gradient_he[i-1]){o=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(e*this.skin_compression_gammac-this.surface_tension_gamma*r);this.adjusted_critical_radius_he[i-1]=this.initial_critical_radius_he[i-1]+(this.initial_critical_radius_he[i-1]-o)*Math.exp(-t/this.regeneration_time_constant)}else{this.adjusted_critical_radius_he[i-1]=this.initial_critical_radius_he[i-1]}}return 0};this.configuration="OC";this.conservatism=2;this.deco_gas_switch_time=1;this.lastStop6m20ft=false;this.altitude_dive_algorithm="off";this.minimum_deco_stop_time=1;this.critical_volume_algorithm="on";this.diver_acclimatized_at_altitude="no";this.starting_acclimatized_altitude=0;this.ascent_to_altitude_hours=2;this.hours_at_altitude_before_dive=3;this.helium_half_time_multiplier=0;this.descentppO2=.7;this.VPM_gf_high=90;this.VPM_GFS=false;let t="Metric";this.setUnits(t);this.dive_no=0;this.bottomMixSetPoint=new Array;this.decoMixSetPoint=new Array;this.decoMixUseDiluentGas=new Array;this.decoMixfO2=new Array;this.decoMixfHe=new Array;this.decoMOD=new Array;this.bottomMixfO2=new Array;this.bottomMixfHe=new Array;this.profileDepth=new Array;this.profileTime=new Array;this.profileMix=new Array;this.profileDecAccSpeed=new Array;this.surfaceIntervals=new Array;this.outputProfileDepth=new Array;this.outputProfileTime=new Array;this.outputProfileSegmentTime=new Array;this.outputProfileSegmentType=new Array;this.outputProfileMixO2=new Array;this.outputProfileMixHe=new Array;this.outputProfileGas=new Array;this.outputProfileCounter=0;this.decoProfileCalculated=false;this.outputStartOfDecoDepth=new Array;this.firstDecoProfilePoint=null;this.firstDecoPoint=new Array;this.deco_ceiling_depth=null;this.ascent_ceiling_depth=null;this.deco_stop_depth=null;this.next_deco_stop_depth=null;this.err=null;this.fO2=null;this.fHe=null;this.fN2=null;this.dc=null;this.rc=null;this.ssc=null;this.mc=null;this.water_vapor_pressure=null;this.run_time=null;this.segment_number=null;this.segment_time=null;this.ending_ambient_pressure=null;this.mix_number=null;this.barometric_pressure=null;this.units_equal_fsw=null;this.units_equal_msw=null;this.units_factor=null;this.helium_time_constant=new Array;this.nitrogen_time_constant=new Array;this.helium_pressure=new Array;this.nitrogen_pressure=new Array;this.fraction_helium=new Array;this.fraction_nitrogen=new Array;this.fraction_pO2SetPoint=new Array;this.fraction_useDiluentGas=new Array;this.initial_critical_radius_he=new Array;this.initial_critical_radius_n2=new Array;this.adjusted_critical_radius_he=new Array;this.adjusted_critical_radius_n2=new Array;this.max_crushing_pressure_he=new Array;this.max_crushing_pressure_n2=new Array;this.surface_phase_volume_time=new Array;this.max_actual_gradient=new Array;this.amb_pressure_onset_of_imperm=new Array;this.gas_tension_onset_of_imperm=new Array;this.initial_helium_pressure=new Array;this.initial_nitrogen_pressure=new Array;this.regenerated_radius_he=new Array;this.regenerated_radius_n2=new Array;this.adjusted_crushing_pressure_he=new Array;this.adjusted_crushing_pressure_n2=new Array;this.allowable_gradient_he=new Array;this.allowable_gradient_n2=new Array;this.deco_gradient_he=new Array;this.deco_gradient_n2=new Array;this.initial_allowable_gradient_he=new Array;this.initial_allowable_gradient_n2=new Array;this.constant_pressure_other_gases=null}setUnits(t){if(t==="Imperial"){this.units="ft";this.altitude_of_dive=3300;this.decoStepSize=10;this.finalAscentSpeed=-30}else{this.units="mt";this.altitude_of_dive=1e3;this.decoStepSize=3;this.finalAscentSpeed=-9}this.pref.setUnitsTo(t=="Metric"?0:1)}newMission(){let t,e;for(t=0;t<=this.MAX_DECO_MIXES;t++){if(!Array.isArray(this.decoMixfO2[t]))this.decoMixfO2[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.decoMixfO2[t][e]=-1;if(!Array.isArray(this.decoMixfHe[t]))this.decoMixfHe[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.decoMixfHe[t][e]=-1;if(!Array.isArray(this.decoMOD[t]))this.decoMOD[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.decoMOD[t][e]=-1;if(!Array.isArray(this.decoMixSetPoint[t]))this.decoMixSetPoint[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.decoMixSetPoint[t][e]=-1;if(!Array.isArray(this.decoMixUseDiluentGas[t]))this.decoMixUseDiluentGas[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.decoMixUseDiluentGas[t][e]=-1}for(t=0;t<=this.MAX_BOTTOM_MIXES;t++){if(!Array.isArray(this.bottomMixfO2[t]))this.bottomMixfO2[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.bottomMixfO2[t][e]=-1;if(!Array.isArray(this.bottomMixfHe[t]))this.bottomMixfHe[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.bottomMixfHe[t][e]=-1;if(!Array.isArray(this.bottomMixSetPoint[t]))this.bottomMixSetPoint[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.bottomMixSetPoint[t][e]=-1}for(t=0;t<=this.MAX_PROFILE_POINTS;t++){if(!Array.isArray(this.profileDepth[t]))this.profileDepth[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.profileDepth[t][e]=-1;if(!Array.isArray(this.profileTime[t]))this.profileTime[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.profileTime[t][e]=-1;if(!Array.isArray(this.profileMix[t]))this.profileMix[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.profileMix[t][e]=-1;if(!Array.isArray(this.profileDecAccSpeed[t]))this.profileDecAccSpeed[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.profileDecAccSpeed[t][e]=-1}for(t=0;t<=this.MAX_OUTPUT_POINTS;t++){if(!Array.isArray(this.outputProfileDepth[t]))this.outputProfileDepth[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileDepth[t][e]=-1;if(!Array.isArray(this.outputProfileTime[t]))this.outputProfileTime[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileTime[t][e]=-1;if(!Array.isArray(this.outputProfileSegmentTime[t]))this.outputProfileSegmentTime[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileSegmentTime[t][e]=-1;if(!Array.isArray(this.outputProfileSegmentType[t]))this.outputProfileSegmentType[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileSegmentType[t][e]=-1;if(!Array.isArray(this.outputProfileMixO2[t]))this.outputProfileMixO2[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileMixO2[t][e]=-1;if(!Array.isArray(this.outputProfileMixHe[t]))this.outputProfileMixHe[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileMixHe[t][e]=-1;if(!Array.isArray(this.outputProfileGas[t]))this.outputProfileGas[t]=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileGas[t][e]=-1}this.outputProfileGasRuntime=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.outputProfileGasRuntime[e]={};this.minimum_profile_depth=new Array;for(e=0;e<=this.MAX_DIVES;e++)this.minimum_profile_depth[e]=1e7;this.dive_no=0;this.decoProfileCalculated=false}addSurfaceInterval(t){if(this.dive_no<this.MAX_DIVES-1){this.dive_no++;this.surfaceIntervals[this.dive_no]=t;return this.dive_no}return-1}addBottomMix(t,e,i){let n;if(t+e>1||t<.01||e<0)return-1;for(n=0;n<this.MAX_BOTTOM_MIXES;n++){if(this.bottomMixfO2[n][this.dive_no]==-1){this.bottomMixfO2[n][this.dive_no]=t;this.bottomMixfHe[n][this.dive_no]=e;this.bottomMixSetPoint[n][this.dive_no]=i;return n}}return-1}addDecoMix(t,e,i,n,s){let r;if(t+e>1||t<.01||e<0)return-1;for(r=0;r<this.MAX_DECO_MIXES;r++){if(r>0&&i>=this.decoMOD[r-1][this.dive_no])return-1;if(this.decoMixfO2[r][this.dive_no]==-1){this.decoMixfO2[r][this.dive_no]=t;this.decoMixfHe[r][this.dive_no]=e;this.decoMOD[r][this.dive_no]=i;this.decoMixSetPoint[r][this.dive_no]=n;this.decoMixUseDiluentGas[r][this.dive_no]=s;return r}}return-1}addProfilePoint(t,e,i,n){let s;if(t<0||n<0||n>=this.MAX_DECO_MIXES)return-1;for(s=0;s<this.MAX_PROFILE_POINTS;s++){if(this.profileDepth[s][this.dive_no]==-1){if(s!=0&&t<this.profileDepth[s-1][this.dive_no]&&i>=0)return-1;if(s!=0&&t>this.profileDepth[s-1][this.dive_no]&&i<=0)return-1;if(s==0&&i<=0)return-1;this.profileDepth[s][this.dive_no]=t;this.profileTime[s][this.dive_no]=e;this.profileMix[s][this.dive_no]=n;this.profileDecAccSpeed[s][this.dive_no]=i;this.minimum_profile_depth[this.dive_no]=this.minimum_profile_depth[this.dive_no]<t?this.minimum_profile_depth[this.dive_no]:t;return s}}return 1}getProfilePoint(t,e,i){if(this.decoProfileCalculated==false||t>=this.MAX_OUTPUT_POINTS||i>=this.MAX_DIVES)return-1;if(this.outputProfileDepth[t][i]==-1)return-1;switch(e){case 1:return this.outputProfileDepth[t][i];case 2:return this.outputProfileTime[t][i];case 3:return this.outputProfileSegmentTime[t][i];case 4:return this.outputProfileMixO2[t][i];case 5:return this.outputProfileMixHe[t][i];case 6:return this.outputProfileSegmentType[t][i]}return-1}addInspiredGasRuntime(t,e,i){if(!this.outputProfileGasRuntime[this.current_dive_number][t+"/"+e])this.outputProfileGasRuntime[this.current_dive_number][t+"/"+e]=0;this.outputProfileGasRuntime[this.current_dive_number][t+"/"+e]+=i}getProfileGasIndex(t,e){if(this.decoProfileCalculated==false||t>=this.MAX_OUTPUT_POINTS||e>=this.MAX_DIVES)return-1;if(this.outputProfileDepth[t][e]==-1)return-1;return this.outputProfileGas[t][e]}runVPM(t,e){this.newMission();this.run_bailout=e;let i=t;i.diveMixO2=new Array;i.diveMixHe=new Array;i.diveMixSetPoint=new Array;i.diveMixUseDiluentGas=new Array;i.diveGas=new Array;let n=0;i.noBottomMix=new Array;this.decoStepSize=t.parameters.decoStepSize;this.descentppO2=t.parameters.descentppO2;this.conservatism=e?t.parameters.conservatism_bailout:t.parameters.conservatism;this.configuration=t.parameters.configuration;this.deco_gas_switch_time=t.parameters.time_at_gas_switch_for_min_gas;this.lastStop6m20ft=t.parameters.lastStop6m20ft;this.critical_volume_algorithm=t.parameters.critical_volume_algorithm?"on":"off";this.altitude_dive_algorithm=t.parameters.altitude_dive_algorithm;this.altitude_of_dive=t.parameters.altitude_of_dive;this.ascent_to_altitude_hours=t.parameters.ascent_to_altitude_hours;this.hours_at_altitude_before_dive=t.parameters.hours_at_altitude_before_dive;this.metabolic_o2_consumption=t.parameters.metabolic_o2_consumption;this.rmv=t.parameters.rmvBottom;this.helium_half_time_multiplier=parseFloat(t.parameters.helium_half_time_multiplier);this.VPM_GFS=t.parameters.VPM_GFS;this.VPM_gf_high=t.parameters.VPM_gf_high;let s;let r,o;for(let e=0;e<this.MAX_BOTTOM_MIXES+t.parameters.MAX_DECOMIX;e++){for(let t=0;t<this.MAX_DIVES;t++){if(!Array.isArray(i.diveMixO2[e]))i.diveMixO2[e]=new Array;i.diveMixO2[e][t]=-1;if(!Array.isArray(i.diveMixHe[e]))i.diveMixHe[e]=new Array;i.diveMixHe[e][t]=-1;if(!Array.isArray(i.diveMixSetPoint[e]))i.diveMixSetPoint[e]=new Array;i.diveMixSetPoint[e][t]=-1;if(!Array.isArray(i.diveMixUseDiluentGas[e]))i.diveMixUseDiluentGas[e]=new Array;i.diveMixUseDiluentGas[e][t]=-1}i.diveGas[e]=0}for(n=0;n<this.MAX_DIVES;n++){i.noBottomMix[n]=0;for(let e=0;e<t.parameters.MAX_DIVEPONTS;e++){if(t.profilePointDepth[e][n]<0){if(e==0){let e=this.addBottomMix(.21,0,0);this.addProfilePoint(0,0,parseFloat(t.parameters.descentRate),e)}break}for(let o=0;true;o++){if(o==this.MAX_BOTTOM_MIXES){s+="Max. number of bottom mixes exceded - "+o;console.log("1",s);return}if(i.diveMixO2[o][n]==-1){r=this.addBottomMix(t.profilePointMixO2[e][n]/100,t.profilePointMixHe[e][n]/100,t.profilePointMixSetPoint[e][n]);if(r<0){s+="Internal ERROR 1: mix="+r+"divepoint="+e+"\n";console.log("2",s);return}i.diveMixO2[r][n]=t.profilePointMixO2[e][n];i.diveMixHe[r][n]=t.profilePointMixHe[e][n];i.diveMixSetPoint[r][n]=t.profilePointMixSetPoint[e][n];i.diveMixUseDiluentGas[r][n]=true;break}if(t.profilePointMixO2[e][n]==i.diveMixO2[o][n]&&t.profilePointMixHe[e][n]==i.diveMixHe[o][n]){r=o;break}}if(r>i.noBottomMix[n])i.noBottomMix[n]=r;if(e==0)o=parseFloat(t.parameters.descentRate);else if(t.profilePointDepth[e][n]>t.profilePointDepth[e-1][n])o=parseFloat(t.parameters.descentRate);else o=-parseFloat(t.parameters.ascentRate);if(this.addProfilePoint(t.profilePointDepth[e][n],t.profilePointRT[e][n],o,r)<0){s+="Internal ERROR 2\n";console.log("3",s);return}}for(let e=0;e<t.parameters.MAX_DECOMIX;e++){if(t.decomixfromdepth[e][n]<0)break;let r=this.addDecoMix(t.decomixO2[e][n]/100,t.decomixHe[e][n]/100,t.decomixfromdepth[e][n],t.decomixSetPoint[e][n],t.decomixUseDiluentGas[e][n]);if(r<0){s+="Internal ERROR 0: "+t.decomixO2[e][n]/100+"-"+t.decomixHe[e][n]/100;console.log("4",s);return}i.diveMixO2[i.noBottomMix[n]+1+e][n]=t.decomixO2[e][n];i.diveMixHe[i.noBottomMix[n]+1+e][n]=t.decomixHe[e][n];i.diveMixSetPoint[i.noBottomMix[n]+1+e][n]=t.decomixSetPoint[e][n];i.diveMixUseDiluentGas[i.noBottomMix[n]+1+e][n]=t.decomixUseDiluentGas[e][n]}if(n<this.MAX_DIVES-1)if(this.addSurfaceInterval(t.surfaceIntervals[n+1])<0){s+="Internal ERROR 0.1: "+n;console.log("5",s)}}this.finalAscentSpeed=-parseFloat(t.parameters.ascentRate);let a=this.calculate();if(a<-1){console.log("Dive #"+(-a/100+1)+" Dive Point "+(-a%100+1)+" to deep\n");return false}else if(a<0){console.log("VPM Internal ERROR 3");return false}return true}calculate(){let t=[[1.88,5],[3.02,8],[4.72,12.5],[6.99,18.5],[10.21,27],[14.48,38.3],[20.53,54.3],[29.11,77],[41.2,109],[55.19,146],[70.69,187],[90.34,239],[115.29,305],[147.42,390],[188.24,498],[240.03,635]];let e=[];let i=[];for(let n=0;n<16;n++){if(this.helium_half_time_multiplier>=0){e[n]=(t[n][1]-t[n][0])/10.1*this.helium_half_time_multiplier;i[n]=0}else{e[n]=0;i[n]=(t[n][1]-t[n][0])/10.1*this.helium_half_time_multiplier}}for(let t=0;t<16;t++){this.tissues[t]=new CP(this.pref,this.diveBuhlmann.getAmbientPress());this.tissues[t].setPpHe(0);this.tissues[t].setPpN2(.79*(this.diveBuhlmann.getAmbientPress()-this.pref.getPH2O()))}let n=new Array(1.88+e[0],3.02+e[1],4.72+e[2],6.99+e[3],10.21+e[4],14.48+e[5],20.53+e[6],29.11+e[7],41.2+e[8],55.19+e[9],70.69+e[10],90.34+e[11],115.29+e[12],147.42+e[13],188.24+e[14],240.03+e[15]);let s=new Array(5+i[0],8+i[1],12.5+i[2],18.5+i[3],27+i[4],38.3+i[5],54.3+i[6],77+i[7],109+i[8],146+i[9],187+i[10],239+i[11],305+i[12],390+i[13],498+i[14],635+i[15]);let r,o;this.critical_radius_n2_microns=this.critical_radius_n2_microns_basic+this.conservatism/20,this.critical_radius_he_microns=this.critical_radius_he_microns_basic+this.conservatism/20;let a=new Array,h,c,u=new Array,l=new Array,f,d,p,m,_=new Array,v,g=new Array,b,w,y,x,M,T,O,E,A,S,k=new Array,I,C=new Array;let j,D,R,P,N=new Array,F=new Array,z=new Array,L,$,U,B,G=new Array,H=0,V,W,q=0;this.current_dive_number=0;let Y=true;if(this.units=="ft"||this.units=="FT"){this.units_equal_fsw=true;this.units_equal_msw=false}else if(this.units=="mt"||this.units=="MT"){this.units_equal_fsw=false;this.units_equal_msw=true}else{return-1}if(this.altitude_dive_algorithm=="ON"||this.altitude_dive_algorithm=="on"){f=false}else{f=true}if(this.critical_radius_n2_microns<.2||this.critical_radius_n2_microns>1.35){console.log("critical_radius_n2_microns out of range",this.critical_radius_n2_microns);return-1}if(this.critical_radius_he_microns<.2||this.critical_radius_he_microns>1.35){console.log("critical_radius_he_microns out of range",this.critical_radius_he_microns);return-1}if(this.critical_volume_algorithm=="ON"||this.critical_volume_algorithm=="on"){j=false}else{j=true}if(this.units_equal_fsw){this.units_factor=33;this.water_vapor_pressure=1.607}else{this.units_factor=10.1325;this.water_vapor_pressure=.493}this.constant_pressure_other_gases=this.pressure_other_gases_mmhg/760*this.units_factor;this.run_time=0;this.segment_number=0;for(b=1;b<=16;++b){this.helium_time_constant[b-1]=Math.log(2)/n[b-1];this.nitrogen_time_constant[b-1]=Math.log(2)/s[b-1];this.max_crushing_pressure_he[b-1]=0;this.max_crushing_pressure_n2[b-1]=0;this.max_actual_gradient[b-1]=0;this.surface_phase_volume_time[b-1]=0;this.amb_pressure_onset_of_imperm[b-1]=0;this.gas_tension_onset_of_imperm[b-1]=0;this.initial_critical_radius_n2[b-1]=this.critical_radius_n2_microns*1e-6;this.initial_critical_radius_he[b-1]=this.critical_radius_he_microns*1e-6}if(f){v=0;this.calc_barometric_pressure(v);for(b=1;b<=16;++b){this.adjusted_critical_radius_n2[b-1]=this.initial_critical_radius_n2[b-1];this.adjusted_critical_radius_he[b-1]=this.initial_critical_radius_he[b-1];this.helium_pressure[b-1]=0;this.nitrogen_pressure[b-1]=(this.barometric_pressure-this.water_vapor_pressure)*.79}}else{this.vpm_altitude_dive_algorithm()}while(true){this.outputProfileCounter=0;h=0;for(b=1;b<=this.MAX_BOTTOM_MIXES;++b){if(this.bottomMixfO2[b-1][this.current_dive_number]<0)break;a[b-1]=this.bottomMixfO2[b-1][this.current_dive_number];this.fraction_helium[b-1]=this.bottomMixfHe[b-1][this.current_dive_number];this.fraction_nitrogen[b-1]=1-this.bottomMixfO2[b-1][this.current_dive_number]-this.bottomMixfHe[b-1][this.current_dive_number];this.fraction_pO2SetPoint[b-1]=this.bottomMixSetPoint[b-1][this.current_dive_number];this.fraction_useDiluentGas[b-1]=true}W=b-1;for(w=1;w<=this.MAX_DECO_MIXES;++w){if(this.decoMixfO2[w-1][this.current_dive_number]<0)break;a[b+w-2]=this.decoMixfO2[w-1][this.current_dive_number];this.fraction_helium[b+w-2]=this.decoMixfHe[w-1][this.current_dive_number];this.fraction_nitrogen[b+w-2]=1-this.decoMixfO2[w-1][this.current_dive_number]-this.decoMixfHe[w-1][this.current_dive_number];if(this.run_bailout){this.fraction_pO2SetPoint[b+w-2]=0;this.fraction_useDiluentGas[b+w-2]=true}else{this.fraction_pO2SetPoint[b+w-2]=this.decoMixSetPoint[w-1][this.current_dive_number];this.fraction_useDiluentGas[b+w-2]=this.decoMixUseDiluentGas[w-1][this.current_dive_number]}}V=w-1;b=0;m=-1;while(true){if(this.profileDepth[b][this.current_dive_number]<0)break;if(this.profileDepth[b][this.current_dive_number]<m)break;if(b==0){this.mix_number=this.profileMix[b][this.current_dive_number]+1;R=0}else{this.mix_number=this.profileMix[b-1][this.current_dive_number]+1;R=this.profileDepth[b-1][this.current_dive_number]}d=this.profileDepth[b][this.current_dive_number];c=this.profileDecAccSpeed[b][this.current_dive_number];this.gas_loadings_ascent_descent(R,d,c);if(d>R){this.calc_crushing_pressure(R,d,c)}if(b>=0){this.outputProfileDepth[this.outputProfileCounter][this.current_dive_number]=d;this.outputProfileTime[this.outputProfileCounter][this.current_dive_number]=this.run_time;this.outputProfileSegmentTime[this.outputProfileCounter][this.current_dive_number]=this.segment_time;if(R<d){this.outputProfileSegmentType[this.outputProfileCounter][this.current_dive_number]="descent"}else{this.outputProfileSegmentType[this.outputProfileCounter][this.current_dive_number]="bottom_ascent"}let t=false;if(b==0){t=this.run_bailout}if(t)this.run_bailout=false;let e=this.calc_inspired_gas(d-(d-R)/2+this.barometric_pressure,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],R===0?this.descentppO2:this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],this.segment_time);if(t)this.run_bailout=true;this.outputProfileMixO2[this.outputProfileCounter][this.current_dive_number]=e.fraction_oxygen;this.outputProfileMixHe[this.outputProfileCounter][this.current_dive_number]=e.fraction_helium;this.addInspiredGasRuntime(this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.segment_time);this.outputProfileCounter++}x=this.profileDepth[b][this.current_dive_number];h+=this.profileTime[b][this.current_dive_number];if(b>0){if(this.profileDepth[b][this.current_dive_number]<this.profileDepth[b-1][this.current_dive_number])h+=Math.floor((this.profileDepth[b][this.current_dive_number]-this.profileDepth[b-1][this.current_dive_number])/this.profileDecAccSpeed[b][this.current_dive_number])}this.mix_number=this.profileMix[b][this.current_dive_number]+1;this.gas_loadings_constant_depth(x,h);H=d;b++;this.outputProfileDepth[this.outputProfileCounter][this.current_dive_number]=x;this.outputProfileTime[this.outputProfileCounter][this.current_dive_number]=this.run_time;this.outputProfileSegmentTime[this.outputProfileCounter][this.current_dive_number]=this.segment_time;this.outputProfileSegmentType[this.outputProfileCounter][this.current_dive_number]="bottom";let t=this.calc_inspired_gas(x+this.barometric_pressure,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],this.segment_time);this.outputProfileMixO2[this.outputProfileCounter][this.current_dive_number]=t.fraction_oxygen;this.outputProfileMixHe[this.outputProfileCounter][this.current_dive_number]=t.fraction_helium;this.addInspiredGasRuntime(this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.segment_time);this.outputProfileGas[this.outputProfileCounter][this.current_dive_number]=this.mix_number-1;M=this.calc_start_of_deco_zone(x,this.finalAscentSpeed);if(this.units_equal_fsw){if(this.decoStepSize<10){U=M/this.decoStepSize-.5;m=Math.round(U)*this.decoStepSize}else{U=M/10-.5;m=Math.round(U)*10}}if(this.units_equal_msw){if(this.decoStepSize<3){U=M/this.decoStepSize-.5;m=Math.round(U)*this.decoStepSize}else{U=M/3-.5;m=Math.round(U)*3}}this.outputProfileCounter++}if(d>0&&b>0){this.firstDecoProfilePoint=this.outputProfileCounter-1}this.nuclear_regeneration(this.run_time);this.calc_initial_allowable_gradient();for(b=1;b<=16;++b){_[b-1]=this.helium_pressure[b-1];u[b-1]=this.nitrogen_pressure[b-1]}T=this.run_time;$=this.segment_number;O=V+1;l[0]=H;C[0]=this.mix_number;N[0]=this.finalAscentSpeed;g[0]=this.decoStepSize;for(b=1;b<=V;b++){l[b]=this.decoMOD[b-1][this.current_dive_number];C[b]=W+b;N[b]=this.finalAscentSpeed;g[b]=this.decoStepSize}if(this.lastStop6m20ft){for(b=1;b<=V;b++){if(l[b]==2*this.decoStepSize)g[b]=2*this.decoStepSize}if(b>=V){l[b]=2*this.decoStepSize;C[b]=C[b-1];N[b]=this.finalAscentSpeed;g[b]=2*this.decoStepSize;O++}}R=l[0];this.mix_number=C[0];c=N[0];A=g[0];M=this.calc_start_of_deco_zone(R,c);this.outputStartOfDecoDepth[this.current_dive_number]=M;if(this.units_equal_fsw){if(A<10){U=M/A-.5;m=Math.round(U)*A}else{U=M/10-.5;m=Math.round(U)*10}}if(this.units_equal_msw){if(A<3){U=M/A-.5;m=Math.round(U)*A}else{U=M/3-.5;m=Math.round(U)*3}}this.gas_loadings_ascent_descent(R,M,c);p=this.run_time;P=0;S=0;D=false;for(b=1;b<=16;++b){F[b-1]=0;G[b-1]=this.helium_pressure[b-1];z[b-1]=this.nitrogen_pressure[b-1];this.max_actual_gradient[b-1]=0}while(true){this.calc_ascent_ceiling();if(this.ascent_ceiling_depth<=0){this.deco_stop_depth=0}else{B=this.ascent_ceiling_depth/A+.5;this.deco_stop_depth=Math.round(B)*A}if(this.deco_stop_depth>M){return-1}this.projected_ascent(M,c,A);if(this.deco_stop_depth>M){return-1}if(this.deco_stop_depth==0){for(b=1;b<=16;++b){this.helium_pressure[b-1]=_[b-1];this.nitrogen_pressure[b-1]=u[b-1]}this.run_time=T;this.segment_number=$;R=l[0];d=0;this.gas_loadings_ascent_descent(R,d,c);break}R=M;let t=0;if(this.profileDepth[this.firstDecoProfilePoint][this.current_dive_number]>=this.deco_stop_depth&&this.profileDepth[this.firstDecoProfilePoint][this.current_dive_number]>0){this.deco_stop_depth=this.profileDepth[this.firstDecoProfilePoint][this.current_dive_number];q=this.profileTime[this.firstDecoProfilePoint][this.current_dive_number];this.mix_number=this.profileMix[this.firstDecoProfilePoint][this.current_dive_number]+1;c=this.profileDecAccSpeed[this.firstDecoProfilePoint][this.current_dive_number];t++;Y=false}y=this.deco_stop_depth;while(true){this.gas_loadings_ascent_descent(R,this.deco_stop_depth,c);if(this.deco_stop_depth<=0){break}if(Y){if(O>1){r=O;for(b=2;b<=r;++b){if(l[b-1]==this.deco_stop_depth)q=Math.max(this.deco_gas_switch_time,q);if(l[b-1]>=this.deco_stop_depth){this.mix_number=C[b-1];c=N[b-1];A=g[b-1]}}}}Y=true;this.next_deco_stop_depth=this.deco_stop_depth-A;this.next_deco_stop_depth=this.roundDecoStop(this.next_deco_stop_depth,A);if(this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number]>=this.next_deco_stop_depth-A/2&&this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number]>0){if(this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number]>this.profileDepth[this.firstDecoProfilePoint+t-1][this.current_dive_number])return-(this.firstDecoProfilePoint+t+100*this.current_dive_number);this.next_deco_stop_depth=this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number];this.boyles_law_compensation(y,this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth);this.decompression_stop(this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth,0,q);q=this.profileTime[this.firstDecoProfilePoint+t][this.current_dive_number];this.mix_number=this.profileMix[this.firstDecoProfilePoint+t][this.current_dive_number]+1;c=this.profileDecAccSpeed[this.firstDecoProfilePoint+t][this.current_dive_number];t++;Y=false}else{this.boyles_law_compensation(y,this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth);this.decompression_stop(this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth,0,q);q=0}if(this.next_deco_stop_depth<0)this.next_deco_stop_depth=0;R=this.deco_stop_depth;S=this.run_time;this.deco_stop_depth=this.next_deco_stop_depth}P=this.run_time-p;this.calc_surface_phase_volume_time();for(b=1;b<=16;++b){k[b-1]=P+this.surface_phase_volume_time[b-1];L=Math.abs(o=k[b-1]-F[b-1]);if(L<=1){D=true}}if(D||j){for(b=1;b<=16;++b){this.helium_pressure[b-1]=_[b-1];this.nitrogen_pressure[b-1]=u[b-1]}this.run_time=T;this.segment_number=$;R=l[0];this.mix_number=C[0];c=N[0];A=g[0];this.deco_stop_depth=y;S=0;t=0;if(this.profileDepth[this.firstDecoProfilePoint][this.current_dive_number]==this.deco_stop_depth){q=this.profileTime[this.firstDecoProfilePoint][this.current_dive_number];this.mix_number=this.profileMix[this.firstDecoProfilePoint][this.current_dive_number]+1;c=this.profileDecAccSpeed[this.firstDecoProfilePoint][this.current_dive_number];t++;Y=false}while(true){this.calc_max_actual_gradient(this.deco_stop_depth);this.gas_loadings_ascent_descent(R,this.deco_stop_depth,c);if(this.deco_stop_depth<=0){break}if(Y){if(O>1){r=O;for(b=2;b<=r;++b){if(l[b-1]==this.deco_stop_depth)q=Math.max(this.deco_gas_switch_time,q);if(l[b-1]>=this.deco_stop_depth){this.mix_number=C[b-1];c=N[b-1];A=g[b-1]}}}}Y=true;this.next_deco_stop_depth=this.deco_stop_depth-A;this.next_deco_stop_depth=this.roundDecoStop(this.next_deco_stop_depth,A);if(this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number]>=this.next_deco_stop_depth-A/2&&this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number]>0){if(this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number]>this.profileDepth[this.firstDecoProfilePoint+t-1][this.current_dive_number])return-(this.firstDecoProfilePoint+t+100*this.current_dive_number);this.next_deco_stop_depth=this.profileDepth[this.firstDecoProfilePoint+t][this.current_dive_number];this.boyles_law_compensation(y,this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth);this.decompression_stop(this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth,0,q);q=this.profileTime[this.firstDecoProfilePoint+t][this.current_dive_number];if(S==0){o=this.segment_time/this.minimum_deco_stop_time+.5;E=Math.round(o)*this.minimum_deco_stop_time}else{E=this.run_time-S}let e=this.calc_inspired_gas(this.deco_stop_depth+this.barometric_pressure,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],E);this.outputProfileMixO2[this.outputProfileCounter][this.current_dive_number]=e.fraction_oxygen;this.outputProfileMixHe[this.outputProfileCounter][this.current_dive_number]=e.fraction_helium;this.outputProfileGas[this.outputProfileCounter][this.current_dive_number]=this.mix_number-1;this.mix_number=this.profileMix[this.firstDecoProfilePoint+t][this.current_dive_number]+1;c=this.profileDecAccSpeed[this.firstDecoProfilePoint+t][this.current_dive_number];t++;Y=false}else{this.boyles_law_compensation(y,this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth);this.decompression_stop(this.deco_stop_depth,this.deco_stop_depth-this.next_deco_stop_depth,0,q);q=0;if(S==0){o=this.segment_time/this.minimum_deco_stop_time+.5;E=Math.round(o)*this.minimum_deco_stop_time}else{E=this.run_time-S}let t=this.calc_inspired_gas(this.deco_stop_depth+this.barometric_pressure,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],E);this.outputProfileMixO2[this.outputProfileCounter][this.current_dive_number]=t.fraction_oxygen;this.outputProfileMixHe[this.outputProfileCounter][this.current_dive_number]=t.fraction_helium;this.outputProfileGas[this.outputProfileCounter][this.current_dive_number]=this.mix_number-1}this.outputProfileDepth[this.outputProfileCounter][this.current_dive_number]=this.deco_stop_depth;this.outputProfileTime[this.outputProfileCounter][this.current_dive_number]=this.run_time;this.outputProfileSegmentTime[this.outputProfileCounter][this.current_dive_number]=E;this.addInspiredGasRuntime(this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],E);if(this.outputProfileCounter==this.firstDecoProfilePoint+1){this.outputProfileSegmentType[this.outputProfileCounter][this.current_dive_number]="first_ascent"}this.outputProfileCounter++;this.outputProfileSegmentType[this.outputProfileCounter][this.current_dive_number]=Y?"ascent":"bottom";this.outputProfileDepth[this.outputProfileCounter][this.current_dive_number]=-1;R=this.deco_stop_depth;S=this.run_time;this.deco_stop_depth=this.next_deco_stop_depth}break}else{this.critical_volume(P);P=0;this.run_time=p;R=M;this.mix_number=C[0];c=N[0];A=g[0];for(b=1;b<=16;++b){F[b-1]=k[b-1];this.helium_pressure[b-1]=G[b-1];this.nitrogen_pressure[b-1]=z[b-1]}continue}}if(this.current_dive_number++>=this.dive_no)break;I=this.surfaceIntervals[this.current_dive_number];this.gas_loadings_surface_interval(I);this.vpm_repetitive_algorithm(I);for(b=1;b<=16;++b){this.max_crushing_pressure_he[b-1]=0;this.max_crushing_pressure_n2[b-1]=0;this.max_actual_gradient[b-1]=0}this.run_time=0;this.segment_number=0}this.decoProfileCalculated=true;return 0}schreiner_equation__(t,e,i,n,s){let r;r=t+e*(i-1/n)-(t-s-e/n)*Math.exp(-n*i);return r}haldane_equation__(t,e,i,n){let s;s=t+(e-t)*(1-Math.exp(-i*n));return s}calc_inspired_gas(t,e,i,n,s,r){if(this.run_bailout&&t-this.barometric_pressure<this.minimum_profile_depth[this.current_dive_number]){n=0}if(!e||isNaN(e))e=0;if(!i||isNaN(i))i=0;let o=1-e-i;let a=t-this.barometric_pressure;if(this.configuration=="CCR"&&n!=0){let t=s?e+i:this.fraction_helium[0]+this.fraction_nitrogen[0];let r=(s?e:this.fraction_helium[0])/t;let h=(s?i:this.fraction_nitrogen[0])/t;let c=n/gP.depth2press(a);let u=1-c;let l=u*r;let f=u*h;if(c>1);else{e=l;i=f;o=c}}else if(this.configuration=="pSCR"&&n!=0){if(o<1&&r>0){let t=new NP(this.rmv,this.metabolic_o2_consumption);let n=(this.outputProfileGasRuntime[this.current_dive_number][e+"/"+i]?this.outputProfileGasRuntime[this.current_dive_number][e+"/"+i]:0)+r;let s=t.PFavg(a,n,o*100);let h=s/gP.depth2press(a);let c=1-h;let u=e/(e+i);let l=i/(e+i);let f=c*u;let d=c*l;if(s>=.16){e=f;i=d;o=h}}}else;return{fraction_oxygen:o,fraction_helium:e,fraction_nitrogen:i}}gas_loadings_ascent_descent(t,e,i){let n,s;let r,o,a,h,c;let u;this.segment_time=(e-t)/i;h=this.run_time;this.run_time=h+this.segment_time;n=this.segment_number;this.segment_number=n+1;this.ending_ambient_pressure=e+this.barometric_pressure;c=t+this.barometric_pressure;let l=e-(e-t)/2;let f=this.calc_inspired_gas(l+this.barometric_pressure,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],1);o=(c-this.water_vapor_pressure)*f.fraction_helium;r=(c-this.water_vapor_pressure)*f.fraction_nitrogen;u=i*f.fraction_helium;a=i*f.fraction_nitrogen;for(s=1;s<=16;++s){this.initial_helium_pressure[s-1]=this.helium_pressure[s-1];this.initial_nitrogen_pressure[s-1]=this.nitrogen_pressure[s-1];this.helium_pressure[s-1]=this.schreiner_equation__(o,u,this.segment_time,this.helium_time_constant[s-1],this.initial_helium_pressure[s-1]);this.nitrogen_pressure[s-1]=this.schreiner_equation__(r,a,this.segment_time,this.nitrogen_time_constant[s-1],this.initial_nitrogen_pressure[s-1])}return 0}calc_crushing_pressure(t,e,i){let n,s;let r,o,a,h;let c,u,l,f=0;let d;let p,m,_,v,g=0,b,w,y,x,M,T,O;let E,A,S,k,I,C,j,D,R;m=this.gradient_onset_of_imperm_atm*this.units_factor;h=this.gradient_onset_of_imperm_atm*101325;T=t+this.barometric_pressure;a=e+this.barometric_pressure;for(d=1;d<=16;++d){_=this.initial_helium_pressure[d-1]+this.initial_nitrogen_pressure[d-1]+this.constant_pressure_other_gases;x=T-_;O=this.helium_pressure[d-1]+this.nitrogen_pressure[d-1]+this.constant_pressure_other_gases;I=a-O;M=1/(h/((this.skin_compression_gammac-this.surface_tension_gamma)*2)+1/this.adjusted_critical_radius_he[d-1]);y=1/(h/((this.skin_compression_gammac-this.surface_tension_gamma)*2)+1/this.adjusted_critical_radius_n2[d-1]);if(I<=m){g=a-O;f=a-O}if(I>m){if(x==m){this.amb_pressure_onset_of_imperm[d-1]=T;this.gas_tension_onset_of_imperm[d-1]=_}if(x<m){this.onset_of_impermeability(T,a,i,d)}E=a/this.units_factor*101325;b=this.amb_pressure_onset_of_imperm[d-1]/this.units_factor*101325;C=this.gas_tension_onset_of_imperm[d-1]/this.units_factor*101325;D=(this.skin_compression_gammac-this.surface_tension_gamma)*2;j=E-b+C+(this.skin_compression_gammac-this.surface_tension_gamma)*2/M;n=M;R=C*(n*(n*n));v=M;c=D/j;u=this.radius_root_finder(j,D,R,c,v);n=M;s=u;w=h+E-b+C*(1-n*(n*n)/(s*(s*s)));g=w/101325*this.units_factor;S=(this.skin_compression_gammac-this.surface_tension_gamma)*2;A=E-b+C+(this.skin_compression_gammac-this.surface_tension_gamma)*2/y;n=y;k=C*(n*(n*n));l=y;r=S/A;o=this.radius_root_finder(A,S,k,r,l);n=y;s=o;p=h+E-b+C*(1-n*(n*n)/(s*(s*s)));f=p/101325*this.units_factor}n=this.max_crushing_pressure_he[d-1];this.max_crushing_pressure_he[d-1]=Math.max(n,g);n=this.max_crushing_pressure_n2[d-1];this.max_crushing_pressure_n2[d-1]=Math.max(n,f)}return 0}onset_of_impermeability(t,e,i,n){let s=true;let r,o,a;let h;let c=0,u,l,f,d,p,m,_,v,g,b,w,y,x,M;let T=0,O,E,A;l=this.gradient_onset_of_imperm_atm*this.units_factor;let S=this.calc_inspired_gas(t,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],1);p=(t-this.water_vapor_pressure)*S.fraction_helium;u=(t-this.water_vapor_pressure)*S.fraction_nitrogen;E=i*S.fraction_helium;_=i*S.fraction_nitrogen;d=0;b=(e-t)/i;f=this.initial_helium_pressure[n-1]+this.initial_nitrogen_pressure[n-1]+this.constant_pressure_other_gases;g=t-f-l;O=this.schreiner_equation__(p,E,b,this.helium_time_constant[n-1],this.initial_helium_pressure[n-1]);m=this.schreiner_equation__(u,_,b,this.nitrogen_time_constant[n-1],this.initial_nitrogen_pressure[n-1]);x=O+m+this.constant_pressure_other_gases;M=e-x-l;if(M*g>=0){this.pause()}if(g<0){r=d;A=b-d}else{r=b;A=d-b}for(h=1;h<=100;++h){o=A;A=o*.5;y=r+A;T=t+i*y;w=this.schreiner_equation__(p,E,y,this.helium_time_constant[n-1],this.initial_helium_pressure[n-1]);a=this.schreiner_equation__(u,_,y,this.nitrogen_time_constant[n-1],this.initial_nitrogen_pressure[n-1]);c=w+a+this.constant_pressure_other_gases;v=T-c-l;if(v<=0){r=y}if(Math.abs(A)<.001||v==0){s=false;break}}if(s){this.pause()}this.amb_pressure_onset_of_imperm[n-1]=T;this.gas_tension_onset_of_imperm[n-1]=c;return 0}radius_root_finder(t,e,i,n,s){let r;let o,a,h,c;let u;let l,f,d,p,m;l=n*(n*(t*n-e))-i;d=s*(s*(t*s-e))-i;if(l>0&&d>0){this.pause()}if(l<0&&d<0){this.pause()}if(l==0){r=n;return r}else if(d==0){r=s;return r}else if(l<0){o=n;c=s}else{c=n;o=s}r=(n+s)*.5;a=Math.abs(s-n);m=a;h=r*(r*(t*r-e))-i;p=r*(r*3*t-e*2);for(u=1;u<=100;++u){if(((r-c)*p-h)*((r-o)*p-h)>=0||Math.abs(h*2)>Math.abs(a*p)){a=m;m=(c-o)*.5;r=o+m;if(o==r){return r}}else{a=m;m=h/p;f=r;r-=m;if(f==r){return r}}if(Math.abs(m)<1e-12){return r}h=r*(r*(t*r-e))-i;p=r*(r*3*t-e*2);if(h<0){o=r}else{c=r}}this.pause();return 0}gas_loadings_constant_depth(t,e){let i;let n;let s;let r;let o,a,h,c;this.segment_time=e-this.run_time;h=e;this.run_time=h;n=this.segment_number;this.segment_number=n+1;o=t+this.barometric_pressure;let u=this.calc_inspired_gas(o,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],this.segment_time);a=(o-this.water_vapor_pressure)*u.fraction_helium;i=(o-this.water_vapor_pressure)*u.fraction_nitrogen;this.ending_ambient_pressure=o;for(r=1;r<=16;++r){s=this.helium_pressure[r-1];c=this.nitrogen_pressure[r-1];this.helium_pressure[r-1]=this.haldane_equation__(s,a,this.helium_time_constant[r-1],this.segment_time);this.nitrogen_pressure[r-1]=this.haldane_equation__(c,i,this.nitrogen_time_constant[r-1],this.segment_time)}return}nuclear_regeneration(t){let e,i,n;let s;let r,o,a,h,c;for(s=1;s<=16;++s){o=this.max_crushing_pressure_he[s-1]/this.units_factor*101325;r=this.max_crushing_pressure_n2[s-1]/this.units_factor*101325;n=1/(o/((this.skin_compression_gammac-this.surface_tension_gamma)*2)+1/this.adjusted_critical_radius_he[s-1]);i=1/(r/((this.skin_compression_gammac-this.surface_tension_gamma)*2)+1/this.adjusted_critical_radius_n2[s-1]);this.regenerated_radius_he[s-1]=this.adjusted_critical_radius_he[s-1]+(n-this.adjusted_critical_radius_he[s-1])*Math.exp(-t/this.regeneration_time_constant);this.regenerated_radius_n2[s-1]=this.adjusted_critical_radius_n2[s-1]+(i-this.adjusted_critical_radius_n2[s-1])*Math.exp(-t/this.regeneration_time_constant);e=n*(this.adjusted_critical_radius_he[s-1]-this.regenerated_radius_he[s-1])/(this.regenerated_radius_he[s-1]*(this.adjusted_critical_radius_he[s-1]-n));c=i*(this.adjusted_critical_radius_n2[s-1]-this.regenerated_radius_n2[s-1])/(this.regenerated_radius_n2[s-1]*(this.adjusted_critical_radius_n2[s-1]-i));h=o*e;a=r*c;this.adjusted_crushing_pressure_he[s-1]=h/101325*this.units_factor;this.adjusted_crushing_pressure_n2[s-1]=a/101325*this.units_factor}return 0}calc_initial_allowable_gradient(){let t,e;let i;for(i=1;i<=16;++i){t=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(this.regenerated_radius_n2[i-1]*this.skin_compression_gammac);e=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(this.regenerated_radius_he[i-1]*this.skin_compression_gammac);this.initial_allowable_gradient_n2[i-1]=t/101325*this.units_factor;this.initial_allowable_gradient_he[i-1]=e/101325*this.units_factor;this.allowable_gradient_he[i-1]=this.initial_allowable_gradient_he[i-1];this.allowable_gradient_n2[i-1]=this.initial_allowable_gradient_n2[i-1]}return 0}calc_ascent_ceiling(){let t,e;let i;let n;let s=new Array,r,o;for(n=1;n<=16;++n){r=this.helium_pressure[n-1]+this.nitrogen_pressure[n-1];if(r>0){let t=this.VPM_GFS?this.VPM_gf_high/100:1;i=(this.allowable_gradient_he[n-1]*this.helium_pressure[n-1]+this.allowable_gradient_n2[n-1]*this.nitrogen_pressure[n-1])/r;o=r+this.constant_pressure_other_gases-i*t}else{t=this.allowable_gradient_he[n-1];e=this.allowable_gradient_n2[n-1];i=Math.min(t,e);o=this.constant_pressure_other_gases-i}if(o<0){o=0}s[n-1]=o-this.barometric_pressure}this.ascent_ceiling_depth=s[0];for(n=2;n<=16;++n){t=this.ascent_ceiling_depth;e=s[n-1];this.ascent_ceiling_depth=Math.max(t,e)}return 0}calc_max_actual_gradient(t){let e;let i;let n;for(i=1;i<=16;++i){n=this.helium_pressure[i-1]+this.nitrogen_pressure[i-1]+this.constant_pressure_other_gases-(t+this.barometric_pressure);if(n<=0){n=0}e=this.max_actual_gradient[i-1];this.max_actual_gradient[i-1]=Math.max(e,n)}return 0}calc_surface_phase_volume_time(){let t;let e;let i,n;n=(this.barometric_pressure-this.water_vapor_pressure)*.79;for(e=1;e<=16;++e){if(this.nitrogen_pressure[e-1]>n){this.surface_phase_volume_time[e-1]=(this.helium_pressure[e-1]/this.helium_time_constant[e-1]+(this.nitrogen_pressure[e-1]-n)/this.nitrogen_time_constant[e-1])/(this.helium_pressure[e-1]+this.nitrogen_pressure[e-1]-n)}else if(this.nitrogen_pressure[e-1]<=n&&this.helium_pressure[e-1]+this.nitrogen_pressure[e-1]>=n){t=1/(this.nitrogen_time_constant[e-1]-this.helium_time_constant[e-1])*Math.log((n-this.nitrogen_pressure[e-1])/this.helium_pressure[e-1]);i=this.helium_pressure[e-1]/this.helium_time_constant[e-1]*(1-Math.exp(-this.helium_time_constant[e-1]*t))+(this.nitrogen_pressure[e-1]-n)/this.nitrogen_time_constant[e-1]*(1-Math.exp(-this.nitrogen_time_constant[e-1]*t));this.surface_phase_volume_time[e-1]=i/(this.helium_pressure[e-1]+this.nitrogen_pressure[e-1]-n)}else{this.surface_phase_volume_time[e-1]=0}}return 0}critical_volume(t){let e;let i,n,s,r,o;let a;let h,c=new Array,u,l,f;s=this.crit_volume_parameter_lambda/33*101325;for(a=1;a<=16;++a){c[a-1]=t+this.surface_phase_volume_time[a-1]}for(a=1;a<=16;++a){f=this.adjusted_crushing_pressure_he[a-1]/this.units_factor*101325;n=this.initial_allowable_gradient_he[a-1]/this.units_factor*101325;r=n+s*this.surface_tension_gamma/(this.skin_compression_gammac*c[a-1]);o=this.surface_tension_gamma*(this.surface_tension_gamma*(s*f))/(this.skin_compression_gammac*(this.skin_compression_gammac*c[a-1]));e=r;u=(r+Math.sqrt(e*e-o*4))/2;this.allowable_gradient_he[a-1]=u/101325*this.units_factor}for(a=1;a<=16;++a){l=this.adjusted_crushing_pressure_n2[a-1]/this.units_factor*101325;i=this.initial_allowable_gradient_n2[a-1]/this.units_factor*101325;r=i+s*this.surface_tension_gamma/(this.skin_compression_gammac*c[a-1]);o=this.surface_tension_gamma*(this.surface_tension_gamma*(s*l))/(this.skin_compression_gammac*(this.skin_compression_gammac*c[a-1]));e=r;h=(r+Math.sqrt(e*e-o*4))/2;this.allowable_gradient_n2[a-1]=h/101325*this.units_factor}return 0}calc_start_of_deco_zone(t,e){let i=true;let n;let s,r,o;let a,h;let c,u,l,f,d,p,m,_,v,g,b,w,y,x;let M,T,O,E;n=0;w=t+this.barometric_pressure;let A=this.calc_inspired_gas(w,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],1);f=(w-this.water_vapor_pressure)*A.fraction_helium;c=(w-this.water_vapor_pressure)*A.fraction_nitrogen;O=e*A.fraction_helium;p=e*A.fraction_nitrogen;l=0;v=w/e*-1;for(a=1;a<=16;++a){r=this.helium_pressure[a-1];y=this.nitrogen_pressure[a-1];_=r+y+this.constant_pressure_other_gases-w;T=this.schreiner_equation__(f,O,v,this.helium_time_constant[a-1],r);d=this.schreiner_equation__(c,p,v,this.nitrogen_time_constant[a-1],y);x=T+d+this.constant_pressure_other_gases;if(x*_>=0){this.pause()}if(_<0){M=l;E=v-l}else{M=v;E=l-v}for(h=1;h<=100;++h){s=E;E=s*.5;b=M+E;g=this.schreiner_equation__(f,O,b,this.helium_time_constant[a-1],r);o=this.schreiner_equation__(c,p,b,this.nitrogen_time_constant[a-1],y);m=g+o+this.constant_pressure_other_gases-(w+e*b);if(m<=0){M=b}if(Math.abs(E)<.001||m==0){i=false;break}}if(i){this.pause()}u=w+e*M-this.barometric_pressure;n=Math.max(n,u)}return n}projected_ascent(t,e,i){let n,s;let r,o=new Array,a=new Array,h;let c;let u,l,f,d,p=new Array,m,_,v=new Array;let g,b;l=this.deco_stop_depth+this.barometric_pressure;_=t+this.barometric_pressure;let w=this.calc_inspired_gas(_,this.fraction_helium[this.mix_number-1],this.fraction_nitrogen[this.mix_number-1],this.fraction_pO2SetPoint[this.mix_number-1],this.fraction_useDiluentGas[this.mix_number-1],1);d=(_-this.water_vapor_pressure)*w.fraction_helium;u=(_-this.water_vapor_pressure)*w.fraction_nitrogen;g=e*w.fraction_helium;m=e*w.fraction_nitrogen;for(c=1;c<=16;++c){o[c-1]=this.helium_pressure[c-1];v[c-1]=this.nitrogen_pressure[c-1]}while(true){let t=false;this.ending_ambient_pressure=l;h=(this.ending_ambient_pressure-_)/e;for(c=1;c<=16;++c){f=this.schreiner_equation__(d,g,h,this.helium_time_constant[c-1],o[c-1]);b=this.schreiner_equation__(u,m,h,this.nitrogen_time_constant[c-1],v[c-1]);a[c-1]=f+b;if(a[c-1]>0){r=(this.allowable_gradient_he[c-1]*f+this.allowable_gradient_n2[c-1]*b)/a[c-1]}else{n=this.allowable_gradient_he[c-1];s=this.allowable_gradient_n2[c-1];r=Math.min(n,s)}p[c-1]=this.ending_ambient_pressure+r-this.constant_pressure_other_gases}for(c=1;c<=16;++c){if(a[c-1]>p[c-1]){l=this.ending_ambient_pressure+i;this.deco_stop_depth+=i}else{t=true;break}}if(t)break}return 0}boyles_law_compensation(t,e,i){let n;let s;let r,o;let a,h;let c,u,l,f,d,p;let m;let _,v;let g,b;let w=new Array,y=new Array;let x=new Array,M=new Array;s=e-i;r=t+this.barometric_pressure;o=s+this.barometric_pressure;a=r/this.units_factor*101325;h=o/this.units_factor*101325;for(n=1;n<=16;++n){_=this.allowable_gradient_he[n-1]/this.units_factor*101325;v=2*this.surface_tension_gamma/_;w[n-1]=v;c=h;u=-2*this.surface_tension_gamma;l=(a+2*this.surface_tension_gamma/v)*v*(v*v);f=v;d=v*this.cbrtf(a/h);p=this.radius_root_finder(c,u,l,f,d);y[n-1]=p;m=2*this.surface_tension_gamma/p;this.deco_gradient_he[n-1]=m/101325*this.units_factor}for(n=1;n<=16;++n){g=this.allowable_gradient_n2[n-1]/this.units_factor*101325;b=2*this.surface_tension_gamma/g;x[n-1]=b;c=h;u=-2*this.surface_tension_gamma;l=(a+2*this.surface_tension_gamma/b)*b*(b*b);f=b;d=b*this.cbrtf(a/h);p=this.radius_root_finder(c,u,l,f,d);M[n-1]=p;m=2*this.surface_tension_gamma/p;this.deco_gradient_n2[n-1]=m/101325*this.units_factor}return 0}decompression_stop(t,e,i,n){let s;let r;let o;let a,h=new Array;let c;let u;let l;let f,d,p,m;let _=new Array,v;p=this.run_time;s=p/this.minimum_deco_stop_time+.5;v=Math.round(s)*this.minimum_deco_stop_time;this.segment_time=v-this.run_time;this.run_time=v;m=this.segment_time;o=this.segment_number;this.segment_number=o+1;l=t+this.barometric_pressure;this.ending_ambient_pressure=l;d=t-e;let g=this;function b(t){return g.calc_inspired_gas(l,g.fraction_helium[g.mix_number-1],g.fraction_nitrogen[g.mix_number-1],g.fraction_pO2SetPoint[g.mix_number-1],g.fraction_useDiluentGas[g.mix_number-1],t)}let w=b(this.segment_time);f=(l-this.water_vapor_pressure)*w.fraction_helium;r=(l-this.water_vapor_pressure)*w.fraction_nitrogen;for(u=1;u<=16;++u){if(f+r>0){a=(this.deco_gradient_he[u-1]*f+this.deco_gradient_n2[u-1]*r)/(f+r);if(f+r+this.constant_pressure_other_gases-a>d+this.barometric_pressure){this.exit(1)}}}while(true){w=b(this.run_time-p);f=(l-this.water_vapor_pressure)*w.fraction_helium;r=(l-this.water_vapor_pressure)*w.fraction_nitrogen;for(u=1;u<=16;++u){h[u-1]=this.helium_pressure[u-1];_[u-1]=this.nitrogen_pressure[u-1];this.helium_pressure[u-1]=this.haldane_equation__(h[u-1],f,this.helium_time_constant[u-1],this.segment_time);this.nitrogen_pressure[u-1]=this.haldane_equation__(_[u-1],r,this.nitrogen_time_constant[u-1],this.segment_time)}this.calc_deco_ceiling();if(this.deco_ceiling_depth>d){this.segment_time=this.minimum_deco_stop_time;c=m;m=c+this.minimum_deco_stop_time;this.run_time=this.run_time+this.minimum_deco_stop_time}else break}if(i>0){this.segment_time=i;m+=this.segment_time;this.run_time+=this.segment_time;for(u=1;u<=16;++u){h[u-1]=this.helium_pressure[u-1];_[u-1]=this.nitrogen_pressure[u-1];this.helium_pressure[u-1]=this.haldane_equation__(h[u-1],f,this.helium_time_constant[u-1],this.segment_time);this.nitrogen_pressure[u-1]=this.haldane_equation__(_[u-1],r,this.nitrogen_time_constant[u-1],this.segment_time)}this.calc_deco_ceiling()}if(this.run_time-Math.floor(p)<n){this.segment_time=n-(this.run_time-Math.floor(p));m+=this.segment_time;this.run_time+=this.segment_time;for(u=1;u<=16;++u){h[u-1]=this.helium_pressure[u-1];_[u-1]=this.nitrogen_pressure[u-1];this.helium_pressure[u-1]=this.haldane_equation__(h[u-1],f,this.helium_time_constant[u-1],this.segment_time);this.nitrogen_pressure[u-1]=this.haldane_equation__(_[u-1],r,this.nitrogen_time_constant[u-1],this.segment_time)}this.calc_deco_ceiling()}this.segment_time=m;return 0}gas_loadings_surface_interval(t){let e,i;let n;let s,r;s=0;e=(this.barometric_pressure-this.water_vapor_pressure)*.79;for(n=1;n<=16;++n){i=this.helium_pressure[n-1];r=this.nitrogen_pressure[n-1];this.helium_pressure[n-1]=this.haldane_equation__(i,s,this.helium_time_constant[n-1],t);this.nitrogen_pressure[n-1]=this.haldane_equation__(r,e,this.nitrogen_time_constant[n-1],t)}return 0}calc_barometric_pressure(t){let e,i,n,s,r,o,a,h,c,u,l,f,d,p,m;m=6369;n=9.80665;i=28.9644;p=8.31432;a=288.15;l=33;f=10.1325;o=-6.5;u=n*i/p;if(this.units_equal_fsw){r=t;s=r/3280.839895;h=l}else{e=t;s=e/1e3;h=f}c=s*m/(s+m);d=a+o*c;this.barometric_pressure=h*Math.exp(Math.log(a/d)*u/o);return 0}vpm_altitude_dive_algorithm(){let t;let e,i,n,s,r,o;let a;let h,c,u,l;let f,d,p,m;let _,v;let g;let b,w;if(this.units_equal_fsw&&this.altitude_of_dive>3e4){this.exit(1)}if(this.units_equal_msw&&this.altitude_of_dive>9144){this.exit(1)}if(this.diver_acclimatized_at_altitude=="YES"||this.diver_acclimatized_at_altitude=="yes"){g=true}else{g=false}s=this.ascent_to_altitude_hours*60;c=this.hours_at_altitude_before_dive*60;if(g){this.calc_barometric_pressure(this.altitude_of_dive);for(t=1;t<=16;++t){this.adjusted_critical_radius_n2[t-1]=this.initial_critical_radius_n2[t-1];this.adjusted_critical_radius_he[t-1]=this.initial_critical_radius_he[t-1];this.helium_pressure[t-1]=0;this.nitrogen_pressure[t-1]=(this.barometric_pressure-this.water_vapor_pressure)*.79}}else{if(this.starting_acclimatized_altitude>=this.altitude_of_dive||this.starting_acclimatized_altitude<0){this.exit(1)}this.calc_barometric_pressure(this.starting_acclimatized_altitude);v=this.barometric_pressure;for(t=1;t<=16;++t){this.helium_pressure[t-1]=0;this.nitrogen_pressure[t-1]=(this.barometric_pressure-this.water_vapor_pressure)*.79}this.calc_barometric_pressure(this.altitude_of_dive);r=this.barometric_pressure;l=(v-this.water_vapor_pressure)*.79;n=(r-v)/s;p=n*.79;for(t=1;t<=16;++t){b=this.nitrogen_pressure[t-1];this.nitrogen_pressure[t-1]=this.schreiner_equation__(l,p,s,this.nitrogen_time_constant[t-1],b);u=this.nitrogen_pressure[t-1]+this.constant_pressure_other_gases-r;d=u/this.units_factor*101325;h=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(this.initial_critical_radius_he[t-1]*this.skin_compression_gammac);if(d>h){w=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(d*this.skin_compression_gammac);this.adjusted_critical_radius_he[t-1]=this.initial_critical_radius_he[t-1]+(this.initial_critical_radius_he[t-1]-w)*Math.exp(-c/this.regeneration_time_constant);this.initial_critical_radius_he[t-1]=this.adjusted_critical_radius_he[t-1]}else{o=1/(d/((this.surface_tension_gamma-this.skin_compression_gammac)*2)+1/this.initial_critical_radius_he[t-1]);m=this.initial_critical_radius_he[t-1]+(o-this.initial_critical_radius_he[t-1])*Math.exp(-c/this.regeneration_time_constant);this.initial_critical_radius_he[t-1]=m;this.adjusted_critical_radius_he[t-1]=this.initial_critical_radius_he[t-1]}a=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(this.initial_critical_radius_n2[t-1]*this.skin_compression_gammac);if(d>a){_=this.surface_tension_gamma*2*(this.skin_compression_gammac-this.surface_tension_gamma)/(d*this.skin_compression_gammac);this.adjusted_critical_radius_n2[t-1]=this.initial_critical_radius_n2[t-1]+(this.initial_critical_radius_n2[t-1]-_)*Math.exp(-c/this.regeneration_time_constant);this.initial_critical_radius_n2[t-1]=this.adjusted_critical_radius_n2[t-1]}else{i=1/(d/((this.surface_tension_gamma-this.skin_compression_gammac)*2)+1/this.initial_critical_radius_n2[t-1]);f=this.initial_critical_radius_n2[t-1]+(i-this.initial_critical_radius_n2[t-1])*Math.exp(-c/this.regeneration_time_constant);this.initial_critical_radius_n2[t-1]=f;this.adjusted_critical_radius_n2[t-1]=this.initial_critical_radius_n2[t-1]}}e=(this.barometric_pressure-this.water_vapor_pressure)*.79;for(t=1;t<=16;++t){b=this.nitrogen_pressure[t-1];this.nitrogen_pressure[t-1]=this.haldane_equation__(b,e,this.nitrogen_time_constant[t-1],c)}}return 0}exit(t){console.log("exit",t)}pause(){}cbrtf(t){if(t>0)return Math.exp(Math.log(t)/3);else if(t<0)return-Math.exp(Math.log(-t)/3);else return 0}roundDecoStop(t,e){let i;if(this.units_equal_fsw){if(e<10){i=t/e+.5;t=Math.floor(i)*e}else{i=t/10+.5;t=Math.floor(i)*10}}if(this.units_equal_msw){if(e<3){i=t/e+.5;t=Math.floor(i)*e}else{i=t/3+.5;t=Math.floor(i)*3}}if(t<0)t=0;return t}}class LP{constructor(){this.time_to_add=5;this.depth_to_add=3;this.VPM=new zP;this.BUHL=new FP;this.reset()}setConfiguration(t){if(t){this.configuration=t;this.setParams(this.configuration.parameters)}else{this.setParams()}}reset(){this.profilePointDepth=new Array;this.profilePointRT=new Array;this.profilePointMixO2=new Array;this.profilePointMixHe=new Array;this.profilePointMixSetPoint=new Array;this.surfaceIntervals=new Array;this.decomixO2=new Array;this.decomixHe=new Array;this.decomixfromdepth=new Array;this.decomixSetPoint=new Array;this.decomixUseDiluentGas=new Array;this.currentDive=0;this.dives=new Array;this.depth_to_add=gP.isMetric()?3:10}setWithDivePlanModel(t){if(t.configuration){this.setConfiguration(t.configuration)}if(t.users){this.users=t.users}return this.setDives(t.dives)}resetDiveWithConfiguration(t,e,i=true){let n={depth:gP.isMetric()?30:100,time:30,fO2:.32,fHe:0,setpoint:1.4};let s=new wP(n.fO2,n.fHe);e.configuration.bottom.forEach((t=>{if(t.gas.fO2!=1){s=t.gas}}));this.addDiveProfilePoint(t,e.maxDepth,e.maxTime,s.fO2,s.fHe,e.parameters.bottomppO2,i);this.resetDecoTanksWithConfiguration(t,e,i)}resetDecoTanksWithConfiguration(t,e,i=true){let n=t.getDecoStartDepth();t.decoGases=[];e.configuration.deco.forEach((s=>{let r=e.parameters.decoppO2;if(s.gas.fO2==1){r=e.parameters.oxygenppO2}if(s.gas.fromDepth<n){this.addDiveDecoGas(t,s.gas.fO2,s.gas.fHe,s.gas.fromDepth,r,s.gas.useAsDiluent,i)}}))}addDive(t){let e=new OP(t);this.dives.push(e);return e}removeDive(t){this.dives.splice(t,1);this.updateCalculations()}resetDiveProfileIndexes(t){let e=0;t.profilePoints.map((t=>{t.index=e++;return t}))}addDiveProfilePoint(t,e,i,n,s,r,o){t.addProfilePoint(e,i,n,s,r);this.resetDiveProfileIndexes(t);if(o)this.updateCalculations()}updateDiveProfilePoint(t,e,i,n,s,r,o){t.updateProfilePoint(e,i,n,s,r,o);this.resetDiveProfileIndexes(t);this.updateCalculations()}removeDiveProfilePoint(t,e){t.removeProfilePoint(e);this.resetDiveProfileIndexes(t);this.updateCalculations()}addDiveDecoGas(t,e,i,n,s,r,o){t.addDecoGas(e,i,n,s,r);if(o)this.updateCalculations()}updateDiveDecoGas(t,e,i,n,s,r,o){t.updateDecoGas(e,i,n,s,r,o);this.updateCalculations()}removeDiveDecoGas(t,e){t.removeDecoGas(e);this.updateCalculations()}setUnits(t){gP.setMetric(t==="Metric");this.depth_to_add=t==="Metric"?3:10;this.VPM.setUnits(t);this.BUHL.setUnits(t)}setParams(t,e=true){if(this.parameters&&this.parameters.units!==t.units){this.convertUnits(t)}else{this.configuration.parameters=t}this.parameters=new EP(t);this.setUnits(this.parameters.units);if(e)this.updateCalculations()}convertUnits(t){const e=[];this.dives.forEach((i=>{i.convertUnits(t.units);e.push(i)}));this.dives=e;this.configuration.convertUnits(t)}setDives(t){this.dives=[];t.forEach((t=>{this.addDive(t)}));this.setUnits(this.parameters.units);return this.updateCalculations()}updateCalculations(){if(this.dives&&this.dives.length>0&&this.dives[0].profilePoints.length>0){this.runCalculationsForDives(this.dives);return this}else{return null}}runCalculationsForDives(t){this.fillVPMData(t);this.showVPMProfiles(t);this.showBUHLProfiles(t)}runCalculationsForTables(){this.time_to_add=dt.exports.toNumber(this.time_to_add);this.depth_to_add=dt.exports.toNumber(this.depth_to_add);this.dives_less_time=dt.exports.cloneDeep(this.dives);this.dives_less_time=this.dives_less_time.map((t=>{t.profilePoints.map((t=>{t.time=t.time>this.time_to_add?t.time-this.time_to_add:0;return t}));return t}));this.runCalculationsForDives(this.dives_less_time);this.dives_less_depth=dt.exports.cloneDeep(this.dives);this.dives_less_depth=this.dives_less_depth.map((t=>{t.profilePoints.map((t=>{t.depth=t.depth>this.depth_to_add?t.depth-this.depth_to_add:0;return t}));return t}));this.runCalculationsForDives(this.dives_less_depth);this.dives_more_time=dt.exports.cloneDeep(this.dives);this.dives_more_time=this.dives_more_time.map((t=>{t.profilePoints.map((t=>{t.time=t.time>this.time_to_add?t.time+this.time_to_add:0;return t}));return t}));this.runCalculationsForDives(this.dives_more_time);this.dives_more_depth=dt.exports.cloneDeep(this.dives);this.dives_more_depth=this.dives_more_depth.map((t=>{t.profilePoints.map((t=>{t.depth=t.depth>this.depth_to_add?t.depth+this.depth_to_add:0;return t}));return t}));this.runCalculationsForDives(this.dives_more_depth)}getDivePlanModel(){this.updateDates();return new HP(this)}updateDates(){for(let t=0;t<this.dives.length;t++){this.dives[t].date=this.getDateForDive(t)}}getDateForDive(t){let e=0;for(let i=0;i<t;i++){e+=(i>0?this.dives[i].surfaceInterval:0)+this.dives[i].getRunTime()/60}if(t>0)e+=this.dives[t].surfaceInterval;const i=Vl.addHours(this.dives[0].date,e);return i}showVPMProfiles(t){if(this.VPM.runVPM(this,false)){this.runVPMProfiles(t,false)}if(this.parameters.configuration!="OC"){if(this.VPM.runVPM(this,true)){this.runVPMProfiles(t,false)}if(this.VPM.runVPM(this,false)){this.runVPMProfiles(t,true)}}return true}runVPMProfiles(t,e=false){for(let i in t){let n=parseInt(i);let s=t[i];let r={};let o;let a;let h=0,c,u,l=0,f=0,d=0,p=0,m=0,_=0;let v=0,g,b=0,w;let y;let x=0;s.introText=new Array;let M=aP.getTransl("divewarn","Warning: This program is intended for informational purposes only. The author accepts no responsibility for the results of diving schedules generated by this program. Divers who choose to use this deco schedule do so at their own risk!");s.introText.push(M);s.configuration=this.parameters.configuration;for(x=0;x<n;x++){l=0;h=0;for(a=0;a<50;a++){if(this.VPM.getProfilePoint(a,1,x)==-1)break;f=this.VPM.getProfilePoint(a,1,x);c=this.VPM.getProfilePoint(a,2,x);p=this.VPM.getProfilePoint(a,4,x);_=this.VPM.getProfilePoint(a,5,x);u=this.VPM.getProfilePoint(a,6,x);if(a==0){d=p;m=_}else{w=gP.getSegmentCNS(l,f,d,p,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),c-h,this.parameters.units);if(w<0){console.log("Internal ERROR 4\n");return false}b+=w;l=f;h=c;d=p;m=_}}w=gP.getSegmentCNS(f,0,d,p,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),2*f/parseFloat(this.parameters.ascentRate),this.parameters.units);if(w<0){console.log("Internal ERROR 4.1\n");return false}b+=w;b=b/Math.exp(this.surfaceIntervals[x+1]/90*Math.log(2))}x=n;let T=parseFloat(this.VPM.outputStartOfDecoDepth[x].toFixed(1));l=0;h=0;r.profile=new Array;r.runtime=0;r.decotime=0;for(a=0;a<50;a++){if(this.VPM.getProfilePoint(a,1,x)==-1)break;r.profile[a]={};f=this.VPM.getProfilePoint(a,1,x);o=parseFloat(f.toFixed(1));r.profile[a].depth=o;c=this.VPM.getProfilePoint(a,2,x);o=parseFloat(c.toFixed(1));r.profile[a].model={};r.profile[a].equal={};r.profile[a].s={};r.profile[a].linear={};r.profile[a].runtime=o;r.profile[a].model.runtime=o;r.runtime=o;o=parseFloat(this.VPM.getProfilePoint(a,3,x).toFixed(1));r.profile[a].model.stoptime=o;p=this.VPM.getProfilePoint(a,4,x);_=this.VPM.getProfilePoint(a,5,x);u=this.VPM.getProfilePoint(a,6,x);r.profile[a].gas=new wP(p,_,f);if(a==0){d=p;m=_;f=f/2}else if(a==1){d=p;m=_;l=0}if(e&&gP.depth2press(f)<=1.7&&r.profile[a].gas.O2<95){y=this.parameters.oxygenppO2}else{y=dt.exports.round(gP.depth2press(f)*p,2)}if(y>dt.exports.round(gP.depth2press(f)*1,2)){y=dt.exports.round(gP.depth2press(f)*1,2)}r.profile[a].ppO2=y;if(a>0){let t=1-d-m;let e=1-p-_;if(this.parameters.IcdWarning&&a>=this.VPM.firstDecoProfilePoint){if((m!=0||_!=0)&&(t!=0||e!=0)){if(d!=p||m!=_){if(_*this.parameters.solubilityHe+e*this.parameters.solubilityN2>m*this.parameters.solubilityHe+t*this.parameters.solubilityN2){r.profile[a].ppO2+="ICD Warning!"}}}}g=gP.getSegmentOTU(l,f,d,p,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),c-h,this.parameters.units);if(g<=-1){console.log("Internal ERROR 3.1\n");return false}v+=g;w=gP.getSegmentCNS(l,f,d,p,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),c-h,this.parameters.units);if(w<0){console.log("Internal ERROR 4\n");return false}b+=w;l=f;h=c;d=p;m=_;r.cns=b;r.otu=v}let t;if(u=="first_ascent"){t="ascent"}else if(u=="bottom_ascent"){t="bottom_ascent"}else if(u=="ascent"){t="ascent"}else{t=u}r.profile[a].stage=t}s.offGassingDepth=T;r.decotime=0;r.profile.forEach((t=>{if(t.stage=="ascent"){r.decotime+=parseFloat(t.model.stoptime)}}));let O={cns:Math.round(r.cns*100),consumption:r.consumption,decotime:r.decotime,otu:dt.exports.toNumber(r.otu),profile:r.profile,rangeCount:r.rangeCount,rangeDescr:r.rangeDescr,rangeShape:r.rangeShape,rangeSums:r.rangeSums,runtime:r.runtime};O=this.checkMinimumDeco(O);O.profile=dt.exports.orderBy(O.profile,"runtime","asc");if(e){if(!s.CCR){s.CCR={BUHL:{},VPM:{}}}s.CCR.VPM=O;s.CCR.VPM=this.insertDepthRanges(s,"VPM",true)}else{s.VPM=O;s.VPM=this.insertDepthRanges(s,"VPM",false);delete s.CCR}}return true}showBUHLProfiles(t){for(let e=0;e<t.length;e++){let i=t[e];i.introText=new Array;let n=aP.getTransl("divewarn","Warning: This program is intended for informational purposes only. The author accepts no responsibility for the results of diving schedules generated by this program. Divers who choose to use this deco schedule do so at their own risk!");i.introText.push(n);i.configuration=this.parameters.configuration;let s=e>0;let r=dt.exports.cloneDeep(t[e].decoGases);i.bottomGases=dt.exports.cloneDeep(t[e].bottomGases);for(let t in i.bottomGases){const e=i.bottomGases[t];r.push(e)}if(s){this.BUHL.doSurfaceInterval(this.surfaceIntervals[e])}let o=dt.exports.cloneDeep(this.BUHL.doDive(this.parameters,t[e].profilePoints,r,s,true,e));i.BUHL={cns:Math.round(o.oxTox.cns*100),consumption:null,decotime:o.decotime,otu:parseInt(o.oxTox.otu),profile:o.outputSegments,rangeCount:null,rangeDescr:null,rangeShape:null,rangeSums:null,runtime:parseInt(o.runtime)};i.BUHL=this.checkMinimumDeco(i.BUHL);i.BUHL=this.insertDepthRanges(i,"BUHL",false);i.BUHL.profile=dt.exports.orderBy(i.BUHL.profile,"runtime","asc")}if(this.parameters.configuration=="CCR"||this.parameters.configuration=="pSCR"){for(let e=0;e<t.length;e++){let i=t[e];let n=e>0;let s=dt.exports.cloneDeep(t[e].decoGases);t[e].profilePoints.forEach((t=>{const e=t.gas;s.push(e)}));if(n){this.BUHL.doSurfaceInterval(this.surfaceIntervals[e])}let r=dt.exports.cloneDeep(this.BUHL.doDive(this.parameters,t[e].profilePoints,s,n,false,e));if(!i.CCR){i.CCR={BUHL:{},VPM:{}}}i.CCR.BUHL={cns:Math.round(r.oxTox.cns*100),consumption:null,decotime:r.decotime,otu:parseInt(r.oxTox.otu),profile:r.outputSegments,rangeCount:null,rangeDescr:null,rangeShape:null,rangeSums:null,runtime:parseInt(r.runtime)};i.CCR.BUHL=this.checkMinimumDeco(i.CCR.BUHL);i.CCR.BUHL=this.insertDepthRanges(i,"BUHL",true);i.CCR.BUHL.profile=dt.exports.orderBy(i.CCR.BUHL.profile,"runtime","asc");if(this.parameters.configuration=="pSCR"){this.pSCRdrop(i)}}}for(let e=0;e<t.length;e++){this.calculateConsumptions(t[e])}return true}pSCRdrop(t){let e=this.parameters.rmvBottom;let i=this.parameters.metabolic_o2_consumption;if(t.bottomGases&&t.bottomGases[0]){let n=t.bottomGases[0].fO2;let s=new NP(e,i);t.backgasHypoxicDepth=s.hypoxicDepth(n*100)}else{t.backgasHypoxicDepth=0}}roundUpMultiple(t,e){return t+(e-t%e)%e}checkMinimumDeco(t){if(t&&t.decotime<=3){let e=3;if(this.parameters.units=="Imperial"){e=10}let i={runtime:null,ppO2:null,depth:null,gas:null,mix:null},n=0,s=0,r=[];for(let e in t.profile){let o=t.profile[e];if(o.stage=="bottom"){i=o;n+=o.model.stoptime;s+=o.model.stoptime*o.depth;r.push(o)}else if(o.stage=="ascent");else{r.push(o)}}t.profile=r;let o=s/n;let a=this.roundUpMultiple(o/2,e);let h=i.runtime;let c=0;let u=i.ppO2/i.depth;let l=.5;let f=i.depth;let d=true;for(let n=a;n>0;n=n-e){let e=(f-n)/parseFloat(this.parameters.ascentRate);f=n;h+=e+l;c+=(d?0:e)+l;d=false;t.profile.push({depth:n,equal:{},gas:i.gas,linear:{},mix:i.mix,ppO2:Math.round(u*n*100)/100,rangeShape:"model",rmv:this.parameters.rmvDeco,runtime:h,s:{},stage:"ascent",model:{runtime:h,stoptime:l}})}t.runtime=h;t.decotime=c}return t}insertDepthRanges(t,e,i){let n;if(i){n=t.CCR?t.CCR[e]:null}else{n=t[e]}if(n&&n.profile){let e=[],i={},s=[],r={},o=0,a=1,h=0;if(this.parameters.units=="Imperial"){e=[20,70,120,170,220,270,320,370]}else{e=[6,21,36,51,66,81,96,111]}let c=[];let u=[];let l=[];n.profile.forEach((t=>{if(t.stage=="descent"){h++;c.push(t)}else if(t.stage=="bottom"){h++;u.push(t)}else if(t.stage=="ascent"){l.push(t)}else{h++;l.push(t)}}));l=dt.exports.orderBy(l,"depth","desc");n.profile=[];n.profile=n.profile.concat(c,u,l);n.rangeShape={};n.rangeDescr={};let f=0,d=0,p=0,m=0;let _=t.decoGases.length>0?false:true;n.profile.forEach((t=>{if(a>h&&(t.stage=="bottom"||t.stage=="ascent")){if(e.indexOf(parseInt(t.depth))!=-1){o=t.depth;s.push(t.depth);i[o]=0;r[o]=0}if(o==0){o=t.depth;s.push(t.depth);i[o]=0;r[o]=0}i[o]+=parseFloat(t.model.stoptime);r[o]++;n.rangeShape[o]="model";if(t.ppO2<=1.3&&!_){n.rangeDescr[o]=aP.getTransl("deep-stops-from","Deep Stops from")}else{_=true;n.rangeDescr[o]=aP.getTransl("deco-stops-from","Deco Stops from")}}if(t.stage=="bottom"){d+=(t.runtime-f)*t.depth;f=t.runtime}p+=(t.runtime-m)*t.depth;m=t.runtime;t.rangeShape="model";a++}));n.average_bottom_depth=d/f;n.average_dive_depth=p/m;n.rangeSums=i;n.rangeCount=r;for(let t in s){let e=s[t],o=s[parseInt(t)+1]?s[parseInt(t)+1]:0,a=1,h=1,c,u,l,f,d=c=u=l=f=0;n.profile.forEach((t=>{if(t.depth<=e&&t.depth>o){if(u==0)u=t.model.runtime-t.model.stoptime;t.equal.stoptime=i[e]/r[e];u+=t.equal.stoptime;t.equal.runtime=u;if(c==0){c=t.model.runtime-t.model.stoptime}if(a==1&&r[e]==5){d=i[e]/3}else if(a==1&&r[e]==4){d=i[e]/2.6}else if(a==1&&r[e]==3){d=i[e]/2.3}else if(a==1){d=i[e]/r[e]}if(a==1||a==r[e]){t.s.stoptime=d}else if(a>1&&r[e]==4){t.s.stoptime=(i[e]-2*d)/2}else if(a>1&&r[e]==3){t.s.stoptime=i[e]-2*d}else if(a>1&&r[e]>3){t.s.stoptime=d/(r[e]-2)}c+=t.s.stoptime;t.s.runtime=c;a++;if(l==0){l=t.model.runtime-t.model.stoptime;let i=r[e];while(i>0){f+=i;i--}}t.linear.stoptime=i[e]/f*h;l+=t.linear.stoptime;t.linear.runtime=l;h++}}))}return n}else{return false}}getGasfO2(t,e){for(let i in e.decoGases){if(e.decoGases[i].toString()==t){return e.decoGases[i].fO2}}for(let i in e.bottomGases){if(e.bottomGases[i].toString()==t){return e.bottomGases[i].fO2}}}calculateConsumptions(t){let e=[];let i=false,n=1;if(t.CCR){i=true;e.push("CCR VPM");e.push("CCR BUHL")}if(this.parameters.configuration=="pSCR"){i=false;n=this.parameters.pscrGasDivider}if(t.VPM)e.push("VPM");if(t.BUHL)e.push("BUHL");let s=0;t.profilePoints.forEach((t=>{s=s<parseInt(t.depth)?parseInt(t.depth):s}));let r={BUHL:0,VPM:0};for(let o in e){let a=e[o];let h=0,c=0,u="descent",l=null,f=null;if(a.indexOf("CCR")!=-1){f=t.CCR[a.replace("CCR ","")]}else{f=t[a]}let d={};for(let e in t.decoGases){d[t.decoGases[e].toString()]=0}for(let e in t.bottomGases){d[t.bottomGases[e].toString()]=0}let p=null,m=null,_=null,v=0,g=null,b=null,w=f.profile.length,y=false;f.gasRules={MG:{Lt:0,cuft:0,time:0},UG:{Lt:0,cuft:0,time:0},TG:{Lt:0,cuft:0,time:0}};let x=0;let M=0;let T=0;let O=0;t.decoGases.forEach((t=>{O=t.fromDepth>O?t.fromDepth:O}));for(let e=0;e<=w;e++){if(!f.profile[e]){let t=0,i=h/parseFloat(this.parameters.ascentRate)*3,n=c+i;if(f.profile[e-1]&&f.profile[e-1].depth>0){f.profile[e]={stage:"ascent",rangeShape:m,gas:l,depth:0,model:{stoptime:t,runtime:n},equal:{stoptime:t,runtime:n},linear:{stoptime:t,runtime:n},s:{stoptime:t,runtime:n}};f.runtime+=i;f.profile[e].runtime=f.runtime;f.decotime+=i}}if(f.profile[e]&&(f.profile[e].stage=="bottom"||f.profile[e].stage=="ascent")&&t.bottomGases.length>0){p=f.profile[e];m=p.rangeShape;_=p.gas;v=f.profile[e].stage=="bottom"?this.parameters.rmvBottom:this.parameters.rmvDeco;g=p.depth;b=p[m].runtime;this.getGasfO2(_,t);if(a.indexOf("CCR")!=-1){if(!d["OxygenCCR"])d["OxygenCCR"]=0;d["OxygenCCR"]=b*parseFloat(this.parameters.CCR_o2_consumption);if(a.indexOf("BUHL")!=-1){r.BUHL=d["OxygenCCR"]}else{r.VPM=d["OxygenCCR"]}let e=t.bottomGases[0];d[e.toString()]=gP.depth2press(s)*parseFloat(this.parameters.CCR_volume_for_consumption)*3}else{let r=gP.getSegmentGas(h,g,v,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),b-c,1);let o=gP.getSegmentGas(h,g,v,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),b-c,2);let a=r+o;if(f.profile[e].stage=="ascent"&&!y){if(f.profile[e].stage!=u){x+=dt.exports.round(gP.getSegmentGas(h,h,this.parameters.rmvBottom,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),this.parameters.time_at_bottom_for_min_gas,3))*dt.exports.toNumber(this.parameters.rmvBottom_multiplier_for_min_gas)*dt.exports.toNumber(this.parameters.number_of_divers_for_min_gas);f.gasRules.MG.time+=dt.exports.round(this.parameters.time_at_bottom_for_min_gas);x+=dt.exports.round(gP.getSegmentGas(h,g,this.parameters.rmvBottom,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),b-c,3))*dt.exports.toNumber(this.parameters.rmvBottom_multiplier_for_min_gas)*dt.exports.toNumber(this.parameters.number_of_divers_for_min_gas);f.gasRules.MG.time+=dt.exports.round(b-c,1)}else if(g>O){x+=dt.exports.round(gP.getSegmentGas(h,g,this.parameters.rmvBottom,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),b-c,3))*dt.exports.toNumber(this.parameters.rmvBottom_multiplier_for_min_gas)*dt.exports.toNumber(this.parameters.number_of_divers_for_min_gas);f.gasRules.MG.time+=dt.exports.round(b-c,1)}else if(!y){x+=dt.exports.round(gP.getSegmentGas(g,g,this.parameters.rmvBottom,-parseFloat(this.parameters.ascentRate),parseFloat(this.parameters.descentRate),this.parameters.time_at_gas_switch_for_min_gas,2))*dt.exports.toNumber(this.parameters.rmvBottom_multiplier_for_min_gas)*dt.exports.toNumber(this.parameters.number_of_divers_for_min_gas);f.gasRules.MG.time+=parseInt(this.parameters.time_at_gas_switch_for_min_gas);y=true}}else if(f.profile[e].stage=="bottom"){M+=dt.exports.round(a)/n;f.gasRules.UG.time+=dt.exports.round(b-c,1)}if(gP.isMetric()){f.gasRules.MG.Lt=x;f.gasRules.MG.cuft=dt.exports.round(gP.ltToCuFt(x))}else{f.gasRules.MG.cuft=x;f.gasRules.MG.Lt=gP.cuFtToLt(x)}if(i&&f.profile[e].stage=="bottom"){_=t.bottomGases[0].toString();a=gP.depth2press(s)*parseFloat(this.parameters.CCR_volume_for_consumption)*3;M=a}d[_]+=dt.exports.round(a)/n}h=g;c=b;u=f.profile[e].stage;l=_}let o=1;if(this.parameters.gasRule=="1/1"){o=1}else if(this.parameters.gasRule=="1/2"){o=2}else if(this.parameters.gasRule=="1/3"){o=3}T=x+dt.exports.round(M/o);f.gasRules.TG.time=f.gasRules.UG.time/o}if(gP.isMetric()){f.gasRules.UG.Lt=M;f.gasRules.UG.cuft=gP.ltToCuFt(M);f.gasRules.TG.Lt=T;f.gasRules.TG.cuft=gP.ltToCuFt(T)}else{f.gasRules.UG.cuft=M;f.gasRules.UG.Lt=gP.cuFtToLt(M);f.gasRules.TG.cuft=T;f.gasRules.TG.Lt=gP.cuFtToLt(T)}f.profile=dt.exports.orderBy(f.profile,"runtime","asc");f.consumption=[];for(let e in t.bottomGases){let n=dt.exports.cloneDeep(t.bottomGases[e]);n.required=x+M;n.available=0;n.deco=false;if(a.indexOf("CCR")!=-1){n.used=d[t.bottomGases[e].toString()];n.required=n.used}else if(i){for(let e in t.CCR[a.replace("CCR ","")].consumption){let i=t.CCR[a.replace("CCR ","")].consumption[e];if(i.toString()==n.toString()){n.used=i.used;break}else{n.used=0}}}else{n.used=d[t.bottomGases[e].toString()]}f.consumption.push(n)}for(let e in t.decoGases){if(d[t.decoGases[e].toString()]>0){let s=dt.exports.cloneDeep(t.decoGases[e]);s.required=dt.exports.round(d[t.decoGases[e].toString()]*(1+this.parameters.deco_gas_reserve/100)*10)/10*n;s.available=0;s.deco=true;if(a.indexOf("CCR")!=-1){s.used=d[t.decoGases[e].toString()];s.required=s.used}else if(i){for(let e in t.CCR[a.replace("CCR ","")].consumption){let i=t.CCR[a.replace("CCR ","")].consumption[e];if(i.toString()==s.toString()){s.used=i.used;break}else{s.used=0}}}else{s.used=d[t.decoGases[e].toString()]}f.consumption.push(s)}}f.consumption=dt.exports.orderBy(f.consumption,"fromDepth","desc")}if(r.BUHL>0){for(let i in e){let n=e[i];let s=null;if(n.indexOf("CCR")!=-1){s=t.CCR[n.replace("CCR ","")]}else{s=t[n]}let o=new wP(1,0,gP.isMetric()?6:20,1.6);o.available=0;if(n.indexOf("BUHL")!=-1){o.used=r.BUHL}else{o.used=r.VPM}o.required=o.used;s.consumption.push(o)}}return t}updateRangeShape(t,e,i,n=false){let s;if(n){s=this.dives[this.currentDive].CCR}else{s=this.dives[this.currentDive]}s[t].rangeShape[e]=i;let r=s[t].rangeCount[e];s[t].profile.map((t=>{if(t.depth<=e&&r>0){t.rangeShape=i;r--}}));this.calculateConsumptions(this.dives[this.currentDive])}fillVPMData(t){for(let t=0;t<this.parameters.MAX_DIVEPONTS;t++)for(let e=0;e<this.parameters.MAX_DIVES;e++){if(!Array.isArray(this.profilePointDepth[t]))this.profilePointDepth[t]=new Array;this.profilePointDepth[t][e]=-1;if(!Array.isArray(this.profilePointRT[t]))this.profilePointRT[t]=new Array;this.profilePointRT[t][e]=-1;if(!Array.isArray(this.profilePointMixO2[t]))this.profilePointMixO2[t]=new Array;this.profilePointMixO2[t][e]=-1;if(!Array.isArray(this.profilePointMixHe[t]))this.profilePointMixHe[t]=new Array;this.profilePointMixHe[t][e]=-1;if(!Array.isArray(this.profilePointMixSetPoint[t]))this.profilePointMixSetPoint[t]=new Array;this.profilePointMixSetPoint[t][e]=-1}for(let t=0;t<this.parameters.MAX_DECOMIX;t++)for(let e=0;e<this.parameters.MAX_DIVES;e++){if(!Array.isArray(this.decomixO2[t]))this.decomixO2[t]=new Array;this.decomixO2[t][e]=-1;if(!Array.isArray(this.decomixHe[t]))this.decomixHe[t]=new Array;this.decomixHe[t][e]=-1;if(!Array.isArray(this.decomixfromdepth[t]))this.decomixfromdepth[t]=new Array;this.decomixfromdepth[t][e]=-1;if(!Array.isArray(this.decomixSetPoint[t]))this.decomixSetPoint[t]=new Array;this.decomixSetPoint[t][e]=-1;if(!Array.isArray(this.decomixUseDiluentGas[t]))this.decomixUseDiluentGas[t]=new Array;this.decomixUseDiluentGas[t][e]=-1}this.surfaceIntervals[0]=-1;for(let t=1;t<this.parameters.MAX_DIVES;t++)this.surfaceIntervals[t]=180;for(let e in t){let i=this;let n=dt.exports.toNumber(e);t[n].profilePoints.forEach((t=>{i.addProfilePoint(t,n)}));t[n].decoGases.forEach((t=>{i.addDecoGas(t,n)}));this.addSurfaceInterval(t[n].surfaceInterval,n)}}addProfilePoint(t,e){let i;for(i in this.profilePointDepth){if(this.profilePointDepth[i][e]==-1){break}}this.profilePointDepth[i][e]=parseFloat(t.depth);this.profilePointRT[i][e]=parseFloat(t.time);this.profilePointMixO2[i][e]=parseFloat(t.gas.fO2)*100;this.profilePointMixHe[i][e]=parseFloat(t.gas.fHe)*100;this.profilePointMixSetPoint[i][e]=parseFloat(t.setpoint)}addDecoGas(t,e){let i;for(i in this.decomixO2){if(this.decomixO2[i][e]==-1){break}}this.decomixO2[i][e]=parseFloat(t.fO2)*100;this.decomixHe[i][e]=parseFloat(t.fHe)*100;this.decomixSetPoint[i][e]=parseFloat(t.ppO2);this.decomixUseDiluentGas[i][e]=t.useAsDiluent;this.decomixfromdepth[i][e]=parseFloat(t.fromDepth)}addSurfaceInterval(t,e){if(e>0)this.surfaceIntervals[e]=dt.exports.round(t*60)}getParamRanges(t){if(!t)t=this.parameters.units;let e={conservatism:[0,1,2,3,4],gf:[5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100],minppO2:[.15,.16,.17,.18,.19,.2,.21,.22,.23],ppO2:[.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.6],pscrGasDivider:[4,5,6,7,8,9,10],CCR_o2_consumption:null,CCR_volume_for_consumption:null,rmv:null,deco_gas_reserve:null,time_at_bottom_for_min_gas:null,rmvBottom_multiplier_for_min_gas:null,number_of_divers_for_min_gas:null,descentRate:[],ascentRate:[],minPPO2:null,hhf:[]};if(t=="Imperial"){e.CCR_o2_consumption=[.02,.023,.025,.028,.035,.043,.05,.056,.063,.07,.078,.085,.09,.1,.105]}else{e.CCR_o2_consumption=[.5,.6,.7,.8,1,1.2,1.4,1.6,1.8,2,2.2,2.4,2.6,2.8,3]}if(t=="Imperial"){e.CCR_volume_for_consumption=[.26,.3,.33,.36,.4,.43,.46,.5]}else{e.CCR_volume_for_consumption=[7,8,9,10,11,12,13,14]}if(t=="Imperial"){e.rmv=[.36,.4,.43,.46,.5,.53,.56,.6,.63,.66,.7,.73,.76,.8,.83,.86,.9,.93,.96,1,1.03]}else{e.rmv=[10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]}e.deco_gas_reserve=[];for(let t=0;t<=40;t++){e.deco_gas_reserve.push(t)}e.time_at_bottom_for_min_gas=[0,1,2,3,4];e.rmvBottom_multiplier_for_min_gas=[1,1.1,1.2,1.3,1.4,1.5];e.number_of_divers_for_min_gas=[1,2];e.descentRate=[];if(t=="Imperial"){for(let t=33;t<=133;t+=3){e.descentRate.push(t)}}else{for(let t=10;t<=40;t++){e.descentRate.push(t)}}e.ascentRate=[];if(t=="Imperial"){for(let t=3;t<=50;t+=3){e.ascentRate.push(t)}}else{for(let t=1;t<=15;t++){e.ascentRate.push(t)}}e.minPPO2=[.15,.16,.17,.18,.19,.2];e.hhf=[];for(let t=-10;t<=10;t++){e.hhf.push(t)}return e}getCompartmentsChartsData(t,e,i){let n=[["runTime","depth","profile","fO2","fHe","pO2"]];for(let t=1;t<=16;t++){n[0].push("maxAmb_"+t);n[0].push("maxAmbHe_"+t);n[0].push("maxAmbN2_"+t);n[0].push("MV_"+t);n[0].push("MVHe_"+t);n[0].push("MVN2_"+t);n[0].push("mValue_"+t);n[0].push("mValueHe_"+t);n[0].push("mValueN2_"+t);n[0].push("ppHeInspired_"+t);n[0].push("ppN2Inspired_"+t);n[0].push("ppHe_"+t);n[0].push("ppN2_"+t);n[0].push("ssHe_"+t);n[0].push("ssN2_"+t)}t.forEach((t=>{let s=e?t.compartmentChart:t.compartmentChartCCR;s=dt.exports.filter(dt.exports.cloneDeep(s),{dive:i});for(let t in s){let e=s[t];let i=parseInt(t);if(!n[i+1]){n[i+1]=[];n[i+1].push(e.runTime);n[i+1].push(e.depth);n[i+1].push(e.type);n[i+1].push(e.fO2);n[i+1].push(e.fHe);n[i+1].push(e.pO2)}n[i+1].push(e.maxAmb);n[i+1].push(e.maxAmbHe);n[i+1].push(e.maxAmbN2);n[i+1].push(e.MV);n[i+1].push(e.MVHe);n[i+1].push(e.MVN2);n[i+1].push(e.mValue);n[i+1].push(e.mValueHe);n[i+1].push(e.mValueN2);n[i+1].push(e.ppHeInspired);n[i+1].push(e.ppN2Inspired);n[i+1].push(e.ppHe);n[i+1].push(e.ppN2);n[i+1].push(e.ssHe);n[i+1].push(e.ssN2)}}));return n}getDecoChart(t,e=false,i=false){let n=this.dives[t],s=[],r=0;function o(t,s){let o,a=[],h=[];if(s){o=n.CCR[t].profile}else{o=n[t].profile}o.sort((function(t,e){if(t.runtime){if(t.runtime>e.runtime)return 1;if(t.runtime<e.runtime)return-1}return 0}));let c=0,u=0,l=0,f=0,d=0;a.push({x:0,y:-0});h.push(0);for(let t in o){let e=o[t];if(e.stage!="offgassing"&&e.stage!="descent"&&e.rangeShape&&e[e.rangeShape].runtime){c=e[e.rangeShape].runtime;l=Math.round(e[e.rangeShape].stoptime);f=e.depth;let t=c-l;a.push({x:t,y:-f});for(let e=1;e<=t-u;e++){let i=d-e*(d+f)/(t-u);h.push(i)}if(l>0){a.push({x:c,y:-f});if(r<c)r=c;for(let t=1;t<=l;t++){h.push(-f)}}u=c;d=-f}}let p=t;if(n.CCR){p=(s?"Reb ":"Bail ")+t}if(e&&i){return{seriesname:p,data:h.join("|")}}else if(e&&!i){let t=[];h.forEach((e=>{t.push({value:e})}));return{seriesname:p,data:t}}else{return{seriesname:p,drawline:1,anchorRadius:0,data:a}}}if(n.VPM)s.push(o("VPM",false));if(n.BUHL)s.push(o("BUHL",false));if(n.CCR&&n.CCR.VPM)s.push(o("VPM",true));if(n.CCR&&n.CCR.BUHL)s.push(o("BUHL",true));let a=[];for(let t=0;t<=r;t++){a.push(t)}let h;if(e&&i){h={dataset:s,categories:a.join("|"),maxruntime:r}}else if(e&&!i){let t=[];a.forEach((e=>{t.push({label:e})}));h={dataset:s,categories:[{category:t}],maxruntime:r}}else{h=s}return h}getDecoProfileData(t){let e=this.dives[t],i=[[]],n=0,s=0;function r(t,r){let o;if(r){o=e.CCR[t].profile}else{o=e[t].profile}o.sort((function(t,e){if(t.runtime){if(t.runtime>e.runtime)return 1;if(t.runtime<e.runtime)return-1}return 0}));let a=0,h=0,c=0,u;for(let t=0;t<o.length;t++){let e=o[t];if(e.rangeShape&&e[e.rangeShape].runtime){a=e[e.rangeShape].runtime;h=e[e.rangeShape].stoptime;c=e.depth;u=this.gasBlender.getGasName(e.gas);if(!i[t+1]){i.push([]);for(let e=0;e<n*5;e++)i[t+1].push("")}i[t+1][s*5]="--\x3e";i[t+1][s*5+1]=a;i[t+1][s*5+2]=h;i[t+1][s*5+3]=c;i[t+1][s*5+4]=u}}}if(e.CCR&&e.CCR.BUHL){i[0].push("BUHL CCR");i[0].push("RunTime");i[0].push("Stop Time");i[0].push("Depth");i[0].push("Gas");n++}if(e.CCR&&e.CCR.VPM){i[0].push("VPM CCR");i[0].push("RunTime");i[0].push("Stop Time");i[0].push("Depth");i[0].push("Gas");n++}if(e.BUHL){i[0].push("BUHL");i[0].push("RunTime");i[0].push("Stop Time");i[0].push("Depth");i[0].push("Gas");n++}if(e.VPM){i[0].push("VPM");i[0].push("RunTime");i[0].push("Stop Time");i[0].push("Depth");i[0].push("Gas");n++}if(e.CCR&&e.CCR.BUHL){r("BUHL",true);s++}if(e.CCR&&e.CCR.VPM){r("VPM",true);s++}if(e.BUHL){r("BUHL",false);s++}if(e.VPM){r("VPM",false);s++}return i}getCompartmentChart(t,e,i,n=1,s=true,r=[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],o={ppN2:true,ppHe:true,maxAmb:true,mValue:true}){if(!t)return null;n=dt.exports.toNumber(n);let a=false;let h=false;let c=false;let u=false;if(e=="runtime"){a=true}else if(e=="depth"){h=true}else if(e=="heatmapHe"){c=true;u=true}else if(e=="heatmapN2"){c=true}let l=[];let f=a?true:false;let d=h?true:false;for(let e=0;e<t.length;e++){let p=t[e];let m,_;if(f){m={seriesname:"Dive Profile",drawline:1,anchorRadius:0,data:[]}}if(d){_={seriesname:"Ambient Pressure",showRegressionLine:1,regressionLineThickness:3,anchorRadius:0,data:[]}}if(r[p.index]){let t={seriesname:"Tissue #"+(p.index+1)+" - ppN2",drawline:1,anchorRadius:h?0:0,anchorBorderThickness:0,data:[]};let e={seriesname:"Tissue #"+(p.index+1)+" - ppHe2",drawline:1,anchorRadius:h?0:0,anchorBorderThickness:0,data:[]};let r={seriesname:"Tissue #"+(p.index+1)+" - maxAmb",drawline:1,anchorRadius:h?0:0,anchorBorderThickness:0,data:[]};let v={seriesname:"Tissue #"+(p.index+1)+" - mValue",showRegressionLine:1,anchorRadius:0,data:[]};let g={seriesname:"Tissue #"+(p.index+1)+" - mValue He",showRegressionLine:1,anchorRadius:0,data:[]};let b={seriesname:"Tissue #"+(p.index+1)+" - mValue N2",showRegressionLine:1,anchorRadius:0,data:[]};let w=[];let y=!h;let x=s?p.compartmentChart:p.compartmentChartCCR;x=dt.exports.filter(dt.exports.cloneDeep(x),{dive:i});for(let i=0;i<x.length;i+=n){let s=x[i];let o=a||c?dt.exports.round(s.runTime,1):s.depth;if(f){m.data.push({y:s.depth,x:o})}if(d){let t=_;let e=dt.exports.last(t.data)?dt.exports.last(t.data):true;let i=o;let n=o;if(e&&e["x"]!=i&&e["y"]!=n){t.data.push({y:n,x:i})}}if(y||h&&x[i+n]&&x[i+n].type!="descent"&&x[i+n].type!="bottom"){y=true}if(y){let a=t;let h=dt.exports.last(a.data)?dt.exports.last(a.data):true;let c=o;let l=s.ppN2;if(h&&h["x"]!=c&&h["y"]!=l){a.data.push({y:l,x:c,index:i})}a=e;h=dt.exports.last(a.data)?dt.exports.last(a.data):true;l=s.ppHe;if(h&&h["x"]!=c&&h["y"]!=l){a.data.push({y:l,x:c,index:i})}a=r;h=dt.exports.last(a.data)?dt.exports.last(a.data):true;l=s.maxAmb;if(h&&h["x"]!=c&&h["y"]!=l){a.data.push({y:l,x:c,index:i})}let f=v;h=dt.exports.last(f.data)?dt.exports.last(f.data):true;l=s.mValue;if(h&&h["x"]!=c&&h["y"]!=l){f.data.push({y:l,x:c,index:i})}f=g;h=dt.exports.last(f.data)?dt.exports.last(f.data):true;l=s.mValueHe;if(h&&h["x"]!=c&&h["y"]!=l){f.data.push({y:l,x:c,index:i})}f=b;h=dt.exports.last(f.data)?dt.exports.last(f.data):true;l=s.mValueN2;if(h&&h["x"]!=c&&h["y"]!=l){f.data.push({y:l,x:c,index:i})}let d=dt.exports.round(u?s.ssHe:s.ssN2,1);let m=d+"% (pp"+(u?"He":"N2")+": "+dt.exports.round(u?s.ppHe:s.ppN2,1)+")";w.push({rowid:p.index.toString(),columnid:i.toString(),value:d,showValue:0,time:o,depth:s.depth,columns:dt.exports.round(x.length/n),toolText:m})}}if(f&&a){l.push(m)}f=false;if(d){l.push(_)}d=false;if(o.ppN2&&!c){l.push(t)}if(o.ppHe&&!c){l.push(e)}if(o.maxAmb&&!c){l.push(r)}if(o.mValue&&h){l.push(v);l.push(g);l.push(b)}if(c){l=l.concat(w)}}}return l}createVPMTissuesFromDives(){let t=[];for(let e=0;e<16;e++){t[e]=new CP(this.BUHL.pref,this.BUHL.getAmbientPress())}t=this.BUHL.setTimeConstants(t);let e=this;function i(i){for(let n=0;n<e.dives.length;n++){let s=e.parameters.descentRate;let r,o;let a=0;r=i?e.dives[n]:e.dives[n].CCR;o=r.VPM.profile;if(n>0){t=e.constDepth(t,0,e.dives[n].surfaceInterval*60,0,.79,.21,"surface",i,n-1)}else{for(let i=0;i<16;i++){t[i].setPpHe(0);t[i].setPpN2(.79*(e.BUHL.getAmbientPress()-e.BUHL.pref.getPH2O()))}}o.forEach((r=>{let o=1-r.gas.fO2-r.gas.fHe;if(r.stage=="descent"){t=e.ascDec(t,a,r.depth,s,r.gas.fHe,o,r.ppO2,i,n)}else{t=e.constDepth(t,r.depth,r[r.rangeShape].stoptime,r.gas.fHe,o,r.ppO2,r.stage,i,n)}s=e.parameters.ascentRate;a=r.depth}))}}if(this.dives[0].CCR){i(false)}i(true);return t}createTissuesFromProfile(t,e,i){let n=[];for(let t=0;t<16;t++){n[t]=new CP(this.BUHL.pref,this.BUHL.getAmbientPress());n[t].setPpHe(0);n[t].setPpN2(.79*(this.BUHL.getAmbientPress()-this.BUHL.pref.getPH2O()))}n=this.BUHL.setTimeConstants(n);let s=0;let r=this.parameters.descentRate;t.forEach((t=>{let o=1-t.gas.fO2-t.gas.fHe;if(t.stage=="descent"){n=this.ascDec(n,s,t.depth,r,t.gas.fHe,o,t.ppO2,e,i)}else{n=this.constDepth(n,t.depth,t[t.rangeShape].stoptime,t.gas.fHe,o,t.ppO2,t.stage,e,i)}r=this.parameters.ascentRate;s=t.depth}));return n}constDepth(t,e,i,n,s,r,o,a,h){let c;let u;let l;let f;let d=(this.BUHL.pref.units==0?e:e/this.BUHL.pref.METERS_TO_FEET)+this.BUHL.getAmbientPress();let p;if(r>0){if(n+s>0)f=d-this.BUHL.pref.getPH2O()-r*this.BUHL.pref.getPConversion();else f=0;if(f>0){c=f*n/(n+s);u=f*s/(n+s)}else{c=0;u=0}l=r*this.BUHL.pref.getPConversion()}else{c=(d-this.BUHL.pref.getPH2O())*n;u=(d-this.BUHL.pref.getPH2O())*s;l=(d-this.BUHL.pref.getPH2O())*(1-n-s)}if(i>0){for(p=0;p<16;p++){t[p].constDepth(c,u,i,e,o,1-n-s,n,a,l/this.BUHL.pref.getPConversion(),h)}}return t}ascDec(t,e,i,n,s,r,o,a,h){let c;let u;let l;let f;let d=Math.abs((i-e)/n);let p;let m;let _=(this.BUHL.pref.units==0?e:e/this.BUHL.pref.METERS_TO_FEET)+this.BUHL.getAmbientPress();let v=(this.BUHL.pref.units==0?i:i/this.BUHL.pref.METERS_TO_FEET)+this.BUHL.getAmbientPress();let g,b;if(d>0){if(o>0){g=_-o*this.BUHL.pref.getPConversion()-this.BUHL.pref.getPH2O();b=v-o*this.BUHL.pref.getPConversion()-this.BUHL.pref.getPH2O();if(g<0)g=0;if(b<0)b=0;if(s+r>0){u=g*s/(s+r);l=g*r/(s+r);p=(b*s/(s+r)-u)/d;m=(b*r/(s+r)-l)/d}else{u=0;l=0;p=0;m=0}}else{u=(_-this.BUHL.pref.getPH2O())*s;l=(_-this.BUHL.pref.getPH2O())*r;p=n*s;m=n*r;o=f}for(c=0;c<16;c++){t[c].ascDec(u,l,p,m,d,e,i,a,o,h)}}return t}}class $P{constructor(){this.agencies=[{ag_name:"PADI",long_name:"Professional Association of Diving Instructors",description:"The largest and most widely recognized diving organization in the world."},{ag_name:"SSI",long_name:"Scuba Schools International",description:"Another globally recognized diving certification agency."},{ag_name:"NAUI",long_name:"National Association of Underwater Instructors",description:"One of the oldest diving organizations, with a strong focus on safety."},{ag_name:"CMAS",long_name:"Confdration Mondiale des Activits Subaquatiques",description:"A French-based organization known for its international standards and multi-level certifications."},{ag_name:"SDI",long_name:"Scuba Diving International",description:"Known for offering technical and recreational diving courses."},{ag_name:"TDI",long_name:"Technical Diving International",description:"Specializes in technical diving, offering advanced certifications."},{ag_name:"BSAC",long_name:"British Sub-Aqua Club",description:"The UK's national governing body for diving, with a strong emphasis on club diving."},{ag_name:"IANTD",long_name:"International Association of Nitrox and Technical Divers",description:"Focuses on technical diving, including rebreather and mixed-gas diving."},{ag_name:"RAID",long_name:"Rebreather Association of International Divers",description:"Known for its innovative approach, particularly in online learning."},{ag_name:"GUE",long_name:"Global Underwater Explorers",description:"Specializes in rigorous training for technical and cave diving."},{ag_name:"FAUI",long_name:"Federation of Australian Underwater Instructors",description:"Based in Australia, offering a range of diving certifications."},{ag_name:"PSS",long_name:"Professional Scuba Schools",description:"An Italian-based diving organization with a global reach."},{ag_name:"IDSA",long_name:"International Diving Schools Association",description:"Focuses on commercial diving standards and certifications."},{ag_name:"ANDI",long_name:"American Nitrox Divers International",description:"Specializes in technical diving, particularly with nitrox."},{ag_name:"FDT",long_name:"Federacin de Deportes Subacuticos",description:"Based in Spain, focusing on underwater sports and diving certifications."},{ag_name:"ADIP",long_name:"Association of Diving Instructors Professional",description:"A European-based diving certification agency."},{ag_name:"SNSI",long_name:"Scuba and Nitrox Safety International",description:"An Italian-based agency focused on recreational diving safety."},{ag_name:"CFT",long_name:"Comhairle Fo-Thuinn",description:"The Irish Underwater Council, managing diving standards and training in Ireland."},{ag_name:"CDAA",long_name:"Cave Divers Association of Australia",description:"Focused on cave diving certifications and training in Australia."},{ag_name:"SDUE",long_name:"Society of Diving Underwater Enthusiasts",description:"Specializes in underwater photography and marine biology."},{ag_name:"NASE",long_name:"National Academy of Scuba Educators",description:"Offers a range of recreational diving courses with a focus on education."},{ag_name:"UTD",long_name:"Unified Team Diving",description:"Specializes in technical and cave diving with a strong emphasis on team diving."},{ag_name:"NAEI",long_name:"National Association of Equipment Instructors",description:"Focuses on diving equipment and technical diving."},{ag_name:"ISDA",long_name:"International Scuba Diving Academy",description:"Provides a variety of diving certifications, including technical and recreational diving."},{ag_name:"SAA",long_name:"Sub-Aqua Association",description:"A UK-based organization offering diving certifications through clubs."},{ag_name:"PDIC",long_name:"Professional Diving Instructors Corporation",description:"Offers recreational and technical diving certifications."},{ag_name:"LUX",long_name:"LUX Diving",description:"Based in Luxembourg, focused on recreational diving training."},{ag_name:"NASDS",long_name:"National Association of Scuba Diving Schools",description:"A US-based organization offering diving certifications."},{ag_name:"AIDA",long_name:"International Association for the Development of Apnea",description:"Specializes in freediving certifications."},{ag_name:"ADC",long_name:"Association of Diving Contractors International",description:"Offers certifications and standards for commercial diving."},{ag_name:"IMCA",long_name:"International Marine Contractors Association",description:"Focuses on commercial diving standards and safety."},{ag_name:"DCBC",long_name:"Diver Certification Board of Canada",description:"Provides commercial diving certifications in Canada."},{ag_name:"HSE",long_name:"Health and Safety Executive",description:"The UK's national authority on commercial diving safety and certification."},{ag_name:"PSD",long_name:"Public Safety Divers Association",description:"Offers training and certifications for public safety diving."},{ag_name:"U.S. Navy Diving",long_name:"U.S. Navy Diving and Salvage Training Center",description:"Provides military diving certifications."},{ag_name:"CFSSAR",long_name:"Canadian Forces School of Search and Rescue",description:"Offers military and search-and-rescue diving certifications."}];this.stdGases=[{O2:100,He:0,fromDepth:6,ppO2:1.5,deco:true,useAsDiluent:false},{O2:50,He:0,fromDepth:21,ppO2:1.2,deco:true,useAsDiluent:false},{O2:35,He:25,fromDepth:36,ppO2:1.2,deco:true,useAsDiluent:false},{O2:21,He:35,fromDepth:57,ppO2:1.2,deco:true,useAsDiluent:false},{O2:32,He:0,fromDepth:30,ppO2:1.4,deco:true,useAsDiluent:false},{O2:32,He:0,fromDepth:30,ppO2:1.2,deco:false,useAsDiluent:false},{O2:30,He:30,fromDepth:30,ppO2:1.2,deco:false,useAsDiluent:false},{O2:21,He:35,fromDepth:45,ppO2:1.2,deco:false,useAsDiluent:true},{O2:18,He:45,fromDepth:60,ppO2:1.2,deco:false,useAsDiluent:true},{O2:15,He:55,fromDepth:75,ppO2:1.2,deco:false,useAsDiluent:true},{O2:12,He:65,fromDepth:90,ppO2:1.2,deco:false,useAsDiluent:true},{O2:10,He:70,fromDepth:110,ppO2:1.2,deco:false,useAsDiluent:true},{O2:7,He:93,fromDepth:140,ppO2:1.2,deco:false,useAsDiluent:true}];this.stdTanks=[{name:"1,8lt",volume:1.8,no_of_tanks:1,forDeco:false},{name:"3lt",volume:3,no_of_tanks:1,forDeco:false},{name:"7lt",volume:7,no_of_tanks:1,forDeco:false},{name:"8,5lt",volume:8.5,no_of_tanks:1,forDeco:false},{name:"10lt",volume:10,no_of_tanks:1,forDeco:false},{name:"12lt",volume:12,no_of_tanks:1,forDeco:false},{name:"s80",volume:11.1,no_of_tanks:1,forDeco:false},{name:"15lt",volume:15,no_of_tanks:1,forDeco:false},{name:"18lt",volume:18,no_of_tanks:1,forDeco:false},{name:"D7",volume:14,no_of_tanks:2,forDeco:false},{name:"D8.5",volume:17,no_of_tanks:2,forDeco:false},{name:"D10",volume:20,no_of_tanks:2,forDeco:false},{name:"2x80s",volume:22.2,no_of_tanks:2,forDeco:false},{name:"D12",volume:24,no_of_tanks:2,forDeco:false},{name:"2xHP100",volume:25.8,no_of_tanks:2,forDeco:false},{name:"D14",volume:28,no_of_tanks:2,forDeco:false},{name:"D15",volume:30,no_of_tanks:2,forDeco:false},{name:"2xHP120",volume:30.6,no_of_tanks:2,forDeco:false},{name:"2xLP104",volume:33,no_of_tanks:2,forDeco:false},{name:"2xHP133",volume:34,no_of_tanks:2,forDeco:false},{name:"D18",volume:36,no_of_tanks:2,forDeco:false},{name:"2xLP120",volume:38,no_of_tanks:2,forDeco:false},{name:"D20",volume:40,no_of_tanks:2,forDeco:false},{name:"s40",volume:5.7,no_of_tanks:1,forDeco:true},{name:"7lt",volume:7,no_of_tanks:1,forDeco:true},{name:"s80",volume:11.1,no_of_tanks:1,forDeco:true}];this.stdConfigurations=[]}getStdGases(){let t=[];this.stdGases.forEach((e=>{e=dt.exports.cloneDeep(e);e.fromDepth=gP.isMetric()?e.fromDepth:gP.metersToFeet(e.fromDepth,-1);t.push(new SP(e))}));return t}getStdTanks(){let t=[];this.stdTanks.forEach((e=>{e=dt.exports.cloneDeep(e);e.volume=gP.isImperial()?gP.ltToCuFt(e.volume):e.volume;t.push(new AP(e))}));return t}getStdConfigurations(){this.stdConfigurations=[];let t=new EP;t.setUnits(gP.units);let e=this.getStdGases();let i=this.getStdTanks();let n=dt.exports.cloneDeep(dt.exports.find(i,{name:"15lt"}));n.setGas(e[5].getGas());let s=new GP({parameters:t,stdName:"Rec 1",maxDepth:gP.isMetric()?20:70,maxTime:30,configuration:{bottom:[n],deco:[]}});this.stdConfigurations.push(s);let r=dt.exports.cloneDeep(dt.exports.find(i,{name:"D12"}));r.setGas(e[5].getGas());let o=new GP({parameters:t,stdName:"Rec 2",maxDepth:gP.isMetric()?30:100,maxTime:30,configuration:{bottom:[r],deco:[]}});this.stdConfigurations.push(o);let a=dt.exports.cloneDeep(dt.exports.find(i,{name:"D12"}));a.setGas(e[7].getGas());let h=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));h.setGas(e[4].getGas());h.gas.fromDepth=gP.isMetric()?21:70;let c=new GP({parameters:t,stdName:"Rec 3",maxDepth:gP.isMetric()?39:130,maxTime:20,configuration:{bottom:[a],deco:[h]}});this.stdConfigurations.push(c);let u=dt.exports.cloneDeep(dt.exports.find(i,{name:"D12"}));u.setGas(e[7].getGas());let l=dt.exports.cloneDeep(dt.exports.find(i,{name:"7lt"},8));l.setGas(e[1].getGas());let f=t;f.time_at_bottom_for_min_gas=1;f.time_at_gas_switch_for_min_gas=1;let d=new GP({parameters:f,stdName:"Tech 1",maxDepth:gP.isMetric()?50:170,maxTime:25,configuration:{bottom:[u],deco:[l]}});this.stdConfigurations.push(d);let p=dt.exports.cloneDeep(dt.exports.find(i,{name:"D12"}));p.setGas(e[8].getGas());let m=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));m.setGas(e[1].getGas());let _=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));_.setGas(e[0].getGas());let v=new GP({parameters:f,stdName:"Tech 60",maxDepth:gP.isMetric()?60:200,maxTime:30,configuration:{bottom:[p],deco:[m,_]}});this.stdConfigurations.push(v);let g=dt.exports.cloneDeep(dt.exports.find(i,{name:"D15"}));g.setGas(e[9].getGas());let b=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"}));b.setGas(e[9].getGas());let w=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));w.setGas(e[2].getGas());let y=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));y.setGas(e[1].getGas());let x=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));x.setGas(e[0].getGas());let M=f;M.deco_gas_reserve=0;M.rmvBottom_multiplier_for_min_gas=1;let T=new GP({parameters:M,stdName:"Tech 2",maxDepth:gP.isMetric()?75:250,maxTime:30,configuration:{bottom:[g,b],deco:[w,y,x]}});this.stdConfigurations.push(T);let O=dt.exports.cloneDeep(dt.exports.find(i,{name:"D18"}));O.setGas(e[10].getGas());let E=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"}));E.setGas(e[10].getGas());let A=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));A.setGas(e[3].getGas());let S=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));S.setGas(e[2].getGas());let k=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));k.setGas(e[1].getGas());let I=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));I.setGas(e[0].getGas());let C=new GP({parameters:M,stdName:"Tech 2+",maxDepth:gP.isMetric()?90:300,maxTime:30,configuration:{bottom:[O,E],deco:[A,S,k,I]}});this.stdConfigurations.push(C);let j=dt.exports.cloneDeep(dt.exports.find(i,{name:"D7"}));j.setGas(e[11].getGas());let D=dt.exports.cloneDeep(dt.exports.find(i,{name:"3lt"}));D.setGas(e[0].getGas());let R=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));R.setGas(e[3].getGas());let P=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));P.setGas(e[2].getGas());let N=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));N.setGas(e[1].getGas());let F=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));F.setGas(e[0].getGas());let z=M;z.rmvBottom_multiplier_for_min_gas=1.5;z.number_of_divers_for_min_gas=1;z.configuration="CCR";let L=new GP({parameters:z,stdName:"CCR",maxDepth:gP.isMetric()?100:330,maxTime:30,configuration:{bottom:[j,D],deco:[R,P,N,F]}});this.stdConfigurations.push(L);let $=dt.exports.cloneDeep(dt.exports.find(i,{name:"D8.5"}));$.setGas(e[11].getGas());let U=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"}));U.setGas(e[10].getGas());let B=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));B.setGas(e[3].getGas());let G=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));G.setGas(e[2].getGas());let H=dt.exports.cloneDeep(dt.exports.find(i,{name:"s80"},8));H.setGas(e[1].getGas());let V=dt.exports.cloneDeep(dt.exports.find(i,{name:"s40"},8));V.setGas(e[0].getGas());let W=z;W.ace_time=400;W.configuration="pSCR";let q=new GP({parameters:z,stdName:"pSCR",maxDepth:gP.isMetric()?100:330,maxTime:30,configuration:{bottom:[$,U],deco:[B,G,H,V]}});this.stdConfigurations.push(q);return this.stdConfigurations}getDivePlansFromConfigurations(t){var e=[];t.forEach((t=>{const i=new LP;i.setConfiguration(t);const n=i.addDive();i.resetDiveWithConfiguration(n,t,false);e.push(i.getDivePlanModel())}));return e}}const UP=new $P;class BP{constructor(t,e,i,n,s,r){const o=UP.getStdTanks();const a=dt.exports.find(o,{name:t});this.name=t;this.units=r?r:"Metric";this.volume=a?a.volume:e;this.no_of_tanks=a?a.no_of_tanks:i;this.gas=n?new wP(n.fO2,n.fHe,n.fromDepth,n.ppO2,this.units):new wP;this.pressure=s?s:this.units=="Metric"?200:3e3}setGas(t){this.gas=t}setPressure(t){this.pressure=t}setTankType(t){this.name=t.name;this.volume=t.volume;this.no_of_tanks=t.no_of_tanks}getGasVolume(){const t=this.units==="Metric"?this.pressure:gP.psiToBar(this.pressure);const e=this.units==="Metric"?this.volume:gP.cuFtToLt(this.volume);const i=dt.exports.toNumber(t)*dt.exports.toNumber(e);const n=gP.ltToCuFt(i);const s=this.units==="Metric"?i:n;return dt.exports.round(s)}convertUnit(t){this.gas.convertUnit(t);if(this.units==="Imperial"&&t||this.units==="Metric"&&!t){this.pressure=t?gP.psiToBar(this.pressure):gP.barToPsi(this.pressure);this.volume=t?gP.cuFtToLt(this.volume):gP.ltToCuFt(this.volume);this.units=t?"Metric":"Imperial"}}getForm(){let t={pressure:this.pressure,O2:this.gas.getO2(),He:this.gas.getHe(),fromDepth:this.gas.fromDepth,ppO2:this.gas.ppO2};return t}}class GP{constructor(t){if(t&&t.parameters){this.parameters=new EP(t.parameters)}else{this.parameters=new EP}if(t&&t.stdName){this.stdName=t.stdName}else{this.stdName="Rec1"}if(t&&t.maxDepth){this.maxDepth=dt.exports.toNumber(t.maxDepth)}else{this.maxDepth=this.getDiveTypeDepth(this.diveType)}if(t&&t.maxTime){this.maxTime=dt.exports.toNumber(t.maxTime)}else{this.maxTime=30}this.configuration={bottom:[],deco:[]};if(t&&t.configuration){t.configuration.bottom.forEach((t=>{this.configuration.bottom.push(new BP(t.name,t.volume,t.no_of_tanks,t.gas,t.pressure,t.units))}));t.configuration.deco.forEach((t=>{this.configuration.deco.push(new BP(t.name,t.volume,t.no_of_tanks,t.gas,t.pressure,t.units))}))}}getDiveTypes(){if(this.parameters.metric){return{Rec1:21,Rec2:30,Rec3:39,Tec1:50,"Tec1+":60,Tec2:75,"Tec2+":90,pSCR:130,CCR:130}}else{return{Rec1:70,Rec2:100,Rec3:130,Tec1:165,"Tec1+":200,Tec2:250,"Tec2+":300,pSCR:430,CCR:430}}}getDiveTypeDepth(t){return this.getDiveTypes()[t]}convertUnits(t){this.parameters=t;this.configuration.bottom=this.configuration.bottom.map((t=>{t.convertUnit(this.parameters.metric);return t}));this.configuration.deco=this.configuration.deco.map((t=>{t.convertUnit(this.parameters.metric);return t}));if(this.parameters.metric){this.maxDepth=dt.exports.round(gP.feetToMeters(this.maxDepth,0))}else{this.maxDepth=dt.exports.round(gP.metersToFeet(this.maxDepth,-1))}}}class HP{constructor(t){this.dives=[];if(t.configuration){this.setConfiguration(t.configuration)}if(t.dives&&t.dives.length>0){t.dives.forEach((t=>{this.addDive(t)}))}if(t.title){this.title=t.title}this.users={};if(t.users){this.users=t.users}}addDive(t){const e=new OP(t);e.setUnits(this.configuration.parameters.units);this.dives.push(e)}updateDive(t,e){const i=new OP(e);i.setUnits(this.configuration.parameters.units);this.dives[t]=i}setConfiguration(t){this.configuration=new GP(t)}convertUnits(t){this.configuration.parameters.setUnits(t);this.configuration.convertUnits(this.configuration.parameters);this.dives=this.dives.map((e=>{e.convertUnits(t);return e}))}}class VP{constructor(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t.position)this.position=$.setPosition(t.position)}else{this[e]=t[e]}}))}}class WP{constructor(t){this.displayName=t&&t.displayName?t.displayName:null;this.photoURL=t&&t.photoURL?t.photoURL:null;this.coverURL=t&&t.coverURL?t.coverURL:null;this.type=t&&t.type?t.type:null;this.address=t&&t.address?t.address:null;this.position=null;if(t&&t.position){if(t.position)this.position=$.setPosition(t.position)}else if(this.address&&this.address.lat&&this.address.lon){this.position=$.getPosition(this.address.lat,this.address.lon)}this.description=t&&t.description?t.description:null;this.information={avgViz:t&&t.information.avgViz?t.information.avgViz:null,minDepth:t&&t.information.minDepth?dt.exports.toNumber(t.information.minDepth):0,maxDepth:t&&t.information.maxDepth?dt.exports.toNumber(t.information.maxDepth):0,entryType:t&&t.information.entryType?t.information.entryType:null,seabedComposition:t&&t.information.seabedComposition?t.information.seabedComposition:null,seabedCover:t&&t.information.seabedCover?t.information.seabedCover:null,waterTemp:{spring:t&&t.information.waterTemp.spring?t.information.waterTemp.spring:null,summer:t&&t.information.waterTemp.summer?t.information.waterTemp.summer:null,autumn:t&&t.information.waterTemp.autumn?t.information.waterTemp.autumn:null,winter:t&&t.information.waterTemp.winter?t.information.waterTemp.winter:null}};this.divePlans=[];if(t&&t.divePlans.length>0){t.divePlans.map((t=>{this.divePlans.push(new HP(t))}))}this.divingCenters=[];if(t&&t.divingCenters.length>0){this.divingCenters=t.divingCenters}this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}setAddress(t){this.address=t}}const qP="diveSites";class YP{constructor(){this.showNewDivePlans=false;this.diveSitesList=[];this.diveSitesList$=new L([])}init(){xN.mapDataSub$.subscribe((()=>{const t=xN.getCollectionArray(qP);if(t&&t.length>0){this.diveSitesList=t;this.diveSitesList$.next(this.diveSitesList)}}))}getMapData(t){const e={};if(t&&Object.keys(t))Object.keys(t).forEach((i=>{e[i]=new VP(t[i])}));return e}async presentDiveSiteUpdate(t){await pP.openModal("modal-dive-site-update",{diveSiteId:t})}async presentDiveSiteDetails(t,e=false){this.showNewDivePlans=e;pP.push("/divesite/"+t,"forward")}async getDiveSite(t){const e=await $L.getDocument(qP,t);return new WP(e)}async updateDiveSite(t,e,i){if(!t){e.users[i]=["owner"];await $L.addDocument(qP,e)}else{await $L.updateDocument(qP,t,e)}return true}async deleteDiveSite(t){const e=await pt.create({header:aP.getTransl("delete-dive-site-header","Delete Dive Site?"),message:aP.getTransl("delete-dive-site-message","This dive site will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{$L.deleteDocument(qP,t);pP.push("/","root")}}]});e.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(qP,t,e,i)}getDiveSitesDetails(t){if(this.diveSitesList.length>0){return this.diveSitesList.find((e=>e.id==t))}else{return null}}getSiteTypes(){return[{type:"reef",name:aP.getTransl("reef","Reef")},{type:"wreck",name:aP.getTransl("wreck","Wreck")},{type:"cave",name:aP.getTransl("cave","Cave")}]}getSiteTypeName(t){return this.getSiteTypes().find((e=>e.type===t)).name}getEntryTypes(){return[{type:"shore",name:aP.getTransl("shore","Shore")},{type:"boat",name:aP.getTransl("boat","Boat")}]}getEntryTypeName(t){return this.getEntryTypes().find((e=>e.type===t)).name}getSeabedCompositions(){return[{type:"coral-reef",name:aP.getTransl("coral-reef","Coral Reef")},{type:"rocky-reef",name:aP.getTransl("rocky-reef","Rocky Reed")},{type:"boulders",name:aP.getTransl("boulders","Boulders")},{type:"cobbles",name:aP.getTransl("cobbles","Cobbles")},{type:"gravel",name:aP.getTransl("gravel","Gravel")},{type:"sand",name:aP.getTransl("sand","Sand")},{type:"seagrass",name:aP.getTransl("seagrass","Seagrass")},{type:"mud",name:aP.getTransl("mud","Mud")}]}getSeabedCompositionName(t){return this.getSeabedCompositions().find((e=>e.type===t)).name}getSeabedCovers(){return[{type:"seagrass",name:aP.getTransl("seagrass","Seagrass")},{type:"turf-algae",name:aP.getTransl("turf-algae","Turf Algae")},{type:"frondose-algae",name:aP.getTransl("frondose-algae","Frondose Algae")},{type:"coralline-algae",name:aP.getTransl("coralline-algae","Coralline Algae")},{type:"hard-coral",name:aP.getTransl("hard-coral","Hard Coral")},{type:"soft-coral",name:aP.getTransl("soft-coral","Soft Coral")},{type:"sponge",name:aP.getTransl("sponge","Sponge")},{type:"benthic-animals",name:aP.getTransl("benthic-animals","Benthic Animals")},{type:"bare",name:aP.getTransl("bare","Bare")}]}getSeabedCoverName(t){return this.getSeabedCovers().find((e=>e.type===t)).name}loadSiteDivingCenters(t){const e=sN.divingCentersList;let i=[];let n=[];e.forEach((e=>{if(t.divingCenters.includes(e.id)){i.push(e)}else{n.push(e)}}));i=dt.exports.orderBy(i,"displayName");n=dt.exports.orderBy(n,"displayName");return{siteDivingCenters:i,divingCenterSelect:n}}}const XP=new YP;class ZP{constructor(t){this.displayName=t&&t.displayName?t.displayName:null;this.organiser=t&&t.organiser?{collectionId:t.organiser.collectionId,id:t.organiser.id}:null;let e=[];if(t&&t.tripDives&&t.tripDives.length>0){t.tripDives.map((t=>{let i=[];if(t.bookings&&t.bookings.length>0){t.bookings.map((t=>{const e={role:t.role,team:t.team?t.team:0,uid:t.uid,confirmedUser:t.confirmedUser,confirmedOrganiser:t.confirmedOrganiser};i.push(e)}))}e.push({divePlan:new HP(t.divePlan),bookings:i,numberOfParticipants:t.numberOfParticipants?t.numberOfParticipants:0})}))}this.tripDives=e;this.chatId=t&&t.chatId?t.chatId:null;this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}}class JP{async addBookingToTrip(t,e,i){const n=Mc(Gl,"addBooking");return n({diveTripId:t,tripIndex:e,booking:i})}async addStudentToClass(t,e){const i=Mc(Gl,"addClassStudent");return i({diveClassId:t,student:e})}async updateTranslations(){await HL.presentLoading("updating");let t=null;try{const e=Mc(Gl,"updateTranslationsDoc");t=await e()}catch(e){t={error:e}}HL.dismissLoading();if(t&&t.error){HL.presentAlertError(t.error);return false}else{return true}}async updateDivingAgency(t,e){await HL.presentLoading("updating");let i=null;try{const n=Mc(Gl,"updateDivingAgency");i=await n({id:t,data:e})}catch(t){i={error:t}}HL.dismissLoading();if(i&&i.error){HL.presentAlertError(i.error);return false}else{return true}}async archiveData(t,e,i,n,s){const r=Mc(Gl,"archiveData");r({path:t,docName:e,groupByDate:i,groupByField:n,archiveByDate:s})}async startUserTrialPeriod(){await HL.presentLoading("please-wait");let t=null;try{const e=Mc(Gl,"startUserTrialPeriod");t=await e()}catch(e){t={error:e}}HL.dismissLoading();if(t&&t.error){HL.presentAlertError(t.error);return false}else{let t=aP.getTransl("activate-trial","Start Trial");let e=aP.getTransl("activate-trail-message-ok","Your trial licence has been activated!");const i=await pt.create({header:t,message:e,buttons:[{text:aP.getTransl("ok","OK"),handler:async()=>{}}]});i.present();return true}}}const KP=new JP;const QP="diveTrips";class tN{constructor(){this.creatingNewDiveTrip$=new L(false);this.creatingNewDiveTrip=false;this.editingDiveTripId$=new L("")}resetSkeletons(){this.setCreatingNewDiveTrip(false);this.setEditingDiveTrip("")}setCreatingNewDiveTrip(t){this.creatingNewDiveTrip=t;this.creatingNewDiveTrip$.next(this.creatingNewDiveTrip)}setEditingDiveTrip(t){this.editingDiveTripId=t;this.editingDiveTripId$.next(this.editingDiveTripId)}async presentDiveTripUpdate(t,e,i){if(i){this.setCreatingNewDiveTrip(false)}else{this.setEditingDiveTrip("");this.setCreatingNewDiveTrip(true)}const n=await pP.openModal("modal-dive-trip-update",{collectionId:t,organiserId:e,diveTripId:i});n.onDidDismiss().then((t=>{if(t.data){this.resetSkeletons()}}))}async presentDiveTripDetails(t){if(window.location.pathname.includes("admin")){if(window.location.pathname.includes("divingschools")){pP.push("/admin/divingschools/"+AN.selectedDivingSchoolId+"/divetrips/"+t,"forward")}else if(window.location.pathname.includes("divingcenters")){pP.push("/admin/divingcenters/"+sN.selectedDivingCenterId+"/divetrips/"+t,"forward")}}else{pP.push("/divetrips/"+t,"forward")}}async pushDiveTrip(t){pP.pushToActualUrl(t,"forward")}async getDiveTrip(t){const e=await $L.getDocument(QP,t);return new ZP(e)}async getTripsSummary(t,e){const i=await $L.getDocumentCollection(t,e,NL,QP);return i}async getArchiveTripsSummary(t,e){const i=await $L.getDocumentCollection(t,e,NL,QP);return i}async updateDiveTrip(t,e){if(!t){const i=await kN.createNewChat(e.organiser.collectionId,e.organiser.id,await mz.getOrganiser("name",e.organiser),{collectionId:QP,id:t});e.chatId=i.id;await $L.addDocument(QP,e);this.updateChatInfo(i.id,e)}else{await $L.updateDocument(QP,t,e);this.updateChatInfo(e.chatId,e)}return true}async updateChatInfo(t,e){const i=await kN.getChat(t);i.name=e.displayName;const n={};e.tripDives.map((async t=>{t.bookings.map((async t=>{if(t.confirmedOrganiser){n[t.uid]={collectionId:sz,id:t.uid,displayName:await mz.getOrganiser("name",{collectionId:sz,id:t.uid})}}}));t.divePlan.dives.map((async t=>{if(t.divingCenterId){n[t.divingCenterId]={collectionId:iN,id:t.divingCenterId,displayName:await mz.getOrganiser("name",{collectionId:iN,id:t.divingCenterId})}}}))}));Object.keys(e.users).map((async t=>{n[t]={collectionId:sz,id:t,displayName:await mz.getOrganiser("name",{collectionId:sz,id:t})}}));const s=Object.keys(n).filter((t=>!Object.keys(i.participants).includes(t)));const r=Object.keys(i.participants).filter((t=>!Object.keys(n).includes(t)));const o=[];const a=[];s.map((t=>{o.push(n[t])}));r.map((t=>{a.push(i.participants[t])}));kN.updateParticipants(t,i,{added:o,removed:a})}async addDiveTrip(t,e,i){return new Promise((async n=>{let s=e>=0?t.tripDives[e]:undefined;const r=await _t.create({component:"popover-new-dive-trip",translucent:true,componentProps:{tripDive:s,diveIndex:i}});r.onDidDismiss().then((async e=>{const r=e.data;const o=await XP.getDiveSite(r.diveSiteId);let a=null;if(r.divePlanName){a=o.divePlans.find((t=>t.configuration.stdName===r.divePlanName))}else{a={dives:[{date:null,diveSiteId:null,divingCenterId:null}]}}if(!s){a.dives[0].date=r.date;a.title=r.title;a.dives[0].diveSiteId=r.diveSiteId;a.dives[0].divingCenterId=r.divingCenterId;t.tripDives.push({divePlan:a,numberOfParticipants:r.participants,bookings:[]})}else if(i>=0){s.divePlan.title=r.title;s.divePlan.dives[i]=a.dives[0];s.divePlan.dives[i].diveSiteId=r.diveSiteId;s.divePlan.dives[i].divingCenterId=r.divingCenterId;if(i==0){s.numberOfParticipants=r.participants;s.divePlan.dives[i].date=r.date}else{s.divePlan.dives[i].surfaceInterval=r.surfaceInterval}s=this.updateDiveTimes(s)}else{s.divePlan.addDive(a.dives[0]);const t=s.divePlan.dives.length;s.divePlan.dives[t-1].surfaceInterval=r.surfaceInterval;s=this.updateDiveTimes(s)}n(t)}));r.present()}))}removeDiveTrip(t,e){t.tripDives.splice(e,1);return t}removeTripDive(t,e,i){t.tripDives[e].divePlan.dives.splice(i,1);t.tripDives[e]=this.updateDiveTimes(t.tripDives[e]);return t}updateDiveTimes(t){for(let e=1;e<t.divePlan.dives.length;e++){t.divePlan.dives[e].date=Vl.addHours(t.divePlan.dives[e-1].date,t.divePlan.dives[e].surfaceInterval)}return t}async deleteDiveTrip(t){const e=await pt.create({header:aP.getTransl("delete-dive-trip-header","Delete Dive Trip?"),message:aP.getTransl("delete-dive-trip-message","This dive trip will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:async()=>{eN.setEditingDiveTrip(t);$L.deleteDocument(QP,t)}}]});e.present()}async sendBookingRequest(t,e,i,n,s,r,o){return new Promise((async(a,h)=>{const c={role:i,team:n,uid:s,confirmedUser:r,confirmedOrganiser:o};try{const i=await KP.addBookingToTrip(t,e,c);a(i.data)}catch(t){HL.presentAlertError(t);h(t)}}))}}const eN=new tN;const iN="divingCenters";class nN{constructor(){this.showNewDivePlans=false;this.divingCentersList=[];this.divingCentersList$=new L([]);this.selectedDivingCenter$=new L({});this.selectedDivingCenterTrips$=new L({});this.selectedDivingCenterClients$=new L({});this.selectedDivingCenterChats$=new L({})}init(){xN.mapDataSub$.subscribe((()=>{const t=xN.getCollectionArray(iN);if(t&&t.length>0){this.divingCentersList=t;this.divingCentersList$.next(this.divingCentersList)}}))}async selectDivingCenterForAdmin(t){if(!this.selectedDivingCenterSub){const e=await $L.getDocumentObservable(iN,t);this.selectedDivingCenterSub=e.subscribe((e=>{this.selectedDivingCenter=new _P(e);this.selectedDivingCenterId=t;this.selectedDivingCenter$.next(this.selectedDivingCenter);this.loadSelectedDivingCenterData()}))}else{this.selectedDivingCenter$.next(this.selectedDivingCenter)}}loadSelectedDivingCenterData(){this.selectedDivingCenterTripsSub=U(B(Ul,iN,this.selectedDivingCenterId,NL,QP),(t=>{this.selectedDivingCenterTrips=t.data();this.selectedDivingCenterTrips$.next(this.selectedDivingCenterTrips)}));this.selectedDivingCenterClientsSub=U(B(Ul,iN,this.selectedDivingCenterId,wN,wN),(t=>{this.selectedDivingCenterClients=t.data();this.selectedDivingCenterClients$.next(this.selectedDivingCenterClients)}));this.selectedDivingCenterChatsSub=U(B(Ul,iN,this.selectedDivingCenterId,fz,fz),(t=>{this.selectedDivingCenterChats=t.data();this.selectedDivingCenterChats$.next(this.selectedDivingCenterChats)}));kN.loadChatsForUser(this.selectedDivingCenterId)}unsubscribeDivingCenterForAdmin(){if(this.selectedDivingCenterSub&&this.selectedDivingCenter){this.selectedDivingCenter=null;this.selectedDivingCenter$.next(null);this.selectedDivingCenterSub.unsubscribe();this.selectedDivingCenterSub=null;this.selectedDivingCenterTripsSub();this.selectedDivingCenterTrips=null;this.selectedDivingCenterClientsSub();this.selectedDivingCenterClients=null;this.selectedDivingCenterChatsSub();this.selectedDivingCenterChats=null;kN.resetChatUser()}}getMapData(t){const e={};if(t&&Object.keys(t))Object.keys(t).forEach((i=>{e[i]=new mP(t[i])}));return e}async presentDivingCenterUpdate(t){await pP.openModal("modal-diving-center-update",{divingCenterId:t})}async presentDivingCenterDetails(t,e=false){this.showNewDivePlans=e;pP.push("/divingcenter/"+t,"forward")}async getDivingCenter(t){const e=await $L.getDocument(iN,t);return new _P(e)}getDivingCenterDetails(t){if(this.divingCentersList.length>0){return this.divingCentersList.find((e=>e.id==t))}else{return null}}async updateDivingCenter(t,e,i){if(!t){e.users[i]=["owner"];await $L.addDocument(iN,e)}else{await $L.updateDocument(iN,t,e)}return true}async deleteDivingCenter(t){const e=await pt.create({header:aP.getTransl("delete-dive-center-header","Delete Dive Center?"),message:aP.getTransl("delete-dive-center-message","This dive center will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{$L.deleteDocument(iN,t);pP.push("/","root")}}]});e.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(iN,t,e,i)}loadDivingCenterSites(t){const e=XP.diveSitesList;let i=[];let n=[];e.forEach((e=>{if(t.diveSites.includes(e.id)){i.push(e)}else{n.push(e)}}));i=dt.exports.orderBy(i,"displayName");n=dt.exports.orderBy(n,"displayName");return{divingCenterSites:i,divingCenterSelect:n}}}const sN=new nN;class rN{constructor(t){this.organiser=t&&t.organiser?{collectionId:t.organiser.collectionId,id:t.organiser.id}:null;this.name=t&&t.name?t.name:null;this.course=t&&t.course?t.course:null;this.schedule={};if(t&&t.schedule){Object.keys(t.schedule).map((e=>{this.schedule[e]=new Date(t.schedule[e])}))}this.location=t&&t.location?t.location:[];this.activities=[];if(t&&t.activities&&t.activities.length>0){t.activities.map((t=>{if(t.divePlan){const e=new HP(t.divePlan);t.divePlan=e}this.activities.push(t)}))}this.students=[];if(t&&t.students&&t.students.length>0){t.students.map((t=>{this.students.push(t)}))}this.numberOfStudents=t&&t.numberOfStudents?t.numberOfStudents:3;this.comments=t&&t.comments?t.comments:"";this.status=t&&t.status?t.status:"active";this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}}const oN="divingClasses";class aN{constructor(){this.creatingNewDivingClass$=new L(false);this.creatingNewDivingClass=false;this.editingDivingClassId$=new L("")}init(){HL.systemPreferences$.subscribe((t=>{this.divingAgencies=t.divingAgencies}))}getCourseDetails(t){if(this.divingAgencies){return{agency:this.divingAgencies[t.agencyId],course:this.divingAgencies[t.agencyId].certifications[t.certificationId]}}else return null}resetSkeletons(){this.setCreatingNewDivingClass(false);this.setEditingDivingClass("")}setCreatingNewDivingClass(t){this.creatingNewDivingClass=t;this.creatingNewDivingClass$.next(this.creatingNewDivingClass)}setEditingDivingClass(t){this.editingDivingClassId=t;this.editingDivingClassId$.next(this.editingDivingClassId)}async presentDivingClassUpdate(t,e,i){if(i){this.setCreatingNewDivingClass(false)}else{this.setEditingDivingClass("");this.setCreatingNewDivingClass(true)}const n=await pP.openModal("modal-diving-class-update",{divingClassId:i,collectionId:t,organiserId:e});n.onDidDismiss().then((t=>{if(t.data){this.resetSkeletons()}}))}async presentDivingClassDetails(t){if(window.location.pathname.includes("admin")){if(window.location.pathname.includes("divingschools")){pP.push("/admin/divingschools/"+AN.selectedDivingSchoolId+"/divingclasses/"+t,"forward")}else if(window.location.pathname.includes("divingcenters")){pP.push("/admin/divingcenters/"+sN.selectedDivingCenterId+"/divingclasses/"+t,"forward")}}else{pP.push("/divingclasses/"+t,"forward")}}async pushDivingClass(t){pP.pushToActualUrl(t,"forward")}async getDivingClass(t){const e=await $L.getDocument(oN,t);return new rN(e)}async getClassesSummary(t,e){console.log("nnot working getClassesSummary",t,e);const i=null;return i}async getArchiveClassSummary(t,e){const i=$L.getDocumentCollection(t,e,NL,oN);return i}async updateDivingClass(t,e){if(!t){await $L.addDocument(oN,e)}else{await $L.updateDocument(oN,t,e)}return true}async addDivingClass(t){return new Promise((async e=>{const i=await _t.create({component:"popover-new-diving-class",translucent:true,componentProps:{}});i.onDidDismiss().then((async()=>{e(t)}));i.present()}))}async deleteDivingClass(t){const e=await pt.create({header:aP.getTransl("delete-diving-class-header","Delete Diving Class?"),message:aP.getTransl("delete-diving-class-message","This diving class will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{this.setEditingDivingClass(t);$L.deleteDocument(oN,t)}}]});e.present()}async sendBookingRequest(t,e,i,n){return new Promise((async(s,r)=>{const o={uid:e,status:i,evaluations:n};try{const e=await KP.addStudentToClass(t,o);s(e.data)}catch(t){HL.presentAlertError(t);r(t)}}))}}const hN=new aN;class cN{constructor(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t.position)this.position=$.setPosition(t.position)}else{this[e]=t[e]}}))}}class uN{constructor(t){this.displayName=t&&t.displayName?t.displayName:null;this.photoURL=t&&t.photoURL?t.photoURL:null;this.coverURL=t&&t.coverURL?t.coverURL:null;if(t&&t.position){if(t.position)this.position=$.setPosition(t.position)}else if(this.address&&this.address.lat&&this.address.lon){this.position=$.getPosition(this.address.lat,this.address.lon)}this.address=t&&t.address?t.address:null;this.description=t&&t.description?t.description:null;this.phoneNumber=t&&t.phoneNumber?t.phoneNumber:null;this.email=t&&t.email?t.email:null;this.website=t&&t.website?t.website:null;this.twitter=t&&t.twitter?t.twitter:null;this.facebook=t&&t.facebook?t.facebook:null;this.instagram=t&&t.instagram?t.instagram:null;this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}setPosition(t,e){this.position=$.getPosition(t,e)}setAddress(t){this.address=t}}const lN="serviceCenters";class fN{constructor(){this.serviceCentersList=[];this.serviceCentersList$=new L([]);this.selectedServiceCenter$=new L({});this.selectedServiceCenterClients$=new L({});this.selectedServiceCenterChats$=new L({})}init(){xN.mapDataSub$.subscribe((()=>{const t=xN.getCollectionArray(lN);if(t&&t.length>0){this.serviceCentersList=t;this.serviceCentersList$.next(this.serviceCentersList)}}))}async selectServiceCenterForAdmin(t){if(!this.selectedServiceCenterSub){const e=await $L.getDocumentObservable(lN,t);this.selectedServiceCenterSub=e.subscribe((e=>{this.selectedServiceCenter=new uN(e);this.selectedServiceCenterId=t;this.selectedServiceCenter$.next(this.selectedServiceCenter);this.loadSelectedServiceCenterData()}))}else{this.selectedServiceCenter$.next(this.selectedServiceCenter)}}loadSelectedServiceCenterData(){this.selectedServiceCenterClientsSub=U(B(Ul,lN,this.selectedServiceCenterId,wN,wN),(t=>{this.selectedServiceCenterClients=t.data();this.selectedServiceCenterClients$.next(this.selectedServiceCenterClients)}));this.selectedServiceCenterChatsSub=U(B(Ul,lN,this.selectedServiceCenterId,fz,fz),(t=>{this.selectedServiceCenterChats=t.data();this.selectedServiceCenterChats$.next(this.selectedServiceCenterChats)}));kN.loadChatsForUser(this.selectedServiceCenterId)}unsubscribeServiceCenterForAdmin(){if(this.selectedServiceCenterSub&&this.selectedServiceCenter){this.selectedServiceCenter=null;this.selectedServiceCenter$.next(null);this.selectedServiceCenterSub.unsubscribe();this.selectedServiceCenterClients$.next(null);this.selectedServiceCenterClientsSub();this.selectedServiceCenterClients=null;this.selectedServiceCenterChats$.next(null);this.selectedServiceCenterChatsSub();this.selectedServiceCenterChats=null;kN.resetChatUser()}}getServiceCenterDetails(t){if(this.serviceCentersList.length>0){return this.serviceCentersList.find((e=>e.id==t))}else{return null}}getMapData(t){const e={};if(t&&Object.keys(t))Object.keys(t).forEach((i=>{e[i]=new cN(t[i])}));return e}async presentServiceCenterUpdate(t){await pP.openModal("modal-service-center-update",{serviceCenterId:t})}async presentServiceCenterDetails(t){pP.push("/servicecenter/"+t,"forward")}async getServiceCenter(t){const e=await $L.getDocument(lN,t);return new uN(e)}async updateServiceCenter(t,e,i){if(!t){e.users[i]=["owner"];await $L.addDocument(lN,e)}else{await $L.updateDocument(lN,t,e)}return true}async deleteServiceCenter(t){const e=await pt.create({header:aP.getTransl("delete-diving-school-header","Delete Diving School?"),message:aP.getTransl("delete-diving-school-message","This diving school will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{$L.deleteDocument(lN,t);pP.push("/","root")}}]});e.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(lN,t,e,i)}}const dN=new fN;class pN{constructor(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t.position)this.position=$.setPosition(t.position)}else{this[e]=t[e]}}))}}class mN{constructor(t){this.displayName=t&&t.displayName?t.displayName:null;this.photoURL=t&&t.photoURL?t.photoURL:null;this.coverURL=t&&t.coverURL?t.coverURL:null;this.address=t&&t.address?t.address:null;if(t&&t.position){if(t.position)this.position=$.setPosition(t.position)}else if(this.address&&this.address.lat&&this.address.lon){this.position=$.getPosition(this.address.lat,this.address.lon)}this.description=t&&t.description?t.description:null;this.phoneNumber=t&&t.phoneNumber?t.phoneNumber:null;this.email=t&&t.email?t.email:null;this.website=t&&t.website?t.website:null;this.twitter=t&&t.twitter?t.twitter:null;this.facebook=t&&t.facebook?t.facebook:null;this.instagram=t&&t.instagram?t.instagram:null;this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}setPosition(t,e){this.position=$.getPosition(t,e)}setAddress(t){this.address=t}}const _N="diveCommunities";const vN="communityMembers";class gN{constructor(){this.showNewDivePlans=false;this.diveCommunitiesList=[];this.diveCommunitiesList$=new L([]);this.selectedDiveCommunity$=new L({});this.selectedDiveCommunityTrips$=new L({});this.selectedDiveCommunityMembers$=new L({});this.selectedDiveCommunityChats$=new L({})}init(){xN.mapDataSub$.subscribe((()=>{const t=xN.getCollectionArray(_N);if(t&&t.length>0){this.diveCommunitiesList=t;this.diveCommunitiesList$.next(this.diveCommunitiesList)}}))}async selectDiveCommunityForAdmin(t){if(!this.selectedDiveCommunitySub){const e=await $L.getDocumentObservable(_N,t);this.selectedDiveCommunitySub=e.subscribe((e=>{this.selectedDiveCommunity=new mN(e);this.selectedDiveCommunityId=t;this.selectedDiveCommunity$.next(this.selectedDiveCommunity);this.loadSelectedDiveCommunityData()}))}else{this.selectedDiveCommunity$.next(this.selectedDiveCommunity)}}loadSelectedDiveCommunityData(){this.selectedDiveCommunityTripsSub=U(B(Ul,_N,this.selectedDiveCommunityId,NL,QP),(t=>{this.selectedDiveCommunityTrips=t.data();this.selectedDiveCommunityTrips$.next(this.selectedDiveCommunityTrips)}));this.selectedDiveCommunityMembersSub=U(B(Ul,_N,this.selectedDiveCommunityId,vN,vN),(t=>{this.selectedDiveCommunityMembers=t.data();this.selectedDiveCommunityMembers$.next(this.selectedDiveCommunityMembers)}));this.selectedDiveCommunityChatsSub=U(B(Ul,_N,this.selectedDiveCommunityId,fz,fz),(t=>{this.selectedDiveCommunityChats=t.data();this.selectedDiveCommunityChats$.next(this.selectedDiveCommunityChats)}));kN.loadChatsForUser(this.selectedDiveCommunityId)}unsubscribeDiveCommunityForAdmin(){if(this.selectedDiveCommunitySub&&this.selectedDiveCommunity){this.selectedDiveCommunity=null;this.selectedDiveCommunity$.next(null);this.selectedDiveCommunitySub.unsubscribe();this.selectedDiveCommunitySub=null;this.selectedDiveCommunityTripsSub();this.selectedDiveCommunityTrips=null;this.selectedDiveCommunityMembersSub();this.selectedDiveCommunityMembers=null;this.selectedDiveCommunityChatsSub();this.selectedDiveCommunityChats=null;kN.resetChatUser()}}getMapData(t){const e={};if(t&&Object.keys(t))Object.keys(t).forEach((i=>{e[i]=new pN(t[i])}));return e}async presentDiveCommunityUpdate(t){await pP.openModal("modal-dive-community-update",{diveCommunityId:t})}async presentDiveCommunityDetails(t,e=false){this.showNewDivePlans=e;pP.push("/divecommunity/"+t,"forward")}async getDiveCommunity(t){const e=await $L.getDocument(_N,t);return new mN(e)}getDiveCommunityDetails(t){if(this.diveCommunitiesList.length>0){return this.diveCommunitiesList.find((e=>e.id==t))}else{return null}}async updateDiveCommunity(t,e,i){if(!t){e.users[i]=["owner"];await $L.addDocument(_N,e)}else{await $L.updateDocument(_N,t,e)}return true}async deleteDiveCommunity(t){const e=await pt.create({header:aP.getTransl("delete-dive-community-header","Delete Community?"),message:aP.getTransl("delete-dive-community-message","This community will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{$L.deleteDocument(_N,t);pP.push("/","root")}}]});e.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(_N,t,e,i)}}const bN=new gN;const wN="clients";class yN{constructor(){this.searchFilters=[]}async init(){await aP.init();this.mapData=this.getMapDocs();this.mapDataSub$=new L(this.mapData);this.downloadMapData()}getMapDocs(t){if(ht.isUdive()){let e={divingCenters:{name:aP.getTransl("diving-centers","Diving Centers"),icon:{type:"mapicon",name:"map-icon-boating",color:"divingcenter"},collection:undefined,collectionSub$:new L([]),createMapData:()=>undefined,filteredCollection:{},fieldsToQuery:["displayName","email"],query:true},diveCommunities:{name:aP.getTransl("dive-communities","Dive Communities"),icon:{type:"ionicon",name:"people-circle",color:"divecommunity"},collection:undefined,collectionSub$:new L([]),createMapData:()=>undefined,filteredCollection:{},fieldsToQuery:["displayName"],query:true},diveSites:{name:aP.getTransl("diving-sites","Diving Sites"),icon:{type:"udiveicon",name:"udive-icon-diver",color:"divesite"},collection:undefined,collectionSub$:new L([]),createMapData:()=>undefined,filteredCollection:{},fieldsToQuery:["displayName","type"],query:true},divingSchools:{name:aP.getTransl("diving-schools","Diving Schools"),icon:{type:"ionicon",name:"school",color:"school"},collection:undefined,collectionSub$:new L([]),createMapData:()=>undefined,filteredCollection:{},fieldsToQuery:["displayName","email","divingCourses"],query:true}};e=this.getUserProfileCollections(e);if(t){return e[t]}else{return e}}else if(ht.isDecoplanner()){return this.getUserProfileCollections({})}else{return{}}}getUserProfileCollections(t){if(this.user&&this.user.uid){if(ht.isUdive()||ht.isDecoplanner()&&mz.userRoles.isUserAdmin()){t[rz]={name:aP.getTransl("divers","Divers"),icon:{type:"ionicon",name:"person",color:"divers"},collection:undefined,collectionSub$:new L([]),createMapData:()=>undefined,filteredCollection:{},fieldsToQuery:["displayName","cards"],query:true}}}return t}initUser(t){this.user=t;this.mapData=this.getMapDocs();this.downloadMapData()}sendMapData(){this.mapDataSub$?this.mapDataSub$.next(this.mapData):undefined}downloadMapData(t=true){if(this.mapData)Object.keys(this.mapData).map((e=>{$L.getDocument(FL,e,t).then((t=>{switch(e){case qP:t=XP.getMapData(t);break;case iN:t=sN.getMapData(t);break;case _N:t=bN.getMapData(t);break;case ON:t=AN.getMapData(t);break;case rz:t=mz.getMapData(t);break;case lN:t=dN.getMapData(t);break}this.refreshFilterDocuments(e,t)}),(()=>{this.refreshFilterDocuments(e,{})}))}))}filterDocuments(t=[]){this.resetDocumentsQuery(t.find((t=>t.type=="filter"))==undefined);this.searchFilters=[];if(t){t.forEach((t=>{if(t.type=="filter"){this.mapData[t.name].query=true}else{this.searchFilters.push(t.name)}}));Object.keys(this.mapData).map((async t=>{this.refreshFilterDocuments(t)}))}}async refreshFilterDocuments(t,e){const i=this.mapData[t];if(e){i.collection=await $L.checkCollectionWithOfflineData(t,e)}if(i.query){if(this.searchFilters.length>0){i.filteredCollection={};i.fieldsToQuery.forEach((t=>{dt.exports.each(i.collection,((e,n)=>{this.searchFilters.forEach((s=>{if(t=="displayName"||t=="email"){if(e[t]&&e[t].toLowerCase().search(s.toLowerCase())!=-1){i.filteredCollection[n]=e}}if(t=="type"){if(e[t]&&(e[t].toLowerCase().search(s.toLowerCase())>-1||XP.getSiteTypeName(e[t]).toLowerCase().search(s.toLowerCase())>-1)){i.filteredCollection[n]=e}}if(t=="cards"||t=="divingCourses"){if(e[t]&&e[t].length>0){e[t].forEach((async t=>{const r=hN.getCourseDetails(t);if(r&&(r.agency.name.toLowerCase().search(s.toLowerCase())>-1||r.course.name.toLowerCase().search(s.toLowerCase())>-1)){i.filteredCollection[n]=e}}))}}}))}))}))}else{i.filteredCollection=i.collection}}else{i.filteredCollection={}}this.sendMapData()}getCollectionArray(t){if(this.mapData&&this.mapData[t]&&this.mapData[t].collection){let e=[];Object.keys(this.mapData[t].collection).forEach((i=>{let n=this.mapData[t].collection[i];n.id=i;e.push(n)}));e=dt.exports.orderBy(e,this.getMapDocs(t).orderBy);return e}else{return[]}}resetDocumentsQuery(t){this.mapData=dt.exports.each(this.mapData,(e=>{e.query=t}))}}const xN=new yN;class MN{constructor(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t.position)this.position=$.setPosition(t.position)}else{this[e]=t[e]}}))}}class TN{constructor(t){this.displayName=t&&t.displayName?t.displayName:null;this.photoURL=t&&t.photoURL?t.photoURL:null;this.coverURL=t&&t.coverURL?t.coverURL:null;this.position=null;if(t&&t.position){if(t.position)this.position=$.setPosition(t.position)}else if(this.address&&this.address.lat&&this.address.lon){this.position=$.getPosition(this.address.lat,this.address.lon)}this.address=t&&t.address?t.address:null;this.description=t&&t.description?t.description:null;this.phoneNumber=t&&t.phoneNumber?t.phoneNumber:null;this.email=t&&t.email?t.email:null;this.website=t&&t.website?t.website:null;this.twitter=t&&t.twitter?t.twitter:null;this.facebook=t&&t.facebook?t.facebook:null;this.instagram=t&&t.instagram?t.instagram:null;this.divingCourses=[];if(t&&t.divingCourses){this.divingCourses=t.divingCourses}this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}setPosition(t,e){this.position=$.getPosition(t,e)}setAddress(t){this.address=t}}const ON="divingSchools";class EN{constructor(){this.showNewDivingCourses=false;this.divingSchoolsList=[];this.divingSchoolsList$=new L([]);this.selectedDivingSchool$=new L({});this.selectedDivingSchoolClasses$=new L({});this.selectedDivingSchoolTrips$=new L({});this.selectedDivingSchoolClients$=new L({});this.selectedDivingSchoolChats$=new L({})}init(){xN.mapDataSub$.subscribe((()=>{const t=xN.getCollectionArray(ON);if(t&&t.length>0){this.divingSchoolsList=t;this.divingSchoolsList$.next(this.divingSchoolsList)}}))}async selectDivingSchoolForAdmin(t){if(!this.selectedDivingSchoolSub){const e=await $L.getDocumentObservable(ON,t);this.selectedDivingSchoolSub=e.subscribe((e=>{this.selectedDivingSchool=new TN(e);this.selectedDivingSchoolId=t;this.selectedDivingSchool$.next(this.selectedDivingSchool);this.loadSelectedDivingData()}))}else{this.selectedDivingSchool$.next(this.selectedDivingSchool)}}loadSelectedDivingData(){this.selectedDivingSchoolClassesSub=U(B(Ul,ON,this.selectedDivingSchoolId,NL,oN),(t=>{this.selectedDivingSchoolClasses=t.data();this.selectedDivingSchoolClasses$.next(this.selectedDivingSchoolClasses)}));this.selectedDivingSchoolTripsSub=U(B(Ul,ON,this.selectedDivingSchoolId,NL,QP),(t=>{this.selectedDivingSchoolTrips=t.data();this.selectedDivingSchoolTrips$.next(this.selectedDivingSchoolTrips)}));this.selectedDivingSchoolClientsSub=U(B(Ul,ON,this.selectedDivingSchoolId,wN,wN),(t=>{this.selectedDivingSchoolClients=t.data();this.selectedDivingSchoolClients$.next(this.selectedDivingSchoolClients)}));this.selectedDivingSchoolChatsSub=U(B(Ul,ON,this.selectedDivingSchoolId,fz,fz),(t=>{this.selectedDivingSchoolChats=t.data();this.selectedDivingSchoolChats$.next(this.selectedDivingSchoolChats)}));kN.loadChatsForUser(this.selectedDivingSchoolId)}unsubscribeDivingSchoolForAdmin(){if(this.selectedDivingSchoolSub&&this.selectedDivingSchool){this.selectedDivingSchool=null;this.selectedDivingSchool$.next(null);this.selectedDivingSchoolSub.unsubscribe();this.selectedDivingSchoolSub=null;this.selectedDivingSchoolClasses$.next(null);this.selectedDivingSchoolClassesSub();this.selectedDivingSchoolClasses=null;this.selectedDivingSchoolTrips$.next(null);this.selectedDivingSchoolTripsSub();this.selectedDivingSchoolTrips=null;this.selectedDivingSchoolClients$.next(null);this.selectedDivingSchoolClientsSub();this.selectedDivingSchoolClients=null;this.selectedDivingSchoolChats$.next(null);this.selectedDivingSchoolChatsSub();this.selectedDivingSchoolChats=null;kN.resetChatUser()}}getDivingSchoolDetails(t){if(this.divingSchoolsList.length>0){return this.divingSchoolsList.find((e=>e.id==t))}else{return null}}getMapData(t){const e={};if(t&&Object.keys(t))Object.keys(t).forEach((i=>{e[i]=new MN(t[i])}));return e}async presentDivingSchoolUpdate(t){await pP.openModal("modal-diving-school-update",{divingSchoolId:t})}async presentDivingSchoolDetails(t,e=false){this.showNewDivingCourses=e;pP.push("/divingschool/"+t,"forward")}async getDivingSchool(t){const e=await $L.getDocument(ON,t);return new TN(e)}async updateDivingSchool(t,e,i){if(!t){e.users[i]=["owner"];await $L.addDocument(ON,e)}else{await $L.updateDocument(ON,t,e)}return true}async deleteDivingSchool(t){const e=await pt.create({header:aP.getTransl("delete-diving-school-header","Delete Diving School?"),message:aP.getTransl("delete-diving-school-message","This diving school will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{$L.deleteDocument(ON,t);pP.push("/","root")}}]});e.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(ON,t,e,i)}async loadDivingSchoolCourses(t){const e=await HL.getDivingAgencies();let i=[];let n=[];const s=t.divingCourses;Object.keys(e).forEach((t=>{const r=e[t];Object.keys(r.certifications).forEach((e=>{const o=r.certifications[e];const a=s.findIndex((i=>i.agencyId===t&&i.certificationId===e));const h={agencyId:t,certificationId:e,group:o.group,order:o.order};if(a>-1){i.push(h)}else{n.push(h)}}))}));i=dt.exports.orderBy(i,["agencyId","group","order"]);n=dt.exports.orderBy(n,["agencyId","group","order"]);return{divingSchoolCourses:i,divingSchoolCoursesSelect:n}}}const AN=new EN;class SN{constructor(){this.creatingNewChat$=new L(false);this.creatingNewChat=false;this.editingChatId$=new L("");this.loadedChat$=new L({});this.userChatsList$=new L({});this.servicesChatsList$=new L({})}resetSkeletons(){this.setCreatingNewChat(false);this.setEditingChat("")}setCreatingNewChat(t){this.creatingNewChat=t;this.creatingNewChat$.next(this.creatingNewChat)}setEditingChat(t){this.editingChatId=t;this.editingChatId$.next(this.editingChatId)}async getChat(t){return await $L.getDocument(fz,t)}async loadChat(t){const e=await $L.getDocumentObservable(fz,t);this.loadedChatSub=e.subscribe((t=>{this.loadedChat=t;this.loadedChat.thread=dt.exports.orderBy(t.thread,"created");this.loadedChat$.next(this.loadedChat)}))}saveLastChatReadToUser(t,e){const i=mz.userSettings;!i.chatsLastRead?i.chatsLastRead={}:undefined;i.chatsLastRead[t]=e.thread&&e.thread.length>0?e.thread[e.thread.length-1].created:e.date;mz.updateUserSettings(i)}unloadChat(){this.loadedChat=null;this.loadedChat$.next(this.loadedChat);this.loadedChatSub.unsubscribe()}async addChat(t,e,i){const n=await pt.create({header:aP.getTransl("add-chat-header","Add Chat"),message:aP.getTransl("add-chat-message","Do you want to add a new chat?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:async()=>{const n=await this.createNewChat(t,e,i);if(n&&n.id)this.presentChat(n.id)}}]});n.present()}async createNewChat(t,e,i,n){this.setCreatingNewChat(true);const s=await ZR();const r={name:"",date:Math.floor(s.getTime()/1e3).toString(),participants:{},additionalData:n,users:{},thread:[]};r.participants[e]={collectionId:t,id:e,displayName:i};r.users[e]=["owner"];const o=await $L.addDocument(fz,r);this.setCreatingNewChat(false);return o}async createChatWithParticipants(t,e,i,n,s,r){const o=await ZR();const a={name:n?n:"",date:Math.floor(o.getTime()/1e3).toString(),additionalData:r,participants:{},users:{},thread:s?s:[]};a.participants[t.id]={collectionId:t.collectionId,id:t.id,displayName:t.displayName};a.users[t.id]=["owner"];e.forEach((t=>{a.participants[t.id]={collectionId:t.collectionId,id:t.id,displayName:t.displayName};a.users[t.id]=["editor"]}));let h=null;if(i){h=await $L.updateDocument(fz,i,a)}else{h=await $L.addDocument(fz,a)}return h}resetChatUser(){if(!pP.pageTo.includes("admin")){this.servicesChatsList$=null;this.loadChatsForUser()}}loadChatsForUser(t){if(t){if(t===AN.selectedDivingSchoolId){this.servicesChatsList$=AN.selectedDivingSchoolChats$;this.chatUser={collectionId:ON,id:t,displayName:AN.selectedDivingSchool.displayName}}else if(t===sN.selectedDivingCenterId){this.servicesChatsList$=sN.selectedDivingCenterChats$;this.chatUser={collectionId:iN,id:t,displayName:sN.selectedDivingCenter.displayName}}else if(t===bN.selectedDiveCommunityId){this.servicesChatsList$=bN.selectedDiveCommunityChats$;this.chatUser={collectionId:_N,id:t,displayName:bN.selectedDiveCommunity.displayName}}else if(t===dN.selectedServiceCenterId){this.servicesChatsList$=dN.selectedServiceCenterChats$;this.chatUser={collectionId:lN,id:t,displayName:dN.selectedServiceCenter.displayName}}}else{mz.userChats$.subscribe((t=>{this.userChatsList$.next(t)}));this.chatUser={collectionId:sz,id:mz.userProfile?mz.userProfile.uid:null,displayName:mz.userProfile.displayName}}}getOtherChatParticipants(t,e){const i=Object.keys(e.participants).length;let n=[];let s="";Object.keys(e.participants).map((t=>{if(e.participants[t]&&e.participants[t].id&&e.participants[t].id!==this.chatUser.id){n.push(e.participants[t])}}));n=dt.exports.orderBy(n,"displayName");s="";if(i==1){s="..."}else{for(let t=0;t<n.length;t++){s=s+n[t].displayName+(t<n.length-1?", ":"")}}if(t=="names")return s;else return n}updateParticipants(t,e,i){if(i&&i.added&&i.added.length>0){i.added.map((async t=>{e.thread.push(await kN.createChatMessage("system","added",t.displayName));e.participants[t.uid]={collectionId:t.collectionId?t.collectionId:this.getUserCollection(t),id:t.uid,displayName:t.displayName};e.users[t.uid]=["editor"]}))}if(i&&i.removed&&i.removed.length>0){i.removed.map((async t=>{e.thread.push(await kN.createChatMessage("system","removed",t.displayName));delete e.participants[t.uid];delete e.users[t.uid];delete e.participants[t.id];delete e.users[t.id]}))}this.updateChat(t,e)}getUserCollection(t){if(ht.isDecoplanner()){if(t.cards){return sz}}else if(ht.isUdive()){if(t.cards){return sz}else if(t.divingCourses){return ON}else if(t.diveSites){return iN}else{return lN}}}presentChat(t){if(window.location.pathname.includes("admin")){if(window.location.pathname.includes("divingschools")){pP.push("/admin/divingschools/"+AN.selectedDivingSchoolId+"/chat/"+t,"forward")}else if(window.location.pathname.includes("divingcenters")){pP.push("/admin/divingcenters/"+sN.selectedDivingCenterId+"/chat/"+t,"forward")}else if(window.location.pathname.includes("servicecenters")){pP.push("/admin/servicecenters/"+dN.selectedServiceCenterId+"/chat/"+t,"forward")}}else{pP.push("/chat/"+t,"forward")}}async sendChatMessage(t,e,i){e.thread.push(await kN.createChatMessage(this.chatUser.id,this.chatUser.displayName,i));this.updateChat(t,e)}async createChatMessage(t,e,i){const n=await ZR();return{content:i,created:Math.floor(n.getTime()/1e3).toString(),senderId:t,senderName:e}}async updateChat(t,e){const i=await ZR();e.date=Math.floor(i.getTime()/1e3).toString();$L.updateDocument(fz,t,e)}async deleteChat(t){const e=await pt.create({header:aP.getTransl("delete-chat-header","Delete Chat?"),message:aP.getTransl("delete-chat-message","This chat will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{kN.setEditingChat(t);$L.deleteDocument(fz,t)}}]});e.present()}}const kN=new SN;class IN{constructor(t){this.name="";this.surname="";this.displayName="Guest";if(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t&&t.position){this.position=$.setPosition(t.position)}}else{this[e]=t[e]}}));this.setDisplayName()}}setDisplayName(){if(this.name!=""&&this.surname!=""){this.displayName=this.name+" "+this.surname}else if(this.displayName!=""){this.name=this.displayName.split(" ")[0];this.surname=this.displayName.split(" ")[1]?this.displayName.split(" ")[1]:""}}}class CN{constructor(t){this.userConfigurations=[];this.localPlans=[];this.userTanks=[];this.uid=t?t.uid:null;this.settings={language:t&&t.settings&&t.settings.language?t.settings.language:"en",units:t&&t.settings&&t.settings.units?t.settings.units:"Metric"};gP.setMetric(this.settings.units==="Metric");var e=t&&t.userConfigurations?t.userConfigurations:UP.getStdConfigurations();e.forEach((t=>{this.userConfigurations.push(new GP(t))}));if(t&&t.localPlans&&t.localPlans.length>0){t.localPlans.forEach((t=>{const e=new HP(t);this.localPlans.push(e)}))}else{this.localPlans=UP.getDivePlansFromConfigurations(e)}if(t&&t.userTanks&&t.userTanks.length>0){t.userTanks.forEach((t=>{const e=new AP(t);this.userTanks.push(e)}))}else{this.userTanks=UP.getStdTanks()}this.chatsLastRead=t&&t.chatsLastRead?t.chatsLastRead:null}getLanguage(){return this.settings.language}setLanguage(t){this.settings.language=t}}class jN{constructor(t){this.pro=t&&t.pro?true:false;this.reb=t&&(t.reb||t.tech1||t.tech2)?true:false;this.tables=t&&t.tables?true:true;this.trimix=t&&(t.trimix||t.rec2||t.rec3||t.tech1||t.tech2)?true:false;this.configs=t&&t.configs?true:true;this.rec1=t&&t.rec1?true:false;this.rec2=t&&t.rec2?true:false;this.rec3=t&&t.rec3?true:false;this.tech1=t&&t.tech1?true:false;this.tech2=t&&t.tech2?true:false;this.unlimited=t&&t.unlimited?true:false;if(t&&t.trial){var e=new Date(t.trial);if(e.getTime()!==e.getTime()){if(t.trial.seconds){e=new Date(t.trial.seconds*1e3)}else{e=new Date}}this.trial={level:t.trial.level?t.trial.level:null,duration:t.trial.duration?dt.exports.toNumber(t.trial.duration):0,fromDate:t.trial.fromDate?new Date(t.trial.fromDate):null};this.trialDays()>0?this[t.trial.level]=true:null}else{this.trial={level:null,duration:0,fromDate:null}}}resetDP2licences(){this.pro=false;this.reb=false;this.tables=true;this.trimix=false;this.configs=true;this.rec1=false;this.rec2=false;this.rec3=false;this.tech1=false;this.tech2=false;this.unlimited=false;return this}hasLicence(t,e=true){if(!t)return false;let i=false;if(e){if(t=="trimix"){if(this.trial.level=="rec2"||this.trial.level=="rec3"||this.trial.level=="tech1"||this.trial.level=="tech2"){t=this.trial.level}}else if(t=="reb"){if(this.trial.level=="tech1"||this.trial.level=="tech2"){t=this.trial.level}}i=this[t]||this.pro||this.unlimited||(this.trial.level==="unlimited"||this.trial.level==="pro"||this.trial.level===t)&&this.trialDays()>0}else{i=this[t]||this.pro||this.unlimited}if(ht.isDev()){i=true}return i}trialDays(){if(this.trial.fromDate){const t=Vl.addDays(this.trial.fromDate,this.trial.duration);const e=Vl.differenceInDays(t,new Date);return dt.exports.round(e)}else{return 0}}check(t){let e=true;let i;if(!this.hasLicence(t)){e=false;switch(t){case"trimix":i=aP.getTransl("licence-trimix-alert","You need the 'REC2', 'REC3', 'TECH1' or 'TECH2' licence to use He mixes.");break;case"tables":i=aP.getTransl("licence-tables-alert","You need the 'TABLES' licence to view and download the decompression tables.");break;case"configs":i=aP.getTransl("licence-configurations-alert","You need the 'CONFIGURATIONS' licence to add, delete or edit a dive configuration.");break;case"reb":i=aP.getTransl("licence-reb-alert","You need the 'TECH1' or 'TECH2' licence to plan a rebreather dive.");break;case"rec1":i=aP.getTransl("licence-reb-alert","You need the 'REC1' licence to plan this dive.");break;case"rec2":i=aP.getTransl("licence-reb-alert","You need the 'REC2' licence to plan this dive.");break;case"rec3":i=aP.getTransl("licence-reb-alert","You need the 'REC3' licence to plan this dive.");break;case"tech1":i=aP.getTransl("licence-reb-alert","You need the 'TECH1' licence to plan this dive.");break;case"tech2":i=aP.getTransl("licence-reb-alert","You need the 'TECH2' licence to plan this dive.");break}}const n={hasLicence:e,message:i};return n}getLicenceLimitations(t){let e=21;let i=21;let n=21;let s=21;let r=0;let o=gP.isMetric()?15:50;let a=0;let h=5;switch(t){case"rec1":e=21;i=32;n=32;s=32;r=0;o=gP.isMetric()?21:70;a=0;h=5;break;case"rec2":e=21;i=32;n=32;s=32;r=30;o=gP.isMetric()?30:100;a=0;h=15;break;case"rec3":e=21;i=40;n=32;s=50;r=35;o=gP.isMetric()?39:130;a=1;h=30;break;case"tech1":e=18;i=40;n=21;s=50;r=45;o=gP.isMetric()?60:200;a=1;h=45;break;case"tech2":e=12;i=40;n=18;s=100;r=65;o=gP.isMetric()?90:300;a=3;h=90;break;case"unlimited":e=5;i=100;n=10;s=100;r=99;o=gP.isMetric()?300:1e3;a=10;h=1e5}const c={minO2:e,maxO2:i,minDecoO2:n,maxDecoO2:s,maxHe:r,maxDepth:o,maxDecoGases:a,maxDecoTime:h};return c}getUserLimitations(){if(this.hasLicence("unlimited")||this.hasLicence("pro")){return this.getLicenceLimitations("unlimited")}else if(this.hasLicence("tech2")){return this.getLicenceLimitations("tech2")}else if(this.hasLicence("tech1")){return this.getLicenceLimitations("tech1")}else if(this.hasLicence("rec3")){return this.getLicenceLimitations("rec3")}else if(this.hasLicence("rec2")){return this.getLicenceLimitations("rec2")}else if(this.hasLicence("rec1")){return this.getLicenceLimitations("rec1")}else{return this.getLicenceLimitations("nolicence")}}checkGasLimitations(t,e){const i=this.getUserLimitations();if(e){if(t.O2>i.maxDecoO2||t.O2<i.minDecoO2||t.He>i.maxHe){return false}else{return true}}else{if(t.O2>i.maxO2||t.O2<i.minO2||t.He>i.maxHe){return false}else{return true}}}checkDepthLimitations(){const t=this.getUserLimitations();return t.maxDepth}checkUserlicencesForConfigs(t){let e=[];let i=[];if(!this.check("reb")){t.forEach((t=>{if(t.parameters.configuration=="OC"){e.push(t)}}))}else{e=t}if(!this.check("trimix")){e.forEach((t=>{let e=t.configuration.bottom.map((t=>{t.gas.setFHe(0);return t}));let n=t.configuration.deco.map((t=>{t.gas.setFHe(0);return t}));t.configuration.bottom=e;t.configuration.deco=n;i.push(t)}))}else{i=e}return i}async presentLicenceLimitation(t){let e=aP.getTransl("licence-limitation","Licence limitation");let i=aP.getTransl("licence-limitation-message","You need a higher licence");if(t==="decogases"){i=aP.getTransl("licence-limitation-message-decogases","You need a higher licence to add more deco gases")}else if(t==="decotime"){i=aP.getTransl("licence-limitation-message-decotime","The calculated deco time exceeds your actual licence level. Please change the dive parameters or upgrade your licence.")}const n=await pt.create({header:e,message:i,buttons:[{text:aP.getTransl("ok","OK")}]});n.present()}}class DN{constructor(t){this.roles=[];this.licences=new jN;if(t&&t.uid){this.uid=t.uid;this.email=t.email;this.roles=t.roles?t.roles:["guest"];this.editorOf={};if(t.editorOf){Object.keys(t.editorOf).forEach((e=>{this.editorOf[e]=t.editorOf[e]}))}if(t.licences){this.licences=new jN(t.licences)}}}resetDP2licences(){this.licences.resetDP2licences()}purchaseLicence(t){this.licences[t]=true}isSuperAdmin(){return this.roles.indexOf("superAdmin")!=-1}isAdmin(){return this.roles.indexOf("Admin")!=-1||this.isSuperAdmin()}isUserAdmin(){return this.roles.indexOf("userAdmin")!=-1||this.isSuperAdmin()}isEditor(){return this.roles.indexOf("editor")!=-1||this.isSuperAdmin()||this.isUserAdmin()}isTranslator(){return this.roles.indexOf("translator")!=-1||this.isSuperAdmin()}isAgencyAdmin(){return this.roles.indexOf("gue-admin")!=-1||this.isSuperAdmin()}isRegistered(){return this.roles.indexOf("registered")!=-1}isGuest(){return this.roles.indexOf("guest")!=-1}isImmerseaAdmin(){return this.roles.indexOf("immersea-admin")!=-1||this.isSuperAdmin()}hasLicence(t,e=true){return this.licences.hasLicence(t,e)}check(t){return this.licences.check(t)}checkUserlicencesForConfigs(t){return this.licences.checkUserlicencesForConfigs(t)}}class RN{constructor(t){if(t){Object.keys(t).forEach((e=>{let i=t[e];if(i&&i.dives){let t=[];i.dives.forEach((e=>{let i=[];e.profilePoints.forEach((t=>{i.push(new yP(t.index,t.depth,t.time,new wP(t.gas.fO2,t.gas.fHe,t.gas.fromDepth,t.gas.ppO2,t.gas.units),t.setpoint))}));t.push({date:new Date(e.date),diveSiteId:e.diveSiteId,profilePoints:i})}));this[e]={configuration:i.configuration,dives:t}}}))}}}class PN{constructor(t){Object.keys(t).forEach((e=>{if(e=="position"){this.position=null;if(t.position)this.position=$.setPosition(t.position)}else{this[e]=t[e]}}))}}class NN{constructor(t){this.cards=[];if(t){this.uid=t.uid;this.email=t.email;this.displayName=t.displayName;this.photoURL=t.photoURL;this.coverURL=t.coverURL;this.address=t.address;this.position=null;if(t&&t.position){if(t.position)this.position=$.setPosition(t.position)}else if(this.address&&this.address.lat&&this.address.lon){this.position=$.getPosition(this.address.lat,this.address.lon)}this.phoneNumber=t.phoneNumber;this.facebook=t.facebook;this.instagram=t.instagram;this.twitter=t.twitter;this.website=t.website;this.bio=t.bio;if(t.cards&&t.cards.length>0&&t.cards[0].agencyId){this.cards=t.cards}}}}var FN;(function(t){t["IndexedDbLocal"]="INDEXED_DB_LOCAL";t["InMemory"]="IN_MEMORY";t["BrowserLocal"]="BROWSER_LOCAL";t["BrowserSession"]="BROWSER_SESSION"})(FN||(FN={}));var zN;(function(t){t["APPLE"]="apple.com";t["FACEBOOK"]="facebook.com";t["GAME_CENTER"]="gc.apple.com";t["GITHUB"]="github.com";t["GOOGLE"]="google.com";t["MICROSOFT"]="microsoft.com";t["PLAY_GAMES"]="playgames.google.com";t["TWITTER"]="twitter.com";t["YAHOO"]="yahoo.com";t["PASSWORD"]="password";t["PHONE"]="phone"})(zN||(zN={}));const LN=ft("FirebaseAuthentication",{web:()=>import("./p-49470b83.js").then((t=>new t.FirebaseAuthenticationWeb))});class $N{constructor(){this.authenticating=false;this.loginStarted=false;this.showDashboard=false;this.showUserSettings=false;this.actionCodeSettings={url:ht.getSiteUrl(),handleCodeInApp:true,iOS:{bundleId:ht.getBundleId()},android:{packageName:ht.getBundleId(),installApp:true,minimumVersion:"12"},dynamicLinkDomain:ht.getDynamicLinkDomain()}}init(){Eo($l,(t=>{if(!t){ht.log("onAuthStateChanged logout",[t]);mz.getUserInfo(t)}}));mz.userProfile$.subscribe((t=>{this.userProfile=t}));mz.userRoles$.subscribe((t=>{if(t&&t.uid){this.userRoles=new DN(t)}else{this.userRoles=null}}));mz.userSettings$.subscribe((t=>{if(t&&t.uid){this.userSettings=new CN(t)}else{this.userSettings=null}}))}async sendEmailLink(t){await this.presentLoader();$L.saveLocalDocument("emailForSignIn",t);return new Promise(((e,i)=>{no($l,t,this.actionCodeSettings).then((()=>{this.dismissLoading();e(true)}),(t=>{this.dismissLoading();i(t)}))}))}async verifyEmailLink(t){const e=so($l,t);if(e){let e=await $L.getLocalDocument("emailForSignIn");if(!e){e=window.prompt("Please provide your email for confirmation")}let i;if(ct.isNativePlatform()){const t=Er.credentialWithLink(e,ht.getDynamicLinkDomain());i=await Wr($l,t)}else{i=await ro($l,e,t)}if(history&&history.replaceState){history.replaceState({},document.title,t.split("?")[0])}$L.deleteLocalDocument("emailForSignIn");return this.providerHandler(i)}return null}async fetchSignInMethodsForEmail(t){return ao($l,t)}async passwordReset(t){return Kr($l,t)}async signInWithEmailPsw(t,e){const i=await this.fetchSignInMethodsForEmail(t);if(i.indexOf(Er.EMAIL_PASSWORD_SIGN_IN_METHOD)!=-1){await this.presentLoader();$L.deleteLocalDocument("emailForSignIn");const i=await io($l,t,e);return this.providerHandler({user:i.user,additionalUserInfo:xo(i)})}else if(i.indexOf(Er.EMAIL_LINK_SIGN_IN_METHOD)!=-1){return this.sendEmailLink(t)}else if(i.indexOf(Cr.GOOGLE_SIGN_IN_METHOD)!=-1){return this.google()}else if(i.length==0){await this.presentLoader();var n;if(e){if(ct.isNativePlatform()){n=await LN.createUserWithEmailAndPassword({email:t,password:e});const i=Er.credential(t,e);await Wr($l,i);$L.deleteLocalDocument("emailForSignIn");n.additionalUserInfo={isNewUser:true};return this.providerHandler(n)}else{n=await eo($l,t,e);$L.deleteLocalDocument("emailForSignIn");return this.providerHandler({user:n.user,additionalUserInfo:xo(n)})}}else{n=await this.sendEmailLink(t);return this.providerHandler(n)}}else{throw"Error"}}sendEmailVerification(){ho($l.currentUser,this.actionCodeSettings)}isElectron(){return ct.getPlatform()=="electron"}async google(){var t;await this.presentLoader();console.log("google",this.isElectron(),$l,ct.isNativePlatform());if(this.isElectron()){const t=new Cr;const e=await Fa($l,t);return this.providerHandler(e)}else{const e=await LN.signInWithGoogle();if(ct.isNativePlatform()){const i=Cr.credential((t=e.credential)===null||t===void 0?void 0:t.idToken);const n=await Wr($l,i);return this.providerHandler(n)}else{return this.providerHandler(e)}}}async apple(){var t,e;await this.presentLoader();if(this.isElectron()||ct.getPlatform()=="android"){const t=new kr("apple.com");const e=await Fa($l,t);return this.providerHandler(e)}else{const i=await LN.signInWithApple({skipNativeAuth:true});if(ct.isNativePlatform()){const n=new kr("apple.com");const s=n.credential({idToken:(t=i.credential)===null||t===void 0?void 0:t.idToken,rawNonce:(e=i.credential)===null||e===void 0?void 0:e.nonce});const r=await Wr($l,s);return this.providerHandler(r)}else{return this.providerHandler(i)}}}async providerHandler(t){return new Promise((async e=>{this.loginStarted=true;if(t&&t.additionalUserInfo&&t.additionalUserInfo.isNewUser){this.showUserSettings=true}else{this.showDashboard=true}mz.numberOfTries=0;await mz.getUserInfo(t.user);e(true)}))}async presentLoader(){let t=await vt.getTop();if(!t){let t=aP.getTransl("logging-in","Logging in")+"...";this.loading=await vt.create({message:t});await this.loading.present()}}dismissLoading(){if(this.loading)this.loading.dismiss()}async deleteUser(){const t=await pt.create({header:aP.getTransl("delete-account","Delete Account"),message:aP.getTransl("delete-account-are-you-sure","This procedure will delete your account and all data stored in our database associated to it! Are sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>null},{text:aP.getTransl("ok","OK"),handler:async()=>{const t=await pt.create({header:aP.getTransl("delete-account","Delete Account"),message:aP.getTransl("delete-account-confirm","Your account will be deleted! Are really sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>null},{text:aP.getTransl("ok","OK"),handler:async()=>{const t=$l.currentUser;try{await ko(t);this.signOut();HL.presentAlert("Account delete","Account succesfully deleted!")}catch(t){HL.presentAlert("Account delete","To delete the account we need you to logout and login again. Then you can follow again this procedure. ("+t+")").then((()=>{this.signOut()}))}}}]});t.present()}}]});t.present()}async logout(){const t=await pt.create({header:aP.getTransl("logout","Logout"),message:aP.getTransl("logout-are-you-sure","Are you sure you want to logout?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>null},{text:aP.getTransl("ok","OK"),handler:()=>this.signOut()}]});t.present()}async signOut(){$L.clearLocalDocuments();await LN.signOut();pP.goHome();return Ao($l)}}const UN=new $N;var BN={exports:{}};(function(t,e){(function(e,i){t.exports=i()})(yt,(function(){var t,e,i;function n(n,s){if(!t){t=s}else if(!e){e=s}else{var r="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;";var o={};t(o);i=s(o);if(typeof window!=="undefined"&&window&&window.URL&&window.URL.createObjectURL){i.workerUrl=window.URL.createObjectURL(new Blob([r],{type:"text/javascript"}))}}}n(["exports"],(function(t){var e="3.6.0";let i;const n={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){i=t}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!n.API_URL)return null;try{const t=new URL(n.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch(t){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function s(t){return n.API_URL_REGEX.test(t)}function r(t){return 0===t.indexOf("mapbox:")}function o(t){return n.API_CDN_URL_REGEX.test(t)}function a(t){return n.API_SPRITE_REGEX.test(t)}function h(t){return n.API_STYLE_REGEX.test(t)&&!a(t)}const c={create:"create",load:"load",fullLoad:"fullLoad"},u={mark(t){performance.mark(t)},measure(t,e,i){performance.measure(t,e,i)}};function l(t){const e=t.name.split("?")[0];return o(e)&&e.includes("mapbox-gl.js")?"javascript":o(e)&&e.includes("mapbox-gl.css")?"css":function(t){return n.API_FONTS_REGEX.test(t)}(e)?"fontRange":a(e)?"sprite":h(e)?"style":function(t){return n.API_TILEJSON_REGEX.test(t)}(e)?"tilejson":"other"}function f(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d={},p={};Object.defineProperty(p,"__esModule",{value:!0}),p.setMatrixArrayType=function(t){p.ARRAY_TYPE=_=t},p.toRadian=function(t){return t*g},p.equals=function(t,e){return Math.abs(t-e)<=m*Math.max(1,Math.abs(t),Math.abs(e))},p.RANDOM=p.ARRAY_TYPE=p.EPSILON=void 0;var m=1e-6;p.EPSILON=m;var _="undefined"!=typeof Float32Array?Float32Array:Array;p.ARRAY_TYPE=_;var v=Math.random;p.RANDOM=v;var g=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var b={};function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}Object.defineProperty(b,"__esModule",{value:!0}),b.create=function(){var t=new y.ARRAY_TYPE(4);return y.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},b.clone=function(t){var e=new y.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},b.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},b.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},b.fromValues=function(t,e,i,n){var s=new y.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s},b.set=function(t,e,i,n,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t},b.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},b.invert=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i*r-s*n;return o?(t[0]=r*(o=1/o),t[1]=-n*o,t[2]=-s*o,t[3]=i*o,t):null},b.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},b.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},b.multiply=M,b.rotate=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+r*a,t[1]=s*h+o*a,t[2]=n*-a+r*h,t[3]=s*-a+o*h,t},b.scale=function(t,e,i){var n=e[1],s=e[2],r=e[3],o=i[0],a=i[1];return t[0]=e[0]*o,t[1]=n*o,t[2]=s*a,t[3]=r*a,t},b.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},b.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},b.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},b.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},b.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},b.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},b.subtract=T,b.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},b.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=e[0],a=e[1],h=e[2],c=e[3];return Math.abs(i-o)<=y.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=y.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-h)<=y.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(r-c)<=y.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))},b.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},b.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},b.sub=b.mul=void 0;var y=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==w(t)&&"function"!=typeof t)return{default:t};var i=x(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function x(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(x=function(t){return t?i:e})(t)}function M(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=i[0],h=i[1],c=i[2],u=i[3];return t[0]=n*a+r*h,t[1]=s*a+o*h,t[2]=n*c+r*u,t[3]=s*c+o*u,t}function T(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}b.mul=M,b.sub=T;var O={};function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}Object.defineProperty(O,"__esModule",{value:!0}),O.create=function(){var t=new A.ARRAY_TYPE(6);return A.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},O.clone=function(t){var e=new A.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},O.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},O.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},O.fromValues=function(t,e,i,n,s,r){var o=new A.ARRAY_TYPE(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=s,o[5]=r,o},O.set=function(t,e,i,n,s,r,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t[4]=r,t[5]=o,t},O.invert=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=i*r-n*s;return h?(t[0]=r*(h=1/h),t[1]=-n*h,t[2]=-s*h,t[3]=i*h,t[4]=(s*a-r*o)*h,t[5]=(n*o-i*a)*h,t):null},O.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},O.multiply=k,O.rotate=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=n*u+r*c,t[1]=s*u+o*c,t[2]=n*-c+r*u,t[3]=s*-c+o*u,t[4]=a,t[5]=h,t},O.scale=function(t,e,i){var n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=i[0],c=i[1];return t[0]=e[0]*h,t[1]=n*h,t[2]=s*c,t[3]=r*c,t[4]=o,t[5]=a,t},O.translate=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=i[0],u=i[1];return t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=n*c+r*u+a,t[5]=s*c+o*u+h,t},O.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},O.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},O.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},O.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},O.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},O.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},O.subtract=I,O.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},O.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},O.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},O.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],h=e[0],c=e[1],u=e[2],l=e[3],f=e[4],d=e[5];return Math.abs(i-h)<=A.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=A.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-u)<=A.EPSILON*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(r-l)<=A.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(o-f)<=A.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-d)<=A.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))},O.sub=O.mul=void 0;var A=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==E(t)&&"function"!=typeof t)return{default:t};var i=S(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function S(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(S=function(t){return t?i:e})(t)}function k(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=i[0],u=i[1],l=i[2],f=i[3],d=i[4],p=i[5];return t[0]=n*c+r*u,t[1]=s*c+o*u,t[2]=n*l+r*f,t[3]=s*l+o*f,t[4]=n*d+r*p+a,t[5]=s*d+o*p+h,t}function I(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}O.mul=k,O.sub=I;var C={};function j(t){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j(t)}Object.defineProperty(C,"__esModule",{value:!0}),C.create=function(){var t=new D.ARRAY_TYPE(9);return D.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},C.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},C.clone=function(t){var e=new D.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},C.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},C.fromValues=function(t,e,i,n,s,r,o,a,h){var c=new D.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=n,c[4]=s,c[5]=r,c[6]=o,c[7]=a,c[8]=h,c},C.set=function(t,e,i,n,s,r,o,a,h,c){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t[4]=r,t[5]=o,t[6]=a,t[7]=h,t[8]=c,t},C.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},C.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},C.invert=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],u=e[8],l=u*o-a*c,f=-u*r+a*h,d=c*r-o*h,p=i*l+n*f+s*d;return p?(t[0]=l*(p=1/p),t[1]=(-u*n+s*c)*p,t[2]=(a*n-s*o)*p,t[3]=f*p,t[4]=(u*i-s*h)*p,t[5]=(-a*i+s*r)*p,t[6]=d*p,t[7]=(-c*i+n*h)*p,t[8]=(o*i-n*r)*p,t):null},C.adjoint=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=s*c-n*u,t[2]=n*a-s*o,t[3]=a*h-r*u,t[4]=i*u-s*h,t[5]=s*r-i*a,t[6]=r*c-o*h,t[7]=n*h-i*c,t[8]=i*o-n*r,t},C.determinant=function(t){var e=t[3],i=t[4],n=t[5],s=t[6],r=t[7],o=t[8];return t[0]*(o*i-n*r)+t[1]*(-o*e+n*s)+t[2]*(r*e-i*s)},C.multiply=P,C.translate=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=e[8],f=i[0],d=i[1];return t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=h,t[6]=f*n+d*o+c,t[7]=f*s+d*a+u,t[8]=f*r+d*h+l,t},C.rotate=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=e[8],f=Math.sin(i),d=Math.cos(i);return t[0]=d*n+f*o,t[1]=d*s+f*a,t[2]=d*r+f*h,t[3]=d*o-f*n,t[4]=d*a-f*s,t[5]=d*h-f*r,t[6]=c,t[7]=u,t[8]=l,t},C.scale=function(t,e,i){var n=i[0],s=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},C.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},C.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},C.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},C.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},C.fromQuat=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i+i,a=n+n,h=s+s,c=i*o,u=n*o,l=n*a,f=s*o,d=s*a,p=s*h,m=r*o,_=r*a,v=r*h;return t[0]=1-l-p,t[3]=u-v,t[6]=f+_,t[1]=u+v,t[4]=1-c-p,t[7]=d-m,t[2]=f-_,t[5]=d+m,t[8]=1-c-l,t},C.normalFromMat4=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],u=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],_=e[14],v=e[15],g=i*a-n*o,b=i*h-s*o,w=i*c-r*o,y=n*h-s*a,x=n*c-r*a,M=s*c-r*h,T=u*m-l*p,O=u*_-f*p,E=u*v-d*p,A=l*_-f*m,S=l*v-d*m,k=f*v-d*_,I=g*k-b*S+w*A+y*E-x*O+M*T;return I?(t[0]=(a*k-h*S+c*A)*(I=1/I),t[1]=(h*E-o*k-c*O)*I,t[2]=(o*S-a*E+c*T)*I,t[3]=(s*S-n*k-r*A)*I,t[4]=(i*k-s*E+r*O)*I,t[5]=(n*E-i*S-r*T)*I,t[6]=(m*M-_*x+v*y)*I,t[7]=(_*w-p*M-v*b)*I,t[8]=(p*x-m*w+v*g)*I,t):null},C.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},C.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},C.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},C.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},C.subtract=N,C.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},C.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},C.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},C.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],h=t[6],c=t[7],u=t[8],l=e[0],f=e[1],d=e[2],p=e[3],m=e[4],_=e[5],v=e[6],g=e[7],b=e[8];return Math.abs(i-l)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-f)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-d)<=D.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(r-p)<=D.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(o-m)<=D.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-_)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(h-v)<=D.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(c-g)<=D.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-b)<=D.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))},C.sub=C.mul=void 0;var D=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==j(t)&&"function"!=typeof t)return{default:t};var i=R(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function R(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(R=function(t){return t?i:e})(t)}function P(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=e[8],f=i[0],d=i[1],p=i[2],m=i[3],_=i[4],v=i[5],g=i[6],b=i[7],w=i[8];return t[0]=f*n+d*o+p*c,t[1]=f*s+d*a+p*u,t[2]=f*r+d*h+p*l,t[3]=m*n+_*o+v*c,t[4]=m*s+_*a+v*u,t[5]=m*r+_*h+v*l,t[6]=g*n+b*o+w*c,t[7]=g*s+b*a+w*u,t[8]=g*r+b*h+w*l,t}function N(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}C.mul=P,C.sub=N;var F={};function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}Object.defineProperty(F,"__esModule",{value:!0}),F.create=function(){var t=new L.ARRAY_TYPE(16);return L.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},F.clone=function(t){var e=new L.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},F.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},F.fromValues=function(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m){var _=new L.ARRAY_TYPE(16);return _[0]=t,_[1]=e,_[2]=i,_[3]=n,_[4]=s,_[5]=r,_[6]=o,_[7]=a,_[8]=h,_[9]=c,_[10]=u,_[11]=l,_[12]=f,_[13]=d,_[14]=p,_[15]=m,_},F.set=function(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t[4]=r,t[5]=o,t[6]=a,t[7]=h,t[8]=c,t[9]=u,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=_,t},F.identity=U,F.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],s=e[3],r=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=r,t[11]=e[14],t[12]=s,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},F.invert=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],u=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],_=e[14],v=e[15],g=i*a-n*o,b=i*h-s*o,w=i*c-r*o,y=n*h-s*a,x=n*c-r*a,M=s*c-r*h,T=u*m-l*p,O=u*_-f*p,E=u*v-d*p,A=l*_-f*m,S=l*v-d*m,k=f*v-d*_,I=g*k-b*S+w*A+y*E-x*O+M*T;return I?(t[0]=(a*k-h*S+c*A)*(I=1/I),t[1]=(s*S-n*k-r*A)*I,t[2]=(m*M-_*x+v*y)*I,t[3]=(f*x-l*M-d*y)*I,t[4]=(h*E-o*k-c*O)*I,t[5]=(i*k-s*E+r*O)*I,t[6]=(_*w-p*M-v*b)*I,t[7]=(u*M-f*w+d*b)*I,t[8]=(o*S-a*E+c*T)*I,t[9]=(n*E-i*S-r*T)*I,t[10]=(p*x-m*w+v*g)*I,t[11]=(l*w-u*x-d*g)*I,t[12]=(a*O-o*A-h*T)*I,t[13]=(i*A-n*O+s*T)*I,t[14]=(m*b-p*y-_*g)*I,t[15]=(u*y-l*b+f*g)*I,t):null},F.adjoint=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],c=e[7],u=e[8],l=e[9],f=e[10],d=e[11],p=e[12],m=e[13],_=e[14],v=e[15];return t[0]=a*(f*v-d*_)-l*(h*v-c*_)+m*(h*d-c*f),t[1]=-(n*(f*v-d*_)-l*(s*v-r*_)+m*(s*d-r*f)),t[2]=n*(h*v-c*_)-a*(s*v-r*_)+m*(s*c-r*h),t[3]=-(n*(h*d-c*f)-a*(s*d-r*f)+l*(s*c-r*h)),t[4]=-(o*(f*v-d*_)-u*(h*v-c*_)+p*(h*d-c*f)),t[5]=i*(f*v-d*_)-u*(s*v-r*_)+p*(s*d-r*f),t[6]=-(i*(h*v-c*_)-o*(s*v-r*_)+p*(s*c-r*h)),t[7]=i*(h*d-c*f)-o*(s*d-r*f)+u*(s*c-r*h),t[8]=o*(l*v-d*m)-u*(a*v-c*m)+p*(a*d-c*l),t[9]=-(i*(l*v-d*m)-u*(n*v-r*m)+p*(n*d-r*l)),t[10]=i*(a*v-c*m)-o*(n*v-r*m)+p*(n*c-r*a),t[11]=-(i*(a*d-c*l)-o*(n*d-r*l)+u*(n*c-r*a)),t[12]=-(o*(l*_-f*m)-u*(a*_-h*m)+p*(a*f-h*l)),t[13]=i*(l*_-f*m)-u*(n*_-s*m)+p*(n*f-s*l),t[14]=-(i*(a*_-h*m)-o*(n*_-s*m)+p*(n*h-s*a)),t[15]=i*(a*f-h*l)-o*(n*f-s*l)+u*(n*h-s*a),t},F.determinant=function(t){var e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],u=t[9],l=t[10],f=t[11],d=t[12],p=t[13],m=t[14],_=t[15];return(e*o-i*r)*(l*_-f*m)-(e*a-n*r)*(u*_-f*p)+(e*h-s*r)*(u*m-l*p)+(i*a-n*o)*(c*_-f*d)-(i*h-s*o)*(c*m-l*d)+(n*h-s*a)*(c*p-u*d)},F.multiply=B,F.translate=function(t,e,i){var n,s,r,o,a,h,c,u,l,f,d,p,m=i[0],_=i[1],v=i[2];return e===t?(t[12]=e[0]*m+e[4]*_+e[8]*v+e[12],t[13]=e[1]*m+e[5]*_+e[9]*v+e[13],t[14]=e[2]*m+e[6]*_+e[10]*v+e[14],t[15]=e[3]*m+e[7]*_+e[11]*v+e[15]):(s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=n=e[0],t[1]=s,t[2]=r,t[3]=o,t[4]=a,t[5]=h,t[6]=c,t[7]=u,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+a*_+l*v+e[12],t[13]=s*m+h*_+f*v+e[13],t[14]=r*m+c*_+d*v+e[14],t[15]=o*m+u*_+p*v+e[15]),t},F.scale=function(t,e,i){var n=i[0],s=i[1],r=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},F.rotate=function(t,e,i,n){var s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y,x,M,T,O,E,A,S=n[0],k=n[1],I=n[2],C=Math.hypot(S,k,I);return C<L.EPSILON?null:(S*=C=1/C,k*=C,I*=C,s=Math.sin(i),r=Math.cos(i),h=e[1],c=e[2],u=e[3],f=e[5],d=e[6],p=e[7],_=e[9],v=e[10],g=e[11],b=S*S*(o=1-r)+r,x=S*k*o-I*s,M=k*k*o+r,T=I*k*o+S*s,O=S*I*o+k*s,E=k*I*o-S*s,A=I*I*o+r,t[0]=(a=e[0])*b+(l=e[4])*(w=k*S*o+I*s)+(m=e[8])*(y=I*S*o-k*s),t[1]=h*b+f*w+_*y,t[2]=c*b+d*w+v*y,t[3]=u*b+p*w+g*y,t[4]=a*x+l*M+m*T,t[5]=h*x+f*M+_*T,t[6]=c*x+d*M+v*T,t[7]=u*x+p*M+g*T,t[8]=a*O+l*E+m*A,t[9]=h*O+f*E+_*A,t[10]=c*O+d*E+v*A,t[11]=u*O+p*E+g*A,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},F.rotateX=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),r=e[4],o=e[5],a=e[6],h=e[7],c=e[8],u=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*s+c*n,t[5]=o*s+u*n,t[6]=a*s+l*n,t[7]=h*s+f*n,t[8]=c*s-r*n,t[9]=u*s-o*n,t[10]=l*s-a*n,t[11]=f*s-h*n,t},F.rotateY=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),r=e[0],o=e[1],a=e[2],h=e[3],c=e[8],u=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s-c*n,t[1]=o*s-u*n,t[2]=a*s-l*n,t[3]=h*s-f*n,t[8]=r*n+c*s,t[9]=o*n+u*s,t[10]=a*n+l*s,t[11]=h*n+f*s,t},F.rotateZ=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),r=e[0],o=e[1],a=e[2],h=e[3],c=e[4],u=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*s+c*n,t[1]=o*s+u*n,t[2]=a*s+l*n,t[3]=h*s+f*n,t[4]=c*s-r*n,t[5]=u*s-o*n,t[6]=l*s-a*n,t[7]=f*s-h*n,t},F.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},F.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},F.fromRotation=function(t,e,i){var n,s,r,o=i[0],a=i[1],h=i[2],c=Math.hypot(o,a,h);return c<L.EPSILON?null:(o*=c=1/c,a*=c,h*=c,n=Math.sin(e),s=Math.cos(e),t[0]=o*o*(r=1-s)+s,t[1]=a*o*r+h*n,t[2]=h*o*r-a*n,t[3]=0,t[4]=o*a*r-h*n,t[5]=a*a*r+s,t[6]=h*a*r+o*n,t[7]=0,t[8]=o*h*r+a*n,t[9]=a*h*r-o*n,t[10]=h*h*r+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},F.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},F.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},F.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},F.fromRotationTranslation=G,F.fromQuat2=function(t,e){var i=new L.ARRAY_TYPE(3),n=-e[0],s=-e[1],r=-e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=n*n+s*s+r*r+o*o;return l>0?(i[0]=2*(a*o+u*n+h*r-c*s)/l,i[1]=2*(h*o+u*s+c*n-a*r)/l,i[2]=2*(c*o+u*r+a*s-h*n)/l):(i[0]=2*(a*o+u*n+h*r-c*s),i[1]=2*(h*o+u*s+c*n-a*r),i[2]=2*(c*o+u*r+a*s-h*n)),G(t,e,i),t},F.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},F.getScaling=H,F.getRotation=function(t,e){var i=new L.ARRAY_TYPE(3);H(i,e);var n=1/i[0],s=1/i[1],r=1/i[2],o=e[0]*n,a=e[1]*s,h=e[2]*r,c=e[4]*n,u=e[5]*s,l=e[6]*r,f=e[8]*n,d=e[9]*s,p=e[10]*r,m=o+u+p,_=0;return m>0?(_=2*Math.sqrt(m+1),t[3]=.25*_,t[0]=(l-d)/_,t[1]=(f-h)/_,t[2]=(a-c)/_):o>u&&o>p?(_=2*Math.sqrt(1+o-u-p),t[3]=(l-d)/_,t[0]=.25*_,t[1]=(a+c)/_,t[2]=(f+h)/_):u>p?(_=2*Math.sqrt(1+u-o-p),t[3]=(f-h)/_,t[0]=(a+c)/_,t[1]=.25*_,t[2]=(l+d)/_):(_=2*Math.sqrt(1+p-o-u),t[3]=(a-c)/_,t[0]=(f+h)/_,t[1]=(l+d)/_,t[2]=.25*_),t},F.fromRotationTranslationScale=function(t,e,i,n){var s=e[0],r=e[1],o=e[2],a=e[3],h=s+s,c=r+r,u=o+o,l=s*h,f=s*c,d=s*u,p=r*c,m=r*u,_=o*u,v=a*h,g=a*c,b=a*u,w=n[0],y=n[1],x=n[2];return t[0]=(1-(p+_))*w,t[1]=(f+b)*w,t[2]=(d-g)*w,t[3]=0,t[4]=(f-b)*y,t[5]=(1-(l+_))*y,t[6]=(m+v)*y,t[7]=0,t[8]=(d+g)*x,t[9]=(m-v)*x,t[10]=(1-(l+p))*x,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},F.fromRotationTranslationScaleOrigin=function(t,e,i,n,s){var r=e[0],o=e[1],a=e[2],h=e[3],c=r+r,u=o+o,l=a+a,f=r*c,d=r*u,p=r*l,m=o*u,_=o*l,v=a*l,g=h*c,b=h*u,w=h*l,y=n[0],x=n[1],M=n[2],T=s[0],O=s[1],E=s[2],A=(1-(m+v))*y,S=(d+w)*y,k=(p-b)*y,I=(d-w)*x,C=(1-(f+v))*x,j=(_+g)*x,D=(p+b)*M,R=(_-g)*M,P=(1-(f+m))*M;return t[0]=A,t[1]=S,t[2]=k,t[3]=0,t[4]=I,t[5]=C,t[6]=j,t[7]=0,t[8]=D,t[9]=R,t[10]=P,t[11]=0,t[12]=i[0]+T-(A*T+I*O+D*E),t[13]=i[1]+O-(S*T+C*O+R*E),t[14]=i[2]+E-(k*T+j*O+P*E),t[15]=1,t},F.fromQuat=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i+i,a=n+n,h=s+s,c=i*o,u=n*o,l=n*a,f=s*o,d=s*a,p=s*h,m=r*o,_=r*a,v=r*h;return t[0]=1-l-p,t[1]=u+v,t[2]=f-_,t[3]=0,t[4]=u-v,t[5]=1-c-p,t[6]=d+m,t[7]=0,t[8]=f+_,t[9]=d-m,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},F.frustum=function(t,e,i,n,s,r,o){var a=1/(i-e),h=1/(s-n),c=1/(r-o);return t[0]=2*r*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+n)*h,t[10]=(o+r)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*r*2*c,t[15]=0,t},F.perspectiveNO=V,F.perspectiveZO=function(t,e,i,n,s){var r,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(t[10]=s*(r=1/(n-s)),t[14]=s*n*r):(t[10]=-1,t[14]=-n),t},F.perspectiveFromFieldOfView=function(t,e,i,n){var s=Math.tan(e.upDegrees*Math.PI/180),r=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),h=2/(o+a),c=2/(s+r);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*h*.5,t[9]=(s-r)*c*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},F.orthoNO=W,F.orthoZO=function(t,e,i,n,s,r,o){var a=1/(e-i),h=1/(n-s),c=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*h,t[14]=r*c,t[15]=1,t},F.lookAt=function(t,e,i,n){var s,r,o,a,h,c,u,l,f,d,p=e[0],m=e[1],_=e[2],v=n[0],g=n[1],b=n[2],w=i[0],y=i[1],x=i[2];return Math.abs(p-w)<L.EPSILON&&Math.abs(m-y)<L.EPSILON&&Math.abs(_-x)<L.EPSILON?U(t):(u=p-w,l=m-y,f=_-x,s=g*(f*=d=1/Math.hypot(u,l,f))-b*(l*=d),r=b*(u*=d)-v*f,o=v*l-g*u,(d=Math.hypot(s,r,o))?(s*=d=1/d,r*=d,o*=d):(s=0,r=0,o=0),a=l*o-f*r,h=f*s-u*o,c=u*r-l*s,(d=Math.hypot(a,h,c))?(a*=d=1/d,h*=d,c*=d):(a=0,h=0,c=0),t[0]=s,t[1]=a,t[2]=u,t[3]=0,t[4]=r,t[5]=h,t[6]=l,t[7]=0,t[8]=o,t[9]=c,t[10]=f,t[11]=0,t[12]=-(s*p+r*m+o*_),t[13]=-(a*p+h*m+c*_),t[14]=-(u*p+l*m+f*_),t[15]=1,t)},F.targetTo=function(t,e,i,n){var s=e[0],r=e[1],o=e[2],a=n[0],h=n[1],c=n[2],u=s-i[0],l=r-i[1],f=o-i[2],d=u*u+l*l+f*f;d>0&&(u*=d=1/Math.sqrt(d),l*=d,f*=d);var p=h*f-c*l,m=c*u-a*f,_=a*l-h*u;return(d=p*p+m*m+_*_)>0&&(p*=d=1/Math.sqrt(d),m*=d,_*=d),t[0]=p,t[1]=m,t[2]=_,t[3]=0,t[4]=l*_-f*m,t[5]=f*p-u*_,t[6]=u*m-l*p,t[7]=0,t[8]=u,t[9]=l,t[10]=f,t[11]=0,t[12]=s,t[13]=r,t[14]=o,t[15]=1,t},F.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},F.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},F.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},F.subtract=q,F.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},F.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},F.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},F.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],h=t[6],c=t[7],u=t[8],l=t[9],f=t[10],d=t[11],p=t[12],m=t[13],_=t[14],v=t[15],g=e[0],b=e[1],w=e[2],y=e[3],x=e[4],M=e[5],T=e[6],O=e[7],E=e[8],A=e[9],S=e[10],k=e[11],I=e[12],C=e[13],j=e[14],D=e[15];return Math.abs(i-g)<=L.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(n-b)<=L.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(s-w)<=L.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(r-y)<=L.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(o-x)<=L.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-M)<=L.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(h-T)<=L.EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(c-O)<=L.EPSILON*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(u-E)<=L.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(l-A)<=L.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(f-S)<=L.EPSILON*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(d-k)<=L.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(p-I)<=L.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(m-C)<=L.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(_-j)<=L.EPSILON*Math.max(1,Math.abs(_),Math.abs(j))&&Math.abs(v-D)<=L.EPSILON*Math.max(1,Math.abs(v),Math.abs(D))},F.sub=F.mul=F.ortho=F.perspective=void 0;var L=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==z(t)&&"function"!=typeof t)return{default:t};var i=$(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function $(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return($=function(t){return t?i:e})(t)}function U(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=e[8],f=e[9],d=e[10],p=e[11],m=e[12],_=e[13],v=e[14],g=e[15],b=i[0],w=i[1],y=i[2],x=i[3];return t[0]=b*n+w*a+y*l+x*m,t[1]=b*s+w*h+y*f+x*_,t[2]=b*r+w*c+y*d+x*v,t[3]=b*o+w*u+y*p+x*g,t[4]=(b=i[4])*n+(w=i[5])*a+(y=i[6])*l+(x=i[7])*m,t[5]=b*s+w*h+y*f+x*_,t[6]=b*r+w*c+y*d+x*v,t[7]=b*o+w*u+y*p+x*g,t[8]=(b=i[8])*n+(w=i[9])*a+(y=i[10])*l+(x=i[11])*m,t[9]=b*s+w*h+y*f+x*_,t[10]=b*r+w*c+y*d+x*v,t[11]=b*o+w*u+y*p+x*g,t[12]=(b=i[12])*n+(w=i[13])*a+(y=i[14])*l+(x=i[15])*m,t[13]=b*s+w*h+y*f+x*_,t[14]=b*r+w*c+y*d+x*v,t[15]=b*o+w*u+y*p+x*g,t}function G(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=n+n,h=s+s,c=r+r,u=n*a,l=n*h,f=n*c,d=s*h,p=s*c,m=r*c,_=o*a,v=o*h,g=o*c;return t[0]=1-(d+m),t[1]=l+g,t[2]=f-v,t[3]=0,t[4]=l-g,t[5]=1-(u+m),t[6]=p+_,t[7]=0,t[8]=f+v,t[9]=p-_,t[10]=1-(u+d),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function H(t,e){var i=e[4],n=e[5],s=e[6],r=e[8],o=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,n,s),t[2]=Math.hypot(r,o,a),t}function V(t,e,i,n,s){var r,o=1/Math.tan(e/2);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(t[10]=(s+n)*(r=1/(n-s)),t[14]=2*s*n*r):(t[10]=-1,t[14]=-2*n),t}function W(t,e,i,n,s,r,o){var a=1/(e-i),h=1/(n-s),c=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*h,t[14]=(o+r)*c,t[15]=1,t}function q(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}F.perspective=V,F.ortho=W,F.mul=B,F.sub=q;var Y={},X={};function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}Object.defineProperty(X,"__esModule",{value:!0}),X.create=Q,X.clone=function(t){var e=new J.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},X.length=tt,X.fromValues=function(t,e,i){var n=new J.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},X.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},X.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},X.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},X.subtract=et,X.multiply=it,X.divide=nt,X.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},X.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},X.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},X.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},X.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},X.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},X.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},X.distance=st,X.squaredDistance=rt,X.squaredLength=ot,X.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},X.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},X.normalize=function(t,e){var i=e[0],n=e[1],s=e[2],r=i*i+n*n+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},X.dot=at,X.cross=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],h=i[2];return t[0]=s*h-r*a,t[1]=r*o-n*h,t[2]=n*a-s*o,t},X.lerp=function(t,e,i,n){var s=e[0],r=e[1],o=e[2];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t[2]=o+n*(i[2]-o),t},X.hermite=function(t,e,i,n,s,r){var o=r*r,a=o*(2*r-3)+1,h=o*(r-2)+r,c=o*(r-1),u=o*(3-2*r);return t[0]=e[0]*a+i[0]*h+n[0]*c+s[0]*u,t[1]=e[1]*a+i[1]*h+n[1]*c+s[1]*u,t[2]=e[2]*a+i[2]*h+n[2]*c+s[2]*u,t},X.bezier=function(t,e,i,n,s,r){var o=1-r,a=o*o,h=r*r,c=a*o,u=3*r*a,l=3*h*o,f=h*r;return t[0]=e[0]*c+i[0]*u+n[0]*l+s[0]*f,t[1]=e[1]*c+i[1]*u+n[1]*l+s[1]*f,t[2]=e[2]*c+i[2]*u+n[2]*l+s[2]*f,t},X.random=function(t,e){e=e||1;var i=2*J.RANDOM()*Math.PI,n=2*J.RANDOM()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t},X.transformMat4=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=i[3]*n+i[7]*s+i[11]*r+i[15];return t[0]=(i[0]*n+i[4]*s+i[8]*r+i[12])/(o=o||1),t[1]=(i[1]*n+i[5]*s+i[9]*r+i[13])/o,t[2]=(i[2]*n+i[6]*s+i[10]*r+i[14])/o,t},X.transformMat3=function(t,e,i){var n=e[0],s=e[1],r=e[2];return t[0]=n*i[0]+s*i[3]+r*i[6],t[1]=n*i[1]+s*i[4]+r*i[7],t[2]=n*i[2]+s*i[5]+r*i[8],t},X.transformQuat=function(t,e,i){var n=i[0],s=i[1],r=i[2],o=e[0],a=e[1],h=e[2],c=s*h-r*a,u=r*o-n*h,l=n*a-s*o,f=s*l-r*u,d=r*c-n*l,p=n*u-s*c,m=2*i[3];return u*=m,l*=m,d*=2,p*=2,t[0]=o+(c*=m)+(f*=2),t[1]=a+u+d,t[2]=h+l+p,t},X.rotateX=function(t,e,i,n){var s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[0],r[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),r[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},X.rotateY=function(t,e,i,n){var s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),r[1]=s[1],r[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},X.rotateZ=function(t,e,i,n){var s=[],r=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],r[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),r[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),r[2]=s[2],t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},X.angle=function(t,e){var i=t[0],n=t[1],s=t[2],r=e[0],o=e[1],a=e[2],h=Math.sqrt(i*i+n*n+s*s)*Math.sqrt(r*r+o*o+a*a),c=h&&at(t,e)/h;return Math.acos(Math.min(Math.max(c,-1),1))},X.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},X.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},X.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},X.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=e[0],o=e[1],a=e[2];return Math.abs(i-r)<=J.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-o)<=J.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-a)<=J.EPSILON*Math.max(1,Math.abs(s),Math.abs(a))},X.forEach=X.sqrLen=X.len=X.sqrDist=X.dist=X.div=X.mul=X.sub=void 0;var J=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Z(t)&&"function"!=typeof t)return{default:t};var i=K(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function K(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(K=function(t){return t?i:e})(t)}function Q(){var t=new J.ARRAY_TYPE(3);return J.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function tt(t){return Math.hypot(t[0],t[1],t[2])}function et(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function it(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function nt(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function st(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function rt(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return i*i+n*n+s*s}function ot(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function at(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}X.sub=et,X.mul=it,X.div=nt,X.dist=st,X.sqrDist=rt,X.len=tt,X.sqrLen=ot;var ht,ct=(ht=Q(),function(t,e,i,n,s,r){var o,a;for(e||(e=3),i||(i=0),a=n?Math.min(n*e+i,t.length):t.length,o=i;o<a;o+=e)ht[0]=t[o],ht[1]=t[o+1],ht[2]=t[o+2],s(ht,ht,r),t[o]=ht[0],t[o+1]=ht[1],t[o+2]=ht[2];return t});X.forEach=ct;var ut={};function lt(t){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(t)}Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=pt,ut.clone=function(t){var e=new ft.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ut.fromValues=function(t,e,i,n){var s=new ft.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s},ut.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ut.set=function(t,e,i,n,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t},ut.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},ut.subtract=mt,ut.multiply=_t,ut.divide=vt,ut.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},ut.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},ut.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},ut.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},ut.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},ut.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},ut.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},ut.distance=gt,ut.squaredDistance=bt,ut.length=wt,ut.squaredLength=yt,ut.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},ut.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},ut.normalize=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i*i+n*n+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=i*o,t[1]=n*o,t[2]=s*o,t[3]=r*o,t},ut.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ut.cross=function(t,e,i,n){var s=i[0]*n[1]-i[1]*n[0],r=i[0]*n[2]-i[2]*n[0],o=i[0]*n[3]-i[3]*n[0],a=i[1]*n[2]-i[2]*n[1],h=i[1]*n[3]-i[3]*n[1],c=i[2]*n[3]-i[3]*n[2],u=e[0],l=e[1],f=e[2],d=e[3];return t[0]=l*c-f*h+d*a,t[1]=-u*c+f*o-d*r,t[2]=u*h-l*o+d*s,t[3]=-u*a+l*r-f*s,t},ut.lerp=function(t,e,i,n){var s=e[0],r=e[1],o=e[2],a=e[3];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t[2]=o+n*(i[2]-o),t[3]=a+n*(i[3]-a),t},ut.random=function(t,e){var i,n,s,r,o,a;e=e||1;do{o=(i=2*ft.RANDOM()-1)*i+(n=2*ft.RANDOM()-1)*n}while(o>=1);do{a=(s=2*ft.RANDOM()-1)*s+(r=2*ft.RANDOM()-1)*r}while(a>=1);var h=Math.sqrt((1-o)/a);return t[0]=e*i,t[1]=e*n,t[2]=e*s*h,t[3]=e*r*h,t},ut.transformMat4=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*r+i[12]*o,t[1]=i[1]*n+i[5]*s+i[9]*r+i[13]*o,t[2]=i[2]*n+i[6]*s+i[10]*r+i[14]*o,t[3]=i[3]*n+i[7]*s+i[11]*r+i[15]*o,t},ut.transformQuat=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=i[0],a=i[1],h=i[2],c=i[3],u=c*n+a*r-h*s,l=c*s+h*n-o*r,f=c*r+o*s-a*n,d=-o*n-a*s-h*r;return t[0]=u*c+d*-o+l*-h-f*-a,t[1]=l*c+d*-a+f*-o-u*-h,t[2]=f*c+d*-h+u*-a-l*-o,t[3]=e[3],t},ut.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},ut.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ut.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ut.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=e[0],a=e[1],h=e[2],c=e[3];return Math.abs(i-o)<=ft.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=ft.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-h)<=ft.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(r-c)<=ft.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))},ut.forEach=ut.sqrLen=ut.len=ut.sqrDist=ut.dist=ut.div=ut.mul=ut.sub=void 0;var ft=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==lt(t)&&"function"!=typeof t)return{default:t};var i=dt(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function dt(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(dt=function(t){return t?i:e})(t)}function pt(){var t=new ft.ARRAY_TYPE(4);return ft.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function mt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function _t(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function vt(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function gt(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function bt(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],r=e[3]-t[3];return i*i+n*n+s*s+r*r}function wt(t){return Math.hypot(t[0],t[1],t[2],t[3])}function yt(t){var e=t[0],i=t[1],n=t[2],s=t[3];return e*e+i*i+n*n+s*s}ut.sub=mt,ut.mul=_t,ut.div=vt,ut.dist=gt,ut.sqrDist=bt,ut.len=wt,ut.sqrLen=yt;var xt=function(){var t=pt();return function(e,i,n,s,r,o){var a,h;for(i||(i=4),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],r(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();function Mt(t){return Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mt(t)}ut.forEach=xt,Object.defineProperty(Y,"__esModule",{value:!0}),Y.create=It,Y.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Y.setAxisAngle=Ct,Y.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>Tt.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i},Y.getAngle=function(t,e){var i=zt(t,e);return Math.acos(2*i*i-1)},Y.multiply=jt,Y.rotateX=function(t,e,i){i*=.5;var n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+o*a,t[1]=s*h+r*a,t[2]=r*h-s*a,t[3]=o*h-n*a,t},Y.rotateY=function(t,e,i){i*=.5;var n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-r*a,t[1]=s*h+o*a,t[2]=r*h+n*a,t[3]=o*h-s*a,t},Y.rotateZ=function(t,e,i){i*=.5;var n=e[0],s=e[1],r=e[2],o=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=s*h-n*a,t[2]=r*h+o*a,t[3]=o*h-r*a,t},Y.calculateW=function(t,e){var i=e[0],n=e[1],s=e[2];return t[0]=i,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t},Y.exp=Dt,Y.ln=Rt,Y.pow=function(t,e,i){return Rt(t,e),Ft(t,t,i),Dt(t,t),t},Y.slerp=Pt,Y.random=function(t){var e=Tt.RANDOM(),i=Tt.RANDOM(),n=Tt.RANDOM(),s=Math.sqrt(1-e),r=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=r*Math.sin(2*Math.PI*n),t[3]=r*Math.cos(2*Math.PI*n),t},Y.invert=function(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=i*i+n*n+s*s+r*r,a=o?1/o:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t},Y.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Y.fromMat3=Nt,Y.fromEuler=function(t,e,i,n){var s=.5*Math.PI/180;e*=s,i*=s,n*=s;var r=Math.sin(e),o=Math.cos(e),a=Math.sin(i),h=Math.cos(i),c=Math.sin(n),u=Math.cos(n);return t[0]=r*h*u-o*a*c,t[1]=o*a*u+r*h*c,t[2]=o*h*c-r*a*u,t[3]=o*h*u+r*a*c,t},Y.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Y.setAxes=Y.sqlerp=Y.rotationTo=Y.equals=Y.exactEquals=Y.normalize=Y.sqrLen=Y.squaredLength=Y.len=Y.length=Y.lerp=Y.dot=Y.scale=Y.mul=Y.add=Y.set=Y.copy=Y.fromValues=Y.clone=void 0;var Tt=kt(p),Ot=kt(C),Et=kt(X),At=kt(ut);function St(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(St=function(t){return t?i:e})(t)}function kt(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Mt(t)&&"function"!=typeof t)return{default:t};var i=St(e);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}function It(){var t=new Tt.ARRAY_TYPE(4);return Tt.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ct(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function jt(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=i[0],h=i[1],c=i[2],u=i[3];return t[0]=n*u+o*a+s*c-r*h,t[1]=s*u+o*h+r*a-n*c,t[2]=r*u+o*c+n*h-s*a,t[3]=o*u-n*a-s*h-r*c,t}function Dt(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=Math.sqrt(i*i+n*n+s*s),a=Math.exp(r),h=o>0?a*Math.sin(o)/o:0;return t[0]=i*h,t[1]=n*h,t[2]=s*h,t[3]=a*Math.cos(o),t}function Rt(t,e){var i=e[0],n=e[1],s=e[2],r=e[3],o=Math.sqrt(i*i+n*n+s*s),a=o>0?Math.atan2(o,r)/o:0;return t[0]=i*a,t[1]=n*a,t[2]=s*a,t[3]=.5*Math.log(i*i+n*n+s*s+r*r),t}function Pt(t,e,i,n){var s,r,o,a,h,c=e[0],u=e[1],l=e[2],f=e[3],d=i[0],p=i[1],m=i[2],_=i[3];return(r=c*d+u*p+l*m+f*_)<0&&(r=-r,d=-d,p=-p,m=-m,_=-_),1-r>Tt.EPSILON?(s=Math.acos(r),o=Math.sin(s),a=Math.sin((1-n)*s)/o,h=Math.sin(n*s)/o):(a=1-n,h=n),t[0]=a*c+h*d,t[1]=a*u+h*p,t[2]=a*l+h*m,t[3]=a*f+h*_,t}function Nt(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var r=(s+1)%3,o=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*r+r]-e[3*o+o]+1),t[s]=.5*i,t[3]=(e[3*r+o]-e[3*o+r])*(i=.5/i),t[r]=(e[3*r+s]+e[3*s+r])*i,t[o]=(e[3*o+s]+e[3*s+o])*i}return t}Y.clone=At.clone,Y.fromValues=At.fromValues,Y.copy=At.copy,Y.set=At.set,Y.add=At.add,Y.mul=jt;var Ft=At.scale;Y.scale=Ft;var zt=At.dot;Y.dot=zt,Y.lerp=At.lerp;var Lt=At.length;Y.length=Lt,Y.len=Lt;var $t=At.squaredLength;Y.squaredLength=$t,Y.sqrLen=$t;var Ut=At.normalize;Y.normalize=Ut,Y.exactEquals=At.exactEquals,Y.equals=At.equals;var Bt,Gt,Ht,Vt=(Bt=Et.create(),Gt=Et.fromValues(1,0,0),Ht=Et.fromValues(0,1,0),function(t,e,i){var n=Et.dot(e,i);return n<-.999999?(Et.cross(Bt,Gt,e),Et.len(Bt)<1e-6&&Et.cross(Bt,Ht,e),Et.normalize(Bt,Bt),Ct(t,Bt,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Et.cross(Bt,e,i),t[0]=Bt[0],t[1]=Bt[1],t[2]=Bt[2],t[3]=1+n,Ut(t,t))});Y.rotationTo=Vt;var Wt,qt,Yt=(Wt=It(),qt=It(),function(t,e,i,n,s,r){return Pt(Wt,e,s,r),Pt(qt,i,n,r),Pt(t,Wt,qt,2*r*(1-r)),t});Y.sqlerp=Yt;var Xt,Zt=(Xt=Ot.create(),function(t,e,i,n){return Xt[0]=i[0],Xt[3]=i[1],Xt[6]=i[2],Xt[1]=n[0],Xt[4]=n[1],Xt[7]=n[2],Xt[2]=-e[0],Xt[5]=-e[1],Xt[8]=-e[2],Ut(t,Nt(t,Xt))});Y.setAxes=Zt;var Jt={};function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.create=function(){var t=new Qt.ARRAY_TYPE(8);return Qt.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Jt.clone=function(t){var e=new Qt.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Jt.fromValues=function(t,e,i,n,s,r,o,a){var h=new Qt.ARRAY_TYPE(8);return h[0]=t,h[1]=e,h[2]=i,h[3]=n,h[4]=s,h[5]=r,h[6]=o,h[7]=a,h},Jt.fromRotationTranslationValues=function(t,e,i,n,s,r,o){var a=new Qt.ARRAY_TYPE(8);a[0]=t,a[1]=e,a[2]=i,a[3]=n;var h=.5*s,c=.5*r,u=.5*o;return a[4]=h*n+c*i-u*e,a[5]=c*n+u*t-h*i,a[6]=u*n+h*e-c*t,a[7]=-h*t-c*e-u*i,a},Jt.fromRotationTranslation=se,Jt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Jt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Jt.fromMat4=function(t,e){var i=te.create();ee.getRotation(i,e);var n=new Qt.ARRAY_TYPE(3);return ee.getTranslation(n,e),se(t,i,n),t},Jt.copy=re,Jt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Jt.set=function(t,e,i,n,s,r,o,a,h){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t[4]=r,t[5]=o,t[6]=a,t[7]=h,t},Jt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Jt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Jt.getTranslation=function(t,e){var i=e[4],n=e[5],s=e[6],r=e[7],o=-e[0],a=-e[1],h=-e[2],c=e[3];return t[0]=2*(i*c+r*o+n*h-s*a),t[1]=2*(n*c+r*a+s*o-i*h),t[2]=2*(s*c+r*h+i*a-n*o),t},Jt.translate=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=.5*i[0],h=.5*i[1],c=.5*i[2],u=e[4],l=e[5],f=e[6],d=e[7];return t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=o*a+s*c-r*h+u,t[5]=o*h+r*a-n*c+l,t[6]=o*c+n*h-s*a+f,t[7]=-n*a-s*h-r*c+d,t},Jt.rotateX=function(t,e,i){var n=-e[0],s=-e[1],r=-e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=a*o+u*n+h*r-c*s,f=h*o+u*s+c*n-a*r,d=c*o+u*r+a*s-h*n,p=u*o-a*n-h*s-c*r;return te.rotateX(t,e,i),t[4]=l*(o=t[3])+p*(n=t[0])+f*(r=t[2])-d*(s=t[1]),t[5]=f*o+p*s+d*n-l*r,t[6]=d*o+p*r+l*s-f*n,t[7]=p*o-l*n-f*s-d*r,t},Jt.rotateY=function(t,e,i){var n=-e[0],s=-e[1],r=-e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=a*o+u*n+h*r-c*s,f=h*o+u*s+c*n-a*r,d=c*o+u*r+a*s-h*n,p=u*o-a*n-h*s-c*r;return te.rotateY(t,e,i),t[4]=l*(o=t[3])+p*(n=t[0])+f*(r=t[2])-d*(s=t[1]),t[5]=f*o+p*s+d*n-l*r,t[6]=d*o+p*r+l*s-f*n,t[7]=p*o-l*n-f*s-d*r,t},Jt.rotateZ=function(t,e,i){var n=-e[0],s=-e[1],r=-e[2],o=e[3],a=e[4],h=e[5],c=e[6],u=e[7],l=a*o+u*n+h*r-c*s,f=h*o+u*s+c*n-a*r,d=c*o+u*r+a*s-h*n,p=u*o-a*n-h*s-c*r;return te.rotateZ(t,e,i),t[4]=l*(o=t[3])+p*(n=t[0])+f*(r=t[2])-d*(s=t[1]),t[5]=f*o+p*s+d*n-l*r,t[6]=d*o+p*r+l*s-f*n,t[7]=p*o-l*n-f*s-d*r,t},Jt.rotateByQuatAppend=function(t,e,i){var n=i[0],s=i[1],r=i[2],o=i[3],a=e[0],h=e[1],c=e[2],u=e[3];return t[0]=a*o+u*n+h*r-c*s,t[1]=h*o+u*s+c*n-a*r,t[2]=c*o+u*r+a*s-h*n,t[3]=u*o-a*n-h*s-c*r,t[4]=(a=e[4])*o+(u=e[7])*n+(h=e[5])*r-(c=e[6])*s,t[5]=h*o+u*s+c*n-a*r,t[6]=c*o+u*r+a*s-h*n,t[7]=u*o-a*n-h*s-c*r,t},Jt.rotateByQuatPrepend=function(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=i[0],h=i[1],c=i[2],u=i[3];return t[0]=n*u+o*a+s*c-r*h,t[1]=s*u+o*h+r*a-n*c,t[2]=r*u+o*c+n*h-s*a,t[3]=o*u-n*a-s*h-r*c,t[4]=n*(u=i[7])+o*(a=i[4])+s*(c=i[6])-r*(h=i[5]),t[5]=s*u+o*h+r*a-n*c,t[6]=r*u+o*c+n*h-s*a,t[7]=o*u-n*a-s*h-r*c,t},Jt.rotateAroundAxis=function(t,e,i,n){if(Math.abs(n)<Qt.EPSILON)return re(t,e);var s=Math.hypot(i[0],i[1],i[2]);n*=.5;var r=Math.sin(n),o=r*i[0]/s,a=r*i[1]/s,h=r*i[2]/s,c=Math.cos(n),u=e[0],l=e[1],f=e[2],d=e[3];t[0]=u*c+d*o+l*h-f*a,t[1]=l*c+d*a+f*o-u*h,t[2]=f*c+d*h+u*a-l*o,t[3]=d*c-u*o-l*a-f*h;var p=e[4],m=e[5],_=e[6],v=e[7];return t[4]=p*c+v*o+m*h-_*a,t[5]=m*c+v*a+_*o-p*h,t[6]=_*c+v*h+p*a-m*o,t[7]=v*c-p*o-m*a-_*h,t},Jt.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Jt.multiply=oe,Jt.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Jt.lerp=function(t,e,i,n){var s=1-n;return ae(e,i)<0&&(n=-n),t[0]=e[0]*s+i[0]*n,t[1]=e[1]*s+i[1]*n,t[2]=e[2]*s+i[2]*n,t[3]=e[3]*s+i[3]*n,t[4]=e[4]*s+i[4]*n,t[5]=e[5]*s+i[5]*n,t[6]=e[6]*s+i[6]*n,t[7]=e[7]*s+i[7]*n,t},Jt.invert=function(t,e){var i=ce(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Jt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Jt.normalize=function(t,e){var i=ce(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,s=e[1]/i,r=e[2]/i,o=e[3]/i,a=e[4],h=e[5],c=e[6],u=e[7],l=n*a+s*h+r*c+o*u;t[0]=n,t[1]=s,t[2]=r,t[3]=o,t[4]=(a-n*l)/i,t[5]=(h-s*l)/i,t[6]=(c-r*l)/i,t[7]=(u-o*l)/i}return t},Jt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Jt.equals=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],h=t[6],c=t[7],u=e[0],l=e[1],f=e[2],d=e[3],p=e[4],m=e[5],_=e[6],v=e[7];return Math.abs(i-u)<=Qt.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-l)<=Qt.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-f)<=Qt.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(r-d)<=Qt.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(o-p)<=Qt.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=Qt.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(h-_)<=Qt.EPSILON*Math.max(1,Math.abs(h),Math.abs(_))&&Math.abs(c-v)<=Qt.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))},Jt.sqrLen=Jt.squaredLength=Jt.len=Jt.length=Jt.dot=Jt.mul=Jt.setReal=Jt.getReal=void 0;var Qt=ne(p),te=ne(Y),ee=ne(F);function ie(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(ie=function(t){return t?i:e})(t)}function ne(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Kt(t)&&"function"!=typeof t)return{default:t};var i=ie(e);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}function se(t,e,i){var n=.5*i[0],s=.5*i[1],r=.5*i[2],o=e[0],a=e[1],h=e[2],c=e[3];return t[0]=o,t[1]=a,t[2]=h,t[3]=c,t[4]=n*c+s*h-r*a,t[5]=s*c+r*o-n*h,t[6]=r*c+n*a-s*o,t[7]=-n*o-s*a-r*h,t}function re(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function oe(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=i[4],h=i[5],c=i[6],u=i[7],l=e[4],f=e[5],d=e[6],p=e[7],m=i[0],_=i[1],v=i[2],g=i[3];return t[0]=n*g+o*m+s*v-r*_,t[1]=s*g+o*_+r*m-n*v,t[2]=r*g+o*v+n*_-s*m,t[3]=o*g-n*m-s*_-r*v,t[4]=n*u+o*a+s*c-r*h+l*g+p*m+f*v-d*_,t[5]=s*u+o*h+r*a-n*c+f*g+p*_+d*m-l*v,t[6]=r*u+o*c+n*h-s*a+d*g+p*v+l*_-f*m,t[7]=o*u-n*a-s*h-r*c+p*g-l*m-f*_-d*v,t}Jt.getReal=te.copy,Jt.setReal=te.copy,Jt.mul=oe;var ae=te.dot;Jt.dot=ae;var he=te.length;Jt.length=he,Jt.len=he;var ce=te.squaredLength;Jt.squaredLength=ce,Jt.sqrLen=ce;var ue={};function le(t){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},le(t)}Object.defineProperty(ue,"__esModule",{value:!0}),ue.create=pe,ue.clone=function(t){var e=new fe.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},ue.fromValues=function(t,e){var i=new fe.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},ue.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},ue.set=function(t,e,i){return t[0]=e,t[1]=i,t},ue.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},ue.subtract=me,ue.multiply=_e,ue.divide=ve,ue.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},ue.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},ue.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},ue.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},ue.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},ue.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},ue.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},ue.distance=ge,ue.squaredDistance=be,ue.length=we,ue.squaredLength=ye,ue.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},ue.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},ue.normalize=function(t,e){var i=e[0],n=e[1],s=i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},ue.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},ue.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},ue.lerp=function(t,e,i,n){var s=e[0],r=e[1];return t[0]=s+n*(i[0]-s),t[1]=r+n*(i[1]-r),t},ue.random=function(t,e){e=e||1;var i=2*fe.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},ue.transformMat2=function(t,e,i){var n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s,t[1]=i[1]*n+i[3]*s,t},ue.transformMat2d=function(t,e,i){var n=e[0],s=e[1];return t[0]=i[0]*n+i[2]*s+i[4],t[1]=i[1]*n+i[3]*s+i[5],t},ue.transformMat3=function(t,e,i){var n=e[0],s=e[1];return t[0]=i[0]*n+i[3]*s+i[6],t[1]=i[1]*n+i[4]*s+i[7],t},ue.transformMat4=function(t,e,i){var n=e[0],s=e[1];return t[0]=i[0]*n+i[4]*s+i[12],t[1]=i[1]*n+i[5]*s+i[13],t},ue.rotate=function(t,e,i,n){var s=e[0]-i[0],r=e[1]-i[1],o=Math.sin(n),a=Math.cos(n);return t[0]=s*a-r*o+i[0],t[1]=s*o+r*a+i[1],t},ue.angle=function(t,e){var i=t[0],n=t[1],s=e[0],r=e[1],o=Math.sqrt(i*i+n*n)*Math.sqrt(s*s+r*r);return Math.acos(Math.min(Math.max(o&&(i*s+n*r)/o,-1),1))},ue.zero=function(t){return t[0]=0,t[1]=0,t},ue.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},ue.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ue.equals=function(t,e){var i=t[0],n=t[1],s=e[0],r=e[1];return Math.abs(i-s)<=fe.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-r)<=fe.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))},ue.forEach=ue.sqrLen=ue.sqrDist=ue.dist=ue.div=ue.mul=ue.sub=ue.len=void 0;var fe=function(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==le(t)&&"function"!=typeof t)return{default:t};var i=de(void 0);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(p);function de(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(de=function(t){return t?i:e})(t)}function pe(){var t=new fe.ARRAY_TYPE(2);return fe.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function me(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function _e(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function ve(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function ge(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function be(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function we(t){return Math.hypot(t[0],t[1])}function ye(t){var e=t[0],i=t[1];return e*e+i*i}ue.len=we,ue.sub=me,ue.mul=_e,ue.div=ve,ue.dist=ge,ue.sqrDist=be,ue.sqrLen=ye;var xe=function(){var t=pe();return function(e,i,n,s,r,o){var a,h;for(i||(i=2),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],r(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}();function Me(t){return Me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(t)}ue.forEach=xe,Object.defineProperty(d,"__esModule",{value:!0}),t.aB=d.vec4=t.$=d.vec3=d.vec2=d.quat2=t.aw=d.quat=t.ae=d.mat4=t.bE=d.mat3=d.mat2d=t.aD=d.mat2=d.glMatrix=void 0;var Te=Pe(p);d.glMatrix=Te;var Oe=Pe(b);t.aD=d.mat2=Oe;var Ee=Pe(O);d.mat2d=Ee;var Ae=Pe(C);t.bE=d.mat3=Ae;var Se=Pe(F);t.ae=d.mat4=Se;var ke=Pe(Y);t.aw=d.quat=ke;var Ie=Pe(Jt);d.quat2=Ie;var Ce=Pe(ue);d.vec2=Ce;var je=Pe(X);t.$=d.vec3=je;var De=Pe(ut);function Re(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(Re=function(t){return t?i:e})(t)}function Pe(t,e){if(t&&t.__esModule)return t;if(null===t||"object"!==Me(t)&&"function"!=typeof t)return{default:t};var i=Re(e);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var o=s?Object.getOwnPropertyDescriptor(t,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}t.aB=d.vec4=De;var Ne=Fe;function Fe(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}Fe.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var s=this.sampleCurveX(i)-t;if(Math.abs(s)<e)return i;var r=this.sampleCurveDerivativeX(i);if(Math.abs(r)<1e-6)break;i-=s/r}var o=0,a=1;for(i=t,n=0;n<20&&(s=this.sampleCurveX(i),!(Math.abs(s-t)<e));n++)t>s?o=i:a=i,i=.5*(a-o)+o;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var ze=f(Ne),Le=$e;function $e(t,e){this.x=t,this.y=e}$e.prototype={clone:function(){return new $e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),s=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},$e.convert=function(t){return t instanceof $e?t:Array.isArray(t)?new $e(t[0],t[1]):t};var Ue=f(Le);function Be(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Be(t[i],e[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!Be(t[i],e[i]))return!1;return!0}return t===e}const Ge=Math.PI/180,He=180/Math.PI;function Ve(t){return t*Ge}function We(t){return t*He}const qe=[[0,0],[1,0],[1,1],[0,1]];function Ye(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Xe(t,e,i,n){const s=new ze(t,e,i,n);return function(t){return s.solve(t)}}const Ze=Xe(.25,.1,.25,1);function Je(t,e,i){return Math.min(i,Math.max(e,t))}function Ke(t,e,i){return(i=Je((i-t)/(e-t),0,1))*i*(3-2*i)}function Qe(t,e,i){const n=i-e,s=((t-e)%n+n)%n+e;return s===e?i:s}function ti(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const s=new Array(t.length);let r=null;t.forEach(((t,o)=>{e(t,((t,e)=>{t&&(r=t),s[o]=e,0==--n&&i(r,s)}))}))}function ei(t){const e=[];for(const i in t)e.push(t[i]);return e}function ii(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}let ni=1;function si(){return ni++}function ri(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function oi(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ai(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function hi(t,e){t.forEach((t=>{e[t]&&(e[t]=e[t].bind(e))}))}function ci(t,e){return-1!==t.indexOf(e,t.length-e.length)}function ui(t,e,i){const n={};for(const i in t)n[i]=e.call(this,t[i],i,t);return n}function li(t,e,i){const n={};for(const i in t)e.call(this,t[i],i,t)&&(n[i]=t[i]);return n}function fi(t){return Array.isArray(t)?t.map(fi):"object"==typeof t&&t?ui(t,fi):t}const di={};function pi(t){di[t]||("undefined"!=typeof console&&console.warn(t),di[t]=!0)}function mi(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function _i(t){let e=0;for(let i,n,s=0,r=t.length,o=r-1;s<r;o=s++)i=t[s],n=t[o],e+=(n.x-i.x)*(i.y+n.y);return e}function vi([t,e,i]){const n=Ve(e+90),s=Ve(i);return{x:t*Math.cos(n)*Math.sin(s),y:t*Math.sin(n)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:i}}function gi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function bi(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((t,i,n,s)=>{const r=n||s;return e[i]=!r||r.toLowerCase(),""})),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let wi,yi,xi,Mi,Ti,Oi,Ei=null;function Ai(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}function Si(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function ki(t,e,i,n){for(;e<i;){const s=e+i>>1;t[s]<n?e=s+1:i=s}return e}function Ii(t,e,i,n){for(;e<i;){const s=e+i>>1;t[s]<=n?e=s+1:i=s}return e}function Ci(t){return t>0?1/(1.001-t):1+t}function ji(t){return t>0?1-1/(1.001-t):-t}function Di(){return null==wi&&(wi=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),wi}const Ri={now:()=>void 0!==Mi?Mi:performance.now(),setNow(t){Mi=t},restoreNow(){Mi=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:n}=t;Ti||(Ti=document.createElement("canvas"));const s=Ti.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(i>Ti.width||n>Ti.height)&&(Ti.width=i,Ti.height=n),s.clearRect(-e,-e,i+2*e,n+2*e),s.drawImage(t,0,0,i,n),s.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(yi||(yi=document.createElement("a")),yi.href=t,yi.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==xi&&(xi=window.matchMedia("(prefers-reduced-motion: reduce)")),xi.matches)},hasCanvasFingerprintNoise(){if(void 0!==Oi)return Oi;if(!Di())return Oi=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<t.width;++n)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(n,0,1,1);const n=e.getImageData(0,0,t.width,t.height);i=0;for(let t=0;t<n.data.length;++t)if(t%4!=3&&i++!==n.data[t])return Oi=!0,!0;return Oi=!1,!1}};function Pi(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(i));for(const t in e)n.set(t,e[t]);return`${t.slice(0,i)}?${n.toString()}`}function Ni(t,e={persistentParams:[]}){const i=t.indexOf("?");if(i<0)return t;const n=new URLSearchParams,s=new URLSearchParams(t.slice(i));for(const t of e.persistentParams){const e=s.get(t);e&&n.set(t,e)}const r=n.toString();return`${t.slice(0,i)}${r.length>0?`?${r}`:""}`}const Fi="mapbox-tiles";let zi=500,Li=50;const $i=["language","worldview","jobid"];let Ui,Bi;function Gi(){try{return caches}catch(t){}}function Hi(){const t=Gi();t&&!Ui&&(Ui=t.open(Fi))}let Vi=1/0;const Wi={supported:!1,testSupport:function(t){!Xi&&Yi&&(Zi?Ki(t):qi=t)}};let qi,Yi,Xi=!1,Zi=!1;const Ji="undefined"!=typeof self?self:{};function Ki(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Yi),t.isContextLost())return;Wi.supported=!0}catch(t){}t.deleteTexture(e),Xi=!0}Ji.document&&(Yi=Ji.document.createElement("img"),Yi.onload=function(){qi&&Ki(qi),qi=null,Zi=!0},Yi.onerror=function(){Xi=!0,qi=null},Yi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Qi);class tn extends Error{constructor(t,e,i){401===e&&s(i)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const en=gi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href;const nn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(en())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(t,e){const i=new AbortController,n=new Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:en(),referrerPolicy:t.referrerPolicy,signal:i.signal});let r=!1,o=!1;const a=(h=n.url).indexOf("sku=")>0&&s(h);var h;"json"===t.type&&n.headers.set("Accept","application/json");const c=(i,s,r)=>{if(o)return;if(i&&"SecurityError"!==i.message&&pi(i.toString()),s&&r)return u(s);const h=Date.now();fetch(n).then((i=>{if(i.ok){const t=a?i.clone():null;return u(i,t,h)}return e(new tn(i.statusText,i.status,t.url))})).catch((i=>{"AbortError"!==i.name&&e(new Error(`${i.message} ${t.url}`))}))},u=(i,s,a)=>{("arrayBuffer"===t.type?i.arrayBuffer():"json"===t.type?i.json():i.text()).then((t=>{o||(s&&a&&function(t,e,i){if(Hi(),!Ui)return;const n=bi(e.headers.get("Cache-Control")||"");if(n["no-store"])return;const s={status:e.status,statusText:e.statusText,headers:new Headers};e.headers.forEach(((t,e)=>s.headers.set(e,t))),n["max-age"]&&s.headers.set("Expires",new Date(i+1e3*n["max-age"]).toUTCString());const r=s.headers.get("Expires");if(!r)return;if(new Date(r).getTime()-i<42e4)return;let o=Ni(t.url,{persistentParams:$i});if(206===e.status){const e=t.headers.get("Range");if(!e)return;s.status=200,o=Pi(o,{range:e})}!function(t,e){if(void 0===Bi)try{new Response(new ReadableStream),Bi=!0}catch(t){Bi=!1}Bi?e(t.body):t.blob().then(e)}(e,(t=>{const i=new Response(200!==(n=e.status)&&404!==n&&[101,103,204,205,304].includes(n)?null:t,s);var n;Hi(),Ui&&Ui.then((t=>t.put(o,i))).catch((t=>pi(t.message)))}))}(n,s,a),r=!0,e(null,t,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((t=>{o||e(new Error(t.message))}))};return a?function(t,e){if(Hi(),!Ui)return e(null);Ui.then((i=>{let n=Ni(t.url,{persistentParams:$i});const s=t.headers.get("Range");s&&(n=Pi(n,{range:s})),i.match(n).then((t=>{const s=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),i=bi(t.headers.get("Cache-Control")||"");return e>Date.now()&&!i["no-cache"]}(t);i.delete(n),s&&i.put(n,t.clone()),e(null,t,s)})).catch(e)})).catch(e)}(n,c):c(null,null),{cancel:()=>{o=!0,r||i.abort()}}}(t,e);if(gi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(t,e){const i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(i.responseType="arraybuffer");for(const e in t.headers)i.setRequestHeader(e,t.headers[e]);return"json"===t.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===t.credentials,i.onerror=()=>{e(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let n=i.response;if("json"===t.type)try{n=JSON.parse(i.response)}catch(t){return e(t)}e(null,n,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else e(new tn(i.statusText,i.status,t.url))},i.send(t.body),{cancel:()=>i.abort()}}(t,e)},sn=function(t,e){return nn(ii(t,{type:"arrayBuffer"}),e)};function rn(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const on="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let an,hn;an=[],hn=0;const cn=function(t,e){if(Wi.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hn>=n.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return an.push(i),i}hn++;let i=!1;const s=()=>{if(!i)for(i=!0,hn--;an.length&&hn<n.MAX_PARALLEL_IMAGE_REQUESTS;){const t=an.shift(),{requestParameters:e,callback:i,cancelled:n}=t;n||(t.cancel=cn(e,i).cancel)}},r=sn(t,((t,i,n,r)=>{s(),t?e(t):i&&(self.createImageBitmap?function(t,e){const i=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(i).then((t=>{e(null,t)})).catch((t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))}(i,((t,i)=>e(t,i,n,r))):function(t,e){const i=new Image;i.onload=()=>{e(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=on}))},i.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(t)],{type:"image/png"});i.src=t.byteLength?URL.createObjectURL(n):on}(i,((t,i)=>e(t,i,n,r))))}));return{cancel:()=>{r.cancel(),s()}}},un="01",ln="NO_ACCESS_TOKEN",fn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function dn(t){const e=t.match(fn);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function pn(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const mn="mapbox.eventData";function _n(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(t){return null}}class vn{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=_n(n.ACCESS_TOKEN);let i="";return i=e&&e.u?btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,((t,e)=>String.fromCharCode(Number("0x"+e))))):n.ACCESS_TOKEN||"",t?`${mn}.${t}:${i}`:`${mn}:${i}`}fetchEventData(){const t=Ai("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid");if(t)try{const t=localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const n=localStorage.getItem(i);n&&(this.anonId=n)}catch(t){pi("Unable to read from LocalStorage")}}saveEventData(){const t=Ai("localStorage"),e=this.getStorageKey(),i=this.getStorageKey("uuid"),n=this.anonId;if(t&&n)try{localStorage.setItem(i,n),Object.keys(this.eventData).length>=1&&localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){pi("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,e,i,s){if(!n.EVENTS_URL)return;const r=dn(n.EVENTS_URL);r.params.push(`access_token=${s||n.ACCESS_TOKEN||""}`);const o={event:this.type,created:new Date(t).toISOString()},a=e?ii(o,e):o,h={url:pn(r),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=function(t,e){return nn(ii(t,{method:"POST"}),e)}(h,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(s)}))}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const gn=new class extends vn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){n.EVENTS_URL&&n.ACCESS_TOKEN&&Array.isArray(t)&&t.some((t=>r(t)||s(t)))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=_n(n.ACCESS_TOKEN),s=i?i.u:n.ACCESS_TOKEN;let r=s!==this.eventData.tokenU;ai(this.anonId)||(this.anonId=ri(),r=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(o),i=(o-this.eventData.lastSuccess)/864e5;r=r||i>=1||i<-1||t.getDate()!==e.getDate()}else r=!0;r?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:un,"enabled.telemetry":!1,userId:this.anonId},(t=>{t||(this.eventData.lastSuccess=o,this.eventData.tokenU=s)}),t):this.processRequests()}},bn=gn.postTurnstileEvent.bind(gn),wn=new class extends vn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,s){this.skuToken=e,this.errorCb=s,n.EVENTS_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(ln)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:n}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),ai(this.anonId)||(this.anonId=ri()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:un,skuToken:this.skuToken,userId:this.anonId},(t=>{t?this.errorCb(t):i&&(this.success[i]=!0)}),t))}remove(){this.errorCb=null}},yn=wn.postMapLoadEvent.bind(wn),xn=new class extends vn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=ri(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:i,style:s,importedStyles:r}=e;if(!n.EVENTS_URL||!t&&!n.ACCESS_TOKEN)return;const o=this.getMapInstanceId(i),a={mapInstanceId:o,eventId:this.getEventId(o),style:s};r.length&&(a.importedStyles=r),this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,payload:i}=this.queue.shift();this.postEvent(e,i,(()=>{}),t)}},Mn=xn.postStyleLoadEvent.bind(xn),Tn=new class extends vn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){n.EVENTS_URL&&(t||n.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:n}=this.queue.shift(),s=function(t){const i=performance.getEntriesByType("resource"),n=performance.getEntriesByType("mark"),s=function(t){const e={};if(t)for(const i in t)if("other"!==i)for(const n of t[i]){const t=`${i}ResolveRangeMin`,s=`${i}ResolveRangeMax`,r=`${i}RequestCount`,o=`${i}RequestCachedCount`;e[t]=Math.min(e[t]||1/0,n.startTime),e[s]=Math.max(e[s]||-1/0,n.responseEnd);const a=t=>{void 0===e[t]&&(e[t]=0),++e[t]};void 0!==n.transferSize&&0===n.transferSize&&a(o),a(r)}return e}(function(t,e){const i={};if(t)for(const n of t){const t=e(n);void 0===i[t]&&(i[t]=[]),i[t].push(n)}return i}(i,l)),r=window.devicePixelRatio,o=navigator.connection||navigator.mozConnection||navigator.webkitConnection,a=o?o.effectiveType:void 0,u={counters:[],metadata:[],attributes:[]},f=(t,e,i)=>{null!=i&&t.push({name:e,value:i.toString()})};for(const t in s)f(u.counters,t,s[t]);if(t.interactionRange[0]!==1/0&&t.interactionRange[1]!==-1/0&&(f(u.counters,"interactionRangeMin",t.interactionRange[0]),f(u.counters,"interactionRangeMax",t.interactionRange[1])),n)for(const t of Object.keys(c)){const e=c[t],i=n.find((t=>t.name===e));i&&f(u.counters,e,i.startTime)}return f(u.counters,"visibilityHidden",t.visibilityHidden),f(u.attributes,"style",function(t){if(t)for(const e of t){const t=e.name.split("?")[0];if(h(t)){const e=t.split("/").slice(-2);if(2===e.length)return`mapbox://styles/${e[0]}/${e[1]}`}}}(i)),f(u.attributes,"terrainEnabled",t.terrainEnabled?"true":"false"),f(u.attributes,"fogEnabled",t.fogEnabled?"true":"false"),f(u.attributes,"projection",t.projection),f(u.attributes,"zoom",t.zoom),f(u.metadata,"devicePixelRatio",r),f(u.metadata,"connectionEffectiveType",a),f(u.metadata,"navigatorUserAgent",navigator.userAgent),f(u.metadata,"screenWidth",window.screen.width),f(u.metadata,"screenHeight",window.screen.height),f(u.metadata,"windowWidth",window.innerWidth),f(u.metadata,"windowHeight",window.innerHeight),f(u.metadata,"mapWidth",t.width/r),f(u.metadata,"mapHeight",t.height/r),f(u.metadata,"webglRenderer",t.renderer),f(u.metadata,"webglVendor",t.vendor),f(u.metadata,"sdkVersion",e),f(u.metadata,"sdkIdentifier","mapbox-gl-js"),u}(n);for(const t of s.metadata);for(const t of s.counters);for(const t of s.attributes);this.postEvent(i,s,(()=>{}),t)}},On=Tn.postPerformanceEvent.bind(Tn),En=new class extends vn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,s){if(!n.API_URL||!n.SESSION_PATH)return;const r=dn(n.API_URL+n.SESSION_PATH);r.params.push(`sku=${e||""}`),r.params.push(`access_token=${s||n.ACCESS_TOKEN||""}`);const o={url:pn(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(t,e){return nn(ii(t,{method:"GET"}),e)}(o,(t=>{this.pendingRequest=null,i(t),this.saveEventData(),this.processRequests(s)}))}getSessionAPI(t,e,i,s){this.skuToken=e,this.errorCb=s,n.SESSION_PATH&&n.API_URL&&(i||n.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(ln)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,(t=>{t?this.errorCb(t):e&&(this.success[e]=!0)}),t)}remove(){this.errorCb=null}},An=En.getSessionAPI.bind(En),Sn=new Set;var kn={exports:{}},In={exports:function(t,e){var i,n,s,r,o,a,h,c;for(n=t.length-(i=3&t.length),s=e,o=3432918353,a=461845907,c=0;c<n;)h=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,s=27492+(65535&(r=5*(65535&(s=(s^=h=(65535&(h=(h=(65535&h)*o+(((h>>>16)*o&65535)<<16)&4294967295)<<15|h>>>17))*a+(((h>>>16)*a&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(h=0,i){case 3:h^=(255&t.charCodeAt(c+2))<<16;case 2:h^=(255&t.charCodeAt(c+1))<<8;case 1:s^=h=(65535&(h=(h=(65535&(h^=255&t.charCodeAt(c)))*o+(((h>>>16)*o&65535)<<16)&4294967295)<<15|h>>>17))*a+(((h>>>16)*a&65535)<<16)&4294967295}return s^=t.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0}},Cn={exports:function(t,e){for(var i,n=t.length,s=e^n,r=0;n>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(r)|(255&t.charCodeAt(++r))<<8|(255&t.charCodeAt(++r))<<16|(255&t.charCodeAt(++r))<<24))+((1540483477*(i>>>16)&65535)<<16),s=1540483477*(65535&s)+((1540483477*(s>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),n-=4,++r;switch(n){case 3:s^=(255&t.charCodeAt(r+2))<<16;case 2:s^=(255&t.charCodeAt(r+1))<<8;case 1:s=1540483477*(65535&(s^=255&t.charCodeAt(r)))+((1540483477*(s>>>16)&65535)<<16)}return s=1540483477*(65535&(s^=s>>>13))+((1540483477*(s>>>16)&65535)<<16),(s^=s>>>15)>>>0}},jn=In.exports,Dn=Cn.exports;kn.exports=jn,kn.exports.murmur3=jn,kn.exports.murmur2=Dn;var Rn=f(kn.exports);class Pn{constructor(t,...e){ii(this,e[0]||{}),this.type=t}}class Nn extends Pn{constructor(t,e={}){super("error",ii({error:t},e))}}function Fn(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function zn(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);-1!==n&&i[t].splice(n,1)}}class Ln{on(t,e){return this._listeners=this._listeners||{},Fn(t,e,this._listeners),this}off(t,e){return zn(t,e,this._listeners),zn(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Fn(t,e,this._oneTimeListeners),this):new Promise((e=>this.once(t,e)))}fire(t,e){const i="string"==typeof t?new Pn(t,e):t,n=i.type;if(this.listens(n)){i.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const e of t)e.call(this,i);const e=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const t of e)zn(n,t,this._oneTimeListeners),t.call(this,i);const s=this._eventedParent;s&&(ii(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),s.fire(i))}else i instanceof Nn&&console.error(i.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}t.G=void 0;var $n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Un(t){return(t=Math.round(t))<0?0:t>255?255:t}function Bn(t){return Un("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Gn(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Hn(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{t.G=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in $n)return $n[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),s=i.indexOf(")");if(-1!==n&&s+1===i.length){var r=i.substr(0,n),o=i.substr(n+1,s-(n+1)).split(","),a=1;switch(r){case"rgba":if(4!==o.length)return null;a=Gn(o.pop());case"rgb":return 3!==o.length?null:[Bn(o[0]),Bn(o[1]),Bn(o[2]),a];case"hsla":if(4!==o.length)return null;a=Gn(o.pop());case"hsl":if(3!==o.length)return null;var h=(parseFloat(o[0])%360+360)%360/360,c=Gn(o[1]),u=Gn(o[2]),l=u<=.5?u*(c+1):u+c-u*c,f=2*u-l;return[Un(255*Hn(f,l,h+1/3)),Un(255*Hn(f,l,h)),Un(255*Hn(f,l,h-1/3)),a];default:return null}}return null}}catch(t){}class Vn{constructor(t,e,i,n=1){this.r=t,this.g=e,this.b=i,this.a=n}static parse(e){if(!e)return;if(e instanceof Vn)return e;if("string"!=typeof e)return;const i=t.G(e);return i?new Vn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,e,i,n]=0===this.a?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(i)},${n})`}toRenderColor(t){const{r:e,g:i,b:n,a:s}=this;return new Wn(t,e,i,n,s)}}class Wn{constructor(t,e,i,n,s){if(t){const r=t.image.height,o=r*r;e=0===s?0:e/s*(r-1),i=0===s?0:i/s*(r-1),n=0===s?0:n/s*(r-1);const a=Math.floor(e),h=Math.floor(i),c=Math.floor(n),u=Math.ceil(e),l=Math.ceil(i),f=Math.ceil(n),d=e-a,p=i-h,m=n-c,_=t.image.data,v=4*(a+h*o+c*r),g=4*(a+h*o+f*r),b=4*(a+l*o+c*r),w=4*(a+l*o+f*r),y=4*(u+h*o+c*r),x=4*(u+h*o+f*r),M=4*(u+l*o+c*r),T=4*(u+l*o+f*r);if(v<0||T>=_.length)throw new Error("out of range");this.r=qn(qn(qn(_[v],_[g],m),qn(_[b],_[w],m),p),qn(qn(_[y],_[x],m),qn(_[M],_[T],m),p),d)/255*s,this.g=qn(qn(qn(_[v+1],_[g+1],m),qn(_[b+1],_[w+1],m),p),qn(qn(_[y+1],_[x+1],m),qn(_[M+1],_[T+1],m),p),d)/255*s,this.b=qn(qn(qn(_[v+2],_[g+2],m),qn(_[b+2],_[w+2],m),p),qn(qn(_[y+2],_[x+2],m),qn(_[M+2],_[T+2],m),p),d)/255*s,this.a=s}else this.r=e,this.g=i,this.b=n,this.a=s}toArray(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[255*t/n,255*e/n,255*i/n,n]}toArray01(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[t/n,e/n,i/n,n]}toArray01Scaled(t){const{r:e,g:i,b:n,a:s}=this;return 0===s?[0,0,0]:[e/s*t,i/s*t,n/s*t]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:i,a:n}=this;return[t,e,i,n]}toArray01Linear(){const{r:t,g:e,b:i,a:n}=this;return 0===n?[0,0,0,0]:[Math.pow(t/n,2.2),Math.pow(e/n,2.2),Math.pow(i/n,2.2),n]}}function qn(t,e,i){return t*(1-i)+e*i}function Yn(t,e,i){return t.map(((t,n)=>qn(t,e[n],i)))}Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1),Vn.blue=new Vn(0,0,1,1);var Xn=Object.freeze({__proto__:null,array:Yn,color:function(t,e,i){return new Vn(qn(t.r,e.r,i),qn(t.g,e.g,i),qn(t.b,e.b,i),qn(t.a,e.a,i))},number:qn});function Zn(t,...e){for(const i of e)for(const e in i)t[e]=i[e];return t}class Jn extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class Kn{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,i]of e)this.bindings[t]=i}concat(t){return new Kn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Qn={kind:"null"},ts={kind:"number"},es={kind:"string"},is={kind:"boolean"},ns={kind:"color"},ss={kind:"object"},rs={kind:"value"},os={kind:"collator"},as={kind:"formatted"},hs={kind:"resolvedImage"};function cs(t,e){return{kind:"array",itemType:t,N:e}}function us(t){if("array"===t.kind){const e=us(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ls=[Qn,ts,es,is,ns,as,ss,cs(rs),hs];function fs(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!fs(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ls)if(!fs(t,e))return null}return`Expected ${us(t)} but found ${us(e)} instead.`}function ds(t,e){return e.some((e=>e.kind===t.kind))}function ps(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}class ms{constructor(t,e,i){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _s{constructor(t,e,i,n,s){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=i,this.fontStack=n,this.textColor=s}}class vs{constructor(t){this.sections=t}static fromString(t){return new vs([new _s(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.namePrimary.length))}static factory(t){return t instanceof vs?t:vs.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.namePrimary]);continue}t.push(e.text);const i={};e.fontStack&&(i["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(i["font-scale"]=e.scale),e.textColor&&(i["text-color"]=["rgba"].concat(e.textColor.toRenderColor(null).toArray())),t.push(i)}return t}}class gs{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,e){return t?new gs({namePrimary:t,nameSecondary:e,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function bs(t,e,i,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ws(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Vn)return!0;if(t instanceof ms)return!0;if(t instanceof vs)return!0;if(t instanceof gs)return!0;if(Array.isArray(t)){for(const e of t)if(!ws(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ws(t[e]))return!1;return!0}return!1}function ys(t){if(null===t)return Qn;if("string"==typeof t)return es;if("boolean"==typeof t)return is;if("number"==typeof t)return ts;if(t instanceof Vn)return ns;if(t instanceof ms)return os;if(t instanceof vs)return as;if(t instanceof gs)return hs;if(Array.isArray(t)){const e=t.length;let i;for(const e of t){const t=ys(e);if(i){if(i===t)continue;i=rs;break}i=t}return cs(i||rs,e)}return ss}function xs(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Vn||t instanceof vs||t instanceof gs?t.toString():JSON.stringify(t)}class Ms{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ws(t[1]))return e.error("invalid value");const i=t[1];let n=ys(i);const s=e.expectedType;return"array"!==n.kind||0!==n.N||!s||"array"!==s.kind||"number"==typeof s.N&&0!==s.N||(n=s),new Ms(n,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof vs?this.value.serialize():this.value}}class Ts{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Os={string:es,number:ts,boolean:is,object:ss};class Es{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let i,n=1;const s=t[0];if("array"===s){let s,r;if(t.length>2){const i=t[1];if("string"!=typeof i||!(i in Os)||"object"===i)return e.error('The item type argument of "array" must be one of string, number, boolean',1);s=Os[i],n++}else s=rs;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);r=t[2],n++}i=cs(s,r)}else i=Os[s];const r=[];for(;n<t.length;n++){const i=e.parse(t[n],n,rs);if(!i)return null;r.push(i)}return new Es(i,r)}evaluate(t){for(let e=0;e<this.args.length;e++){const i=this.args[e].evaluate(t);if(!fs(this.type,ys(i)))return i;if(e===this.args.length-1)throw new Ts(`The expression ${JSON.stringify(this.args[e].serialize())} evaluated to ${us(ys(i))} but was expected to be of type ${us(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const i=t.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){e.push(i.kind);const n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((t=>t.serialize())))}}class As{constructor(t){this.type=as,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[1];if(!Array.isArray(i)&&"object"==typeof i)return e.error("First argument must be an image or text section.");const n=[];let s=!1;for(let i=1;i<=t.length-1;++i){const r=t[i];if(s&&"object"==typeof r&&!Array.isArray(r)){s=!1;let t=null;if(r["font-scale"]&&(t=e.parse(r["font-scale"],1,ts),!t))return null;let i=null;if(r["text-font"]&&(i=e.parse(r["text-font"],1,cs(es)),!i))return null;let o=null;if(r["text-color"]&&(o=e.parse(r["text-color"],1,ns),!o))return null;const a=n[n.length-1];a.scale=t,a.font=i,a.textColor=o}else{const r=e.parse(t[i],1,rs);if(!r)return null;const o=r.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,n.push({content:r,scale:null,font:null,textColor:null})}}return new As(n)}evaluate(t){return new vs(this.sections.map((e=>{const i=e.content.evaluate(t);return ys(i)===hs?new _s("",i,null,null,null):new _s(xs(i),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const i={};e.scale&&(i["font-scale"]=e.scale.serialize()),e.font&&(i["text-font"]=e.font.serialize()),e.textColor&&(i["text-color"]=e.textColor.serialize()),t.push(i)}return t}}class Ss{constructor(t,e){this.type=hs,this.inputPrimary=t,this.inputSecondary=e}static parse(t,e){if(t.length<2)return e.error("Expected two or more arguments.");const i=e.parse(t[1],1,es);if(!i)return e.error("No image name provided.");if(2===t.length)return new Ss(i);const n=e.parse(t[2],1,es);return n?new Ss(i,n):e.error("Secondary image variant is not a string.")}evaluate(t){const e=gs.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(e.namePrimary)>-1,e.nameSecondary&&e.available&&t.availableImages&&(e.available=t.availableImages.indexOf(e.nameSecondary)>-1)),e}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function ks(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}const Is={"to-boolean":is,"to-color":ns,"to-number":ts,"to-string":es};class Cs{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const i=t[0],n=[];let s=Qn;if("to-array"===i){if(!Array.isArray(t[1]))return null;const i=t[1].length;if(e.expectedType){if("array"!==e.expectedType.kind)return e.error(`Expected ${e.expectedType.kind} but found array.`);s=cs(e.expectedType.itemType,i)}else{if(!(i>0&&ws(t[1][0])))return null;s=cs(ys(t[1][0]),i)}for(let r=0;r<i;r++){const i=t[1][r];let o;if("array"===ks(i))o=e.parse(i,void 0,s.itemType);else{const t=ks(i);if(t!==s.itemType.kind)return e.error(`Expected ${s.itemType.kind} but found ${t}.`);o=e.registry.literal.parse(["literal",void 0===i?null:i],e)}if(!o)return null;n.push(o)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==t.length)return e.error("Expected one argument.");s=Is[i];for(let i=1;i<t.length;i++){const s=e.parse(t[i],i,rs);if(!s)return null;n.push(s)}}return new Cs(s,n)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,i;for(const n of this.args){if(e=n.evaluate(t),i=null,e instanceof Vn)return e;if("string"==typeof e){const i=t.parseColor(e);if(i)return i}else if(Array.isArray(e)&&(i=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:bs(e[0],e[1],e[2],e[3]),!i))return new Vn(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Ts(i||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const i of this.args){if(e=i.evaluate(t),null===e)return 0;const n=Number(e);if(!isNaN(n))return n}throw new Ts(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?vs.fromString(xs(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?gs.fromString(xs(this.args[0].evaluate(t))):"array"===this.type.kind?this.args.map((e=>e.evaluate(t))):xs(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new As([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ss(this.args[0]).serialize();const t="array"===this.type.kind?[]:[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}}const js=["Unknown","Point","LineString","Polygon"];class Ds{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?js[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Vn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}}class Rs{constructor(t,e,i,n,s){this.name=t,this.type=e,this._evaluate=i,this.args=n,this._overloadIndex=s}evaluate(t){if(!this._evaluate){const t=Rs.definitions[this.name];this._evaluate=Array.isArray(t)?t[2]:t.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const i=t[0],n=Rs.definitions[i];if(!n)return e.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(n)?n[0]:n.type,r=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=[];let a=null,h=-1;for(const[n,c]of r){if(Array.isArray(n)&&n.length!==t.length-1)continue;o.push(n),h++,a=new to(e.registry,e.path,null,e.scope,void 0,e._scope,e.options);const r=[];let u=!1;for(let e=1;e<t.length;e++){const i=t[e],s=Array.isArray(n)?n[e-1]:n.type,o=a.parse(i,1+r.length,s);if(!o){u=!0;break}r.push(o)}if(!u)if(Array.isArray(n)&&n.length!==r.length)a.error(`Expected ${n.length} arguments, but found ${r.length} instead.`);else{for(let t=0;t<r.length;t++){const e=Array.isArray(n)?n[t]:n.type,i=r[t];a.concat(t+1).checkSubtype(e,i.type)}if(0===a.errors.length)return new Rs(i,s,c,r,h)}}if(1===o.length)e.errors.push(...a.errors);else{const i=(o.length?o:r.map((([t])=>t))).map(Ps).join(" | "),n=[];for(let i=1;i<t.length;i++){const s=e.parse(t[i],1+n.length);if(!s)return null;n.push(us(s.type))}e.error(`Expected arguments of type ${i}, but found (${n.join(", ")}) instead.`)}return null}static register(t,e){Rs.definitions=e;for(const i in e)t[i]=Rs}}function Ps(t){return Array.isArray(t)?`(${t.map(us).join(", ")})`:`(${us(t.type)}...)`}class Ns{constructor(t,e,i){this.type=os,this.locale=i,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const i=t[1];if("object"!=typeof i||Array.isArray(i))return e.error("Collator options argument must be an object.");const n=e.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,is);if(!n)return null;const s=e.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,is);if(!s)return null;let r=null;return i.locale&&(r=e.parse(i.locale,1,es),!r)?null:new Ns(n,s,r)}evaluate(t){return new ms(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Fs(t,e,i=0,n=t.length-1,s=Ls){for(;n>i;){if(n-i>600){const r=n-i+1,o=e-i+1,a=Math.log(r),h=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*h*(r-h)/r)*(o-r/2<0?-1:1);Fs(t,e,Math.max(i,Math.floor(e-o*h/r+c)),Math.min(n,Math.floor(e+(r-o)*h/r+c)),s)}const r=t[e];let o=i,a=n;for(zs(t,i,e),s(t[n],r)>0&&zs(t,i,n);o<a;){for(zs(t,o,a),o++,a--;s(t[o],r)<0;)o++;for(;s(t[a],r)>0;)a--}0===s(t[i],r)?zs(t,i,a):(a++,zs(t,a,n)),a<=e&&(i=a+1),e<=a&&(n=a-1)}}function zs(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function Ls(t,e){return t<e?-1:t>e?1:0}function $s(t){let e=0;for(let i,n,s=0,r=t.length,o=r-1;s<r;o=s++)i=t[s],n=t[o],e+=(n.x-i.x)*(i.y+n.y);return e}function Us(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Bs(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Gs(t,e,i){const n=t[0]-e[0],s=t[1]-e[1],r=t[0]-i[0],o=t[1]-i[1];return n*o-r*s==0&&n*r<=0&&s*o<=0}function Hs(t,e,i=!1){let n=!1;for(let a=0,h=e.length;a<h;a++){const h=e[a];for(let e=0,a=h.length,c=a-1;e<a;c=e++){const a=h[c],u=h[e];if(Gs(t,a,u))return i;(r=a)[1]>(s=t)[1]!=(o=u)[1]>s[1]&&s[0]<(o[0]-r[0])*(s[1]-r[1])/(o[1]-r[1])+r[0]&&(n=!n)}}var s,r,o;return n}function Vs(t,e,i,n){const s=n[0]-i[0],r=n[1]-i[1],o=(t[0]-i[0])*r-s*(t[1]-i[1]),a=(e[0]-i[0])*r-s*(e[1]-i[1]);return o>0&&a<0||o<0&&a>0}function Ws(t,e,i,n){return 0!=(s=[n[0]-i[0],n[1]-i[1]])[0]*(r=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*r[0]&&!(!Vs(t,e,i,n)||!Vs(i,n,t,e));var s,r}const qs=8192;function Ys(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*qs),Math.round(n*s*qs)]}function Xs(t,e){for(let i=0;i<e.length;i++)if(Hs(t,e[i]))return!0;return!1}function Zs(t,e,i){for(const n of i)for(let i=0,s=n.length,r=s-1;i<s;r=i++)if(Ws(t,e,n[r],n[i]))return!0;return!1}function Js(t,e){for(let i=0;i<t.length;++i)if(!Hs(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Zs(t[i],t[i+1],e))return!1;return!0}function Ks(t,e){for(let i=0;i<e.length;i++)if(Js(t,e[i]))return!0;return!1}function Qs(t,e,i){const n=[];for(let s=0;s<t.length;s++){const r=[];for(let n=0;n<t[s].length;n++){const o=Ys(t[s][n],i);Us(e,o),r.push(o)}n.push(r)}return n}function tr(t,e,i){const n=[];for(let s=0;s<t.length;s++){const r=Qs(t[s],e,i);n.push(r)}return n}function er(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const e=.5*n;let s=t[0]-i[0]>e?-n:i[0]-t[0]>e?n:0;0===s&&(s=t[0]-i[2]>e?-n:i[2]-t[0]>e?n:0),t[0]+=s}Us(e,t)}function ir(t,e,i,n){const s=Math.pow(2,n.z)*qs,r=[n.x*qs,n.y*qs],o=[];if(!t)return o;for(const n of t)for(const t of n){const n=[t.x+r[0],t.y+r[1]];er(n,e,i,s),o.push(n)}return o}function nr(t,e,i,n){const s=Math.pow(2,n.z)*qs,r=[n.x*qs,n.y*qs],o=[];if(!t)return o;for(const i of t){const t=[];for(const n of i){const i=[n.x+r[0],n.y+r[1]];Us(e,i),t.push(i)}o.push(t)}if(e[2]-e[0]<=s/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const n of t)er(n,e,i,s)}var a;return o}class sr{constructor(t,e){this.type=is,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ws(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const i=e.features[t].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new sr(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new sr(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new sr(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],s=t.canonicalID();if(!s)return!1;if("Polygon"===e.type){const r=Qs(e.coordinates,n,s),o=ir(t.geometry(),i,n,s);if(!Bs(i,n))return!1;for(const t of o)if(!Hs(t,r))return!1}if("MultiPolygon"===e.type){const r=tr(e.coordinates,n,s),o=ir(t.geometry(),i,n,s);if(!Bs(i,n))return!1;for(const t of o)if(!Xs(t,r))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const i=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],s=t.canonicalID();if(!s)return!1;if("Polygon"===e.type){const r=Qs(e.coordinates,n,s),o=nr(t.geometry(),i,n,s);if(!Bs(i,n))return!1;for(const t of o)if(!Js(t,r))return!1}if("MultiPolygon"===e.type){const r=tr(e.coordinates,n,s),o=nr(t.geometry(),i,n,s);if(!Bs(i,n))return!1;for(const t of o)if(!Ks(t,r))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const rr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},or=1/298.257223563,ar=or*(2-or),hr=Math.PI/180;class cr{static fromTile(t,e,i){const n=Math.PI*(1-2*(t+.5)/Math.pow(2,e)),s=Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/hr;return new cr(s,i)}static get units(){return rr}constructor(t,e){if(void 0===t)throw new Error("No latitude given.");if(e&&!rr[e])throw new Error(`Unknown unit ${e}. Use one of: ${Object.keys(rr).join(", ")}`);const i=6378.137*hr*(e?rr[e]:1),n=Math.cos(t*hr),s=1/(1-ar*(1-n*n)),r=Math.sqrt(s);this.kx=i*r*n,this.ky=i*r*s*(1-ar)}distance(t,e){const i=fr(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+n*n)}bearing(t,e){const i=fr(e[0]-t[0])*this.kx;return Math.atan2(i,(e[1]-t[1])*this.ky)/hr}destination(t,e,i){const n=i*hr;return this.offset(t,Math.sin(n)*e,Math.cos(n)*e)}offset(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]}lineDistance(t){let e=0;for(let i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e}area(t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];for(let t=0,s=n.length,r=s-1;t<s;r=t++)e+=fr(n[t][0]-n[r][0])*(n[t][1]+n[r][1])*(i?-1:1)}return Math.abs(e)/2*this.kx*this.ky}along(t,e){let i=0;if(e<=0)return t[0];for(let n=0;n<t.length-1;n++){const s=t[n],r=t[n+1],o=this.distance(s,r);if(i+=o,i>e)return lr(s,r,(e-(i-o))/o)}return t[t.length-1]}pointToSegmentDistance(t,e,i){let[n,s]=e,r=fr(i[0]-n)*this.kx,o=(i[1]-s)*this.ky;if(0!==r||0!==o){const e=(fr(t[0]-n)*this.kx*r+(t[1]-s)*this.ky*o)/(r*r+o*o);e>1?(n=i[0],s=i[1]):e>0&&(n+=r/this.kx*e,s+=o/this.ky*e)}return r=fr(t[0]-n)*this.kx,o=(t[1]-s)*this.ky,Math.sqrt(r*r+o*o)}pointOnLine(t,e){let i=1/0,n=t[0][0],s=t[0][1],r=0,o=0;for(let a=0;a<t.length-1;a++){let h=t[a][0],c=t[a][1],u=fr(t[a+1][0]-h)*this.kx,l=(t[a+1][1]-c)*this.ky,f=0;0===u&&0===l||(f=(fr(e[0]-h)*this.kx*u+(e[1]-c)*this.ky*l)/(u*u+l*l),f>1?(h=t[a+1][0],c=t[a+1][1]):f>0&&(h+=u/this.kx*f,c+=l/this.ky*f)),u=fr(e[0]-h)*this.kx,l=(e[1]-c)*this.ky;const d=u*u+l*l;d<i&&(i=d,n=h,s=c,r=a,o=f)}return{point:[n,s],index:r,t:Math.max(0,Math.min(1,o))}}lineSlice(t,e,i){let n=this.pointOnLine(i,t),s=this.pointOnLine(i,e);if(n.index>s.index||n.index===s.index&&n.t>s.t){const t=n;n=s,s=t}const r=[n.point],o=n.index+1,a=s.index;!ur(i[o],r[0])&&o<=a&&r.push(i[o]);for(let t=o+1;t<=a;t++)r.push(i[t]);return ur(i[a],s.point)||r.push(s.point),r}lineSliceAlong(t,e,i){let n=0;const s=[];for(let r=0;r<i.length-1;r++){const o=i[r],a=i[r+1],h=this.distance(o,a);if(n+=h,n>t&&0===s.length&&s.push(lr(o,a,(t-(n-h))/h)),n>=e)return s.push(lr(o,a,(e-(n-h))/h)),s;n>t&&s.push(a)}return s}bufferPoint(t,e){const i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[0]+n,t[1]+i]}bufferBBox(t,e){const i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[2]+n,t[3]+i]}insideBBox(t,e){return fr(t[0]-e[0])>=0&&fr(t[0]-e[2])<=0&&t[1]>=e[1]&&t[1]<=e[3]}}function ur(t,e){return t[0]===e[0]&&t[1]===e[1]}function lr(t,e,i){const n=fr(e[0]-t[0]);return[t[0]+n*i,t[1]+(e[1]-t[1])*i]}function fr(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class dr{constructor(t=[],e=((t,e)=>t<e?-1:t>e?1:0)){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:i}=this,n=e[t];for(;t>0;){const s=t-1>>1,r=e[s];if(i(n,r)>=0)break;e[t]=r,t=s}e[t]=n}_down(t){const{data:e,compare:i}=this,n=this.length>>1,s=e[t];for(;t<n;){let n=1+(t<<1);const r=n+1;if(r<this.length&&i(e[r],e[n])<0&&(n=r),i(e[n],s)>=0)break;e[t]=e[n],t=n}e[t]=s}}var pr=8192;function mr(t,e){return e.dist-t.dist}const _r=100,vr=50;function gr(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function br(t){return t[1]-t[0]+1}function wr(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function yr(t,e){if(t[0]>t[1])return[null,null];const i=br(t);if(e){if(2===i)return[t,null];const e=Math.floor(i/2);return[[t[0],t[0]+e],[t[0]+e,t[1]]]}{if(1===i)return[t,null];const e=Math.floor(i/2)-1;return[[t[0],t[0]+e],[t[0]+e+1,t[1]]]}}function xr(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!wr(e,t.length))return i;for(let n=e[0];n<=e[1];++n)Us(i,t[n]);return i}function Mr(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let n=0;n<t[i].length;++n)Us(e,t[i][n]);return e}function Tr(t,e,i){if(gr(t)||gr(e))return NaN;let n=0,s=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),i.distance([0,0],[n,s])}function Or(t){return 360*t-180}function Er(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Ar(t,e){const i=Math.pow(2,e.z),n=(t.y/pr+e.y)/i;return[Or((t.x/pr+e.x)/i),Er(n)]}function Sr(t,e){const i=[];for(let n=0;n<t.length;++n)i.push(Ar(t[n],e));return i}function kr(t,e,i){const n=i.pointOnLine(e,t).point;return i.distance(t,n)}function Ir(t,e,i,n,s){const r=i.slice(n[0],n[1]+1);let o=1/0;for(let i=e[0];i<=e[1];++i)if(0===(o=Math.min(o,kr(t[i],r,s))))return 0;return o}function Cr(t,e,i,n,s){const r=Math.min(s.pointToSegmentDistance(t,i,n),s.pointToSegmentDistance(e,i,n)),o=Math.min(s.pointToSegmentDistance(i,t,e),s.pointToSegmentDistance(n,t,e));return Math.min(r,o)}function jr(t,e,i,n,s){if(!wr(e,t.length)||!wr(n,i.length))return NaN;let r=1/0;for(let o=e[0];o<e[1];++o)for(let e=n[0];e<n[1];++e){if(Ws(t[o],t[o+1],i[e],i[e+1]))return 0;r=Math.min(r,Cr(t[o],t[o+1],i[e],i[e+1],s))}return r}function Dr(t,e,i,n,s){if(!wr(e,t.length)||!wr(n,i.length))return NaN;let r=1/0;for(let o=e[0];o<=e[1];++o)for(let e=n[0];e<=n[1];++e)if(0===(r=Math.min(r,s.distance(t[o],i[e]))))return r;return r}function Rr(t,e,i){if(Hs(t,e,!0))return 0;let n=1/0;for(const s of e){const e=s.length;if(e<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[e-1]&&0===(n=Math.min(n,i.pointToSegmentDistance(t,s[e-1],s[0]))))return n;if(0===(n=Math.min(n,kr(t,s,i))))return n}return n}function Pr(t,e,i,n){if(!wr(e,t.length))return NaN;for(let n=e[0];n<=e[1];++n)if(Hs(t[n],i,!0))return 0;let s=1/0;for(let r=e[0];r<e[1];++r)for(const e of i)for(let i=0,o=e.length,a=o-1;i<o;a=i++){if(Ws(t[r],t[r+1],e[a],e[i]))return 0;s=Math.min(s,Cr(t[r],t[r+1],e[a],e[i],n))}return s}function Nr(t,e){for(const i of t)for(let t=0;t<=i.length-1;++t)if(Hs(i[t],e,!0))return!0;return!1}function Fr(t,e,i,n=1/0){const s=Mr(t),r=Mr(e);if(n!==1/0&&Tr(s,r,i)>=n)return n;if(Bs(s,r)){if(Nr(t,e))return 0}else if(Nr(e,t))return 0;let o=n;for(const n of t)for(let t=0,s=n.length,r=s-1;t<s;r=t++)for(const s of e)for(let e=0,a=s.length,h=a-1;e<a;h=e++){if(Ws(n[r],n[t],s[h],s[e]))return 0;o=Math.min(o,Cr(n[r],n[t],s[h],s[e],i))}return o}function zr(t,e,i,n,s,r,o){if(null===r||null===o)return;const a=Tr(xr(n,r),xr(s,o),i);a<e&&t.push({dist:a,range1:r,range2:o})}function Lr(t,e,i,n,s=1/0){let r=Math.min(n.distance(t[0],i[0][0]),s);if(0===r)return r;const o=new dr([{dist:0,range1:[0,t.length-1],range2:[0,0]}],mr),a=e?vr:_r,h=Mr(i);for(;o.length;){const s=o.pop();if(s.dist>=r)continue;const c=s.range1;if(br(c)<=a){if(!wr(c,t.length))return NaN;if(e){const e=Pr(t,c,i,n);if(0===(r=Math.min(r,e)))return r}else for(let e=c[0];e<=c[1];++e){const s=Rr(t[e],i,n);if(0===(r=Math.min(r,s)))return r}}else{const i=yr(c,e);if(null!==i[0]){const e=Tr(xr(t,i[0]),h,n);e<r&&o.push({dist:e,range1:i[0],range2:[0,0]})}if(null!==i[1]){const e=Tr(xr(t,i[1]),h,n);e<r&&o.push({dist:e,range1:i[1],range2:[0,0]})}}}return r}function $r(t,e,i,n,s,r=1/0){let o=Math.min(r,s.distance(t[0],i[0]));if(0===o)return o;const a=new dr([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],mr),h=e?vr:_r,c=n?vr:_r;for(;a.length;){const r=a.pop();if(r.dist>=o)continue;const u=r.range1,l=r.range2;if(br(u)<=h&&br(l)<=c){if(!wr(u,t.length)||!wr(l,i.length))return NaN;if(e&&n?o=Math.min(o,jr(t,u,i,l,s)):e||n?e&&!n?o=Math.min(o,Ir(i,l,t,u,s)):!e&&n&&(o=Math.min(o,Ir(t,u,i,l,s))):o=Math.min(o,Dr(t,u,i,l,s)),0===o)return o}else{const r=yr(u,e),h=yr(l,n);zr(a,o,s,t,i,r[0],h[0]),zr(a,o,s,t,i,r[0],h[1]),zr(a,o,s,t,i,r[1],h[0]),zr(a,o,s,t,i,r[1],h[1])}}return o}function Ur(t,e,i,n,s=1/0){let r=s;const o=xr(t,[0,t.length-1]);for(const s of i)if(!(r!==1/0&&Tr(o,xr(s,[0,s.length-1]),n)>=r)&&(r=Math.min(r,$r(t,e,s,!0,n,r)),0===r))return r;return r}function Br(t,e,i,n,s=1/0){let r=s;const o=xr(t,[0,t.length-1]);for(const s of i){if(r!==1/0&&Tr(o,Mr(s),n)>=r)continue;const i=Lr(t,e,s,n,r);if(isNaN(i))return i;if(0===(r=Math.min(r,i)))return r}return r}function Gr(t){return"Point"===t||"MultiPoint"===t||"LineString"===t||"MultiLineString"===t||"Polygon"===t||"MultiPolygon"===t}class Hr{constructor(t,e){this.type=ts,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(ws(t[1])){const e=t[1];if("FeatureCollection"===e.type){for(let t=0;t<e.features.length;++t)if(Gr(e.features[t].geometry.type))return new Hr(e,e.features[t].geometry)}else if("Feature"===e.type){if(Gr(e.geometry.type))return new Hr(e,e.geometry)}else if(Gr(e.type))return new Hr(e,e)}return e.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const e=t.geometry(),i=t.canonicalID();if(null!=e&&null!=i){if("Point"===t.geometryType())return function(t,e,i){const n=[];for(const i of t)for(const t of i)n.push(Ar(t,e));const s=new cr(n[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?$r(n,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,s):"MultiLineString"===i.type?Ur(n,!1,i.coordinates,s):"Polygon"===i.type||"MultiPolygon"===i.type?Br(n,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,s):null}(e,i,this.geometries);if("LineString"===t.geometryType())return function(t,e,i){const n=[];for(const i of t){const t=[];for(const n of i)t.push(Ar(n,e));n.push(t)}const s=new cr(n[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Ur("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,s);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const r=Ur(i.coordinates[e],!0,n,s,t);if(isNaN(r))return r;if(0===(t=Math.min(t,r)))return t}return t}if("Polygon"===i.type||"MultiPolygon"===i.type){let t=1/0;for(let e=0;e<n.length;e++){const r=Br(n[e],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,s,t);if(isNaN(r))return r;if(0===(t=Math.min(t,r)))return t}return t}return null}(e,i,this.geometries);if("Polygon"===t.geometryType())return function(t,e,i){const n=[];for(const i of function(t,e){const i=t.length;if(i<=1)return[t];const n=[];let s,r;for(let e=0;e<i;e++){const i=$s(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===r&&(r=i<0),r===i<0?(s&&n.push(s),s=[t[e]]):s.push(t[e]))}return s&&n.push(s),n}(t)){const t=[];for(let n=0;n<i.length;++n)t.push(Sr(i[n],e));n.push(t)}const s=new cr(n[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Br("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n,s);if("MultiLineString"===i.type){let t=1/0;for(let e=0;e<i.coordinates.length;e++){const r=Br(i.coordinates[e],!0,n,s,t);if(isNaN(r))return r;if(0===(t=Math.min(t,r)))return t}return t}return"Polygon"===i.type||"MultiPolygon"===i.type?function(t,e,i){let n=1/0;for(const s of t)for(const t of e){const e=Fr(s,t,i,n);if(isNaN(e))return e;if(0===(n=Math.min(n,e)))return n}return n}("Polygon"===i.type?[i.coordinates]:i.coordinates,n,s):null}(e,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Vr(t,e){switch(t){case"string":return xs(e);case"number":return+e;case"boolean":return!!e;case"color":return Vn.parse(e);case"formatted":return vs.fromString(xs(e));case"resolvedImage":return gs.fromString(xs(e))}return e}function Wr(t,e,i,n){return void 0!==n&&(t=n*Math.round(t/n)),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t}class qr{constructor(t,e,i){this.type=t,this.key=e,this.scope=i}static parse(t,e){let i=e.expectedType;if(null==i&&(i=rs),t.length<2||t.length>3)return e.error("Invalid number of arguments for 'config' expression.");const n=e.parse(t[1],1);if(!(n instanceof Ms))return e.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const s=e.parse(t[2],2);return s instanceof Ms?new qr(i,xs(n.value),xs(s.value)):e.error("Scope of 'config' expression must be a string literal.")}return new qr(i,xs(n.value))}evaluate(t){const e=[this.key,this.scope,t.scope].filter(Boolean).join(""),i=t.getConfig(e);if(!i)return null;const{type:n,value:s,values:r,minValue:o,maxValue:a,stepValue:h}=i,c=i.default.evaluate(t);let u=c;if(s){const e=t.scope;t.scope=(e||"").split("").slice(1).join(""),u=s.evaluate(t),t.scope=e}return n&&(u=Vr(n,u)),void 0===u||void 0===o&&void 0===a&&void 0===h||("number"==typeof u?u=Wr(u,o,a,h):Array.isArray(u)&&(u=u.map((t=>"number"==typeof t?Wr(t,o,a,h):t)))),void 0!==s&&void 0!==u&&r&&!r.includes(u)&&(u=c,n&&(u=Vr(n,u))),(n&&n!==this.type||void 0!==u&&ys(u)!==this.type)&&(u=Vr(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}function Yr(t){if(t instanceof Rs){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof sr)return!1;if(t instanceof Hr)return!1;let e=!0;return t.eachChild((t=>{e&&!Yr(t)&&(e=!1)})),e}function Xr(t){if(t instanceof Rs&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Xr(t)&&(e=!1)})),e}function Zr(t){if(t instanceof qr)return new Set([t.key]);let e=new Set;return t.eachChild((t=>{e=new Set([...e,...Zr(t)])})),e}function Jr(t,e){if(t instanceof Rs&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild((t=>{i&&!Jr(t,e)&&(i=!1)})),i}class Kr{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const i=t[1];return e.scope.has(i)?new Kr(i,e.scope.get(i)):e.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qr{constructor(t,e=[],i,n=new Kn,s=[],r,o){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=n,this.errors=s,this.expectedType=i,this._scope=r,this.options=o}parse(t,e,i,n,s={}){return e||i?this.concat(e,i,n)._parse(t,s):this._parse(t,s)}_parse(t,e){function i(t,e,i){return"assert"===i?new Es(e,[t]):"coerce"===i?new Cs(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof t[0]?this.registry[t[0]]:void 0;if(n){let s=n.parse(t,this);if(!s)return null;if(this.expectedType){const t=this.expectedType,n=s.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==n.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(t,n))return null}else s=i(s,t,e.typeAnnotation||"coerce");else s=i(s,t,e.typeAnnotation||"assert")}if(!(s instanceof Ms)&&"resolvedImage"!==s.type.kind&&eo(s)){const e=new Ds(this._scope,this.options);try{s=new Ms(s.type,s.evaluate(e))}catch(t){return this.error(t.message),null}}return s}return Cs.parse(["to-array",t],this)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,i){const n="number"==typeof t?this.path.concat(t):this.path,s=i?this.scope.concat(i):this.scope;return new Qr(this.registry,n,e||null,s,this.errors,this._scope,this.options)}error(t,...e){const i=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new Jn(i,t))}checkSubtype(t,e){const i=fs(t,e);return i&&this.error(i),i}}var to=Qr;function eo(t){if(t instanceof Kr)return eo(t.boundExpression);if(t instanceof Rs&&"error"===t.name)return!1;if(t instanceof Ns)return!1;if(t instanceof sr)return!1;if(t instanceof Hr)return!1;if(t instanceof qr)return!1;const e=t instanceof Cs||t instanceof Es;let i=!0;return t.eachChild((t=>{i=e?i&&eo(t):i&&t instanceof Ms})),!!i&&Yr(t)&&Jr(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function io(t,e){const i=t.length-1;let n,s,r=0,o=i,a=0;for(;r<=o;)if(a=Math.floor((r+o)/2),n=t[a],s=t[a+1],n<=e){if(a===i||e<s)return a;r=a+1}else{if(!(n>e))throw new Ts("Input is not a number.");o=a-1}return 0}class no{constructor(t,e,i){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const i=e.parse(t[1],1,ts);if(!i)return null;const n=[];let s=null;e.expectedType&&"value"!==e.expectedType.kind&&(s=e.expectedType);for(let i=1;i<t.length;i+=2){const r=1===i?-1/0:t[i],o=t[i+1],a=i,h=i+1;if("number"!=typeof r)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=r)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=e.parse(o,h,s);if(!c)return null;s=s||c.type,n.push([r,c])}return new no(s,i,n)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const s=e.length;return n>=e[s-1]?i[s-1].evaluate(t):i[io(e,n)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}const so=.95047,ro=1.08883,oo=4/29,ao=6/29,ho=3*ao*ao,co=ao*ao*ao,uo=Math.PI/180,lo=180/Math.PI;function fo(t){return t>co?Math.pow(t,1/3):t/ho+oo}function po(t){return t>ao?t*t*t:ho*(t-oo)}function mo(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function _o(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function vo(t){const e=_o(t.r),i=_o(t.g),n=_o(t.b),s=fo((.4124564*e+.3575761*i+.1804375*n)/so),r=fo((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*r-16,a:500*(s-r),b:200*(r-fo((.0193339*e+.119192*i+.9503041*n)/ro)),alpha:t.a}}function go(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*po(e),i=so*po(i),n=ro*po(n),new Vn(mo(3.2404542*i-1.5371385*e-.4985314*n),mo(-.969266*i+1.8760108*e+.041556*n),mo(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function bo(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const wo={forward:vo,reverse:go,interpolate:function(t,e,i){return{l:qn(t.l,e.l,i),a:qn(t.a,e.a,i),b:qn(t.b,e.b,i),alpha:qn(t.alpha,e.alpha,i)}}},yo={forward:function(t){const{l:e,a:i,b:n}=vo(t),s=Math.atan2(n,i)*lo;return{h:s<0?s+360:s,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*uo,i=t.c;return go({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:bo(t.h,e.h,i),c:qn(t.c,e.c,i),l:qn(t.l,e.l,i),alpha:qn(t.alpha,e.alpha,i)}}};var xo=Object.freeze({__proto__:null,hcl:yo,lab:wo});class Mo{constructor(t,e,i,n,s){this.type=t,this.operator=e,this.interpolation=i,this.input=n,this.labels=[],this.outputs=[];for(const[t,e]of s)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,i,n){let s=0;if("exponential"===t.name)s=To(e,t.base,i,n);else if("linear"===t.name)s=To(e,1,i,n);else if("cubic-bezier"===t.name){const r=t.controlPoints;s=new ze(r[0],r[1],r[2],r[3]).solve(To(e,1,i,n))}return s}static parse(t,e){let[i,n,s,...r]=t;if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const t=n[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:t}}else{if("cubic-bezier"!==n[0])return e.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const t=n.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(s=e.parse(s,2,ts),!s)return null;const o=[];let a=null;"interpolate-hcl"===i||"interpolate-lab"===i?a=ns:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let t=0;t<r.length;t+=2){const i=r[t],n=r[t+1],s=t+3,h=t+4;if("number"!=typeof i)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(o.length&&o[o.length-1][0]>=i)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',s);const c=e.parse(n,h,a);if(!c)return null;a=a||c.type,o.push([i,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Mo(a,i,n,s,o):e.error(`Type ${us(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,i=this.outputs;if(1===e.length)return i[0].evaluate(t);const n=this.input.evaluate(t);if(n<=e[0])return i[0].evaluate(t);const s=e.length;if(n>=e[s-1])return i[s-1].evaluate(t);const r=io(e,n),o=Mo.interpolationFactor(this.interpolation,n,e[r],e[r+1]),a=i[r].evaluate(t),h=i[r+1].evaluate(t);return"interpolate"===this.operator?Xn[this.type.kind.toLowerCase()](a,h,o):"interpolate-hcl"===this.operator?yo.reverse(yo.interpolate(yo.forward(a),yo.forward(h),o)):wo.reverse(wo.interpolate(wo.forward(a),wo.forward(h),o))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function To(t,e,i,n){const s=n-i,r=t-i;return 0===s?0:1===e?r/s:(Math.pow(e,r)-1)/(Math.pow(e,s)-1)}class Oo{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let i=null;const n=e.expectedType;n&&"value"!==n.kind&&(i=n);const s=[];for(const n of t.slice(1)){const t=e.parse(n,1+s.length,i,void 0,{typeAnnotation:"omit"});if(!t)return null;i=i||t.type,s.push(t)}const r=n&&s.some((t=>fs(n,t.type)));return new Oo(r?rs:i,s)}evaluate(t){let e,i=null,n=0;for(const s of this.args){if(n++,i=s.evaluate(t),i&&i instanceof gs&&!i.available&&(e||(e=i),i=null,n===this.args.length))return e;if(null!==i)break}return i}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class Eo{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const i=[];for(let n=1;n<t.length-1;n+=2){const s=t[n];if("string"!=typeof s)return e.error(`Expected string, but found ${typeof s} instead.`,n);if(/[^a-zA-Z0-9_]/.test(s))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);const r=e.parse(t[n+1],n+1);if(!r)return null;i.push([s,r])}const n=e.parse(t[t.length-1],t.length-1,e.expectedType,i);return n?new Eo(i,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,i]of this.bindings)t.push(e,i.serialize());return t.push(this.result.serialize()),t}}class Ao{constructor(t,e,i){this.type=t,this.index=e,this.input=i}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,ts),n=e.parse(t[2],2,cs(e.expectedType||rs));return i&&n?new Ao(n.type.itemType,i,n):null}evaluate(t){const e=this.index.evaluate(t),i=this.input.evaluate(t);if(e<0)throw new Ts(`Array index out of bounds: ${e} < 0.`);if(e>=i.length)throw new Ts(`Array index out of bounds: ${e} > ${i.length-1}.`);if(e!==Math.floor(e))throw new Ts(`Array index must be an integer, but found ${e} instead.`);return i[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class So{constructor(t,e){this.type=is,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,rs),n=e.parse(t[2],2,rs);return i&&n?ds(i.type,[is,es,ts,Qn,rs])?new So(i,n):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${us(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(null==i)return!1;if(!ps(e,["boolean","string","number","null"]))throw new Ts(`Expected first argument to be of type boolean, string, number or null, but found ${us(ys(e))} instead.`);if(!ps(i,["string","array"]))throw new Ts(`Expected second argument to be of type array or string, but found ${us(ys(i))} instead.`);return i.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ko{constructor(t,e,i){this.type=ts,this.needle=t,this.haystack=e,this.fromIndex=i}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,rs),n=e.parse(t[2],2,rs);if(!i||!n)return null;if(!ds(i.type,[is,es,ts,Qn,rs]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${us(i.type)} instead`);if(4===t.length){const s=e.parse(t[3],3,ts);return s?new ko(i,n,s):null}return new ko(i,n)}evaluate(t){const e=this.needle.evaluate(t),i=this.haystack.evaluate(t);if(!ps(e,["boolean","string","number","null"]))throw new Ts(`Expected first argument to be of type boolean, string, number or null, but found ${us(ys(e))} instead.`);if(!ps(i,["string","array"]))throw new Ts(`Expected second argument to be of type array or string, but found ${us(ys(i))} instead.`);if(this.fromIndex){const n=this.fromIndex.evaluate(t);return i.indexOf(e,n)}return i.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Io{constructor(t,e,i,n,s,r){this.inputType=t,this.type=e,this.input=i,this.cases=n,this.outputs=s,this.otherwise=r}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let i,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const s={},r=[];for(let o=2;o<t.length-1;o+=2){let a=t[o];const h=t[o+1];Array.isArray(a)||(a=[a]);const c=e.concat(o);if(0===a.length)return c.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return c.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,ys(t)))return null}else i=ys(t);if(void 0!==s[String(t)])return c.error("Branch labels must be unique.");s[String(t)]=r.length}const u=e.parse(h,o,n);if(!u)return null;n=n||u.type,r.push(u)}const o=e.parse(t[1],1,rs);if(!o)return null;const a=e.parse(t[t.length-1],t.length-1,n);return a?"value"!==o.type.kind&&e.concat(1).checkSubtype(i,o.type)?null:new Io(i,n,o,s,r,a):null}evaluate(t){const e=this.input.evaluate(t);return(ys(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),i=[],n={};for(const t of e){const e=n[this.cases[t]];void 0===e?(n[this.cases[t]]=i.length,i.push([this.cases[t],[t]])):i[e][1].push(t)}const s=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,n]of i)t.push(1===n.length?s(n[0]):n.map(s)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}class Co{constructor(t,e,i){this.type=t,this.branches=e,this.otherwise=i}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);const n=[];for(let s=1;s<t.length-1;s+=2){const r=e.parse(t[s],s,is);if(!r)return null;const o=e.parse(t[s+1],s+1,i);if(!o)return null;n.push([r,o]),i=i||o.type}const s=e.parse(t[t.length-1],t.length-1,i);return s?new Co(i,n,s):null}evaluate(t){for(const[e,i]of this.branches)if(e.evaluate(t))return i.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,i]of this.branches)t(e),t(i);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}class jo{constructor(t,e,i,n){this.type=t,this.input=e,this.beginIndex=i,this.endIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const i=e.parse(t[1],1,rs),n=e.parse(t[2],2,ts);if(!i||!n)return null;if(!ds(i.type,[cs(rs),es,rs]))return e.error(`Expected first argument to be of type array or string, but found ${us(i.type)} instead`);if(4===t.length){const s=e.parse(t[3],3,ts);return s?new jo(i.type,i,n,s):null}return new jo(i.type,i,n)}evaluate(t){const e=this.input.evaluate(t),i=this.beginIndex.evaluate(t);if(!ps(e,["string","array"]))throw new Ts(`Expected first argument to be of type array or string, but found ${us(ys(e))} instead.`);if(this.endIndex){const n=this.endIndex.evaluate(t);return e.slice(i,n)}return e.slice(i)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Do(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ro(t,e,i,n){return 0===n.compare(e,i)}function Po(t,e,i){const n="=="!==t&&"!="!==t;return class s{constructor(t,e,i){this.type=is,this.lhs=t,this.rhs=e,this.collator=i,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const i=t[0];let r=e.parse(t[1],1,rs);if(!r)return null;if(!Do(i,r.type))return e.concat(1).error(`"${i}" comparisons are not supported for type '${us(r.type)}'.`);let o=e.parse(t[2],2,rs);if(!o)return null;if(!Do(i,o.type))return e.concat(2).error(`"${i}" comparisons are not supported for type '${us(o.type)}'.`);if(r.type.kind!==o.type.kind&&"value"!==r.type.kind&&"value"!==o.type.kind)return e.error(`Cannot compare types '${us(r.type)}' and '${us(o.type)}'.`);n&&("value"===r.type.kind&&"value"!==o.type.kind?r=new Es(o.type,[r]):"value"!==r.type.kind&&"value"===o.type.kind&&(o=new Es(r.type,[o])));let a=null;if(4===t.length){if("string"!==r.type.kind&&"string"!==o.type.kind&&"value"!==r.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,os),!a)return null}return new s(r,o,a)}evaluate(s){const r=this.lhs.evaluate(s),o=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){const e=ys(r),i=ys(o);if(e.kind!==i.kind||"string"!==e.kind&&"number"!==e.kind)throw new Ts(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${i.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const t=ys(r),i=ys(o);if("string"!==t.kind||"string"!==i.kind)return e(s,r,o)}return this.collator?i(s,r,o,this.collator.evaluate(s)):e(s,r,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const No=Po("==",(function(t,e,i){return e===i}),Ro),Fo=Po("!=",(function(t,e,i){return e!==i}),(function(t,e,i,n){return!Ro(0,e,i,n)})),zo=Po("<",(function(t,e,i){return e<i}),(function(t,e,i,n){return n.compare(e,i)<0})),Lo=Po(">",(function(t,e,i){return e>i}),(function(t,e,i,n){return n.compare(e,i)>0})),$o=Po("<=",(function(t,e,i){return e<=i}),(function(t,e,i,n){return n.compare(e,i)<=0})),Uo=Po(">=",(function(t,e,i){return e>=i}),(function(t,e,i,n){return n.compare(e,i)>=0}));class Bo{constructor(t,e,i,n,s,r){this.type=es,this.number=t,this.locale=e,this.currency=i,this.unit=n,this.minFractionDigits=s,this.maxFractionDigits=r}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const i=e.parse(t[1],1,ts);if(!i)return null;const n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");let s=null;if(n.locale&&(s=e.parse(n.locale,1,es),!s))return null;let r=null;if(n.currency&&(r=e.parse(n.currency,1,es),!r))return null;let o=null;if(n.unit&&(o=e.parse(n.unit,1,es),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=e.parse(n["min-fraction-digits"],1,ts),!a))return null;let h=null;return n["max-fraction-digits"]&&(h=e.parse(n["max-fraction-digits"],1,ts),!h)?null:new Bo(i,s,r,o,a,h)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Go{constructor(t){this.type=ts,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const i=e.parse(t[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?e.error(`Expected argument of type string or array, but found ${us(i.type)} instead.`):new Go(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Ts(`Expected value to be of type string or array, but found ${us(ys(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}function Ho(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Vo={"==":No,"!=":Fo,">":Lo,"<":zo,">=":Uo,"<=":$o,array:Es,at:Ao,boolean:Es,case:Co,coalesce:Oo,collator:Ns,format:As,image:Ss,in:So,"index-of":ko,interpolate:Mo,"interpolate-hcl":Mo,"interpolate-lab":Mo,length:Go,let:Eo,literal:Ms,match:Io,number:Es,"number-format":Bo,object:Es,slice:jo,step:no,string:Es,"to-boolean":Cs,"to-color":Cs,"to-number":Cs,"to-string":Cs,var:Kr,within:sr,distance:Hr,config:qr};function Wo(t,[e,i,n,s]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const r=s?s.evaluate(t):1,o=bs(e,i,n,r);if(o)throw new Ts(o);return new Vn(e/255*r,i/255*r,n/255*r,r)}function qo(t,[e,i,n,s]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const r=s?s.evaluate(t):1,o=function(t,e,i,n){return"number"==typeof t&&t>=0&&t<=360?"number"==typeof e&&e>=0&&e<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid hsla value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${("number"==typeof n?[t,e,i,n]:[t,e,i]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,n,r);if(o)throw new Ts(o);const a=`hsla(${e}, ${i}%, ${n}%, ${r})`,h=Vn.parse(a);if(!h)throw new Ts(`Failed to parse HSLA color: ${a}`);return h}function Yo(t,e){return t in e}function Xo(t,e){const i=e[t];return void 0===i?null:i}function Zo(t){return{type:t}}function Jo(t){return{result:"success",value:t}}function Ko(t){return{result:"error",value:t}}function Qo(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function ta(t){return"data-driven"===t["property-type"]}function ea(t){return Qo(t.expression,"measure-light")}function ia(t){return Qo(t.expression,"zoom")}function na(t){return!!t.expression&&t.expression.interpolated}function sa(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function ra(t){return t}function oa(t,e){const i="color"===e.type,n=t.stops&&"object"==typeof t.stops[0][0],s=n||!(n||void 0!==t.property),r=t.type||(na(e)?"exponential":"interval");if(i&&((t=Zn({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],Vn.parse(t[1])]))),t.default=Vn.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!xo[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let o,a,h;if("exponential"===r)o=ua;else if("interval"===r)o=ca;else if("categorical"===r){o=ha,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];h=typeof t.stops[0][0]}else{if("identity"!==r)throw new Error(`Unknown function type "${r}"`);o=la}if(n){const i={},n=[];for(let e=0;e<t.stops.length;e++){const s=t.stops[e],r=s[0].zoom;void 0===i[r]&&(i[r]={zoom:r,type:t.type,property:t.property,default:t.default,stops:[]},n.push(r)),i[r].stops.push([s[0].value,s[1]])}const s=[];for(const t of n)s.push([i[t].zoom,oa(i[t],e)]);const r={name:"linear"};return{kind:"composite",interpolationType:r,interpolationFactor:Mo.interpolationFactor.bind(void 0,r),zoomStops:s.map((t=>t[0])),evaluate:({zoom:i},n)=>ua({stops:s,base:t.base},e,i).evaluate(i,n)}}if(s){const i="exponential"===r?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:Mo.interpolationFactor.bind(void 0,i),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:i})=>o(t,e,i,a,h)}}return{kind:"source",evaluate(i,n){const s=n&&n.properties?n.properties[t.property]:void 0;return void 0===s?aa(t.default,e.default):o(t,e,s,a,h)}}}function aa(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function ha(t,e,i,n,s){return aa(typeof i===s?n[i]:void 0,t.default,e.default)}function ca(t,e,i){if("number"!==ks(i))return aa(t.default,e.default);const n=t.stops.length;if(1===n)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const s=io(t.stops.map((t=>t[0])),i);return t.stops[s][1]}function ua(t,e,i){const n=void 0!==t.base?t.base:1;if("number"!==ks(i))return aa(t.default,e.default);const s=t.stops.length;if(1===s)return t.stops[0][1];if(i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];const r=io(t.stops.map((t=>t[0])),i),o=function(t,e,i,n){const s=n-i,r=t-i;return 0===s?0:1===e?r/s:(Math.pow(e,r)-1)/(Math.pow(e,s)-1)}(i,n,t.stops[r][0],t.stops[r+1][0]),a=t.stops[r][1],h=t.stops[r+1][1];let c=Xn[e.type]||ra;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=xo[t.colorSpace];c=(t,i)=>e.reverse(e.interpolate(e.forward(t),e.forward(i),o))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),i=h.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==i)return c(e,i,o)}}:c(a,h,o)}function la(t,e,i){return"color"===e.type?i=Vn.parse(i):"formatted"===e.type?i=vs.fromString(i.toString()):"resolvedImage"===e.type?i=gs.fromString(i.toString()):ks(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),aa(i,t.default,e.default)}Rs.register(Vo,{error:[{kind:"error"},[es],(t,[e])=>{throw new Ts(e.evaluate(t))}],typeof:[es,[rs],(t,[e])=>us(ys(e.evaluate(t)))],"to-rgba":[cs(ts,4),[ns],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[ns,[ts,ts,ts],Wo],rgba:[ns,[ts,ts,ts,ts],Wo],hsl:[ns,[ts,ts,ts],qo],hsla:[ns,[ts,ts,ts,ts],qo],has:{type:is,overloads:[[[es],(t,[e])=>Yo(e.evaluate(t),t.properties())],[[es,ss],(t,[e,i])=>Yo(e.evaluate(t),i.evaluate(t))]]},get:{type:rs,overloads:[[[es],(t,[e])=>Xo(e.evaluate(t),t.properties())],[[es,ss],(t,[e,i])=>Xo(e.evaluate(t),i.evaluate(t))]]},"feature-state":[rs,[es],(t,[e])=>Xo(e.evaluate(t),t.featureState||{})],properties:[ss,[],t=>t.properties()],"geometry-type":[es,[],t=>t.geometryType()],id:[rs,[],t=>t.id()],zoom:[ts,[],t=>t.globals.zoom],pitch:[ts,[],t=>t.globals.pitch||0],"distance-from-center":[ts,[],t=>t.distanceFromCenter()],"measure-light":[ts,[es],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ts,[],t=>t.globals.heatmapDensity||0],"line-progress":[ts,[],t=>t.globals.lineProgress||0],"raster-value":[ts,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[ts,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[ts,[],t=>t.globals.skyRadialProgress||0],accumulated:[rs,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[ts,Zo(ts),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[ts,Zo(ts),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:ts,overloads:[[[ts,ts],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[ts],(t,[e])=>-e.evaluate(t)]]},"/":[ts,[ts,ts],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[ts,[ts,ts],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[ts,[],()=>Math.LN2],pi:[ts,[],()=>Math.PI],e:[ts,[],()=>Math.E],"^":[ts,[ts,ts],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[ts,[ts],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ts,[ts],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ts,[ts],(t,[e])=>Math.log(e.evaluate(t))],log2:[ts,[ts],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ts,[ts],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ts,[ts],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ts,[ts],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ts,[ts],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ts,[ts],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ts,[ts],(t,[e])=>Math.atan(e.evaluate(t))],min:[ts,Zo(ts),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[ts,Zo(ts),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[ts,[ts],(t,[e])=>Math.abs(e.evaluate(t))],round:[ts,[ts],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[ts,[ts],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ts,[ts],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[is,[es,rs],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[is,[rs],(t,[e])=>t.id()===e.value],"filter-type-==":[is,[es],(t,[e])=>t.geometryType()===e.value],"filter-<":[is,[es,rs],(t,[e,i])=>{const n=t.properties()[e.value],s=i.value;return typeof n==typeof s&&n<s}],"filter-id-<":[is,[rs],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[is,[es,rs],(t,[e,i])=>{const n=t.properties()[e.value],s=i.value;return typeof n==typeof s&&n>s}],"filter-id->":[is,[rs],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[is,[es,rs],(t,[e,i])=>{const n=t.properties()[e.value],s=i.value;return typeof n==typeof s&&n<=s}],"filter-id-<=":[is,[rs],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[is,[es,rs],(t,[e,i])=>{const n=t.properties()[e.value],s=i.value;return typeof n==typeof s&&n>=s}],"filter-id->=":[is,[rs],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[is,[rs],(t,[e])=>e.value in t.properties()],"filter-has-id":[is,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[is,[cs(es)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[is,[cs(rs)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[is,[es,cs(rs)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[is,[es,cs(rs)],(t,[e,i])=>function(t,e,i,n){for(;i<=n;){const s=i+n>>1;if(e[s]===t)return!0;e[s]>t?n=s-1:i=s+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:is,overloads:[[[is,is],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[Zo(is),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:is,overloads:[[[is,is],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[Zo(is),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[is,[is],(t,[e])=>!e.evaluate(t)],"is-supported-script":[is,[es],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[es,[es],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[es,[es],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[es,Zo(rs),(t,e)=>e.map((e=>xs(e.evaluate(t)))).join("")],"resolved-locale":[es,[os],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ts,[ts,ts,rs],(t,e)=>{const[i,n,s]=e.map((e=>e.evaluate(t)));if(i>n)return i;if(i===n)return i;let r;if("string"==typeof s)r=function(t){let e=0;if(0===t.length)return e;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}(s);else{if("number"!=typeof s)throw new Ts(`Invalid seed input: ${s}`);r=s}return i+Ho(r)()*(n-i)}]});class fa{constructor(t,e,i,n){this.expression=t,this._warningHistory={},this._evaluator=new Ds(i,n),this._defaultValue=e?function(t){return"color"===t.type&&(sa(t.default)||Array.isArray(t.default))?new Vn(0,0,0,0):"color"===t.type?Vn.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,i,n,s,r,o,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=i,this._evaluator.canonical=n||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=r,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,i,n,s,r,o,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=i||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=r||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new Ts(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${t.message}`)),this._defaultValue}}}function da(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Vo}function pa(t,e,i,n){const s=new to(Vo,[],e?function(t){const e={color:ns,string:es,number:ts,enum:es,boolean:is,formatted:as,resolvedImage:hs};return"array"===t.type?cs(e[t.value]||rs,t.length):e[t.type]}(e):void 0,void 0,void 0,i,n),r=s.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Jo(new fa(r,e,i,n)):Ko(s.errors)}class ma{constructor(t,e,i){this.kind=t,this._styleExpression=e,this.isLightConstant=i,this.isStateDependent="constant"!==t&&!Xr(e.expression),this.configDependencies=Zr(e.expression)}evaluateWithoutErrorHandling(t,e,i,n,s,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,s,r)}evaluate(t,e,i,n,s,r){return this._styleExpression.evaluate(t,e,i,n,s,r)}}class _a{constructor(t,e,i,n,s){this.kind=t,this.zoomStops=i,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Xr(e.expression),this.isLightConstant=s,this.configDependencies=Zr(e.expression),this.interpolationType=n}evaluateWithoutErrorHandling(t,e,i,n,s,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,i,n,s,r)}evaluate(t,e,i,n,s,r){return this._styleExpression.evaluate(t,e,i,n,s,r)}interpolationFactor(t,e,i){return this.interpolationType?Mo.interpolationFactor(this.interpolationType,t,e,i):0}}function va(t,e,i,n){if("error"===(t=pa(t,e,i,n)).result)return t;const s=t.value.expression,r=Yr(s);if(!r&&!ta(e))return Ko([new Jn("","data expressions not supported")]);const o=Jr(s,["zoom","pitch","distance-from-center"]);if(!o&&!ia(e))return Ko([new Jn("","zoom expressions not supported")]);const a=Jr(s,["measure-light"]);if(!a&&!ea(e))return Ko([new Jn("","measure-light expression not supported")]);const h=e.expression&&e.expression.relaxZoomRestriction,c=ba(s);return c||o||h?c instanceof Jn?Ko([c]):c instanceof Mo&&!na(e)?Ko([new Jn("",'"interpolate" expressions cannot be used with this property')]):Jo(c?new _a(r?"camera":"composite",t.value,c.labels,c instanceof Mo?c.interpolation:void 0,a):new ma(r?"constant":"source",t.value,a)):Ko([new Jn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ga{constructor(t,e){this._parameters=t,this._specification=e,Zn(this,oa(this._parameters,this._specification))}static deserialize(t){return new ga(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ba(t){let e=null;if(t instanceof Eo)e=ba(t.result);else if(t instanceof Oo){for(const i of t.args)if(e=ba(i),e)break}else(t instanceof no||t instanceof Mo)&&t.input instanceof Rs&&"zoom"===t.input.name&&(e=t);return e instanceof Jn||t.eachChild((t=>{const i=ba(t);i instanceof Jn?e=i:e&&i&&e!==i&&(e=new Jn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var wa=xa,ya=3;function xa(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(i=s[2]);for(var r=0;r<this.d*this.d;r++){var o=s[ya+r],a=s[ya+r+1];n.push(o===a?null:s.subarray(o,a))}var h=s[ya+n.length+1];this.keys=s.subarray(s[ya+n.length],h),this.bboxes=s.subarray(h),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var c=0;c<this.d*this.d;c++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var u=i/e*t;this.min=-u,this.max=t+u}xa.prototype.insert=function(t,e,i,n,s){this._forEachCell(e,i,n,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(s)},xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xa.prototype._insertCell=function(t,e,i,n,s,r){this.cells[s].push(r)},xa.prototype.query=function(t,e,i,n,s){var r=this.min,o=this.max;if(t<=r&&e<=r&&o<=i&&o<=n&&!s)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,i,n,this._queryCell,a,{},s),a},xa.prototype._queryCell=function(t,e,i,n,s,r,o,a){var h=this.cells[s];if(null!==h)for(var c=this.keys,u=this.bboxes,l=0;l<h.length;l++){var f=h[l];if(void 0===o[f]){var d=4*f;(a?a(u[d+0],u[d+1],u[d+2],u[d+3]):t<=u[d+2]&&e<=u[d+3]&&i>=u[d+0]&&n>=u[d+1])?(o[f]=!0,r.push(c[f])):o[f]=!1}}},xa.prototype._forEachCell=function(t,e,i,n,s,r,o,a){for(var h=this._convertToCellCoord(t),c=this._convertToCellCoord(e),u=this._convertToCellCoord(i),l=this._convertToCellCoord(n),f=h;f<=u;f++)for(var d=c;d<=l;d++){var p=this.d*d+f;if((!a||a(this._convertFromCellCoord(f),this._convertFromCellCoord(d),this._convertFromCellCoord(f+1),this._convertFromCellCoord(d+1)))&&s.call(this,t,e,i,n,p,r,o,a))return}},xa.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},xa.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ya+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var s=new Int32Array(e+i+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var r=e,o=0;o<t.length;o++){var a=t[o];s[ya+o]=r,s.set(a,r),r+=a.length}return s[ya+t.length]=r,s.set(this.keys,r),s[ya+t.length+1]=r+=this.keys.length,s.set(this.bboxes,r),r+=this.bboxes.length,s.buffer};var Ma=f(wa);const Ta={};function Oa(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),Ta[e]={klass:t,omit:i.omit||[]}}Oa(Object,"Object"),Ma.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ma.deserialize=function(t){return new Ma(t.buffer)},Object.defineProperty(Ma,"name",{value:"Grid"}),Oa(Ma,"Grid"),Oa(Vn,"Color"),Oa(Error,"Error"),Oa(vs,"Formatted"),Oa(_s,"FormattedSection"),Oa(tn,"AJAXError"),Oa(gs,"ResolvedImage"),Oa(ga,"StylePropertyFunction"),Oa(fa,"StyleExpression",{omit:["_evaluator"]}),Oa(_a,"ZoomDependentExpression"),Oa(ma,"ZoomConstantExpression"),Oa(Rs,"CompoundExpression",{omit:["_evaluate"]});for(const t in Vo)Ta[Vo[t]._classRegistryKey]||Oa(Vo[t],`Expression${t}`);function Ea(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Aa(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Sa(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Ea(t)||Aa(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(Sa(n,e));return i}if(t instanceof Map){const e={$name:"Map"};for(const[i,n]of t.entries())e[i]=Sa(n);return e}if(t instanceof Set){const e={$name:"Set"};let i=0;for(const n of t.values())e[++i]=Sa(n);return e}if("object"==typeof t){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const s=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const i in t)t.hasOwnProperty(i)&&(Ta[n].omit.indexOf(i)>=0||(s[i]=Sa(t[i],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(s.$name=n),s}throw new Error("can't serialize object of type "+typeof t)}function ka(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Ea(t)||Aa(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(ka);if("object"==typeof t){const e=t.$name||"Object";if("Map"===e){const e=new Map;for(const i of Object.keys(t))"$name"!==i&&e.set(i,ka(t[i]));return e}if("Set"===e){const e=new Set;for(const i of Object.keys(t))"$name"!==i&&e.add(ka(t[i]));return e}const{klass:i}=Ta[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const e of Object.keys(t))"$name"!==e&&(n[e]=ka(t[e]));return n}throw new Error("can't deserialize object of type "+typeof t)}const Ia={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Ca(t){for(const e of t)if(Ra(e.charCodeAt(0)))return!0;return!1}function ja(t){for(const e of t)if(!Da(e.charCodeAt(0)))return!1;return!0}function Da(t){return!(Ia.Arabic(t)||Ia["Arabic Supplement"](t)||Ia["Arabic Extended-A"](t)||Ia["Arabic Presentation Forms-A"](t)||Ia["Arabic Presentation Forms-B"](t))}function Ra(t){return!(746!==t&&747!==t&&(t<4352||!(Ia["Bopomofo Extended"](t)||Ia.Bopomofo(t)||Ia["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ia["CJK Compatibility Ideographs"](t)||Ia["CJK Compatibility"](t)||Ia["CJK Radicals Supplement"](t)||Ia["CJK Strokes"](t)||!(!Ia["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ia["CJK Unified Ideographs Extension A"](t)||Ia["CJK Unified Ideographs"](t)||Ia["Enclosed CJK Letters and Months"](t)||Ia["Hangul Compatibility Jamo"](t)||Ia["Hangul Jamo Extended-A"](t)||Ia["Hangul Jamo Extended-B"](t)||Ia["Hangul Jamo"](t)||Ia["Hangul Syllables"](t)||Ia.Hiragana(t)||Ia["Ideographic Description Characters"](t)||Ia.Kanbun(t)||Ia["Kangxi Radicals"](t)||Ia["Katakana Phonetic Extensions"](t)||Ia.Katakana(t)&&12540!==t||!(!Ia["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ia["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ia["Unified Canadian Aboriginal Syllabics"](t)||Ia["Unified Canadian Aboriginal Syllabics Extended"](t)||Ia["Vertical Forms"](t)||Ia["Yijing Hexagram Symbols"](t)||Ia["Yi Syllables"](t)||Ia["Yi Radicals"](t))))}function Pa(t){return!(Ra(t)||function(t){return!!(Ia["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ia["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ia["Letterlike Symbols"](t)||Ia["Number Forms"](t)||Ia["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ia["Control Pictures"](t)&&9251!==t||Ia["Optical Character Recognition"](t)||Ia["Enclosed Alphanumerics"](t)||Ia["Geometric Shapes"](t)||Ia["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ia["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ia["CJK Symbols and Punctuation"](t)||Ia.Katakana(t)||Ia["Private Use Area"](t)||Ia["CJK Compatibility Forms"](t)||Ia["Small Form Variants"](t)||Ia["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Na(t){return t>=1424&&t<=2303||Ia["Arabic Presentation Forms-A"](t)||Ia["Arabic Presentation Forms-B"](t)}function Fa(t,e){return!(!e&&Na(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ia.Khmer(t))}function za(t){for(const e of t)if(Na(e.charCodeAt(0)))return!0;return!1}const La="deferred",$a="loading",Ua="loaded";let Ba=null,Ga="unavailable",Ha=null;const Va=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Ga="error"),Ba&&Ba(t)};function Wa(){qa.fire(new Pn("pluginStateChange",{pluginStatus:Ga,pluginURL:Ha}))}const qa=new Ln,Ya=function(){return Ga},Xa=function(){if(Ga!==La||!Ha)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ga=$a,Wa(),Ha&&sn({url:Ha},(t=>{t?Va(t):(Ga=Ua,Wa())}))},Za={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ga===Ua||null!=Za.applyArabicShaping,isLoading:()=>Ga===$a,setState(t){Ga=t.pluginStatus,Ha=t.pluginURL},isParsed:()=>null!=Za.applyArabicShaping&&null!=Za.processBidirectionalText&&null!=Za.processStyledBidirectionalText,getPluginURL:()=>Ha};class Ja{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.transition=e.transition,this.pitch=e.pitch,this.brightness=e.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(t,e){for(const i of t)if(!Fa(i.charCodeAt(0),e))return!1;return!0}(t,Za.isLoaded())}}class Ka{constructor(t,e,i,n){this.property=t,this.value=e,this.expression=function(t,e,i,n){if(sa(t))return new ga(t,e);if(da(t)||Array.isArray(t)&&t.length>0){const s=va(t,e,i,n);if("error"===s.result)throw new Error(s.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return s.value}{let i=t;return"string"==typeof t&&"color"===e.type&&(i=Vn.parse(t)),{kind:"constant",configDependencies:new Set,evaluate:()=>i}}}(void 0===e?t.specification.default:e,t.specification,i,n)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,i){return this.property.possiblyEvaluate(this,t,e,i)}}class Qa{constructor(t,e,i){this.property=t,this.value=new Ka(t,void 0,e,i)}transitioned(t,e){return new eh(this.property,this.value,e,ii({},t.transition,this.transition),t.now)}untransitioned(){return new eh(this.property,this.value,null,{},0)}}class th{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=e,this._options=i,this.configDependencies=new Set}getValue(t){return fi(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Qa(this._values[t].property,this._scope,this._options)),this._values[t].value=new Ka(this._values[t].property,null===e?void 0:fi(e),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,e){e&&(this._options=e);const i=this._properties.properties;if(t)for(const e in t){const n=t[e];if(ci(e,"-transition")){const t=e.slice(0,-11);i[t]&&this.setTransition(t,n)}else i.hasOwnProperty(e)&&this.setValue(e,n)}}getTransition(t){return fi(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Qa(this._values[t].property)),this._values[t].transition=fi(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i);const n=this.getTransition(e);void 0!==n&&(t[`${e}-transition`]=n)}return t}transitioned(t,e){const i=new ih(this._properties);for(const n of Object.keys(this._values))i._values[n]=this._values[n].transitioned(t,e._values[n]);return i}untransitioned(){const t=new ih(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class eh{constructor(t,e,i,n,s){const r=n.delay||0,o=n.duration||0;s=s||0,this.property=t,this.value=e,this.begin=s+r,this.end=this.begin+o,t.specification.transition&&(n.delay||n.duration)&&(this.prior=i)}possiblyEvaluate(t,e,i){const n=t.now||0,s=this.value.possiblyEvaluate(t,e,i),r=this.prior;if(r){if(n>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(n<this.begin)return r.possiblyEvaluate(t,e,i);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(r.possiblyEvaluate(t,e,i),s,Ye(o))}}return s}}class ih{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,i){const n=new rh(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].possiblyEvaluate(t,e,i);return n}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class nh{constructor(t,e,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=e,this._options=i,this.configDependencies=new Set}getValue(t){return fi(this._values[t].value)}setValue(t,e){this._values[t]=new Ka(this._values[t].property,null===e?void 0:fi(e),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const e of Object.keys(this._values)){const i=this.getValue(e);void 0!==i&&(t[e]=i)}return t}possiblyEvaluate(t,e,i){const n=new rh(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].possiblyEvaluate(t,e,i);return n}}class sh{constructor(t,e,i){this.property=t,this.value=e,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,i,n){return this.property.evaluate(this.value,this.parameters,t,e,i,n)}}class rh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class oh{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,i){const n=Xn[this.specification.type];return n?n(t,e,i):t}}class ah{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,i,n){return new sh(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},i,n)}:t.expression,e)}interpolate(t,e,i){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new sh(this,{kind:"constant",value:void 0},t.parameters);const n=Xn[this.specification.type];return n?new sh(this,{kind:"constant",value:n(t.value.value,e.value.value,i)},t.parameters):t}evaluate(t,e,i,n,s,r){return"constant"===t.kind?t.value:t.evaluate(e,i,n,s,r)}}class hh{constructor(t){this.specification=t}possiblyEvaluate(t,e,i,n){return!!t.expression.evaluate(e,null,{},i,n)}interpolate(){return!1}}class ch{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const e=new Ja(0,{});for(const i in t){const n=t[i];n.specification.overridable&&this.overridableProperties.push(i);const s=this.defaultPropertyValues[i]=new Ka(n,void 0),r=this.defaultTransitionablePropertyValues[i]=new Qa(n);this.defaultTransitioningPropertyValues[i]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=s.possiblyEvaluate(e)}}}Oa(ah,"DataDrivenProperty"),Oa(oh,"DataConstantProperty"),Oa(hh,"ColorRampProperty");var uh=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function lh(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function fh(t){if(Array.isArray(t))return t.map(fh);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=fh(t[i]);return e}return lh(t)}function dh(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!dh(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ph(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};dh(t)||(t=yh(t));const i=t;let n=!0;try{n=function(t){if(!vh(t))return t;let e=fh(t);return _h(e),e=mh(e),e}(i)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const s=uh[`filter_${e}`],r=pa(n,s);let o=null;if("error"===r.result)throw new Error(r.value.map((t=>`${t.key}: ${t.message}`)).join(", "));o=(t,e,i)=>r.value.evaluate(t,e,{},i);let a=null,h=null;if(n!==i){const t=pa(i,s);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(e,i,n,s,r)=>t.value.evaluate(e,i,{},n,void 0,void 0,s,r),h=!Yr(t.value.expression)}return{filter:o,dynamicFilter:a||void 0,needGeometry:wh(n),needFeature:!!h}}function mh(t){if(!Array.isArray(t))return t;const e=function(t){if(gh.has(t[0]))for(let e=1;e<t.length;e++)if(vh(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>mh(t)))}function _h(t){let e=!1;const i=[];if("case"===t[0]){for(let n=1;n<t.length-1;n+=2)e=e||vh(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||vh(t[1]);for(let e=2;e<t.length-1;e+=2)i.push(t[e+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||vh(t[1]);for(let e=1;e<t.length-1;e+=2)i.push(t[e+1])}e&&(t.length=0,t.push("any",...i));for(let e=1;e<t.length;e++)_h(t[e])}function vh(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let e=1;e<t.length;e++)if(vh(t[e]))return!0;return!1}const gh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function bh(t,e){return t<e?-1:t>e?1:0}function wh(t){if(!Array.isArray(t))return!1;if("within"===t[0]||"distance"===t[0])return!0;for(let e=1;e<t.length;e++)if(wh(t[e]))return!0;return!1}function yh(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?xh(t[1],t[2],"=="):"!="===e?Oh(xh(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?xh(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(yh))):"all"===e?["all"].concat(t.slice(1).map(yh)):"none"===e?["all"].concat(t.slice(1).map(yh).map(Oh)):"in"===e?Mh(t[1],t.slice(2)):"!in"===e?Oh(Mh(t[1],t.slice(2))):"has"===e?Th(t[1]):"!has"!==e||Oh(Th(t[1]));var i}function xh(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Mh(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((t=>typeof t!=typeof e[0]))?["filter-in-large",t,["literal",e.sort(bh)]]:["filter-in-small",t,["literal",e]]}}function Th(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Oh(t){return["!",t]}const Eh="";function Ah(t,e){return e?`${t}${Eh}${e}`:t}const Sh="-transition",kh=new Set(["fill","line","background","hillshade","raster"]);class Ih extends Ln{constructor(t,e,i,n,s){if(super(),this.id=t.id,this.fqid=Ah(this.id,i),this.type=t.type,this.scope=i,this.lut=n,this.options=s,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,"custom"!==t.type&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&"slot"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),e.layout&&(this._unevaluatedLayout=new nh(e.layout,this.scope,s),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),e.paint)){this._transitionablePaint=new th(e.paint,this.scope,s);for(const e in t.paint)this.setPaintProperty(e,t.paint[e]);for(const e in t.layout)this.setLayoutProperty(e,t.layout[e]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rh(e.paint)}}onAdd(t){}onRemove(t){}isDraped(t){return kh.has(this.type)}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e){if("custom"===this.type&&"visibility"===t)return void(this.visibility=e);const i=this._unevaluatedLayout;i._properties.properties[t]&&(i.setValue(t,e),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),"visibility"===t&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return ci(t,Sh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e){const i=this._transitionablePaint,n=i._properties.properties;if(ci(t,Sh)){const s=t.slice(0,-11);return n[s]&&i.setTransition(s,e||void 0),!1}if(!n[t])return!1;const s=i._values[t],r=s.value.isDataDriven(),o=s.value;i.setValue(t,e),this.configDependencies=new Set([...this.configDependencies,...i.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const a=i._values[t].value,h=a.isDataDriven(),c=ci(t,"pattern")||"line-dasharray"===t;return h||r||c||this._handleOverridablePaintPropertyUpdate(t,o,a)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,e,i){return null}_handleOverridablePaintPropertyUpdate(t,e,i){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){return li({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof sh&&ta(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ph(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&("shadow"===t.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,e,i,n,s,r,o,a,h){}queryIntersectsMatchingFeature(t,e,i,n){}}const Ch={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jh{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dh{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Rh(t,e=1){let i=0,n=0;return{members:t.map((t=>{const s=Ch[t.type].BYTES_PER_ELEMENT,r=i=Ph(i,Math.max(e,s)),o=t.components||1;return n=Math.max(n,s),i+=s*o,{name:t.name,type:t.type,components:o,offset:r}})),size:Ph(i,Math.max(n,e)),alignment:e}}function Ph(t,e){return Math.ceil(t/e)*e}class Nh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.int16[n+0]=e,this.int16[n+1]=i,t}}Nh.prototype.bytesPerElement=4,Oa(Nh,"StructArrayLayout2i4");class Fh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const s=3*t;return this.int16[s+0]=e,this.int16[s+1]=i,this.int16[s+2]=n,t}}Fh.prototype.bytesPerElement=6,Oa(Fh,"StructArrayLayout3i6");class zh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n)}emplace(t,e,i,n,s){const r=4*t;return this.int16[r+0]=e,this.int16[r+1]=i,this.int16[r+2]=n,this.int16[r+3]=s,t}}zh.prototype.bytesPerElement=8,Oa(zh,"StructArrayLayout4i8");class Lh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,s)}emplace(t,e,i,n,s,r){const o=5*t;return this.int16[o+0]=e,this.int16[o+1]=i,this.int16[o+2]=n,this.int16[o+3]=s,this.int16[o+4]=r,t}}Lh.prototype.bytesPerElement=10,Oa(Lh,"StructArrayLayout5i10");class $h extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,s,r,o)}emplace(t,e,i,n,s,r,o,a){const h=6*t,c=12*t,u=3*t;return this.int16[h+0]=e,this.int16[h+1]=i,this.uint8[c+4]=n,this.uint8[c+5]=s,this.uint8[c+6]=r,this.uint8[c+7]=o,this.float32[u+2]=a,t}}$h.prototype.bytesPerElement=12,Oa($h,"StructArrayLayout2i4ub1f12");class Uh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n)}emplace(t,e,i,n,s){const r=4*t;return this.float32[r+0]=e,this.float32[r+1]=i,this.float32[r+2]=n,this.float32[r+3]=s,t}}Uh.prototype.bytesPerElement=16,Oa(Uh,"StructArrayLayout4f16");class Bh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const s=3*t;return this.float32[s+0]=e,this.float32[s+1]=i,this.float32[s+2]=n,t}}Bh.prototype.bytesPerElement=12,Oa(Bh,"StructArrayLayout3f12");class Gh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,s)}emplace(t,e,i,n,s,r){const o=6*t,a=3*t;return this.uint16[o+0]=e,this.uint16[o+1]=i,this.uint16[o+2]=n,this.uint16[o+3]=s,this.float32[a+2]=r,t}}Gh.prototype.bytesPerElement=12,Oa(Gh,"StructArrayLayout4ui1f12");class Hh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n)}emplace(t,e,i,n,s){const r=4*t;return this.uint16[r+0]=e,this.uint16[r+1]=i,this.uint16[r+2]=n,this.uint16[r+3]=s,t}}Hh.prototype.bytesPerElement=8,Oa(Hh,"StructArrayLayout4ui8");class Vh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,s,r)}emplace(t,e,i,n,s,r,o){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.int16[a+3]=s,this.int16[a+4]=r,this.int16[a+5]=o,t}}Vh.prototype.bytesPerElement=12,Oa(Vh,"StructArrayLayout6i12");class Wh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o,a,h,c,u,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,e,i,n,s,r,o,a,h,c,u,l)}emplace(t,e,i,n,s,r,o,a,h,c,u,l,f){const d=12*t;return this.int16[d+0]=e,this.int16[d+1]=i,this.int16[d+2]=n,this.int16[d+3]=s,this.uint16[d+4]=r,this.uint16[d+5]=o,this.uint16[d+6]=a,this.uint16[d+7]=h,this.int16[d+8]=c,this.int16[d+9]=u,this.int16[d+10]=l,this.int16[d+11]=f,t}}Wh.prototype.bytesPerElement=24,Oa(Wh,"StructArrayLayout4i4ui4i24");class qh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,i,n,s,r)}emplace(t,e,i,n,s,r,o){const a=10*t,h=5*t;return this.int16[a+0]=e,this.int16[a+1]=i,this.int16[a+2]=n,this.float32[h+2]=s,this.float32[h+3]=r,this.float32[h+4]=o,t}}qh.prototype.bytesPerElement=20,Oa(qh,"StructArrayLayout3i3f20");class Yh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}Yh.prototype.bytesPerElement=4,Oa(Yh,"StructArrayLayout1ul4");class Xh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=i,t}}Xh.prototype.bytesPerElement=4,Oa(Xh,"StructArrayLayout2ui4");class Zh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o,a,h,c,u,l,f){const d=this.length;return this.resize(d+1),this.emplace(d,t,e,i,n,s,r,o,a,h,c,u,l,f)}emplace(t,e,i,n,s,r,o,a,h,c,u,l,f,d){const p=20*t,m=10*t;return this.int16[p+0]=e,this.int16[p+1]=i,this.int16[p+2]=n,this.int16[p+3]=s,this.int16[p+4]=r,this.float32[m+3]=o,this.float32[m+4]=a,this.float32[m+5]=h,this.float32[m+6]=c,this.int16[p+14]=u,this.uint32[m+8]=l,this.uint16[p+18]=f,this.uint16[p+19]=d,t}}Zh.prototype.bytesPerElement=40,Oa(Zh,"StructArrayLayout5i4f1i1ul2ui40");class Jh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,s,r,o)}emplace(t,e,i,n,s,r,o,a){const h=8*t;return this.int16[h+0]=e,this.int16[h+1]=i,this.int16[h+2]=n,this.int16[h+4]=s,this.int16[h+5]=r,this.int16[h+6]=o,this.int16[h+7]=a,t}}Jh.prototype.bytesPerElement=16,Oa(Jh,"StructArrayLayout3i2i2i16");class Kh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,s)}emplace(t,e,i,n,s,r){const o=4*t,a=8*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.int16[a+6]=s,this.int16[a+7]=r,t}}Kh.prototype.bytesPerElement=16,Oa(Kh,"StructArrayLayout2f1f2i16");class Qh extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n)}emplace(t,e,i,n,s){const r=12*t,o=3*t;return this.uint8[r+0]=e,this.uint8[r+1]=i,this.float32[o+1]=n,this.float32[o+2]=s,t}}Qh.prototype.bytesPerElement=12,Oa(Qh,"StructArrayLayout2ub2f12");class tc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i){const n=this.length;return this.resize(n+1),this.emplace(n,t,e,i)}emplace(t,e,i,n){const s=3*t;return this.uint16[s+0]=e,this.uint16[s+1]=i,this.uint16[s+2]=n,t}}tc.prototype.bytesPerElement=6,Oa(tc,"StructArrayLayout3ui6");class ec extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w){const y=this.length;return this.resize(y+1),this.emplace(y,t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w)}emplace(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y){const x=30*t,M=15*t,T=60*t;return this.int16[x+0]=e,this.int16[x+1]=i,this.int16[x+2]=n,this.float32[M+2]=s,this.float32[M+3]=r,this.uint16[x+8]=o,this.uint16[x+9]=a,this.uint32[M+5]=h,this.uint32[M+6]=c,this.uint32[M+7]=u,this.uint16[x+16]=l,this.uint16[x+17]=f,this.uint16[x+18]=d,this.float32[M+10]=p,this.float32[M+11]=m,this.uint8[T+48]=_,this.uint8[T+49]=v,this.uint8[T+50]=g,this.uint32[M+13]=b,this.int16[x+28]=w,this.uint8[T+58]=y,t}}ec.prototype.bytesPerElement=60,Oa(ec,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ic extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y,x,M,T,O,E,A,S,k,I,C){const j=this.length;return this.resize(j+1),this.emplace(j,t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y,x,M,T,O,E,A,S,k,I,C)}emplace(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y,x,M,T,O,E,A,S,k,I,C,j){const D=20*t,R=40*t,P=80*t;return this.float32[D+0]=e,this.float32[D+1]=i,this.int16[R+4]=n,this.int16[R+5]=s,this.int16[R+6]=r,this.int16[R+7]=o,this.int16[R+8]=a,this.int16[R+9]=h,this.int16[R+10]=c,this.int16[R+11]=u,this.int16[R+12]=l,this.uint16[R+13]=f,this.uint16[R+14]=d,this.uint16[R+15]=p,this.uint16[R+16]=m,this.uint16[R+17]=_,this.uint16[R+18]=v,this.uint16[R+19]=g,this.uint16[R+20]=b,this.uint16[R+21]=w,this.uint16[R+22]=y,this.uint16[R+23]=x,this.uint16[R+24]=M,this.uint16[R+25]=T,this.uint16[R+26]=O,this.uint16[R+27]=E,this.uint32[D+14]=A,this.float32[D+15]=S,this.float32[D+16]=k,this.float32[D+17]=I,this.float32[D+18]=C,this.uint8[P+76]=j,t}}ic.prototype.bytesPerElement=80,Oa(ic,"StructArrayLayout2f9i15ui1ul4f1ub80");class nc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}nc.prototype.bytesPerElement=4,Oa(nc,"StructArrayLayout1f4");class sc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,i,n,s)}emplace(t,e,i,n,s,r){const o=5*t;return this.float32[o+0]=e,this.float32[o+1]=i,this.float32[o+2]=n,this.float32[o+3]=s,this.float32[o+4]=r,t}}sc.prototype.bytesPerElement=20,Oa(sc,"StructArrayLayout5f20");class rc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,s,r,o)}emplace(t,e,i,n,s,r,o,a){const h=7*t;return this.float32[h+0]=e,this.float32[h+1]=i,this.float32[h+2]=n,this.float32[h+3]=s,this.float32[h+4]=r,this.float32[h+5]=o,this.float32[h+6]=a,t}}rc.prototype.bytesPerElement=28,Oa(rc,"StructArrayLayout7f28");class oc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,i,n){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,i,n)}emplace(t,e,i,n,s){const r=6*t;return this.uint32[3*t+0]=e,this.uint16[r+2]=i,this.uint16[r+3]=n,this.uint16[r+4]=s,t}}oc.prototype.bytesPerElement=12,Oa(oc,"StructArrayLayout1ul3ui12");class ac extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}ac.prototype.bytesPerElement=2,Oa(ac,"StructArrayLayout1ui2");class hc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const i=this.length;return this.resize(i+1),this.emplace(i,t,e)}emplace(t,e,i){const n=2*t;return this.float32[n+0]=e,this.float32[n+1]=i,t}}hc.prototype.bytesPerElement=8,Oa(hc,"StructArrayLayout2f8");class cc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m)}emplace(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_){const v=16*t;return this.float32[v+0]=e,this.float32[v+1]=i,this.float32[v+2]=n,this.float32[v+3]=s,this.float32[v+4]=r,this.float32[v+5]=o,this.float32[v+6]=a,this.float32[v+7]=h,this.float32[v+8]=c,this.float32[v+9]=u,this.float32[v+10]=l,this.float32[v+11]=f,this.float32[v+12]=d,this.float32[v+13]=p,this.float32[v+14]=m,this.float32[v+15]=_,t}}cc.prototype.bytesPerElement=64,Oa(cc,"StructArrayLayout16f64");class uc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,i,n,s,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,i,n,s,r,o)}emplace(t,e,i,n,s,r,o,a){const h=10*t,c=5*t;return this.uint16[h+0]=e,this.uint16[h+1]=i,this.uint16[h+2]=n,this.uint16[h+3]=s,this.float32[c+2]=r,this.float32[c+3]=o,this.float32[c+4]=a,t}}uc.prototype.bytesPerElement=20,Oa(uc,"StructArrayLayout4ui3f20");class lc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.int16[1*t+0]=e,t}}lc.prototype.bytesPerElement=2,Oa(lc,"StructArrayLayout1i2");class fc extends Dh{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint8[1*t+0]=e,t}}fc.prototype.bytesPerElement=1,Oa(fc,"StructArrayLayout1ub1");class dc extends jh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}dc.prototype.size=40;class pc extends Zh{get(t){return new dc(this,t)}}Oa(pc,"CollisionBoxArray");class mc extends jh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}mc.prototype.size=60;class _c extends ec{get(t){return new mc(this,t)}}Oa(_c,"PlacedSymbolArray");class vc extends jh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}vc.prototype.size=80;class gc extends ic{get(t){return new vc(this,t)}}Oa(gc,"SymbolInstanceArray");class bc extends nc{getoffsetX(t){return this.float32[1*t+0]}}Oa(bc,"GlyphOffsetArray");class wc extends Nh{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Oa(wc,"SymbolLineVertexArray");class yc extends jh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}yc.prototype.size=12;class xc extends oc{get(t){return new yc(this,t)}}Oa(xc,"FeatureIndexArray");class Mc extends Xh{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Oa(Mc,"FillExtrusionCentroidArray");class Tc extends jh{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}Tc.prototype.size=8;class Oc extends zh{get(t){return new Tc(this,t)}}Oa(Oc,"FillExtrusionWallArray");const Ec=Rh([{name:"a_pos",components:2,type:"Int16"}],4),Ac=Rh([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Sc{constructor(t=[]){this.segments=t}_prepareSegment(t,e,i,n){let s=this.segments[this.segments.length-1];return t>Sc.MAX_VERTEX_ARRAY_LENGTH&&pi(`Max vertices per segment is ${Sc.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!s||s.vertexLength+t>Sc.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==n)&&(s={vertexOffset:e,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==n&&(s.sortKey=n),this.segments.push(s)),s}prepareSegment(t,e,i,n){return this._prepareSegment(t,e.length,i.length,n)}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,i,n){return new Sc([{vertexOffset:t,primitiveOffset:e,vertexLength:i,primitiveLength:n,vaos:{},sortKey:0}])}}function kc(t,e){return 256*(t=Je(Math.floor(t),0,255))+Je(Math.floor(e),0,255)}Sc.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Oa(Sc,"SegmentVector");const Ic=Rh([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Cc=Rh([{name:"a_dash",components:4,type:"Uint16"}]);class jc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,e,i,n){this.ids.push(Dc(t)),this.positions.push(e,i,n)}eachPosition(t,e){const i=Dc(t);let n=0,s=this.ids.length-1;for(;n<s;){const t=n+s>>1;this.ids[t]>=i?s=t:n=t+1}for(;this.ids[n]===i;)e(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(t,e){const i=new Float64Array(t.ids),n=new Uint32Array(t.positions);return Rc(i,n,0,i.length-1),e&&(e.add(i.buffer),e.add(n.buffer)),{ids:i,positions:n}}static deserialize(t){const e=new jc;let i;e.ids=t.ids,e.positions=t.positions;for(const t of e.ids)t!==i&&e.uniqueIds.push(t),i=t;return e.indexed=!0,e}}function Dc(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Rn(String(t))}function Rc(t,e,i,n){for(;i<n;){const s=t[i+n>>1];let r=i-1,o=n+1;for(;;){do{r++}while(t[r]<s);do{o--}while(t[o]>s);if(r>=o)break;Pc(t,r,o),Pc(e,3*r,3*o),Pc(e,3*r+1,3*o+1),Pc(e,3*r+2,3*o+2)}o-i<n-o?(Rc(t,e,i,o),i=o+1):(Rc(t,e,o+1,n),n=o)}}function Pc(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}Oa(jc,"FeaturePositionMap");class Nc{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,e){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,e),this.initialized=!0),!!this.location}set(t,e,i){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Fc extends Nc{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class zc extends Nc{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Lc extends Nc{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class $c extends Nc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Uc extends Nc{constructor(t){super(t),this.current=[0,0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Bc extends Nc{constructor(t){super(t),this.current=Vn.transparent.toRenderColor(null)}set(t,e,i){this.fetchUniformLocation(t,e)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Gc=new Float32Array(16);class Hc extends Nc{constructor(t){super(t),this.current=Gc}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Vc=new Float32Array(9),Wc=new Float32Array(4);class qc extends Nc{constructor(t){super(t),this.current=Wc}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<4;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function Yc(t){return[kc(255*t.r,255*t.g),kc(255*t.b,255*t.a)]}class Xc{constructor(t,e,i,n){this.value=t,this.uniformNames=e.map((t=>`u_${t}`)),this.type=i,this.context=n}setUniform(t,e,i,n,s){const r=n.constantOr(this.value);e.set(t,s,r instanceof Vn?r.toRenderColor(this.context.lut):r)}getBinding(t,e){return"color"===this.type?new Bc(t):new zc(t)}}class Zc{constructor(t,e){this.uniformNames=e.map((t=>`u_${t}`)),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,e,i,n,s){const r="u_pattern"===s||"u_dash"===s?this.pattern:"u_pixel_ratio"===s?this.pixelRatio:null;r&&e.set(t,s,r)}getBinding(t,e){return"u_pattern"===e||"u_dash"===e?new Uc(t):new zc(t)}}class Jc{constructor(t,e,i,n){this.expression=t,this.type=i,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new n}populatePaintArray(t,e,i,n,s,r,o){const a=this.paintVertexArray.length,h=this.expression.evaluate(new Ja(0,{brightness:r}),e,{},s,n,o);this.paintVertexArray.resize(t),this._setPaintValue(a,t,h,this.context)}updatePaintArray(t,e,i,n,s,r,o){const a=this.expression.evaluate({zoom:0,brightness:o},i,n,void 0,s);this._setPaintValue(t,e,a,this.context)}_setPaintValue(t,e,i,n){if("color"===this.type){const s=Yc(i.toRenderColor(n.lut));for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,s[0],s[1])}else{for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Kc{constructor(t,e,i,n,s,r){this.expression=t,this.uniformNames=e.map((t=>`u_${t}_t`)),this.type=i,this.useIntegerZoom=n,this.context=s,this.maxValue=0,this.paintVertexAttributes=e.map((t=>({name:`a_${t}`,type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new r}populatePaintArray(t,e,i,n,s,r,o){const a=this.expression.evaluate(new Ja(this.context.zoom,{brightness:r}),e,{},s,n,o),h=this.expression.evaluate(new Ja(this.context.zoom+1,{brightness:r}),e,{},s,n,o),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,a,h,this.context)}updatePaintArray(t,e,i,n,s,r,o){const a=this.expression.evaluate({zoom:this.context.zoom,brightness:o},i,n,void 0,s),h=this.expression.evaluate({zoom:this.context.zoom+1,brightness:o},i,n,void 0,s);this._setPaintValue(t,e,a,h,this.context)}_setPaintValue(t,e,i,n,s){if("color"===this.type){const n=Yc(i.toRenderColor(s.lut)),r=Yc(i.toRenderColor(s.lut));for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1],r[0],r[1])}else{for(let s=t;s<e;s++)this.paintVertexArray.emplace(s,i,n);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e,i,n,s){const r=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,o=Je(this.expression.interpolationFactor(r,this.context.zoom,this.context.zoom+1),0,1);e.set(t,s,o)}getBinding(t,e){return new zc(t)}}class Qc{constructor(t,e,i,n,s){this.expression=t,this.layerId=s,this.paintVertexAttributes=("array"===i?Cc:Ic).members;this.paintVertexArray=new n}populatePaintArray(t,e,i,n){const s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(s,t,e.patterns&&e.patterns[this.layerId],i)}updatePaintArray(t,e,i,n,s,r,o){this._setPaintValues(t,e,i.patterns&&i.patterns[this.layerId],r)}_setPaintValues(t,e,i,n){if(!n||!i)return;const s=n[i];if(!s)return;const{tl:r,br:o,pixelRatio:a}=s;for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1],o[0],o[1],a)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tu{constructor(t,e,i=(()=>!0)){this.binders={},this._buffers=[],this.context=e;const n=[];for(const s in t.paint._values){const r=t.paint.get(s);if(!i(s))continue;if(!(r instanceof sh&&ta(r.property.specification)))continue;const o=nu(s,t.type),a=r.value,h=r.property.specification.type,c=!!r.property.useIntegerZoom,u="line-dasharray"===s||s.endsWith("pattern"),l="line-dasharray"===s&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||l)if("source"===a.kind||l||u){const e=ou(s,h,"source");this.binders[s]=u?new Qc(a,o,h,e,t.id):new Jc(a,o,h,e),n.push(`/a_${s}`)}else{const t=ou(s,h,"composite");this.binders[s]=new Kc(a,o,h,c,e,t),n.push(`/z_${s}`)}else this.binders[s]=u?new Zc(a.value,o):new Xc(a.value,o,h,e),n.push(`/u_${s}`)}this.cacheKey=n.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Jc||e instanceof Kc?e.maxValue:0}populatePaintArrays(t,e,i,n,s,r,o){for(const a in this.binders){const h=this.binders[a];h.context=this.context,(h instanceof Jc||h instanceof Kc||h instanceof Qc)&&h.populatePaintArray(t,e,i,n,s,r,o)}}setConstantPatternPositions(t){for(const e in this.binders){const i=this.binders[e];i instanceof Zc&&i.setConstantPatternPositions(t)}}updatePaintArrays(t,e,i,n,s,r,o,a){let h=!1;const c=Object.keys(t),u=0!==c.length,l=u?c:e.uniqueIds;this.context.lut=s.lut;for(const c in this.binders){const f=this.binders[c];if(f.context=this.context,(f instanceof Jc||f instanceof Kc||f instanceof Qc)&&(!0===f.expression.isStateDependent||!1===f.expression.isLightConstant)){const d=s.paint.get(c);f.expression=d.value;for(const i of l){const s=t[i.toString()];e.eachPosition(i,((t,e,i)=>{const h=n.feature(t);f.updatePaintArray(e,i,h,s,r,o,a)}))}if(!u)for(const e of i.uniqueIds){const s=t[e.toString()];i.eachPosition(e,((t,e,i)=>{const h=n.feature(t);f.updatePaintArray(e,i,h,s,r,o,a)}))}h=!0}}return h}defines(){const t=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Xc||i instanceof Zc)&&t.push(...i.uniformNames.map((t=>`#define HAS_UNIFORM_${t}`)))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Jc||i instanceof Kc||i instanceof Qc)for(let e=0;e<i.paintVertexAttributes.length;e++)t.push(i.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const i=this.binders[e];if(i instanceof Xc||i instanceof Zc||i instanceof Kc)for(const e of i.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof Xc||n instanceof Zc||n instanceof Kc)for(const s of n.uniformNames)e.push({name:s,property:i,binding:n.getBinding(t,s)})}return e}setUniforms(t,e,i,n,s){for(const{name:e,property:r,binding:o}of i)this.binders[r].setUniform(t,o,s,n.get(r),e)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const e=this.binders[t];(e instanceof Jc||e instanceof Kc||e instanceof Qc)&&e.paintVertexBuffer&&this._buffers.push(e.paintVertexBuffer)}}upload(t){for(const e in this.binders){const i=this.binders[e];(i instanceof Jc||i instanceof Kc||i instanceof Qc)&&i.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Jc||e instanceof Kc||e instanceof Qc)&&e.destroy()}}}class eu{constructor(t,e,i=(()=>!0)){this.programConfigurations={};for(const n of t)this.programConfigurations[n.id]=new tu(n,e,i);this.needsUpload=!1,this._featureMap=new jc,this._featureMapWithoutIds=new jc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,e,i,n,s,r,o,a){for(const i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,n,s,r,o,a);void 0!==e.id?this._featureMap.add(e.id,i,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,i,n,s,r){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,e,o,n,s,r||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const iu={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function nu(t,e){return iu[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const su={"line-pattern":{source:Gh,composite:Gh},"fill-pattern":{source:Gh,composite:Gh},"fill-extrusion-pattern":{source:Gh,composite:Gh},"line-dasharray":{source:Hh,composite:Hh}},ru={color:{source:hc,composite:Uh},number:{source:nc,composite:hc}};function ou(t,e,i){const n=su[t];return n&&n[i]||ru[e][i]}Oa(Xc,"ConstantBinder"),Oa(Zc,"PatternConstantBinder"),Oa(Jc,"SourceExpressionBinder"),Oa(Qc,"PatternCompositeBinder"),Oa(Kc,"CompositeExpressionBinder"),Oa(tu,"ProgramConfiguration",{omit:["_buffers"]}),Oa(eu,"ProgramConfigurationSet");const au=pr/Math.PI/2,hu=5,cu=6,uu=16383,lu=64,fu=[lu,32,16],du=-au,pu=au;function mu(t,e,i,n=au){return i=Ve(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function _u(t,e,i){return mu(Math.cos(Ve(t)),Math.sin(Ve(t)),e,i)}const vu=6371008.8,gu=2*Math.PI*vu;class bu{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bu(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,s=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return vu*Math.acos(Math.min(s,1))}toBounds(t=0){const e=360*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return new wu({lng:this.lng-i,lat:this.lat-e},{lng:this.lng+i,lat:this.lat+e})}toEcef(t){return _u(this.lat,this.lng,au+t*au/vu)}static convert(t){if(t instanceof bu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new bu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new bu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class wu{constructor(t,e){if(t)if(e)this.setSouthWest(t).setNorthEast(e);else if(4===t.length){const e=t;this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]])}else{const e=t;this.setSouthWest(e[0]).setNorthEast(e[1])}}setNorthEast(t){return this._ne=t instanceof bu?new bu(t.lng,t.lat):bu.convert(t),this}setSouthWest(t){return this._sw=t instanceof bu?new bu(t.lng,t.lat):bu.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,s;if(t instanceof bu)n=t,s=t;else{if(!(t instanceof wu))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(wu.convert(t)):this.extend(bu.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(bu.convert(t)):this;if(n=t._sw,s=t._ne,!n||!s)return this}return e||i?(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(s.lng,i.lng),i.lat=Math.max(s.lat,i.lat)):(this._sw=new bu(n.lng,n.lat),this._ne=new bu(s.lng,s.lat)),this}getCenter(){return new bu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bu(this.getWest(),this.getNorth())}getSouthEast(){return new bu(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=bu.convert(t);let n=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&n}static convert(t){return!t||t instanceof wu?t:new wu(t)}}var yu={};!function(t,e){!function(t){function e(t,e,n){var s=i(256*t,256*(e=Math.pow(2,n)-e-1),n),r=i(256*(t+1),256*(e+1),n);return s[0]+","+s[1]+","+r[0]+","+r[1]}function i(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}t.getURL=function(t,i,n,s,r,o){return o=o||{},t+"?"+["bbox="+e(n,s,r),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+i].join("&")},t.getTileBBox=e,t.getMercCoords=i,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(0,yu);var xu=yu;class Mu{constructor(t,e,i){this.z=t,this.x=e,this.y=i,this.key=Eu(0,t,t,e,i)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const i=xu.getTileBBox(this.x,this.y,this.z),n=function(t,e,i){let n,s="";for(let r=t;r>0;r--)n=1<<r-1,s+=(e&n?1:0)+(i&n?2:0);return s}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tu{constructor(t,e){this.wrap=t,this.canonical=e,this.key=Eu(t,e.z,e.z,e.x,e.y)}}class Ou{constructor(t,e,i,n,s){this.overscaledZ=t,this.wrap=e,this.canonical=new Mu(i,+n,+s),this.key=0===e&&t===i?this.canonical.key:Eu(e,t,i,n,s)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new Ou(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ou(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return Eu(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-t;return Eu(this.wrap*+e,t,t,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Ou(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,i=2*this.canonical.x,n=2*this.canonical.y;return[new Ou(e,this.wrap,e,i,n),new Ou(e,this.wrap,e,i+1,n),new Ou(e,this.wrap,e,i,n+1),new Ou(e,this.wrap,e,i+1,n+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Ou(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Ou(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Eu(t,e,i,n,s){const r=1<<Math.min(i,22);let o=r*(s%r)+n%r;return t&&i<22&&(o+=r*r*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*o+i)+(e-i)}const Au=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new Ou(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new Ou(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new Ou(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1),t=>new Ou(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Oa(Mu,"CanonicalTileID"),Oa(Ou,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Su=0,ku=25.5;function Iu(t){return gu*Math.cos(t*Math.PI/180)}function Cu(t){return(180+t)/360}function ju(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Du(t,e){return t/Iu(e)}function Ru(t){return 360*t-180}function Pu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Nu(t,e){return t*Iu(Pu(e))}const Fu=85.051129;function zu(t){return Math.cos(Ve(Je(t,-Fu,Fu)))}function Lu(t,e){const i=Je(e,Su,ku),n=Math.pow(2,i);return zu(t)*gu/(512*n)}function $u(t){return 1/Math.cos(t*Math.PI/180)}function Uu(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/pr)/(1<<t.z)*2));return 80150034*i/(i*i+1)/pr/(1<<t.z)}class Bu{constructor(t,e,i=0){this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=bu.convert(t);return new Bu(Cu(i.lng),ju(i.lat),Du(e,i.lat))}toLngLat(){return new bu(Ru(this.x),Pu(this.y))}toAltitude(){return Nu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gu*$u(Pu(this.y))}}function Gu(t,e,i,n,s,r,o,a,h){const c=(e+n)/2,u=(i+s)/2,l=new Ue(c,u);a(l),function(t,e,i,n,s,r){const o=i-s,a=n-r;return Math.abs((n-e)*o-(i-t)*a)/Math.hypot(o,a)}(l.x,l.y,r.x,r.y,o.x,o.y)>=h?(Gu(t,e,i,c,u,r,l,a,h),Gu(t,c,u,n,s,l,o,a,h)):t.push(o)}function Hu(t,e,i){let n=t[0],s=n.x,r=n.y;e(n);const o=[n];for(let a=1;a<t.length;a++){const h=t[a],{x:c,y:u}=h;e(h),Gu(o,s,r,c,u,n,h,e,i),s=c,r=u,n=h}return o}function Vu(t,e,i,n){if(n(e,i)){const s=e.add(i)._mult(.5);Vu(t,e,s,n),Vu(t,s,i,n)}else t.push(i)}function Wu(t,e){let i=t[0];const n=[i];for(let s=1;s<t.length;s++){const r=t[s];Vu(n,i,r,e),i=r}return n}const qu=Math.pow(2,14)-1,Yu=-qu-1;function Xu(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Je(i,Yu,qu),t.y=Je(n,Yu,qu),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&pi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Zu(t,e,i){const n=t.loadGeometry(),s=t.extent,r=pr/s;if(e&&i&&i.projection.isReprojectedInTileSpace){const r=1<<e.z,{scale:o,x:a,y:h,projection:c}=i,u=t=>{const i=Ru((e.x+t.x/s)/r),n=Pu((e.y+t.y/s)/r),u=c.project(i,n);t.x=(u.x*o-a)*s,t.y=(u.y*o-h)*s};for(let e=0;e<n.length;e++)if(1!==t.type)n[e]=Hu(n[e],u,1);else{const t=[];for(const i of n[e])i.x<0||i.x>=s||i.y<0||i.y>=s||(u(i),t.push(i));n[e]=t}}for(const t of n)for(const e of t)Xu(e,r);return n}function Ju(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Zu(t):[]}}function Ku(t,e,i,n,s){t.emplaceBack(2*e+(n+1)/2,2*i+(s+1)/2)}function Qu(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class tl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Nh,this.indexArray=new tc,this.segments=new Sc,this.programConfigurations=new eu(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id))}updateFootprints(t,e){}populate(t,e,i,n){const s=this.layers[0],r=[];let o=null;"circle"===s.type&&(o=s.layout.get("circle-sort-key"));for(const{feature:e,id:s,index:a,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Ju(e,t);if(!this.layers[0]._featureFilter.filter(new Ja(this.zoom),c,i))continue;const u=o?o.evaluate(c,{},i):void 0,l={id:s,properties:e.properties,type:e.type,sourceLayerIndex:h,index:a,geometry:t?c.geometry:Zu(e,i,n),patterns:{},sortKey:u};r.push(l)}o&&r.sort(((t,e)=>t.sortKey-e.sortKey));let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Vh,a=n.projection);for(const n of r){const{geometry:s,index:r,sourceLayerIndex:o}=n,h=t[r].feature;this.addFeature(n,s,r,e.availableImages,i,a,e.brightness),e.featureIndex.insert(h,s,r,o,this.index)}}update(t,e,i,n,s){const r=0!==Object.keys(t).length;r&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,r?this.stateDependentLayers:this.layers,i,n,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ec.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Ac.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,i,n,s,r,o){for(const i of e)for(const e of i){const i=e.x,n=e.y;if(i<0||i>=pr||n<0||n>=pr)continue;if(r){const t=r.projectTilePoint(i,n,s),e=r.upVector(s,i,n),o=this.globeExtVertexArray;Qu(o,t,e),Qu(o,t,e),Qu(o,t,e),Qu(o,t,e)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=o.vertexLength;Ku(this.layoutVertexArray,i,n,-1,-1),Ku(this.layoutVertexArray,i,n,1,-1),Ku(this.layoutVertexArray,i,n,1,1),Ku(this.layoutVertexArray,i,n,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,{},n,s,o)}}function el(t,e){for(let i=0;i<t.length;i++)if(ul(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ul(t,e[i]))return!0;return!!rl(t,e)}function il(t,e,i){return!!ul(t,e)||!!al(e,t,i)}function nl(t,e){if(1===t.length)return cl(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++)if(ul(t,n[e]))return!0}for(let i=0;i<t.length;i++)if(cl(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(rl(t,e[i]))return!0;return!1}function sl(t,e,i){if(t.length>1){if(rl(t,e))return!0;for(let n=0;n<e.length;n++)if(al(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(al(t[n],e,i))return!0;return!1}function rl(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],s=t[i+1];for(let t=0;t<e.length-1;t++)if(ol(n,s,e[t],e[t+1]))return!0}return!1}function ol(t,e,i,n){return mi(t,i,n)!==mi(e,i,n)&&mi(t,e,i)!==mi(t,e,n)}function al(t,e,i){const n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(hl(t,e[i-1],e[i])<n)return!0;return!1}function hl(t,e,i){const n=e.distSqr(i);if(0===n)return t.distSqr(e);const s=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function cl(t,e){let i,n,s,r=!1;for(let o=0;o<t.length;o++){i=t[o];for(let t=0,o=i.length-1;t<i.length;o=t++)n=i[t],s=i[o],n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(r=!r)}return r}function ul(t,e){let i=!1;for(let n=0,s=t.length-1;n<t.length;s=n++){const r=t[n],o=t[s];r.y>e.y!=o.y>e.y&&e.x<(o.x-r.x)*(e.y-r.y)/(o.y-r.y)+r.x&&(i=!i)}return i}function ll(t,e,i,n,s){for(const r of t)if(e<=r.x&&i<=r.y&&n>=r.x&&s>=r.y)return!0;const r=[new Ue(e,i),new Ue(e,s),new Ue(n,s),new Ue(n,i)];if(t.length>2)for(const e of r)if(ul(t,e))return!0;for(let e=0;e<t.length-1;e++)if(fl(t[e],t[e+1],r))return!0;return!1}function fl(t,e,i){const n=i[0],s=i[2];if(t.x<n.x&&e.x<n.x||t.x>s.x&&e.x>s.x||t.y<n.y&&e.y<n.y||t.y>s.y&&e.y>s.y)return!1;const r=mi(t,e,i[0]);return r!==mi(t,e,i[1])||r!==mi(t,e,i[2])||r!==mi(t,e,i[3])}function dl(t,e,i,n,s,r){let o=e.y-t.y,a=t.x-e.x;if(r=r||0){const t=o*o+a*a;if(0===t)return!0;const e=Math.sqrt(t);o/=e,a/=e}return!((i.x-t.x)*o+(i.y-t.y)*a-r<0||(n.x-t.x)*o+(n.y-t.y)*a-r<0||(s.x-t.x)*o+(s.y-t.y)*a-r<0)}function pl(t,e,i,n,s,r,o){return!(dl(t,e,n,s,r,o)||dl(e,i,n,s,r,o)||dl(i,t,n,s,r,o)||dl(n,s,t,e,i,o)||dl(s,r,t,e,i,o)||dl(r,n,t,e,i,o))}function ml(t,e,i){const n=e.paint.get(t).value;return"constant"===n.kind?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function _l(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function vl(t,e,i,n,s){if(!e[0]&&!e[1])return t;const r=Ue.convert(e)._mult(s);"viewport"===i&&r._rotate(-n);const o=[];for(let e=0;e<t.length;e++)o.push(t[e].sub(r));return o}function gl(t,e,i,n){const s=Ue.convert(t)._mult(n);return"viewport"===e&&s._rotate(-i),s}let bl,wl;Oa(tl,"CircleBucket",{omit:["layers"]});class yl{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(e,i,n){const s=t.$.dot(i,this.dir);if(Math.abs(s)<1e-6)return!1;const r=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/s;return n[0]=this.pos[0]+this.dir[0]*r,n[1]=this.pos[1]+this.dir[1]*r,n[2]=this.pos[2]+this.dir[2]*r,!0}closestPointOnSphere(e,i,n){if(t.$.equals(this.pos,e)||0===i)return n[0]=n[1]=n[2]=0,!1;const[s,r,o]=this.dir,a=this.pos[0]-e[0],h=this.pos[1]-e[1],c=this.pos[2]-e[2],u=s*s+r*r+o*o,l=2*(a*s+h*r+c*o),f=l*l-4*u*(a*a+h*h+c*c-i*i);if(f<0){const t=Math.max(-l/2,0),e=a+s*t,u=h+r*t,f=c+o*t,d=Math.hypot(e,u,f);return n[0]=e*i/d,n[1]=u*i/d,n[2]=f*i/d,!1}{const t=(-l-Math.sqrt(f))/(2*u);if(t<0){const t=Math.hypot(a,h,c);return n[0]=a*i/t,n[1]=h*i/t,n[2]=c*i/t,!1}return n[0]=a+s*t,n[1]=h+r*t,n[2]=c+o*t,!0}}}class xl{constructor(t,e,i,n,s){this.TL=t,this.TR=e,this.BR=i,this.BL=n,this.horizon=s}static fromInvProjectionMatrix(e,i,n){const s=[-1,1,1],r=[1,1,1],o=[1,-1,1],a=[-1,-1,1],h=t.$.transformMat4(s,s,e),c=t.$.transformMat4(r,r,e),u=t.$.transformMat4(o,o,e),l=t.$.transformMat4(a,a,e);return new xl(h,c,u,l,i/n)}}function Ml(e,i,n){let s=1/0,r=-1/0;const o=[];for(const a of e){t.$.sub(o,a,i);const e=t.$.dot(o,n);s=Math.min(s,e),r=Math.max(r,e)}return[s,r]}function Tl(e,i){let n=!0;for(let s=0;s<e.planes.length;s++){const r=e.planes[s];let o=0;for(let e=0;e<i.length;e++)o+=t.$.dot(r,i[e])+r[3]>=0;if(0===o)return 0;o!==i.length&&(n=!1)}return n?2:1}function Ol(t,e){for(const i of t.projections){const n=Ml(e,t.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function El(e,i){let n=0;const s=[0,0,0,0];for(let r=0;r<e.length;r++)s[0]=e[r][0],s[1]=e[r][1],s[2]=e[r][2],s[3]=1,t.aB.dot(s,i)>=0&&n++;return n}class Al{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Sl.fromPoints(this.points),this.projections=[],this.frustumEdges=[t.$.sub([],this.points[2],this.points[3]),t.$.sub([],this.points[0],this.points[3]),t.$.sub([],this.points[4],this.points[0]),t.$.sub([],this.points[5],this.points[1]),t.$.sub([],this.points[6],this.points[2]),t.$.sub([],this.points[7],this.points[3])];for(const t of this.frustumEdges){const e=[0,-t[2],t[1]],i=[t[2],0,-t[0]];this.projections.push({axis:e,projection:Ml(this.points,this.points[0],e)}),this.projections.push({axis:i,projection:Ml(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(e,i,n,s){const r=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((n=>{const o=t.aB.transformMat4([],n,e),a=1/o[3]/i*r;return t.aB.mul(o,o,[a,a,s?1/o[3]:a,a])})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const i=t.$.sub([],o[e[0]],o[e[1]]),n=t.$.sub([],o[e[2]],o[e[1]]),s=t.$.normalize([],t.$.cross([],i,n)),r=-t.$.dot(s,o[e[1]]);return s.concat(r)})),h=[];for(let t=0;t<o.length;t++)h.push([o[t][0],o[t][1],o[t][2]]);return new Al(h,a)}intersectsPrecise(e,i,n){for(let t=0;t<i.length;t++)if(!El(e,i[t]))return 0;for(let t=0;t<this.planes.length;t++)if(!El(e,this.planes[t]))return 0;for(const i of n)for(const n of this.frustumEdges){const s=t.$.cross([],i,n),r=t.$.length(s);if(0===r)continue;t.$.scale(s,s,1/r);const o=Ml(this.points,this.points[0],s),a=Ml(e,this.points[0],s);if(o[0]>a[1]||a[0]>o[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const n=i[3];if(t.$.dot([i[0],i[1],i[2]],e)+n<0)return!1}return!0}}class Sl{static fromPoints(e){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const s of e)t.$.min(i,i,s),t.$.max(n,n,s);return new Sl(i,n)}static fromTileIdAndHeight(t,e,i){const n=1<<t.canonical.z,s=t.canonical.x,r=t.canonical.y;return new Sl([s/n,r/n,e],[(s+1)/n,(r+1)/n,i])}static applyTransform(e,i){const n=e.getCorners();for(let e=0;e<n.length;++e)t.$.transformMat4(n[e],n[e],i);return Sl.fromPoints(n)}static applyTransformFast(t,e){const i=[e[12],e[13],e[14]],n=[...i];for(let s=0;s<3;s++)for(let r=0;r<3;r++){const o=e[4*r+s],a=o*t.min[r],h=o*t.max[r];i[s]+=Math.min(a,h),n[s]+=Math.max(a,h)}return new Sl(i,n)}static projectAabbCorners(e,i){const n=e.getCorners();for(let e=0;e<n.length;++e)t.$.transformMat4(n[e],n[e],i);return n}constructor(e,i){this.min=e,this.max=i,this.center=t.$.scale([],t.$.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=t.$.clone(this.min),s=t.$.clone(this.max);for(let t=0;t<i.length;t++)n[t]=i[t]?this.min[t]:this.center[t],s[t]=i[t]?this.center[t]:this.max[t];return s[2]=this.max[2],new Sl(n,s)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Tl(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Tl(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,e){return e||this.intersects(t)?Ol(t,this.getCorners()):0}intersectsPreciseFlat(t,e){return e||this.intersectsFlat(t)?Ol(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let e=0;e<3;++e)if(this.min[e]>t.max[e]||t.min[e]>this.max[e])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t.min[e]),this.max[e]=Math.max(this.max[e],t.max[e])}encapsulatePoint(t){for(let e=0;e<3;e++)this.min[e]=Math.min(this.min[e],t[e]),this.max[e]=Math.max(this.max[e],t[e])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Oa(Sl,"Aabb");const kl=Rh([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Il}=kl,Cl=Rh([{name:"a_pos_3",components:3,type:"Int16"}]);var jl=Rh([{name:"a_pos",type:"Int16",components:2}]);function Dl(t){return t*au/vu}const Rl=[new Sl([du,du,du],[pu,pu,pu]),new Sl([du,du,du],[0,0,pu]),new Sl([0,du,du],[pu,0,pu]),new Sl([du,0,du],[0,pu,pu]),new Sl([0,0,du],[pu,pu,pu])];function Pl(e,i,n,s=!0){const r=t.$.scale([],e._camera.position,e.worldSize),o=[i,n,1,1];t.aB.transformMat4(o,o,e.pixelMatrixInverse),t.aB.scale(o,o,1/o[3]);const a=t.$.sub([],o,r),h=t.$.normalize([],a),c=e.globeMatrix,u=[c[12],c[13],c[14]],l=t.$.sub([],u,r),f=t.$.length(l),d=t.$.normalize([],l),p=e.worldSize/(2*Math.PI),m=t.$.dot(d,h),_=Math.asin(p/f);if(_<Math.acos(m)){if(!s)return null;const e=[],i=[];t.$.scale(e,h,f/m),t.$.normalize(i,t.$.sub(i,e,l)),t.$.normalize(h,t.$.add(h,l,t.$.scale(h,i,Math.tan(_)*f)))}const v=[];new yl(r,h).closestPointOnSphere(u,p,v);const g=t.$.normalize([],Si(c,0)),b=t.$.normalize([],Si(c,1)),w=t.$.normalize([],Si(c,2)),y=t.$.dot(g,v),x=t.$.dot(b,v),M=t.$.dot(w,v),T=We(Math.asin(-x/p));let O=We(Math.atan2(y,M));O=e.center.lng+function(t,e){const i=(e-t+180)%360-180;return i<-180?i+360:i}(e.center.lng,O);const E=Cu(O),A=Je(ju(T),0,1);return new Bu(E,A)}class Nl{constructor(e,i,n){this.a=t.$.sub([],e,n),this.b=t.$.sub([],i,n),this.center=n;const s=t.$.normalize([],this.a),r=t.$.normalize([],this.b);this.angle=Math.acos(t.$.dot(s,r))}}function Fl(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(t,e,i,n){const s=Math.sin(i);return t*(Math.sin((1-n)*i)/s)+e*(Math.sin(n*i)/s)}(t.a[e],t.b[e],t.angle,Je(i,0,1))+t.center[e]}function zl(t){if(t.z<=1)return Rl[t.z+2*t.y+t.x];const e=Hl(Gl(t));return Sl.fromPoints(e)}function Ll(e,i,n){return t.$.scale(e,e,1-n),t.$.scaleAndAdd(e,e,i,n)}function $l(e,i){const n=Ql(i.zoom);if(0===n)return zl(e);const s=Gl(e),r=Hl(s),o=Cu(s.getWest())*i.worldSize,a=Cu(s.getEast())*i.worldSize,h=ju(s.getNorth())*i.worldSize,c=ju(s.getSouth())*i.worldSize,u=[o,h,0],l=[a,h,0],f=[o,c,0],d=[a,c,0],p=t.ae.invert([],i.globeMatrix);return t.$.transformMat4(u,u,p),t.$.transformMat4(l,l,p),t.$.transformMat4(f,f,p),t.$.transformMat4(d,d,p),r[0]=Ll(r[0],f,n),r[1]=Ll(r[1],d,n),r[2]=Ll(r[2],l,n),r[3]=Ll(r[3],u,n),Sl.fromPoints(r)}function Ul(e,i,n){for(const s of e)t.$.transformMat4(s,s,i),t.$.scale(s,s,n)}function Bl(e,i,n,s){const r=i/e.worldSize,o=e.globeMatrix;if(n.z<=1){const t=zl(n).getCorners();return Ul(t,o,r),Sl.fromPoints(t)}const a=Gl(n,s),h=Hl(a,au+Dl(e._tileCoverLift));Ul(h,o,r);const c=Number.MAX_VALUE,u=[-c,-c,-c],l=[c,c,c];if(a.contains(e.center)){for(const e of h)t.$.min(l,l,e),t.$.max(u,u,e);u[2]=0;const i=e.point,n=[i.x*r,i.y*r,0];return t.$.min(l,l,n),t.$.max(u,u,n),new Sl(l,u)}if(e._tileCoverLift>0){for(const e of h)t.$.min(l,l,e),t.$.max(u,u,e);return new Sl(l,u)}const f=[o[12]*r,o[13]*r,o[14]*r],d=a.getCenter(),p=Je(e.center.lat,-Fu,Fu),m=Je(d.lat,-Fu,Fu),_=Cu(e.center.lng),v=ju(p);let g=_-Cu(d.lng);const b=v-ju(m);g>.5?g-=1:g<-.5&&(g+=1);let w=0;if(Math.abs(g)>Math.abs(b))w=g>=0?1:3;else{w=b>=0?0:2;const e=[o[4]*r,o[5]*r,o[6]*r],i=-Math.sin(Ve(b>=0?a.getSouth():a.getNorth()))*au;t.$.scaleAndAdd(f,f,e,i)}const y=h[w],x=h[(w+1)%4],M=new Nl(y,x,f),T=[Fl(M,0)||y[0],Fl(M,1)||y[1],Fl(M,2)||y[2]],O=Ql(e.zoom);if(O>0){const s=function({x:t,y:e,z:i},n,s,r,o){const a=1/(1<<i);let h=t*a,c=h+a,u=e*a,l=u+a,f=0;const d=(h+c)/2-r;return d>.5?f=-1:d<-.5&&(f=1),h=((h+f)*n-(r*=n))*s+r,c=((c+f)*n-r)*s+r,u=(u*n-(o*=n))*s+o,l=(l*n-o)*s+o,[[h,l,0],[c,l,0],[c,u,0],[h,u,0]]}(n,i,e._pixelsPerMercatorPixel,_,v);for(let t=0;t<h.length;t++)Ll(h[t],s[t],O);const r=t.$.add([],s[w],s[(w+1)%4]);t.$.scale(r,r,.5),Ll(T,r,O)}for(const e of h)t.$.min(l,l,e),t.$.max(u,u,e);return l[2]=Math.min(y[2],x[2]),t.$.min(l,l,T),t.$.max(u,u,T),new Sl(l,u)}function Gl({x:t,y:e,z:i},n=!1){const s=1/(1<<i),r=new bu(Ru(t*s),e===(1<<i)-1&&n?-90:Pu((e+1)*s)),o=new bu(Ru((t+1)*s),0===e&&n?90:Pu(e*s));return new wu(r,o)}function Hl(t,e=au){const i=Ve(t.getNorth()),n=Ve(t.getSouth()),s=Math.cos(i),r=Math.cos(n),o=Math.sin(i),a=Math.sin(n),h=t.getWest(),c=t.getEast();return[mu(r,a,h,e),mu(r,a,c,e),mu(s,o,c,e),mu(s,o,h,e)]}function Vl(t,e,i,n){const s=1<<i.z,r=(t/pr+i.x)/s;return _u(Pu((e/pr+i.y)/s),Ru(r),n)}function Wl({min:t,max:e}){return uu/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const ql=new Float64Array(16);function Yl(e){const i=Wl(e),n=t.ae.fromScaling(ql,[i,i,i]);return t.ae.translate(n,n,t.$.negate([],e.min))}function Xl(e){const i=t.ae.fromTranslation(ql,e.min),n=1/Wl(e);return t.ae.scale(i,i,[n,n,n])}function Zl(t){const e=pr/(2*Math.PI);return t/(2*Math.PI)/e}function Jl(t,e){return pr/(512*Math.pow(2,t))*Wl(zl(e))}function Kl(e,i,n,s,r){const o=Zl(n),a=[e,i,-n/(2*Math.PI)],h=t.ae.identity(new Float64Array(16));return t.ae.translate(h,h,a),t.ae.scale(h,h,[o,o,o]),t.ae.rotateX(h,h,Ve(-r)),t.ae.rotateY(h,h,Ve(-s)),h}function Ql(t){return Ke(hu,cu,t)}function tf(e,i){const n=_u(i.lat,i.lng),s=function(e){const i=_u(e._center.lat,e._center.lng),n=t.$.fromValues(0,1,0);let s=t.$.cross([],n,i);const r=t.ae.fromRotation([],-e.angle,i);s=t.$.transformMat4(s,s,r),t.ae.fromRotation(r,-e._pitch,s);const o=t.$.normalize([],i);return t.$.scale(o,o,Dl(e.cameraToCenterDistance/e.pixelsPerMeter)),t.$.transformMat4(o,o,r),t.$.add([],i,o)}(e),r=t.$.subtract([],s,n);return t.$.angle(r,n)}function ef(t,e){return tf(t,e)>Math.PI/2*1.01}const nf=Ve(85),sf=Math.cos(nf),rf=Math.sin(nf),of=t.ae.create(),af=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e};function hf(e,i,n,s,r,o,a,h,c){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(c*=e.pixelToTileUnitsFactor);const u=e.tileID.canonical,l=n.projection.upVectorScale(u,n.center.lat,n.worldSize).metersToTile;for(const f of i)for(const i of f){const f=i.add(h),d=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(f.x,f.y,!0):0,p=n.projection.projectTilePoint(f.x,f.y,u);if(d>0){const t=n.projection.upVector(u,f.x,f.y);p.x+=t[0]*l*d,p.y+=t[1]*l*d,p.z+=t[2]*l*d}const m=o?f:cf(p.x,p.y,p.z,s),_=o?e.tilespaceRays.map((t=>ff(t,d))):e.queryGeometry.screenGeometry,v=t.aB.transformMat4([],[p.x,p.y,p.z,1],s);if(!a&&o?c*=v[3]/n.cameraToCenterDistance:a&&!o&&(c*=n.cameraToCenterDistance/v[3]),o){const t=Pu((i.y/pr+u.y)/(1<<u.z));c/=n.projection.pixelsPerMeter(t,1)/Du(1,t)}if(il(_,m,c))return!0}return!1}function cf(e,i,n,s){const r=t.aB.transformMat4([],[e,i,n,1],s);return new Ue(r[0]/r[3],r[1]/r[3])}const uf=t.$.fromValues(0,0,0),lf=t.$.fromValues(0,0,1);function ff(e,i){const n=t.$.create();return uf[2]=i,e.intersectsPlane(uf,lf,n),new Ue(n[0],n[1])}class df extends tl{}function pf(t,{width:e,height:i},n,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*n)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=s,t}function mf(t,e,i){const{width:n,height:s}=e;n===t.width&&s===t.height||(_f(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,s)},i,null),t.width=n,t.height=s,t.data=e.data)}function _f(t,e,i,n,s,r,o,a){if(0===s.width||0===s.height)return e;if(s.width>t.width||s.height>t.height||i.x>t.width-s.width||i.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||n.x>e.width-s.width||n.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");const h=t.data,c=e.data,u=4===r&&a;for(let a=0;a<s.height;a++){const l=((i.y+a)*t.width+i.x)*r,f=((n.y+a)*e.width+n.x)*r;if(u)for(let t=0;t<s.width;t++){const e=l+t*r+3,i=f+t*r;c[i+0]=255,c[i+1]=255,c[i+2]=255,c[i+3]=h[e]}else if(o)for(let t=0;t<s.width;t++){const e=l+t*r,i=f+t*r,n=h[e+3],s=new Vn(h[e+0]/255*n,h[e+1]/255*n,h[e+2]/255*n,n).toRenderColor(o).toArray();c[i+0]=s[0],c[i+1]=s[1],c[i+2]=s[2],c[i+3]=s[3]}else for(let t=0;t<s.width*r;t++)c[f+t]=h[l+t]}return e}Oa(df,"HeatmapBucket",{omit:["layers"]});class vf{constructor(t,e){pf(this,t,1,e)}resize(t){mf(this,new vf(t),1)}clone(){return new vf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,s){_f(t,e,i,n,s,1,null)}}class gf{constructor(t,e){pf(this,t,4,e)}resize(t){mf(this,new gf(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new gf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,i,n,s,r,o){_f(t,e,i,n,s,4,r,o)}}class bf{constructor(t,e){this.width=t.width,this.height=t.height,this.data=e instanceof Uint8Array?new Float32Array(e.buffer):e}}let wf,yf,xf,Mf;function Tf(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,s=t.image||new gf({width:i,height:n}),r=(i,n,r)=>{e[t.evaluationKey]=r;const o=t.expression.evaluate(e);o&&(s.data[i+n+0]=Math.floor(255*o.r/o.a),s.data[i+n+1]=Math.floor(255*o.g/o.a),s.data[i+n+2]=Math.floor(255*o.b/o.a),s.data[i+n+3]=Math.floor(255*o.a))};if(t.clips)for(let e=0,s=0;e<n;++e,s+=4*i)for(let n=0,o=0;n<i;n++,o+=4){const a=n/(i-1),{start:h,end:c}=t.clips[e];r(s,o,h*(1-a)+c*a)}else for(let t=0,e=0;t<i;t++,e+=4)r(0,e,t/(i-1));return s}Oa(vf,"AlphaImage"),Oa(gf,"RGBAImage");const Of=Rh([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ef}=Of;function Af(t,e,i=2){const n=e&&e.length,s=n?e[0]*i:t.length;let r=Sf(t,0,s,i,!0);const o=[];if(!r||r.next===r.prev)return o;let a,h,c;if(n&&(r=function(t,e,i,n){const s=[];for(let i=0,r=e.length;i<r;i++){const o=Sf(t,e[i]*n,i<r-1?e[i+1]*n:t.length,n,!1);o===o.next&&(o.steiner=!0),s.push(Lf(o))}s.sort(Pf);for(let t=0;t<s.length;t++)i=Nf(s[t],i);return i}(t,e,r,i)),t.length>80*i){a=1/0,h=1/0;let e=-1/0,n=-1/0;for(let r=i;r<s;r+=i){const i=t[r],s=t[r+1];i<a&&(a=i),s<h&&(h=s),i>e&&(e=i),s>n&&(n=s)}c=Math.max(e-a,n-h),c=0!==c?32767/c:0}return If(r,o,i,a,h,c,0),o}function Sf(t,e,i,n,s){let r;if(s===function(t,e,i,n){let s=0;for(let r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}(t,e,i,n)>0)for(let s=e;s<i;s+=n)r=Xf(s/n|0,t[s],t[s+1],r);else for(let s=i-n;s>=e;s-=n)r=Xf(s/n|0,t[s],t[s+1],r);return r&&Gf(r,r.next)&&(Zf(r),r=r.next),r}function kf(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!Gf(n,n.next)&&0!==Bf(n.prev,n,n.next))n=n.next;else{if(Zf(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function If(t,e,i,n,s,r,o){if(!t)return;!o&&r&&function(t,e,i,n){let s=t;do{0===s.z&&(s.z=zf(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let e,i=1;do{let n,s=t;t=null;let r=null;for(e=0;s;){e++;let o=s,a=0;for(let t=0;t<i&&(a++,o=o.nextZ,o);t++);let h=i;for(;a>0||h>0&&o;)0!==a&&(0===h||!o||s.z<=o.z)?(n=s,s=s.nextZ,a--):(n=o,o=o.nextZ,h--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;s=o}r.nextZ=null,i*=2}while(e>1)}(s)}(t,n,s,r);let a=t;for(;t.prev!==t.next;){const h=t.prev,c=t.next;if(r?jf(t,n,s,r):Cf(t))e.push(h.i,t.i,c.i),Zf(t),t=c.next,a=c.next;else if((t=c)===a){o?1===o?If(t=Df(kf(t),e),e,i,n,s,r,2):2===o&&Rf(t,e,i,n,s,r):If(kf(t),e,i,n,s,r,1);break}}}function Cf(t){const e=t.prev,i=t,n=t.next;if(Bf(e,i,n)>=0)return!1;const s=e.x,r=i.x,o=n.x,a=e.y,h=i.y,c=n.y,u=s<r?s<o?s:o:r<o?r:o,l=a<h?a<c?a:c:h<c?h:c,f=s>r?s>o?s:o:r>o?r:o,d=a>h?a>c?a:c:h>c?h:c;let p=n.next;for(;p!==e;){if(p.x>=u&&p.x<=f&&p.y>=l&&p.y<=d&&$f(s,a,r,h,o,c,p.x,p.y)&&Bf(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function jf(t,e,i,n){const s=t.prev,r=t,o=t.next;if(Bf(s,r,o)>=0)return!1;const a=s.x,h=r.x,c=o.x,u=s.y,l=r.y,f=o.y,d=a<h?a<c?a:c:h<c?h:c,p=u<l?u<f?u:f:l<f?l:f,m=a>h?a>c?a:c:h>c?h:c,_=u>l?u>f?u:f:l>f?l:f,v=zf(d,p,e,i,n),g=zf(m,_,e,i,n);let b=t.prevZ,w=t.nextZ;for(;b&&b.z>=v&&w&&w.z<=g;){if(b.x>=d&&b.x<=m&&b.y>=p&&b.y<=_&&b!==s&&b!==o&&$f(a,u,h,l,c,f,b.x,b.y)&&Bf(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,w.x>=d&&w.x<=m&&w.y>=p&&w.y<=_&&w!==s&&w!==o&&$f(a,u,h,l,c,f,w.x,w.y)&&Bf(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;b&&b.z>=v;){if(b.x>=d&&b.x<=m&&b.y>=p&&b.y<=_&&b!==s&&b!==o&&$f(a,u,h,l,c,f,b.x,b.y)&&Bf(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=g;){if(w.x>=d&&w.x<=m&&w.y>=p&&w.y<=_&&w!==s&&w!==o&&$f(a,u,h,l,c,f,w.x,w.y)&&Bf(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Df(t,e){let i=t;do{const n=i.prev,s=i.next.next;!Gf(n,s)&&Hf(n,i,i.next,s)&&qf(n,s)&&qf(s,n)&&(e.push(n.i,i.i,s.i),Zf(i),Zf(i.next),i=t=s),i=i.next}while(i!==t);return kf(i)}function Rf(t,e,i,n,s,r){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Uf(o,t)){let a=Yf(o,t);return o=kf(o,o.next),a=kf(a,a.next),If(o,e,i,n,s,r,0),void If(a,e,i,n,s,r,0)}t=t.next}o=o.next}while(o!==t)}function Pf(t,e){return t.x-e.x}function Nf(t,e){const i=function(t,e){let i=e;const n=t.x,s=t.y;let r,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const t=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>o&&(o=t,r=i.x<i.next.x?i:i.next,t===n))return r}i=i.next}while(i!==e);if(!r)return null;const a=r,h=r.x,c=r.y;let u=1/0;i=r;do{if(n>=i.x&&i.x>=h&&n!==i.x&&$f(s<c?n:o,s,h,c,s<c?o:n,s,i.x,i.y)){const e=Math.abs(s-i.y)/(n-i.x);qf(i,t)&&(e<u||e===u&&(i.x>r.x||i.x===r.x&&Ff(r,i)))&&(r=i,u=e)}i=i.next}while(i!==a);return r}(t,e);if(!i)return e;const n=Yf(i,t);return kf(n,n.next),kf(i,i.next)}function Ff(t,e){return Bf(t.prev,t,e.prev)<0&&Bf(e.next,t,t.next)<0}function zf(t,e,i,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Lf(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function $f(t,e,i,n,s,r,o,a){return(s-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function Uf(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Hf(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(qf(t,e)&&qf(e,t)&&function(t,e){let i=t,n=!1;const s=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Bf(t.prev,t,e.prev)||Bf(t,e.prev,e))||Gf(t,e)&&Bf(t.prev,t,t.next)>0&&Bf(e.prev,e,e.next)>0)}function Bf(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Gf(t,e){return t.x===e.x&&t.y===e.y}function Hf(t,e,i,n){const s=Wf(Bf(t,e,i)),r=Wf(Bf(t,e,n)),o=Wf(Bf(i,n,t)),a=Wf(Bf(i,n,e));return s!==r&&o!==a||!(0!==s||!Vf(t,i,e))||!(0!==r||!Vf(t,n,e))||!(0!==o||!Vf(i,t,n))||!(0!==a||!Vf(i,e,n))}function Vf(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Wf(t){return t>0?1:t<0?-1:0}function qf(t,e){return Bf(t.prev,t,t.next)<0?Bf(t,e,t.next)>=0&&Bf(t,t.prev,e)>=0:Bf(t,e,t.prev)<0||Bf(t,t.next,e)<0}function Yf(t,e){const i=Jf(t.i,t.x,t.y),n=Jf(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function Xf(t,e,i,n){const s=Jf(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Zf(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jf(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Kf(t,e){const i=t.length;if(i<=1)return[t];const n=[];let s,r;for(let e=0;e<i;e++){const i=_i(t[e]);0!==i&&(t[e].area=Math.abs(i),void 0===r&&(r=i<0),r===i<0?(s&&n.push(s),s=[t[e]]):s.push(t[e]))}if(s&&n.push(s),e>1)for(let t=0;t<n.length;t++)n[t].length<=e||(Fs(n[t],e,1,n[t].length-1,Qf),n[t]=n[t].slice(0,e));return n}function Qf(t,e){return e.area-t.area}function td(t,e,i){const n=i.patternDependencies;let s=!1;for(const i of e){const e=i.paint.get(`${t}-pattern`);e.isConstant()||(s=!0);const r=e.constantOr(null);r&&(s=!0,n[r]=!0)}return s}function ed(t,e,i,n,s){const r=s.patternDependencies;for(const o of e){const e=o.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:n},i,{},s.availableImages);t=t&&t.name?t.name:t,r[t]=!0,i.patterns[o.id]=t}}return i}class id{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Nh,this.indexArray=new tc,this.indexArray2=new Xh,this.programConfigurations=new eu(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Sc,this.segments2=new Sc,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.projection=t.projection}updateFootprints(t,e){}populate(t,e,i,n){this.hasPattern=td("fill",this.layers,e);const s=this.layers[0].layout.get("fill-sort-key"),r=[];for(const{feature:o,id:a,index:h,sourceLayerIndex:c}of t){const t=this.layers[0]._featureFilter.needGeometry,u=Ju(o,t);if(!this.layers[0]._featureFilter.filter(new Ja(this.zoom),u,i))continue;const l=s?s.evaluate(u,{},i,e.availableImages):void 0,f={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:h,geometry:t?u.geometry:Zu(o,i,n),patterns:{},sortKey:l};r.push(f)}s&&r.sort(((t,e)=>t.sortKey-e.sortKey));for(const n of r){const{geometry:s,index:r,sourceLayerIndex:o}=n;if(this.hasPattern){const t=ed("fill",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,s,r,i,{},e.availableImages,e.brightness);e.featureIndex.insert(t[r].feature,s,r,o,this.index)}}update(t,e,i,n,s){const r=0!==Object.keys(t).length;r&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,r?this.stateDependentLayers:this.layers,i,n,s)}addFeatures(t,e,i,n,s,r){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ef),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,i,n,s,r=[],o){for(const t of Kf(e,500)){let e=0;for(const i of t)e+=i.length;const i=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),n=i.vertexLength,s=[],r=[];for(const e of t){if(0===e.length)continue;e!==t[0]&&r.push(s.length/2);const i=this.segments2.prepareSegment(e.length,this.layoutVertexArray,this.indexArray2),n=i.vertexLength;this.layoutVertexArray.emplaceBack(e[0].x,e[0].y),this.indexArray2.emplaceBack(n+e.length-1,n),s.push(e[0].x),s.push(e[0].y);for(let t=1;t<e.length;t++)this.layoutVertexArray.emplaceBack(e[t].x,e[t].y),this.indexArray2.emplaceBack(n+t-1,n+t),s.push(e[t].x),s.push(e[t].y);i.vertexLength+=e.length,i.primitiveLength+=e.length}const o=Af(s,r);for(let t=0;t<o.length;t+=3)this.indexArray.emplaceBack(n+o[t],n+o[t+1],n+o[t+2]);i.vertexLength+=e,i.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,s,r,n,o)}}let nd,sd,rd,od;Oa(id,"FillBucket",{omit:["layers","patternFeatures"]});class ad{constructor(t,e,i,n){if(this.triangleCount=e.length/3,this.min=new Ue(0,0),this.max=new Ue(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===t.length)return;const[s,r]=[t[0].clone(),t[0].clone()];for(let e=1;e<t.length;++e){const i=t[e];s.x=Math.min(s.x,i.x),s.y=Math.min(s.y,i.y),r.x=Math.max(r.x,i.x),r.y=Math.max(r.y,i.y)}if(n){const t=Math.ceil(Math.max(r.x-s.x,r.y-s.y)/n);i=Math.max(i,t)}if(0===i)return;this.min=s,this.max=r;const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const a=Math.max(o.x,o.y)/i;this.cellsX=Math.max(1,Math.ceil(o.x/a)),this.cellsY=Math.max(1,Math.ceil(o.y/a)),this.xScale=1/a,this.yScale=1/a;const h=[];for(let i=0;i<this.triangleCount;i++){const n=t[e[3*i+0]].sub(this.min),s=t[e[3*i+1]].sub(this.min),r=t[e[3*i+2]].sub(this.min),o=hd(Math.floor(Math.min(n.x,s.x,r.x)),this.xScale,this.cellsX),c=hd(Math.floor(Math.max(n.x,s.x,r.x)),this.xScale,this.cellsX),u=hd(Math.floor(Math.min(n.y,s.y,r.y)),this.yScale,this.cellsY),l=hd(Math.floor(Math.max(n.y,s.y,r.y)),this.yScale,this.cellsY),f=new Ue(0,0),d=new Ue(0,0),p=new Ue(0,0),m=new Ue(0,0);for(let t=u;t<=l;++t){f.y=d.y=t*a,p.y=m.y=(t+1)*a;for(let e=o;e<=c;++e)f.x=p.x=e*a,d.x=m.x=(e+1)*a,(pl(n,s,r,f,d,m)||pl(n,s,r,f,m,p))&&h.push({cellIdx:t*this.cellsX+e,triIdx:i})}}if(0===h.length)return;h.sort(((t,e)=>t.cellIdx-e.cellIdx||t.triIdx-e.triIdx));let c=0;for(;c<h.length;){const t=h[c].cellIdx,e={start:this.payload.length,len:0};for(;c<h.length&&h[c].cellIdx===t;)++e.len,this.payload.push(h[c++].triIdx);this.cells[t]=e}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,e){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const i=hd(t.x-this.min.x,this.xScale,this.cellsX),n=hd(t.y-this.min.y,this.yScale,this.cellsY),s=this.cells[n*this.cellsX+i];if(s){this._lazyInitLookup();for(let t=0;t<s.len;t++){const i=this.payload[s.start+t],n=Math.floor(i/8),r=1<<i%8;if(!(this.lookup[n]&r)&&(this.lookup[n]|=r,e.push(i),e.length===this.triangleCount))return}}}query(t,e,i){if(0===this.triangleCount||0===this.cells.length)return;if(t.x>this.max.x||this.min.x>e.x)return;if(t.y>this.max.y||this.min.y>e.y)return;this._lazyInitLookup();const n=hd(t.x-this.min.x,this.xScale,this.cellsX),s=hd(e.x-this.min.x,this.xScale,this.cellsX),r=hd(t.y-this.min.y,this.yScale,this.cellsY),o=hd(e.y-this.min.y,this.yScale,this.cellsY);for(let t=r;t<=o;t++)for(let e=n;e<=s;e++){const n=this.cells[t*this.cellsX+e];if(n)for(let t=0;t<n.len;t++){const e=this.payload[n.start+t],s=Math.floor(e/8),r=1<<e%8;if(!(this.lookup[s]&r)&&(this.lookup[s]|=r,i.push(e),i.length===this.triangleCount))return}}}}function hd(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}Oa(ad,"TriangleGridIndex");class cd{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.footprints=[]}updateFootprints(t,e){for(const i of this.footprints)e.push({footprint:i,id:t})}populate(t,e,i,n){const s=[];for(const{feature:e,id:r,index:o,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,h=Ju(e,t);if(!this.layers[0]._featureFilter.filter(new Ja(this.zoom),h,i))continue;const c={id:r,properties:e.properties,type:e.type,sourceLayerIndex:a,index:o,geometry:t?h.geometry:Zu(e,i,n),patterns:{}};s.push(c)}for(const n of s){const{geometry:s,index:r,sourceLayerIndex:o}=n;this.addFeature(n,s,r,i,{},e.availableImages,e.brightness),e.featureIndex.insert(t[r].feature,s,r,o,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(t){}update(t,e,i,n,s){}destroy(){}addFeature(t,e,i,n,s,r=[],o){for(const t of Kf(e,2)){const e=[],i=[],n=[],s=new Ue(1/0,1/0),r=new Ue(-1/0,-1/0);for(const o of t)if(0!==o.length){o!==t[0]&&n.push(i.length/2);for(let t=0;t<o.length;t++)i.push(o[t].x),i.push(o[t].y),e.push(o[t]),s.x=Math.min(s.x,o[t].x),s.y=Math.min(s.y,o[t].y),r.x=Math.max(r.x,o[t].x),r.y=Math.max(r.y,o[t].y)}const o=Af(i,n),a=new ad(e,o,8,256);this.footprints.push({vertices:e,indices:o,grid:a,min:s,max:r})}}}Oa(cd,"ClipBucket",{omit:["layers"]});const ud=Rh([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),ld=Rh([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),fd=Rh([{name:"a_centroid_pos",components:2,type:"Uint16"}]),dd=Rh([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),pd=Rh([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),md=Rh([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:_d}=ud;var vd={},gd=Le,bd=wd;function wd(t,e,i,n,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=s,t.readFields(yd,this,e)}function yd(t,e,i){1==t?e.id=i.readVarint():2==t?function(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],s=e._values[t.readVarint()];e.properties[n]=s}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function xd(t){for(var e,i,n=0,s=0,r=t.length,o=r-1;s<r;o=s++)n+=((i=t[o]).x-(e=t[s]).x)*(e.y+i.y);return n}wd.types=["Unknown","Point","LineString","Polygon"],wd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,s=0,r=0,o=0,a=[];t.pos<i;){if(s<=0){var h=t.readVarint();n=7&h,s=h>>3}if(s--,1===n||2===n)r+=t.readSVarint(),o+=t.readSVarint(),1===n&&(e&&a.push(e),e=[]),e.push(new gd(r,o));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&a.push(e),a},wd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,s=0,r=0,o=1/0,a=-1/0,h=1/0,c=-1/0;t.pos<e;){if(n<=0){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)(s+=t.readSVarint())<o&&(o=s),s>a&&(a=s),(r+=t.readSVarint())<h&&(h=r),r>c&&(c=r);else if(7!==i)throw new Error("unknown command "+i)}return[o,h,a,c]},wd.prototype.toGeoJSON=function(t,e,i){var n,s,r=this.extent*Math.pow(2,i),o=this.extent*t,a=this.extent*e,h=this.loadGeometry(),c=wd.types[this.type];function u(t){for(var e=0;e<t.length;e++){var i=t[e];t[e]=[360*(i.x+o)/r-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+a)/r)*Math.PI/180))-90]}}switch(this.type){case 1:var l=[];for(n=0;n<h.length;n++)l[n]=h[n][0];u(h=l);break;case 2:for(n=0;n<h.length;n++)u(h[n]);break;case 3:for(h=function(t){var e=t.length;if(e<=1)return[t];for(var i,n,s=[],r=0;r<e;r++){var o=xd(t[r]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(i&&s.push(i),i=[t[r]]):i.push(t[r]))}return i&&s.push(i),s}(h),n=0;n<h.length;n++)for(s=0;s<h[n].length;s++)u(h[n][s])}1===h.length?h=h[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:h},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Md=bd,Td=Od;function Od(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ed,this,e),this.length=this._features.length}function Ed(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(i))}Od.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Md(this._pbf,e,this.extent,this._keys,this._values)};var Ad=Td;function Sd(t,e,i){if(3===t){var n=new Ad(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var kd=vd.VectorTile=function(t,e){this.layers=t.readFields(Sd,{},e)},Id=vd.VectorTileFeature=bd;vd.VectorTileLayer=Td;class Cd extends Ue{constructor(t,e,i){super(t,e),this.z=i}}class jd extends Cd{constructor(t,e,i,n){super(t,e,i),this.w=n}}function Dd(t,e,i,n){const s=[],r=0===n?(t,e,i,n,s,r)=>{t.push(new Ue(r,i+(r-e)/(n-e)*(s-i)))}:(t,e,i,n,s,r)=>{t.push(new Ue(e+(r-i)/(s-i)*(n-e),r))};for(const o of t){const t=[];for(const s of o){if(s.length<=2)continue;const o=[];for(let t=0;t<s.length-1;t++){const a=s[t].x,h=s[t].y,c=s[t+1].x,u=s[t+1].y,l=0===n?a:h,f=0===n?c:u;l<e?f>e&&r(o,a,h,c,u,e):l>i?f<i&&r(o,a,h,c,u,i):o.push(s[t]),f<e&&l>=e&&r(o,a,h,c,u,e),f>i&&l<=i&&r(o,a,h,c,u,i)}let a=s[s.length-1];const h=0===n?a.x:a.y;h>=e&&h<=i&&o.push(a),o.length&&(a=o[o.length-1],o[0].x===a.x&&o[0].y===a.y||o.push(o[0]),t.push(o))}t.length&&s.push(t)}return s}function Rd(t,e,i,n){const s="x"===i?"y":"x",r=(n-t[i])/(e[i]-t[i]);t[s]=t[s]+(e[s]-t[s])*r,t[i]=n,t.hasOwnProperty("z")&&(t.z=qn(t.z,e.z,r)),t.hasOwnProperty("w")&&(t.w=qn(t.w,e.w,r))}function Pd(t,e,i,n){const s=i,r=n;for(const i of["x","y"]){let n=t,o=e;n[i]>=o[i]&&(n=e,o=t),n[i]<s&&o[i]>s&&Rd(n,o,i,s),n[i]<r&&o[i]>r&&Rd(o,n,i,r)}}const Nd=Number.MAX_SAFE_INTEGER;function Fd(t,e,i,n){return t.order<e||t.order===Nd||!(t.clipMask&i)||function(t,e){return 0!==e.length&&void 0===e.find((e=>e===t))}(n,t.clipScope)}function zd(t,e){return t.x-e.x||t.y-e.y}function Ld(t,e){return 0===zd(t.min,e.min)&&0===zd(t.max,e.max)}function $d(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Ud(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i].sourceId!==e[i].sourceId||!Ld(t[i],e[i])||t[i].order!==e[i].order||t[i].clipMask!==e[i].clipMask||!Be(t[i].clipScope,e[i].clipScope))return!1;return!0}function Bd(t,e,i){const n=1/pr,s=1/(1<<i.canonical.z),r=(e.x*n+i.canonical.x)*s+i.wrap,o=(e.y*n+i.canonical.y)*s;return{min:new Ue((t.x*n+i.canonical.x)*s+i.wrap,(t.y*n+i.canonical.y)*s),max:new Ue(r,o)}}function Gd(t,e,i){const n=1<<i.canonical.z,s=((e.x-i.wrap)*n-i.canonical.x)*pr,r=(e.y*n-i.canonical.y)*pr;return{min:new Ue(((t.x-i.wrap)*n-i.canonical.x)*pr,(t.y*n-i.canonical.y)*pr),max:new Ue(s,r)}}function Hd(t,e,i,n,s,r,o){const a=t.indices,h=t.vertices,c=[];for(let u=n;u<n+s;u+=3){const n=e[i[u+0]+r],s=e[i[u+1]+r],l=e[i[u+2]+r],f=Math.min(n.x,s.x,l.x),d=Math.max(n.x,s.x,l.x),p=Math.min(n.y,s.y,l.y),m=Math.max(n.y,s.y,l.y);c.length=0,t.grid.query(new Ue(f,p),new Ue(d,m),c);for(let t=0;t<c.length;t++){const e=c[t];if(pl(h[a[3*e+0]],h[a[3*e+1]],h[a[3*e+2]],n,s,l,o))return!0}}return!1}function Vd(t,e,i,n){if(!t||!i)return!1;let s=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(i.vertices.length<t.vertices.length)return Vd(i,n,t,e);const r=e.canonical,o=n.canonical,a=Math.pow(2,o.z-r.z);s=t.vertices.map((t=>new Ue((t.x+r.x*pr)*a-o.x*pr,(t.y+r.y*pr)*a-o.y*pr)))}return Hd(i,s,t.indices,0,t.indices.length,0,0)}function Wd(t,e,i,n){const s=Math.pow(2,n.z-i.z);return new Ue((t+i.x*pr)*s-n.x*pr,(e+i.y*pr)*s-n.y*pr)}function qd(t,e){const i=[];e.footprint.grid.queryPoint(t,i);const n=e.footprint.indices,s=e.footprint.vertices;for(let e=0;e<i.length;e++){const r=i[e];if(ul([s[n[3*r+0]],s[n[3*r+1]],s[n[3*r+2]]],t))return!0}return!1}class Yd{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const i=this.toIdx(t,e);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function Xd(t,e,i,n){let s=0,r=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(i[o]<t[o]||i[o]>e[o])return null}else{const a=1/n[o];let h=(t[o]-i[o])*a,c=(e[o]-i[o])*a;if(h>c){const t=h;h=c,c=t}if(h>s&&(s=h),c<r&&(r=c),s>r)return null}return s}function Zd(t,e,i,n,s,r,o,a,h,c,u){const l=n-t,f=s-e,d=r-i,p=o-t,m=a-e,_=h-i,v=u[1]*_-u[2]*m,g=u[2]*p-u[0]*_,b=u[0]*m-u[1]*p,w=l*v+f*g+d*b;if(Math.abs(w)<1e-15)return null;const y=1/w,x=c[0]-t,M=c[1]-e,T=c[2]-i,O=(x*v+M*g+T*b)*y;if(O<0||O>1)return null;const E=M*d-T*f,A=T*l-x*d,S=x*f-M*l,k=(u[0]*E+u[1]*A+u[2]*S)*y;return k<0||O+k>1?null:(p*E+m*A+_*S)*y}function Jd(t,e,i){return(t-e)/(i-e)}function Kd(t,e,i,n,s,r,o,a,h){const c=1<<i,u=r-n,l=o-s,f=(t+1)/c*u+n,d=(e+0)/c*l+s,p=(e+1)/c*l+s;a[0]=(t+0)/c*u+n,a[1]=d,h[0]=f,h[1]=p}class Qd{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),i=[];let n=Math.ceil(Math.pow(2,e));const s=1/n,r=(t,e,i,n,s)=>{const r=n?1:0,o=(t+1)*i-r,a=e*i,h=(e+1)*i-r;s[0]=t*i,s[1]=a,s[2]=o,s[3]=h};let o=new Yd(n);const a=[];for(let e=0;e<n*n;e++){r(e%n,Math.floor(e/n),s,!1,a);const i=ep(a[0],a[1],t),h=ep(a[2],a[1],t),c=ep(a[2],a[3],t),u=ep(a[0],a[3],t);o.minimums.push(Math.min(i,h,c,u)),o.maximums.push(Math.max(i,h,c,u)),o.leaves.push(1)}for(i.push(o),n/=2;n>=1;n/=2){const t=i[i.length-1];o=new Yd(n);for(let e=0;e<n*n;e++){r(e%n,Math.floor(e/n),2,!0,a);const i=t.getElevation(a[0],a[1]),s=t.getElevation(a[2],a[1]),h=t.getElevation(a[2],a[3]),c=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),l=t.isLeaf(a[2],a[1]),f=t.isLeaf(a[2],a[3]),d=t.isLeaf(a[0],a[3]),p=Math.min(i.min,s.min,h.min,c.min),m=Math.max(i.max,s.max,h.max,c.max),_=u&&l&&f&&d;o.maximums.push(m),o.minimums.push(p),o.leaves.push(m-p<=5&&_?1:0)}i.push(o)}return i}(this.dem),i=e.length-1,n=e[i];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(e,0,0,i,0)}raycastRoot(t,e,i,n,s,r,o=1){return Xd([t,e,-100],[i,n,this.maximums[0]*o],s,r)}raycast(e,i,n,s,r,o,a=1){if(!this.nodeCount)return null;const h=this.raycastRoot(e,i,n,s,r,o,a);if(null==h)return null;const c=[],u=[],l=[],f=[],d=[{idx:0,t:h,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:h,t:p,nodex:m,nodey:_,depth:v}=d.pop();if(this.leaves[h]){Kd(m,_,v,e,i,n,s,l,f);const h=1<<v,c=(m+0)/h,u=(m+1)/h,d=(_+0)/h,g=(_+1)/h,b=ep(c,d,this.dem)*a,w=ep(u,d,this.dem)*a,y=ep(u,g,this.dem)*a,x=ep(c,g,this.dem)*a,M=Zd(l[0],l[1],b,f[0],l[1],w,f[0],f[1],y,r,o),T=Zd(f[0],f[1],y,l[0],f[1],x,l[0],l[1],b,r,o),O=Math.min(null!==M?M:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(O!==Number.MAX_VALUE)return O;{const e=t.$.scaleAndAdd([],r,o,p);if(tp(b,w,x,y,Jd(e[0],l[0],f[0]),Jd(e[1],l[1],f[1]))>=e[2])return p}continue}let g=0;for(let t=0;t<this._siblingOffset.length;t++){Kd((m<<1)+this._siblingOffset[t][0],(_<<1)+this._siblingOffset[t][1],v+1,e,i,n,s,l,f),l[2]=-100,f[2]=this.maximums[this.childOffsets[h]+t]*a;const d=Xd(l,f,r,o);if(null!=d){const e=d;c[t]=e;let i=!1;for(let n=0;n<g&&!i;n++)e>=c[u[n]]&&(u.splice(n,0,t),i=!0);i||(u[g]=t),g++}}for(let t=0;t<g;t++){const e=u[t];d.push({idx:this.childOffsets[h]+e,t:c[e],nodex:(m<<1)+this._siblingOffset[e][0],nodey:(_<<1)+this._siblingOffset[e][1],depth:v+1})}}return null}_addNode(t,e,i){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,i,n,s){if(1===t[n].isLeaf(e,i))return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const r=n-1,o=t[r];let a=0,h=0;for(let t=0;t<this._siblingOffset.length;t++){const n=2*e+this._siblingOffset[t][0],s=2*i+this._siblingOffset[t][1],r=o.getElevation(n,s),c=o.isLeaf(n,s),u=this._addNode(r.min,r.max,c);c&&(a|=1<<t),h||(h=u)}for(let n=0;n<this._siblingOffset.length;n++)a&1<<n||this._construct(t,2*e+this._siblingOffset[n][0],2*i+this._siblingOffset[n][1],r,h+n)}}function tp(t,e,i,n,s,r){return qn(qn(t,i,r),qn(e,n,r),s)}function ep(t,e,i){const n=i.dim,s=Je(t*n-.5,0,n-1),r=Je(e*n-.5,0,n-1),o=Math.floor(s),a=Math.floor(r),h=Math.min(o+1,n-1),c=Math.min(a+1,n-1);return tp(i.get(o,a),i.get(h,a),i.get(o,c),i.get(h,c),s-o,r-a)}const ip={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function np(t,e,i){return(256*t*256+256*e+i)/10-1e4}function sp(t,e,i){return 256*t+e+i/256-32768}class rp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,i,n=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return pi(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const s=this.dim=e.height-2,r=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.floatView=new Float32Array(e.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let t=0;t<s;t++)r[this._idx(-1,t)]=r[this._idx(0,t)],r[this._idx(s,t)]=r[this._idx(s-1,t)],r[this._idx(t,-1)]=r[this._idx(t,0)],r[this._idx(t,s)]=r[this._idx(t,s-1)];r[this._idx(-1,-1)]=r[this._idx(0,0)],r[this._idx(s,-1)]=r[this._idx(s-1,0)],r[this._idx(-1,s)]=r[this._idx(0,s-1)],r[this._idx(s,s)]=r[this._idx(s-1,s-1)]}const o="terrarium"===i?sp:np;for(let t=0;t<r.length;++t){const e=4*t;this.floatView[t]=o(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=Ri.now()}_buildQuadTree(){this._tree=new Qd(this)}get(t,e,i=!1){i&&(t=Je(t,-1,this.dim),e=Je(e,-1,this.dim));const n=this._idx(t,e);return this.floatView[n]}set(t,e,i){const n=this._idx(t,e),s=this.floatView[n];return this.floatView[n]=i,i-s}static getUnpackVector(t){return ip[t]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}static pack(t,e){const i=[0,0,0,0],n=rp.getUnpackVector(e);let s=Math.floor((t+n[3])/n[2]);return i[2]=s%256,s=Math.floor(s/256),i[1]=s%256,s=Math.floor(s/256),i[0]=s,i}getPixels(){return new bf({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,i){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let n=e*this.dim,s=e*this.dim+this.dim,r=i*this.dim,o=i*this.dim+this.dim;switch(e){case-1:n=s-1;break;case 1:s=n+1}switch(i){case-1:r=o-1;break;case 1:o=r+1}const a=-e*this.dim,h=-i*this.dim;for(let e=r;e<o;e++)for(let i=n;i<s;i++){const n=4*this._idx(i,e),s=4*this._idx(i+a,e+h);this.pixels[n+0]=t.pixels[s+0],this.pixels[n+1]=t.pixels[s+1],this.pixels[n+2]=t.pixels[s+2],this.pixels[n+3]=t.pixels[s+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Oa(rp,"DEMData"),Oa(Qd,"DemMinMaxQuadTree",{omit:["dem"]});class op{constructor(t,e,i){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=i}static create(t,e,i){const n=i||t.findDEMTileFor(e);if(!n||!n.dem)return;const s=n.dem,r=n.tileID,o=1<<e.canonical.z-r.canonical.z;return new op(n,s.dim/pr/o,[(e.canonical.x/o-r.canonical.x)*s.dim,(e.canonical.y/o-r.canonical.y)*s.dim])}tileCoordToPixel(t,e){const i=e*this._scale+this._offset[1],n=Math.floor(t*this._scale+this._offset[0]),s=Math.floor(i);return new Ue(n,s)}getElevationAt(t,e,i,n){const s=t*this._scale+this._offset[0],r=e*this._scale+this._offset[1],o=Math.floor(s),a=Math.floor(r),h=this._dem;return n=!!n,i?qn(qn(h.get(o,a,n),h.get(o,a+1,n),r-a),qn(h.get(o+1,a,n),h.get(o+1,a+1,n),r-a),s-o):h.get(o,a,n)}getElevationAtPixel(t,e,i){return this._dem.get(t,e,!!i)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Du(1,t)*this._dem.stride}}const ap={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},hp=Id.types,cp=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],up=["fill-extrusion-flood-light-ground-radius"],lp=Math.pow(2,13),fp=Math.pow(2,15)-1,dp=new Ue(0,1),pp=2147483648;function mp(t,e,i,n,s,r,o,a){t.emplaceBack((e<<1)+o,(i<<1)+r,(Math.floor(n*lp)<<1)+s,Math.round(a))}function _p(t,e,i,n){t.emplaceBack(e.x*pr,e.y*pr,i?0:1,n?1:0)}function vp(t,e,i,n,s,r){t.emplaceBack(e.x,e.y,(i.x<<1)+n,(i.y<<1)+s,r)}function gp(t,e,i){const n=16384;t.emplaceBack(e.x,e.y,e.z,i[0]*n,i[1]*n,i[2]*n)}class bp{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class wp{constructor(){this.centroidXY=new Ue(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ue(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ue(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ue(this.max.x-this.min.x,this.max.y-this.min.y)}}class yp{constructor(){this.acc=new Ue(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,e){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=e.x,t.min.y=t.max.y=e.y)}appendEdge(t,e,i){this.accCount++,this.acc._add(e);let n=!!this.borders;e.x<t.min.x?(t.min.x=e.x,n=!0):e.x>t.max.x&&(t.max.x=e.x,n=!0),e.y<t.min.y?(t.min.y=e.y,n=!0):e.y>t.max.y&&(t.max.y=e.y,n=!0),((0===e.x||e.x===pr)&&e.x===i.x)!=((0===e.y||e.y===pr)&&e.y===i.y)&&this.processBorderOverlap(e,i),n&&this.checkBorderIntersection(e,i)}checkBorderIntersection(t,e){e.x<0!=t.x<0&&this.addBorderIntersection(0,qn(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>pr!=t.x>pr&&this.addBorderIntersection(1,qn(e.y,t.y,(pr-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,qn(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>pr!=t.y>pr&&this.addBorderIntersection(3,qn(e.x,t.x,(pr-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[t];e<i[0]&&(i[0]=e),e>i[1]&&(i[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const i=0===t.x?0:1;this.addBorderIntersection(i,e.y),this.addBorderIntersection(i,t.y)}else{const i=0===t.y?2:3;this.addBorderIntersection(i,e.x),this.addBorderIntersection(i,t.x)}}centroid(){return 0===this.accCount?new Ue(0,0):new Ue(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,e)=>t+ +(e[0]!==Number.MAX_VALUE)),0):0}}function xp(t,e){const i=t.add(e)._unit(),n=Je(t.x*i.x+t.y*i.y,-1,1);var s,r,o;return s=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(s)))/4*fp*((r=t).x*(o=e).y-r.y*o.x<0?-1:1)}const Mp=[t=>t.x<0,t=>t.x>pr,t=>t.y<0,t=>t.y>pr];function Tp(t,e,i,n){const s=[4];if(0===n)return s;i._mult(n);const r=t.sub(i),o=e.sub(i),a=[t,e,r,o];for(let t=0;t<4;t++)for(const e of a)if(Mp[t](e)){s.push(t);break}return s}class Op{constructor(t){this.vertexArray=new Lh,this.indexArray=new tc,this.programConfigurations=new eu(t.layers,{zoom:t.zoom,lut:t.lut},(t=>up.includes(t))),this._segments=new Sc,this.hiddenByLandmarkVertexArray=new fc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Sc}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(t,e,i,n=!1){const s=t.length;if(s>2){let r=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*s,this.vertexArray.length,2*this._segmentToGroundQuads[r].length);let a;r!==this._segments.get().length-1&&(r++,this._segmentToGroundQuads[r]=[],this._segmentToRegionTriCounts[r]=[0,0,0,0,0]);{const e=t[0],i=t[1];a=xp(e.sub(t[s-1])._perp()._unit(),i.sub(e)._perp()._unit())}for(let h=0;h<s;h++){const c=h===s-1?0:h+1,u=t[h],l=t[c],f=t[c===s-1?0:c+1],d=l.sub(u)._perp()._unit(),p=xp(d,f.sub(l)._perp()._unit()),m=a,_=p;if(Ip(u,l,e)||n&&Cp(u,e)&&Cp(l,e)){a=p;continue}const v=o.vertexLength;vp(this.vertexArray,u,l,1,1,m),vp(this.vertexArray,u,l,1,0,m),vp(this.vertexArray,u,l,0,1,_),vp(this.vertexArray,u,l,0,0,_),o.vertexLength+=4;const g=Tp(u,l,d,i);for(const t of g)this._segmentToGroundQuads[r].push({id:v,region:t}),this._segmentToRegionTriCounts[r][t]+=2,o.primitiveLength+=2;a=p}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),e=t.length;for(let t=0;t<e;t++)this._segmentToGroundQuads[t].sort(((t,e)=>t.region-e.region));for(let i=0;i<e;i++){const e=this._segmentToGroundQuads[i],n=t[i],s=this._segmentToRegionTriCounts[i];s.reduce(((t,e)=>t+e),0);let r=0;for(let t=0;t<=4;t++){const e=s[t];if(0!==e){let i=this.regionSegments[t];i||(i=this.regionSegments[t]=new Sc);const s={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+r,vertexLength:n.vertexLength,primitiveLength:e};i.get().push(s)}r+=e}for(let t=0;t<e.length;t++){const i=e[t].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,e,i,n,s,r){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,e,i,n,s,r)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ld.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,e,i,n,s,r){this.hasData()&&this.programConfigurations.updatePaintArrays(t,e,i,n,s,r)}updateHiddenByLandmark(t){if(!this.hasData())return;const e=t.groundVertexCount+t.groundVertexArrayOffset;if(0===t.groundVertexCount)return;const i=t.flags&pp?1:0;for(let n=t.groundVertexArrayOffset;n<e;++n)this.hiddenByLandmarkVertexArray.emplace(n,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,pd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const e=this.regionSegments[t];e&&e.destroy()}}}}class Ep{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new tc,this.footprintVertices=new Nh,this.footprintSegments=[],this.layoutVertexArray=new zh,this.centroidVertexArray=new Mc,this.wallVertexArray=new Oc,this.indexArray=new tc,this.programConfigurations=new eu(t.layers,{zoom:t.zoom,lut:t.lut},(t=>cp.includes(t))),this.segments=new Sc,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.groundEffect=new Op(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(t,e){}populate(t,e,i,n){this.features=[],this.hasPattern=td("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Uu(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:s,id:r,index:o,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,h=Ju(s,t);if(!this.layers[0]._featureFilter.filter(new Ja(this.zoom),h,i))continue;const c={id:r,sourceLayerIndex:a,index:o,geometry:t?h.geometry:Zu(s,i,n),properties:s.properties,type:s.type,patterns:{}},u=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(ed("fill-extrusion",this.layers,c,this.zoom,e));else if(this.wallMode)for(const t of c.geometry)this.addFeature(c,[t],o,i,{},e.availableImages,n,e.brightness);else this.addFeature(c,c.geometry,o,i,{},e.availableImages,n,e.brightness);e.featureIndex.insert(s,c.geometry,o,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,e,i,n,s,r){for(const t of this.features){const{geometry:o}=t;if(this.wallMode)for(const a of o)this.addFeature(t,[a],t.index,e,i,n,s,r);else this.addFeature(t,o,t.index,e,i,n,s,r)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(t,e,i,n,s){const r=0!==Object.keys(t).length;if(r&&!this.stateDependentLayers.length)return;const o=r?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,e,o,i,n,s),this.groundEffect.update(t,e,o,i,n,s)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_d),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,dd.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,md.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,fd.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,i,n,s,r,o,a){const h=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,c=[new Ue(0,0),new Ue(pr,pr)],u=o.projection,l="globe"===u.name,f=this.wallMode||"Polygon"===hp[t.type],d=new yp;d.centroidDataIndex=this.centroidData.length;const p=new wp,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},n)<=0,_=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},n);let v;if(p.height=_,p.vertexArrayOffset=this.layoutVertexArray.length,p.groundVertexArrayOffset=this.groundEffect.vertexArray.length,l&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vh),this.wallMode){if(l)return void pi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==e.length)return;v=function(t){const e=t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y,i=function(t){let e=0;const i=t.length;for(let n=0;n<i;n++)e+=(t[(n+1)%i].x-t[n].x)*(t[(n+1)%i].y+t[n].y);return e>=0}(t);i||(t=t.reverse());const n={isPolygon:e,geometry:[],joinNormals:[]},s=[],r=[],o=[];let a=t.length;if(a<(e?3:2))return n;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let h,c,u,l,f,d=0;for(;d<a-1&&t[d].equals(t[d+1]);)d++;e&&(h=t[a-2],f=t[d].sub(h)._unit()._perp());for(let i=d;i<a;i++){if(u=i===a-1?e?t[d+1]:void 0:t[i+1],u&&t[i].equals(u))continue;f&&(l=f),h&&(c=h),h=t[i],f=u?u.sub(h)._unit()._perp():l,l=l||f;const n=l.add(f);0===n.x&&0===n.y||n._unit();const p=n.x*f.x+n.y*f.y,m=0!==p?1/p:1/0,_=l.x*f.y-l.y*f.x>0;let v="miter";"miter"===v&&m>2&&(v="bevel");const g=(t,e,i,n)=>{const a=new Ue(t.x,t.y),h=new Ue(t.x,t.y);a.x-=e.x*n,a.y-=e.y*n,h.x-=e.x*Math.max(i,1),h.y-=e.y*Math.max(i,1),o.push(e),s.push(a),r.push(h)};if("miter"===v)n._mult(m),g(h,n,1,0);else{const t=-Math.sqrt(m*m-1),e=_?t:0,i=_?0:t;c&&g(h,l,e,i),u&&g(h,f,e,i)}}return n.geometry=[...s,...r.reverse(),s[0]],n.joinNormals=[...o,...o.reverse(),o[o.length-1]],n}(e[0]),e=[v.geometry]}const g=(t,e)=>t<(e.length-1)/2||t===e.length-1,b=this.wallMode?[e]:Kf(e,500);for(let t=b.length-1;t>=0;t--){const e=b[t];(0===e.length||(w=e[0]).every((t=>t.x<=0))||w.every((t=>t.x>=pr))||w.every((t=>t.y<=0))||w.every((t=>t.y>=pr)))&&b.splice(t,1)}var w;let y;if(l)y=Pp(b,c,n);else{y=[];for(const t of b)y.push({polygon:t,bounds:c})}const x=f?this.edgeRadius:0,M=x>0&&this.zoom<17,T=(t,e)=>{if(0===t.length)return!1;const i=t[t.length-1];return e.x===i.x&&e.y===i.y};for(const{polygon:t,bounds:e}of y){let i=0,s=0;for(const e of t)f&&!e[0].equals(e[e.length-1])&&e.push(e[0]),s+=f?e.length-1:e.length;const r=this.segments.prepareSegment((f?5:4)*s,this.layoutVertexArray,this.indexArray);p.footprintSegIdx<0&&(p.footprintSegIdx=this.footprintSegments.length),p.polygonSegIdx<0&&(p.polygonSegIdx=this.polygonSegments.length);const o={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new bp;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],f){const s=[],o=[];i=r.vertexLength;for(let i=0;i<t.length;i++){const c=t[i];c.length&&0!==i&&o.push(s.length/2);const f=[];let d,p;d=c[1].sub(c[0])._perp()._unit(),a.ringIndices.push(c.length-1);for(let t=1;t<c.length;t++){const e=c[t],i=c[t===c.length-1?1:t+1],o=e.clone();if(x){p=i.sub(e)._perp()._unit();const t=d.add(p)._unit(),n=x*Math.min(4,1/(d.x*t.x+d.y*t.y));o.x+=n*t.x,o.y+=n*t.y,o.x=Math.round(o.x),o.y=Math.round(o.y),d=p}if(!m||0!==x&&!M||T(f,o)||f.push(o),mp(this.layoutVertexArray,o.x,o.y,0,0,1,1,0),this.wallMode){const e=g(t,c);_p(this.wallVertexArray,v.joinNormals[t],e,v.isPolygon)}r.vertexLength++,this.footprintVertices.emplaceBack(e.x,e.y),s.push(e.x,e.y),l&&gp(this.layoutVertexExtArray,u.projectTilePoint(o.x,o.y,n),u.upVector(n,o.x,o.y))}m&&(0===x||M)&&(0!==f.length&&T(f,f[0])&&f.pop(),this.groundEffect.addData(f,e,h))}const c=Af(s,o);for(let t=0;t<c.length;t+=3)this.footprintIndices.emplaceBack(a.vertexOffset+c[t+0],a.vertexOffset+c[t+1],a.vertexOffset+c[t+2]),this.indexArray.emplaceBack(i+c[t],i+c[t+2],i+c[t+1]),r.primitiveLength++;a.indexCount+=c.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let s=0;s<t.length;s++){const o=t[s];d.startRing(p,o[0]);let a=o.length>4&&jp(o[o.length-2],o[0],o[1]),c=x?Sp(o[o.length-2],o[0],o[1],x):0;const _=[];let b,w,y;w=o[1].sub(o[0])._perp()._unit();let M=!0;for(let t=1,s=0;t<o.length;t++){let h=o[t-1],f=o[t];const O=o[t===o.length-1?1:t+1];if(d.appendEdge(p,f,h),Ip(f,h,e)){x&&(w=O.sub(f)._perp()._unit(),M=!M);continue}const E=f.sub(h)._perp(),A=E.x/(Math.abs(E.x)+Math.abs(E.y)),S=E.y>0?1:0,k=h.dist(f);if(s+k>32768&&(s=0),x){y=O.sub(f)._perp()._unit();let t=kp(h,f,O,Ap(w,y),x);isNaN(t)&&(t=0);const e=f.sub(h)._unit();h=h.add(e.mult(c))._round(),f=f.add(e.mult(-t))._round(),c=t,w=y,m&&this.zoom>=17&&(T(_,h)||_.push(h),T(_,f)||_.push(f))}const I=r.vertexLength,C=o.length>4&&jp(h,f,O);let j=Dp(s,a,M);if(mp(this.layoutVertexArray,h.x,h.y,A,S,0,0,j),mp(this.layoutVertexArray,h.x,h.y,A,S,0,1,j),this.wallMode){const e=g(t-1,o),i=v.joinNormals[t-1];_p(this.wallVertexArray,i,!e,v.isPolygon),_p(this.wallVertexArray,i,!e,v.isPolygon)}if(s+=k,j=Dp(s,C,!M),a=C,mp(this.layoutVertexArray,f.x,f.y,A,S,0,0,j),mp(this.layoutVertexArray,f.x,f.y,A,S,0,1,j),this.wallMode){const e=g(t,o),i=v.joinNormals[t];_p(this.wallVertexArray,i,!e,v.isPolygon),_p(this.wallVertexArray,i,!e,v.isPolygon)}if(r.vertexLength+=4,this.indexArray.emplaceBack(I+0,I+1,I+2),this.indexArray.emplaceBack(I+1,I+3,I+2),r.primitiveLength+=2,x){const n=i+(1===t?o.length-2:t-2),s=1===t?i:n+1;if(this.indexArray.emplaceBack(I+1,n,I+3),this.indexArray.emplaceBack(n,s,I+3),r.primitiveLength+=2,void 0===b&&(b=I),!Ip(O,o[t],e)){const e=t===o.length-1?b:r.vertexLength;this.indexArray.emplaceBack(I+2,I+3,e),this.indexArray.emplaceBack(I+3,e+1,e),this.indexArray.emplaceBack(I+3,s,e+1),r.primitiveLength+=3}M=!M}if(l){const t=this.layoutVertexExtArray,e=u.projectTilePoint(h.x,h.y,n),i=u.projectTilePoint(f.x,f.y,n),s=u.upVector(n,h.x,h.y),r=u.upVector(n,f.x,f.y);gp(t,e,s),gp(t,e,s),gp(t,i,r),gp(t,i,r)}}f&&(i+=o.length-1),m&&x&&this.zoom>=17&&(0!==_.length&&T(_,_[0])&&_.pop(),this.groundEffect.addData(_,e,h,x>0))}this.footprintSegments.push(a),o.triangleCount=this.indexArray.length-o.triangleArrayOffset,this.polygonSegments.push(o),++p.footprintSegLen,++p.polygonSegLen}if(p.vertexCount=this.layoutVertexArray.length-p.vertexArrayOffset,p.groundVertexCount=this.groundEffect.vertexArray.length-p.groundVertexArrayOffset,0!==p.vertexCount){if(p.centroidXY=d.borders?dp:this.encodeCentroid(d,p),this.centroidData.push(p),d.borders){this.featuresOnBorder.push(d);const t=this.featuresOnBorder.length-1;for(let e=0;e<d.borders.length;e++)d.borders[e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[e].push(t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,s,r,n,a),this.groundEffect.addPaintPropertiesData(t,i,s,r,n,a),this.maxHeight=Math.max(this.maxHeight,_)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((e,i)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[i].borders[t][0]))}splitToSubtiles(){const t=[];for(let e=0;e<this.centroidData.length;e++){const i=this.centroidData[e],n=+(i.min.y+i.max.y>pr),s=2*n+(+(i.min.x+i.max.x>pr)^n);for(let n=0;n<i.polygonSegLen;n++){const r=i.polygonSegIdx+n;t.push({centroidIdx:e,subtile:s,polygonSegmentIdx:r,triangleSegmentIdx:this.polygonSegments[r].triangleSegIdx})}}const e=new tc;t.sort(((t,e)=>t.triangleSegmentIdx===e.triangleSegmentIdx?t.subtile-e.subtile:t.triangleSegmentIdx-e.triangleSegmentIdx));let i=0,n=0,s=0;for(const e of t){if(e.triangleSegmentIdx!==i)break;s++}const r=t.length;for(;n!==t.length;){i=t[n].triangleSegmentIdx;let o=0,a=n,h=n;for(let e=a;e<s&&t[e].subtile===o;e++)h++;for(;a!==s;){const n=t[a];o=n.subtile;const r=this.centroidData[n.centroidIdx].min.clone(),c=this.centroidData[n.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:e.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=a;i<h;i++){const n=t[i],s=this.polygonSegments[n.polygonSegmentIdx],o=this.centroidData[n.centroidIdx].min,a=this.centroidData[n.centroidIdx].max,h=this.indexArray.uint16;for(let t=s.triangleArrayOffset;t<s.triangleArrayOffset+s.triangleCount;t++)e.emplaceBack(h[3*t],h[3*t+1],h[3*t+2]);u.primitiveLength+=s.triangleCount,r.x=Math.min(r.x,o.x),r.y=Math.min(r.y,o.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:r,max:c}),a=h;for(let e=a;e<s&&t[e].subtile===t[a].subtile;e++)h++}n=s;for(let e=n;e<r&&t[e].triangleSegmentIdx===t[n].triangleSegmentIdx;e++)s++}e._trim(),this.indexArray=e}getVisibleSegments(t,e,i){const n=new Sc;if(this.wallMode){for(const t of this.triangleSubSegments)n.segments.push(t.segment);return n}let s=0,r=0;const o=1<<t.canonical.z;if(e){const i=e.getMinMaxForTile(t);i&&(s=i.min,r=i.max)}r+=this.maxHeight;const a=t.toUnwrapped();let h;const c=[a.canonical.x/o+a.wrap,a.canonical.y/o],u=[(a.canonical.x+1)/o+a.wrap,(a.canonical.y+1)/o],l=(t,e,i)=>[t[0]*(1-i[0])+e[0]*i[0],t[1]*(1-i[1])+e[1]*i[1]],f=[],d=[];for(const t of this.triangleSubSegments){f[0]=t.min.x/pr,f[1]=t.min.y/pr,d[0]=t.max.x/pr,d[1]=t.max.y/pr;const e=l(c,u,f),o=l(c,u,d);if(0===new Sl([e[0],e[1],s],[o[0],o[1],r]).intersectsPrecise(i)){h&&(n.segments.push(h),h=void 0);continue}const a=t.segment;h&&h.vertexOffset!==a.vertexOffset&&(n.segments.push(h),h=void 0),h?(h.vertexLength+=a.vertexLength,h.primitiveLength+=a.primitiveLength):h={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}return h&&n.segments.push(h),n}encodeCentroid(t,e){const i=t.centroid(),n=e.span(),s=Math.min(7,Math.round(n.x*this.tileToMeter/10)),r=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new Ue(Je(i.x,1,pr-1)<<3|s,Je(i.y,1,pr-1)<<3|r)}encodeBorderCentroid(t){if(!t.borders)return new Ue(0,0);const e=t.borders,i=Number.MAX_VALUE;if(e[0][0]!==i||e[1][0]!==i){const t=e[0][0]!==i?0:1;return new Ue(6|(e[0][0]!==i?0:65528),(e[t][0]+e[t][1])/2<<3|6)}{const t=e[2][0]!==i?2:3;return new Ue((e[t][0]+e[t][1])/2<<3|6,6|(e[2][0]!==i?0:65528))}}showCentroid(t){const e=this.centroidData[t.centroidDataIndex];e.flags&=pp,e.centroidXY.x=0,e.centroidXY.y=0,this.writeCentroidToBuffer(e)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const e=t.vertexArrayOffset,i=t.vertexCount+t.vertexArrayOffset,n=t.flags&pp?dp:t.centroidXY,s=this.centroidVertexArray.geta_centroid_pos0(e);if(this.centroidVertexArray.geta_centroid_pos1(e)!==n.y||s!==n.x){for(let t=e;t<i;++t)this.centroidVertexArray.emplace(t,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,e,i){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const n=e.getReplacementRegionsForTile(t.toUnwrapped());if(Ud(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const t of this.centroidData)t.flags&=2147483647;const s=[];for(const e of this.activeReplacements){if(e.order<i)continue;const n=Math.pow(2,e.footprintTileId.canonical.z-t.canonical.z);for(const i of this.centroidData)if(!(i.flags&pp||e.min.x>i.max.x||i.min.x>e.max.x||e.min.y>i.max.y||i.min.y>e.max.y))for(let r=0;r<i.footprintSegLen;r++){const o=this.footprintSegments[i.footprintSegIdx+r];if(s.length=0,Np(this.footprintVertices,o.vertexOffset,o.vertexCount,e.footprintTileId.canonical,t.canonical,s),Hd(e.footprint,s,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-n)){i.flags|=pp;break}}}for(const t of this.centroidData)this.writeCentroidToBuffer(t);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,e,i){let n=!1;for(let s=0;s<i.footprintSegLen;s++){const r=this.footprintSegments[i.footprintSegIdx+s];let o=0;for(const i of r.ringIndices){for(let s=o,a=i+o-1;s<i+o;a=s++){const i=this.footprintVertices.int16[2*(s+r.vertexOffset)+0],o=this.footprintVertices.int16[2*(s+r.vertexOffset)+1],h=this.footprintVertices.int16[2*(a+r.vertexOffset)+1];o>e!=h>e&&t<(this.footprintVertices.int16[2*(a+r.vertexOffset)+0]-i)*(e-o)/(h-o)+i&&(n=!n)}o=i}}return n}getHeightAtTileCoord(t,e){let i=Number.NEGATIVE_INFINITY,n=!0;const s=4*(t+pr)*pr+(e+pr);if(this.partLookup.hasOwnProperty(s)){const t=this.partLookup[s];return t?{height:t.height,hidden:!!(t.flags&pp)}:void 0}for(const r of this.centroidData)t>r.max.x||r.min.x>t||e>r.max.y||r.min.y>e||this.footprintContainsPoint(t,e,r)&&r&&r.height>i&&(i=r.height,this.partLookup[s]=r,n=!!(r.flags&pp));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:n};this.partLookup[s]=void 0}}function Ap(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Sp(t,e,i,n){const s=e.sub(t)._perp()._unit(),r=i.sub(e)._perp()._unit();return kp(t,e,i,Ap(s,r),n)}function kp(t,e,i,n,s){const r=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,s*r/n)}function Ip(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Cp(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function jp(t,e,i){if(t.x<0||t.x>=pr||e.x<0||e.x>=pr||i.x<0||i.x>=pr)return!1;const n=i.sub(e),s=n.perp(),r=t.sub(e);return(n.x*r.x+n.y*r.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(r.x*r.x+r.y*r.y))>-.866&&s.x*r.x+s.y*r.y<0}function Dp(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function Rp(){const t=Math.PI/32,e=Math.tan(t),i=vu;return i*Math.sqrt(1+2*e*e)-i}function Pp(t,e,i){const n=1<<i.z,s=Ru(i.x/n),r=Ru((i.x+1)/n),o=Pu(i.y/n),a=Pu((i.y+1)/n);return function(t,e,i,n,s=0,r){const o=[];if(!t.length||!i||!n)return o;const a=(t,e)=>{for(const i of t)o.push({polygon:i,bounds:e})},h=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(n)),u=h-c,l=[];for(let t=0;t<Math.abs(u);t++)l.push(u>0?0:1);for(let t=0;t<Math.min(h,c);t++)l.push(0),l.push(1);let f=t;if(f=Dd(f,e[0].y-s,e[1].y+s,1),f=Dd(f,e[0].x-s,e[1].x+s,0),!f.length)return o;const d=[];for(l.length?d.push({polygons:f,bounds:e,depth:0}):a(f,e);d.length;){const t=d.pop(),e=t.depth,i=l[e],n=t.bounds[0],o=t.bounds[1],h=0===i?n.x:n.y,c=0===i?o.x:o.y,u=r?r(i,h,c):.5*(h+c),f=Dd(t.polygons,h-s,u+s,i),p=Dd(t.polygons,u-s,c+s,i);if(f.length){const t=[n,new Ue(0===i?u:o.x,1===i?u:o.y)];l.length>e+1?d.push({polygons:f,bounds:t,depth:e+1}):a(f,t)}if(p.length){const t=[new Ue(0===i?u:n.x,1===i?u:n.y),o];l.length>e+1?d.push({polygons:p,bounds:t,depth:e+1}):a(p,t)}}return o}(t,e,Math.ceil((r-s)/11.25),Math.ceil((o-a)/11.25),1,((t,e,s)=>{if(0===t)return.5*(e+s);{const t=Pu((i.y+e/pr)/n);return(ju(.5*(Pu((i.y+s/pr)/n)+t))*n-i.y)*pr}}))}function Np(t,e,i,n,s,r){const o=Math.pow(2,n.z-s.z);for(let a=0;a<i;a++){let i=t.int16[2*(a+e)+0],h=t.int16[2*(a+e)+1];i=(i+s.x*pr)*o-n.x*pr,h=(h+s.y*pr)*o-n.y*pr,r.push(new Ue(i,h))}}let Fp,zp;function Lp(t,e){return t.x*e.x+t.y*e.y}function $p(t,e){if(1===t.length){let i=0;const n=e[i++];let s;for(;!s||n.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){const r=e[i],o=t[0],a=s.sub(n),h=r.sub(n),c=o.sub(n),u=Lp(a,a),l=Lp(a,h),f=Lp(h,h),d=Lp(c,a),p=Lp(c,h),m=u*f-l*l,_=(f*d-l*p)/m,v=(u*p-l*d)/m,g=n.z*(1-_-v)+s.z*_+r.z*v;if(isFinite(g))return g}return 1/0}{let t=1/0;for(const i of e)t=Math.min(t,i.z);return t}}function Up(t,e,i,n,s,r,o,a){const h=o*s.getElevationAt(t,e,!0,!0),c=0!==r[0],u=c?0===r[1]?o*(r[0]/7-450):o*function(t,e,i){const n=Math.floor(e[0]/8),s=Math.floor(e[1]/8),r=10*(e[0]-8*n),o=10*(e[1]-8*s),a=t.getElevationAt(n,s,!0,!0),h=t.getMeterToDEM(i),c=Math.floor(.5*(r*h-1)),u=Math.floor(.5*(o*h-1)),l=t.tileCoordToPixel(n,s),f=2*c+1,d=2*u+1,p=function(t,e,i,n,s){return[t.getElevationAtPixel(e,i,!0),t.getElevationAtPixel(e+s,i,!0),t.getElevationAtPixel(e,i+s,!0),t.getElevationAtPixel(e+n,i+s,!0)]}(t,l.x-c,l.y-u,f,d),m=Math.abs(p[0]-p[1]),_=Math.abs(p[2]-p[3]),v=Math.abs(p[0]-p[2])+Math.abs(p[1]-p[3]),g=Math.min(.25,.5*h*(m+_)/f),b=Math.min(.25,.5*h*v/d);return a+Math.max(g*r,b*o)}(s,r,a):h;return{base:h+(0===i)?-1:i,top:c?Math.max(u+n,h+i+2):h+n}}Oa(Ep,"FillExtrusionBucket",{omit:["layers","features"]}),Oa(wp,"PartData"),Oa(bp,"FootprintSegment"),Oa(yp,"BorderCentroidData"),Oa(Op,"GroundEffect");const Bp=Rh([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gp}=Bp,Hp=Rh([{name:"a_packed",components:4,type:"Float32"}]),{members:Vp}=Hp,Wp=Rh([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:qp}=Wp,Yp=Rh([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xp=Rh([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Zp=Rh([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rh([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jp=Rh([{name:"a_z_offset",components:1,type:"Float32"}],4),Kp=Rh([{name:"a_texb",components:2,type:"Uint16"}]),Qp=Rh([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tm=Rh([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Rh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const em=Rh([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),im=Rh([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rh([{name:"triangle",components:3,type:"Uint16"}]),Rh([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rh([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Rh([{type:"Float32",name:"offsetX"}]),Rh([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class nm{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new vf({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const i=this.getKey(t,e);return this.positions[i]}trim(){const t=this.width,e=this.height=oi(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,i){const n=[];let s=t.length%2==1?-t[t.length-1]*i:0,r=t[0]*i,o=!0;n.push({left:s,right:r,isDash:o,zeroLength:0===t[0]});let a=t[0];for(let e=1;e<t.length;e++){o=!o;const h=t[e];s=a*i,a+=h,r=a*i,n.push({left:s,right:r,isDash:o,zeroLength:0===h})}return n}addRoundDash(t,e,i){const n=e/2;for(let e=-i;e<=i;e++){const s=this.width*(this.nextRow+i+e);let r=0,o=t[r];for(let a=0;a<this.width;a++){a/o.right>1&&(o=t[++r]);const h=Math.abs(a-o.left),c=Math.abs(a-o.right),u=Math.min(h,c);let l;const f=e/i*(n+1);if(o.isDash){const t=n-Math.abs(f);l=Math.sqrt(u*u+t*t)}else l=n-Math.sqrt(u*u+f*f);this.image.data[s+a]=Math.max(0,Math.min(255,l+128))}}}addRegularDash(t,e){for(let e=t.length-1;e>=0;--e){const i=t[e],n=t[e+1];i.zeroLength?t.splice(e,1):n&&n.isDash===i.isDash&&(n.left=i.left,t.splice(e,1))}const i=t[0],n=t[t.length-1];i.isDash===n.isDash&&(i.left=n.left-this.width,n.right=i.right+this.width);const s=this.width*this.nextRow;let r=0,o=t[r];for(let i=0;i<this.width;i++){i/o.right>1&&(o=t[++r]);const n=Math.abs(i-o.left),a=Math.abs(i-o.right),h=Math.min(n,a);this.image.data[s+i]=Math.max(0,Math.min(255,(o.isDash?h:-h)+e+128))}}addDash(t,e){const i=this.getKey(t,e);if(this.positions[i])return this.positions[i];const n="round"===e,s=n?7:0,r=2*s+1;if(this.nextRow+r>this.height)return pi("LineAtlas out of space"),null;0===t.length&&t.push(1);let o=0;for(let e=0;e<t.length;e++)t[e]<0&&(pi("Negative value is found in line dasharray, replacing values with 0"),t[e]=0),o+=t[e];if(0!==o){const i=this.width/o,r=this.getDashRanges(t,this.width,i);n?this.addRoundDash(r,i,s):this.addRegularDash(r,"square"===e?.5*i:0)}const a=this.nextRow+s;this.nextRow+=r;const h={tl:[a,s],br:[o,0]};return this.positions[i]=h,h}}Oa(nm,"LineAtlas");const sm=Id.types,rm=Math.cos(Math.PI/180*37.5),om=Math.cos(Math.PI/180*5);class am{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((t=>{this.gradients[t.id]={}})),this.layoutVertexArray=new $h,this.layoutVertexArray2=new Uh,this.patternVertexArray=new Bh,this.indexArray=new tc,this.programConfigurations=new eu(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new Sc,this.maxLineLength=0,this.zOffsetVertexArray=new nc,this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.tessellationStep=t.tessellationStep?t.tessellationStep:pr/64}updateFootprints(t,e){}populate(t,e,i,n){this.hasPattern=td("line",this.layers,e);const s=this.layers[0].layout.get("line-sort-key"),r=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!r.isConstant()||!!r.constantOr(0);const o=[];for(const{feature:e,id:r,index:a,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,c=Ju(e,t);if(!this.layers[0]._featureFilter.filter(new Ja(this.zoom),c,i))continue;const u=s?s.evaluate(c,{},i):void 0,l={id:r,properties:e.properties,type:e.type,sourceLayerIndex:h,index:a,geometry:t?c.geometry:Zu(e,i,n),patterns:{},sortKey:u};o.push(l)}s&&o.sort(((t,e)=>t.sortKey-e.sortKey));const{lineAtlas:a,featureIndex:h}=e,c=this.addConstantDashes(a);for(const n of o){const{geometry:s,index:r,sourceLayerIndex:o}=n;if(c&&this.addFeatureDashes(n,a),this.hasPattern){const t=ed("line",this.layers,n,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(n,s,r,i,a.positions,e.availableImages,e.brightness);h.insert(t[r].feature,s,r,o,this.index)}}addConstantDashes(t){let e=!1;for(const i of this.layers){const n=i.paint.get("line-dasharray").value,s=i.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==s.kind)e=!0;else{const e=s.value,i=n.value;if(!i)continue;t.addDash(i,e)}}return e}addFeatureDashes(t,e){const i=this.zoom;for(const n of this.layers){const s=n.paint.get("line-dasharray").value,r=n.layout.get("line-cap").value;if("constant"===s.kind&&"constant"===r.kind)continue;let o,a;if("constant"===s.kind){if(o=s.value,!o)continue}else o=s.evaluate({zoom:i},t);a="constant"===r.kind?r.value:r.evaluate({zoom:i},t),e.addDash(o,a),t.patterns[n.id]=e.getKey(o,a)}}update(t,e,i,n,s){const r=0!==Object.keys(t).length;r&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,e,r?this.stateDependentLayers:this.layers,i,n,s)}addFeatures(t,e,i,n,s,r){for(const t of this.patternFeatures)this.addFeature(t,t.geometry,t.index,e,i,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Vp)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,qp)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Jp.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,i,n,s,r,o){const a=this.layers[0].layout,h=a.get("line-join").evaluate(t,{}),c=a.get("line-cap").evaluate(t,{}),u=a.get("line-miter-limit"),l=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const i of e)this.addLine(i,t,n,h,c,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,s,r,n,o)}addLine(t,e,i,n,s,r,o){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const a={zoom:this.zoom,lineProgress:void 0},h=this.layers[0].layout,c="none"===n;if(this.patternJoinNone=this.hasPattern&&c,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const u="Polygon"===sm[e.type];let l=t.length;for(;l>=2&&t[l-1].equals(t[l-2]);)l--;let f=0;for(;f<l-1&&t[f].equals(t[f+1]);)f++;if(l<(u?3:2))return;"bevel"===n&&(r=1.05);const d=this.overscaling<=16?15*pr/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let m,_,v,g,b,w;this.e1=this.e2=-1,u&&(m=t[l-2],b=t[f].sub(m)._unit()._perp());for(let i=f;i<l;i++){if(v=i===l-1?u?t[f+1]:void 0:t[i+1],v&&t[i].equals(v))continue;if(b&&(g=b),m&&(_=m),m=t[i],this.hasZOffset){const t=h.get("line-z-offset").value;if("constant"===t.kind)w=t.value;else{if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);a.lineProgress=(t*this.lineClips.start+this.distance+(_?_.dist(m):0))/t}else pi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),a.lineProgress=0;w=t.evaluate(a,e)}w=w||0}b=v?v.sub(m)._unit()._perp():g,g=g||b;const y=_&&v;let x=y?n:u||c?"butt":s;const M=g.x*b.x+g.y*b.y;if(c){const t=function(t){if(t.patternJoinNone){const e=t.segmentPoints.length/2,i=t.lineSoFar-t.segmentStart;for(let n=0;n<e;++n){const e=t.segmentPoints[2*n+1],s=Math.round(t.segmentPoints[2*n])+.5+.25*e;t.patternVertexArray.emplaceBack(s,i,t.segmentStart),t.patternVertexArray.emplaceBack(s,i,t.segmentStart)}t.segmentPoints.length=0}t.e1=t.e2=-1};if(y&&M<om){this.updateDistance(_,m),this.addCurrentVertex(m,g,1,1,p,w),t(this),this.addCurrentVertex(m,b,-1,-1,p,w);continue}if(_){if(!v){this.updateDistance(_,m),this.addCurrentVertex(m,g,1,1,p,w),t(this);continue}x="miter"}}let T=g.add(b);0===T.x&&0===T.y||T._unit();const O=T.x*b.x+T.y*b.y,E=0!==O?1/O:1/0,A=2*Math.sqrt(2-2*O),S=O<rm&&_&&v,k=g.x*b.y-g.y*b.x>0;if(S&&i>f){const t=m.dist(_);if(t>2*d){const e=m.sub(m.sub(_)._mult(d/t)._round());this.updateDistance(_,e),this.addCurrentVertex(e,g,0,0,p,w),_=e}}if(y&&"round"===x&&(E<o?x="miter":E<=2&&(x="fakeround")),"miter"===x&&E>r&&(x="bevel"),"bevel"===x&&(E>2&&(x="flipbevel"),E<r&&(x="miter")),_&&this.updateDistance(_,m),"miter"===x)T._mult(E),this.addCurrentVertex(m,T,0,0,p,w);else if("flipbevel"===x){if(E>100)T=b.mult(-1);else{const t=E*g.add(b).mag()/g.sub(b).mag();T._perp()._mult(t*(k?-1:1))}this.addCurrentVertex(m,T,0,0,p,w),this.addCurrentVertex(m,T.mult(-1),0,0,p,w)}else if("bevel"===x||"fakeround"===x){const t=-Math.sqrt(E*E-1),e=k?t:0,i=k?0:t;if(_&&this.addCurrentVertex(m,g,e,i,p,w),"fakeround"===x){const t=Math.round(180*A/Math.PI/20);for(let e=1;e<t;e++){let i=e/t;if(.5!==i){const t=i-.5;i+=i*t*(i-1)*((1.0904+M*(M*(3.55645-1.43519*M)-3.2452))*t*t+(.848013+M*(.215638*M-1.06021)))}const n=b.sub(g)._mult(i)._add(g)._unit()._mult(k?-1:1);this.addHalfVertex(m,n.x,n.y,!1,k,0,p,w)}}v&&this.addCurrentVertex(m,b,-e,-i,p,w)}else"butt"===x?this.addCurrentVertex(m,T,0,0,p,w):"square"===x?(_||this.addCurrentVertex(m,T,-1,-1,p,w),this.addCurrentVertex(m,T,0,0,p,w),_&&this.addCurrentVertex(m,T,1,1,p,w)):"round"===x&&(_&&(this.addCurrentVertex(m,g,0,0,p,w),this.addCurrentVertex(m,g,1,1,p,w,!0)),v&&(this.addCurrentVertex(m,b,-1,-1,p,w,!0),this.addCurrentVertex(m,b,0,0,p,w)));if(S&&i<l-1){const t=m.dist(v);if(t>2*d){const e=m.add(v.sub(m)._mult(d/t)._round());this.updateDistance(m,e),this.addCurrentVertex(e,b,0,0,p,w),m=e}}}}addVerticesTo(t,e,i,n,s,r,o,a,h,c){const u=(e.w-t.w)/this.tessellationStep|0;if(u>1){this.lineSoFar=t.w;const l=(e.x-t.x)/u,f=(e.y-t.y)/u,d=(e.z-t.z)/u,p=(e.w-t.w)/u;for(let e=1;e<u;++e)t.x+=l,t.y+=f,t.z+=d,this.lineSoFar+=p,this.addHalfVertex(t,i,n,c,!1,o,h,t.z),this.addHalfVertex(t,s,r,c,!0,-a,h,t.z)}this.lineSoFar=e.w,this.addHalfVertex(e,i,n,c,!1,o,h,e.z),this.addHalfVertex(e,s,r,c,!0,-a,h,e.z)}addCurrentVertex(t,e,i,n,s,r,o=!1){const a=e.x+e.y*i,h=e.y-e.x*i,c=e.y*n-e.x,u=-e.y-e.x*n;if(null!=r){const e=-10,l=pr+10,f=r,d=new jd(t.x,t.y,f,this.lineSoFar),p=hm(t,e,l),m=this.lineSoFar;if(this.currentVertex)if(p){const r=this.currentVertexIsOutside,d=this.currentVertex,p=new jd(t.x,t.y,f,this.lineSoFar);Pd(d,p,e,l),hm(p,e,l)||(r&&(this.e1=this.e2=-1,this.lineSoFar=d.w,this.addHalfVertex(d,a,h,o,!1,i,s,d.z),this.addHalfVertex(d,c,u,o,!0,-n,s,d.z)),this.addVerticesTo(d,p,a,h,c,u,i,n,s,o))}else{const t=this.currentVertex;this.currentVertexIsOutside&&(Pd(t,d,e,l),this.e1=this.e2=-1,this.lineSoFar=t.w,this.addHalfVertex(t,a,h,o,!1,i,s,t.z),this.addHalfVertex(t,c,u,o,!0,-n,s,t.z)),this.addVerticesTo(t,d,a,h,c,u,i,n,s,o)}else p||(this.addHalfVertex(t,a,h,o,!1,i,s,r),this.addHalfVertex(t,c,u,o,!0,-n,s,r));this.currentVertex=d,this.currentVertexIsOutside=p,this.lineSoFar=m}else this.addHalfVertex(t,a,h,o,!1,i,s,r),this.addHalfVertex(t,c,u,o,!0,-n,s,r)}addHalfVertex({x:t,y:e},i,n,s,r,o,a,h){this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),r||this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)),this.layoutVertexArray.emplaceBack((t<<1)+(s?1:0),(e<<1)+(r?1:0),Math.round(63*i)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),r?this.e2=c:this.e1=c,null!=h&&this.zOffsetVertexArray.emplaceBack(h)}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}function hm(t,e,i){return t.x<e||t.x>i||t.y<e||t.y>i}let cm,um;function lm(t,e,i){return e*(pr/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function fm(t,e){return 1/lm(t,1,e.tileZoom)}function dm(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}Oa(am,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const pm=t=>{const e=[];mm(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");0===i[0]&&0===i[1]||e.push("RENDER_LINE_TRIM_OFFSET"),0!==t.paint.get("line-border-width").constantOr(1)&&e.push("RENDER_LINE_BORDER");const n="none"===t.layout.get("line-join").constantOr("miter"),s=!!t.paint.get("line-pattern").constantOr(1);return n&&s&&e.push("LINE_JOIN_NONE"),e};function mm(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}class _m{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const i=t[e];this._stringToNumber[i]=e,this._numberToString[e]=i}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}var vm={
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
read:function(t,e,i,n,s){var r,o,a=8*s-n-1,h=(1<<a)-1,c=h>>1,u=-7,l=i?s-1:0,f=i?-1:1,d=t[e+l];for(l+=f,r=d&(1<<-u)-1,d>>=-u,u+=a;u>0;r=256*r+t[e+l],l+=f,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=n;u>0;o=256*o+t[e+l],l+=f,u-=8);if(0===r)r=1-c;else{if(r===h)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),r-=c}return(d?-1:1)*o*Math.pow(2,r-n)},write:function(t,e,i,n,s,r){var o,a,h,c=8*r-s-1,u=(1<<c)-1,l=u>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:r-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+l>=1?f/h:f*Math.pow(2,1-l))*h>=2&&(o++,h/=2),o+l>=u?(a=0,o=u):o+l>=1?(a=(e*h-1)*Math.pow(2,s),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,s),o=0));s>=8;t[i+d]=255&a,d+=p,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;t[i+d]=255&o,d+=p,o/=256,c-=8);t[i+d-p]|=128*m}},gm=wm,bm=vm;function wm(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}wm.Varint=0,wm.Fixed64=1,wm.Bytes=2,wm.Fixed32=5;var ym=4294967296,xm=1/ym,Mm="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Tm(t){return t.type===wm.Bytes?t.readVarint()+t.pos:t.pos+1}function Om(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Em(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var s=i.pos-1;s>=t;s--)i.buf[s+n]=i.buf[s]}function Am(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Sm(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function km(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Im(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Cm(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function jm(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Dm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Rm(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Pm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Nm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Fm(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function zm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}wm.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),s=n>>3,r=this.pos;this.type=7&n,t(s,e,this),this.pos===r&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Nm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=zm(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Nm(this.buf,this.pos)+Nm(this.buf,this.pos+4)*ym;return this.pos+=8,t},readSFixed64:function(){var t=Nm(this.buf,this.pos)+zm(this.buf,this.pos+4)*ym;return this.pos+=8,t},readFloat:function(){var t=bm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=bm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(t,e,i){var n,s,r=i.buf;if(n=(112&(s=r[i.pos++]))>>4,s<128)return Om(t,n,e);if(n|=(127&(s=r[i.pos++]))<<3,s<128)return Om(t,n,e);if(n|=(127&(s=r[i.pos++]))<<10,s<128)return Om(t,n,e);if(n|=(127&(s=r[i.pos++]))<<17,s<128)return Om(t,n,e);if(n|=(127&(s=r[i.pos++]))<<24,s<128)return Om(t,n,e);if(n|=(1&(s=r[i.pos++]))<<31,s<128)return Om(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Mm?function(t,e,i){return Mm.decode(t.subarray(e,i))}(this.buf,e,t):function(t,e,i){for(var n="",s=e;s<i;){var r,o,a,h=t[s],c=null,u=h>239?4:h>223?3:h>191?2:1;if(s+u>i)break;1===u?h<128&&(c=h):2===u?128==(192&(r=t[s+1]))&&(c=(31&h)<<6|63&r)<=127&&(c=null):3===u?(o=t[s+2],128==(192&(r=t[s+1]))&&128==(192&o)&&((c=(15&h)<<12|(63&r)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(o=t[s+2],a=t[s+3],128==(192&(r=t[s+1]))&&128==(192&o)&&128==(192&a)&&((c=(15&h)<<18|(63&r)<<12|(63&o)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,n+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),n+=String.fromCharCode(c),s+=u}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==wm.Bytes)return t.push(this.readVarint(e));var i=Tm(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==wm.Bytes)return t.push(this.readSVarint());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==wm.Bytes)return t.push(this.readBoolean());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==wm.Bytes)return t.push(this.readFloat());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==wm.Bytes)return t.push(this.readDouble());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==wm.Bytes)return t.push(this.readFixed32());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==wm.Bytes)return t.push(this.readSFixed32());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==wm.Bytes)return t.push(this.readFixed64());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==wm.Bytes)return t.push(this.readSFixed64());var e=Tm(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===wm.Varint)for(;this.buf[this.pos++]>127;);else if(e===wm.Bytes)this.pos=this.readVarint()+this.pos;else if(e===wm.Fixed32)this.pos+=4;else{if(e!==wm.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Fm(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Fm(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Fm(this.buf,-1&t,this.pos),Fm(this.buf,Math.floor(t*xm),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Fm(this.buf,-1&t,this.pos),Fm(this.buf,Math.floor(t*xm),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var i,n;if(t>=0?(i=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(i=~(-t%4294967296))?i=i+1|0:(i=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,i){i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,t>>>=7,i.buf[i.pos++]=127&t|128,i.buf[i.pos]=127&(t>>>=7)}(i,0,e),function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var n,s,r=0;r<e.length;r++){if((n=e.charCodeAt(r))>55295&&n<57344){if(!s){n>56319||r+1===e.length?(t[i++]=239,t[i++]=191,t[i++]=189):s=n;continue}if(n<56320){t[i++]=239,t[i++]=191,t[i++]=189,s=n;continue}n=s-55296<<10|n-56320|65536,s=null}else s&&(t[i++]=239,t[i++]=191,t[i++]=189,s=null);n<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:(n<65536?t[i++]=n>>12|224:(t[i++]=n>>18|240,t[i++]=n>>12&63|128),t[i++]=n>>6&63|128),t[i++]=63&n|128)}return i}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Em(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),bm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),bm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&Em(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,wm.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Am,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Sm,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Cm,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,km,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Im,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,jm,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Dm,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Rm,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Pm,e)},writeBytesField:function(t,e){this.writeTag(t,wm.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,wm.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,wm.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,wm.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,wm.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,wm.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,wm.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,wm.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,wm.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,wm.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Lm=f(gm);const $m=["id","tile","layer","source","sourceLayer","state"];class Um{constructor(t,e,i,n,s){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=i,this._y=n,this.properties=t.properties,this.id=s}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const e of $m)void 0!==this[e]&&(t[e]=this[e]);return t}}class Bm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,i){const n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},ii(this.stateChanges[t][n],i),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])i[e]||(this.deletedStates[t][n][e]=null)}else for(const e in i)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(t,e,i){if(null===this.deletedStates[t])return;const n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},i&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][i]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(i in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][i]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}getState(t,e){const i=String(e),n=ii({},(this.state[t]||{})[i],(this.stateChanges[t]||{})[i]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const i=this.deletedStates[t][e];if(null===i)return{};for(const t in i)delete n[t]}return n}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const i={};for(const t in this.stateChanges){this.state[t]=this.state[t]||{};const e={};for(const i in this.stateChanges[t])this.state[t][i]||(this.state[t][i]={}),ii(this.state[t][i],this.stateChanges[t][i]),e[i]=this.state[t][i];i[t]=e}for(const t in this.deletedStates){this.state[t]=this.state[t]||{};const e={};if(null===this.deletedStates[t])for(const i in this.state[t])e[i]={},this.state[t][i]={};else for(const i in this.deletedStates[t]){if(null===this.deletedStates[t][i])this.state[t][i]={};else if(this.state[t][i])for(const e of Object.keys(this.deletedStates[t][i]))delete this.state[t][i][e];e[i]=this.state[t][i]}i[t]=i[t]||{},ii(i[t],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const n in t)t[n].setFeatureState(i,e)}}class Gm{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ma(pr,16,0),this.featureIndexArray=new xc,this.promoteId=e,this.is3DTile=!1}insert(t,e,i,n,s,r=0,o=0){const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,n,s,r);const h=this.grid;for(let t=0;t<e.length;t++){const i=e[t],n=[1/0,1/0,-1/0,-1/0];for(let t=0;t<i.length;t++){const e=i[t];n[0]=Math.min(n[0],e.x),n[1]=Math.min(n[1],e.y),n[2]=Math.max(n[2],e.x),n[3]=Math.max(n[3],e.y)}0!==o&&(n[0]-=o,n[1]-=o,n[2]+=o,n[3]+=o),n[0]<pr&&n[1]<pr&&n[2]>=0&&n[3]>=0&&h.insert(a,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kd(new Lm(this.rawTileData)).layers,this.sourceLayerCoder=new _m(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,i,n){this.loadVTLayers();const s=t.params||{},r=ph(s.filter),o=t.tileResult,a=t.transform,h=o.bufferedTilespaceBounds,c=this.grid.query(h.min.x,h.min.y,h.max.x,h.max.y,((t,e,i,n)=>ll(o.bufferedTilespaceGeometry,t,e,i,n)));c.sort(Vm);let u=null;a.elevation&&c.length>0&&(u=op.create(a.elevation,this.tileID));const l={};let f;for(let h=0;h<c.length;h++){const d=c[h];if(d===f)continue;f=d;const p=this.featureIndexArray.get(d);let m=null;if(this.is3DTile){const t=this.bucketLayerIDs[0][0],i=e[t];if("model"!==i.type)continue;const{queryFeature:n,intersectionZ:s}=i.queryIntersectsMatchingFeature(o,p.featureIndex,r,a);n&&this.appendToResult(l,t,p.featureIndex,n,s)}else this.loadMatchingFeature(l,p,r,s.layers,s.availableImages,e,i,n,((e,i,n,s=0)=>(m||(m=Zu(e,this.tileID.canonical,t.tileTransform)),i.queryIntersectsFeature(o,e,n,m,this.z,t.transform,t.pixelPosMatrix,u,s))))}return l}loadMatchingFeature(t,e,i,n,s,r,o,a,h){const{featureIndex:c,bucketIndex:u,sourceLayerIndex:l,layoutVertexArrayOffset:f}=e,d=this.bucketLayerIDs[u];if(n&&!function(t,e){for(let i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1}(n,d))return;const p=this.sourceLayerCoder.decode(l),m=this.vtLayers[p].feature(c);if(i.needGeometry){const t=Ju(m,!0);if(!i.filter(new Ja(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!i.filter(new Ja(this.tileID.overscaledZ),m))return;const _=this.getId(m,p);for(let e=0;e<d.length;e++){const i=d[e];if(n&&n.indexOf(i)<0)continue;const u=r[i];if(!u)continue;let l={};void 0!==_&&a&&(l=a.getState(u.sourceLayer||"_geojsonTileLayer",_));const p=!h||h(m,u,l,f);if(!p)continue;const v=new Um(m,this.z,this.x,this.y,_),g=ii({},o[i]);g.paint=Hm(g.paint,u.paint,m,l,s),g.layout=Hm(g.layout,u.layout,m,l,s),v.layer=g,this.appendToResult(t,i,c,v,p)}}appendToResult(t,e,i,n,s){let r=t[e];void 0===r&&(r=t[e]=[]),r.push({featureIndex:i,feature:n,intersectionZ:s})}lookupSymbolFeatures(t,e,i,n,s,r,o,a){const h={};this.loadVTLayers();const c=ph(s);for(const s of t)this.loadMatchingFeature(h,{bucketIndex:i,sourceLayerIndex:n,featureIndex:s,layoutVertexArrayOffset:0},c,r,o,a,e);return h}loadFeature(t){const{featureIndex:e,sourceLayerIndex:i}=t;this.loadVTLayers();const n=this.sourceLayerCoder.decode(i),s=this.vtFeatures[n];if(s[e])return s[e];const r=this.vtLayers[n].feature(e);return s[e]=r,r}hasLayer(t){for(const e of this.bucketLayerIDs)for(const i of e)if(t===i)return!0;return!1}getId(t,e){let i=t.id;if(this.promoteId){const n="string"==typeof this.promoteId?this.promoteId:this.promoteId[e];null!=n&&(i=t.properties[n]),"boolean"==typeof i&&(i=Number(i))}return i}}function Hm(t,e,i,n,s){return ui(t,((t,r)=>{const o=e instanceof rh?e.get(r):null;return o&&o.evaluate?o.evaluate(i,n,s):o}))}function Vm(t,e){return e-t}Oa(Gm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Wm=24;const qm=128;function Ym(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Ja(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:n}=i;let s=0;for(;s<e.length&&e[s]<=t;)s++;s=Math.max(0,s-1);let r=s;for(;r<e.length&&e[r]<t+1;)r++;r=Math.min(e.length-1,r);const o=e[s],a=e[r];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:a,interpolationType:n}:{kind:"camera",minZoom:o,maxZoom:a,minSize:i.evaluate(new Ja(o)),maxSize:i.evaluate(new Ja(a)),interpolationType:n}}}function Xm(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:s}){return"source"===t.kind?n/qm:"composite"===t.kind?qn(n/qm,s/qm,i):e}function Zm(t,e){let i=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){const{interpolationType:s,minZoom:r,maxZoom:o}=t,a=s?Je(Mo.interpolationFactor(s,e,r,o),0,1):0;"camera"===t.kind?n=qn(t.minSize,t.maxSize,a):i=a}return{uSizeT:i,uSize:n}}var Jm=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:qm,evaluateSizeForFeature:Xm,evaluateSizeForZoom:Zm,getSizeData:Ym});function Km(t,e,i){return t.sections.forEach((t=>{t.text=function(t,e,i){const n=e.layout.get("text-transform").evaluate(i,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Za.applyArabicShaping&&(t=Za.applyArabicShaping(t)),t}(t.text,e,i)})),t}const Qm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function t_(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}function e_(t){return""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t||""===t}const i_=3;function n_(t,e,i){e.glyphs=[],1===t&&i.readMessage(s_,e)}function s_(t,e,i){if(3===t){const{id:t,bitmap:n,width:s,height:r,left:o,top:a,advance:h}=i.readMessage(r_,{});e.glyphs.push({id:t,bitmap:new vf({width:s+2*i_,height:r+2*i_},n),metrics:{width:s,height:r,left:o,top:a,advance:h}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function r_(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const o_=i_,a_={horizontal:1,vertical:2,horizontalOnly:3};class h_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const i=new h_;return i.scale=t||1,i.fontStack=e,i}static forImage(t){const e=new h_;return e.imageName=t,e}}class c_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const i=new c_;for(let n=0;n<t.sections.length;n++){const s=t.sections[n];s.image?i.addImageSection(s):i.addTextSection(s,e)}return i}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(t,e){let i="";for(let n=0;n<t.length;n++){const s=t.charCodeAt(n+1)||null,r=t.charCodeAt(n-1)||null;i+=!e&&(s&&Pa(s)&&!Qm[t[n+1]]||r&&Pa(r)&&!Qm[t[n-1]])||!Qm[t[n]]?t[n]:Qm[t[n]]}return i}(this.text,t)}trim(){let t=0;for(let e=0;e<this.text.length&&l_[this.text.charCodeAt(e)];e++)t++;let e=this.text.length;for(let i=this.text.length-1;i>=0&&i>=t&&l_[this.text.charCodeAt(i)];i--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const i=new c_;return i.text=this.text.substring(t,e),i.sectionIndex=this.sectionIndex.slice(t,e),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,e)=>Math.max(t,this.sections[e].scale)),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(h_.forText(t.scale,t.fontStack||e));const i=this.sections.length-1;for(let e=0;e<t.text.length;++e)this.sectionIndex.push(i)}addImageSection(t){const e=t.image?t.image.namePrimary:"";if(0===e.length)return void pi("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(h_.forImage(e)),this.sectionIndex.push(this.sections.length-1)):pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function u_(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p){const m=c_.fromFeature(t,s);l===a_.vertical&&m.verticalizePunctuation(f);let _=[];const v=function(t,e,i,n,s,r){if(!t)return[];const o=[],a=function(t,e,i,n,s,r){let o=0;for(let i=0;i<t.length();i++){const a=t.getSection(i);o+=d_(t.getCodePoint(i),a,n,s,e,r)}return o/Math.max(1,Math.ceil(o/i))}(t,e,i,n,s,r),h=t.text.indexOf("")>=0;let c=0;for(let i=0;i<t.length();i++){const l=t.getSection(i),f=t.getCodePoint(i);if(l_[f]||(c+=d_(f,l,n,s,e,r)),i<t.length()-1){const e=!((u=f)<11904||!(Ia["Bopomofo Extended"](u)||Ia.Bopomofo(u)||Ia["CJK Compatibility Forms"](u)||Ia["CJK Compatibility Ideographs"](u)||Ia["CJK Compatibility"](u)||Ia["CJK Radicals Supplement"](u)||Ia["CJK Strokes"](u)||Ia["CJK Symbols and Punctuation"](u)||Ia["CJK Unified Ideographs Extension A"](u)||Ia["CJK Unified Ideographs"](u)||Ia["Enclosed CJK Letters and Months"](u)||Ia["Halfwidth and Fullwidth Forms"](u)||Ia.Hiragana(u)||Ia["Ideographic Description Characters"](u)||Ia["Kangxi Radicals"](u)||Ia["Katakana Phonetic Extensions"](u)||Ia.Katakana(u)||Ia["Vertical Forms"](u)||Ia["Yi Radicals"](u)||Ia["Yi Syllables"](u)));(f_[f]||e||l.imageName)&&o.push(__(i+1,c,a,o,m_(f,t.getCodePoint(i+1),e&&h),!1))}}var u;return v_(__(t.length(),c,a,o,0,!0))}(m,c,r,e,n,d),{processBidirectionalText:g,processStyledBidirectionalText:b}=Za;if(g&&1===m.sections.length){const t=g(m.toString(),v);for(const e of t){const t=new c_;t.text=e,t.sections=m.sections;for(let i=0;i<e.length;i++)t.sectionIndex.push(0);_.push(t)}}else if(b){const t=b(m.text,m.sectionIndex,v);for(const e of t){const t=new c_;t.text=e[0],t.sectionIndex=e[1],t.sections=m.sections,_.push(t)}}else _=function(t,e){const i=[],n=t.text;let s=0;for(const n of e)i.push(t.substring(s,n)),s=n;return s<n.length&&i.push(t.substring(s,n.length)),i}(m,v);const w=[],y={positionedLines:w,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:l,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,i,n,s,r,o,a,h,c,u,l){let f=0,d=0,p=0;const m="right"===a?1:"left"===a?0:.5;let _=!1;for(const t of s){const i=t.getSections();for(const t of i){if(t.imageName)continue;const i=e[t.fontStack];if(i&&(_=void 0!==i.ascender&&void 0!==i.descender,!_))break}if(!_)break}let v=0;for(const o of s){o.trim();const s=o.getMaxScale(),a=(s-1)*Wm,b={positionedGlyphs:[],lineOffset:0};t.positionedLines[v]=b;const w=b.positionedGlyphs;let y=0;if(!o.length()){d+=r,++v;continue}let x=0,M=0;for(let r=0;r<o.length();r++){const a=o.getSection(r),p=o.getSectionIndex(r),m=o.getCodePoint(r);let v=a.scale,b=null,T=null,O=null,E=Wm,A=0;const S=!(h===a_.horizontal||!u&&!Ra(m)||u&&(l_[m]||(g=m,Ia.Arabic(g)||Ia["Arabic Supplement"](g)||Ia["Arabic Extended-A"](g)||Ia["Arabic Presentation Forms-A"](g)||Ia["Arabic Presentation Forms-B"](g))));if(a.imageName){const e=n[a.imageName];if(!e)continue;O=a.imageName,t.iconsInText=t.iconsInText||!0,T=e.paddedRect;const i=e.displaySize;v=v*Wm/l,b={width:i[0],height:i[1],left:0,top:-o_,advance:S?i[1]:i[0],localGlyph:!1},A=_?-b.height*v:s*Wm-17-i[1]*v,E=b.advance;const r=(S?i[0]:i[1])*v-Wm*s;r>0&&r>y&&(y=r)}else{const t=i[a.fontStack];if(!t)continue;t[m]&&(T=t[m]);const n=e[a.fontStack];if(!n)continue;const r=n.glyphs[m];if(!r)continue;if(b=r.metrics,E=8203!==m?Wm:0,_){const t=void 0!==n.ascender?Math.abs(n.ascender):0,e=void 0!==n.descender?Math.abs(n.descender):0,i=(t+e)*v;x<i&&(x=i,M=(t-e)/2*v),A=-t*v}else A=(s-v)*Wm-17}S?(t.verticalizable=!0,w.push({glyph:m,imageName:O,x:f,y:d+A,vertical:S,scale:v,localGlyph:b.localGlyph,fontStack:a.fontStack,sectionIndex:p,metrics:b,rect:T}),f+=E*v+c):(w.push({glyph:m,imageName:O,x:f,y:d+A,vertical:S,scale:v,localGlyph:b.localGlyph,fontStack:a.fontStack,sectionIndex:p,metrics:b,rect:T}),f+=b.advance*v+c)}0!==w.length&&(p=Math.max(f-c,p),_?b_(w,m,y,M,r*s/2):b_(w,m,y,0,r/2)),f=0;const T=r*s+y;b.lineOffset=Math.max(y,a),d+=T,++v}var g;const b=d,{horizontalAlign:w,verticalAlign:y}=g_(o);(function(t,e,i,n,s,r){const o=(e-i)*s,a=-r*n;for(const e of t)for(const t of e.positionedGlyphs)t.x+=o,t.y+=a})(t.positionedLines,m,w,y,p,b),t.top+=-y*b,t.bottom=t.top+b,t.left+=-w*p,t.right=t.left+p,t.hasBaseline=_}(y,e,i,n,_,o,a,h,l,c,f,p),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(w)&&y}const l_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},f_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function d_(t,e,i,n,s,r){if(e.imageName){const t=n[e.imageName];return t?t.displaySize[0]*e.scale*Wm/r+s:0}{const n=i[e.fontStack],r=n&&n.glyphs[t];return r?r.metrics.advance*e.scale+s:0}}function p_(t,e,i,n){const s=Math.pow(t-e,2);return n?t<e?s/2:2*s:s+Math.abs(i)*i}function m_(t,e,i){let n=0;return 10===t&&(n-=1e4),i&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function __(t,e,i,n,s,r){let o=null,a=p_(e,i,s,r);for(const t of n){const n=p_(e-t.x,i,s,r)+t.badness;n<=a&&(o=t,a=n)}return{index:t,x:e,priorBreak:o,badness:a}}function v_(t){return t?v_(t.priorBreak).concat(t.index):[]}function g_(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function b_(t,e,i,n,s){if(!(e||i||n||s))return;const r=t.length-1,o=t[r],a=(o.x+o.metrics.advance*o.scale)*e;for(let e=0;e<=r;e++)t[e].x-=a,t[e].y+=i+n+s}function w_(t,e,i,n){const{horizontalAlign:s,verticalAlign:r}=g_(n),o=i[0]-t.displaySize[0]*s,a=i[1]-t.displaySize[1]*r;return{imagePrimary:t,imageSecondary:e,top:a,bottom:a+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function y_(t,e,i,n,s,r){const o=t.imagePrimary;let a;if(o.content){const t=o.content,e=o.pixelRatio||1;a=[t[0]/e,t[1]/e,o.displaySize[0]-t[2]/e,o.displaySize[1]-t[3]/e]}const h=e.left*r,c=e.right*r;let u,l,f,d;"width"===i||"both"===i?(d=s[0]+h-n[3],l=s[0]+c+n[1]):(d=s[0]+(h+c-o.displaySize[0])/2,l=d+o.displaySize[0]);const p=e.top*r,m=e.bottom*r;return"height"===i||"both"===i?(u=s[1]+p-n[0],f=s[1]+m+n[2]):(u=s[1]+(p+m-o.displaySize[1])/2,f=u+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:u,right:l,bottom:f,left:d,collisionPadding:a}}class x_ extends Ue{constructor(t,e,i,n,s){super(t,e),this.angle=n,this.z=i,void 0!==s&&(this.segment=s)}clone(){return new x_(this.x,this.y,this.z,this.angle,this.segment)}}function M_(t,e,i,n,s){if(void 0===e.segment)return!0;let r=e,o=e.segment+1,a=0;for(;a>-i/2;){if(o--,o<0)return!1;a-=t[o].dist(r),r=t[o]}a+=t[o].dist(t[o+1]),o++;const h=[];let c=0;for(;a<i/2;){const e=t[o],i=t[o+1];if(!i)return!1;let r=t[o-1].angleTo(e)-e.angleTo(i);for(r=Math.abs((r+3*Math.PI)%(2*Math.PI)-Math.PI),h.push({distance:a,angleDelta:r}),c+=r;a-h[0].distance>n;)c-=h.shift().angleDelta;if(c>s)return!1;o++,a+=e.dist(i)}return!0}function T_(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function O_(t,e,i){return t?.6*e*i:0}function E_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function A_(t,e,i,n,s,r){const o=O_(i,s,r),a=E_(i,n)*r;let h=0;const c=T_(t)/2;for(let i=0;i<t.length-1;i++){const n=t[i],s=t[i+1],r=n.dist(s);if(h+r>c){const u=(c-h)/r,l=qn(n.x,s.x,u),f=qn(n.y,s.y,u),d=new x_(l,f,0,s.angleTo(n),i);return!o||M_(t,d,a,o,e)?d:void 0}h+=r}}function S_(t,e,i,n,s,r,o,a,h){const c=O_(n,r,o),u=E_(n,s),l=u*o,f=0===t[0].x||t[0].x===h||0===t[0].y||t[0].y===h;return e-l<e/4&&(e=l+e/4),k_(t,f?e/2*a%e:(u/2+2*r)*o*a%e,e,c,i,l,f,!1,h)}function k_(t,e,i,n,s,r,o,a,h){const c=r/2,u=T_(t);let l=0,f=e-i,d=[];for(let e=0;e<t.length-1;e++){const o=t[e],a=t[e+1],p=o.dist(a),m=a.angleTo(o);for(;f+i<l+p;){f+=i;const _=(f-l)/p,v=qn(o.x,a.x,_),g=qn(o.y,a.y,_);if(v>=0&&v<h&&g>=0&&g<h&&f-c>=0&&f+c<=u){const i=new x_(v,g,0,m,e);n&&!M_(t,i,r,n,s)||d.push(i)}}l+=p}return a||d.length||o||(d=k_(t,l/2,i,n,s,r,o,!0,h)),d}function I_(t,e,i,n,s){const r=[];for(let o=0;o<t.length;o++){const a=t[o];let h;for(let t=0;t<a.length-1;t++){let o=a[t],c=a[t+1];o.x<e&&c.x<e||(o.x<e?o=new Ue(e,o.y+(e-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x<e&&(c=new Ue(e,o.y+(e-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y<i&&c.y<i||(o.y<i?o=new Ue(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round():c.y<i&&(c=new Ue(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round()),o.x>=n&&c.x>=n||(o.x>=n?o=new Ue(n,o.y+(n-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x>=n&&(c=new Ue(n,o.y+(n-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y>=s&&c.y>=s||(o.y>=s?o=new Ue(o.x+(s-o.y)/(c.y-o.y)*(c.x-o.x),s)._round():c.y>=s&&(c=new Ue(o.x+(s-o.y)/(c.y-o.y)*(c.x-o.x),s)._round()),h&&o.equals(h[h.length-1])||(h=[o],r.push(h)),h.push(c)))))}}return r}function C_(t){let e=0,i=0;for(const n of t)e+=n.w*n.h,i=Math.max(i,n.w);t.sort(((t,e)=>e.h-t.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let s=0,r=0;for(const e of t)for(let t=n.length-1;t>=0;t--){const i=n[t];if(!(e.w>i.w||e.h>i.h)){if(e.x=i.x,e.y=i.y,r=Math.max(r,e.y+e.h),s=Math.max(s,e.x+e.w),e.w===i.w&&e.h===i.h){const e=n.pop();t<n.length&&(n[t]=e)}else e.h===i.h?(i.x+=e.w,i.w-=e.w):e.w===i.w?(i.y+=e.h,i.h-=e.h):(n.push({x:i.x+e.w,y:i.y,w:i.w-e.w,h:e.h}),i.y+=e.h,i.h-=e.h);break}}return{w:s,h:r,fill:e/(s*r)||0}}Oa(x_,"Anchor");const j_=1;class D_{constructor(t,{pixelRatio:e,version:i,stretchX:n,stretchY:s,content:r}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=n,this.stretchY=s,this.content=r,this.version=i}get tl(){return[this.paddedRect.x+j_,this.paddedRect.y+j_]}get br(){return[this.paddedRect.x+this.paddedRect.w-j_,this.paddedRect.y+this.paddedRect.h-j_]}get displaySize(){return[(this.paddedRect.w-2*j_)/this.pixelRatio,(this.paddedRect.h-2*j_)/this.pixelRatio]}}class R_{constructor(t,e,i){const n={},s={};this.haveRenderCallbacks=[];const r=[];this.addImages(t,n,r),this.addImages(e,s,r);const{w:o,h:a}=C_(r),h=new gf({width:o||1,height:a||1});for(const e in t){const s=t[e],r=n[e].paddedRect;gf.copy(s.data,h,{x:0,y:0},{x:r.x+j_,y:r.y+j_},s.data,i,s.sdf)}for(const t in e){const n=e[t],r=s[t].paddedRect,o=r.x+j_,a=r.y+j_,c=n.data.width,u=n.data.height;gf.copy(n.data,h,{x:0,y:0},{x:o,y:a},n.data,i),gf.copy(n.data,h,{x:0,y:u-1},{x:o,y:a-1},{width:c,height:1},i),gf.copy(n.data,h,{x:0,y:0},{x:o,y:a+u},{width:c,height:1},i),gf.copy(n.data,h,{x:c-1,y:0},{x:o-1,y:a},{width:1,height:u},i),gf.copy(n.data,h,{x:0,y:0},{x:o+c,y:a},{width:1,height:u},i)}this.image=h,this.iconPositions=n,this.patternPositions=s}addImages(t,e,i){for(const n in t){const s=t[n],r={x:0,y:0,w:s.data.width+2*j_,h:s.data.height+2*j_};i.push(r),e[n]=new D_(r,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}patchUpdatedImages(t,e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((e=>t.hasImage(e,i))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const n in t.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[n],t.getImage(n,i),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n,i),e)}patchUpdatedImage(t,e,i){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[n,s]=t.tl,r=!!Object.keys(this.patternPositions).length;i.update(e.data,{useMipmap:r},{x:n,y:s})}}Oa(D_,"ImagePosition"),Oa(R_,"ImageAtlas");const P_=1e20;function N_(t,e,i,n,s,r,o,a,h){for(let c=e;c<e+n;c++)F_(t,i*r+c,r,s,o,a,h);for(let c=i;c<i+s;c++)F_(t,c*r+e,1,n,o,a,h)}function F_(t,e,i,n,s,r,o){r[0]=0,o[0]=-P_,o[1]=P_,s[0]=t[e];for(let a=1,h=0,c=0;a<n;a++){s[a]=t[e+a*i];const n=a*a;do{const t=r[h];c=(s[a]-s[t]+n-t*t)/(a-t)/2}while(c<=o[h]&&--h>-1);h++,r[h]=a,o[h]=c,o[h+1]=P_}for(let a=0,h=0;a<n;a++){for(;o[h+1]<a;)h++;const n=r[h],c=a-n;t[e+a*i]=s[n]+c*c}}const z_=2,L_={none:0,ideographs:1,all:2};class $_{constructor(t,e,i){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,e){this.urls[e]=t}getGlyphs(t,e,i){const s=[],r=this.urls[e]||n.GLYPHS_URL;for(const e in t)for(const i of t[e])s.push({stack:e,id:i});ti(s,(({stack:t,id:e},i)=>{let n=this.entries[t];n||(n=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let s=n.glyphs[e];if(void 0!==s)return void i(null,{stack:t,id:e,glyph:s});if(s=this._tinySDF(n,t,e),s)return n.glyphs[e]=s,void i(null,{stack:t,id:e,glyph:s});const o=Math.floor(e/256);if(256*o>65535)return void i(new Error("glyphs > 65535 not supported"));if(n.ranges[o])return void i(null,{stack:t,id:e,glyph:s});let a=n.requests[o];a||(a=n.requests[o]=[],$_.loadGlyphRange(t,o,r,this.requestManager,((t,e)=>{if(e){n.ascender=e.ascender,n.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(n.glyphs[+t]=e.glyphs[+t]);n.ranges[o]=!0}for(const i of a)i(t,e);delete n.requests[o]}))),a.push(((n,s)=>{n?i(n):s&&i(null,{stack:t,id:e,glyph:s.glyphs[e]||null})}))}),((t,e)=>{if(t)i(t);else if(e){const t={};for(const{stack:i,id:n,glyph:s}of e)void 0===t[i]&&(t[i]={}),void 0===t[i].glyphs&&(t[i].glyphs={}),t[i].glyphs[n]=s&&{id:s.id,bitmap:s.bitmap.clone(),metrics:s.metrics},t[i].ascender=this.entries[i].ascender,t[i].descender=this.entries[i].descender;i(null,t)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==L_.none&&(this.localGlyphMode===L_.all?!!this.localFontFamily:!!this.localFontFamily&&(Ia["CJK Unified Ideographs"](t)||Ia["Hangul Syllables"](t)||Ia.Hiragana(t)||Ia.Katakana(t)||Ia["CJK Symbols and Punctuation"](t)||Ia["CJK Unified Ideographs Extension A"](t)||Ia["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,e,i){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(i))return;let s=t.tinySDF;if(!s){let i="400";/bold/i.test(e)?i="900":/medium/i.test(e)?i="500":/light/i.test(e)&&(i="200"),s=t.tinySDF=new $_.TinySDF({fontFamily:n,fontWeight:i,fontSize:24*z_,buffer:3*z_,radius:8*z_}),s.fontWeight=i}if(this.localGlyphs[s.fontWeight][i])return this.localGlyphs[s.fontWeight][i];const r=String.fromCodePoint(i),{data:o,width:a,height:h,glyphWidth:c,glyphHeight:u,glyphLeft:l,glyphTop:f,glyphAdvance:d}=s.draw(r);return this.localGlyphs[s.fontWeight][i]={id:i,bitmap:new vf({width:a,height:h},o),metrics:{width:c/z_,height:u/z_,left:l/z_,top:f/z_-27,advance:d/z_,localGlyph:!0}}}}$_.loadGlyphRange=function(t,e,i,n,s){const r=256*e,o=r+255,a=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${r}-${o}`),Qi.Glyphs);sn(a,((t,e)=>{if(t)s(t);else if(e){const t={},i=function(t){return new Lm(t).readFields(n_,{})}(e);for(const e of i.glyphs)t[e.id]=e;s(null,{glyphs:t,ascender:i.ascender,descender:i.descender})}}))},$_.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:r="normal",fontStyle:o="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const a=this.size=t+4*e,h=this._createCanvas(a),c=this.ctx=h.getContext("2d",{willReadFrequently:!0});c.font=`${o} ${r} ${t}px ${s}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:r}=this.ctx.measureText(t),o=Math.ceil(i),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(r-s))),h=Math.min(this.size-this.buffer,o+Math.ceil(n)),c=a+2*this.buffer,u=h+2*this.buffer,l=Math.max(c*u,0),f=new Uint8ClampedArray(l),d={data:f,width:c,height:u,glyphWidth:a,glyphHeight:h,glyphTop:o,glyphLeft:0,glyphAdvance:e};if(0===a||0===h)return d;const{ctx:p,buffer:m,gridInner:_,gridOuter:v}=this;p.clearRect(m,m,a,h),p.fillText(t,m,m+o);const g=p.getImageData(m,m,a,h);v.fill(P_,0,l),_.fill(0,0,l);for(let t=0;t<h;t++)for(let e=0;e<a;e++){const i=g.data[4*(t*a+e)+3]/255;if(0===i)continue;const n=(t+m)*c+e+m;if(1===i)v[n]=0,_[n]=P_;else{const t=.5-i;v[n]=t>0?t*t:0,_[n]=t<0?t*t:0}}N_(v,0,0,c,u,c,this.f,this.v,this.z),N_(_,m,m,a,h,c,this.f,this.v,this.z);for(let t=0;t<l;t++){const e=Math.sqrt(v[t])-Math.sqrt(_[t]);f[t]=Math.round(255-255*(e/this.radius+this.cutoff))}return d}};const U_=j_;function B_(t,e,i,n){const s=[],r=t.imagePrimary,o=r.pixelRatio,a=r.paddedRect.w-2*U_,h=r.paddedRect.h-2*U_,c=t.right-t.left,u=t.bottom-t.top,l=r.stretchX||[[0,a]],f=r.stretchY||[[0,h]],d=(t,e)=>t+e[1]-e[0],p=l.reduce(d,0),m=f.reduce(d,0),_=a-p,v=h-m;let g=0,b=p,w=0,y=m,x=0,M=_,T=0,O=v;if(r.content&&n){const t=r.content;g=G_(l,0,t[0]),w=G_(f,0,t[1]),b=G_(l,t[0],t[2]),y=G_(f,t[1],t[3]),x=t[0]-g,T=t[1]-w,M=t[2]-t[0]-b,O=t[3]-t[1]-y}const E=(n,s,a,h)=>{const l=V_(n.stretch-g,b,c,t.left),f=W_(n.fixed-x,M,n.stretch,p),d=V_(s.stretch-w,y,u,t.top),_=W_(s.fixed-T,O,s.stretch,m),v=V_(a.stretch-g,b,c,t.left),E=W_(a.fixed-x,M,a.stretch,p),A=V_(h.stretch-w,y,u,t.top),S=W_(h.fixed-T,O,h.stretch,m),k=new Ue(l,d),I=new Ue(v,d),C=new Ue(v,A),j=new Ue(l,A),D=new Ue(f/o,_/o),R=new Ue(E/o,S/o),P=e*Math.PI/180;if(P){const t=Math.sin(P),e=Math.cos(P),i=[e,-t,t,e];k._matMult(i),I._matMult(i),j._matMult(i),C._matMult(i)}const N=n.stretch+n.fixed,F=a.stretch+a.fixed,z=s.stretch+s.fixed,L=h.stretch+h.fixed,$=t.imageSecondary;return{tl:k,tr:I,bl:j,br:C,texPrimary:{x:r.paddedRect.x+U_+N,y:r.paddedRect.y+U_+z,w:F-N,h:L-z},texSecondary:$?{x:$.paddedRect.x+U_+N,y:$.paddedRect.y+U_+z,w:F-N,h:L-z}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:R,minFontScaleX:M/o/c,minFontScaleY:O/o/u,isSDF:i}};if(n&&(r.stretchX||r.stretchY)){const t=H_(l,_,p),e=H_(f,v,m);for(let i=0;i<t.length-1;i++){const n=t[i],r=t[i+1];for(let t=0;t<e.length-1;t++)s.push(E(n,e[t],r,e[t+1]))}}else s.push(E({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:a+1},{fixed:0,stretch:h+1}));return s}function G_(t,e,i){let n=0;for(const s of t)n+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return n}function H_(t,e,i){const n=[{fixed:-U_,stretch:0}];for(const[e,i]of t){const t=n[n.length-1];n.push({fixed:e-t.stretch,stretch:t.stretch}),n.push({fixed:e-t.stretch,stretch:t.stretch+(i-e)})}return n.push({fixed:e+U_,stretch:i}),n}function V_(t,e,i,n){return t/e*i+n}function W_(t,e,i,n){return t-e*i/n}function q_(t,e,i,n){const s=e+t.positionedLines[n].lineOffset;return 0===n?i+s/2:i+(s+(e+t.positionedLines[n-1].lineOffset))/2}function Y_(t,e=1,i=!1){let n=1/0,s=1/0,r=-1/0,o=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const e=a[t];(!t||e.x<n)&&(n=e.x),(!t||e.y<s)&&(s=e.y),(!t||e.x>r)&&(r=e.x),(!t||e.y>o)&&(o=e.y)}const h=Math.min(r-n,o-s);let c=h/2;const u=new dr([],X_);if(0===h)return new Ue(n,s);for(let e=n;e<r;e+=h)for(let i=s;i<o;i+=h)u.push(new Z_(e+c,i+c,c,t));let l=function(t){let e=0,i=0,n=0;const s=t[0];for(let t=0,r=s.length,o=r-1;t<r;o=t++){const r=s[t],a=s[o],h=r.x*a.y-a.x*r.y;i+=(r.x+a.x)*h,n+=(r.y+a.y)*h,e+=3*h}return new Z_(i/e,n/e,0,t)}(t),f=u.length;for(;u.length;){const n=u.pop();(n.d>l.d||!l.d)&&(l=n,i&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,f)),n.max-l.d<=e||(c=n.h/2,u.push(new Z_(n.p.x-c,n.p.y-c,c,t)),u.push(new Z_(n.p.x+c,n.p.y-c,c,t)),u.push(new Z_(n.p.x-c,n.p.y+c,c,t)),u.push(new Z_(n.p.x+c,n.p.y+c,c,t)),f+=4)}return i&&(console.log(`num probes: ${f}`),console.log(`best distance: ${l.d}`)),l.p}function X_(t,e){return e.max-t.max}class Z_{constructor(t,e,i,n){this.p=new Ue(t,e),this.h=i,this.d=function(t,e){let i=!1,n=1/0;for(let s=0;s<e.length;s++){const r=e[s];for(let e=0,s=r.length,o=s-1;e<s;o=e++){const s=r[e],a=r[o];s.y>t.y!=a.y>t.y&&t.x<(a.x-s.x)*(t.y-s.y)/(a.y-s.y)+s.x&&(i=!i),n=Math.min(n,hl(t,s,a))}}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const J_=Number.POSITIVE_INFINITY,K_=Math.sqrt(2);function Q_(t,[e,i]){let n=0,s=0;if(i===J_){e<0&&(e=0);const i=e/K_;switch(t){case"top-right":case"top-left":s=i-7;break;case"bottom-right":case"bottom-left":s=7-i;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":s=i-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,s]}function tv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ev(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p){let m=r.textMaxSize.evaluate(e,{},l);void 0===m&&(m=o);const _=t.layers[0].layout,v=_.get("icon-offset").evaluate(e,{},l),g=rv(i.horizontal)||i.vertical,b="globe"===f.name,w=Wm,y=o/w,x=t.tilePixelRatio*m/w,M=(C=t.overscaling,t.zoom>18&&C>2&&(C>>=1),Math.max(pr/(512*C),1)*_.get("symbol-spacing")),T=_.get("text-padding")*t.tilePixelRatio,O=_.get("icon-padding")*t.tilePixelRatio,E=Ve(_.get("text-max-angle")),A="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement"),S="map"===_.get("icon-rotation-alignment")&&"point"!==_.get("symbol-placement"),k=_.get("symbol-placement"),I=M/2;var C;const j=_.get("icon-text-fit").evaluate(e,{},l),D=_.get("icon-text-fit-padding").evaluate(e,{},l),R="none"!==j;let P;!1===t.hasAnyIconTextFit&&R&&(t.hasAnyIconTextFit=!0),n&&R&&(t.allowVerticalPlacement&&i.vertical&&(P=y_(n,i.vertical,j,D,v,y)),g&&(n=y_(n,g,j,D,v,y)));const N=(o,a,m)=>{if(a.x<0||a.x>=pr||a.y<0||a.y>=pr)return;let _=null;if(b){const{x:t,y:e,z:i}=f.projectTilePoint(a.x,a.y,m);_={anchor:new x_(t,e,i,0,void 0),up:f.upVector(m,a.x,a.y)}}!function(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y,x,M,T,O,E){const A=t.addToLineVertexArray(e,n);let S,k,I,C,j,D,R,P=0,N=0,F=0,z=0,L=-1,$=-1;const U={};let B=Rn("");const G=i?i.anchor:e,H="none"!==h.layout.get("icon-text-fit").evaluate(w,{},T);let V=0,W=0;if(void 0===h._unevaluatedLayout.getValue("text-radial-offset")?[V,W]=h.layout.get("text-offset").evaluate(w,{},T).map((t=>t*Wm)):(V=h.layout.get("text-radial-offset").evaluate(w,{},T)*Wm,W=J_),t.allowVerticalPlacement&&s.vertical){const t=s.vertical;if(p)D=av(t),a&&(R=av(a));else{const i=h.layout.get("text-rotate").evaluate(w,{},T)+90;I=ov(c,G,e,u,l,f,t,d,i,m),a&&(C=ov(c,G,e,u,l,f,a,v,i))}}if(r){const n=h.layout.get("icon-rotate").evaluate(w,{},T),s=B_(r,n,x,H),o=a?B_(a,n,x,H):void 0;k=ov(c,G,e,u,l,f,r,v,n),P=4*s.length;const d=t.iconSizeData;let p=null;"source"===d.kind?(p=[qm*h.layout.get("icon-size").evaluate(w,{},T)],p[0]>nv&&pi(`${t.layerIds[0]}: Value for "icon-size" is >= ${iv}. Reduce your "icon-size".`)):"composite"===d.kind&&(p=[qm*y.compositeIconSizes[0].evaluate(w,{},T),qm*y.compositeIconSizes[1].evaluate(w,{},T)],(p[0]>nv||p[1]>nv)&&pi(`${t.layerIds[0]}: Value for "icon-size" is >= ${iv}. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,p,b,g,w,!1,i,e,A.lineStartIndex,A.lineLength,-1,M,T,O,E),L=t.icon.placedSymbolArray.length-1,o&&(N=4*o.length,t.addSymbols(t.icon,o,p,b,g,w,a_.vertical,i,e,A.lineStartIndex,A.lineLength,-1,M,T,O,E),$=t.icon.placedSymbolArray.length-1)}for(const n in s.horizontal){const r=s.horizontal[n];S||(B=Rn(r.text),p?j=av(r):S=ov(c,G,e,u,l,f,r,d,h.layout.get("text-rotate").evaluate(w,{},T),m));const a=1===r.positionedLines.length;if(F+=sv(t,i,e,r,o,h,p,w,m,A,s.vertical?a_.horizontal:a_.horizontalOnly,a?Object.keys(s.horizontal):[n],U,L,y,M,T,O),a)break}s.vertical&&(z+=sv(t,i,e,s.vertical,o,h,p,w,m,A,a_.vertical,["vertical"],U,$,y,M,T,O));let q=-1;const Y=(t,e)=>t?Math.max(t,e):e;q=Y(j,q),q=Y(D,q),q=Y(R,q);const X=q>-1?1:0;t.glyphOffsetArray.length>=65535&&pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==w.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,w.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,G.x,G.y,G.z,U.right>=0?U.right:-1,U.center>=0?U.center:-1,U.left>=0?U.left:-1,U.vertical>=0?U.vertical:-1,L,$,B,void 0!==S?S:t.collisionBoxArray.length,void 0!==S?S+1:t.collisionBoxArray.length,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,void 0!==k?k:t.collisionBoxArray.length,void 0!==k?k+1:t.collisionBoxArray.length,C||t.collisionBoxArray.length,C?C+1:t.collisionBoxArray.length,u,F,z,P,N,X,0,V,W,q,0,H?1:0)}(t,a,_,o,i,n,s,P,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,T,A,h,0,O,S,v,e,r,c,u,l,d,p)};if("line"===k)for(const s of I_(e.geometry,0,0,pr,pr)){const e=S_(s,M,E,i.vertical||g,n,w,x,t.overscaling,pr);for(const i of e)g&&hv(t,g.text,I,i)||N(s,i,l)}else if("line-center"===k){for(const t of e.geometry)if(t.length>1){const e=A_(t,E,i.vertical||g,n,w,x);e&&N(t,e,l)}}else if("Polygon"===e.type)for(const t of Kf(e.geometry,0)){const e=Y_(t,16);N(t[0],new x_(e.x,e.y,0,0,void 0),l)}else if("LineString"===e.type)for(const t of e.geometry)N(t,new x_(t[0].x,t[0].y,0,0,void 0),l);else if("Point"===e.type)for(const t of e.geometry)for(const e of t)N([e],new x_(e.x,e.y,0,0,void 0),l)}const iv=255,nv=iv*qm;function sv(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v){const g=function(t,e,i,n,s,r,o,a){const h=[];if(0===e.positionedLines.length)return h;const c=n.layout.get("text-rotate").evaluate(r,{})*Math.PI/180,u=function(t){const e=t[0],i=t[1],n=e*i;return n>0?[e,-i]:n<0?[-e,i]:0===e?[i,e]:[i,-e]}(i);let l=Math.abs(e.top-e.bottom);for(const t of e.positionedLines)l-=t.lineOffset;const f=e.positionedLines.length,d=l/f;let p=e.top-i[1];for(let t=0;t<f;++t){const n=e.positionedLines[t];p=q_(e,d,p,t);for(const t of n.positionedGlyphs){if(!t.rect)continue;const n=t.rect||{};let r=o_+1,l=!0,f=1,d=0;if(t.imageName){const e=o[t.imageName];if(!e)continue;if(e.sdf){pi("SDF images are not supported in formatted text and will be ignored.");continue}l=!1,f=e.pixelRatio,r=j_/f}const m=(s||a)&&t.vertical,_=t.metrics.advance*t.scale/2,v=t.metrics,g=t.rect;if(null===g)continue;a&&e.verticalizable&&(d=t.imageName?_-t.metrics.width*t.scale/2:0);const b=s?[t.x+_,t.y]:[0,0];let w=[0,0],y=[0,0],x=!1;s||(m?(y=[t.x+_+u[0],t.y+u[1]-d],x=!0):w=[t.x+_+i[0],t.y+i[1]-d]);const M=g.w*t.scale/(f*(t.localGlyph?z_:1)),T=g.h*t.scale/(f*(t.localGlyph?z_:1));let O,E,A,S;if(m){const e=t.y-p,i=new Ue(-_,_-e),n=-Math.PI/2,s=new Ue(...y);O=new Ue(-_+w[0],w[1]),O._rotateAround(n,i)._add(s),O.x+=-e+_,O.y-=(v.left-r)*t.scale;const o=t.imageName?v.advance*t.scale:Wm*t.scale,a=String.fromCodePoint(t.glyph);t_(a)?O.x+=(1-r)*t.scale:e_(a)?O.x+=o-v.height*t.scale+(-r-1)*t.scale:O.x+=t.imageName||v.width+2*r===g.w&&v.height+2*r===g.h?(o-T)/2:(o-(v.height+2*r)*t.scale)/2,E=new Ue(O.x,O.y-M),A=new Ue(O.x+T,O.y),S=new Ue(O.x+T,O.y-M)}else{const e=(v.left-r)*t.scale-_+w[0],i=(-v.top-r)*t.scale+w[1],n=e+M,s=i+T;O=new Ue(e,i),E=new Ue(n,i),A=new Ue(e,s),S=new Ue(n,s)}if(c){let t;t=s?new Ue(0,0):x?new Ue(u[0],u[1]):new Ue(i[0],i[1]),O._rotateAround(c,t),E._rotateAround(c,t),A._rotateAround(c,t),S._rotateAround(c,t)}const k=new Ue(0,0),I=new Ue(0,0);h.push({tl:O,tr:E,bl:A,br:S,texPrimary:n,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:b,sectionIndex:t.sectionIndex,isSDF:l,pixelOffsetTL:k,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}}return h}(0,n,h,r,o,a,s,t.allowVerticalPlacement),b=t.textSizeData;let w=null;"source"===b.kind?(w=[qm*r.layout.get("text-size").evaluate(a,{},_)],w[0]>nv&&pi(`${t.layerIds[0]}: Value for "text-size" is >= ${iv}. Reduce your "text-size".`)):"composite"===b.kind&&(w=[qm*p.compositeTextSizes[0].evaluate(a,{},_),qm*p.compositeTextSizes[1].evaluate(a,{},_)],(w[0]>nv||w[1]>nv)&&pi(`${t.layerIds[0]}: Value for "text-size" is >= ${iv}. Reduce your "text-size".`)),t.addSymbols(t.text,g,w,h,o,a,u,e,i,c.lineStartIndex,c.lineLength,d,m,_,v,!1);for(const e of l)f[e]=t.text.placedSymbolArray.length-1;return 4*g.length}function rv(t){for(const e in t)return t[e];return null}function ov(t,e,i,n,s,r,o,a,h,c){let u=o.top,l=o.bottom,f=o.left,d=o.right;const p=o.collisionPadding;if(p&&(f-=p[0],u-=p[1],d+=p[2],l+=p[3]),h){const t=new Ue(f,u),e=new Ue(d,u),i=new Ue(f,l),n=new Ue(d,l),s=Ve(h);let r=new Ue(0,0);c&&(r=new Ue(c[0],c[1])),t._rotateAround(s,r),e._rotateAround(s,r),i._rotateAround(s,r),n._rotateAround(s,r),f=Math.min(t.x,e.x,i.x,n.x),d=Math.max(t.x,e.x,i.x,n.x),u=Math.min(t.y,e.y,i.y,n.y),l=Math.max(t.y,e.y,i.y,n.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,f,u,d,l,a,n,s,r),t.length-1}function av(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function hv(t,e,i,n){const s=t.compareText;if(e in s){const t=s[e];for(let e=t.length-1;e>=0;e--)if(n.dist(t[e])<i)return!0}else s[e]=[];return s[e].push(n),!1}function cv(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),r=Math.sin(i)*s/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),o=Math.sin(t._pitch)*r+s;return Math.min(1.01*o,s*(1/t._horizonShift))}function uv(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,s=(t.x+1)*i,r=t.y*i,o=(t.y+1)*i,a=Ru(n),h=Ru(s),c=Pu(r),u=Pu(o),l=e.project(a,c),f=e.project(h,c),d=e.project(h,u),p=e.project(a,u);let m=Math.min(l.x,f.x,d.x,p.x),_=Math.min(l.y,f.y,d.y,p.y),v=Math.max(l.x,f.x,d.x,p.x),g=Math.max(l.y,f.y,d.y,p.y);const b=i/16;function w(t,i,n,s,r,o){const a=(n+r)/2,h=(s+o)/2,c=e.project(Ru(a),Pu(h)),u=Math.max(0,m-c.x,_-c.y,c.x-v,c.y-g);m=Math.min(m,c.x),v=Math.max(v,c.x),_=Math.min(_,c.y),g=Math.max(g,c.y),u>b&&(w(t,c,n,s,a,h),w(c,i,a,h,r,o))}w(l,f,n,r,s,r),w(f,d,s,r,s,o),w(d,p,s,o,n,o),w(p,l,n,o,n,r),m-=b,_-=b,v+=b,g+=b;const y=1/Math.max(v-m,g-_);return{scale:y,x:m*y,y:_*y,x2:v*y,y2:g*y,projection:e}}function lv(t,{x:e,y:i},n=0){return new Ue(((e-n)*t.scale-t.x)*pr,(i*t.scale-t.y)*pr)}const fv=t.ae.identity(new Float32Array(16));class dv{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new bu(0,0)}projectTilePoint(t,e,i){return{x:t,y:e,z:0}}locationPoint(t,e,i=!0){return t._coordinatePoint(t.locationCoordinate(e),i)}pixelsPerMeter(t,e){return Du(1,t)*e}pixelSpaceConversion(t,e,i){return 1}farthestPixelDistance(t){return cv(t,t.pixelsPerMeter)}pointCoordinate(t,e,i,n){const s=t.horizonLineFromTop(!1),r=new Ue(e,Math.max(s,i));return t.rayIntersectionCoordinate(t.pointRayIntersection(r,n))}pointCoordinate3D(t,e,i){const n=new Ue(e,i);if(t.elevation)return t.elevation.pointCoordinate(n);{const e=this.pointCoordinate(t,n.x,n.y,0);return[e.x,e.y,e.z]}}isPointAboveHorizon(t,e){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,e.x,e.y);const i=t.horizonLineFromTop();return e.y<i}createInversionMatrix(t,e){return fv}createTileMatrix(e,i,n){let s,r,o;const a=n.canonical,h=t.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=uv(a,this);s=1,r=c.x+n.wrap*c.scale,o=c.y,t.ae.scale(h,h,[s/c.scale,s/c.scale,e.pixelsPerMeter/i])}else s=i/e.zoomScale(a.z),r=(a.x+Math.pow(2,a.z)*n.wrap)*s,o=a.y*s;return t.ae.translate(h,h,[r,o,0]),t.ae.scale(h,h,[s/pr,s/pr,1]),h}upVector(t,e,i){return[0,0,1]}upVectorScale(t,e,i){return{metersToTile:1}}}class pv extends dv{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,i]=this.parallels=t.parallels||[29.5,45.5],n=Math.sin(Ve(e));this.n=(n+Math.sin(Ve(i)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:i,c:n,r0:s}=this,r=Ve(t-this.center[0]),o=Ve(e),a=Math.sqrt(n-2*i*Math.sin(o))/i;return{x:a*Math.sin(r*i),y:a*Math.cos(r*i)-s,z:0}}unproject(t,e){const{n:i,c:n,r0:s}=this,r=s+e;let o=Math.atan2(t,Math.abs(r))*Math.sign(r);r*i<0&&(o-=Math.PI*Math.sign(t)*Math.sign(r));const a=Ve(this.center[0])*i;o=Qe(o,-Math.PI-a,Math.PI-a);const h=Je(We(o/i)+this.center[0],-180,180),c=Math.asin(Je((n-(t*t+r*r)*i*i)/(2*i),-1,1)),u=Je(We(c),-Fu,Fu);return new bu(h,u)}}const mv=1.340264,_v=-.081106,vv=893e-6,gv=.003796,bv=Math.sqrt(3)/2;class wv extends dv{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const i=Math.asin(bv*Math.sin(e)),n=i*i,s=n*n*n;return{x:.5*(t*Math.cos(i)/(bv*(mv+3*_v*n+s*(7*vv+9*gv*n)))/Math.PI+.5),y:1-.5*(i*(mv+_v*n+s*(vv+gv*n))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=i*i,s=n*n*n;for(let t,r,o,a=0;a<12&&(r=i*(mv+_v*n+s*(vv+gv*n))-e,o=mv+3*_v*n+s*(7*vv+9*gv*n),t=r/o,i=Je(i-t,-Math.PI/3,Math.PI/3),n=i*i,s=n*n*n,!(Math.abs(t)<1e-12));++a);const r=bv*t*(mv+3*_v*n+s*(7*vv+9*gv*n))/Math.cos(i),o=Math.asin(Math.sin(i)/bv),a=Je(180*r/Math.PI,-180,180),h=Je(180*o/Math.PI,-Fu,Fu);return new bu(a,h)}}class yv extends dv{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const i=360*(t-.5),n=Je(360*(.5-e),-Fu,Fu);return new bu(i,n)}}const xv=Math.PI/2;function Mv(t){return Math.tan((xv+t)/2)}class Tv extends dv{constructor(t){super(t),this.center=t.center||[0,30];const[e,i]=this.parallels=t.parallels||[30,30];let n=Ve(e),s=Ve(i);this.southernCenter=n+s<0,this.southernCenter&&(n=-n,s=-s);const r=Math.cos(n),o=Mv(n);this.n=n===s?Math.sin(n):Math.log(r/Math.cos(s))/Math.log(Mv(s)/o),this.f=r*Math.pow(Mv(n),this.n)/this.n}project(t,e){e=Ve(e),this.southernCenter&&(e=-e),t=Ve(t-this.center[0]);const i=1e-6,{n,f:s}=this;s>0?e<-xv+i&&(e=-xv+i):e>xv-i&&(e=xv-i);const r=s/Math.pow(Mv(e),n);let o=r*Math.sin(n*t),a=s-r*Math.cos(n*t);return o=.5*(o/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:o,y:this.southernCenter?a:1-a,z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,this.southernCenter&&(e=1-e),e=(2*(1-e)-.5)*Math.PI;const{n:i,f:n}=this,s=n-e,r=Math.sign(s),o=Math.sign(i)*Math.sqrt(t*t+s*s);let a=Math.atan2(t,Math.abs(s))*r;s*i<0&&(a-=Math.PI*Math.sign(t)*r);const h=Je(We(a/i)+this.center[0],-180,180),c=Je(We(2*Math.atan(Math.pow(n/o,1/i))-xv),-Fu,Fu);return new bu(h,this.southernCenter?-c:c)}}class Ov extends dv{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:Cu(t),y:ju(e),z:0}}unproject(t,e){const i=Ru(t),n=Pu(e);return new bu(i,n)}}const Ev=Ve(Fu);class Av extends dv{project(t,e){const i=(e=Ve(e))*e,n=i*i;return{x:.5*((t=Ve(t))*(.8707-.131979*i+n*(n*(.003971*i-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+i*(.015085+n*(.028874*i-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let i=e=(2*(1-e)-1)*Math.PI,n=25,s=0,r=i*i;do{r=i*i;const t=r*r;s=(i*(1.007226+r*(.015085+t*(.028874*r-.044475-.005916*t)))-e)/(1.007226+r*(.045255+t*(.259866*r-.311325-.005916*11*t))),i=Je(i-s,-Ev,Ev)}while(Math.abs(s)>1e-6&&--n>0);r=i*i;const o=Je(We(t/(.8707+r*(r*(r*r*r*(.003971-.001529*r)-.013791)-.131979))),-180,180),a=We(i);return new bu(o,a)}}const Sv=Ve(Fu);class kv extends dv{project(t,e){e=Ve(e),t=Ve(t);const i=Math.cos(e),n=2/Math.PI,s=Math.acos(i*Math.cos(t/2)),r=Math.sin(s)/s,o=.5*(t*n+2*i*Math.sin(t/2)/r)||0,a=.5*(e+Math.sin(e)/r)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let i=t=(2*t-.5)*Math.PI,n=e=(2*(1-e)-1)*Math.PI,s=25;const r=1e-6;let o=0,a=0;do{const s=Math.cos(n),r=Math.sin(n),h=2*r*s,c=r*r,u=s*s,l=Math.cos(i/2),f=Math.sin(i/2),d=2*l*f,p=f*f,m=1-u*l*l,_=m?1/m:0,v=m?Math.acos(s*l)*Math.sqrt(1/m):0,g=.5*(2*v*s*f+2*i/Math.PI)-t,b=.5*(v*r+n)-e,w=.5*_*(u*p+v*s*l*c)+1/Math.PI,y=_*(d*h/4-v*r*f),x=.125*_*(h*f-v*r*u*d),M=.5*_*(c*l+v*p*s)+.5,T=y*x-M*w;o=(b*y-g*M)/T,a=(g*x-b*w)/T,i=Je(i-o,-Math.PI,Math.PI),n=Je(n-a,-Sv,Sv)}while((Math.abs(o)>r||Math.abs(a)>r)&&--s>0);return new bu(We(i),We(n))}}class Iv extends dv{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ve(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:i,cosPhi:n}=this;return{x:Ve(t)*n*i+.5,y:-Math.sin(Ve(e))/n*i+.5,z:0}}unproject(t,e){const{scale:i,cosPhi:n}=this,s=-(e-.5)/i,r=Je(We((t-.5)/i)/n,-180,180),o=Math.asin(Je(s*n,-1,1)),a=Je(We(o),-Fu,Fu);return new bu(r,a)}}class Cv extends Ov{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,n){const s=Vl(e,i,n),r=Yl(zl(n));return t.$.transformMat4(s,s,r),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,i){const n=_u(i.lat,i.lng),s=t.$.normalize([],n),r=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,o=Du(1,0)*pr*r;t.$.scaleAndAdd(n,n,s,o);const a=t.ae.identity(new Float64Array(16));return t.ae.multiply(a,e.pixelMatrix,e.globeMatrix),t.$.transformMat4(n,n,a),new Ue(n[0],n[1])}pixelsPerMeter(t,e){return Du(1,0)*e}pixelSpaceConversion(t,e,i){const n=Du(1,t)*e,s=qn(Du(1,45)*e,n,i);return this.pixelsPerMeter(t,e)/s}createTileMatrix(e,i,n){const s=Xl(zl(n.canonical));return t.ae.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,i){const{center:n}=e,s=Yl(zl(i));return t.ae.rotateY(s,s,Ve(n.lng)),t.ae.rotateX(s,s,Ve(n.lat)),t.ae.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(t,e,i,n){return Pl(t,e,i,!0)||new Bu(0,0)}pointCoordinate3D(t,e,i){const n=this.pointCoordinate(t,e,i,0);return[n.x,n.y,n.z]}isPointAboveHorizon(t,e){return!Pl(t,e.x,e.y,!1)}farthestPixelDistance(e){const i=function(e,i){const n=e.cameraToCenterDistance,s=e._centerAltitude*i,r=e._camera,o=e._camera.forward(),a=t.$.add([],t.$.scale([],o,-n),[0,0,s]),h=e.worldSize/(2*Math.PI),c=[0,0,-h],u=e.width/e.height,l=Math.tan(e.fovAboveCenter),f=t.$.scale([],r.up(),l),d=t.$.scale([],r.right(),l*u),p=t.$.normalize([],t.$.add([],t.$.add([],o,f),d)),m=[];let _;if(new yl(a,p).closestPointOnSphere(c,h,m)){const i=t.$.add([],m,c),n=t.$.sub([],i,a);_=Math.cos(e.fovAboveCenter)*t.$.length(n)}else{const e=t.$.sub([],a,c),i=t.$.sub([],c,a);t.$.normalize(i,i);const n=t.$.length(e)-h;_=Math.sqrt(n*(n+2*h));const s=Math.acos(_/(h+n))-Math.acos(t.$.dot(o,i));_*=Math.cos(s)}return 1.01*_}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Ql(e.zoom);if(n>0){const t=cv(e,Du(1,e.center.lat)*e.worldSize),s=e.worldSize/(2*Math.PI),r=Math.max(e.width,e.height)/e.worldSize*Math.PI;return qn(i,t+s*(1-Math.cos(r)),Math.pow(n,10))}return i}upVector(t,e,i){return Vl(e,i,t,1)}upVectorScale(t){return{metersToTile:Dl(Wl(zl(t)))}}}function jv(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Ov(t);case"equirectangular":return new yv(t);case"naturalEarth":return new Av(t);case"equalEarth":return new wv(t);case"winkelTripel":return new kv(t);case"albers":return i?new Iv(t):new pv(t);case"lambertConformalConic":return i?new Iv(t):new Tv(t);case"globe":return new Cv(t)}throw new Error(`Invalid projection name: ${t.name}`)}const Dv=Id.types,Rv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pv(t,e,i,n,s,r,o,a,h,c,u,l,f){const d=a?Math.min(nv,Math.round(a[0])):0,p=a?Math.min(nv,Math.round(a[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*s),r,o,(d<<1)+(h?1:0),p,16*c,16*u,256*l,256*f)}function Nv(t,e,i){t.emplaceBack(e,i)}function Fv(t,e,i,n,s,r,o){t.emplaceBack(e,i,n,s,r,o)}function zv(t,e,i,n,s){t.emplaceBack(e,i,n,s),t.emplaceBack(e,i,n,s),t.emplaceBack(e,i,n,s),t.emplaceBack(e,i,n,s)}function Lv(t){for(const e of t.sections)if(za(e.text))return!0;return!1}class $v{constructor(t){this.layoutVertexArray=new Wh,this.indexArray=new tc,this.programConfigurations=t,this.segments=new Sc,this.dynamicLayoutVertexArray=new Uh,this.opacityVertexArray=new Yh,this.placedSymbolArray=new _c,this.iconTransitioningVertexArray=new Xh,this.globeExtVertexArray=new qh,this.zOffsetVertexArray=new nc}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(t,e,i,n,s){this.isEmpty()||(i&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Zp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Rv,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,Kp.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Xp.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||s)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,Jp.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||n)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Oa($v,"SymbolBuffers");class Uv{constructor(t,e,i){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new i,this.segments=new Sc,this.collisionVertexArray=new Qh,this.collisionVertexArrayExt=new Uh}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Qp.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,tm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Oa(Uv,"CollisionBuffers");class Bv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=t.ae.identity([]),this.placementViewportMatrix=t.ae.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ym(this.zoom,i["text-size"]),this.iconSizeData=Ym(this.zoom,i["icon-size"]);const n=this.layers[0].layout,s=n.get("symbol-sort-key"),r=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==r&&void 0!==s.constantOr(1),this.sortFeaturesByY=("viewport-y"===r||"auto"===r&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((t=>a_[t])),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new $v(new eu(this.layers,{zoom:this.zoom,lut:this.lut},(t=>/^text/.test(t)))),this.icon=new $v(new eu(this.layers,{zoom:this.zoom,lut:this.lut},(t=>/^icon/.test(t)))),this.glyphOffsetArray=new bc,this.lineVertexArray=new wc,this.symbolInstances=new gc}calculateGlyphDependencies(t,e,i,n,s){for(let i=0;i<t.length;i++){const r=t.codePointAt(i);if(void 0===r)break;if(e[r]=!0,n&&s&&r<=65535){const n=Qm[t.charAt(i)];n&&(e[n.charCodeAt(0)]=!0)}}}updateFootprints(t,e){}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!Ud(this.activeReplacements,i)&&(this.activeReplacements=i,!0)}populate(e,i,n,s){const r=this.layers[0],o=r.layout,a="globe"===this.projection.name,h=o.get("text-font"),c=o.get("text-field"),u=o.get("icon-image"),l=("constant"!==c.value.kind||c.value.value instanceof vs&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==h.value.kind||h.value.value.length>0),f="constant"!==u.value.kind||!!u.value.value||Object.keys(u.parameters).length>0,d=o.get("symbol-sort-key");if(this.features=[],!l&&!f)return;const p=i.iconDependencies,m=i.glyphDependencies,_=i.availableImages,v=new Ja(this.zoom);for(const{feature:i,id:c,index:u,sourceLayerIndex:g}of e){const e=r._featureFilter.needGeometry,b=Ju(i,e);if(!r._featureFilter.filter(v,b,n))continue;if(e||(b.geometry=Zu(i,n,s)),a&&1!==i.type&&n.z<=5){const e=b.geometry,i=.98078528056,s=(e,s)=>{const r=Vl(e.x,e.y,n,1),o=Vl(s.x,s.y,n,1);return t.$.dot(r,o)<i};for(let t=0;t<e.length;t++)e[t]=Wu(e[t],s)}let w,y;if(l){const t=r.getValueAndResolveTokens("text-field",b,n,_),e=vs.factory(t);Lv(e)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ya()||this.hasRTLText&&Za.isParsed())&&(w=Km(e,r,b))}if(f){const t=r.getValueAndResolveTokens("icon-image",b,n,_);y=t instanceof gs?t:gs.fromString(t)}if(!w&&!y)continue;const x=this.sortFeaturesByKey?d.evaluate(b,{},n):void 0;if(this.features.push({id:c,text:w,icon:y,index:u,sourceLayerIndex:g,geometry:b.geometry,properties:i.properties,type:Dv[i.type],sortKey:x}),y&&(p[y.namePrimary]=!0,y.nameSecondary&&(p[y.nameSecondary]=!0)),w){const t=h.evaluate(b,{},n).join(","),e="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a_.vertical)>=0;for(const i of w.sections)if(i.image)p[i.image.namePrimary]=!0;else{const n=Ca(w.toString()),s=i.fontStack||t,r=m[s]=m[s]||{};this.calculateGlyphDependencies(i.text,r,e,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},i={},n=[];let s=0;function r(e){n.push(t[e]),s++}function o(t,e,s){const r=i[t];return delete i[t],i[e]=r,n[r].geometry[0].pop(),n[r].geometry[0]=n[r].geometry[0].concat(s[0]),r}function a(t,i,s){const r=e[i];return delete e[i],e[t]=r,n[r].geometry[0].shift(),n[r].geometry[0]=s[0].concat(n[r].geometry[0]),r}function h(t,e,i){const n=i?e[0][e[0].length-1]:e[0][0];return`${t}:${n.x}:${n.y}`}for(let c=0;c<t.length;c++){const u=t[c],l=u.geometry,f=u.text?u.text.toString():null;if(!f){r(c);continue}const d=h(f,l),p=h(f,l,!0);if(d in i&&p in e&&i[d]!==e[p]){const t=a(d,p,l),s=o(d,p,n[t].geometry);delete e[d],delete i[p],i[h(f,n[s].geometry,!0)]=s,n[t].geometry=null}else d in i?o(d,p,l):p in e?a(d,p,l):(r(c),e[d]=s-1,i[p]=s-1)}return n.filter((t=>t.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((t,e)=>t.sortKey-e.sortKey))}update(t,e,i,n,s){const r=0!==Object.keys(t).length;if(r&&!this.stateDependentLayers.length)return;const o=r?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,e,o,i,n,s),this.icon.programConfigurations.updatePaintArrays(t,e,o,i,n,s)}updateZOffset(){const t=(t,e,n)=>{i+=e,i>t.length&&t.resize(i);for(let s=-e;s<0;s++)t.emplace(s+i,n)},e=(t,e,i)=>{n+=e,n>t.length&&t.resize(n);for(let s=-e;s<0;s++)t.emplace(s+n,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,n=0;for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i),{numHorizontalGlyphVertices:s,numVerticalGlyphVertices:r,numIconVertices:o}=n,a=n.zOffset,h=o>0;if((s>0||r>0)&&(t(this.text.zOffsetVertexArray,s,a),t(this.text.zOffsetVertexArray,r,a)),h){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:i}=n;t>=0&&e(this.icon.zOffsetVertexArray,o,a),i>=0&&e(this.icon.zOffsetVertexArray,n.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=jv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const i=this.lineVertexArray.length;if(void 0!==t.segment)for(const{x:t,y:i}of e)this.lineVertexArray.emplaceBack(t,i);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m){const _=t.indexArray,v=t.layoutVertexArray,g=t.globeExtVertexArray,b=t.segments.prepareSegment(4*e.length,v,_,this.canOverlap?r.sortKey:void 0),w=this.glyphOffsetArray.length,y=b.vertexLength,x=this.allowVerticalPlacement&&o===a_.vertical?Math.PI/2:0,M=r.text&&r.text.sections;for(let n=0;n<e.length;n++){const{tl:s,tr:o,bl:c,br:u,texPrimary:l,texSecondary:w,pixelOffsetTL:y,pixelOffsetBR:T,minFontScaleX:O,minFontScaleY:E,glyphOffset:A,isSDF:S,sectionIndex:k}=e[n],I=b.vertexLength,C=A[1];if(Pv(v,h.x,h.y,s.x,C+s.y,l.x,l.y,i,S,y.x,y.y,O,E),Pv(v,h.x,h.y,o.x,C+o.y,l.x+l.w,l.y,i,S,T.x,y.y,O,E),Pv(v,h.x,h.y,c.x,C+c.y,l.x,l.y+l.h,i,S,y.x,T.y,O,E),Pv(v,h.x,h.y,u.x,C+u.y,l.x+l.w,l.y+l.h,i,S,T.x,T.y,O,E),a){const{x:e,y:i,z:n}=a.anchor,[s,r,o]=a.up;Fv(g,e,i,n,s,r,o),Fv(g,e,i,n,s,r,o),Fv(g,e,i,n,s,r,o),Fv(g,e,i,n,s,r,o),zv(t.dynamicLayoutVertexArray,e,i,n,x)}else zv(t.dynamicLayoutVertexArray,h.x,h.y,h.z,x);if(m){const e=w||l;Nv(t.iconTransitioningVertexArray,e.x,e.y),Nv(t.iconTransitioningVertexArray,e.x+e.w,e.y),Nv(t.iconTransitioningVertexArray,e.x,e.y+e.h),Nv(t.iconTransitioningVertexArray,e.x+e.w,e.y+e.h)}_.emplaceBack(I,I+1,I+2),_.emplaceBack(I+1,I+2,I+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),n!==e.length-1&&k===e[n+1].sectionIndex||t.programConfigurations.populatePaintArrays(v.length,r,r.index,{},f,d,p,M&&M[k])}const T=a?a.anchor:h;t.placedSymbolArray.emplaceBack(T.x,T.y,T.z,h.x,h.y,w,this.glyphOffsetArray.length-w,y,c,u,h.segment,i?i[0]:0,i?i[1]:0,n[0],n[1],o,0,!1,0,l,0)}_commitLayoutVertex(t,e,i,n,s,r,o){t.emplaceBack(e,i,n,s,r,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(t,e,i,n,s,r,o){const a=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),h=a.vertexLength,c=o.tileAnchorX,u=o.tileAnchorY;for(let t=0;t<4;t++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,e,t.padding,o.zOffset),this._commitLayoutVertex(i.layoutVertexArray,n,s,r,c,u,new Ue(t.x1,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,s,r,c,u,new Ue(t.x2,t.y1)),this._commitLayoutVertex(i.layoutVertexArray,n,s,r,c,u,new Ue(t.x2,t.y2)),this._commitLayoutVertex(i.layoutVertexArray,n,s,r,c,u,new Ue(t.x1,t.y2)),a.vertexLength+=4;const l=i.indexArray;l.emplaceBack(h,h+1),l.emplaceBack(h+1,h+2),l.emplaceBack(h+2,h+3),l.emplaceBack(h+3,h),a.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,i,n,s,r){for(let o=n;o<s;o++){const n=i.get(o),s=this.getSymbolInstanceTextSize(t,r,e,o);this._addCollisionDebugVertices(n,s,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,r)}}_addIconDebugCollisionBoxes(t,e,i,n,s,r){for(let o=n;o<s;o++){const n=i.get(o),s=this.getSymbolInstanceIconSize(t,e,r.placedIconSymbolIndex);this._addCollisionDebugVertices(n,s,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,r)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uv(Jh,em.members,Xh),this.iconCollisionBox=new Uv(Jh,em.members,Xh);const i=Zm(this.iconSizeData,t),n=Zm(this.textSizeData,t);for(let s=0;s<this.symbolInstances.length;s++){const r=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(n,t,e,r.textBoxStartIndex,r.textBoxEndIndex,r),this._addTextDebugCollisionBoxes(n,t,e,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r),this._addIconDebugCollisionBoxes(i,t,e,r.iconBoxStartIndex,r.iconBoxEndIndex,r),this._addIconDebugCollisionBoxes(i,t,e,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r)}}getSymbolInstanceTextSize(t,e,i,n){const s=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:n),r=Xm(this.textSizeData,t,s)/Wm;return this.tilePixelRatio*r}getSymbolInstanceIconSize(t,e,i){const n=this.icon.placedSymbolArray.get(i),s=Xm(this.iconSizeData,t,n);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(t,e,i,n){t.emplaceBack(e,-i,-i,n),t.emplaceBack(e,i,-i,n),t.emplaceBack(e,i,i,n),t.emplaceBack(e,-i,i,n)}_updateTextDebugCollisionBoxes(t,e,i,n,s,r){for(let o=n;o<s;o++){const n=i.get(o),s=this.getSymbolInstanceTextSize(t,r,e,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,s,n.padding,r.zOffset)}}_updateIconDebugCollisionBoxes(t,e,i,n,s,r){for(let o=n;o<s;o++){const n=i.get(o),s=this.getSymbolInstanceIconSize(t,e,r.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,s,n.padding,r.zOffset)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Zm(this.iconSizeData,t),n=Zm(this.textSizeData,t);for(let s=0;s<this.symbolInstances.length;s++){const r=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(n,t,e,r.textBoxStartIndex,r.textBoxEndIndex,r),this._updateTextDebugCollisionBoxes(n,t,e,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r),this._updateIconDebugCollisionBoxes(i,t,e,r.iconBoxStartIndex,r.iconBoxEndIndex,r),this._updateIconDebugCollisionBoxes(i,t,e,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,i,n,s,r,o,a,h){const c={};if(e<i){const{x1:i,y1:n,x2:s,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f,featureIndex:d}=t.get(e);c.textBox={x1:i,y1:n,x2:s,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f},c.textFeatureIndex=d}if(n<s){const{x1:e,y1:i,x2:s,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f,featureIndex:d}=t.get(n);c.verticalTextBox={x1:e,y1:i,x2:s,y2:r,padding:o,projectedAnchorX:a,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f},c.verticalTextFeatureIndex=d}if(r<o){const{x1:e,y1:i,x2:n,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f,featureIndex:d}=t.get(r);c.iconBox={x1:e,y1:i,x2:n,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f},c.iconFeatureIndex=d}if(a<h){const{x1:e,y1:i,x2:n,y2:s,padding:r,projectedAnchorX:o,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f,featureIndex:d}=t.get(a);c.verticalIconBox={x1:e,y1:i,x2:n,y2:s,padding:r,projectedAnchorX:o,projectedAnchorY:h,projectedAnchorZ:u,tileAnchorX:l,tileAnchorY:f},c.verticalIconFeatureIndex=d}return c}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,e){const i=t.placedSymbolArray.get(e),n=i.vertexStartIndex+4*i.numGlyphs;for(let e=i.vertexStartIndex;e<n;e+=4)t.indexArray.emplaceBack(e,e+1,e+2),t.indexArray.emplaceBack(e+1,e+2,e+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),i=Math.cos(t),n=[],s=[],r=[];for(let t=0;t<this.symbolInstances.length;++t){r.push(t);const o=this.symbolInstances.get(t);n.push(0|Math.round(e*o.tileAnchorX+i*o.tileAnchorY)),s.push(o.featureIndex)}return r.sort(((t,e)=>n[t]-n[e]||s[e]-s[t])),r}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,e)=>this.symbolInstances.get(e).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,e){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===e?i.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:r,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:a}=e;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),n>=0&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),s>=0&&s!==n&&s!==i&&this.addIndicesForPlacedSymbol(this.text,s),r>=0&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Oa(Bv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Bv.addDynamicAttributes=zv;class Gv{constructor(t,e,i,n){this.context=t,this.format=i,this.texture=t.gl.createTexture(),this.update(e,n)}update(t,e,i){const{width:n,height:s}=t,{context:r}=this,{gl:o}=r;if(o.bindTexture(o.TEXTURE_2D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!e||!1!==e.premultiply)),this.useMipmap=Boolean(e&&e.useMipmap),i||this.size&&this.size[0]===n&&this.size[1]===s){const{x:e,y:r}=i||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)o.texSubImage2D(o.TEXTURE_2D,0,e,r,o.RGBA,o.UNSIGNED_BYTE,t);else{let i=this.format,a=o.UNSIGNED_BYTE;this.format===o.R32F&&(i=o.RED,a=o.FLOAT),o.texSubImage2D(o.TEXTURE_2D,0,e,r,n,s,i,a,t.data)}}else if(this.size=[n,s],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let e=this.format;this.format===o.R8&&(e=o.RED),o.texImage2D(o.TEXTURE_2D,0,this.format,e,o.UNSIGNED_BYTE,t)}else{let e=this.format,i=this.format,r=o.UNSIGNED_BYTE,a=!1;this.format===o.DEPTH_COMPONENT&&(e=o.DEPTH_COMPONENT16,r=o.UNSIGNED_SHORT),this.format===o.DEPTH_STENCIL&&(e=o.DEPTH24_STENCIL8,r=o.UNSIGNED_INT_24_8,a=!0),this.format===o.R8&&(i=o.RED),this.format===o.R32F&&(r=o.FLOAT,i=o.RED),!this.useMipmap&&a?o.texStorage2D(o.TEXTURE_2D,1,e,n,s):o.texImage2D(o.TEXTURE_2D,0,e,n,s,0,i,r,t.data)}this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(t,e,i=!1){const{context:n}=this,{gl:s}=n;s.bindTexture(s.TEXTURE_2D,this.texture),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,t),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,this.useMipmap&&!i?t===s.NEAREST?s.NEAREST_MIPMAP_NEAREST:s.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}bindExtraParam(t,e,i,n){const{context:s}=this,{gl:r}=s;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.magFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),this.magFilter=e),t!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?t===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,i),this.wrapS=i),n!==this.wrapT&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n),this.wrapT=n)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Hv{constructor(t,e){this.context=t,this.texture=e}bind(t,e){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_2D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}}const Vv=32,Wv=33,qv=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,n=0,s=0,r=0,o=0,a=0;for(1&e?s=r=o=Vv:i=n=a=Vv;(e>>=1)>1;){const t=i+s>>1,h=n+r>>1;1&e?(s=i,r=n,i=o,n=a):(i=s,n=r,s=o,r=a),o=t,a=h}const h=4*t;qv[h+0]=i,qv[h+1]=n,qv[h+2]=s,qv[h+3]=r}const Yv=new Uint16Array(2178),Xv=new Uint8Array(1089),Zv=new Uint16Array(1089);function Jv(t){return 0===t?-.03125:32===t?.03125:0}var Kv=Rh([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qv{constructor(t,e,i,n){this.id=Qv.uniqueIdxCounter,Qv.uniqueIdxCounter++,this.context=t;const s=t.gl;this.buffer=s.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?s.DYNAMIC_DRAW:s.STATIC_DRAW),this.dynamicDraw||n||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Qv.uniqueIdxCounter,Qv.uniqueIdxCounter++;const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Qv.uniqueIdxCounter=0;class tg{constructor(t,e,i){this.func=t,this.mask=e,this.range=i}}tg.ReadOnly=!1,tg.ReadWrite=!0,tg.disabled=new tg(519,tg.ReadOnly,[0,1]);const eg=7680;class ig{constructor(t,e,i,n,s,r){this.test=t,this.ref=e,this.mask=i,this.fail=n,this.depthFail=s,this.pass=r}}ig.disabled=new ig({func:519,mask:0},0,0,eg,eg,eg);const ng=771;class sg{constructor(t,e,i,n){this.blendFunction=t,this.blendColor=e,this.mask=i,this.blendEquation=n}}sg.Replace=[1,0,1,0],sg.disabled=new sg(sg.Replace,Vn.transparent,[!1,!1,!1,!1]),sg.unblended=new sg(sg.Replace,Vn.transparent,[!0,!0,!0,!0]),sg.alphaBlended=new sg([1,ng,1,ng],Vn.transparent,[!0,!0,!0,!0]),sg.alphaBlendedNonPremultiplied=new sg([770,ng,770,ng],Vn.transparent,[!0,!0,!0,!0]),sg.multiply=new sg([774,0,774,0],Vn.transparent,[!0,!0,!0,!0]);const rg=1029,og=2305;class ag{constructor(t,e,i){this.enable=t,this.mode=e,this.frontFace=i}}ag.disabled=new ag(!1,rg,og),ag.backCCW=new ag(!0,rg,og),ag.backCW=new ag(!0,rg,2304),ag.frontCW=new ag(!0,1028,2304),ag.frontCCW=new ag(!0,1028,og);var hg=Rh([{name:"a_index",type:"Int16",components:1}]);const cg=(()=>({type:2,extent:pr,loadGeometry:()=>[[new Ue(0,0),new Ue(pr+1,0),new Ue(pr+1,pr+1),new Ue(0,pr+1),new Ue(0,0)]]}))();class ug{constructor(t,e,i,n,s){this.tileID=t,this.uid=si(),this.uses=0,this.tileSize=e,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<Ri.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=uv(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,i){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const i={};if(!e)return i;for(const n of t){const t=n.layerIds.map((t=>e.getLayer(t))).filter(Boolean);if(0!==t.length){n.layers=t,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map((e=>t.filter((t=>t.id===e))[0])));for(const e of t)i[e.fqid]=n}}return i}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Bv){if(this.hasSymbolBuckets=!0,!i)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof Bv&&e.hasRTLText){this.hasRTLText=!0,Za.isLoading()||Za.isLoaded()||"deferred"!==Ya()||Xa();break}}this.queryPadding=0;for(const t in this.buckets){const i=this.buckets[t],n=e.style.getOwnLayer(t);if(!n)continue;const s=n.queryRadius(i);this.queryPadding=Math.max(this.queryPadding,s)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new pc}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const e=t.gl,i=this.imageAtlas;if(i&&!i.uploaded){const n=!!Object.keys(i.patternPositions).length;this.imageAtlasTexture=new Gv(t,i.image,e.RGBA,{useMipmap:n}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gv(t,this.glyphAtlasImage,e.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Gv(t,this.lineAtlas.image,e.R8),this.lineAtlas.uploaded=!0)}prepare(t,e,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,i),!e||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=e.style.getBrightness();(this._lastUpdatedBrightness||n)&&(this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this._lastUpdatedBrightness=n,this.updateBuckets(void 0,e)))}queryRenderedFeatures(t,e,i,n,s,r,o,a){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:o,transform:r,params:s,tileTransform:this.tileTransform},t,e,i):{}}querySourceFeatures(t,e){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const n=i.loadVTLayers(),s=e?e.sourceLayer:"",r=n._geojsonTileLayer||n[s];if(!r)return;const o=ph(e&&e.filter),{z:a,x:h,y:c}=this.tileID.canonical,u={z:a,x:h,y:c};for(let e=0;e<r.length;e++){const n=r.feature(e);if(o.needGeometry){const t=Ju(n,!0);if(!o.filter(new Ja(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!o.filter(new Ja(this.tileID.overscaledZ),n))continue;const l=i.getId(n,s),f=new Um(n,a,h,c,l);f.tile=u,t.push(f)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=bi(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let i=!1;if(this.expirationTime>t)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{const n=this.expirationTime-e;n?this.expirationTime=t+Math.max(n,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length&&e&&this.updateBuckets(t,e)}updateBuckets(t,e){if(!this.latestFeatureIndex)return;const i=this.latestFeatureIndex.loadVTLayers(),n=e.style.listImages(),s=e.style.getBrightness();for(const r in this.buckets){if(!e.style.hasLayer(r))continue;const o=this.buckets[r],a=o.layers[0].sourceLayer||"_geojsonTileLayer",h=i[a];let c={};if(t&&(c=t[a],!h||!c||0===Object.keys(c).length))continue;if(o.update(c,h,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},s),o instanceof am||o instanceof id){const t=e.style.getOwnSourceCache(o.layers[0].source);e._terrain&&e._terrain.enabled&&t&&o.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const u=e&&e.style&&e.style.getOwnLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ri.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Ri.now()+t}setTexture(t,e){const i=e.context,n=i.gl;this.texture=this.texture||e.getTileTexture(t.width),this.texture&&this.texture instanceof Gv?this.texture.update(t,{useMipmap:!0}):(this.texture=new Gv(i,t,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(t,e){const i={};for(const t of e)i[t]=!0;this.dependencies[t]=i}hasDependency(t,e){for(const i of t){const t=this.dependencies[i];if(t)for(const i of e)if(t[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const i=Zu(cg,this.tileID.canonical,this.tileTransform)[0],n=new Nh,s=new ac;for(let t=0;t<i.length;t++){const{x:e,y:r}=i[t];n.emplaceBack(e,r),s.emplaceBack(t)}s.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(n,jl.members),this._tileDebugSegments=Sc.simpleSegment(0,0,n.length,s.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const i=Zu(cg,this.tileID.canonical,this.tileTransform)[0];let n,s;if(this.isRaster){const t=function(t,e){const i=uv(t,e),n=Math.pow(2,t.z);for(let s=0;s<Wv;s++)for(let r=0;r<Wv;r++){const o=Ru((t.x+(r+Jv(r))/Vv)/n),a=Pu((t.y+(s+Jv(s))/Vv)/n),h=e.project(o,a),c=s*Wv+r;Yv[2*c+0]=Math.round((h.x*i.scale-i.x)*pr),Yv[2*c+1]=Math.round((h.y*i.scale-i.y)*pr)}Xv.fill(0),Zv.fill(0);for(let t=2045;t>=0;t--){const e=4*t,i=qv[e+0],n=qv[e+1],s=qv[e+2],r=qv[e+3],o=i+s>>1,a=n+r>>1,h=o+a-n,c=a+i-o,u=n*Wv+i,l=r*Wv+s,f=a*Wv+o,d=Math.hypot((Yv[2*u+0]+Yv[2*l+0])/2-Yv[2*f+0],(Yv[2*u+1]+Yv[2*l+1])/2-Yv[2*f+1])>=16;Xv[f]=Xv[f]||(d?1:0),t<1022&&(Xv[f]=Xv[f]||Xv[(n+c>>1)*Wv+(i+h>>1)]||Xv[(r+c>>1)*Wv+(s+h>>1)])}const s=new zh,r=new tc;let o=0;function a(t,e){const i=e*Wv+t;return 0===Zv[i]&&(s.emplaceBack(Yv[2*i+0],Yv[2*i+1],t*pr/Vv,e*pr/Vv),Zv[i]=++o),Zv[i]-1}function h(t,e,i,n,s,o){const c=t+i>>1,u=e+n>>1;if(Math.abs(t-s)+Math.abs(e-o)>1&&Xv[u*Wv+c])h(s,o,t,e,c,u),h(i,n,s,o,c,u);else{const h=a(t,e),c=a(i,n),u=a(s,o);r.emplaceBack(h,c,u)}}return h(0,0,Vv,Vv,Vv,0),h(Vv,Vv,0,0,0,Vv),{vertices:s,indices:r}}(this.tileID.canonical,e);n=t.vertices,s=t.indices}else{n=new zh,s=new tc;for(const{x:t,y:e}of i)n.emplaceBack(t,e,0,0);const t=Af(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)s.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,Kv.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(s),this._tileBoundsSegments=Sc.simpleSegment(0,0,n.length,s.length)}_makeGlobeTileDebugBuffers(e,i){const n=i.projection;if(!n||"globe"!==n.name||i.freezeTileCoverage)return;const s=this.tileID.canonical,r=Yl($l(s,i)),o=Ql(i.zoom);let a;o>0&&(a=t.ae.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,s,i,r,a,o),this._makeGlobeTileDebugTextBuffer(e,s,i,r,a,o)}_globePoint(e,i,n,s,r,o,a){let h=Vl(e,i,n);if(o){const r=1<<n.z,c=Cu(s.center.lng),u=ju(s.center.lat),l=(n.x+.5)/r-c;let f=0;l>.5?f=-1:l<-.5&&(f=1);let d=(e/pr+n.x)/r+f,p=(i/pr+n.y)/r;d=(d-c)*s._pixelsPerMercatorPixel+c,p=(p-u)*s._pixelsPerMercatorPixel+u;const m=[d*s.worldSize,p*s.worldSize,0];t.$.transformMat4(m,m,o),h=Ll(h,m,a)}return t.$.transformMat4(h,h,r)}_makeGlobeTileDebugBorderBuffer(t,e,i,n,s,r){const o=new Nh,a=new ac,h=new Fh,c=(t,c,u,l,f)=>{const d=(u-t)/(f-1),p=(l-c)/(f-1),m=o.length;for(let u=0;u<f;u++){const l=t+u*d,f=c+u*p;o.emplaceBack(l,f);const _=this._globePoint(l,f,e,i,n,s,r);h.emplaceBack(_[0],_[1],_[2]),a.emplaceBack(m+u)}},u=pr;c(0,0,u,0,16),c(u,0,u,u,16),c(u,u,0,u,16),c(0,u,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(a),this._tileDebugBuffer=t.createVertexBuffer(o,jl.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(h,Cl.members),this._tileDebugSegments=Sc.simpleSegment(0,0,o.length,a.length)}_makeGlobeTileDebugTextBuffer(t,e,i,n,s,r){const o=pr/4,a=new Nh,h=new tc,c=new Fh,u=25;h.reserve(32),a.reserve(u),c.reserve(u);const l=(t,e)=>u*t+e;for(let t=0;t<u;t++){const h=t*o;for(let t=0;t<u;t++){const u=t*o;a.emplaceBack(u,h);const l=this._globePoint(u,h,e,i,n,s,r);c.emplaceBack(l[0],l[1],l[2])}}for(let t=0;t<4;t++)for(let e=0;e<4;e++){const i=l(t,e),n=l(t,e+1),s=l(t+1,e),r=l(t+1,e+1);h.emplaceBack(i,n,s),h.emplaceBack(s,n,r)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(h),this._tileDebugTextBuffer=t.createVertexBuffer(a,jl.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(c,Cl.members),this._tileDebugTextSegments=Sc.simpleSegment(0,0,u,32)}destroy(t=!1){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof Gv&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function lg(t,e,i){1===t?e.header_length=i.readFixed32():2===t?e.x=i.readVarint():3===t?e.y=i.readVarint():4===t?e.z=i.readVarint():5===t&&e.layers.push(function(t,e){return t.readFields(_g,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)}(i,i.readVarint()+i.pos))}function fg(t,e,i){1===t?(e.delta_filter=function(t,e){return t.readFields(dg,{block_size:0},e)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):2===t?(i.readVarint(),e.filter="zigzag_filter"):3===t?(i.readVarint(),e.filter="bitshuffle_filter"):4===t&&(i.readVarint(),e.filter="byteshuffle_filter")}function dg(t,e,i){1===t&&(e.block_size=i.readVarint())}function pg(t,e,i){1===t?(i.readVarint(),e.codec="gzip_data"):2===t?(i.readVarint(),e.codec="jpeg_image"):3===t?(i.readVarint(),e.codec="webp_image"):4===t&&(i.readVarint(),e.codec="png_image")}function mg(t,e,i){1===t?e.first_byte=i.readFixed64():2===t?e.last_byte=i.readFixed64():3===t?e.filters.push(function(t,e){return t.readFields(fg,{},e)}(i,i.readVarint()+i.pos)):4===t?e.codec=function(t,e){return t.readFields(pg,{},e)}(i,i.readVarint()+i.pos):5===t?e.deprecated_offset=i.readFloat():6===t?e.deprecated_scale=i.readFloat():7===t?e.bands.push(i.readString()):8===t?e.offset=i.readDouble():9===t&&(e.scale=i.readDouble())}function _g(t,e,i){1===t?e.version=i.readVarint():2===t?e.name=i.readString():3===t?e.units=i.readString():4===t?e.tilesize=i.readVarint():5===t?e.buffer=i.readVarint():6===t?e.pixel_format=i.readVarint():7===t&&e.data_index.push(function(t,e){return t.readFields(mg,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},e)}(i,i.readVarint()+i.pos))}function vg(t,e,i){if(2===t)!function(t,e,i){t.readFields(gg,i,e)}(i,i.readVarint()+i.pos,e);else if(3===t)throw new Error("Not implemented")}function gg(t,e,i){if(1===t){let t=0;const n=i.readVarint()+i.pos;for(;i.pos<n;)e[t++]=i.readVarint()}}class bg{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}put(t,e){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,e)}}function wg(t,e){if(4!==e.length)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let n=2;n>=1;n--){const s=1===n?1:0,r=2===n?1:0;for(let n=0;n<e[0];n++){const o=e[1]*n;for(let n=s;n<e[1];n++){const s=e[2]*(n+o);for(let n=r;n<e[2];n++){const r=e[3]*(n+s);for(let n=0;n<e[3];n++){const e=r+n;t[e]+=t[e-i]}}}}i*=e[n]}return t}function yg(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function xg(t,e){switch(e){case"uint32":return t;case"uint16":for(let e=0;e<t.length;e+=2){const i=t[e],n=t[e+1];t[e]=(240&i)>>4|(61440&i)>>8|(240&n)<<4|61440&n,t[e+1]=15&i|(3840&i)>>4|(15&n)<<8|(3840&n)<<4}return t;case"uint8":for(let e=0;e<t.length;e+=4){const i=t[e],n=t[e+1],s=t[e+2],r=t[e+3];t[e+0]=(192&i)>>6|(192&n)>>4|(192&s)>>2|192&r,t[e+1]=(48&i)>>4|(48&n)>>2|48&s|(48&r)<<2,t[e+2]=(12&i)>>2|12&n|(12&s)<<2|(12&r)<<4,t[e+3]=3&i|(3&n)<<2|(3&s)<<4|(3&r)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}var Mg=Uint8Array,Tg=Uint16Array,Og=Int32Array,Eg=new Mg([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ag=new Mg([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Sg=new Mg([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kg=function(t,e){for(var i=new Tg(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var s=new Og(i[30]);for(n=1;n<30;++n)for(var r=i[n];r<i[n+1];++r)s[r]=r-i[n]<<5|n;return{b:i,r:s}},Ig=kg(Eg,2),Cg=Ig.b,jg=Ig.r;Cg[28]=258,jg[258]=28;for(var Dg=kg(Ag,0).b,Rg=new Tg(32768),Pg=0;Pg<32768;++Pg){var Ng=(43690&Pg)>>1|(21845&Pg)<<1;Rg[Pg]=((65280&(Ng=(61680&(Ng=(52428&Ng)>>2|(13107&Ng)<<2))>>4|(3855&Ng)<<4))>>8|(255&Ng)<<8)>>1}var Fg=function(t,e,i){for(var n=t.length,s=0,r=new Tg(e);s<n;++s)t[s]&&++r[t[s]-1];var o,a=new Tg(e);for(s=1;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;o=new Tg(1<<e);var h=15-e;for(s=0;s<n;++s)if(t[s])for(var c=s<<4|t[s],u=e-t[s],l=a[t[s]-1]++<<u,f=l|(1<<u)-1;l<=f;++l)o[Rg[l]>>h]=c;return o},zg=new Mg(288);for(Pg=0;Pg<144;++Pg)zg[Pg]=8;for(Pg=144;Pg<256;++Pg)zg[Pg]=9;for(Pg=256;Pg<280;++Pg)zg[Pg]=7;for(Pg=280;Pg<288;++Pg)zg[Pg]=8;var Lg=new Mg(32);for(Pg=0;Pg<32;++Pg)Lg[Pg]=5;var $g=Fg(zg,9),Ug=Fg(Lg,5),Bg=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},Gg=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},Hg=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},Vg=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Wg=function(t,e,i){var n=new Error(e||Vg[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Wg),!i)throw n;return n},qg=new Mg(0),Yg="undefined"!=typeof TextDecoder&&new TextDecoder;try{Yg.decode(qg,{stream:!0})}catch(t){}const Xg={gzip_data:"gzip"};class Zg extends Error{constructor(t){super(t),this.name="MRTError"}}const Jg={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Kg={uint32:1,uint16:2,uint8:4},Qg={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let tb,eb;class ib{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const e=this.layers[t];if(!e)throw new Zg(`Layer '${t}' not found`);return e}getHeaderLength(t){const e=new Uint8Array(t),i=new DataView(t);if(13!==e[0])throw new Zg("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(t){const e=new Uint8Array(t),i=this.getHeaderLength(t);if(e.length<i)throw new Zg(`Expected header with length >= ${i} but got buffer of length ${e.length}`);const n=function(t,e){return t.readFields(lg,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new tb(e.subarray(0,i)));if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new Zg(`Invalid attempt to parse header ${n.z}/${n.x}/${n.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=n.x,this.y=n.y,this.z=n.z;for(const t of n.layers)this.layers[t.name]=new nb(t,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const e=[],i=this.getLayer(t.layerName);for(let n of t.blockIndices){const s=i.dataIndex[n],r=s.first_byte-t.firstByte,o=s.last_byte-t.firstByte;if(i._blocksInProgress.has(n))continue;const a={layerName:i.name,firstByte:r,lastByte:o,pixelFormat:i.pixelFormat,blockIndex:n,blockShape:[s.bands.length].concat(i.bandShape),buffer:i.buffer,codec:s.codec.codec,filters:s.filters.map((t=>t.filter))};i._blocksInProgress.add(n),e.push(a)}return new sb(e,(()=>{e.forEach((t=>i._blocksInProgress.delete(t.blockIndex)))}),((t,n)=>{if(e.forEach((t=>i._blocksInProgress.delete(t.blockIndex))),t)throw t;n.forEach((t=>{this.getLayer(t.layerName).processDecodedData(t)}))}))}}class nb{constructor({version:t,name:e,units:i,tilesize:n,pixel_format:s,buffer:r,data_index:o},a){if(this.version=t,1!==this.version)throw new Zg(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=e,this.units=i,this.tileSize=n,this.buffer=r,this.pixelFormat=Jg[s],this.dataIndex=o,this.bandShape=[n+2*r,n+2*r,Kg[this.pixelFormat]],this._decodedBlocks=new bg(a?a.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Kg[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:t})=>t)).flat()}processDecodedData(t){const e=t.blockIndex.toString();this._decodedBlocks.get(e)||this._decodedBlocks.put(e,t.data)}getBlockForBand(t){let e=0;switch(typeof t){case"string":for(const[i,n]of this.dataIndex.entries()){for(const[s,r]of n.bands.entries())if(r===t)return{bandIndex:e+s,blockIndex:i,blockBandIndex:s};e+=n.bands.length}break;case"number":for(const[i,n]of this.dataIndex.entries()){if(t>=e&&t<e+n.bands.length)return{bandIndex:t,blockIndex:i,blockBandIndex:t-e};e+=n.bands.length}break;default:throw new Zg(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new Zg(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let e=1/0,i=-1/0;const n=[],s=new Set;for(const r of t){const{blockIndex:t}=this.getBlockForBand(r);if(t<0)throw new Zg(`Invalid band: ${JSON.stringify(r)}`);const o=this.dataIndex[t];n.includes(t)||n.push(t),s.add(t),e=Math.min(e,o.first_byte),i=Math.max(i,o.last_byte)}if(s.size>this.cacheSize)throw new Zg(`Number of blocks to decode (${s.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:e,lastByte:i,blockIndices:n}}hasBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0}hasDataForBand(t){const{blockIndex:e}=this.getBlockForBand(t);return e>=0&&!!this._decodedBlocks.get(e.toString())}getBandView(t){const{blockIndex:e,blockBandIndex:i}=this.getBlockForBand(t),n=this._decodedBlocks.get(e.toString());if(!n)throw new Zg(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const s=this.dataIndex[e],r=this.bandShape.reduce(((t,e)=>t*e),1),o=i*r,a=n.subarray(o,o+r);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:0!==s.offset?s.offset:s.deprecated_offset,scale:0!==s.scale?s.scale:s.deprecated_scale}}}ib.setPbf=function(t){tb=t};class sb{constructor(t,e,i){this.tasks=t,this._onCancel=e,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,e){this._finalized||(this._onComplete(t,e),this._finalized=!0)}}ib.performDecoding=function(t,e){const i=new Uint8Array(t);return Promise.all(e.tasks.map((t=>{const{layerName:e,firstByte:n,lastByte:s,pixelFormat:r,blockShape:o,blockIndex:a,filters:h,codec:c}=t,u=i.subarray(n,s+1),l=new Uint32Array(o[0]*o[1]*o[2]);let f;if("gzip_data"!==c)throw new Zg(`Unhandled codec: ${c}`);return f=function(t,e){if(!globalThis.DecompressionStream&&"gzip_data"===e)return Promise.resolve(((r=function(t){31==t[0]&&139==t[1]&&8==t[2]||Wg(6,"invalid gzip data");var e=t[3],i=10;4&e&&(i+=2+(t[10]|t[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[i++]);return i+(2&e)}(s=t))+8>s.length&&Wg(6,"invalid gzip data"),function(t,e,i,n){var s=t.length;if(!s||e.f&&!e.l)return i||new Mg(0);var r=!i,o=r||2!=e.i,a=e.i;r&&(i=new Mg(3*s));var h,c,u=function(t){var e=i.length;if(t>e){var n=new Mg(Math.max(2*e,t));n.set(i),i=n}},l=e.f||0,f=e.p||0,d=e.b||0,p=e.l,m=e.d,_=e.m,v=e.n,g=8*s;do{if(!p){l=Gg(t,f,1);var b=Gg(t,f+1,3);if(f+=3,!b){var w=t[(C=4+((f+7)/8|0))-4]|t[C-3]<<8,y=C+w;if(y>s){a&&Wg(0);break}o&&u(d+w),i.set(t.subarray(C,y),d),e.b=d+=w,e.p=f=8*y,e.f=l;continue}if(1==b)p=$g,m=Ug,_=9,v=5;else if(2==b){var x=Gg(t,f,31)+257,M=Gg(t,f+10,15)+4,T=x+Gg(t,f+5,31)+1;f+=14;for(var O=new Mg(T),E=new Mg(19),A=0;A<M;++A)E[Sg[A]]=Gg(t,f+3*A,7);f+=3*M;var S=Bg(E),k=(1<<S)-1,I=Fg(E,S);for(A=0;A<T;){var C,j=I[Gg(t,f,k)];if(f+=15&j,(C=j>>4)<16)O[A++]=C;else{var D=0,R=0;for(16==C?(R=3+Gg(t,f,3),f+=2,D=O[A-1]):17==C?(R=3+Gg(t,f,7),f+=3):18==C&&(R=11+Gg(t,f,127),f+=7);R--;)O[A++]=D}}var P=O.subarray(0,x),N=O.subarray(x);_=Bg(P),v=Bg(N),p=Fg(P,_),m=Fg(N,v)}else Wg(1);if(f>g){a&&Wg(0);break}}o&&u(d+131072);for(var F=(1<<_)-1,z=(1<<v)-1,L=f;;L=f){var $=(D=p[Hg(t,f)&F])>>4;if((f+=15&D)>g){a&&Wg(0);break}if(D||Wg(2),$<256)i[d++]=$;else{if(256==$){L=f,p=null;break}var U=$-254;$>264&&(U=Gg(t,f,(1<<(H=Eg[A=$-257]))-1)+Cg[A],f+=H);var B=m[Hg(t,f)&z],G=B>>4;if(B||Wg(3),f+=15&B,N=Dg[G],G>3){var H=Ag[G];N+=Hg(t,f)&(1<<H)-1,f+=H}if(f>g){a&&Wg(0);break}o&&u(d+131072);var V=d+U;if(d<N){var W=0-N,q=Math.min(N,V);for(W+d<0&&Wg(3);d<q;++d)i[d]=(void 0)[W+d]}for(;d<V;++d)i[d]=i[d-N]}}e.l=p,e.p=L,e.b=d,e.f=l,p&&(l=1,e.m=_,e.d=m,e.n=v)}while(!l);return d!=i.length&&r?(h=i,(null==(c=d)||c>h.length)&&(c=h.length),new Mg(h.subarray(0,c))):i.subarray(0,d)}(s.subarray(r,-8),{i:2},new Mg(((i=s)[(n=i.length)-4]|i[n-3]<<8|i[n-2]<<16|i[n-1]<<24)>>>0))));var i,n,s,r;const o=Xg[e];if(!o)throw new Error(`Unhandled codec: ${e}`);const a=new globalThis.DecompressionStream(o);return new Response(new Blob([t]).stream().pipeThrough(a)).arrayBuffer().then((t=>new Uint8Array(t)))}(u,c).then((t=>(function(t,e){t.readFields(vg,e)}(new tb(t),l),new Qg[r](l.buffer)))),f.then((t=>{for(let e=h.length-1;e>=0;e--)switch(h[e]){case"delta_filter":wg(t,o);break;case"zigzag_filter":yg(t);break;case"bitshuffle_filter":xg(t,r);break;default:throw new Zg(`Unhandled filter "${h[e]}"`)}return{layerName:e,blockIndex:a,data:t}})).catch((t=>{throw t}))})))},ib.setPbf(Lm);class rb extends ug{constructor(t,e,i,n,s){super(t,e,i,n,s),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,e){const i=e.context,n=i.gl;this.texture=this.texture||e.getTileTexture(t.width),this.texture&&this.texture instanceof Gv?this.texture.update(t,{useMipmap:!1,premultiply:!1}):this.texture=new Gv(i,t,n.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,e){const i=this._mrt=new ib(30),n=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=sn(n,((n,s,r,o)=>{if(n)e(n);else try{const n=i.getHeaderLength(s);if(n>t)return void(this.request=this.fetchHeader(n,e));i.parseHeader(s),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(i.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].last_byte);s.byteLength>=a&&(this.entireBuffer=s),e(null,this.entireBuffer||s,r,o)}catch(t){e(t)}})),this.request}fetchBand(t,e,i){const n=this._mrt;if(!this._isHeaderLoaded||!n)return void i(new Error("Tile header is not ready"));const s=this.actor;if(!s)return void i(new Error("Can't fetch tile band without an actor"));let r;const o=(n,s)=>{r.complete(n,s),n?i(n):(this.updateTextureDescriptor(t,e),i(null,this.textureDescriptor&&this.textureDescriptor.img))},a=(t,e)=>{if(t)return i(t);const n=s.send("decodeRasterArray",{buffer:e,task:r},o,void 0,!0);this._workQueue.push((()=>{n&&n.cancel(),r.cancel()}))},h=n.getLayer(t);if(!h)return void i(new Error(`Unknown sourceLayer "${t}"`));if(h.hasDataForBand(e))return this.updateTextureDescriptor(t,e),void i(null,this.textureDescriptor?this.textureDescriptor.img:null);const c=h.getDataRange([e]);if(r=n.createDecodingTask(c),!r||r.tasks.length)if(this.flushQueues(),this.entireBuffer)a(null,this.entireBuffer.slice(c.firstByte,c.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:`bytes=${c.firstByte}-${c.lastByte}`}}),e=sn(t,a);this._fetchQueue.push((()=>{e.cancel(),r.cancel()}))}else i(null)}updateNeeded(t,e){return(!this.textureDescriptor||this.textureDescriptor.band!==e||this.textureDescriptor.layer!==t)&&"errored"!==this.state}updateTextureDescriptor(t,e){if(!this._mrt)return;const i=this._mrt.getLayer(t);if(!i||!i.hasBand(e)||!i.hasDataForBand(e))return;const{bytes:n,tileSize:s,buffer:r,offset:o,scale:a}=i.getBandView(e),h=s+2*r,c={data:n,width:h,height:h},u=this.texture;u&&u instanceof Gv&&u.update(c,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:t,band:e,img:c,buffer:r,offset:o,tileSize:s,format:i.pixelFormat,mix:[a,256*a,65536*a,16777216*a]}}}class ob{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,i){const n=t.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const s={value:e,timeout:void 0};if(void 0!==i&&(s.timeout=setTimeout((()=>{this.remove(t,s)}),i)),this.data[n].push(s),this.order.push(n),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const i=t.wrapped().key,n=void 0===e?0:this.data[i].indexOf(e),s=this.data[i][n];return this.data[i].splice(n,1),s.timeout&&clearTimeout(s.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(s.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const i in this.data)for(const n of this.data[i])t(n.value)||e.push(n);for(const t of e)this.remove(t.value.tileID,t)}}class ab extends Ln{constructor(t,e,i){super(),this.id=t,this._onlySymbols=i,e.on("data",(t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),e.on("error",(()=>{this._sourceErrored=!0})),this._source=e,this._tiles={},this._cache=new ob(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Bm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const e in this._tiles){const i=this._tiles[e];i.upload(t),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ei(this._tiles).map((t=>t.tileID)).sort(hb).map((t=>t.key))}getRenderableIds(t,e){const i=[];for(const n in this._tiles)this._isIdRenderable(+n,t,e)&&i.push(this._tiles[n]);return t?i.sort(((t,e)=>{const i=t.tileID,n=e.tileID,s=new Ue(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),r=new Ue(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-n.overscaledZ||r.y-s.y||r.x-s.x})).map((t=>t.tileID.key)):i.map((t=>t.tileID)).sort(hb).map((t=>t.key))}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())&&(i||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const i=this._tiles[t];i&&("loading"!==i.state&&(i.state=e),this._loadTile(i,this._tileLoaded.bind(this,i,t,e)))}_tileLoaded(t,e,i,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new Nn(n,{tile:t}));else{if(this._source.fire(new Pn("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=Ri.now(),"expired"===i&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new Pn("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let n=0;n<e.length;n++){const s=e[n];if(t.neighboringTiles&&t.neighboringTiles[s]){const e=this.getTileByID(s);i(t,e),i(e,t)}}function i(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let i=e.tileID.canonical.x-t.tileID.canonical.x;const n=e.tileID.canonical.y-t.tileID.canonical.y,s=Math.pow(2,t.tileID.canonical.z),r=e.tileID.key;0===i&&0===n||Math.abs(n)>1||(Math.abs(i)>1&&(1===Math.abs(i+s)?i+=s:1===Math.abs(i-s)&&(i-=s)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,i,n),t.neighboringTiles&&t.neighboringTiles[r]&&(t.neighboringTiles[r].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,i,n){for(const s in this._tiles){let r=this._tiles[s];if(n[s]||!r.hasData()||r.tileID.overscaledZ<=e||r.tileID.overscaledZ>i)continue;let o=r.tileID;for(;r&&r.tileID.overscaledZ>e+1;){const t=r.tileID.scaledTo(r.tileID.overscaledZ-1);r=this._tiles[t.key],r&&r.hasData()&&(o=t)}let a=o;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){n[o.key]=o;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const i=this._loadedParentTiles[t.key];return i&&i.tileID.overscaledZ>=e?i:null}for(let i=t.overscaledZ-1;i>=e;i--){const e=t.scaledTo(i),n=this._getLoadedTile(e);if(n)return n}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const i=Math.ceil(t.width/e)+1,n=Math.ceil(t.height/e)+1,s=Math.floor(i*n*5),r="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,s):s,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const i in this._tiles){const n=this._tiles[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+e),t[n.tileID.key]=n}this._tiles=t;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,e,i,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!i)return;this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const s="batched-model"===this._source.type;let r;if(this.used||this.usedForTerrain){if(this._source.tileID)r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new Ou(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const n=t.clone();n.tileCoverLift=this.tileCoverLift,r=n.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.minzoom<=1&&"globe"===t.projection.name&&(r.push(new Ou(1,0,1,0,0)),r.push(new Ou(1,0,1,1,0)),r.push(new Ou(1,0,1,0,1)),r.push(new Ou(1,0,1,1,1)))}else if(r=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:s}),this._source.hasTile){const t=this._source.hasTile.bind(this._source);r=r.filter((e=>t(e)))}}else r=[];if(r.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!cb(this._source.type)){const o=t.coveringZoomLevel({tileSize:e||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),a=Math.min(o,this._source.maxzoom);if(s){const e=t.extendTileCover(r,a);for(const t of e)r.push(t)}else{const e=t.extendTileCover(r,a,n);for(const t of e)this._shadowCasterTiles[t.key]=!0,r.push(t)}}const o=this._updateRetainedTiles(r);if(cb(this._source.type)&&0!==r.length){const t={},e={},i=Object.keys(o);for(const n of i){const i=o[n],s=this._tiles[n];if(!s||s.fadeEndTime&&s.fadeEndTime<=Ri.now())continue;const r=this.findLoadedParent(i,Math.max(i.overscaledZ-ab.maxOverzooming,this._source.minzoom));r&&(this._addTile(r.tileID),t[r.tileID.key]=r.tileID),e[n]=i}const n=r[r.length-1].overscaledZ;for(const t in this._tiles){const i=this._tiles[t];if(o[t]||!i.hasData())continue;let s=i.tileID;for(;s.overscaledZ>n;){s=s.scaledTo(s.overscaledZ-1);const n=this._tiles[s.key];if(n&&n.hasData()&&e[s.key]){o[t]=i.tileID;break}}}for(const e in t)o[e]||(this._coveredTiles[e]=!0,o[e]=t[e])}for(const t in o)this._tiles[t].clearFadeHold();const a=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i}(this._tiles,o);for(const t of a){const e=this._tiles[t];e.hasSymbolBuckets&&!e.holdingForFade()?e.setHoldDuration(this.map._fadeDuration):e.hasSymbolBuckets&&!e.symbolFadeFinished()||this._removeTile(+t)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const i={},n=t.reduce(((t,e)=>Math.min(t,e.overscaledZ)),1/0),s=t[0].overscaledZ,r=Math.max(s-ab.maxOverzooming,this._source.minzoom),o=Math.max(s+ab.maxUnderzooming,this._source.minzoom),a={};for(const i of t){const t=this._addTile(i);e[i.key]=i,t.hasData()||n<this._source.maxzoom&&(a[i.key]=i)}this._retainLoadedChildren(a,n,o,e);for(const n of t){let t=this._tiles[n.key];if(t.hasData())continue;if(n.canonical.z>=this._source.maxzoom){const t=n.children(this._source.maxzoom)[0],i=this.getTile(t);if(i&&i.hasData()){e[t.key]=t;continue}}else{const t=n.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let s=t.wasRequested();for(let o=n.overscaledZ-1;o>=r;--o){const r=n.scaledTo(o);if(i[r.key])break;if(i[r.key]=!0,t=this.getTile(r),!t&&s&&(t=this._addTile(r)),t&&(e[r.key]=r,s=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let i,n=this._tiles[t].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){i=this._loadedParentTiles[n.key];break}e.push(n.key);const t=n.scaledTo(n.overscaledZ-1);if(i=this._getLoadedTile(t),i)break;n=t}for(const t of e)this._loadedParentTiles[t]=i}}_addTile(t){let e=this._tiles[t.key];if(e)return!0!==e.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const i=Boolean(e);if(!i){const i=this.map?this.map.painter:null,n=this._source.tileSize*t.overscaleFactor();e="raster-array"===this._source.type?new rb(t,n,this.transform.tileZoom,i,this._isRaster):new ug(t,n,this.transform.tileZoom,i,this._isRaster),this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,i||this._source.fire(new Pn("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const i=e.getExpiryTimeout();i&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),i))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state||"empty"===e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,i){const n=[],s=this.transform;if(!s)return n;const r="globe"===s.projection.name,o=Cu(s.center.lng);for(const a in this._tiles){const h=this._tiles[a];if(i&&h.clearQueryDebugViz(),h.holdingForFade())continue;let c;if(r){const t=h.tileID.canonical;if(0===t.z){const e=[Math.abs(Je(o,...ub(t,-1))-o),Math.abs(Je(o,...ub(t,1))-o)];c=[0,2*e.indexOf(Math.min(...e))-1]}else{const e=[Math.abs(Je(o,...ub(t,-1))-o),Math.abs(Je(o,...ub(t,0))-o),Math.abs(Je(o,...ub(t,1))-o)];c=[e.indexOf(Math.min(...e))-1]}}else c=[0];for(const i of c){const r=t.containsTile(h,s,e,i);r&&n.push(r)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,e){const i=this.getRenderableIds(t,e).map((t=>this._tiles[t].tileID)),n="globe"===this.transform.projection.name;for(const t of i)t.projMatrix=this.transform.calculateProjMatrix(t.toUnwrapped()),t.expandedProjMatrix=n?this.transform.calculateProjMatrix(t.toUnwrapped(),!1,!0):t.projMatrix;return i}sortCoordinatesByDistance(t){const e=t.slice(),i=this.transform._camera.position,n=this.transform._camera.forward(),s={};for(const t of e){const e=1/(1<<t.canonical.z);s[t.key]=((t.canonical.x+.5)*e+t.wrap-i[0])*n[0]+((t.canonical.y+.5)*e-i[1])*n[1]-i[2]*n[2]}return e.sort(((t,e)=>s[t.key]-s[e.key])),e}hasTransition(){if(this._source.hasTransition())return!0;if(cb(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=Ri.now())return!0}return!1}setFeatureState(t,e,i){this._state.updateState(t=t||"_geojsonTileLayer",e,i)}removeFeatureState(t,e,i){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,i)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,i){const n=this._tiles[t];n&&n.setDependencies(e,i)}reloadTilesForDependencies(t,e){for(const i in this._tiles)this._tiles[i].hasDependency(t,e)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(t,e)))}_preloadTiles(t,e){if(!this._sourceLoaded){const i=()=>{this._sourceLoaded&&(this._source.off("data",i),this._preloadTiles(t,e))};return void this._source.on("data",i)}const i=new Map,n=Array.isArray(t)?t:[t],s=this.map.painter.terrain,r=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const t of n){const e=t.coveringTiles({tileSize:r,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const t of e)i.set(t.key,t);this.usedForTerrain&&t.updateElevation(!1)}ti(Array.from(i.values()),((t,e)=>{const i=new ug(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(t=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),e(t,i)}))}),e)}}function hb(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function cb(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function ub(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}ab.maxOverzooming=10,ab.maxUnderzooming=3;const lb=()=>eb||(eb={layout:cm||(cm=new ch({"line-cap":new ah(uh.layout_line["line-cap"]),"line-join":new ah(uh.layout_line["line-join"]),"line-miter-limit":new oh(uh.layout_line["line-miter-limit"]),"line-round-limit":new oh(uh.layout_line["line-round-limit"]),"line-sort-key":new ah(uh.layout_line["line-sort-key"]),"line-z-offset":new ah(uh.layout_line["line-z-offset"]),visibility:new oh(uh.layout_line.visibility)})),paint:um||(um=new ch({"line-opacity":new ah(uh.paint_line["line-opacity"]),"line-color":new ah(uh.paint_line["line-color"]),"line-translate":new oh(uh.paint_line["line-translate"]),"line-translate-anchor":new oh(uh.paint_line["line-translate-anchor"]),"line-width":new ah(uh.paint_line["line-width"]),"line-gap-width":new ah(uh.paint_line["line-gap-width"]),"line-offset":new ah(uh.paint_line["line-offset"]),"line-blur":new ah(uh.paint_line["line-blur"]),"line-dasharray":new ah(uh.paint_line["line-dasharray"]),"line-pattern":new ah(uh.paint_line["line-pattern"]),"line-gradient":new hh(uh.paint_line["line-gradient"]),"line-trim-offset":new oh(uh.paint_line["line-trim-offset"]),"line-trim-fade-range":new oh(uh.paint_line["line-trim-fade-range"]),"line-trim-color":new oh(uh.paint_line["line-trim-color"]),"line-emissive-strength":new oh(uh.paint_line["line-emissive-strength"]),"line-border-width":new ah(uh.paint_line["line-border-width"]),"line-border-color":new ah(uh.paint_line["line-border-color"]),"line-occlusion-opacity":new oh(uh.paint_line["line-occlusion-opacity"])}))},eb);class fb extends ah{possiblyEvaluate(t,e){return e=new Ja(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=ii({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}let db,pb,mb,_b;function vb(t,e){return e>0?e+2*t:t}class gb{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Qn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Oa(gb,"FormatSectionOverride",{omit:["defaultValue"]});const bb=()=>_b||(_b={layout:pb||(pb=new ch({"symbol-placement":new oh(uh.layout_symbol["symbol-placement"]),"symbol-spacing":new oh(uh.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new oh(uh.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ah(uh.layout_symbol["symbol-sort-key"]),"symbol-z-order":new oh(uh.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new oh(uh.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new oh(uh.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new oh(uh.layout_symbol["icon-ignore-placement"]),"icon-optional":new oh(uh.layout_symbol["icon-optional"]),"icon-rotation-alignment":new oh(uh.layout_symbol["icon-rotation-alignment"]),"icon-size":new ah(uh.layout_symbol["icon-size"]),"icon-text-fit":new ah(uh.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ah(uh.layout_symbol["icon-text-fit-padding"]),"icon-image":new ah(uh.layout_symbol["icon-image"]),"icon-rotate":new ah(uh.layout_symbol["icon-rotate"]),"icon-padding":new oh(uh.layout_symbol["icon-padding"]),"icon-keep-upright":new oh(uh.layout_symbol["icon-keep-upright"]),"icon-offset":new ah(uh.layout_symbol["icon-offset"]),"icon-anchor":new ah(uh.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new oh(uh.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new oh(uh.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new oh(uh.layout_symbol["text-rotation-alignment"]),"text-field":new ah(uh.layout_symbol["text-field"]),"text-font":new ah(uh.layout_symbol["text-font"]),"text-size":new ah(uh.layout_symbol["text-size"]),"text-max-width":new ah(uh.layout_symbol["text-max-width"]),"text-line-height":new ah(uh.layout_symbol["text-line-height"]),"text-letter-spacing":new ah(uh.layout_symbol["text-letter-spacing"]),"text-justify":new ah(uh.layout_symbol["text-justify"]),"text-radial-offset":new ah(uh.layout_symbol["text-radial-offset"]),"text-variable-anchor":new oh(uh.layout_symbol["text-variable-anchor"]),"text-anchor":new ah(uh.layout_symbol["text-anchor"]),"text-max-angle":new oh(uh.layout_symbol["text-max-angle"]),"text-writing-mode":new oh(uh.layout_symbol["text-writing-mode"]),"text-rotate":new ah(uh.layout_symbol["text-rotate"]),"text-padding":new oh(uh.layout_symbol["text-padding"]),"text-keep-upright":new oh(uh.layout_symbol["text-keep-upright"]),"text-transform":new ah(uh.layout_symbol["text-transform"]),"text-offset":new ah(uh.layout_symbol["text-offset"]),"text-allow-overlap":new oh(uh.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new oh(uh.layout_symbol["text-ignore-placement"]),"text-optional":new oh(uh.layout_symbol["text-optional"]),visibility:new oh(uh.layout_symbol.visibility)})),paint:mb||(mb=new ch({"icon-opacity":new ah(uh.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ah(uh.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ah(uh.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ah(uh.paint_symbol["text-emissive-strength"]),"icon-color":new ah(uh.paint_symbol["icon-color"]),"icon-halo-color":new ah(uh.paint_symbol["icon-halo-color"]),"icon-halo-width":new ah(uh.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ah(uh.paint_symbol["icon-halo-blur"]),"icon-translate":new oh(uh.paint_symbol["icon-translate"]),"icon-translate-anchor":new oh(uh.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ah(uh.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ah(uh.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ah(uh.paint_symbol["text-occlusion-opacity"]),"text-color":new ah(uh.paint_symbol["text-color"],{runtimeType:ns,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ah(uh.paint_symbol["text-halo-color"]),"text-halo-width":new ah(uh.paint_symbol["text-halo-width"]),"text-halo-blur":new ah(uh.paint_symbol["text-halo-blur"]),"text-translate":new oh(uh.paint_symbol["text-translate"]),"text-translate-anchor":new oh(uh.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new oh(uh.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new oh(uh.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new oh(uh.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new oh(uh.paint_symbol["icon-color-brightness-max"])}))},_b);class wb extends Ih{constructor(e,i,n,s){super(e,bb(),i,n,s),this._colorAdjustmentMatrix=t.ae.identity([]),this.hasInitialOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const t=[];for(const e of i)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,n,s){return this._saturation===e&&this._contrast===i&&this._brightnessMin===n&&this._brightnessMax===s||(this._colorAdjustmentMatrix=function(e,i,n,s){e=ji(e),i=Ci(i);const r=t.ae.create(),o=e/3,a=1-2*o,h=[a,o,o,0,o,a,o,0,o,o,a,0,0,0,0,1],c=.5-.5*i,u=s-n;return t.ae.multiply(r,[u,0,0,0,0,u,0,0,0,0,u,0,n,n,n,1],[i,0,0,0,0,i,0,0,0,0,i,0,c,c,c,1]),t.ae.multiply(r,r,h),r}(e,i,n,s),this._saturation=e,this._contrast=i,this._brightnessMin=n,this._brightnessMax=s),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,e,i,n){const s=this.layout.get(t).evaluate(e,{},i,n),r=this._unevaluatedLayout._values[t];return r.isDataDriven()||da(r.value)||!s?s:function(t,e){return e.replace(/{([^{}]+)}/g,((e,i)=>i in t?String(t[i]):""))}(e.properties,s)}createBucket(t){return new Bv(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of bb().paint.overridableProperties){if(!wb.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),i=new gb(e),n=new fa(i,e.property.specification,this.scope,this.options);let s=null;s="constant"===e.value.kind||"source"===e.value.kind?new ma("source",n):new _a("composite",n,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new sh(e.property,s,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven())&&wb.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const i=t.get("text-field"),n=bb().paint.properties[e];let s=!1;const r=t=>{for(const e of t)if(n.overrides&&n.overrides.hasOverride(e))return void(s=!0)};if("constant"===i.value.kind&&i.value.value instanceof vs)r(i.value.value.sections);else if("source"===i.value.kind){const t=e=>{s||(e instanceof Ms&&ys(e.value)===as?r(e.value.sections):e instanceof As?r(e.sections):e.eachChild(t))},e=i.value;e._styleExpression&&t(e._styleExpression.expression)}return s}getProgramIds(){const t=0!==this.paint.get("icon-opacity").constantOr(1),e=0!==this.paint.get("text-opacity").constantOr(1),i=[];return t&&i.push("symbolIcon"),e&&i.push("symbolSDF"),i}getDefaultProgramParams(t,e,i){return{config:new tu(this,{zoom:e,lut:i}),overrideFog:!1}}}let yb,xb,Mb,Tb;function Ob(e,i,n,s,r,o,a,h){const c=[e,i,1,n,s,1,r,o,1],u=[a,h,1],l=t.bE.adjoint([],c),[f,d,p]=t.$.transformMat3(u,u,l);return t.bE.multiply(c,c,[f,0,0,0,d,0,0,0,p])}function Eb(e,i,n,s,r,o,a,h){const c=function(e,i,n,s,r,o,a,h){const c=Ob(0,0,1,0,1,1,0,1),u=Ob(e,i,n,s,r,o,a,h),l=t.bE.adjoint([],c);return t.bE.multiply(u,u,l)}(e,i,n,s,r,o,a,h);return[c[2]/c[8]/pr,c[5]/c[8]/pr]}function Ab(t){return[t[0],Math.min(Math.max(t[1],-Fu),Fu)]}class Sb extends Ln{constructor(t,e,i,n){super(),this.id=t,this.dispatcher=i,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=e,this._dirty=!1}load(t,e){if(this._loaded=e||!1,this.fire(new Pn("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=cn(this.map._requestManager.transformRequest(this.url,Qi.Image),((e,i)=>{this._imageRequest=null,this._loaded=!0,e?this.fire(new Nn(e)):i&&(this.image=i instanceof HTMLImageElement?Ri.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Hv(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Pn("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Hv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let e=t[0][1],i=t[0][1];for(const n of t)n[1]>i&&(i=n[1]),n[1]<e&&(e=n[1]);const n=(i+e)/2;if(n>Fu?this.onNorthPole=!0:n<-Fu&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const e=t.map(Bu.fromLngLat);this.tileID=function(t){let e=1/0,i=1/0,n=-1/0,s=-1/0;for(const r of t)e=Math.min(e,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),s=Math.max(s,r.y);const r=Math.max(n-e,s-i),o=Math.max(0,Math.floor(-Math.log(r)/Math.LN2)),a=Math.pow(2,o);let h=Math.floor((e+n)/2*a);return h>1&&(h-=1),new Mu(o,h,Math.floor((i+s)/2*a))}(e),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Pn("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=uv(new Mu(0,0,0),this.map.transform.projection),n=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(t){const e=t[1].x-t[0].x,i=t[1].y-t[0].y,n=t[2].x-t[1].x,s=t[2].y-t[1].y,r=t[3].x-t[2].x,o=t[3].y-t[2].y,a=t[0].x-t[3].x,h=t[0].y-t[3].y,c=e*s-n*i,u=n*o-r*s,l=r*h-a*o,f=a*i-e*h;return c>0&&u>0&&l>0&&f>0||c<0&&u<0&&l<0&&f<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const s=uv(this.tileID,this.map.transform.projection),[r,o,a,h]=this.coordinates.map((t=>{const e=s.projection.project(t[0],t[1]);return lv(s,e)._round()}));this.perspectiveTransform=Eb(r.x,r.y,o.x,o.y,a.x,a.y,h.x,h.y);const c=this._boundsArray=new zh;c.emplaceBack(r.x,r.y,0,0),c.emplaceBack(o.x,o.y,pr,0),c.emplaceBack(h.x,h.y,0,pr),c.emplaceBack(a.x,a.y,pr,pr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(c,Kv.members),this.boundsSegments=Sc.simpleSegment(0,0,4,2);const u=[],l=function(t){return[Ab(t[0]),Ab(t[1]),Ab(t[2]),Ab(t[3])]}(this.coordinates),[f,d,p,m]=function(t){let e=t[0][0],i=e,n=t[0][1],s=n;for(let r=1;r<t.length;r++)t[r][0]<e?e=t[r][0]:t[r][0]>i&&(i=t[r][0]),t[r][1]<n?n=t[r][1]:t[r][1]>s&&(s=t[r][1]);return[e,n,i-e,s-n]}(l);{const s=new zh,[r,o,a,h]=function(t){let e=t[0].x,i=e,n=t[0].y,s=n;for(let r=1;r<t.length;r++)t[r].x<e?e=t[r].x:t[r].x>i&&(i=t[r].x),t[r].y<n?n=t[r].y:t[r].y>s&&(s=t[r].y);return[e,n,i-e,s-n]}(n),c=t=>[(t.x-r)/a,(t.y-o)/h],[l,_,v,g]=n.map(c),b=function(e,i,n,s,r,o,a,h){const c=Ob(0,0,1,0,1,1,0,1),u=Ob(e,i,n,s,r,o,a,h),l=t.bE.adjoint([],u);return t.bE.multiply(c,c,l)}(l[0],l[1],_[0],_[1],v[0],v[1],g[0],g[1]);this.elevatedGlobePerspectiveTransform=Eb(l[0],l[1],_[0],_[1],v[0],v[1],g[0],g[1]);const w=(e,i)=>{u.push(e.lng);const n=Math.round((e.lng-f)/p*pr),r=Math.round((e.lat-d)/m*pr),o=c(i),a=t.$.transformMat3([],[o[0],o[1],1],b),h=Math.round(a[0]/a[2]*pr),l=Math.round(a[1]/a[2]*pr);s.emplaceBack(n,r,h,l)},y=n[3].x-n[0].x,x=n[3].y-n[0].y,M=n[2].x-n[1].x,T=n[2].y-n[1].y;for(let t=0;t<65;t++){const e=t/64,s=[n[0].x+e*y,n[0].y+e*x],r=[n[1].x+e*M,n[1].y+e*T],o=r[0]-s[0],a=r[1]-s[1];for(let t=0;t<65;t++){const e=t/64,n={x:s[0]+o*e,y:s[1]+a*e,z:0};w(i.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(s,Kv.members)}{this.maxLongitudeTriangleSize=0;let t=[],i=new tc;const n=(e,n,s)=>{i.emplaceBack(e,n,s);const r=u[e],o=u[n],a=u[s],h=Math.min(Math.min(r,o),a),c=Math.max(Math.max(r,o),a)-h;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(h+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const i=65*t+e,s=i+1,r=i+65,o=r+1;n(i,r,s),n(s,r,o)}[t,i]=function(t,e){const i=Array.from({length:t.length},((t,e)=>e));i.sort(((e,i)=>t[e]-t[i]));const n=[],s=new tc;for(let r=0;r<i.length;r++){const o=i[r];n.push(t[o]);const a=3*o,h=a+1;s.emplaceBack(e.uint16[a],e.uint16[h],e.uint16[h+1])}return[n,s]}(t,i),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(i)}this.elevatedGlobeSegments=Sc.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,p/pr,0,m/pr,0,0,d,f,0])}prepare(){const t=0!==Object.keys(this.tiles).length;if(this.tileID&&!t)return;const e=this.map.painter.context,i=e.gl;!this._dirty||this.texture instanceof Hv||(this.texture?this.texture.update(this.image):(this.texture=new Gv(e,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const e=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!e)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let n=(s=t+180)+360*Math.round((i[0]-s)/360);var s;const r=new Sc,o=(t,i)=>{r.segments.push({vertexOffset:0,primitiveOffset:t,vertexLength:e.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-n)<=a){const t=Ii(i,0,i.length,n+a);return t===i.length||o(t,ki(i,t+1,i.length,n+360-a)-t),r}n<i[0]&&(n+=360);const h=ki(i,0,i.length,n-a);if(h===i.length)return o(0,i.length),r;o(0,h-0);const c=Ii(i,h+1,i.length,n+a);return c!==i.length&&o(c,i.length-c),r}}const kb=(Math.pow(256,2)-1)/16907520;class Ib extends Ih{constructor(t,e,i,n){super(t,{layout:Mb||(Mb=new ch({visibility:new oh(uh.layout_raster.visibility)})),paint:Tb||(Tb=new ch({"raster-opacity":new oh(uh.paint_raster["raster-opacity"]),"raster-color":new hh(uh.paint_raster["raster-color"]),"raster-color-mix":new oh(uh.paint_raster["raster-color-mix"]),"raster-color-range":new oh(uh.paint_raster["raster-color-range"]),"raster-hue-rotate":new oh(uh.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new oh(uh.paint_raster["raster-brightness-min"]),"raster-brightness-max":new oh(uh.paint_raster["raster-brightness-max"]),"raster-saturation":new oh(uh.paint_raster["raster-saturation"]),"raster-contrast":new oh(uh.paint_raster["raster-contrast"]),"raster-resampling":new oh(uh.paint_raster["raster-resampling"]),"raster-fade-duration":new oh(uh.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new oh(uh.paint_raster["raster-emissive-strength"]),"raster-array-band":new oh(uh.paint_raster["raster-array-band"]),"raster-elevation":new oh(uh.paint_raster["raster-elevation"])}))},e,i,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof Sb&&(t._source.onNorthPole||t._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(t){"raster-color"!==t&&"raster-color-range"!==t||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap())return;if(!this._curRampRange)return;const e=this._transitionablePaint._values["raster-color"].value.expression,[i,n]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(n)||i===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=Tf({expression:e,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,n])}}let Cb,jb,Db,Rb,Pb;class Nb extends Ih{constructor(t,e,i,n){super(t,{layout:Cb||(Cb=new ch({visibility:new oh(uh["layout_raster-particle"].visibility)})),paint:jb||(jb=new ch({"raster-particle-array-band":new oh(uh["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new oh(uh["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new hh(uh["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new oh(uh["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new oh(uh["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new oh(uh["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new oh(uh["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new oh(uh["paint_raster-particle"]["raster-particle-elevation"])}))},e,i,n),this._updateColorRamp(),this.lastInvalidatedAt=Ri.now()}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){"raster-particle-color"!==t&&"raster-particle-max-speed"!==t||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===t&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,e=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Tf({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:e}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ri.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Fb extends Ih{constructor(t,e){super(t,{},e,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(t){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function zb(e,i,n){const s=[0,0,1],r=t.aw.identity([]);return t.aw.rotateY(r,r,n?-Ve(e)+Math.PI:Ve(e)),t.aw.rotateX(r,r,-Ve(i)),t.$.transformQuat(s,s,r),t.$.normalize(s,s)}function Lb(e,i){const n=Ub(e.projection,e.zoom,e.width,e.height),s=function(e,i,n,s,r){const o=new bu(n.lng-180*Bb,n.lat),a=new bu(n.lng+180*Bb,n.lat),h=e.project(o.lng,o.lat),c=e.project(a.lng,a.lat),u=-Math.atan2(c.y-h.y,c.x-h.x),l=Bu.fromLngLat(n);l.y=Je(l.y,-1+Bb,1-Bb);const f=l.toLngLat(),d=e.project(f.lng,f.lat),p=Bu.fromLngLat(f);p.x+=Bb;const m=p.toLngLat(),_=e.project(m.lng,m.lat),v=Hb(_.x-d.x,_.y-d.y,u),g=Bu.fromLngLat(f);g.y+=Bb;const b=g.toLngLat(),w=e.project(b.lng,b.lat),y=Hb(w.x-d.x,w.y-d.y,u),x=Math.abs(v.x)/Math.abs(y.y),M=t.ae.identity([]);t.ae.rotateZ(M,M,-u*(1-(r?0:s)));const T=t.ae.identity([]);return t.ae.scale(T,T,[1,1-(1-x)*s,1]),T[4]=-y.x/y.y*s,t.ae.rotateZ(T,T,u),t.ae.multiply(T,M,T),T}(e.projection,0,e.center,n,i),r=$b(e);return t.ae.scale(s,s,[r,r,1]),s}function $b(t){const e=t.projection,i=Ub(t.projection,t.zoom,t.width,t.height),n=Gb(e,t.center),s=Gb(e,bu.convert(e.center));return Math.pow(2,n*i+(1-i)*s)}function Ub(t,e,i,n,s=1/0){const r=t.range;if(!r)return 0;const o=Math.min(s,Math.max(i,n)),a=Math.log(o/1024)/Math.LN2;return Ke(r[0]+a,r[1]+a,e)}const Bb=1/4e4;function Gb(t,e){const i=Je(e.lat,-Fu,Fu),n=new bu(e.lng-180*Bb,i),s=new bu(e.lng+180*Bb,i),r=t.project(n.lng,i),o=t.project(s.lng,i),a=Bu.fromLngLat(n),h=Bu.fromLngLat(s),c=o.x-r.x,u=o.y-r.y,l=h.x-a.x,f=h.y-a.y,d=Math.sqrt((l*l+f*f)/(c*c+u*u));return Math.log(d)/Math.LN2}function Hb(t,e,i){const n=Math.cos(i),s=Math.sin(i);return{x:t*n-e*s,y:t*s+e*n}}function Vb(e,i,n){t.ae.identity(e),t.ae.rotateZ(e,e,Ve(i[2])),t.ae.rotateX(e,e,Ve(i[0])),t.ae.rotateY(e,e,Ve(i[1])),t.ae.scale(e,e,n),t.ae.multiply(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Wb(e,i,n,s,r,o,a,h){const c=[n[0]-i[0],n[1]-i[1],0],u=[s[0]-i[0],s[1]-i[1],0];if(t.$.length(c)<1e-12||t.$.length(u)<1e-12)return t.aw.identity(e);const l=t.$.cross([],c,u);t.$.normalize(l,l),t.$.subtract(u,s,i),c[2]=(o-r)*h,u[2]=(a-r)*h;const f=c;return t.$.cross(f,c,u),t.$.normalize(f,f),t.aw.rotationTo(e,l,f)}function qb(e,i,n=!1){const s=Ql(i.zoom),r=function(e,i,n){const s=i.worldSize,r=[e[12],e[13],e[14]],o=Pu(r[1]/s),a=Ru(r[0]/s),h=t.ae.identity([]),c=Du(1,o)*s,u=Du(1,0)*s*Lu(o,i.zoom),l=1/Zl(s);let f=u*l;if(n){const t=Ub(i.projection,i.zoom,i.width,i.height,1024);f=l*i.projection.pixelSpaceConversion(i.center.lat,s,t)}const d=_u(o,a);t.$.add(d,d,t.$.scale([],t.$.normalize([],d),c*f*r[2]));const p=function(e){const i=[e[0],e[1],e[2]];let n=[0,1,0];const s=t.$.cross([],n,i);return t.$.cross(n,i,s),0===t.$.squaredLength(n)&&(n=[0,1,0],t.$.cross(s,i,n)),t.$.normalize(s,s),t.$.normalize(n,n),t.$.normalize(i,i),[s[0],s[1],s[2],0,n[0],n[1],n[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],1]}(d);t.ae.scale(h,h,[f,f,f*c]),t.ae.translate(h,h,[-r[0],-r[1],-r[2]]);const m=t.ae.multiply([],i.globeMatrix,p);return t.ae.multiply(m,m,h),t.ae.multiply(m,m,e),m}(e,i,n);if(s>0){const n=function(e,i){const n=i.worldSize,s=Du(1,0)*n*Lu(i.center.lat,i.zoom)/Zl(n),r=Du(1,i.center.lat)*n,o=t.ae.identity([]);return t.ae.rotateY(o,o,Ve(i.center.lng)),t.ae.rotateX(o,o,Ve(i.center.lat)),t.ae.translate(o,o,[0,0,au]),t.ae.scale(o,o,[s,s,s*r]),t.ae.translate(o,o,[i.point.x-.5*n,i.point.y-.5*n,0]),t.ae.multiply(o,o,e),t.ae.multiply(o,i.globeMatrix,o)}(e,i);return function(e,i,n){const s=(e,i,n)=>{const s=t.$.length(e),r=t.$.length(i),o=Ll(e,i,n);return t.$.scale(o,o,1/t.$.length(o)*qn(s,r,n))},r=s([e[0],e[1],e[2]],[i[0],i[1],i[2]],n),o=s([e[4],e[5],e[6]],[i[4],i[5],i[6]],n),a=s([e[8],e[9],e[10]],[i[8],i[9],i[10]],n),h=Ll([e[12],e[13],e[14]],[i[12],i[13],i[14]],n);return[r[0],r[1],r[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],0,h[0],h[1],h[2],1]}(r,n,s)}return r}function Yb(t,e,i,n){const s=Sl.projectAabbCorners(n,i);let r=Number.MAX_VALUE,o=-1;for(let t=0;t<s.length;++t){const i=s[t];i[0]=(.5*i[0]+.5)*e.width,i[1]=(.5-.5*i[1])*e.height,i[2]<r&&(o=t,r=i[2])}const a=t=>new Ue(s[t][0],s[t][1]);let h;switch(o){case 0:case 6:h=[a(1),a(5),a(4),a(7),a(3),a(2),a(1)];break;case 1:case 7:h=[a(0),a(4),a(5),a(6),a(2),a(3),a(0)];break;case 3:case 5:h=[a(1),a(0),a(4),a(7),a(6),a(2),a(1)];break;default:h=[a(1),a(5),a(6),a(7),a(3),a(0),a(1)]}if(el(t,h))return r}const Xb=Rh([{name:"a_pos_3f",components:3,type:"Float32"}]),Zb=Rh([{name:"a_color_3f",components:3,type:"Float32"}]),Jb=Rh([{name:"a_color_4f",components:4,type:"Float32"}]),Kb=Rh([{name:"a_uv_2f",components:2,type:"Float32"}]),Qb=Rh([{name:"a_normal_3f",components:3,type:"Float32"}]),tw=Rh([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ew=Rh([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class iw{constructor(t,e,i,n){this.message=(t?`${t}: `:"")+i,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)}}function nw(t,e){const i=-1===t.indexOf("://");try{return new URL(t,i&&e?"http://example.com":void 0),!0}catch(t){return!1}}class sw{constructor(t,e){this.feature=t,this.instancedDataOffset=e,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class rw{constructor(){this.instancedDataArray=new cc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ow{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((t=>t.fqid)),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((t=>t.isStateDependent())).map((t=>t.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(t,e){}populate(t,e,i,n){this.tileToMeter=Uu(i);const s=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:r,id:o,index:a,sourceLayerIndex:h}of t){const t=null!=o?o:r.properties&&r.properties.hasOwnProperty("id")?r.properties.id:void 0,c=Ju(r,s);if(!this.layers[0]._featureFilter.filter(new Ja(this.zoom),c,i))continue;const u={id:t,sourceLayerIndex:h,index:a,geometry:s?c.geometry:Zu(r,i,n),properties:r.properties,type:r.type,patterns:{}},l=this.addFeature(u,u.geometry,c);l&&e.featureIndex.insert(r,u.geometry,a,h,this.index,this.instancesPerModel[l].instancedDataArray.length,pr/32)}this.lookup=null}update(t,e,i,n){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];for(const e in t)i.idToFeaturesIndex.hasOwnProperty(e)&&(this.evaluate(i.features[i.idToFeaturesIndex[e]],t[e],i,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];for(const i of n.features){const s=this.layers[0],r=i.feature,o=this.canonical,a=s.paint.get("model-rotation").evaluate(r,{},o),h=s.paint.get("model-scale").evaluate(r,{},o),c=s.paint.get("model-translation").evaluate(r,{},o);t.$.exactEquals(i.rotation,a)&&t.$.exactEquals(i.scale,h)&&t.$.exactEquals(i.translation,c)||(this.evaluate(i,i.featureStates,n,!0),e=!0)}}return e}updateReplacement(t,e,i,n){if(e.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=e.updateTime;const s=e.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(Ud(this.activeReplacements,s))return!1;this.activeReplacements=s;let r=!1;for(const e in this.instancesPerModel){const s=this.instancesPerModel[e],o=s.instancedDataArray;for(const e of s.features){const s=e.instancedDataOffset,a=e.instancedDataCount;for(let e=0;e<a;e++){const a=16*(e+s);let h=o.float32[a+0];h=h>pr?h-pr:h;const c=Math.floor(h),u=o.float32[a+1];let l=!1;for(const e of this.activeReplacements)if(!Fd(e,i,ap.Model,n)&&!(e.min.x>c||c>e.max.x||e.min.y>u||u>e.max.y)&&(l=qd(Wd(c,u,t.canonical,e.footprintTileId.canonical),e),l))break;o.float32[a]=l?h+pr:h,r=r||l}}}return r}isEmpty(){for(const t in this.instancesPerModel)if(0!==this.instancesPerModel[t].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=t.createVertexBuffer(i.instancedDataArray,tw.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris)for(const e of this.modelUris)t.removeModel(e,"")}addFeature(t,e,i){const n=this.layers[0],s=n.layout.get("model-id").evaluate(i,{},this.canonical);if(!s)return pi(`modelId is not evaluated for layer ${n.id} and it is not going to get rendered.`),s;nw(s,!1)&&(this.modelUris.includes(s)||this.modelUris.push(s)),this.instancesPerModel[s]||(this.instancesPerModel[s]=new rw);const r=this.instancesPerModel[s],o=r.instancedDataArray,a=new sw(i,o.length);for(const t of e)for(const e of t){if(e.x<0||e.x>=pr||e.y<0||e.y>=pr)continue;const t=(this.lookupDim-1)/pr,i=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const n=o.length;o.resize(n+1),r.instancesEvaluatedElevation.push(0),o.float32[16*n]=e.x,o.float32[16*n+1]=e.y}return a.instancedDataCount=r.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(t.id&&(r.idToFeaturesIndex[t.id]=r.features.length),r.features.push(a),this.evaluate(a,{},r,!1)),s}getModelUris(){return this.modelUris}evaluate(t,e,i,n){const s=this.layers[0],r=t.feature,o=this.canonical,a=t.rotation=s.paint.get("model-rotation").evaluate(r,e,o),h=t.scale=s.paint.get("model-scale").evaluate(r,e,o),c=t.translation=s.paint.get("model-translation").evaluate(r,e,o),u=s.paint.get("model-color").evaluate(r,e,o);u.a=s.paint.get("model-color-mix-intensity").evaluate(r,e,o);const l=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,h[0]),Math.max(h[1],h[2])),Vb(l,a,h);const f=Math.round(100*u.a)+u.b/1.05;for(let e=0;e<t.instancedDataCount;++e){const s=t.instancedDataOffset+e,r=16*s,a=i.instancedDataArray.float32;let h=0;n&&(h=a[r+6]-i.instancesEvaluatedElevation[s]);const d=0|a[r+1];a[r]=(0|a[r])+u.r/1.05,a[r+1]=d+u.g/1.05,a[r+2]=f,a[r+3]=1/(o.z>10?this.tileToMeter:Uu(o,d)),a[r+4]=c[0],a[r+5]=c[1],a[r+6]=c[2]+h,a[r+7]=l[0],a[r+8]=l[1],a[r+9]=l[2],a[r+10]=l[4],a[r+11]=l[5],a[r+12]=l[6],a[r+13]=l[8],a[r+14]=l[9],a[r+15]=l[10],i.instancesEvaluatedElevation[s]=c[2]}}}let aw,hw;Oa(ow,"ModelBucket",{omit:["layers"]}),Oa(rw,"PerModelAttributes"),Oa(sw,"ModelFeature");const cw=64,uw={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function lw(e,i,n,s,r,o,a,h,c,u=!1){const l=n.zoom,f=n.project(s),d=Lu(s.lat,l),p=1/d;t.ae.identity(e),t.ae.translate(e,e,[f.x+a[0]*p,f.y+a[1]*p,a[2]]);let m=1,_=1;const v=n.worldSize;if(u){if("mercator"===n.projection.name){let e=0;n.elevation&&(e=n.elevation.getAtPointOrZero(new Bu(f.x/v,f.y/v),0));const i=t.aB.transformMat4([],[f.x,f.y,e,1],n.projMatrix)[3]/n.cameraToCenterDistance;m=i,_=i*Lu(n.center.lat,l)}else if("globe"===n.projection.name){const i=qb(e,n),r=t.ae.multiply([],n.projMatrix,i),o=[0,0,0,1];t.aB.transformMat4(o,o,r);const a=o[3]/n.cameraToCenterDistance,h=Ql(l),c=n.projection.pixelsPerMeter(s.lat,v)*Lu(s.lat,l),u=n.projection.pixelsPerMeter(n.center.lat,v)*Lu(n.center.lat,l);m=a/qn(c,zu(n.center.lat),h),_=a*d/c,m*=u,_*=u}}else m=p;t.ae.scale(e,e,[m,m,_]);const g=[...e],b=i.orientation,w=[];if(Vb(w,[b[0]+r[0],b[1]+r[1],b[2]+r[2]],o),t.ae.multiply(e,g,w),h&&n.elevation){let r=0;const o=[];if(c&&n.elevation){r=function(e,i,n,s,r){const o=i.elevation;if(!o)return 0;const a=Sl.projectAabbCorners(n,s),h=Du(1,r.lat)*i.worldSize,c=function(e,i){const n=[0,0,1],s=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const r of s){const s=e[r.corners[0]],o=e[r.corners[1]],a=e[r.corners[2]],h=[o[0]-s[0],o[1]-s[1],i*(o[2]-s[2])],c=t.$.cross(h,h,[a[0]-s[0],a[1]-s[1],i*(a[2]-s[2])]);t.$.normalize(c,c),r.dotProductWithUp=t.$.dot(c,n)}return s.sort(((t,e)=>t.dotProductWithUp-e.dotProductWithUp)),s[0].corners}(a,h),u=a[c[0]],l=a[c[1]],f=a[c[2]],d=a[c[3]],p=o.getAtPointOrZero(new Bu(u[0]/i.worldSize,u[1]/i.worldSize),0),m=o.getAtPointOrZero(new Bu(l[0]/i.worldSize,l[1]/i.worldSize),0),_=o.getAtPointOrZero(new Bu(f[0]/i.worldSize,f[1]/i.worldSize),0),v=o.getAtPointOrZero(new Bu(d[0]/i.worldSize,d[1]/i.worldSize),0),g=(p+v)/2,b=(m+_)/2;return g>b?m<_?Wb(e,l,d,u,m,v,p,h):Wb(e,f,u,d,_,p,v,h):p<v?Wb(e,u,l,f,p,m,_,h):Wb(e,d,f,l,v,_,m,h),Math.max(g,b)}(o,n,i.aabb,e,s);const a=t.ae.fromQuat([],o),h=t.ae.multiply([],a,w);t.ae.multiply(e,g,h)}else r=n.elevation.getAtPointOrZero(new Bu(f.x/v,f.y/v),0);0!==r&&(e[14]+=r)}}function fw(t,e,i=!1){t.uploaded||(t.gfxTexture=new Gv(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function dw(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,Xb.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,Qb.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,Kb.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(12===t.colorArray.bytesPerElement?Zb:Jb).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,ew.members,!0)),t.segments=Sc.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&fw(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&fw(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&fw(n.normalTexture,e),n.occlusionTexture&&fw(n.occlusionTexture,e,i),n.emissionTexture&&fw(n.emissionTexture,e)}function pw(t,e,i){if(t.meshes)for(const n of t.meshes)dw(n,e,i);if(t.children)for(const n of t.children)pw(n,e,i)}function mw(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)mw(e)}function _w(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const e of t.children)_w(e)}class vw{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class gw{constructor(){this.tasks={},this.taskQueue=[],hi(["process"],this),this.invoker=new vw(this.process),this.nextId=0}add(t,e){const i=this.nextId++,n=function({type:t,isSymbolTile:e,zoom:i}){return i=i||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-i:"maybePrepare"===t&&e?400-i:500:200-i:100-i}(e);if(0===n){try{t()}finally{}return null}return this.tasks[i]={fn:t,metadata:e,priority:n,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((t=>!!this.tasks[t])),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let i=0;i<this.taskQueue.length;i++){const n=this.tasks[this.taskQueue[i]];n.priority<e&&(e=n.priority,t=i)}if(null===t)return null;const i=this.taskQueue[t];return this.taskQueue.splice(t,1),i}remove(){this.invoker.remove()}}class bw{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},hi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new gw}send(t,e,i,n,s=!1,r){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=r,this.callbacks[o]=i);const a=new Set;return this.target.postMessage({id:o,type:t,hasCallback:!!i,targetMapId:n,mustQueue:s,sourceMapId:this.mapId,data:Sa(e,a)},a),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[i];delete this.cancelCallbacks[i],t&&t.cancel()}else if(e.mustQueue||gi()){const t=this.callbacks[i],n=this.scheduler.add((()=>this.processTask(i,e)),t&&t.metadata||{type:"message"});n&&(this.cancelCallbacks[i]=n)}else this.processTask(i,e)}processTask(t,e){if(delete this.cancelCallbacks[t],"<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(ka(e.error)):i(null,ka(e.data)))}else{const i=new Set,n=e.hasCallback?(e,n)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?Sa(e):null,data:Sa(n,i)},i)}:t=>{},s=ka(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,s,n);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],s.source,s.scope)[t[1]](s,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class ww{constructor(t,e){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=si();const i=this.workerPool.acquire(this.id);for(let t=0;t<i.length;t++){const n=new ww.Actor(i[t],e,this.id);n.name=`Worker ${t}`,this.actors.push(n)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,e,i){ti(this.actors,((i,n)=>{i.send(t,e,n)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}ww.Actor=bw;var yw={workerUrl:"",workerClass:null,workerParams:void 0};function xw(){return null!=yw.workerClass?new yw.workerClass:new self.Worker(yw.workerUrl,yw.workerParams)}const Mw="mapboxgl_preloaded_worker_pool";class Tw{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Tw.workerCount;)this.workers.push(new xw);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&0===this.numActive()&&(this.workers.forEach((t=>{t.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Mw]}numActive(){return Object.keys(this.active).length}}let Ow;function Ew(){return Ow||(Ow=new Tw),Ow}Tw.workerCount=2;let Aw,Sw,kw,Iw,Cw,jw=null;function Dw(){return gi()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Sw||n.DRACO_URL}function Rw(){if(gi()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Iw)return Iw;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Iw=WebAssembly.validate(t)?n.MESHOPT_SIMD_URL:n.MESHOPT_URL,Iw}const Pw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Nw={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Fw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function zw(t,e,i){const n=i.json.bufferViews.length,s=i.buffers.length;e.bufferView=n,i.json.bufferViews[n]={buffer:s,byteLength:t.byteLength},i.buffers[s]=t}const Lw="KHR_draco_mesh_compression";function $w(t,e){const i=t.extensions&&t.extensions[Lw];if(!i)return;const n=new kw.Decoder,s=qw(e,i.bufferView),r=new kw.Mesh;if(!n.DecodeArrayToMesh(s,s.byteLength,r))throw new Error("Failed to decode Draco mesh");const o=e.json.accessors[t.indices],a=Pw[o.componentType],h=o.count*a.BYTES_PER_ELEMENT,c=kw._malloc(h);a===Uint16Array?n.GetTrianglesUInt16Array(r,h,c):n.GetTrianglesUInt32Array(r,h,c),zw(kw.memory.buffer.slice(c,c+h),o,e),kw._free(c);for(const s of Object.keys(i.attributes)){const o=n.GetAttributeByUniqueId(r,i.attributes[s]),a=e.json.accessors[t.attributes[s]],h=Nw[a.componentType],c=a.count*Fw[a.type]*Pw[a.componentType].BYTES_PER_ELEMENT,u=kw._malloc(c);n.GetAttributeDataArrayForAllPoints(r,o,kw[h],c,u),zw(kw.memory.buffer.slice(u,u+c),a,e),kw._free(u)}n.destroy(),r.destroy(),delete t.extensions[Lw]}const Uw="EXT_meshopt_compression";function Bw(t,e){if(!t.extensions||!t.extensions[Uw])return;const i=t.extensions[Uw],n=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),s=new Uint8Array(i.count*i.byteStride);Cw.decodeGltfBuffer(s,i.count,i.byteStride,n,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=s.buffer,delete t.extensions[Uw]}const Gw=1179937895,Hw=new TextDecoder("utf8");function Vw(t,e){return new URL(t,e).href}function Ww(t,e,i,n){return fetch(Vw(t.uri,n)).then((t=>t.arrayBuffer())).then((t=>{e.buffers[i]=t}))}function qw(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Yw(t,e,i,n){if(t.uri){const s=Vw(t.uri,n);return fetch(s).then((t=>t.blob())).then((t=>createImageBitmap(t))).then((t=>{e.images[i]=t}))}if(void 0!==t.bufferView){const n=qw(e,t.bufferView),s=new Blob([n],{type:t.mimeType});return createImageBitmap(s).then((t=>{e.images[i]=t}))}}function Xw(t,e=0,i){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===Gw){const i=new Uint32Array(t,e);let s=2;const r=(i[s++]>>2)-3,o=i[s++]>>2;if(s++,n.json=JSON.parse(Hw.decode(i.subarray(s,s+o))),s+=o,s<r){const r=i[s++];s++;const o=e+(s<<2);n.buffers[0]=t.slice(o,o+r)}}else n.json=JSON.parse(Hw.decode(new Uint8Array(t,e)));const{buffers:s,images:r,meshes:o,extensionsUsed:a,bufferViews:h}=n.json;let c=Promise.resolve();if(s){const t=[];for(let e=0;e<s.length;e++){const r=s[e];r.uri?t.push(Ww(r,n,e,i)):n.buffers[e]||(n.buffers[e]=null)}c=Promise.all(t)}return c.then((()=>{const t=[],e=a&&a.includes(Lw),s=a&&a.includes(Uw);if(e&&t.push(function(){if(!kw)return Aw||(Aw=function(t){let e,i=null;function n(){e=new Uint8Array(i.buffer)}function s(){throw new Error("Unexpected Draco error.")}const r={a:{a:s,d:function(t,i,n){return e.copyWithin(t,i,i+n)},c:function(t){const s=e.length,r=Math.max(t>>>0,Math.ceil(1.2*s)),o=Math.ceil((r-s)/65536);try{return i.grow(o),n(),!0}catch(t){return!1}},b:s}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(t,r):t.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,r)))).then((t=>{const{Rb:s,Qb:r,P:o,T:a,X:h,Ja:c,La:u,Qa:l,Va:f,Wa:d,eb:p,jb:m,f:_,e:v,yb:g,zb:b,Ab:w,Bb:y,Db:x,Gb:M}=t.instance.exports;i=v;const T=(()=>{let t=0,i=0,n=0,o=0;return a=>{n&&(s(o),s(t),i+=n,n=t=0),t||(i+=128,t=r(i));const h=a.length+7&-8;let c=t;h>=i&&(n=h,c=o=r(h));for(let t=0;t<a.length;t++)e[c+t]=a[t];return c}})();return n(),_(),{memory:v,_free:s,_malloc:r,Mesh:class{constructor(){this.ptr=o()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(t,e,i){const n=T(t),s=u(this.ptr,n,e,i.ptr);return!!h(s)}GetAttributeByUniqueId(t,e){return{ptr:l(this.ptr,t.ptr,e)}}GetTrianglesUInt16Array(t,e,i){f(this.ptr,t.ptr,e,i)}GetTrianglesUInt32Array(t,e,i){d(this.ptr,t.ptr,e,i)}GetAttributeDataArrayForAllPoints(t,e,i,n,s){p(this.ptr,t.ptr,e.ptr,i,n,s)}},DT_INT8:g(),DT_UINT8:b(),DT_INT16:w(),DT_UINT16:y(),DT_UINT32:x(),DT_FLOAT32:M()}}))}(fetch(Dw())),Aw.then((t=>{kw=t,Aw=void 0})))}()),s&&t.push(function(){if(Cw)return;const t=function(t){let e;const i=WebAssembly.instantiateStreaming(t,{}).then((t=>{e=t.instance,e.exports.__wasm_call_ctors()})),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},s={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(t,i,r,o,a,h){!function(t,e,i,n,s,r,o){const a=t.exports.sbrk,h=n+3&-4,c=a(h*s),u=a(r.length),l=new Uint8Array(t.exports.memory.buffer);l.set(r,u);const f=e(c,n,s,u,r.length);if(0===f&&o&&o(c,h,s),i.set(l.subarray(c,c+n*s)),a(c-a(0)),0!==f)throw new Error(`Malformed buffer data: ${f}`)}(e,e.exports[s[a]],t,i,r,o,e.exports[n[h]])}}}(fetch(Rw()));return t.ready.then((()=>{Cw=t}))}()),r)for(let e=0;e<r.length;e++)t.push(Yw(r[e],n,e,i));return(t.length?Promise.all(t):Promise.resolve()).then((()=>{if(e&&o)for(const{primitives:t}of o)for(const e of t)$w(e,n);if(s&&o&&h)for(const t of h)Bw(t,n);return n}))}))}function Zw(t,e){const i=t.json.bufferViews[e.bufferView],n=Pw[e.componentType];return new n(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Fw[e.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:Fw[e.type]))}function Jw(t,e,i,n){const s=Pw[e.componentType],r=function(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(s),o=t.json.bufferViews[e.bufferView],a=o.byteStride?o.byteStride/s.BYTES_PER_ELEMENT:Fw[e.type],h=i.float32,c=h.length/i.capacity;for(let t=0,i=0;t<e.count*a;t+=a,i+=c)for(let e=0;e<c;e++)h[i+e]=n[t+e]*r;i._trim()}function Kw(t,e,i){const n=t.indices,s=t.attributes,r={};r.indexArray=new tc;const o=e.json.accessors[n],a=o.count/3;r.indexArray.reserve(a);const h=Zw(e,o);for(let t=0;t<a;t++)r.indexArray.emplaceBack(h[3*t],h[3*t+1],h[3*t+2]);r.indexArray._trim(),r.vertexArray=new Bh;const c=e.json.accessors[s.POSITION];r.vertexArray.reserve(c.count);const u=Zw(e,c);for(let t=0;t<c.count;t++)r.vertexArray.emplaceBack(u[3*t],u[3*t+1],u[3*t+2]);if(r.vertexArray._trim(),r.aabb=new Sl(c.min,c.max),r.centroid=function(t,e){const i=[0,0,0],n=t.length;if(n>0){for(let s=0;s<n;s++){const n=3*t[s];i[0]+=e[n],i[1]+=e[n+1],i[2]+=e[n+2]}i[0]/=n,i[1]/=n,i[2]/=n}return i}(h,u),void 0!==s.COLOR_0){const t=e.json.accessors[s.COLOR_0],i=Fw[t.type],n=Zw(e,t);r.colorArray=3===i?new Bh:new Uh,r.colorArray.resize(t.count),Jw(e,t,r.colorArray,n)}if(void 0!==s.NORMAL){r.normalArray=new Bh;const t=e.json.accessors[s.NORMAL];r.normalArray.resize(t.count);const i=Zw(e,t);Jw(e,t,r.normalArray,i)}if(void 0!==s.TEXCOORD_0&&i.length>0){r.texcoordArray=new hc;const t=e.json.accessors[s.TEXCOORD_0];r.texcoordArray.resize(t.count);const i=Zw(e,t);Jw(e,t,r.texcoordArray,i)}if(void 0!==s._FEATURE_ID_RGBA4444){const t=e.json.accessors[s._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(r.featureData=Zw(e,t))}void 0!==s._FEATURE_RGBA4444&&(r.featureData=new Uint32Array(Zw(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer));const l=t.material;return r.material=function(t,e){const{emissiveFactor:i=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:s=.5,normalTexture:r,occlusionTexture:o,emissiveTexture:a,doubleSided:h}=t,{baseColorFactor:c=[1,1,1,1],metallicFactor:u=1,roughnessFactor:l=1,baseColorTexture:f,metallicRoughnessTexture:d}=t.pbrMetallicRoughness||{},p=o?e[o.index]:void 0;if(o&&o.extensions&&o.extensions.KHR_texture_transform&&p){const t=o.extensions.KHR_texture_transform;p.offsetScale=[t.offset[0],t.offset[1],t.scale[0],t.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Vn(...c),metallicFactor:u,roughnessFactor:l,baseColorTexture:f?e[f.index]:void 0,metallicRoughnessTexture:d?e[d.index]:void 0},doubleSided:h,emissiveFactor:i,alphaMode:n,alphaCutoff:s,normalTexture:r?e[r.index]:void 0,occlusionTexture:p,emissionTexture:a?e[a.index]:void 0,defined:void 0===t.defined}}(void 0!==l?e.json.materials[l]:{defined:!1},i),r}function Qw(e,i,n){const{matrix:s,rotation:r,translation:o,scale:a,mesh:h,extras:c,children:u}=e,l={};if(l.matrix=s||t.ae.fromRotationTranslationScale([],r||[0,0,0,1],o||[0,0,0],a||[1,1,1]),void 0!==h){l.meshes=n[h];const t=l.anchor=[0,0];for(const e of l.meshes){const{min:i,max:n}=e.aabb;t[0]+=i[0]+n[0],t[1]+=i[1]+n[1]}t[0]=Math.floor(t[0]/l.meshes.length/2),t[1]=Math.floor(t[1]/l.meshes.length/2)}if(c&&(c.id&&(l.id=c.id),c.lights&&(l.lights=function(t){if(!t.length)return[];const e=function(t){const e=atob(t),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.codePointAt(t);return i}(t),i=[],n=e.length/24,s=new Uint16Array(e.buffer),r=new Float32Array(e.buffer);for(let t=0;t<n;t++){const e=s[2*t*6]/30,n=s[2*t*6+1]/30,o=s[2*t*6+10]/100,a=r[6*t+1],h=r[6*t+2],c=r[6*t+3],u=r[6*t+4],l=c-a,f=u-h,d=Math.hypot(l,f);i.push({pos:[a+.5*l,h+.5*f,n],normal:[f/d,-l/d,0],width:d,height:e,depth:o,points:[a,h,c,u]})}return i}(c.lights))),u){const t=[];for(const e of u)t.push(Qw(i.json.nodes[e],i,n));l.children=t}return l}function ty(t){if(0===t.vertices.length||0===t.indices.length)return null;const e=new ad(t.vertices,t.indices,8,256),[i,n]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:i,max:n}}function ey(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||0===e.length)return null;const i=e[0];if(!i||!Array.isArray(i)||0===i.length)return null;const n=[];for(const t of i){if(!Array.isArray(t)||2!==t.length)continue;const e=t[0],i=t[1];"number"==typeof e&&"number"==typeof i&&n.push(new Ue(e,i))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let s=0;for(let t=0;t<n.length;t++){const e=n[t],i=n[(t+1)%n.length],r=n[(t+2)%n.length];s+=(e.x-i.x)*(r.y-i.y)-(r.x-i.x)*(e.y-i.y)}s>0&&n.reverse();const r=Af(n.flatMap((t=>[t.x,t.y])),[]);return 0===r.length?null:{vertices:n,indices:r}}function iy(e,i){const n=[],s=[];let r=0;const o=[];for(const a of e){r=n.length;const e=a.vertexArray.float32,h=a.indexArray.uint16;for(let s=0;s<a.vertexArray.length;s++)o[0]=e[3*s+0],o[1]=e[3*s+1],o[2]=e[3*s+2],t.$.transformMat4(o,o,i),n.push(new Ue(o[0],o[1]));for(let t=0;t<3*a.indexArray.length;t++)s.push(h[t]+r)}if(s.length%3!=0)return null;for(let t=0;t<s.length;t+=3){const e=n[s[t+0]],i=n[s[t+1]],r=n[s[t+2]];(e.x-i.x)*(r.y-i.y)-(r.x-i.x)*(e.y-i.y)>0&&([s[t+1],s[t+2]]=[s[t+2],s[t+1]])}return{vertices:n,indices:s}}function ny(t){const e=function(t,e){const i=[],n=WebGL2RenderingContext;if(t.json.textures)for(const s of t.json.textures){const r={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==s.sampler&&Object.assign(r,t.json.samplers[s.sampler]),i.push({image:e[s.source],sampler:r,uploaded:!1})}return i}(t,t.images),i=function(t,e){const i=[];for(const n of t.json.meshes){const s=[];for(const i of n.primitives)s.push(Kw(i,t,e));i.push(s)}return i}(t,e),{scenes:n,scene:s,nodes:r}=t.json,o=n?n[s||0].nodes:r,a=[];for(const e of o)a.push(Qw(r[e],t,i));return function(t,e,i){const n={},s=new Set;for(let r=0;r<t.length;r++){const t=i[e[r]];if(!t.extras)continue;const o=t.extras["mapbox:footprint:version"],a=t.extras["mapbox:footprint:id"];(o||a)&&s.add(r),"1.0.0"===o&&a&&(n[a]=r)}for(let r=0;r<t.length;r++){if(s.has(r))continue;const o=t[r],a=i[e[r]];if(!a.extras)continue;let h=null;o.id in n&&(h=iy(t[n[o.id]].meshes,o.matrix)),h||(h=ey(a)),h&&(o.footprint=ty(h))}if(s.size>0){const e=Array.from(s.values()).sort(((t,e)=>t-e));for(let i=e.length-1;i>=0;i--)t.splice(e[i],1)}}(a,o,t.json.nodes),a}function sy(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,n=t.aabb.min[1]-1,s=cw/(t.aabb.max[0]-i+2),r=cw/(t.aabb.max[1]-n+2);for(let o=0;o<e.length;o+=3){const a=e[o+2],h=(e[o+0]-i)*s|0,c=(e[o+1]-n)*r|0;a>t.heightmap[c*cw+h]&&(t.heightmap[c*cw+h]=a)}}function ry(e,i){const n={};n.indexArray=new tc,n.indexArray.reserve(4*e.length),n.vertexArray=new Bh,n.vertexArray.reserve(10*e.length),n.colorArray=new Uh,n.vertexArray.reserve(10*e.length);let s=0;for(const r of e){const e=Math.min(10,Math.max(4,1.3*r.height))*i,o=[-r.normal[1],r.normal[0],0],a=Math.min(.29,.1*r.width/r.depth),h=r.width-2*r.depth*i*(a+.01),c=t.$.scaleAndAdd([],r.pos,o,h/2),u=t.$.scaleAndAdd([],r.pos,o,-h/2),l=[c[0],c[1],c[2]+r.height],f=[u[0],u[1],u[2]+r.height],d=t.$.scaleAndAdd([],r.normal,o,a);t.$.scale(d,d,e);const p=t.$.scaleAndAdd([],r.normal,o,-a);t.$.scale(p,p,e),t.$.add(d,c,d),t.$.add(p,u,p),c[2]+=.1,u[2]+=.1,n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(l[0],l[1],l[2]),n.vertexArray.emplaceBack(f[0],f[1],f[2]),n.vertexArray.emplaceBack(c[0],c[1],c[2]),n.vertexArray.emplaceBack(u[0],u[1],u[2]),n.vertexArray.emplaceBack(d[0],d[1],d[2]),n.vertexArray.emplaceBack(p[0],p[1],p[2]);const m=h/e/2;n.colorArray.emplaceBack(-m-a,-1,m,.8),n.colorArray.emplaceBack(m+a,-1,m,.8),n.colorArray.emplaceBack(-m,0,m,1.3),n.colorArray.emplaceBack(m,0,m,1.3),n.colorArray.emplaceBack(m+a,-.8,m,.7),n.colorArray.emplaceBack(m+a,-.8,m,.7),n.colorArray.emplaceBack(0,0,m,1.3),n.colorArray.emplaceBack(0,0,m,1.3),n.colorArray.emplaceBack(m+a,-1.2,m,.8),n.colorArray.emplaceBack(m+a,-1.2,m,.8),n.indexArray.emplaceBack(6+s,4+s,8+s),n.indexArray.emplaceBack(7+s,9+s,5+s),n.indexArray.emplaceBack(0+s,1+s,2+s),n.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const r={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=Vn.white,r.pbrMetallicRoughness=o,n.material=r,n.aabb=new Sl([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const oy=new Float32Array(262144),ay=new Uint8Array(262144);function hy(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,hy(i));return e}function cy(t,e,i){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&i.insert(e,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const n of t.children)cy(n,e,i)}const uy=["","wall","door","roof","window","lamp","logo"];class ly{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:hy(t)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Sl([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const e=new Sl([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==t&&(i.transformedAabb=Sl.applyTransformFast(i.aabb,this.node.matrix),e.encapsulate(i.transformedAabb)),t++;this.aabb=e}return this.aabb}}class fy{constructor(t,e,i,n,s,r){this.id=e,this.modelTraits|=uw.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=uw.HasMapboxMeshFeatures),n&&(this.modelTraits|=uw.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const e of t)this.nodesInfo.push(new ly(e)),cy(e,r.featureIndexArray.length,r.grid),r.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,r.bucketLayerIDs.length-1,0)}updateFootprints(t,e){for(const i of this.getNodesInfo()){const n=i.node;n.footprint&&e.push({footprint:n.footprint,id:t})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const e=this.getNodesInfo();for(const i of e){const e=i.node;this.uploaded?this.updatePbrBuffer(e):pw(e,t,!0)}for(const t of e)mw(t.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let e=!1;if(!t.meshes)return e;for(const i of t.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),e=!0);return e}needsReEvaluation(t,e,i){const n=t.transform.projectionOptions,s=t.style.getBrightness(),r=this.brightness!==s;return!!(!this.uploaded||this.dirty||n.name!==this.projection.name||dy(i.paint.get("model-color").value,r)||dy(i.paint.get("model-color-mix-intensity").value,r)||dy(i.paint.get("model-roughness").value,r)||dy(i.paint.get("model-emissive-strength").value,r)||dy(i.paint.get("model-height-based-emissive-strength-multiplier").value,r))&&(this.projection=n,this.brightness=s,!0)}evaluateScale(t,e){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const i=this.getNodesInfo(),n=this.id.canonical;for(const t of i){const i=t.feature;t.evaluatedScale=e.paint.get("model-scale").evaluate(i,{},n)}}evaluate(t){const e=this.getNodesInfo();for(const i of e){if(!i.node.meshes)continue;const e=i.feature,n=i.node.meshes&&i.node.meshes[0].featureData,s=i.evaluatedColor[2],r=i.evaluatedRMEA[2],o=this.id.canonical;if(i.hasTranslucentParts=!1,n){for(let n=0;n<uy.length;n++){const s=uy[n];s.length&&(e.properties.part=s);const r=t.paint.get("model-color").evaluate(e,{},o).toRenderColor(null),a=t.paint.get("model-color-mix-intensity").evaluate(e,{},o);i.evaluatedColor[n]=[r.r,r.g,r.b,a],i.evaluatedRMEA[n][0]=t.paint.get("model-roughness").evaluate(e,{},o),i.evaluatedRMEA[n][2]=t.paint.get("model-emissive-strength").evaluate(e,{},o),i.evaluatedRMEA[n][3]=r.a,i.emissionHeightBasedParams[n]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(e,{},o),!i.hasTranslucentParts&&r.a<1&&(i.hasTranslucentParts=!0)}delete e.properties.part,my(i,s!==i.evaluatedColor[2]||r!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(e,{},o);i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},o),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,e,i,n){const s=t.findDEMTileFor(i);if(s&&(s.tileID.canonical!==this.terrainTile||e!==this.terrainExaggeration)){if(s.dem&&s.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=s.tileID.overscaledZ;const e=op.create(t,i,s);if(!e)return;this.modelTraits&uw.HasMapboxMeshFeatures&&this.updateDEM(t,e,i,n);for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const n=i.footprint.vertices;let s=e.getElevationAt(n[0].x,n[0].y,!0,!0);for(let t=1;t<n.length;t++)s=Math.min(s,e.getElevationAt(n[t].x,n[t].y,!0,!0));i.elevation=s}}this.terrainTile=s.tileID.canonical,this.terrainExaggeration=e}}updateDEM(t,e,i,n){let s=e._dem._modifiedForSources[n];if(void 0===s&&(e._dem._modifiedForSources[n]=[],s=e._dem._modifiedForSources[n]),s.includes(i.canonical))return;const r=e._dem.dim;s.push(i.canonical);let o=!1;for(const t of this.getNodesInfo()){const i=t.node;if(!i.footprint||!i.footprint.grid)continue;const n=i.footprint.grid,s=e.tileCoordToPixel(n.min.x,n.min.y),a=e.tileCoordToPixel(n.max.x,n.max.y),h=Math.min(Math.min(r-a.y,s.x),Math.min(s.y,r-a.x));if(h<0)continue;const c=Je(h,2,5);let u=Math.max(0,s.x-c),l=Math.max(0,s.y-c),f=Math.min(a.x+c,r-1),d=Math.min(a.y+c,r-1);for(let t=l;t<=d;++t)for(let e=u;e<=f;++e)ay[t*r+e]=255;let p=0,m=0;for(let t=0;t<n.cellsY;++t)for(let i=0;i<n.cellsX;++i){if(!n.cells[t*n.cellsX+i])continue;const s=e.tileCoordToPixel(n.min.x+i/n.xScale,n.min.y+t/n.yScale),o=e.tileCoordToPixel(n.min.x+(i+1)/n.xScale,n.min.y+(t+1)/n.yScale);for(let t=s.y;t<=Math.min(o.y+1,r-1);++t)for(let i=s.x;i<=Math.min(o.x+1,r-1);++i)255===ay[t*r+i]&&(ay[t*r+i]=0,p+=e.getElevationAtPixel(i,t),m++)}const _=p/m;u=Math.max(1,s.x-c),l=Math.max(1,s.y-c),f=Math.min(a.x+c,r-2),d=Math.min(a.y+c,r-2),o=!0;for(let t=l;t<=d;++t)for(let i=u;i<=f;++i)0===ay[t*r+i]&&(oy[t*r+i]=e._dem.set(i,t,_));for(let t=1;t<c;++t){u=Math.max(1,s.x-t),l=Math.max(1,s.y-t),f=Math.min(a.x+t,r-2),d=Math.min(a.y+t,r-2);for(let i=l;i<=d;++i)for(let n=u;n<=f;++n){const s=i*r+n;if(255===ay[s]){let o=0,a=0,h=-1,u=-1;for(let e=-1;e<=1;++e)for(let s=-1;s<=1;++s){const c=(i+e)*r+n+s;if(ay[c]>=t)continue;const l=oy[c],f=Math.abs(l);f>a&&(o=l,a=f,h=s,u=e)}if(a>.1){const r=1-(t+.5*Math.abs(h*u))/c;let a=e._dem.get(n,i)+o*r;const l=e._dem.get(n+h,i+u),f=e._dem.get(n-h,i-u,!0);(a-l)*(a-f)>0&&(a=(l+f)/2),oy[s]=e._dem.set(n,i,a),ay[s]=t}}}}}o&&(e._demTile.needsDEMTextureUpload=!0,e._dem._timestamp=Ri.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const e of t)mw(e.node),_w(e.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,e){if(e.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=e.updateTime;const i=e.getReplacementRegionsForTile(t.toUnwrapped()),n=this.getNodesInfo();for(let t=0;t<this.nodesInfo.length;t++){const e=n[t].node;n[t].hiddenByReplacement=!!e.footprint&&!i.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(e,i){const n=this.getNodesInfo(),s=[],r=[0,0,0],o=t.ae.identity([]);for(let a=0;a<this.nodesInfo.length;a++){const h=n[a],c=h.node.meshes[0],u=c.transformedAabb;if(e<u.min[0]||i<u.min[1]||e>u.max[0]||i>u.max[1])continue;if(!0===h.node.hidden)return{height:0,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};t.ae.invert(o,h.node.matrix),r[0]=e,r[1]=i,t.$.transformMat4(r,r,o);const l=(r[0]-c.aabb.min[0])/(c.aabb.max[0]-c.aabb.min[0])*cw|0,f=Math.min(63,(r[1]-c.aabb.min[1])/(c.aabb.max[1]-c.aabb.min[1])*cw|0)*cw+Math.min(63,l),d=c.heightmap[f];if(!(d<0&&h.node.footprint)){if(h.hiddenByReplacement)return;return{height:d,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]}}if(h.node.footprint.grid.query(new Ue(e,i),new Ue(e,i),s),s.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function dy(t,e){return!t.isLightConstant&&e}function py(t,e,i,n,s,r,o,a){let h=(61440&e|(61440&e)>>4)>>8,c=(3840&e|(3840&e)>>4)>>4,u=240&e|(240&e)>>4;i[3]>0&&(h=qn(h,255*i[0],i[3]),c=qn(c,255*i[1],i[3]),u=qn(u,255*i[2],i[3]));const l=h<<8|c,f=u<<8|Math.floor(255*n[3]),d=function(t){const e=Je(t,0,2);return Math.min(Math.round(.5*e*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],p=Je(s[0],0,1),m=Je(s[1],0,1),_=Je(s[2],0,1),v=Je(s[3],0,1);let g,b,w,y;if(p!==m&&o!==r&&m!==p){const t=o-r;b=1/(t*(m-p)),w=-(r+t*p)/(t*(m-p));const e=Je(s[4],-1,1);y=Math.pow(10,e),g=255*_<<8|255*v}else g=65535,b=0,w=1,y=1;if(t.emplaceBack(l,f,d,g,b,w,y),a){const t=a.length;a.clear();for(let e=0;e<t;e++)a.emplaceBack(l,f,d,g,b,w,y)}}function my(t,e,i){const n=t.node;let s=0;const r=i&uw.HasMeshoptCompression;for(const i of n.meshes){if(n.lights&&n.lightMeshIndex===s)continue;if(!i.featureData)continue;i.featureArray=new uc,i.featureArray.reserve(i.featureData.length);let o=e;for(const e of i.featureData){const s=r?65535&e:e>>16&65535,a=r?e>>16&65535:65535&e,h=(15&a)<8?15&a:0,c=t.evaluatedRMEA[h],u=t.evaluatedColor[h],l=t.emissionHeightBasedParams[h];let f;if(o&&2===h&&n.lights&&(f=new uc,f.resize(10*n.lights.length)),py(i.featureArray,s,u,c,l,i.aabb.min[2],i.aabb.max[2],f),f&&o){o=!1;const t=n.meshes[n.lightMeshIndex];t.featureArray=f,t.featureArray._trim()}}i.featureArray._trim(),s++}}function _y(t,e,i,n){const s=1<<t.z;e.lat=Pu((n/pr+t.y)/s),e.lng=Ru((i/pr+t.x)/s)}Oa(fy,"Tiled3dModelBucket",{omit:["layers"]}),Oa(ly,"Tiled3dModelFeature");const vy={circle:class extends Ih{constructor(t,e,i,n){super(t,{layout:bl||(bl=new ch({"circle-sort-key":new ah(uh.layout_circle["circle-sort-key"]),visibility:new oh(uh.layout_circle.visibility)})),paint:wl||(wl=new ch({"circle-radius":new ah(uh.paint_circle["circle-radius"]),"circle-color":new ah(uh.paint_circle["circle-color"]),"circle-blur":new ah(uh.paint_circle["circle-blur"]),"circle-opacity":new ah(uh.paint_circle["circle-opacity"]),"circle-translate":new oh(uh.paint_circle["circle-translate"]),"circle-translate-anchor":new oh(uh.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new oh(uh.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new oh(uh.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ah(uh.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ah(uh.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ah(uh.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new oh(uh.paint_circle["circle-emissive-strength"])}))},e,i,n)}createBucket(t){return new tl(t)}queryRadius(t){const e=t;return ml("circle-radius",this,e)+ml("circle-stroke-width",this,e)+_l(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,s,r,o,a){const h=gl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return hf(t,n,r,o,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),h,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,i){const n=af(this);return{config:new tu(this,{zoom:e,lut:i}),defines:n,overrideFog:!1}}},heatmap:class extends Ih{createBucket(t){return new df(t)}constructor(t,e,i,n){super(t,{layout:wf||(wf=new ch({visibility:new oh(uh.layout_heatmap.visibility)})),paint:yf||(yf=new ch({"heatmap-radius":new ah(uh.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ah(uh.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new oh(uh.paint_heatmap["heatmap-intensity"]),"heatmap-color":new hh(uh.paint_heatmap["heatmap-color"]),"heatmap-opacity":new oh(uh.paint_heatmap["heatmap-opacity"])}))},e,i,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return ml("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,s,r,o,a){const h=this.paint.get("heatmap-radius").evaluate(e,i);return hf(t,n,r,o,a,!0,!0,new Ue(0,0),h)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,i){return"heatmap"===t?{config:new tu(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Ih{constructor(t,e,i,n){super(t,{layout:xf||(xf=new ch({visibility:new oh(uh.layout_hillshade.visibility)})),paint:Mf||(Mf=new ch({"hillshade-illumination-direction":new oh(uh.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new oh(uh.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new oh(uh.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new oh(uh.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new oh(uh.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new oh(uh.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new oh(uh.paint_hillshade["hillshade-emissive-strength"])}))},e,i,n)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},fill:class extends Ih{constructor(t,e,i,n){super(t,{layout:nd||(nd=new ch({"fill-sort-key":new ah(uh.layout_fill["fill-sort-key"]),visibility:new oh(uh.layout_fill.visibility)})),paint:sd||(sd=new ch({"fill-antialias":new oh(uh.paint_fill["fill-antialias"]),"fill-opacity":new ah(uh.paint_fill["fill-opacity"]),"fill-color":new ah(uh.paint_fill["fill-color"]),"fill-outline-color":new ah(uh.paint_fill["fill-outline-color"]),"fill-translate":new oh(uh.paint_fill["fill-translate"]),"fill-translate-anchor":new oh(uh.paint_fill["fill-translate-anchor"]),"fill-pattern":new ah(uh.paint_fill["fill-pattern"]),"fill-emissive-strength":new oh(uh.paint_fill["fill-emissive-strength"])}))},e,i,n)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e,i){return{config:new tu(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new id(t)}queryRadius(){return _l(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,s,r){return!t.queryGeometry.isAboveHorizon&&nl(vl(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Ih{constructor(t,e,i,n){super(t,{layout:Fp||(Fp=new ch({visibility:new oh(uh["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new oh(uh["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:zp||(zp=new ch({"fill-extrusion-opacity":new oh(uh["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ah(uh["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new oh(uh["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new oh(uh["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ah(uh["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ah(uh["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ah(uh["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new oh(uh["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new oh(uh["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new oh(uh["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new oh(uh["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new oh(uh["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new oh(uh["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new oh(uh["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new oh(uh["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ah(uh["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ah(uh["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new oh(uh["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new oh(uh["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new oh(uh["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new oh(uh["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new oh(uh["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ah(uh["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new oh(uh["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},e,i,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Ep(t)}queryRadius(){return _l(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,i,n,s,r,o,a,h,c){const u=gl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),l=this.paint.get("fill-extrusion-height").evaluate(i,n),f=this.paint.get("fill-extrusion-base").evaluate(i,n),d=[0,0],p=h&&o.elevation,m=o.elevation?o.elevation.exaggeration():1,_=e.tile.getBucket(this);if(p&&_ instanceof Ep){const t=_.centroidVertexArray,e=c+1;e<t.length&&(d[0]=t.geta_centroid_pos0(e),d[1]=t.geta_centroid_pos1(e))}if(0===d[0]&&1===d[1])return!1;"globe"===o.projection.name&&(s=Pp([s],[new Ue(0,0),new Ue(pr,pr)],e.tileID.canonical).map((t=>t.polygon)).flat());const v=p?h:null,[g,b]=function(e,i,n,s,r,o,a,h,c,u,l){return"globe"===e.projection.name?function(e,i,n,s,r,o,a,h,c,u,l){const f=[],d=[],p=e.projection.upVectorScale(l,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],_=[0,0,0,1],v=(t,e,i,n)=>{t[0]=e,t[1]=i,t[2]=n,t[3]=1},g=Rp();n>0&&(n+=g),s+=g;for(const g of i){const i=[],b=[];for(const f of g){const d=f.x+r.x,g=f.y+r.y,w=e.projection.projectTilePoint(d,g,l),y=e.projection.upVector(l,f.x,f.y);let x=n,M=s;if(a){const t=Up(d,g,n,s,a,h,c,u);x+=t.base,M+=t.top}0!==n?v(m,w.x+y[0]*p*x,w.y+y[1]*p*x,w.z+y[2]*p*x):v(m,w.x,w.y,w.z),v(_,w.x+y[0]*p*M,w.y+y[1]*p*M,w.z+y[2]*p*M),t.$.transformMat4(m,m,o),t.$.transformMat4(_,_,o),i.push(new Cd(m[0],m[1],m[2])),b.push(new Cd(_[0],_[1],_[2]))}f.push(i),d.push(b)}return[f,d]}(e,i,n,s,r,o,a,h,c,u,l):a?function(e,i,n,s,r,o,a,h,c){const u=[],l=[],f=[0,0,0,1];for(const d of e){const e=[],p=[];for(const u of d){const l=u.x+s.x,d=u.y+s.y,m=Up(l,d,i,n,o,a,h,c);f[0]=l,f[1]=d,f[2]=m.base,f[3]=1,t.aB.transformMat4(f,f,r),f[3]=Math.max(f[3],1e-5);const _=new Cd(f[0]/f[3],f[1]/f[3],f[2]/f[3]);f[0]=l,f[1]=d,f[2]=m.top,f[3]=1,t.aB.transformMat4(f,f,r),f[3]=Math.max(f[3],1e-5);const v=new Cd(f[0]/f[3],f[1]/f[3],f[2]/f[3]);e.push(_),p.push(v)}u.push(e),l.push(p)}return[u,l]}(i,n,s,r,o,a,h,c,u):function(t,e,i,n,s){const r=[],o=[],a=s[8]*e,h=s[9]*e,c=s[10]*e,u=s[11]*e,l=s[8]*i,f=s[9]*i,d=s[10]*i,p=s[11]*i;for(const e of t){const t=[],i=[];for(const r of e){const e=r.x+n.x,o=r.y+n.y,m=s[0]*e+s[4]*o+s[12],_=s[1]*e+s[5]*o+s[13],v=s[2]*e+s[6]*o+s[14],g=s[3]*e+s[7]*o+s[15],b=m+a,w=_+h,y=v+c,x=Math.max(g+u,1e-5),M=m+l,T=_+f,O=v+d,E=Math.max(g+p,1e-5);t.push(new Cd(b/x,w/x,y/x)),i.push(new Cd(M/E,T/E,O/E))}r.push(t),o.push(i)}return[r,o]}(i,n,s,r,o)}(o,s,f,l,u,a,v,d,m,o.center.lat,e.tileID.canonical),w=e.queryGeometry;return function(t,e,i){let n=1/0;nl(i,e)&&(n=$p(i,e[0]));for(let s=0;s<e.length;s++){const r=e[s],o=t[s];for(let t=0;t<r.length-1;t++){const e=r[t],s=[e,r[t+1],o[t+1],o[t],e];el(i,s)&&(n=Math.min(n,$p(i,s)))}}return n!==1/0&&n}(g,b,w.isPointQuery()?w.screenBounds:w.screenGeometry)}},line:class extends Ih{constructor(t,e,i,n){const s=lb();super(t,s,e,i,n),s.layout&&(this.layout=new rh(s.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof no,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=(()=>{if(db)return db;const t=lb();return db=new fb(t.paint.properties["line-width"].specification),db.useIntegerZoom=!0,db})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new am(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,i){const n=pm(this);return{config:new tu(this,{zoom:e,lut:i}),defines:n,overrideFog:!1}}queryRadius(t){const e=t,i=vb(ml("line-width",this,e),ml("line-gap-width",this,e)),n=ml("line-offset",this,e);return i/2+Math.abs(n)+_l(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,s,r){if(t.queryGeometry.isAboveHorizon)return!1;const o=vl(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),r.angle,t.pixelToTileUnitsFactor),a=t.pixelToTileUnitsFactor/2*vb(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),h=this.paint.get("line-offset").evaluate(e,i);return h&&(n=function(t,e){const i=[],n=new Ue(0,0);for(let s=0;s<t.length;s++){const r=t[s],o=[];for(let t=0;t<r.length;t++){const i=r[t],s=r[t+1],a=0===t?n:i.sub(r[t-1])._unit()._perp(),h=t===r.length-1?n:s.sub(i)._unit()._perp(),c=a._add(h)._unit();c._mult(1/(c.x*h.x+c.y*h.y)),o.push(c._mult(e)._add(i))}i.push(o)}return i}(n,h*t.pixelToTileUnitsFactor)),function(t,e,i){for(let n=0;n<e.length;n++){const s=e[n];if(t.length>=3)for(let e=0;e<s.length;e++)if(ul(t,s[e]))return!0;if(sl(t,s,i))return!0}return!1}(o,n,a)}isTileClipped(){return!0}isDraped(t){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:wb,background:class extends Ih{constructor(t,e,i,n){super(t,{layout:yb||(yb=new ch({visibility:new oh(uh.layout_background.visibility)})),paint:xb||(xb=new ch({"background-color":new oh(uh.paint_background["background-color"]),"background-pattern":new oh(uh.paint_background["background-pattern"]),"background-opacity":new oh(uh.paint_background["background-opacity"]),"background-emissive-strength":new oh(uh.paint_background["background-emissive-strength"])}))},e,i,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,i){return{overrideFog:!1}}},raster:Ib,"raster-particle":Nb,sky:class extends Ih{constructor(t,e,i,n){super(t,{layout:Db||(Db=new ch({visibility:new oh(uh.layout_sky.visibility)})),paint:Rb||(Rb=new ch({"sky-type":new oh(uh.paint_sky["sky-type"]),"sky-atmosphere-sun":new oh(uh.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new oh(uh.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new oh(uh.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new oh(uh.paint_sky["sky-gradient-radius"]),"sky-gradient":new hh(uh.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new oh(uh.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new oh(uh.paint_sky["sky-atmosphere-color"]),"sky-opacity":new oh(uh.paint_sky["sky-opacity"])}))},e,i,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Tf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),n=!i,s=t.style.light,r=s.properties.get("position");return n&&"viewport"===s.properties.get("anchor")&&pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?zb(r.azimuthal,90-r.polar,e):zb(i[0],90-i[1],e)}const i=this.paint.get("sky-gradient-center");return zb(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}},slot:class extends Ih{constructor(t,e,i,n){super(t,{paint:Pb||(Pb=new ch({}))},e,null)}},model:class extends Ih{constructor(t,e,i,n){super(t,{layout:aw||(aw=new ch({visibility:new oh(uh.layout_model.visibility),"model-id":new ah(uh.layout_model["model-id"])})),paint:hw||(hw=new ch({"model-opacity":new oh(uh.paint_model["model-opacity"]),"model-rotation":new ah(uh.paint_model["model-rotation"]),"model-scale":new ah(uh.paint_model["model-scale"]),"model-translation":new ah(uh.paint_model["model-translation"]),"model-color":new ah(uh.paint_model["model-color"]),"model-color-mix-intensity":new ah(uh.paint_model["model-color-mix-intensity"]),"model-type":new oh(uh.paint_model["model-type"]),"model-cast-shadows":new oh(uh.paint_model["model-cast-shadows"]),"model-receive-shadows":new oh(uh.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new oh(uh.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ah(uh.paint_model["model-emissive-strength"]),"model-roughness":new ah(uh.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ah(uh.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new oh(uh.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new oh(uh.paint_model["model-front-cutoff"])}))},e,i,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new ow(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof fy?pr-1:0}queryIntersectsFeature(e,i,n,s,r,o){if(!this.modelManager)return!1;const a=this.modelManager,h=e.tile.getBucket(this);if(!(h&&h instanceof ow))return!1;const c=h;for(const n in c.instancesPerModel){const s=c.instancesPerModel[n],r=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(s.idToFeaturesIndex.hasOwnProperty(r)){const i=s.features[s.idToFeaturesIndex[r]],h=a.getModel(n,this.scope);if(!h)return!1;let u=t.ae.create();const l=new bu(0,0),f=c.canonical;let d=Number.MAX_VALUE;for(let n=0;n<i.instancedDataCount;++n){const r=16*(i.instancedDataOffset+n),a=s.instancedDataArray.float32,c=[a[r+4],a[r+5],a[r+6]];_y(f,l,a[r],0|a[r+1]),lw(u,h,o,l,i.rotation,i.scale,c,!1,!1,!1),"globe"===o.projection.name&&(u=qb(u,o));const p=t.ae.multiply([],o.projMatrix,u),m=e.queryGeometry,_=Yb(m.isPointQuery()?m.screenBounds:m.screenGeometry,o,p,h.aabb);null!=_&&(d=Math.min(_,d))}return d!==Number.MAX_VALUE&&d}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||"model-color"!==t&&"model-color-mix-intensity"!==t&&"model-rotation"!==t&&"model-scale"!==t&&"model-translation"!==t&&"model-emissive-strength"!==t)}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof _a}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(e,i,n,s){const r=e.tile,o=r.getBucket(this);let a=null,h=Number.MAX_VALUE;if(!(o&&o instanceof fy))return{queryFeature:a,intersectionZ:h};const c=o.getNodesInfo()[i];if(c.hiddenByReplacement||!c.node.meshes||!n.filter(new Ja(r.tileID.overscaledZ),c.feature,r.tileID.canonical))return{queryFeature:a,intersectionZ:h};const u=c.node,l=s.calculatePosMatrix(r.tileID.toUnwrapped(),s.worldSize),f=c.evaluatedScale;let d=0;s.elevation&&u.elevation&&(d=u.elevation*s.elevation.exaggeration()),t.ae.translate(l,l,[(u.anchor?u.anchor[0]:0)*(f[0]-1),(u.anchor?u.anchor[1]:0)*(f[1]-1),d]),t.ae.scale(l,l,f),t.ae.multiply(l,l,u.matrix);const p=e.queryGeometry,m=p.isPointQuery()?p.screenBounds:p.screenGeometry,_=function(e){const i=t.ae.multiply([],l,e.matrix),n=t.ae.multiply(i,s.expandedFarZProjMatrix,i);for(let t=0;t<e.meshes.length;++t){const i=e.meshes[t];if(t===e.lightMeshIndex)continue;const r=Yb(m,s,n,i.aabb);null!=r&&(h=Math.min(r,h))}if(e.children)for(const t of e.children)_(t)};if(_(u),h===Number.MAX_VALUE)return{queryFeature:a,intersectionZ:h};const v=new bu(0,0);return _y(r.tileID.canonical,v,c.node.anchor[0],c.node.anchor[1]),a={type:"Feature",geometry:{type:"Point",coordinates:[v.lng,v.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:a,intersectionZ:h}}},clip:class extends Ih{constructor(t,e,i,n){super(t,{layout:rd||(rd=new ch({"clip-layer-types":new oh(uh.layout_clip["clip-layer-types"]),"clip-layer-scope":new oh(uh.layout_clip["clip-layer-scope"])})),paint:od||(od=new ch({}))},e,i,n)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new cd(t)}isTileClipped(){return!0}is3D(){return!0}}};Oa(sb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const gy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class by{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[e,i]=new Uint8Array(t,0,2);if(219!==e)throw new Error("Data does not appear to be in a KDBush format.");const n=i>>4;if(1!==n)throw new Error(`Got v${n} data when expected v1.`);const s=gy[15&i];if(!s)throw new Error("Unrecognized array type.");const[r]=new Uint16Array(t,2,1),[o]=new Uint32Array(t,4,1);return new by(o,r,s,t)}constructor(t,e=64,i=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+e,2),65535),this.ArrayType=i,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const s=gy.indexOf(this.ArrayType),r=2*t*this.ArrayType.BYTES_PER_ELEMENT,o=t*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-o%8)%8;if(s<0)throw new Error(`Unexpected typed array class: ${i}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+a,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+r+o+a),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+o+a,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+s]),new Uint16Array(this.data,2,1)[0]=e,new Uint32Array(this.data,4,1)[0]=t)}add(t,e){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=t,this.coords[this._pos++]=e,i}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return wy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:s,coords:r,nodeSize:o}=this,a=[0,s.length-1,0],h=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,l=a.pop()||0;if(u-l<=o){for(let o=l;o<=u;o++){const a=r[2*o],c=r[2*o+1];a>=t&&a<=i&&c>=e&&c<=n&&h.push(s[o])}continue}const f=l+u>>1,d=r[2*f],p=r[2*f+1];d>=t&&d<=i&&p>=e&&p<=n&&h.push(s[f]),(0===c?t<=d:e<=p)&&(a.push(l),a.push(f-1),a.push(1-c)),(0===c?i>=d:n>=p)&&(a.push(f+1),a.push(u),a.push(1-c))}return h}within(t,e,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:s,nodeSize:r}=this,o=[0,n.length-1,0],a=[],h=i*i;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,l=o.pop()||0;if(u-l<=r){for(let i=l;i<=u;i++)Ty(s[2*i],s[2*i+1],t,e)<=h&&a.push(n[i]);continue}const f=l+u>>1,d=s[2*f],p=s[2*f+1];Ty(d,p,t,e)<=h&&a.push(n[f]),(0===c?t-i<=d:e-i<=p)&&(o.push(l),o.push(f-1),o.push(1-c)),(0===c?t+i>=d:e+i>=p)&&(o.push(f+1),o.push(u),o.push(1-c))}return a}}function wy(t,e,i,n,s,r){if(s-n<=i)return;const o=n+s>>1;yy(t,e,o,n,s,r),wy(t,e,i,n,o-1,1-r),wy(t,e,i,o+1,s,1-r)}function yy(t,e,i,n,s,r){for(;s>n;){if(s-n>600){const o=s-n+1,a=i-n+1,h=Math.log(o),c=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*c*(o-c)/o)*(a-o/2<0?-1:1);yy(t,e,i,Math.max(n,Math.floor(i-a*c/o+u)),Math.min(s,Math.floor(i+(o-a)*c/o+u)),r)}const o=e[2*i+r];let a=n,h=s;for(xy(t,e,n,i),e[2*s+r]>o&&xy(t,e,n,s);a<h;){for(xy(t,e,a,h),a++,h--;e[2*a+r]<o;)a++;for(;e[2*h+r]>o;)h--}e[2*n+r]===o?xy(t,e,n,h):(h++,xy(t,e,h,s)),h<=i&&(n=h+1),i<=h&&(s=h-1)}}function xy(t,e,i,n){My(t,i,n),My(e,2*i,2*n),My(e,2*i+1,2*n+1)}function My(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function Ty(t,e,i,n){const s=t-i,r=e-n;return s*s+r*r}t.A=Xr,t.B=Jr,t.C=Vn,t.D=Yr,t.E=Ln,t.F=Rs,t.H=dh,t.I=Qv,t.J=sa,t.K=ea,t.L=function(t){const e=t.value;let i=[];if(!e)return i;const n=ks(e);return"string"!==n?(i=i.concat([new iw(t.key,e,`string expected, "${n}" found`)]),i):(nw(e,!0)||(i=i.concat([new iw(t.key,e,`invalid url "${e}"`)])),i)},t.M=class{constructor(t,e,i,n){this.id=t,this.position=null!=e?new bu(e[0],e[1]):new bu(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Sl([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){if(t.ae.multiply(e.matrix,i,e.matrix),e.meshes)for(const t of e.meshes){const i=Sl.applyTransformFast(t.aabb,e.matrix);this.aabb.encapsulate(i)}if(e.children)for(const t of e.children)this._applyTransformations(t,e.matrix)}computeBoundsAndApplyParent(){const e=t.ae.identity([]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(t,e,i,n,s,r,o=!1){lw(this.matrix,this,t.transform,this.position,e,i,n,s,r,o)}upload(t){if(!this.uploaded){for(const e of this.nodes)pw(e,t);for(const t of this.nodes)mw(t);this.uploaded=!0}}destroy(){for(const t of this.nodes)_w(t)}},t.N=uh,t.O=th,t.P=Ue,t.Q=ii,t.R=Qi,t.S=lc,t.T=Gv,t.U=ch,t.V=iw,t.W=oh,t.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return vi(t.expression.evaluate(e))}interpolate(t,e,i){return{x:qn(t.x,e.x,i),y:qn(t.y,e.y,i),z:qn(t.z,e.z,i),azimuthal:qn(t.azimuthal,e.azimuthal,i),polar:qn(t.polar,e.polar,i)}}},t.Y=Ja,t.Z=_a,t._=Bu,t.a=sg,t.a$=xl,t.a0=Ke,t.a1=rh,t.a2=Ql,t.a3=qn,t.a4=pr,t.a5=Yn,t.a6=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([t,e]){const i=vi([1,t,e]);return{x:i.x,y:i.y,z:i.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:qn(t.x,e.x,i),y:qn(t.y,e.y,i),z:qn(t.z,e.z,i)}}},t.a7=Hc,t.a8=Fc,t.a9=Lc,t.aA=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},t.aC=function(e,i){const{x:n,y:s}=e.point,r=Kl(n,s,e.worldSize/e._pixelsPerMercatorPixel,0,0);return t.ae.multiply(r,r,Xl(zl(i)))},t.aE=Zm,t.aF=a_,t.aG=Xm,t.aH=function(t,e,i,n,s){const r=5*e+2;t.float32[r+0]=i,t.float32[r+1]=n,t.float32[r+2]=s},t.aI=zv,t.aJ=bu,t.aK=jv,t.aL=Tu,t.aM=Al,t.aN=$b,t.aO=Mu,t.aP=Bl,t.aQ=Ou,t.aR=function(t,e,i,n,s,r,o,a,h){if("globe"===h.name)return Bl(t,e,new Mu(i,n,s),!1);const c=uv({z:i,x:n,y:s},h);return new Sl([(r+c.x/c.scale)*e,e*(c.y/c.scale),o],[(r+c.x2/c.scale)*e,e*(c.y2/c.scale),a])},t.aS=function(t,e,i){let n=0;for(let i=0;i<2;++i){const s=0;t[i]>s&&(n+=(t[i]-s)*(t[i]-s)),e[i]<s&&(n+=(s-e[i])*(s-e[i]))}return n},t.aT=Fu,t.aU=yl,t.aV=cu,t.aW=function(e){const i=t.ae.identity(new Float64Array(16));t.ae.multiply(i,e.pixelMatrix,e.globeMatrix);const n=[0,du,0],s=[0,pu,0];return t.$.transformMat4(n,n,i),t.$.transformMat4(s,s,i),[n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!ef(e,new bu(e.center.lat,90)),s[0]>0&&s[0]<=e.width&&s[1]>0&&s[1]<=e.height&&!ef(e,new bu(e.center.lat,-90))]},t.aX=function(e,i){const{scale:n}=e.tileTransform,s=n*pr/(e.tileSize*Math.pow(2,i.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return t.aD.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[s,s])},t.aY=Ub,t.aZ=Lb,t.a_=function(e){const i=Lb(e,!0);return t.aD.invert([],[i[0],i[1],i[4],i[5]])},t.aa=Bc,t.ab=zc,t.ac=Ve,t.ad=function(t,e,i){const n=Math.sqrt(t*t+e*e+i*i),s=n>0?Math.acos(i/n)*He:0;let r=0!==t||0!==e?Math.atan2(-e,-t)*He+90:0;return r<0&&(r+=360),[n,r,s]},t.af=tg,t.ag=ag,t.ah=ig,t.ai=function(t,e){const i={};for(let n=0;n<e.length;n++){const s=e[n];s in t&&(i[s]=t[s])}return i},t.aj=wu,t.ak=Cu,t.al=ju,t.am=Ah,t.an=function(t){Vi++,Vi>Li&&(t.getActor().send("enforceCacheSizeLimit",zi),Vi=0)},t.ao=bn,t.ap=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const s=this.entries[t]=this.entries[t]||{callbacks:[]};if(s.result){const[t,i]=s.result;return this.scheduler?this.scheduler.add((()=>{n(t,i)}),e):n(t,i),()=>{}}return s.callbacks.push(n),s.cancel||(s.cancel=i(((i,n)=>{s.result=[i,n];for(const t of s.callbacks)this.scheduler?this.scheduler.add((()=>{t(i,n)}),e):t(i,n);setTimeout((()=>delete this.entries[t]),3e3)}))),()=>{s.result||(s.callbacks=s.callbacks.filter((t=>t!==n)),s.callbacks.length||(s.cancel(),delete this.entries[t]))}}},t.aq=function(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},(e=>{const n=sn(t.request,((t,n,s,r)=>{t?e(t):n&&e(null,{vectorTile:i?void 0:new kd(new Lm(n)),rawData:n,cacheControl:s,expires:r})}));return()=>{n.cancel(),e()}}),e)},t.ar=$c,t.as=class extends Nc{constructor(t){super(t),this.current=Vc}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let t=0;t<9;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},t.at=Uc,t.au=Je,t.av=Qe,t.ax=Si,t.ay=Du,t.az=Pu,t.b=Sc,t.b$=Au,t.b0=function(t){const{x:e,y:i}=t.point,{lng:n,lat:s}=t._center;return Kl(e,i,t.worldSize,n,s)},t.b1=We,t.b2=Eu,t.b3=hu,t.b4=function(t){const e=Math.round((t+45+360)%360/90)%4;return qe[e]},t.b5=45,t.b6=Iu,t.b7=Uu,t.b8=Sl,t.b9=vi,t.bA=ug,t.bB=bf,t.bC=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},t.bD=lm,t.bF=Jl,t.bG=ji,t.bH=Ci,t.bI=256,t.bJ=function(e,i){const n=[0,0,0],s=Yl(zl(i.canonical));return t.$.transformMat4(n,n,s),t.$.transformMat4(n,n,e),n},t.bK=t=>({u_camera_to_center_distance:new zc(t),u_extrude_scale:new qc(t),u_device_pixel_ratio:new zc(t),u_matrix:new Hc(t),u_inv_rot_matrix:new Hc(t),u_merc_center:new Lc(t),u_tile_id:new $c(t),u_zoom_transition:new zc(t),u_up_dir:new $c(t),u_emissive_strength:new zc(t)}),t.bL=t=>({u_matrix:new Hc(t),u_pixels_to_tile_units:new qc(t),u_device_pixel_ratio:new zc(t),u_units_to_pixels:new Lc(t),u_dash_image:new Fc(t),u_gradient_image:new Fc(t),u_image_height:new zc(t),u_texsize:new Lc(t),u_tile_units_to_pixels:new zc(t),u_alpha_discard_threshold:new zc(t),u_trim_offset:new Lc(t),u_trim_fade_range:new Lc(t),u_trim_color:new Uc(t),u_emissive_strength:new zc(t)}),t.bM=t=>({u_matrix:new Hc(t),u_texsize:new Lc(t),u_pixels_to_tile_units:new qc(t),u_device_pixel_ratio:new zc(t),u_image:new Fc(t),u_units_to_pixels:new Lc(t),u_tile_units_to_pixels:new zc(t),u_alpha_discard_threshold:new zc(t),u_trim_offset:new Lc(t)}),t.bN=Kh,t.bO=im,t.bP=Wm,t.bQ=Jm,t.bR=Q_,t.bS=g_,t.bT=af,t.bU=(t,e,i,n,s,r)=>{const o=t.transform,a="globe"===o.projection.name;let h;if("map"===r.paint.get("circle-pitch-alignment"))if(a){const t=Jl(o.zoom,e.canonical)*o._pixelsPerMercatorPixel;h=Float32Array.from([t,0,0,t])}else h=o.calculatePixelsToTileUnitsMatrix(i);else h=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(o.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ri.devicePixelRatio,u_extrude_scale:h,u_inv_rot_matrix:of,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:r.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=n,c.u_merc_center=s,c.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],c.u_zoom_transition=Ql(o.zoom);const t=s[0]*pr,i=s[1]*pr;c.u_up_dir=o.projection.upVector(new Mu(0,0,0),t,i)}return c},t.bV=pm,t.bW=(t,e,i,n,s,r)=>{const o=t.transform;return{u_matrix:dm(t,e,i,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:fm(e,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:r}},t.bX=(t,e,i,n,s,r,o)=>{const a=t.transform,h=a.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:dm(t,e,i,n),u_pixels_to_tile_units:h,u_device_pixel_ratio:r,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:mm(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fm(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:o,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength")}},t.bY=oi,t.bZ=Tf,t.b_=Rp,t.ba=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},t.bb=Ye,t.bc=function(t,e,i){const n=Ql(i.zoom),s=t.style.map._antialias,r=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===n&&!s&&!r},t.bd=function(e){const i=e.pixelsPerMeter,n=i/Du(1,e.center.lat),s=t.ae.identity(new Float64Array(16));return t.ae.translate(s,s,[e.point.x,e.point.y,0]),t.ae.scale(s,s,[n,n,i]),Float32Array.from(s)},t.be=Gl,t.bf=function(t){const e=Fu-5;t=Je(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ve(t))),3);return Math.round(i*(fu.length-1))},t.bg=function(e,i,n,s){const r=i.getNorth(),o=i.getSouth(),a=i.getWest(),h=i.getEast(),c=1<<e.z,u=h-a,l=r-o,f=u/lu,d=-l/fu[n],p=[0,f,0,d,0,0,r,a,0];if(e.z>0){const e=180/s;t.bE.multiply(p,p,[e/u+1,0,0,0,e/l+1,0,-.5*e/f,.5*e/d,1])}return p[2]=c,p[5]=e.x,p[8]=e.y,p},t.bh=Yl,t.bi=zl,t.bj=function(e,i,n){const s=t.ae.identity(new Float64Array(16)),r=(i/(1<<e)-.5)*Math.PI*2;return t.ae.rotateY(s,n.globeMatrix,r),Float32Array.from(s)},t.bk=Di,t.bl=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.bm=Ib,t.bn=Nb,t.bo=Sb,t.bp=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let e=0;e<t.length;e++){const n=document.createElement("source");rn(t[e])||(i.crossOrigin="Anonymous"),n.src=t[e],i.appendChild(n)}return{cancel:()=>{}}},t.bq=Hv,t.br=hi,t.bs=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,s=Math.floor(t.x),r=Math.floor((t.x-s)*n),o=Math.floor(t.y*n),a=this.findDEMTileFor(new Ou(i,s,i,r,o));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const n=this._source();if(!n)return e;if(t.y<0||t.y>1)return e;const s=n.getSource().maxzoom,r=1<<s,o=Math.floor(t.x),a=t.x-o,h=new Ou(s,o,s,Math.floor(a*r),Math.floor(t.y*r)),c=this.findDEMTileFor(h);if(!c||!c.dem)return e;const u=c.dem,l=1<<c.tileID.canonical.z,f=(a*l-c.tileID.canonical.x)*u.dim,d=(t.y*l-c.tileID.canonical.y)*u.dim,p=Math.floor(f),m=Math.floor(d);return(i?this.exaggeration():1)*qn(qn(u.get(p,m),u.get(p,m+1),d-m),qn(u.get(p+1,m),u.get(p+1,m+1),d-m),f-p)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new Bu(t.wrap+(t.canonical.x+e/pr)/n,(t.canonical.y+i/pr)/n))}getAtTileOffsetFunc(e,i,n,s){return r=>{const o=this.getAtTileOffset(e,r.x,r.y),a=s.upVector(e.canonical,r.x,r.y),h=s.upVectorScale(e.canonical,i,n).metersToTile;return t.$.scale(a,a,o*h),a}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const s=op.create(this,t,n);return!!s&&(e.forEach((t=>{t[2]=this.exaggeration()*s.getElevationAt(t[0],t[1],i)})),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,s=1<<t.canonical.z-n.canonical.z;let r=t.canonical.x/s-n.canonical.x,o=t.canonical.y/s-n.canonical.y,a=0;for(let e=0;e<t.canonical.z-n.canonical.z&&!i.leaves[a];e++){r*=2,o*=2;const t=2*Math.floor(o)+Math.floor(r);a=i.childOffsets[a]+t,r%=1,o%=1}return{min:this.exaggeration()*i.minimums[a],max:this.exaggeration()*i.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(0===t.length)return null;let e=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const s of t){const t=this.getMinMaxForTile(s.tileID);t&&(i=Math.min(i,t.min),n=Math.max(n,t.max),e=!0)}return e?{min:i,max:n}:null}},t.bt=jl,t.bu=Dl,t.bv=Nh,t.bw=tc,t.bx=ab,t.by=ww,t.bz=Ew,t.c=ny,t.c$=function(t,e,i,n){return"custom"===t.type?new Fb(t,e):new vy[t.type](t,e,i,n)},t.c0=Ep,t.c1=pp,t.c2=450,t.c3=7,t.c4=kb,t.c5=rb,t.c6=256,t.c7=$l,t.c8=Xl,t.c9=Rh,t.cA=ll,t.cB=function(e,i,n=0){return t.$.fromValues(((i.x-n)*e.scale-e.x)*pr,(i.y*e.scale-e.y)*pr,Nu(i.z,i.y))},t.cC=function(t){let e=1/0,i=1/0,n=-1/0,s=-1/0;for(const r of t)e=Math.min(e,r.x),i=Math.min(i,r.y),n=Math.max(n,r.x),s=Math.max(s,r.y);return{min:new Ue(e,i),max:new Ue(n,s)}},t.cD=ul,t.cE=Hu,t.cF=au,t.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.cH=I_,t.cI=el,t.cJ=Fd,t.cK=Wd,t.cL=qd,t.cM=tv,t.cN=by,t.cO=function(t){return t({pluginStatus:Ga,pluginURL:Ha}),qa.on("pluginStateChange",t),t},t.cP=$_,t.cQ=L_,t.cR=en,t.cS=Va,t.cT=r,t.cU=Ni,t.cV=Rn,t.cW=fi,t.cX=function(t){const e=t.indexOf(Eh);return e>=0?t.slice(0,e):t},t.cY=function(t){return t.indexOf(Eh)>=0},t.cZ=function(t){const e=t.indexOf(Eh);return e>=0?t.slice(e+1):""},t.c_=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},t.ca=Bh,t.cb=sc,t.cc=1,t.cd=ng,t.ce=0,t.cf=rc,t.cg=function(t,e,i,n,s){return Je((t-e)/(i-e)*(s-n)+n,n,s)},t.ch=Ho,t.ci=Lu,t.cj=class{constructor(t,e,i,n){this.context=t,this.format=n,this.size=i,this.texture=t.gl.createTexture();const[s,r,o]=this.size,{gl:a}=t;a.bindTexture(a.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let h=this.format,c=a.UNSIGNED_BYTE;this.format===a.DEPTH_COMPONENT&&(h=a.DEPTH_COMPONENT16,c=a.UNSIGNED_SHORT),this.format===a.R8&&(n=a.RED),this.format===a.R32F&&(c=a.FLOAT,n=a.RED),a.texImage3D(a.TEXTURE_3D,0,h,s,r,o,0,n,c,e.data)}bind(t,e){const{context:i}=this,{gl:n}=i;n.bindTexture(n.TEXTURE_3D,this.texture),t!==this.minFilter&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},t.ck=qb,t.cl=[1,1,1],t.cm=op,t.cn=uw,t.co=Xh,t.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ue(1/0,1/0),max:new Ue(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const i=Bd(new Ue(0,0),new Ue(pr,pr),t),n=[];if(e&&!$d(i,this._globalClipBounds))return n;for(const e of this._activeRegions){if(e.hiddenByOverlap)continue;if(!$d(i,e))continue;const s=Gd(e.min,e.max,t);n.push({min:s.min,max:s.max,sourceId:this._sourceIds[e.priority],footprint:e.footprint,footprintTileId:e.tileId,order:e.order,clipMask:e.clipMask,clipScope:e.clipScope})}return n}setSources(t){this._setSources(t.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const e=[];for(const i of t.cache.getVisibleCoordinates()){const n=t.cache.getTile(i).buckets[t.layer];n&&n.updateFootprints(i.toUnwrapped(),e)}return e},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope}))))}_addSource(t){const e=t.getFootprints();if(0===e.length)return;const i=t.getOrder(),n=t.getClipMask(),s=t.getClipScope();for(const t of e){if(!t.footprint)continue;const e=Bd(t.footprint.min,t.footprint.max,t.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:t.id,footprint:t.footprint,order:i,clipMask:n,clipScope:s})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort(((t,e)=>t.priority-e.priority||zd(t.min,e.min)||zd(t.max,e.max)||t.order-e.order||t.clipMask-e.clipMask||function(t,e){const i=(t,e)=>t+e;return t.length-e.length||t.reduce(i,"").localeCompare(e.reduce(i,""))}(t.clipScope,e.clipScope)));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const i=this._activeRegions[e],n=this._prevRegions[e];t=i.priority!==n.priority||!Ld(i,n)||i.order!==n.order||i.clipMask!==n.clipMask||!Be(i.clipScope,n.clipScope),++e}}if(t){++this._updateTime;for(const t of this._activeRegions)t.order!==Nd&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const t=t=>{const e=this._activeRegions;if(t>=e.length)return t;const i=e[t].priority;for(;t<e.length&&e[t].priority===i;)++t;return t};if(this._sourceIds.length>1){let e=0,i=t(e);for(;e!==i;){let n=e;const s=e;for(;n!==i;){const t=this._activeRegions[n];t.hiddenByOverlap=!1;for(let e=0;e<s;e++){const i=this._activeRegions[e];if(!i.hiddenByOverlap&&t.order===Nd&&$d(t,i)&&(t.hiddenByOverlap=Vd(t.footprint,t.tileId,i.footprint,i.tileId),t.hiddenByOverlap))break}++n}e=i,i=t(e)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},t.cq=zh,t.cr=Kv,t.cs=ac,t.ct=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new Nh,n=new tc,s=[],r=t+1+2,o=e[0]+1,a=e[0]+1+(1+e.length),h=(t,e,i)=>{let n=t===r-1?t-2:0===t?t:t-1;return n+=i?24575:0,[n,e]};for(let t=0;t<r;++t)i.emplaceBack(...h(t,0,!0));for(let t=0;t<o;++t)for(let e=0;e<r;++e)i.emplaceBack(...h(e,t,(0===e||e===r-1)&&!0));for(let t=0;t<e.length;++t){const n=e[t];for(let t=0;t<r;++t)i.emplaceBack(...h(t,n,!0))}for(let t=0;t<e.length;++t){const o=n.length,h=e[t]+1+2,c=new tc;for(let i=0;i<h-1;i++){const s=i===h-2,o=s?r*(a-e.length+t-i):r;for(let t=0;t<r-1;t++){const e=i*r+t;0===i||s||0===t||t===r-2?(c.emplaceBack(e+1,e,e+o),c.emplaceBack(e+o,e+o+1,e+1)):(n.emplaceBack(e+1,e,e+o),n.emplaceBack(e+o,e+o+1,e+1))}}const u=Sc.simpleSegment(0,o,i.length,n.length-o);for(let t=0;t<c.uint16.length;t+=3)n.emplaceBack(c.uint16[t],c.uint16[t+1],c.uint16[t+2]);const l=Sc.simpleSegment(0,o,i.length,n.length-o);s.push({withoutSkirts:u,withSkirts:l})}return{vertices:i,indices:n,segments:s}}_createGrid(t){const e=this._fillGridMeshWithLods(lu,fu);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,jl.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new tc;for(let t=0;t<=lu;t++)e.emplaceBack(0,t+1,t+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new sc,n=new sc,s=new sc,r=new sc;this._poleSegments=[];for(let t=0,e=0;t<hu;t++){const o=360/(1<<t);i.emplaceBack(0,-au,0,.5,0),n.emplaceBack(0,-au,0,.5,1),s.emplaceBack(0,-au,0,.5,.5),r.emplaceBack(0,-au,0,.5,.5);for(let t=0;t<=lu;t++){let e=t/lu,a=0;const h=qn(0,o,e),[c,u,l]=mu(sf,rf,h,au);i.emplaceBack(c,u,l,e,a),n.emplaceBack(c,u,l,e,1-a);const f=Ve(h);e=.5+.5*Math.sin(f),a=.5+.5*Math.cos(f),s.emplaceBack(c,u,l,e,a),r.emplaceBack(c,u,l,e,1-a)}this._poleSegments.push(Sc.simpleSegment(e,0,66,64)),e+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Il,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,Il,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(s,Il,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(r,Il,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},t.cu=function(t){return Sn.has(t)},t.cv=Nd,t.cw=ap,t.cx=function(t,e,i=0,n=!0){const s=new Ue(i,i),r=t.sub(s),o=e.add(s),a=[r,new Ue(o.x,r.y),o,new Ue(r.x,o.y)];return n&&a.push(r.clone()),a},t.cy=function(t,e){const i=[];for(let n=0;n<t.length;n++){const s=Qe(n-1,-1,t.length-1),r=Qe(n+1,-1,t.length-1),o=t[n],a=t[r],h=t[s].sub(o).unit(),c=a.sub(o).unit(),u=c.angleWithSep(h.x,h.y),l=h.add(c).unit().mult(-1*e/Math.sin(u/2));i.push(o.add(l))}return i},t.cz=lv,t.d=Be,t.d$=ib,t.d0=li,t.d1=qa,t.d2=nn,t.d3=Xe,t.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.d5=Ze,t.d6=$u,t.d7=_u,t.d8=function([t,e,i]){const n=Math.hypot(t,e,i),s=Math.atan2(t,i),r=.5*Math.PI-Math.acos(-e/n);return new bu(We(s),We(r))},t.d9=Ru,t.dA=function(){Ew().acquire(Mw)},t.dB=function(){const t=Ow;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Mw),Ow=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dC=Tw,t.dD=function(t){const e=Gi();if(!e)return;const i=e.delete(Fi);t&&i.catch(t).then((()=>t()))},t.dE=yw,t.dF=Dw,t.dG=function(t){Sw=Ri.resolveURL(t),jw||(jw=new ww(Ew(),new Ln)),jw.broadcast("setDracoUrl",Sw)},t.dH=Rw,t.dI=function(t){Iw=Ri.resolveURL(t),jw||(jw=new ww(Ew(),new Ln)),jw.broadcast("setMeshoptUrl",Iw)},t.dJ=ei,t.dK=Oa,t.dL=vf,t.dM=z_,t.dN=uv,t.dO=pc,t.dP=_m,t.dQ=Gm,t.dR=nm,t.dS=ui,t.dT=R_,t.dU=Bv,t.dV=function(t,e,i,n,s,r,o,a,h,c,u){t.createArrays(),t.tilePixelRatio=pr/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const l=t.layers[0].layout,f=t.layers[0]._unevaluatedLayout._values,d={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:i}=t.textSizeData;d.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Ja(e),a),f["text-size"].possiblyEvaluate(new Ja(i),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:i}=t.iconSizeData;d.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Ja(e),a),f["icon-size"].possiblyEvaluate(new Ja(i),a)]}d.layoutTextSize=f["text-size"].possiblyEvaluate(new Ja(h+1),a),d.layoutIconSize=f["icon-size"].possiblyEvaluate(new Ja(h+1),a),d.textMaxSize=f["text-size"].possiblyEvaluate(new Ja(18),a);const p="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),m=l.get("text-size");let _=!1;for(const e of t.features)if(e.icon&&e.icon.nameSecondary){_=!0;break}for(const r of t.features){const h=l.get("text-font").evaluate(r,{},a).join(","),f=m.evaluate(r,{},a),v=d.layoutTextSize.evaluate(r,{},a),g=(d.layoutIconSize.evaluate(r,{},a),{horizontal:{},vertical:void 0}),b=r.text;let w,y=[0,0];if(b){const n=b.toString(),o=l.get("text-letter-spacing").evaluate(r,{},a)*Wm,c=l.get("text-line-height").evaluate(r,{},a)*Wm,u=ja(n)?o:0,d=l.get("text-anchor").evaluate(r,{},a),m=l.get("text-variable-anchor");if(!m){const t=l.get("text-radial-offset").evaluate(r,{},a);y=t?Q_(d,[t*Wm,J_]):l.get("text-offset").evaluate(r,{},a).map((t=>t*Wm))}let _=p?"center":l.get("text-justify").evaluate(r,{},a);const w="point"===l.get("symbol-placement"),x=w?l.get("text-max-width").evaluate(r,{},a)*Wm:1/0,M=r=>{t.allowVerticalPlacement&&Ca(n)&&(g.vertical=u_(b,e,i,s,h,x,c,d,r,u,y,a_.vertical,!0,v,f))};if(!p&&m){const t="auto"===_?m.map((t=>tv(t))):[_];let n=!1;for(let r=0;r<t.length;r++){const o=t[r];if(!g.horizontal[o])if(n)g.horizontal[o]=g.horizontal[0];else{const t=u_(b,e,i,s,h,x,c,"center",o,u,y,a_.horizontal,!1,v,f);t&&(g.horizontal[o]=t,n=1===t.positionedLines.length)}}M("left")}else{if("auto"===_&&(_=tv(d)),w||l.get("text-writing-mode").indexOf("horizontal")>=0||!Ca(n)){const t=u_(b,e,i,s,h,x,c,d,_,u,y,a_.horizontal,!1,v,f);t&&(g.horizontal[_]=t)}M(w?"left":_)}}let x=!1;if(r.icon&&r.icon.namePrimary){const e=n[r.icon.namePrimary];e&&(w=w_(s[r.icon.namePrimary],r.icon.nameSecondary?s[r.icon.nameSecondary]:void 0,l.get("icon-offset").evaluate(r,{},a),l.get("icon-anchor").evaluate(r,{},a)),x=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const M=rv(g.horizontal)||g.vertical;t.iconsInText||(t.iconsInText=!!M&&M.iconsInText),(M||w)&&ev(t,r,g,w,n,d,v,0,y,x,o,a,c,u,_)}r&&t.generateCollisionDebugBuffers(h,t.collisionBoxArray)},t.dW=am,t.dX=id,t.dY=kd,t.dZ=Lm,t.d_=rp,t.da=vu,t.db=n,t.dc=ef,t.dd=tf,t.de=function(e){const i=[0,0,0],n=t.ae.identity(new Float64Array(16));return t.ae.multiply(n,e.pixelMatrix,e.globeMatrix),t.$.transformMat4(i,i,n),new Ue(i[0],i[1])},t.df=u,t.dg=c,t.dh=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(t){if(null==Ei){const e=t.navigator?t.navigator.userAgent:null;Ei=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ei}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.di=si,t.dj=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",un,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,i){if(!r(t))return t;const n=dn(t);return n.params.push(`sdk=js-${e}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||i)}normalizeGlyphsURL(t,e){if(!r(t))return t;const i=dn(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!r(t))return t;const i=dn(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!r(t))return t;const s=dn(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),i&&s.params.push(`language=${i}`),n&&s.params.push(`worldview=${n}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const s=dn(t);return r(t)?(s.path=`/styles/v1${s.path}/sprite${e}${i}`,this._makeAPIURL(s,this._customAccessToken||n)):(s.path+=`${e}${i}`,pn(s))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r(t))return t;const s=dn(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==s.authority&&512===i?"@2x":""}${Wi.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${n.RASTER_URL_PREFIX}${s.path}`:"rasterarrays"===s.authority?s.path=`/${n.RASTERARRAYS_URL_PREFIX}${s.path}`:"3dtiles"===s.authority?s.path=`/${n.TILES3D_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${n.TILE_URL_VERSION}${s.path}`);const o=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(s.params)||n.ACCESS_TOKEN;return n.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,o)}canonicalizeTileURL(t,e){const i=dn(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let s="mapbox://";i.path.match(/^\/raster\/v1\//)?s+=`raster/${i.path.replace(`/${n.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${i.path.replace(`/${n.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${i.path.replace(`/${n.TILE_URL_VERSION}/`,"")}`;let r=i.params;return e&&(r=r.filter((t=>!t.match(/^access_token=/)))),r.length&&(s+=`?${r.join("&")}`),s}canonicalizeTileset(t,e){const i=!!e&&r(e),n=[];for(const e of t.tiles||[])s(e)?n.push(this.canonicalizeTileURL(e,i)):n.push(e);return n}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=dn(n.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!n.REQUIRE_ACCESS_TOKEN)return pn(t);if(e=e||n.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter((t=>-1===t.indexOf("access_token"))),t.params.push(`access_token=${e||""}`),pn(t)}},t.dk=function(t,e){e?Sn.add(t):Sn.delete(t)},t.dl=Wi,t.dm=On,t.dn=An,t.dp=ln,t.dq=yn,t.dr=Mn,t.ds=function(t){Sn.delete(t)},t.dt=En,t.du=wn,t.dv=ti,t.dw=e,t.dx=function(t,e){zi=t,Li=e},t.dy=function(t,e,i=!1){if(Ga===La||Ga===$a||Ga===Ua)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ha=Ri.resolveURL(t),Ga=La,Ba=e,Wa(),i||Xa()},t.dz=Ya,t.e=Ri,t.e0=Id,t.e1=vd,t.e2=Le,t.e3=gm,t.e4=f,t.e5=sn,t.e6=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==Gw){const i=new Uint32Array(t,0,7),[,,n,s,r,o]=i;e=i.byteLength+s+r+o+r,(n!==t.byteLength||e>=t.byteLength)&&pi("Invalid b3dm header information.")}return Xw(t,e)},t.e7=function(t,e){const i=ny(t);for(const t of i){for(const e of t.meshes)sy(e);t.lights&&(t.lightMeshIndex=t.meshes.length,t.meshes.push(ry(t.lights,e)))}return i},t.e8=fy,t.e9=bw,t.ea=Za,t.eb=function(t){Hi(),Ui&&Ui.then((e=>{e.keys().then((i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])}))}))},t.f=Nn,t.g=Pn,t.h=function(t,e){return nn(ii(t,{type:"json"}),e)},t.i=cn,t.j=gf,t.k=C_,t.l=function(t){return fetch(t).then((t=>t.arrayBuffer())).then((e=>Xw(e,0,t)))},t.m=D_,t.n=class extends iw{},t.o=ks,t.p=hg,t.q=Zn,t.r=ta,t.s=na,t.t=ia,t.u=lh,t.v=da,t.w=pi,t.x=fh,t.y=va,t.z=pa}));n(["./shared"],(function(t){function e(t){const e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}function i(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let e="[";for(const n of t)e+=`${i(n)},`;return`${e}]`}let e="{";for(const n of Object.keys(t).sort())e+=`${n}:${i(t[n])},`;return`${e}}`}function n(e){let n="";for(const s of t.cG)n+=`/${i(e[s])}`;return n}class s{constructor(t){this.keyCache={},this._layers={},this._layerConfigs={},t&&this.replace(t)}replace(t,e){this._layerConfigs={},this._layers={},this.update(t,[],e)}update(e,i,s){this._options=s;for(const i of e)this._layerConfigs[i.id]=i,(this._layers[i.id]=t.c$(i,this.scope,null,this._options)).compileFilter(),this.keyCache[i.id]&&delete this.keyCache[i.id];for(const t of i)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const r=function(t,e){const i={};for(let s=0;s<t.length;s++){const r=e&&e[t[s].id]||n(t[s]);e&&(e[t[s].id]=r);let o=i[r];o||(o=i[r]=[]),o.push(t[s])}const s=[];for(const t in i)s.push(i[t]);return s}(t.dJ(this._layerConfigs),this.keyCache);for(const t of r){const e=t.map((t=>this._layers[t.id])),i=e[0];if("none"===i.visibility)continue;const n=i.source||"";let s=this.familiesBySource[n];s||(s=this.familiesBySource[n]={});const r=i.sourceLayer||"_geojsonTileLayer";let o=s[r];o||(o=s[r]=[]),o.push(e)}}}const r=1*t.dM;class o{constructor(e){const i={},n=[];for(const t in e){const s=e[t],o=i[t]={};for(const t in s.glyphs){const e=s.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const i=e.metrics.localGlyph?r:1,a={x:0,y:0,w:e.bitmap.width+2*i,h:e.bitmap.height+2*i};n.push(a),o[t]=a}}const{w:s,h:o}=t.k(n),a=new t.dL({width:s||1,height:o||1});for(const n in e){const s=e[n];for(const e in s.glyphs){const o=s.glyphs[+e];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const h=i[n][e],c=o.metrics.localGlyph?r:1;t.dL.copy(o.bitmap,a,{x:0,y:0},{x:h.x+c,y:h.y+c},o.bitmap)}}this.image=a,this.positions=i}}t.dK(o,"GlyphAtlas");class a{constructor(e){this.tileID=new t.aQ(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.lut=e.lut,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=t.dN(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster,this.tessellationStep=e.tessellationStep}parse(e,i,n,s,r){this.status="parsing",this.data=e,this.collisionBoxArray=new t.dO;const a=new t.dP(Object.keys(e.layers).sort()),c=new t.dQ(this.tileID,this.promoteId);c.bucketLayerIDs=[];const u={},l=new t.dR(256,256),f={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:l,availableImages:n,brightness:this.brightness},d=i.familiesBySource[this.source];for(const i in d){const s=e.layers[i];if(!s)continue;let r=!1,o=!1,l=!1;for(const t of d[i])"symbol"===t[0].type?r=!0:o=!0,t[0].is3D()&&"model"!==t[0].type&&(l=!0);if(this.extraShadowCaster&&!l)continue;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!o)continue;1===s.version&&t.w(`Vector tile source "${this.source}" layer "${i}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const p=a.encode(i),m=[];for(let t=0;t<s.length;t++){const e=s.feature(t),n=c.getId(e,i);m.push({feature:e,id:n,index:t,sourceLayerIndex:p})}for(const t of d[i]){const e=t[0];(!this.extraShadowCaster||e.is3D()&&"model"!==e.type)&&(void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(h(t,this.zoom,f.brightness,n),(u[e.id]=e.createBucket({index:c.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:p,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(m,f,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(t.map((t=>t.id)))))}}let p,m,_,v;l.trim();const g={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},b=()=>{if(p)return this.status="done",r(p);if(this.extraShadowCaster)this.status="done",r(null,{buckets:t.dJ(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:f.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&_&&v){const e=new o(m),i=new t.dT(_,v,this.lut);for(const s in u){const r=u[s];r instanceof t.dU?(h(r.layers,this.zoom,f.brightness,n),t.dV(r,m,e.positions,_,i.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):r.hasPattern&&(r instanceof t.dW||r instanceof t.dX||r instanceof t.c0)&&(h(r.layers,this.zoom,f.brightness,n),r.addFeatures(f,this.tileID.canonical,i.patternPositions,n,this.tileTransform,this.brightness))}this.status="done",r(null,{buckets:t.dJ(u).filter((t=>!t.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:l,imageAtlas:i,brightness:f.brightness})}};if(!this.extraShadowCaster){const e=t.dS(f.glyphDependencies,(t=>Object.keys(t).map(Number)));Object.keys(e).length?s.send("getGlyphs",{uid:this.uid,stacks:e,scope:this.scope},((t,e)=>{p||(p=t,m=e,b())}),void 0,!1,g):m={};const i=Object.keys(f.iconDependencies);i.length?s.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((t,e)=>{p||(p=t,_=e,b())}),void 0,!1,g):_={};const n=Object.keys(f.patternDependencies);n.length?s.send("getImages",{icons:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((t,e)=>{p||(p=t,v=e,b())}),void 0,!1,g):v={}}b()}}function h(e,i,n,s){const r=new t.Y(i,{brightness:n});for(const t of e)t.recalculate(r,s)}class c extends t.E{constructor(e,i,n,s,r,o){super(),this.actor=e,this.layerIndex=i,this.availableImages=n,this.loadVectorData=r||t.aq,this.loading={},this.loaded={},this.deduped=new t.ap(e.scheduler),this.isSpriteLoaded=s,this.scheduler=e.scheduler,this.brightness=o}loadTile(i,n){const s=i.uid,r=i&&i.request,o=r&&r.collectResourceTiming,h=this.loading[s]=new a(i);h.abort=this.loadVectorData(i,((a,c)=>{const u=!this.loading[s];if(delete this.loading[s],u||a||!c)return h.status="done",u||(this.loaded[s]=h),n(a);const l=c.rawData,f={};c.expires&&(f.expires=c.expires),c.cacheControl&&(f.cacheControl=c.cacheControl),h.vectorTile=c.vectorTile||new t.dY(new t.dZ(l));const d=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,s)=>{if(i||!s)return n(i);const a={};if(o){const t=e(r);t.length>0&&(a.resourceTiming=JSON.parse(JSON.stringify(t)))}n(null,t.Q({rawTileData:l.slice(0)},s,f,a))}))};this.isSpriteLoaded?d():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(d,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):d()})),this.loaded=this.loaded||{},this.loaded[s]=h}))}reloadTile(e,i){const n=this.loaded,s=e.uid;if(n&&n[s]){const r=n[s];r.showCollisionBoxes=e.showCollisionBoxes,r.projection=e.projection,r.brightness=e.brightness,r.tileTransform=t.dN(e.tileID.canonical,e.projection),r.extraShadowCaster=e.extraShadowCaster,r.lut=e.lut;const o=(t,e)=>{const n=r.reloadCallback;n&&(delete r.reloadCallback,r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,n)),i(t,e)};"parsing"===r.status?r.reloadCallback=o:"done"===r.status&&(r.vectorTile?r.parse(r.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}else i(null,void 0)}abortTile(t,e){const i=t.uid,n=this.loading[i];n&&(n.abort&&n.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}}class u{loadTile(e,i){const{uid:n,encoding:s,rawImageData:r,padding:o}=e,a=ImageBitmap&&r instanceof ImageBitmap?this.getImageData(r,o):r;i(null,new t.d_(n,a,s,o<1))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const i=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}t.d$.setPbf(t.dZ);class l{decodeRasterArray({task:e,buffer:i},n){t.d$.performDecoding(i,e).then((t=>{n(null,t)}),(t=>{n(t)}))}}const f=t.e0.prototype.toGeoJSON;let d=class{constructor(e){this._feature=e,this.extent=t.a4,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const i of this._feature.geometry)e.push([new t.P(i[0],i[1])]);return e}{const e=[];for(const i of this._feature.geometry){const n=[];for(const e of i)n.push(new t.P(e[0],e[1]));e.push(n)}return e}}toGeoJSON(t,e,i){return f.call(this,t,e,i)}},p=class{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.a4,this.length=e.length,this._features=e}feature(t){return new d(this._features[t])}};const m=64/4096,_=128;class v{constructor(){this.features=new Map}clear(){this.features.clear()}load(t=[],e){for(const i of t){const t=i.id;if(null==t)continue;let n=this.features.get(t);n&&this.updateCache(n,e),i.geometry?(n=b(i),this.updateCache(n,e),this.features.set(t,n)):this.features.delete(t),this.updateCache(n,e)}}updateCache(t,e){for(const{canonical:i,uid:n}of Object.values(e)){const{z:s,x:r,y:o}=i;g(t,Math.pow(2,s),r,o)&&delete e[n]}}getTile(t,e,i){const n=Math.pow(2,t),s=[];for(const t of this.features.values())g(t,n,e,i)&&s.push(M(t,n,e,i));return{features:s}}getFeatures(){return[...this.features.values()]}}function g({minX:t,minY:e,maxX:i,maxY:n},s,r,o){return t<(r+1+m)/s&&e<(o+1+m)/s&&i>(r-m)/s&&n>(o-m)/s}function b(t){const{id:e,geometry:i,properties:n}=t;if(!i)return;if("GeometryCollection"===i.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:s,coordinates:r}=i,o={id:e,type:1,geometry:[],tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=o.geometry;if("Point"===s)w(r,a,o);else if("MultiPoint"===s)for(const t of r)w(t,a,o);else if("LineString"===s)o.type=2,y(r,a,o);else if("MultiLineString"===s)o.type=2,x(r,a,o);else if("Polygon"===s)o.type=3,x(r,a,o,!0);else{if("MultiPolygon"!==s)throw new Error("Input data is not a valid GeoJSON object.");o.type=3;for(const t of r)x(t,a,o,!0)}return o}function w([e,i],n,s){const r=t.ak(e);let o=t.al(i);o=o<0?0:o>1?1:o,n.push(r,o),s.minX=Math.min(s.minX,r),s.minY=Math.min(s.minY,o),s.maxX=Math.max(s.maxX,r),s.maxY=Math.max(s.maxY,o)}function y(t,e,i,n=!1,s=!1){const r=[];for(const e of t)w(e,r,i);e.push(r),n&&function(t,e){let i=0;for(let e=0,n=t.length,s=n-2;e<n;s=e,e+=2)i+=(t[e]-t[s])*(t[e+1]+t[s+1]);if(i>0===e)for(let e=0,i=t.length;e<i/2;e+=2){const n=t[e],s=t[e+1];t[e]=t[i-2-e],t[e+1]=t[i-1-e],t[i-2-e]=n,t[i-1-e]=s}}(r,s)}function x(t,e,i,n=!1){for(let s=0;s<t.length;s++)y(t[s],e,i,n,0===s)}function M(e,i,n,s){const{id:r,type:o,geometry:a,tags:h}=e,c=[];if(1===o)!function(e,i,n,s,r){for(let o=0;o<e.length;o+=2){const a=Math.round(t.a4*(e[o+0]*i-n)),h=Math.round(t.a4*(e[o+1]*i-s));r.push([a,h])}}(a,i,n,s,c);else for(const t of a)T(t,i,n,s,c);return{id:r,type:o,geometry:c,tags:h}}function T(e,i,n,s,r){const o=-_,a=t.a4+_;let h;for(let c=0;c<e.length-2;c+=2){let u=Math.round(t.a4*(e[c+0]*i-n)),l=Math.round(t.a4*(e[c+1]*i-s)),f=Math.round(t.a4*(e[c+2]*i-n)),d=Math.round(t.a4*(e[c+3]*i-s));const p=f-u,m=d-l;u<o&&f<o||(u<o?(l+=Math.round(m*((o-u)/p)),u=o):f<o&&(d=l+Math.round(m*((o-u)/p)),f=o),l<o&&d<o||(l<o?(u+=Math.round(p*((o-l)/m)),l=o):d<o&&(f=u+Math.round(p*((o-l)/m)),d=o),u>=a&&f>=a||(u>=a?(l+=Math.round(m*((a-u)/p)),u=a):f>=a&&(d=l+Math.round(m*((a-u)/p)),f=a),l>=a&&d>=a||(l>=a?(u+=Math.round(p*((a-l)/m)),l=a):d>=a&&(f=u+Math.round(p*((a-l)/m)),d=a),h&&u===h[h.length-1][0]&&l===h[h.length-1][1]||(h=[[u,l]],r.push(h)),h.push([f,d])))))}}var O={exports:{}},E=t.e2,A=t.e1.VectorTileFeature,S=k;function k(t,e){this.options=e||{},this.features=t,this.length=t.length}function I(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}k.prototype.feature=function(t){return new I(this.features[t],this.options.extent)},I.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],s=0;s<i.length;s++)n.push(new E(i[s][0],i[s][1]));this.geometry.push(n)}return this.geometry},I.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-1/0,n=1/0,s=-1/0,r=0;r<t.length;r++)for(var o=t[r],a=0;a<o.length;a++){var h=o[a];e=Math.min(e,h.x),i=Math.max(i,h.x),n=Math.min(n,h.y),s=Math.max(s,h.y)}return[e,n,i,s]},I.prototype.toGeoJSON=A.prototype.toGeoJSON;var C=t.e3,j=S;function D(t){var e=new C;return function(t,e){for(var i in t.layers)e.writeMessage(3,R,t.layers[i])}(t,e),e.finish()}function R(t,e){var i;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<t.length;i++)n.feature=t.feature(i),e.writeMessage(2,P,n);var s=n.keys;for(i=0;i<s.length;i++)e.writeStringField(3,s[i]);var r=n.values;for(i=0;i<r.length;i++)e.writeMessage(4,$,r[i])}function P(t,e){var i=t.feature;void 0!==i.id&&e.writeVarintField(1,i.id),e.writeMessage(2,N,t),e.writeVarintField(3,i.type),e.writeMessage(4,L,i)}function N(t,e){var i=t.feature,n=t.keys,s=t.values,r=t.keycache,o=t.valuecache;for(var a in i.properties){var h=i.properties[a],c=r[a];if(null!==h){void 0===c&&(n.push(a),r[a]=c=n.length-1),e.writeVarint(c);var u=typeof h;"string"!==u&&"boolean"!==u&&"number"!==u&&(h=JSON.stringify(h));var l=u+":"+h,f=o[l];void 0===f&&(s.push(h),o[l]=f=s.length-1),e.writeVarint(f)}}}function F(t,e){return(e<<3)+(7&t)}function z(t){return t<<1^t>>31}function L(t,e){for(var i=t.loadGeometry(),n=t.type,s=0,r=0,o=i.length,a=0;a<o;a++){var h=i[a],c=1;1===n&&(c=h.length),e.writeVarint(F(1,c));for(var u=3===n?h.length-1:h.length,l=0;l<u;l++){1===l&&1!==n&&e.writeVarint(F(2,u-1));var f=h[l].x-s,d=h[l].y-r;e.writeVarint(z(f)),e.writeVarint(z(d)),s+=f,r+=d}3===n&&e.writeVarint(F(7,1))}}function $(t,e){var i=typeof t;"string"===i?e.writeStringField(1,t):"boolean"===i?e.writeBooleanField(7,t):"number"===i&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}O.exports=D,O.exports.fromVectorTileJs=D,O.exports.fromGeojsonVt=function(t,e){e=e||{};var i={};for(var n in t)i[n]=new j(t[n].features,e),i[n].name=n,i[n].version=e.version,i[n].extent=e.extent;return D({layers:i})},O.exports.GeoJSONWrapper=j;var U=t.e4(O.exports);const B={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},G=Math.fround||(H=new Float32Array(1),t=>(H[0]=+t,H[0]));var H;const V=3,W=5,q=6;class Y{constructor(t){this.options=Object.assign(Object.create(B),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){const{log:e,minZoom:i,maxZoom:n}=this.options;e&&console.time("total time");const s=`prepare ${t.length} points`;e&&console.time(s),this.points=t;const r=[];for(let e=0;e<t.length;e++){const i=t[e];if(!i.geometry)continue;const[n,s]=i.geometry.coordinates,o=G(J(n)),a=G(K(s));r.push(o,a,1/0,e,-1,1),this.options.reduce&&r.push(0)}let o=this.trees[n+1]=this._createTree(r);e&&console.timeEnd(s);for(let t=n;t>=i;t--){const i=+Date.now();o=this.trees[t]=this._createTree(this._cluster(o,t)),e&&console.log("z%d: %d clusters in %dms",t,o.numItems,+Date.now()-i)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let i=((t[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,t[1]));let s=180===t[2]?180:((t[2]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,s=180;else if(i>s){const t=this.getClusters([i,n,180,r],e),o=this.getClusters([-180,n,s,r],e);return t.concat(o)}const o=this.trees[this._limitZoom(e)],a=o.range(J(i),K(r),J(s),K(n)),h=o.data,c=[];for(const t of a){const e=this.stride*t;c.push(h[e+W]>1?X(h,e,this.clusterProps):this.points[h[e+V]])}return c}getChildren(t){const e=this._getOriginId(t),i=this._getOriginZoom(t),n="No cluster with the specified id.",s=this.trees[i];if(!s)throw new Error(n);const r=s.data;if(e*this.stride>=r.length)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=s.within(r[e*this.stride],r[e*this.stride+1],o),h=[];for(const e of a){const i=e*this.stride;r[i+4]===t&&h.push(r[i+W]>1?X(r,i,this.clusterProps):this.points[r[i+V]])}if(0===h.length)throw new Error(n);return h}getLeaves(t,e,i){const n=[];return this._appendLeaves(n,t,e=e||10,i=i||0,0),n}getTile(t,e,i){const n=this.trees[this._limitZoom(t)],s=Math.pow(2,t),{extent:r,radius:o}=this.options,a=o/r,h=(i-a)/s,c=(i+1+a)/s,u={features:[]};return this._addTileFeatures(n.range((e-a)/s,h,(e+1+a)/s,c),n.data,e,i,s,u),0===e&&this._addTileFeatures(n.range(1-a/s,h,1,c),n.data,s,i,s,u),e===s-1&&this._addTileFeatures(n.range(0,h,a/s,c),n.data,-1,i,s,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const i=this.getChildren(t);if(e++,1!==i.length)break;t=i[0].properties.cluster_id}return e}_appendLeaves(t,e,i,n,s){const r=this.getChildren(e);for(const e of r){const r=e.properties;if(r&&r.cluster?s+r.point_count<=n?s+=r.point_count:s=this._appendLeaves(t,r.cluster_id,i,n,s):s<n?s++:t.push(e),t.length===i)break}return s}_createTree(e){const i=new t.cN(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let t=0;t<e.length;t+=this.stride)i.add(e[t],e[t+1]);return i.finish(),i.data=e,i}_addTileFeatures(t,e,i,n,s,r){for(const o of t){const t=o*this.stride,a=e[t+W]>1;let h,c,u;if(a)h=Z(e,t,this.clusterProps),c=e[t],u=e[t+1];else{const i=this.points[e[t+V]];h=i.properties;const[n,s]=i.geometry.coordinates;c=J(n),u=K(s)}const l={type:1,geometry:[[Math.round(this.options.extent*(c*s-i)),Math.round(this.options.extent*(u*s-n))]],tags:h};let f;f=a||this.options.generateId?e[t+V]:this.points[e[t+V]].id,void 0!==f&&(l.id=f),r.features.push(l)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,e){const{radius:i,extent:n,reduce:s,minPoints:r}=this.options,o=i/(n*Math.pow(2,e)),a=t.data,h=[],c=this.stride;for(let i=0;i<a.length;i+=c){if(a[i+2]<=e)continue;a[i+2]=e;const n=a[i],u=a[i+1],l=t.within(a[i],a[i+1],o),f=a[i+W];let d=f;for(const t of l){const i=t*c;a[i+2]>e&&(d+=a[i+W])}if(d>f&&d>=r){let t,r=n*f,o=u*f,p=-1;const m=(i/c<<5)+(e+1)+this.points.length;for(const n of l){const h=n*c;if(a[h+2]<=e)continue;a[h+2]=e;const u=a[h+W];r+=a[h]*u,o+=a[h+1]*u,a[h+4]=m,s&&(t||(t=this._map(a,i,!0),p=this.clusterProps.length,this.clusterProps.push(t)),s(t,this._map(a,h)))}a[i+4]=m,h.push(r/d,o/d,1/0,m,-1,d),s&&h.push(p)}else{for(let t=0;t<c;t++)h.push(a[i+t]);if(d>1)for(const t of l){const i=t*c;if(!(a[i+2]<=e)){a[i+2]=e;for(let t=0;t<c;t++)h.push(a[i+t])}}}}return h}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e,i){if(t[e+W]>1){const n=this.clusterProps[t[e+q]];return i?Object.assign({},n):n}const n=this.points[t[e+V]].properties,s=this.options.map(n);return i&&s===n?Object.assign({},s):s}}function X(t,e,i){return{type:"Feature",id:t[e+V],properties:Z(t,e,i),geometry:{type:"Point",coordinates:[(n=t[e],360*(n-.5)),Q(t[e+1])]}};var n}function Z(t,e,i){const n=t[e+W],s=n>=1e4?`${Math.round(n/1e3)}k`:n>=1e3?Math.round(n/100)/10+"k":n,r=t[e+q],o=-1===r?{}:Object.assign({},i[r]);return Object.assign(o,{cluster:!0,cluster_id:t[e+V],point_count:n,point_count_abbreviated:s})}function J(t){return t/360+.5}function K(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function Q(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function tt(t,e,i,n){let s=n;const r=e+(i-e>>1);let o,a=i-e;const h=t[e],c=t[e+1],u=t[i],l=t[i+1];for(let n=e+3;n<i;n+=3){const e=et(t[n],t[n+1],h,c,u,l);if(e>s)o=n,s=e;else if(e===s){const t=Math.abs(n-r);t<a&&(o=n,a=t)}}s>n&&(o-e>3&&tt(t,e,o,n),t[o+2]=s,i-o>3&&tt(t,o,i,n))}function et(t,e,i,n,s,r){let o=s-i,a=r-n;if(0!==o||0!==a){const h=((t-i)*o+(e-n)*a)/(o*o+a*a);h>1?(i=s,n=r):h>0&&(i+=o*h,n+=a*h)}return o=t-i,a=e-n,o*o+a*a}function it(t,e,i,n){const s={id:t??null,type:e,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===e||"MultiPoint"===e||"LineString"===e)nt(s,i);else if("Polygon"===e)nt(s,i[0]);else if("MultiLineString"===e)for(const t of i)nt(s,t);else if("MultiPolygon"===e)for(const t of i)nt(s,t[0]);return s}function nt(t,e){for(let i=0;i<e.length;i+=3)t.minX=Math.min(t.minX,e[i]),t.minY=Math.min(t.minY,e[i+1]),t.maxX=Math.max(t.maxX,e[i]),t.maxY=Math.max(t.maxY,e[i+1])}function st(t,e,i,n){if(!e.geometry)return;const s=e.geometry.coordinates;if(s&&0===s.length)return;const r=e.geometry.type,o=Math.pow(i.tolerance/((1<<i.maxZoom)*i.extent),2);let a=[],h=e.id;if(i.promoteId?h=e.properties[i.promoteId]:i.generateId&&(h=n||0),"Point"===r)rt(s,a);else if("MultiPoint"===r)for(const t of s)rt(t,a);else if("LineString"===r)ot(s,a,o,!1);else if("MultiLineString"===r){if(i.lineMetrics){for(const i of s)a=[],ot(i,a,o,!1),t.push(it(h,"LineString",a,e.properties));return}at(s,a,o,!1)}else if("Polygon"===r)at(s,a,o,!0);else{if("MultiPolygon"!==r){if("GeometryCollection"===r){for(const s of e.geometry.geometries)st(t,{id:h,geometry:s,properties:e.properties},i,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of s){const e=[];at(t,e,o,!0),a.push(e)}}t.push(it(h,r,a,e.properties))}function rt(t,e){e.push(ht(t[0]),ct(t[1]),0)}function ot(t,e,i,n){let s,r,o=0;for(let i=0;i<t.length;i++){const a=ht(t[i][0]),h=ct(t[i][1]);e.push(a,h,0),i>0&&(o+=n?(s*h-a*r)/2:Math.sqrt(Math.pow(a-s,2)+Math.pow(h-r,2))),s=a,r=h}const a=e.length-3;e[2]=1,tt(e,0,a,i),e[a+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function at(t,e,i,n){for(let s=0;s<t.length;s++){const r=[];ot(t[s],r,i,n),e.push(r)}}function ht(t){return t/360+.5}function ct(t){const e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function ut(t,e,i,n,s,r,o,a){if(n/=e,r>=(i/=e)&&o<n)return t;if(o<i||r>=n)return null;const h=[];for(const e of t){const t=e.geometry;let r=e.type;const o=0===s?e.minX:e.minY,c=0===s?e.maxX:e.maxY;if(o>=i&&c<n){h.push(e);continue}if(c<i||o>=n)continue;let u=[];if("Point"===r||"MultiPoint"===r)lt(t,u,i,n,s);else if("LineString"===r)ft(t,u,i,n,s,!1,a.lineMetrics);else if("MultiLineString"===r)pt(t,u,i,n,s,!1);else if("Polygon"===r)pt(t,u,i,n,s,!0);else if("MultiPolygon"===r)for(const e of t){const t=[];pt(e,t,i,n,s,!0),t.length&&u.push(t)}if(u.length){if(a.lineMetrics&&"LineString"===r){for(const t of u)h.push(it(e.id,r,t,e.tags));continue}"LineString"!==r&&"MultiLineString"!==r||(1===u.length?(r="LineString",u=u[0]):r="MultiLineString"),"Point"!==r&&"MultiPoint"!==r||(r=3===u.length?"Point":"MultiPoint"),h.push(it(e.id,r,u,e.tags))}}return h.length?h:null}function lt(t,e,i,n,s){for(let r=0;r<t.length;r+=3){const o=t[r+s];o>=i&&o<=n&&mt(e,t[r],t[r+1],t[r+2])}}function ft(t,e,i,n,s,r,o){let a=dt(t);const h=0===s?_t:vt;let c,u,l=t.start;for(let f=0;f<t.length-3;f+=3){const d=t[f],p=t[f+1],m=t[f+2],_=t[f+3],v=t[f+4],g=0===s?d:p,b=0===s?_:v;let w=!1;o&&(c=Math.sqrt(Math.pow(d-_,2)+Math.pow(p-v,2))),g<i?b>i&&(u=h(a,d,p,_,v,i),o&&(a.start=l+c*u)):g>n?b<n&&(u=h(a,d,p,_,v,n),o&&(a.start=l+c*u)):mt(a,d,p,m),b<i&&g>=i&&(u=h(a,d,p,_,v,i),w=!0),b>n&&g<=n&&(u=h(a,d,p,_,v,n),w=!0),!r&&w&&(o&&(a.end=l+c*u),e.push(a),a=dt(t)),o&&(l+=c)}let f=t.length-3;const d=t[f],p=t[f+1],m=0===s?d:p;m>=i&&m<=n&&mt(a,d,p,t[f+2]),f=a.length-3,r&&f>=3&&(a[f]!==a[0]||a[f+1]!==a[1])&&mt(a,a[0],a[1],a[2]),a.length&&e.push(a)}function dt(t){const e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function pt(t,e,i,n,s,r){for(const o of t)ft(o,e,i,n,s,r,!1)}function mt(t,e,i,n){t.push(e,i,n)}function _t(t,e,i,n,s,r){const o=(r-e)/(n-e);return mt(t,r,i+(s-i)*o,1),o}function vt(t,e,i,n,s,r){const o=(r-i)/(s-i);return mt(t,e+(n-e)*o,r,1),o}function gt(t,e){const i=[];for(let n=0;n<t.length;n++){const s=t[n],r=s.type;let o;if("Point"===r||"MultiPoint"===r||"LineString"===r)o=bt(s.geometry,e);else if("MultiLineString"===r||"Polygon"===r){o=[];for(const t of s.geometry)o.push(bt(t,e))}else if("MultiPolygon"===r){o=[];for(const t of s.geometry){const i=[];for(const n of t)i.push(bt(n,e));o.push(i)}}i.push(it(s.id,r,o,s.tags))}return i}function bt(t,e){const i=[];i.size=t.size,void 0!==t.start&&(i.start=t.start,i.end=t.end);for(let n=0;n<t.length;n+=3)i.push(t[n]+e,t[n+1],t[n+2]);return i}function wt(t,e){if(t.transformed)return t;const i=1<<t.z,n=t.x,s=t.y;for(const r of t.features){const t=r.geometry,o=r.type;if(r.geometry=[],1===o)for(let o=0;o<t.length;o+=2)r.geometry.push(yt(t[o],t[o+1],e,i,n,s));else for(let o=0;o<t.length;o++){const a=[];for(let r=0;r<t[o].length;r+=2)a.push(yt(t[o][r],t[o][r+1],e,i,n,s));r.geometry.push(a)}}return t.transformed=!0,t}function yt(t,e,i,n,s,r){return[Math.round(i*(t*n-s)),Math.round(i*(e*n-r))]}function xt(t,e,i,n,s){const r=e===s.maxZoom?0:s.tolerance/((1<<e)*s.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:i,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const e of t)Mt(o,e,r,s);return o}function Mt(t,e,i,n){const s=e.geometry,r=e.type,o=[];if(t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),"Point"===r||"MultiPoint"===r)for(let e=0;e<s.length;e+=3)o.push(s[e],s[e+1]),t.numPoints++,t.numSimplified++;else if("LineString"===r)Tt(o,s,t,i,!1,!1);else if("MultiLineString"===r||"Polygon"===r)for(let e=0;e<s.length;e++)Tt(o,s[e],t,i,"Polygon"===r,0===e);else if("MultiPolygon"===r)for(let e=0;e<s.length;e++){const n=s[e];for(let e=0;e<n.length;e++)Tt(o,n[e],t,i,!0,0===e)}if(o.length){let i=e.tags||null;if("LineString"===r&&n.lineMetrics){i={};for(const t in e.tags)i[t]=e.tags[t];i.mapbox_clip_start=s.start/s.size,i.mapbox_clip_end=s.end/s.size}const a={geometry:o,type:"Polygon"===r||"MultiPolygon"===r?3:"LineString"===r||"MultiLineString"===r?2:1,tags:i};null!==e.id&&(a.id=e.id),t.features.push(a)}}function Tt(t,e,i,n,s,r){const o=n*n;if(n>0&&e.size<(s?o:n))return void(i.numPoints+=e.length/3);const a=[];for(let t=0;t<e.length;t+=3)(0===n||e[t+2]>o)&&(i.numSimplified++,a.push(e[t],e[t+1])),i.numPoints++;s&&function(t,e){let i=0;for(let e=0,n=t.length,s=n-2;e<n;s=e,e+=2)i+=(t[e]-t[s])*(t[e+1]+t[s+1]);if(i>0===e)for(let e=0,i=t.length;e<i/2;e+=2){const n=t[e],s=t[e+1];t[e]=t[i-2-e],t[e+1]=t[i-1-e],t[i-2-e]=n,t[i-1-e]=s}}(a,r),t.push(a)}const Ot={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Et{constructor(t,e){const i=(e=this.options=function(t,e){for(const i in e)t[i]=e[i];return t}(Object.create(Ot),e)).debug;if(i&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(t,e){const i=[];if("FeatureCollection"===t.type)for(let n=0;n<t.features.length;n++)st(i,t.features[n],e,n);else st(i,"Feature"===t.type?t:{geometry:t},e);return i}(t,e);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(t,e){const i=e.buffer/e.extent;let n=t;const s=ut(t,1,-1-i,i,0,-1,2,e),r=ut(t,1,1-i,2+i,0,-1,2,e);return(s||r)&&(n=ut(t,1,-i,1+i,0,-1,2,e)||[],s&&(n=gt(s,1).concat(n)),r&&(n=n.concat(gt(r,-1)))),n}(n,e),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,e,i,n,s,r,o){const a=[t,e,i,n],h=this.options,c=h.debug;for(;a.length;){n=a.pop(),i=a.pop(),e=a.pop(),t=a.pop();const u=1<<e,l=At(e,i,n);let f=this.tiles[l];if(!f&&(c>1&&console.time("creation"),f=this.tiles[l]=xt(t,e,i,n,h),this.tileCoords.push({z:e,x:i,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const t=`z${e}`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(f.source=t,null==s){if(e===h.indexMaxZoom||f.numPoints<=h.indexMaxPoints)continue}else{if(e===h.maxZoom||e===s)continue;if(null!=s){const t=s-e;if(i!==r>>t||n!==o>>t)continue}}if(f.source=null,0===t.length)continue;c>1&&console.time("clipping");const d=.5*h.buffer/h.extent,p=.5-d,m=.5+d,_=1+d;let v=null,g=null,b=null,w=null,y=ut(t,u,i-d,i+m,0,f.minX,f.maxX,h),x=ut(t,u,i+p,i+_,0,f.minX,f.maxX,h);t=null,y&&(v=ut(y,u,n-d,n+m,1,f.minY,f.maxY,h),g=ut(y,u,n+p,n+_,1,f.minY,f.maxY,h),y=null),x&&(b=ut(x,u,n-d,n+m,1,f.minY,f.maxY,h),w=ut(x,u,n+p,n+_,1,f.minY,f.maxY,h),x=null),c>1&&console.timeEnd("clipping"),a.push(v||[],e+1,2*i,2*n),a.push(g||[],e+1,2*i,2*n+1),a.push(b||[],e+1,2*i+1,2*n),a.push(w||[],e+1,2*i+1,2*n+1)}}getTile(t,e,i){t=+t,e=+e,i=+i;const n=this.options,{extent:s,debug:r}=n;if(t<0||t>24)return null;const o=1<<t,a=At(t,e=e+o&o-1,i);if(this.tiles[a])return wt(this.tiles[a],s);r>1&&console.log("drilling down to z%d-%d-%d",t,e,i);let h,c=t,u=e,l=i;for(;!h&&c>0;)c--,u>>=1,l>>=1,h=this.tiles[At(c,u,l)];return h&&h.source?(r>1&&(console.log("found parent tile z%d-%d-%d",c,u,l),console.time("drilling down")),this.splitTile(h.source,c,u,l,t,e,i),r>1&&console.timeEnd("drilling down"),this.tiles[a]?wt(this.tiles[a],s):null):null}}function At(t,e,i){return 32*((1<<t)*i+e)+t}function St(t,e){const i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);const s=new p(n.features);let r=U(s);0===r.byteOffset&&r.byteLength===r.buffer.byteLength||(r=new Uint8Array(r)),e(null,{vectorTile:s,rawData:r.buffer})}class kt extends c{constructor(t,e,i,n,s,r){super(t,e,i,n,St,r),s&&(this.loadGeoJSON=s),this._dynamicIndex=new v}loadData(i,n){const s=i&&i.request,r=s&&s.collectResourceTiming;this.loadGeoJSON(i,((o,a)=>{if(o||!a)return n(o);if("object"!=typeof a)return n(new Error(`Input data given to '${i.source}' is not a valid GeoJSON object.`));{try{if(i.filter){const e=t.z(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===e.result)throw new Error(e.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a.features=a.features.filter((t=>e.value.evaluate({zoom:0},t)))}i.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),i.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),i.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=i.cluster?new Y(function({superclusterOptions:e,clusterProperties:i}){if(!i||!e)return e;const n={},s={},r={accumulated:null,zoom:0},o={properties:null},a=Object.keys(i);for(const e of a){const[r,o]=i[e],a=t.z(o),h=t.z("string"==typeof r?[r,["accumulated"],["get",e]]:r);n[e]=a.value,s[e]=h.value}return e.map=t=>{o.properties=t;const e={};for(const t of a)e[t]=n[t].evaluate(r,o);return e},e.reduce=(t,e)=>{o.properties=e;for(const e of a)r.accumulated=t[e],t[e]=s[e].evaluate(r,o)},e}(i)).load(a.features):i.dynamic?this._dynamicIndex:function(t,e){return new Et(t,e)}(a,i.geojsonVtOptions)}catch(t){return n(t)}const o={};if(r){const t=e(s);t&&(o.resourceTiming={},o.resourceTiming[i.source]=JSON.parse(JSON.stringify(t)))}n(null,o)}}))}reloadTile(t,e){const i=this.loaded;return i&&i[t.uid]?t.partial?e(null,void 0):super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,i){if(e.request)t.h(e.request,i);else{if("string"!=typeof e.data)return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return i(null,JSON.parse(e.data))}catch(t){return i(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class It{constructor(e,i){this.tileID=new t.aQ(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=e.projection,this.brightness=i}parse(e,i,n,s){this.status="parsing";const r=new t.aQ(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),o={},a=i.familiesBySource[n.source],h=new t.dQ(r,n.promoteId);return h.bucketLayerIDs=[],h.is3DTile=!0,t.e6(e).then((e=>{if(!e)return s(new Error("Could not parse tile"));const i=t.e7(e,1/t.b7(n.tileID.canonical)),c=e.json.extensionsUsed&&e.json.extensionsUsed.includes("MAPBOX_mesh_features")||e.json.asset.extras&&e.json.asset.extras.MAPBOX_mesh_features,u=e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression"),l=new t.Y(this.zoom,{brightness:this.brightness});for(const e in a)for(const n of a[e]){const e=n[0];h.bucketLayerIDs.push(n.map((t=>t.id))),e.recalculate(l,[]);const s=new t.e8(i,r,c,u,this.brightness,h);c||(s.needsUpload=!0),o[e.fqid]=s,s.evaluate(e)}this.status="done",s(null,{buckets:o,featureIndex:h})})).catch((t=>s(new Error(t.message))))}}class Ct{constructor(t,e,i,n,s,r){this.actor=t,this.layerIndex=e,this.brightness=r,this.loading={},this.loaded={}}loadTile(e,i){const n=e.uid,s=this.loading[n]=new It(e,this.brightness);t.e5(e.request,((t,r)=>{const o=!this.loading[n];return delete this.loading[n],o||t?(s.status="done",o||(this.loaded[n]=s),i(t)):r&&0!==r.byteLength?void s.parse(r,this.layerIndex,e,((t,e)=>{s.status="done",this.loaded=this.loaded||{},this.loaded[n]=s,t||!e?i(t):i(null,e)})):(s.status="done",this.loaded[n]=s,i())}))}reloadTile(t,e){const i=this.loaded,n=t.uid;if(i&&i[n]){const s=i[n];s.projection=t.projection,s.brightness=t.brightness;const r=(i,n)=>{s.reloadCallback&&(delete s.reloadCallback,this.loadTile(t,e)),e(i,n)};"parsing"===s.status?s.reloadCallback=r:"done"===s.status&&this.loadTile(t,e)}}abortTile(t,e){const i=t.uid;this.loading[i]&&delete this.loading[i],e()}removeTile(t,e){const i=this.loaded,n=t.uid;i&&i[n]&&delete i[n],e()}}class jt{constructor(e){this.self=e,this.actor=new t.e9(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.aK({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:kt,"batched-model":Ct},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.ea.isParsed())throw new Error("RTL text plugin already registered.");t.ea.applyArabicShaping=e.applyArabicShaping,t.ea.processBidirectionalText=e.processBidirectionalText,t.ea.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,i){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],delete this.rasterArrayWorkerSource,i()}checkIfReady(t,e,i){i()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,{scope:i,isLoaded:n}){if(this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),this.isSpriteLoaded[e][i]=n,this.workerSources[e]&&this.workerSources[e][i])for(const s in this.workerSources[e][i]){const r=this.workerSources[e][i][s];for(const e in r){const i=r[e];i instanceof c&&(i.isSpriteLoaded=n,i.fire(new t.g("isSpriteLoaded")))}}}setImages(t,{scope:e,images:i},n){if(this.availableImages[t]||(this.availableImages[t]={}),this.availableImages[t][e]=i,this.workerSources[t]&&this.workerSources[t][e]){for(const n in this.workerSources[t][e]){const s=this.workerSources[t][e][n];for(const t in s)s[t].availableImages=i}n()}else n()}setProjection(e,i){this.projections[e]=t.aK(i)}setBrightness(t,e,i){this.brightness=e,i()}setLayers(t,e,i){this.getLayerIndex(t,e.scope).replace(e.layers,e.options),i()}updateLayers(t,e,i){this.getLayerIndex(t,e.scope).update(e.layers,e.removedIds,e.options),i()}loadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).loadTile(e,i)}loadDEMTile(t,e,i){this.getDEMWorkerSource(t,e.source,e.scope).loadTile(e,i)}decodeRasterArray(t,e,i){this.getRasterArrayWorkerSource().decodeRasterArray(e,i)}reloadTile(t,e,i){e.projection=this.projections[t]||this.defaultProjection,this.getWorkerSource(t,e.type,e.source,e.scope).reloadTile(e,i)}abortTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).abortTile(e,i)}removeTile(t,e,i){this.getWorkerSource(t,e.type,e.source,e.scope).removeTile(e,i)}removeSource(t,e,i){if(!(this.workerSources[t]&&this.workerSources[t][e.scope]&&this.workerSources[t][e.scope][e.type]&&this.workerSources[t][e.scope][e.type][e.source]))return;const n=this.workerSources[t][e.scope][e.type][e.source];delete this.workerSources[t][e.scope][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,i):i()}loadWorkerSource(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t.toString())}}syncRTLPluginState(e,i,n){try{t.ea.setState(i);const e=t.ea.getPluginURL();if(t.ea.isLoaded()&&!t.ea.isParsed()&&null!=e){this.self.importScripts(e);const i=t.ea.isParsed();n(i?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),i)}}catch(t){n(t.toString())}}setDracoUrl(t,e){this.dracoUrl=e}getAvailableImages(t,e){this.availableImages[t]||(this.availableImages[t]={});let i=this.availableImages[t][e];return i||(i=[]),i}getLayerIndex(t,e){this.layerIndexes[t]||(this.layerIndexes[t]={});let i=this.layerIndexes[t][e];return i||(i=this.layerIndexes[t][e]=new s,i.scope=e),i}getWorkerSource(t,e,i,n){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][n]||(this.workerSources[t][n]={}),this.workerSources[t][n][e]||(this.workerSources[t][n][e]={}),this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.workerSources[t][n][e][i]||(this.workerSources[t][n][e][i]=new this.workerSourceTypes[e]({send:(e,i,n,s,r,o)=>{this.actor.send(e,i,n,t,r,o)},scheduler:this.actor.scheduler},this.getLayerIndex(t,n),this.getAvailableImages(t,n),this.isSpriteLoaded[t][n],void 0,this.brightness)),this.workerSources[t][n][e][i]}getDEMWorkerSource(t,e,i){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][i]||(this.demWorkerSources[t][i]={}),this.demWorkerSources[t][i][e]||(this.demWorkerSources[t][i][e]=new u),this.demWorkerSources[t][i][e]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new l),this.rasterArrayWorkerSource}enforceCacheSizeLimit(e,i){t.eb(i)}getWorkerPerformanceMetrics(t,e,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new jt(self)),jt}));n(["./shared"],(function(t){var e=i;function i(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,i=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(i);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var i=e.getImageData(0,0,1,1);return i&&i.width===t.width}()?(void 0===n[e=t&&t.failIfMajorPerformanceCaveat]&&(n[e]=function(t){var e,n=function(t){var e=document.createElement("canvas"),n=Object.create(i.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,e.getContext("webgl2",n)}(t);if(!n)return!1;try{e=n.createShader(n.VERTEX_SHADER)}catch(t){return!1}return!(!e||n.isContextLost())&&(n.shaderSource(e,"void main() {}"),n.compileShader(e),!0===n.getShaderParameter(e,n.COMPILE_STATUS))}(e)),n[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var e}(t)}var n={};function s(t,e,i){const n=document.createElement(t);return null!=e&&(n.className=e),i&&i.appendChild(n),n}function r(t,e,i){const n=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of Object.keys(e))n.setAttributeNS(null,t,String(e[t]));return i&&i.appendChild(n),n}i.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const o="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,a=o&&void 0!==o.userSelect?"userSelect":"WebkitUserSelect";let h;function c(){o&&a&&(h=o[a],o[a]="none")}function u(){o&&a&&(o[a]=h)}function l(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",l,!0)}function f(){window.addEventListener("click",l,!0),window.setTimeout((()=>{window.removeEventListener("click",l,!0)}),0)}function d(t,e){const i=t.getBoundingClientRect();return _(t,i,e)}function p(t,e){const i=t.getBoundingClientRect(),n=[];for(let s=0;s<e.length;s++)n.push(_(t,i,e[s]));return n}function m(t){return void 0!==window.InstallTrigger&&2===t.button&&t.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function _(e,i,n){const s=e.offsetWidth===i.width?1:e.offsetWidth/i.width;return new t.P((n.clientX-i.left)*s,(n.clientY-i.top)*s)}class v{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,e){this._updatedSourceCaches[t]=e,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const e=t.scope;this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._updatedLayers[e].add(t.id),this.setDirty()}removeLayer(t){const e=t.scope;this._removedLayers[e]=this._removedLayers[e]||{},this._updatedLayers[e]=this._updatedLayers[e]||new Set,this._removedLayers[e][t.id]=t,this._updatedLayers[e].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const e in this._updatedLayers)t[e]=t[e]||{},t[e].updatedIds=Array.from(this._updatedLayers[e].values());for(const e in this._removedLayers)t[e]=t[e]||{},t[e].removedIds=Object.keys(this._removedLayers[e]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(t),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const g={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class b{constructor(t,e,i,n,s,r){this.length=e.length,this.attributes=i,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.instanceCount=r,this.context=t;const o=t.gl;this.buffer=o.createBuffer(),t.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||s||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let i=0;i<this.attributes.length;i++){const n=e.attributes[this.attributes[i].name];void 0!==n&&t.enableVertexAttribArray(n)}}setVertexAttribPointers(t,e,i){for(let n=0;n<this.attributes.length;n++){const s=this.attributes[n],r=e.attributes[s.name];void 0!==r&&t.vertexAttribPointer(r,s.components,t[g[s.type]],!1,this.itemSize,s.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(t,e,i){for(let n=0;n<this.attributes.length;n++){const s=e.attributes[this.attributes[n].name];void 0!==s&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(s,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class w{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class y extends w{getDefault(){return t.C.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class x extends w{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class M extends w{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class T extends w{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class O extends w{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class E extends w{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class A extends w{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class S extends w{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class k extends w{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class I extends w{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class C extends w{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class j extends w{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class D extends w{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class R extends w{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class P extends w{getDefault(){return t.C.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class N extends w{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class F extends w{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class z extends w{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class L extends w{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let $=class extends w{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class U extends w{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class B extends w{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class G extends w{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class H extends w{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class V extends w{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class W extends w{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class q extends w{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Y extends w{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class X extends w{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Z extends w{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class J extends w{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class K extends w{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class Q extends K{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class tt extends K{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class et extends K{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,this.attachment(),e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class it extends tt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class nt{constructor(t,e,i,n,s){this.context=t,this.width=e,this.height=i;const r=this.framebuffer=t.gl.createFramebuffer();n&&(this.colorAttachment=new Q(t,r)),s&&(this.depthAttachmentType=s,this.depthAttachment="renderbuffer"===s?new tt(t,r):new et(t,r))}destroy(){const t=this.context.gl;if(this.colorAttachment){const e=this.colorAttachment.get();e&&t.deleteTexture(e)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}else{const e=this.depthAttachment.get();e&&t.deleteTexture(e)}t.deleteFramebuffer(this.framebuffer)}}class st{constructor(t,e){this.gl=t,this.clearColor=new y(this),this.clearDepth=new x(this),this.clearStencil=new M(this),this.colorMask=new T(this),this.depthMask=new O(this),this.stencilMask=new E(this),this.stencilFunc=new A(this),this.stencilOp=new S(this),this.stencilTest=new k(this),this.depthRange=new I(this),this.depthTest=new C(this),this.depthFunc=new j(this),this.blend=new D(this),this.blendFunc=new R(this),this.blendColor=new P(this),this.blendEquation=new N(this),this.cullFace=new F(this),this.cullFaceSide=new z(this),this.frontFace=new L(this),this.program=new $(this),this.activeTexture=new U(this),this.viewport=new B(this),this.bindFramebuffer=new G(this),this.bindRenderbuffer=new H(this),this.bindTexture=new V(this),this.bindVertexBuffer=new W(this),this.bindElementBuffer=new q(this),this.bindVertexArrayOES=new Y(this),this.pixelStoreUnpack=new X(this),this.pixelStoreUnpackPremultiplyAlpha=new Z(this),this.pixelStoreUnpackFlipY=new J(this),this.options=e?{...e}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,i,n){return new t.I(this,e,i,n)}createVertexBuffer(t,e,i,n,s){return new b(this,t,e,i,n,s)}createRenderbuffer(t,e,i){const n=this.gl,s=n.createRenderbuffer();return this.bindRenderbuffer.set(s),n.renderbufferStorage(n.RENDERBUFFER,t,e,i),this.bindRenderbuffer.set(null),s}createFramebuffer(t,e,i,n){return new nt(this,t,e,i,n)}clear({color:t,depth:e,stencil:i,colorMask:n}){const s=this.gl;let r=0;t&&(r|=s.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==e&&(r|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==i&&(r|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),s.clear(r)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.d(e.blendFunction,t.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class rt{constructor(e,i,n,s){const r={width:n[0],height:n[1],data:null},o=e.gl;this.targetColorTexture=new t.T(e,r,o.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new t.T(e,r,o.RGBA,{useMipmap:!1}),this.context=e,this.updateParticleTexture(i,s),this.lastInvalidatedAt=0}updateParticleTexture(e,i){if(this.particleTextureDimension===i.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const n=this.context.gl,s=i.width*i.height;this.particleTexture0=new t.T(this.context,i,n.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,i,n.RGBA,{premultiply:!1,useMipmap:!1});const r=new t.S;r.reserve(s);for(let t=0;t<s;t++)r.emplaceBack(t);this.particleIndexBuffer=this.context.createVertexBuffer(r,t.p.members,!0),this.particleSegment=t.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i.width}update(e){return!(this.lastInvalidatedAt<e&&(this.lastInvalidatedAt=t.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class ot extends t.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.numModelsLoading={}}loadModel(e,i){return t.l(this.requestManager.transformRequest(i,t.R.Model).url).then((i=>{if(!i)return;const n=t.c(i),s=new t.M(e,void 0,void 0,n);return s.computeBoundsAndApplyParent(),s})).catch((n=>{if(n&&404===n.status)return null;this.fire(new t.f(new Error(`Could not load model ${e} from ${i}: ${n.message}`)))}))}load(e,i){this.models[i]||(this.models[i]={});const n=Object.keys(e);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+n.length;const s=[];for(const t of n)s.push(this.loadModel(t,e[t]));Promise.allSettled(s).then((e=>{for(let t=0;t<e.length;t++){const{status:s,value:r}=e[t];"fulfilled"===s&&r&&(this.models[i][n[t]]={model:r,numReferences:1})}this.numModelsLoading[i]-=n.length,this.fire(new t.g("data",{dataType:"style"}))})).catch((e=>{this.fire(new t.f(new Error(`Could not load models: ${e.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,e){return!!this.getModel(t,e)}getModel(t,e){return this.models[e]||(this.models[e]={}),this.models[e][t]?this.models[e][t].model:void 0}addModel(t,e,i){this.models[i]||(this.models[i]={}),this.hasModel(t,i)&&this.models[i][t].numReferences++,this.load({[t]:this.requestManager.normalizeModelURL(e)},i)}addModels(t,e){this.models[e]||(this.models[e]={});const i={};for(const n in t)this.models[e][n]={},i[n]=this.requestManager.normalizeModelURL(t[n]);this.load(i,e)}addModelsFromBucket(t,e){this.models[e]||(this.models[e]={});const i={};for(const n of t)this.hasModel(n,e)?this.models[e][n].numReferences++:i[n]=this.requestManager.normalizeModelURL(n);this.load(i,e)}removeModel(t,e){if(this.models[e]&&this.models[e][t]&&(this.models[e][t].numReferences--,0===this.models[e][t].numReferences)){const i=this.models[e][t].model;delete this.models[e][t],i.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,e){this.models[e]||(this.models[e]={});for(const i in this.models[e])this.models[e][i].model&&this.models[e][i].model.upload(t.context)}}function at(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class ht extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new t.j({width:1,height:1})}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,e){if(this.loaded[e]!==t&&(this.loaded[e]=t,t)){for(const{ids:t,callback:i}of this.requestors)this._notify(t,e,i);this.requestors=[]}}hasImage(t,e){return!!this.getImage(t,e)}getImage(t,e){return this.images[e][t]}addImage(t,e,i){this._validate(t,i)&&(this.images[e][t]=i)}_validate(e,i){let n=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new t.f(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new t.f(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(i.content,i)||(this.fire(new t.f(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(t,e){if(!t)return!0;let i=0;for(const n of t){if(n[0]<i||n[1]<n[0]||e<n[1])return!1;i=n[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e,i){i.version=this.images[e][t].version+1,this.images[e][t]=i,this.updatedImages[e][t]=!0}removeImage(t,e){const i=this.images[e][t];delete this.images[e][t],delete this.patterns[e][t],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(t){return Object.keys(this.images[t])}getImages(t,e,i){let n=!0;const s=!!this.loaded[e];if(!s)for(const i of t)this.images[e][i]||(n=!1);s||n?this._notify(t,e,i):this.requestors.push({ids:t,scope:e,callback:i})}getUpdatedImages(t){return this.updatedImages[t]}_notify(e,i,n){const s={};for(const n of e){this.images[i][n]||this.fire(new t.g("styleimagemissing",{id:n}));const e=this.images[i][n];e?s[n]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,s)}getPixelSize(t){const{width:e,height:i}=this.atlasImage[t];return{width:e,height:i}}getPattern(e,i,n){const s=this.patterns[i][e],r=this.getImage(e,i);if(!r)return null;if(s&&s.position.version===r.version)return s.position;if(s)s.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},s=new t.m(n,r);this.patterns[i][e]={bin:n,position:s}}return this._updatePatternAtlas(i,n),this.patterns[i][e].position}bind(e,i){const n=e.gl;let s=this.atlasTexture[i];s?this.dirty&&(s.update(this.atlasImage[i]),this.dirty=!1):(s=new t.T(e,this.atlasImage[i],n.RGBA),this.atlasTexture[i]=s),s.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(e,i){const n=[];for(const t in this.patterns[e])n.push(this.patterns[e][t].bin);const{w:s,h:r}=t.k(n),o=this.atlasImage[e];o.resize({width:s||1,height:r||1});for(const n in this.patterns[e]){const{bin:s}=this.patterns[e][n],r=s.x+1,a=s.y+1,h=this.images[e][n].data,c=h.width,u=h.height;t.j.copy(h,o,{x:0,y:0},{x:r,y:a},{width:c,height:u},i),t.j.copy(h,o,{x:0,y:u-1},{x:r,y:a-1},{width:c,height:1},i),t.j.copy(h,o,{x:0,y:0},{x:r,y:a+u},{width:c,height:1},i),t.j.copy(h,o,{x:c-1,y:0},{x:r-1,y:a},{width:1,height:u},i),t.j.copy(h,o,{x:0,y:0},{x:r+c,y:a},{width:1,height:u},i)}this.dirty=!0}beginFrame(){for(const t in this.images)this.callbackDispatchedThisFrame[t]={}}dispatchRenderCallbacks(t,e){for(const i of t){if(this.callbackDispatchedThisFrame[e][i])continue;this.callbackDispatchedThisFrame[e][i]=!0;const t=this.images[e][i];at(t)&&this.updateImage(i,e,t)}}}function ct(e){const i=e.key,n=e.value,s=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,a=e.styleSpec;let h=[];const c=t.o(n);if("object"!==c)return[new t.V(i,n,`object expected, ${c} found`)];for(const e in n){const c=e.split(".")[0];let u;r[c]?u=r[c]:s[c]?u=Ct:r["*"]?u=r["*"]:s["*"]&&(u=Ct),u?h=h.concat(u({key:(i?`${i}.`:i)+e,value:n[e],valueSpec:s[c]||s["*"],style:o,styleSpec:a,object:n,objectKey:e},n)):h.push(new t.n(i,n[e],`unknown property "${e}"`))}for(const e in s)r[e]||s[e].required&&void 0===s[e].default&&void 0===n[e]&&h.push(new t.V(i,n,`missing required property "${e}"`));return h}function ut(e){const i=e.value,n=e.valueSpec,s=e.style,r=e.styleSpec,o=e.key,a=e.arrayElementValidator||Ct;if("array"!==t.o(i))return[new t.V(o,i,`array expected, ${t.o(i)} found`)];if(n.length&&i.length!==n.length)return[new t.V(o,i,`array length ${n.length} expected, length ${i.length} found`)];if(n["min-length"]&&i.length<n["min-length"])return[new t.V(o,i,`array length at least ${n["min-length"]} expected, length ${i.length} found`)];let h={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(h.function=n.function),"object"===t.o(n.value)&&(h=n.value);let c=[];for(let t=0;t<i.length;t++)c=c.concat(a({array:i,arrayIndex:t,value:i[t],valueSpec:h,style:s,styleSpec:r,key:`${o}[${t}]`},!0));return c}function lt(e){const i=e.key,n=e.value,s=e.valueSpec;let r=t.o(n);if("number"===r&&n!=n&&(r="NaN"),"number"!==r)return[new t.V(i,n,`number expected, ${r} found`)];if("minimum"in s){let r=s.minimum;if("array"===t.o(s.minimum)&&(r=s.minimum[e.arrayIndex]),n<r)return[new t.V(i,n,`${n} is less than the minimum value ${r}`)]}if("maximum"in s){let r=s.maximum;if("array"===t.o(s.maximum)&&(r=s.maximum[e.arrayIndex]),n>r)return[new t.V(i,n,`${n} is greater than the maximum value ${r}`)]}return[]}function ft(e){const i=e.valueSpec,n=t.u(e.value.type);let s,r,o,a={};const h="categorical"!==n&&void 0===e.value.property,c=!h,u="array"===t.o(e.value.stops)&&"array"===t.o(e.value.stops[0])&&"object"===t.o(e.value.stops[0][0]),l=ct({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new t.V(e.key,e.value,'identity function may not have a "stops" property')];let i=[];const s=e.value;return i=i.concat(ut({key:e.key,value:s,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:f})),"array"===t.o(s)&&0===s.length&&i.push(new t.V(e.key,s,"array must have at least one stop")),i},default:function(t){return Ct({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&h&&l.push(new t.V(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||l.push(new t.V(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!t.s(e.valueSpec)&&l.push(new t.V(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(c&&!t.r(e.valueSpec)?l.push(new t.V(e.key,e.value,"property functions not supported")):h&&!t.t(e.valueSpec)&&l.push(new t.V(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!u||void 0!==e.value.property||l.push(new t.V(e.key,e.value,'"property" property is required')),l;function f(e){let n=[];const s=e.value,h=e.key;if("array"!==t.o(s))return[new t.V(h,s,`array expected, ${t.o(s)} found`)];if(2!==s.length)return[new t.V(h,s,`array length 2 expected, length ${s.length} found`)];if(u){if("object"!==t.o(s[0]))return[new t.V(h,s,`object expected, ${t.o(s[0])} found`)];if(void 0===s[0].zoom)return[new t.V(h,s,"object stop key must have zoom")];if(void 0===s[0].value)return[new t.V(h,s,"object stop key must have value")];const i=t.u(s[0].zoom);if("number"!=typeof i)return[new t.V(h,s[0].zoom,"stop zoom values must be numbers")];if(o&&o>i)return[new t.V(h,s[0].zoom,"stop zoom values must appear in ascending order")];i!==o&&(o=i,r=void 0,a={}),n=n.concat(ct({key:`${h}[0]`,value:s[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:lt,value:d}}))}else n=n.concat(d({key:`${h}[0]`,value:s[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},s));return t.v(t.x(s[1]))?n.concat([new t.V(`${h}[1]`,s[1],"expressions are not allowed in function stops.")]):n.concat(Ct({key:`${h}[1]`,value:s[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const h=t.o(e.value),c=t.u(e.value),u=null!==e.value?e.value:o;if(s){if(h!==s)return[new t.V(e.key,u,`${h} stop domain type must match previous stop domain type ${s}`)]}else s=h;if("number"!==h&&"string"!==h&&"boolean"!==h&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new t.V(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==h&&"categorical"!==n){let s=`number expected, ${h} found`;return t.r(i)&&void 0===n&&(s+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(e.key,u,s)]}return"categorical"!==n||"number"!==h||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==n&&"number"===h&&"number"==typeof c&&"number"==typeof r&&void 0!==r&&c<r?[new t.V(e.key,u,"stop domain values must appear in ascending order")]:(r=c,"categorical"===n&&c in a?[new t.V(e.key,u,"stop domain values must be unique")]:(a[c]=!0,[])):[new t.V(e.key,u,`integer expected, found ${String(c)}`)]}}function dt(e){const i=("property"===e.expressionContext?t.y:t.z)(t.x(e.value),e.valueSpec);if("error"===i.result)return i.value.map((i=>new t.V(`${e.key}${i.key}`,e.value,i.message)));const n=i.value.expression||i.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new t.V(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!t.A(n))return[new t.V(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return pt(n,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!t.B(n,["zoom","feature-state"]))return[new t.V(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!t.D(n))return[new t.V(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pt(e,i){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const t of i.valueSpec.expression.parameters)n.delete(t);if(0===n.size)return[];const s=[];return e instanceof t.F&&n.has(e.name)?[new t.V(i.key,i.value,`["${e.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(e.eachChild((t=>{s.push(...pt(t,i))})),s)}function mt(e){const i=e.key,n=e.value,s=e.valueSpec,r=[];return Array.isArray(s.values)?-1===s.values.indexOf(t.u(n))&&r.push(new t.V(i,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(t.u(n))&&r.push(new t.V(i,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function _t(e){return t.H(t.x(e.value))?dt(t.q({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):vt(e)}function vt(e){const i=e.value,n=e.key;if("array"!==t.o(i))return[new t.V(n,i,`array expected, ${t.o(i)} found`)];const s=e.styleSpec;let r,o=[];if(i.length<1)return[new t.V(n,i,"filter array must have at least 1 element")];switch(o=o.concat(mt({key:`${n}[0]`,value:i[0],valueSpec:s.filter_operator,style:e.style,styleSpec:e.styleSpec})),t.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===t.u(i[1])&&o.push(new t.V(n,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&o.push(new t.V(n,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(r=t.o(i[1]),"string"!==r&&o.push(new t.V(`${n}[1]`,i[1],`string expected, ${r} found`)));for(let a=2;a<i.length;a++)r=t.o(i[a]),"$type"===t.u(i[1])?o=o.concat(mt({key:`${n}[${a}]`,value:i[a],valueSpec:s.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new t.V(`${n}[${a}]`,i[a],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let t=1;t<i.length;t++)o=o.concat(vt({key:`${n}[${t}]`,value:i[t],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=t.o(i[1]),2!==i.length?o.push(new t.V(n,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new t.V(`${n}[1]`,i[1],`string expected, ${r} found`))}return o}function gt(e,i){const n=e.key,s=e.style,r=e.layer,o=e.styleSpec,a=e.value,h=e.objectKey,c=o[`${i}_${e.layerType}`];if(!c)return[];const u=h.match(/^(.*)-transition$/);if("paint"===i&&u&&c[u[1]]&&c[u[1]].transition)return Ct({key:n,value:a,valueSpec:o.transition,style:s,styleSpec:o});const l=e.valueSpec||c[h];if(!l)return[new t.n(n,a,`unknown property "${h}"`)];let f;if("string"===t.o(a)&&t.r(l)&&!l.tokens&&(f=/^{([^}]+)}$/.exec(a))){const e=`\`{ "type": "identity", "property": ${f?JSON.stringify(f[1]):'"_"'} }\``;return[new t.V(n,a,`"${h}" does not support interpolation syntax\nUse an identity property function instead: ${e}.`)]}const d=[];if("symbol"===e.layerType)"text-field"!==h||!s||s.glyphs||s.imports||d.push(new t.V(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===h&&t.J(t.x(a))&&"identity"===t.u(a.type)&&d.push(new t.V(n,a,'"text-font" does not support identity functions'));else if("model"===e.layerType&&"paint"===i&&r&&r.layout&&r.layout.hasOwnProperty("model-id")&&t.r(l)&&(t.K(l)||t.t(l))){const e=t.y(t.x(a),l),i=e.value.expression||e.value._styleExpression.expression;i&&!t.B(i,["measure-light"])&&("model-emissive-strength"===h&&t.D(i)&&t.A(i)||d.push(new t.V(n,a,`${h} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return d.concat(Ct({key:e.key,value:a,valueSpec:l,style:s,styleSpec:o,expressionContext:"property",propertyType:i,propertyKey:h}))}function bt(t){return gt(t,"paint")}function wt(t){return gt(t,"layout")}function yt(e){let i=[];const n=e.value,s=e.key,r=e.style,o=e.styleSpec;n.type||n.ref||i.push(new t.V(s,n,'either "type" or "ref" is required'));let a=t.u(n.type);const h=t.u(n.ref);if(n.id){const o=t.u(n.id);for(let a=0;a<e.arrayIndex;a++){const e=r.layers[a];t.u(e.id)===o&&i.push(new t.V(s,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&i.push(new t.V(s,n[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((i=>{t.u(i.id)===h&&(e=i)})),e?e.ref?i.push(new t.V(s,n.ref,"ref cannot reference another ref layer")):a=t.u(e.type):"string"==typeof h&&i.push(new t.V(s,n.ref,`ref layer "${h}" not found`))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&t.u(e.type);e?"vector"===o&&"raster"===a?i.push(new t.V(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==a?i.push(new t.V(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==a?i.push(new t.V(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==o||["raster","raster-particle"].includes(a)?"line"!==a||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===o&&e.lineMetrics?"raster-particle"===a&&"raster-array"!==o&&i.push(new t.V(s,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):i.push(new t.V(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new t.V(s,n.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new t.V(s,n,`layer "${n.id}" must specify a "source-layer"`)):i.push(new t.V(s,n.source,`source "${n.source}" not found`))}else i.push(new t.V(s,n,'missing required property "source"'));return i=i.concat(ct({key:s,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ct({key:`${s}.type`,value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"}),filter:e=>_t(t.q({layerType:a},e)),layout:e=>ct({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>wt(t.q({layerType:a},e))}}),paint:e=>ct({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>bt(t.q({layerType:a,layer:n},e))}})}})),i}function xt(e){const i=e.value,n=e.key,s=t.o(i);return"string"!==s?[new t.V(n,i,`string expected, ${s} found`)]:[]}const Mt={promoteId:function({key:e,value:i}){if("string"===t.o(i))return xt({key:e,value:i});{const t=[];for(const n in i)t.push(...xt({key:`${e}.${n}`,value:i[n]}));return t}}};function Tt(e){const i=e.value,n=e.key,s=e.styleSpec,r=e.style;if(!i.type)return[new t.V(n,i,'"type" is required')];const o=t.u(i.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(o)&&(i.url||i.tiles||a.push(new t.n(n,i,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(ct({key:n,value:i,valueSpec:s[`source_${o.replace("-","_")}`],style:e.style,styleSpec:s,objectElementValidators:Mt})),a;case"geojson":if(a=ct({key:n,value:i,valueSpec:s.source_geojson,style:r,styleSpec:s,objectElementValidators:Mt}),i.cluster)for(const t in i.clusterProperties){const[e,s]=i.clusterProperties[t],r="string"==typeof e?[e,["accumulated"],["get",t]]:e;a.push(...dt({key:`${n}.${t}.map`,value:s,expressionContext:"cluster-map"})),a.push(...dt({key:`${n}.${t}.reduce`,value:r,expressionContext:"cluster-reduce"}))}return a;case"video":return ct({key:n,value:i,valueSpec:s.source_video,style:r,styleSpec:s});case"image":return ct({key:n,value:i,valueSpec:s.source_image,style:r,styleSpec:s});case"canvas":return[new t.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mt({key:`${n}.type`,value:i.type,valueSpec:{values:Ot(s)},style:r,styleSpec:s})}}function Ot(t){return t.source.reduce(((e,i)=>{const n=t[i];return"enum"===n.type.type&&(e=e.concat(Object.keys(n.type.values))),e}),[])}function Et(e){const i=e.value,n=e.styleSpec,s=n.light,r=e.style;let o=[];const a=t.o(i);if(void 0===i)return o;if("object"!==a)return o=o.concat([new t.V("light",i,`object expected, ${a} found`)]),o;for(const e in i){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&s[a[1]]&&s[a[1]].transition?Ct({key:e,value:i[e],valueSpec:n.transition,style:r,styleSpec:n}):s[e]?Ct({key:e,value:i[e],valueSpec:s[e],style:r,styleSpec:n}):[new t.V(e,i[e],`unknown property "${e}"`)])}return o}function At(e){const i=e.value;let n=[];if(!i)return n;const s=t.o(i);if("object"!==s)return n=n.concat([new t.V("light-3d",i,`object expected, ${s} found`)]),n;const r=e.styleSpec,o=r["light-3d"],a=e.key,h=e.style,c=e.style.lights;for(const e of["type","id"])if(!(e in i))return n=n.concat([new t.V("light-3d",i,`missing property ${e} on light`)]),n;if(i.type&&c)for(let s=0;s<e.arrayIndex;s++){const e=t.u(i.type),r=c[s];t.u(r.type)===e&&n.push(new t.V(a,i.id,`duplicate light type "${i.type}", previously defined at line ${r.id.__line__}`))}const u=`properties_light_${i.type}`;if(!(u in r))return n=n.concat([new t.V("light-3d",i,`Invalid light type ${i.type}`)]),n;const l=r[u];for(const s in i)if("properties"===s){const o=i[s],a=t.o(o);if("object"!==a)return n=n.concat([new t.V("properties",o,`object expected, ${a} found`)]),n;for(const i in o)n=n.concat(l[i]?Ct({key:i,value:o[i],valueSpec:l[i],style:h,styleSpec:r}):[new t.n(e.key,o[i],`unknown property "${i}"`)])}else{const e=s.match(/^(.*)-transition$/);n=n.concat(e&&o[e[1]]&&o[e[1]].transition?Ct({key:s,value:i[s],valueSpec:r.transition,style:h,styleSpec:r}):o[s]?Ct({key:s,value:i[s],valueSpec:o[s],style:h,styleSpec:r}):[new t.n(s,i[s],`unknown property "${s}"`)])}return n}function St(e){const i=e.value,n=e.key,s=e.style,r=e.styleSpec,o=r.terrain;let a=[];const h=t.o(i);if(void 0===i)return a;if("null"===h)return a;if("object"!==h)return a=a.concat([new t.V("terrain",i,`object expected, ${h} found`)]),a;for(const e in i){const n=e.match(/^(.*)-transition$/);a=a.concat(n&&o[n[1]]&&o[n[1]].transition?Ct({key:e,value:i[e],valueSpec:r.transition,style:s,styleSpec:r}):o[e]?Ct({key:e,value:i[e],valueSpec:o[e],style:s,styleSpec:r}):[new t.n(e,i[e],`unknown property "${e}"`)])}if(i.source){const e=s.sources&&s.sources[i.source],r=e&&t.u(e.type);e?"raster-dem"!==r&&a.push(new t.V(n,i.source,`terrain cannot be used with a source of type ${String(r)}, it only be used with a "raster-dem" source type`)):a.push(new t.V(n,i.source,`source "${i.source}" not found`))}else a.push(new t.V(n,i,'terrain is missing required property "source"'));return a}function kt(e){const i=e.value,n=e.style,s=e.styleSpec,r=s.fog;let o=[];const a=t.o(i);if(void 0===i)return o;if("object"!==a)return o=o.concat([new t.V("fog",i,`object expected, ${a} found`)]),o;for(const e in i){const a=e.match(/^(.*)-transition$/);o=o.concat(a&&r[a[1]]&&r[a[1]].transition?Ct({key:e,value:i[e],valueSpec:s.transition,style:n,styleSpec:s}):r[e]?Ct({key:e,value:i[e],valueSpec:r[e],style:n,styleSpec:s}):[new t.n(e,i[e],`unknown property "${e}"`)])}return o}const It={"*":()=>[],array:ut,boolean:function(e){const i=e.value,n=e.key,s=t.o(i);return"boolean"!==s?[new t.V(n,i,`boolean expected, ${s} found`)]:[]},number:lt,color:function(e){const i=e.key,n=e.value,s=t.o(n);return"string"!==s?[new t.V(i,n,`color expected, ${s} found`)]:null===t.G(n)?[new t.V(i,n,`color expected, "${n}" found`)]:[]},enum:mt,filter:_t,function:ft,layer:yt,object:ct,source:Tt,model:t.L,light:Et,"light-3d":At,terrain:St,fog:kt,string:xt,formatted:function(t){return 0===xt(t).length?[]:dt(t)},resolvedImage:function(t){return 0===xt(t).length?[]:dt(t)},projection:function(e){const i=e.value,n=e.styleSpec,s=n.projection,r=e.style;let o=[];const a=t.o(i);if("object"===a)for(const t in i)o=o.concat(Ct({key:t,value:i[t],valueSpec:s[t],style:r,styleSpec:n}));else"string"!==a&&(o=o.concat([new t.V("projection",i,`object or string expected, ${a} found`)]));return o},import:function(e){const{value:i,styleSpec:n}=e,{data:s,...r}=i;Object.defineProperty(r,"__line__",{value:i.__line__,enumerable:!1});let o=ct(t.q({},e,{value:r,valueSpec:n.import}));return""===t.u(r.id)&&o.push(new t.V(`${e.key}.id`,r,"import id can't be an empty string")),s&&(o=o.concat(Dt(s,n,{key:`${e.key}.data`}))),o}};function Ct(e,i=!1){const n=e.value,s=e.valueSpec,r=e.styleSpec;if(s.expression&&t.J(t.u(n)))return ft(e);if(s.expression&&t.v(t.x(n)))return dt(e);if(s.type&&It[s.type]){const n=It[s.type](e);return!0===i&&n.length>0&&"array"===t.o(e.value)?dt(e):n}return ct(t.q({},e,{valueSpec:s.type?r[s.type]:s}))}function jt(e){const i=e.value,n=e.key,s=xt(e);return s.length||(-1===i.indexOf("{fontstack}")&&s.push(new t.V(n,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&s.push(new t.V(n,i,'"glyphs" url must include a "{range}" token'))),s}function Dt(e,i=t.N,n={}){return Ct({key:n.key||"",value:e,valueSpec:i.$root,styleSpec:i,style:e,objectElementValidators:{glyphs:jt,"*":()=>[]}})}function Rt(e,i=t.N){return Vt(Dt(e,i))}const Pt=t=>Vt(Tt(t)),Nt=t=>Vt(Et(t)),Ft=t=>Vt(At(t)),zt=t=>Vt(St(t)),Lt=t=>Vt(kt(t)),$t=t=>Vt(yt(t)),Ut=t=>Vt(_t(t)),Bt=t=>Vt(bt(t)),Gt=t=>Vt(wt(t)),Ht=e=>Vt(t.L(e));function Vt(t){return t.slice().sort(((t,e)=>t.line&&e.line?t.line-e.line:0))}function Wt(e,i){let n=!1;if(i&&i.length)for(const s of i)s instanceof t.n?t.w(s.message):(e.fire(new t.f(new Error(s.message))),n=!0);return n}let qt;class Yt extends t.E{constructor(e,i="flat"){super(),this._transitionable=new t.O(qt||(qt=new t.U({anchor:new t.W(t.N.light.anchor),position:new t.X(t.N.light.position),color:new t.W(t.N.light.color),intensity:new t.W(t.N.light.intensity)}))),this.setLight(e,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,e,i={}){this._validate(Nt,t,i)||(this._transitionable.setTransitionOrValue(t),this.id=e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&Wt(this,e.call(Rt,t.Q({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.N})))}}const Xt=new t.U({source:new t.W(t.N.terrain.source),exaggeration:new t.W(t.N.terrain.exaggeration)});let Zt=class extends t.E{constructor(e,i,n,s){super(),this.scope=n,this._transitionable=new t.O(Xt,n,s),this._transitionable.setTransitionOrValue(e,s),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(e){return this._transitioning.possiblyEvaluate(new t.Y(e)).get("exaggeration")}isZoomDependent(){const e=this._transitionable._values.exaggeration;return null!=e&&null!=e.value&&null!=e.value.expression&&e.value.expression instanceof t.Z}};const Jt=45,Kt=65,Qt=.05;function te(e,i,n,s){const r=t.a0(Jt,Kt,n),[o,a]=ee(e,s);let h=1-Math.min(1,Math.exp((i-o)/(a-o)*-6));return h*=h*h,h=Math.min(1,1.00747*h),h*r*e.alpha}function ee(t,e){const i=.5/Math.tan(.5*e);return[t.range[0]+i,t.range[1]+i]}function ie(e,i,n,s,r){const o=t.$.transformMat4([],[i,n,s],r.mercatorFogMatrix);return te(e,t.$.length(o),r.pitch,r._fov)}function ne(e,i,n,s,r,o,a){const h=[[n,s,0],[r,s,0],[r,o,0],[n,o,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const e of h){const n=t.$.transformMat4([],e,i),s=t.$.length(n);c=Math.min(c,s),u=Math.max(u,s)}return[te(e,c,a.pitch,a._fov),te(e,u,a.pitch,a._fov)]}const se=new t.U({range:new t.W(t.N.fog.range),color:new t.W(t.N.fog.color),"high-color":new t.W(t.N.fog["high-color"]),"space-color":new t.W(t.N.fog["space-color"]),"horizon-blend":new t.W(t.N.fog["horizon-blend"]),"star-intensity":new t.W(t.N.fog["star-intensity"]),"vertical-range":new t.W(t.N.fog["vertical-range"])});class re extends t.E{constructor(e,i,n,s){super(),this._transitionable=new t.O(se,n,new Map(s)),this.set(e,s),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new t.a1(se),this.scope=n}get state(){const e=this._transform,i="globe"===e.projection.name,n=t.a2(e.zoom),s=this.properties.get("range"),r=[.5,3];return{range:i?[t.a3(r[0],s[0],n),t.a3(r[1],s[1],n)]:s,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,i,n={}){if(this._validate(Lt,e,n))return;const s=t.Q({},e);for(const e of Object.keys(t.N.fog))void 0===s[e]&&(s[e]=t.N.fog[e].default);this._options=s,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:t.a0(Jt,Kt,e))*i.a}getOpacityAtLatLng(e,i){return this._transform.projection.supportsFog?function(e,i,n){const s=t._.fromLngLat(i),r=n.elevation?n.elevation.getAtPointOrZero(s):0;return ie(e,s.x,s.y,r,n)}(this.state,e,i):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(e.toUnwrapped());return ne(this.state,i,0,0,t.a4,t.a4,this._transform)}getOpacityForBounds(t,e,i,n,s){return this._transform.projection.supportsFog?ne(this.state,t,e,i,n,s,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ee(this.state,t):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const n of i){const i=e.points[n];let s;if(i[2]>=0)s=i;else{const r=e.points[n-4];s=t.a5(r,i,r[2]/(r[2]-i[2]))}if(ie(this.state,s[0],s[1],0,this._transform)>=Qt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,i,n){return(!n||!1!==n.validate)&&Wt(this,e.call(Rt,t.Q({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.N})))}}class oe extends t.E{constructor(e,i,n,s){super(),this.scope=n,this._options=e,this.properties=new t.a1(i),this._transitionable=new t.O(i,n,new Map(s)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,e){this._options=t,this._transitionable.setTransitionOrValue(t.properties,e)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}let ae,he;var ce="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",ue="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",le="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",fe="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",de="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif//DEPTH_OCCLUSION",pe="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",me="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",_e="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",ve="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",ge="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",be="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const we=[];Ee(ce,we),Ee(le,we),Ee(ue,we);const ye={"_prelude_fog.vertex.glsl":pe,"_prelude_terrain.vertex.glsl":de,"_prelude_shadow.vertex.glsl":ge,"_prelude_fog.fragment.glsl":me,"_prelude_shadow.fragment.glsl":be,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":_e,"_prelude_raster_particle.glsl":ve},xe={};Ae("",de),Ae(me,pe),Ae(be,ge),Ae(_e,""),Ae(ve,"");const Me=Ae(ue,le),Te=ce;var Oe={background:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Ae("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ae('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Ae("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ae("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Ae("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ae("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Ae("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec4 a_join_normal_inside_polygon;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Ae('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Ae("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Ae("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED)\nin float a_z_offset;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define mediump float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize mediump float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);\n#if defined(ELEVATED)\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);\n#else\ngl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Ae("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Ae("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ae('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Ae('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;\n#endif\n}'),symbolSDF:Ae('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Ae('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;\n#ifdef DEPTH_OCCLUSION\nfloat depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Ae("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Ae('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',fe),skyboxGradient:Ae('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',fe),skyboxCapture:Ae("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Ae('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Ae('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Ae("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Ae("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),occlusion:Ae("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function Ee(t,e){const i=t.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let t of i)if(t=t.trim(),"#"===t[0]&&t.includes("if")&&!t.includes("endif")){t=t.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const i=t.split(" ");for(const t of i)e.includes(t)||e.push(t)}}function Ae(t,e){const i=/#include\s+"([^"]+)"/g,n=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let s=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);s&&(s=s.map((t=>{const e=t.split(" ");return e[e.length-1]})),s=[...new Set(s)]);const r={},o=[],a=[];if(t=t.replace(i,((t,e)=>(a.push(e),""))),(e=e.replace(i,((t,e)=>(o.push(e),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let h=[...we];Ee(t,h),Ee(e,h);for(const t of[...o,...a])ye[t]||console.error(`Undefined include: ${t}`),xe[t]||(xe[t]=[],Ee(ye[t],xe[t])),h=[...h,...xe[t]];return{fragmentSource:t=t.replace(n,((t,e,i,n,s)=>(r[s]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${s}\nin ${i} ${n} ${s};\n#else\nuniform ${i} ${n} u_${s};\n#endif\n`:"initialize"===e?`\n#ifdef HAS_UNIFORM_u_${s}\n    ${i} ${n} ${s} = u_${s};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${s}\n    in ${i} ${n} ${s};\n#endif\n`:"initialize-attribute"===e?"":void 0))),vertexSource:e=e.replace(n,((t,e,i,n,s)=>{const o="float"===n?"vec2":n,a=s.match(/color/)?"color":o;return"define-attribute-vertex-shader-only"===e?`\n#ifdef HAS_ATTRIBUTE_a_${s}\nin ${i} ${n} a_${s};\n#endif\n`:r[s]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${s}\nuniform lowp float u_${s}_t;\nin ${i} ${o} a_${s};\nout ${i} ${n} ${s};\n#else\nuniform ${i} ${n} u_${s};\n#endif\n`:"initialize"===e?"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${s}\n    ${s} = a_${s};\n#else\n    ${i} ${n} ${s} = u_${s};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${s}\n    ${s} = unpack_mix_${a}(a_${s}, u_${s}_t);\n#else\n    ${i} ${n} ${s} = u_${s};\n#endif\n`:"define-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${s}\n    in ${i} ${n} a_${s};\n    out ${i} ${n} ${s};\n#endif\n`:"initialize-attribute"===e?`\n#ifdef HAS_ATTRIBUTE_a_${s}\n    ${s} = a_${s};\n#endif\n`:void 0:"define"===e?`\n#ifndef HAS_UNIFORM_u_${s}\nuniform lowp float u_${s}_t;\nin ${i} ${o} a_${s};\n#else\nuniform ${i} ${n} u_${s};\n#endif\n`:"define-instanced"===e?"mat4"===a?`\n#ifdef INSTANCED_ARRAYS\nin vec4 a_${s}0;\nin vec4 a_${s}1;\nin vec4 a_${s}2;\nin vec4 a_${s}3;\n#else\nuniform ${i} ${n} u_${s};\n#endif\n`:`\n#ifdef INSTANCED_ARRAYS\nin ${i} ${o} a_${s};\n#else\nuniform ${i} ${n} u_${s};\n#endif\n`:"initialize-attribute-custom"===e?`\n#ifdef HAS_ATTRIBUTE_a_${s}\n    ${i} ${n} ${s} = a_${s};\n#endif\n`:"vec4"===a?`\n#ifndef HAS_UNIFORM_u_${s}\n    ${i} ${n} ${s} = a_${s};\n#else\n    ${i} ${n} ${s} = u_${s};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${s}\n    ${i} ${n} ${s} = unpack_mix_${a}(a_${s}, u_${s}_t);\n#else\n    ${i} ${n} ${s} = u_${s};\n#endif\n`})),staticAttributes:s,usedDefines:h,vertexIncludes:o,fragmentIncludes:a}}class Se{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,e,i,n,s,r,o,a){this.context=t;let h=this.boundPaintVertexBuffers.length!==n.length;for(let t=0;!h&&t<n.length;t++)this.boundPaintVertexBuffers[t]!==n[t]&&(h=!0);let c=this.boundDynamicVertexBuffers.length!==o.length;for(let t=0;!c&&t<o.length;t++)this.boundDynamicVertexBuffers[t]!==o[t]&&(c=!0);if(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==i||h||c||this.boundIndexBuffer!==s||this.boundVertexOffset!==r)this.freshBind(e,i,n,s,r,o,a);else{t.bindVertexArrayOES.set(this.vao);for(const i of o)i&&(i.bind(),a&&i.instanceCount&&i.setVertexAttribDivisor(t.gl,e,a));s&&s.dynamicDraw&&s.bind()}}freshBind(t,e,i,n,s,r,o){const a=t.numAttributes,h=this.context,c=h.gl;this.vao&&this.destroy(),this.vao=h.gl.createVertexArray(),h.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=n,this.boundVertexOffset=s,this.boundDynamicVertexBuffers=r,e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,s);for(const e of i)e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,s);for(const e of r)e&&(e.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,s),o&&e.instanceCount&&e.setVertexAttribDivisor(c,t,o));n&&n.bind(),h.currentNumAttributes=a}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ke(e,i){const n=Math.pow(2,i.canonical.z),s=i.canonical.y;return[new t._(0,s/n).toLngLat().lat,new t._(0,(s+1)/n).toLngLat().lat]}function Ie(e,i,n,s,r,o,a){const h=e.context,c=h.gl,u=n.hillshadeFBO;if(!u)return;e.prepareDrawTile();const l=e.isTileAffectedByFog(i),f=e.getOrCreateProgram("hillshade",{overrideFog:l});h.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment.get());const d=((e,i,n,s)=>{const r=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),a=n.paint.get("hillshade-accent-color"),h=n.paint.get("hillshade-emissive-strength");let c=t.ac(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))c-=e.transform.angle;else if(e.style&&e.style.enable3dLights()&&e.style.directionalLight){const i=e.style.directionalLight.properties.get("direction"),n=t.ad(i.x,i.y,i.z);c=t.ac(n[1])}const u=!e.options.moving;return{u_matrix:s||e.transform.calculateProjMatrix(i.tileID.toUnwrapped(),u),u_image:0,u_latrange:ke(0,i.tileID),u_light:[n.paint.get("hillshade-exaggeration"),c],u_shadow:r.toRenderColor(n.lut),u_highlight:o.toRenderColor(n.lut),u_emissive_strength:h,u_accent:a.toRenderColor(n.lut)}})(e,n,s,e.terrain?i.projMatrix:null);e.uploadCommonUniforms(h,f,i.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:_}=e.getTileBoundsBuffers(n);f.draw(e,c.TRIANGLES,r,o,a,t.ag.disabled,d,s.id,p,m,_)}function Ce(e,i,n){if(!i.needsDEMTextureUpload)return;const s=e.context,r=s.gl;s.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||e.getTileTexture(n.stride);const o=n.getPixels();i.demTexture?i.demTexture.update(o,{premultiply:!1}):i.demTexture=new t.T(s,o,r.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function je(e,i,n){const s=e.context,r=s.gl;if(!i.dem)return;const o=i.dem;if(s.activeTexture.set(r.TEXTURE1),Ce(e,i,o),!i.demTexture)return;i.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);const a=o.dim;s.activeTexture.set(r.TEXTURE0);let h=i.hillshadeFBO;if(!h){const e=new t.T(s,{width:a,height:a,data:null},r.RGBA);e.bind(r.LINEAR,r.CLAMP_TO_EDGE),h=i.hillshadeFBO=s.createFramebuffer(a,a,!0,"renderbuffer"),h.colorAttachment.set(e.texture)}s.bindFramebuffer.set(h.framebuffer),s.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:l}=e.getMercatorTileBoundsBuffers(),f=[];e.linearFloatFilteringSupported()&&f.push("TERRAIN_DEM_FLOAT_FORMAT"),e.getOrCreateProgram("hillshadePrepare",{defines:f}).draw(e,r.TRIANGLES,t.af.disabled,t.ah.disabled,t.a.unblended,t.ag.disabled,((e,i)=>{const n=i.stride,s=t.ae.create();return t.ae.ortho(s,0,t.a4,-t.a4,0,0,1),t.ae.translate(s,s,[0,-t.a4,0]),{u_matrix:s,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ}})(i.tileID,o),n.id,c,u,l),i.needsHillshadePrepare=!1}function De(e,i,n,s,r){const o=function(n,s){if(n)return r(n);if(s){if(e.url&&s.tiles&&e.tiles&&delete e.tiles,s.variants){if(!Array.isArray(s.variants))return r(new Error("variants must be an array"));for(const e of s.variants){if(null==e||"object"!=typeof e||e.constructor!==Object)return r(new Error("variant must be an object"));if(!Array.isArray(e.capabilities))return r(new Error("capabilities must be an array"));if(1===e.capabilities.length&&"meshopt"===e.capabilities[0]){s=t.Q(s,e);break}}}const n=t.ai(t.Q(s,e),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);s.vector_layers&&(n.vectorLayers=s.vector_layers,n.vectorLayerIds=n.vectorLayers.map((t=>t.id))),s.raster_layers&&(n.rasterLayers=s.raster_layers,n.rasterLayerIds=n.rasterLayers.map((t=>t.id))),n.tiles=i.canonicalizeTileset(n,e.url),r(null,n)}},a=function(t,e,i){if(!t)return null;if(!e&&!i)return t;i=i||t.worldview_default;const n=Object.values(t.language||{});if(0===n.length)return null;const s=Object.values(t.worldview||{});if(0===s.length)return null;const r=n.every((t=>t===e)),o=s.every((t=>t===i));return r&&o?t:e in(t.language_options||{})||i in(t.worldview_options||{})?null:t.language_options&&t.worldview_options?t:null}(e.data,n,s);return a?t.e.frame((()=>o(null,a))):e.url?t.h(i.transformRequest(i.normalizeSourceURL(e.url,null,n,s),t.R.Source),o):t.e.frame((()=>{const{data:t,...i}=e;o(null,i)}))}class Re{constructor(e,i,n){this.bounds=t.aj.convert(this.validateBounds(e)),this.minzoom=i||0,this.maxzoom=n||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const i=Math.pow(2,e.z),n=Math.floor(t.ak(this.bounds.getWest())*i),s=Math.floor(t.al(this.bounds.getNorth())*i),r=Math.ceil(t.ak(this.bounds.getEast())*i),o=Math.ceil(t.al(this.bounds.getSouth())*i);return e.x>=n&&e.x<r&&e.y>=s&&e.y<o}}class Pe extends t.E{constructor(e,i,n,s){super(),this.id=e,this.dispatcher=n,this.setEventedParent(s),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.Q({type:"raster"},i),t.Q(this,t.ai(i,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new t.g("dataloading",{dataType:"source"})),this._tileJSONRequest=De(this._options,this.map._requestManager,null,null,((i,n)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new t.f(i)):n&&(t.Q(this,n),n.bounds&&(this.tileBounds=new Re(n.bounds,this.minzoom,this.maxzoom)),t.ao(n.tiles),this.fire(new t.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.g("data",{dataType:"source",sourceDataType:"content"}))),e&&e(i)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.am(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return t.Q({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,i){const n=t.e.devicePixelRatio>=2,s=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);e.request=t.i(this.map._requestManager.transformRequest(s,t.R.Tile),((n,s,r,o)=>(delete e.request,e.aborted?(e.state="unloaded",i(null)):n?(e.state="errored",i(n)):s?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:r,expires:o}),e.setTexture(s,this.map.painter),e.state="loaded",t.an(this.dispatcher),void i(null)):i(null))))}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e&&e()}unloadTile(e,i){e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),i&&i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ne extends t.E{constructor(e,i,n,s){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.Q(this,t.ai(i,["url","scheme","tileSize","promoteId"])),this._options=t.Q({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(s),this._tileWorkers={},this._deduped=new t.ap}load(e){this._loaded=!1,this.fire(new t.g("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=De(this._options,this.map._requestManager,i,n,((s,r)=>{this._tileJSONRequest=null,this._loaded=!0,s?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.f(s))):r&&(t.Q(this,r),r.bounds&&(this.tileBounds=new Re(r.bounds,this.minzoom,this.maxzoom)),t.ao(r.tiles,this.map._requestManager._customAccessToken),this.fire(new t.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.g("data",{dataType:"source",sourceDataType:"content"}))),e&&e(s)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const e=t.am(this.id,this.scope);this.load((()=>this.map.style.clearSource(e)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return t.Q({},this._options)}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),s=this.map._requestManager.transformRequest(n,t.R.Tile),r=this.map.style?this.map.style.getLut(this.scope):null,o={request:s,data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,lut:r?{image:r.image.clone()}:null,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(o.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=i:e.request=e.actor.send("reloadTile",o,a.bind(this));else if(e.actor=this._tileWorkers[n]=this._tileWorkers[n]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",o,a.bind(this),void 0,!0);else{const i=t.aq.call({deduped:this._deduped},o,((t,i)=>{t||!i?a.call(this,t):(o.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},e.actor&&e.actor.send("loadTile",o,a.bind(this),void 0,!0))}),!0);e.request={cancel:i}}function a(n,s){return delete e.request,e.aborted?i(null):n&&404!==n.status?i(n):(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),this.map._refreshExpiredTiles&&s&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),t.an(this.dispatcher),i(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,e){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Fe=(t,e,i)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:i}),ze=(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:i,u_zoom_transition:s,u_merc_center:r,u_image0:0,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:h,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:l,u_viewport:f,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:d,u_far_z_cutoff:p});class Le{constructor(t=0,e=0,i=0,n=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(e,i,n){return null!=i.top&&null!=e.top&&(this.top=t.a3(e.top,i.top,n)),null!=i.bottom&&null!=e.bottom&&(this.bottom=t.a3(e.bottom,i.bottom,n)),null!=i.left&&null!=e.left&&(this.left=t.a3(e.left,i.left,n)),null!=i.right&&null!=e.right&&(this.right=t.a3(e.right,i.right,n)),this}getCenter(e,i){const n=t.au((this.left+e-this.right)/2,0,e),s=t.au((this.top+i-this.bottom)/2,0,i);return new t.P(n,s)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Le(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function $e(e,i){const n=t.ax(e,3);t.ae.fromQuat(e,i),t.aA(e,3,n)}function Ue(e,i){const n=t.aw.identity([]);return t.aw.rotateZ(n,n,-i),t.aw.rotateX(n,n,-e),n}function Be(e,i){const n=[e[0],e[1],0],s=[i[0],i[1],0];if(t.$.length(n)>=1e-15){const e=t.$.normalize([],n);t.$.scale(s,e,t.$.dot(s,e)),i[0]=s[0],i[1]=s[1]}const r=t.$.cross([],i,e);if(t.$.len(r)<1e-15)return null;const o=Math.atan2(-r[1],r[0]);return Ue(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),o)}class Ge{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const i=e instanceof t._?e:new t._(e[0],e[1],e[2]);this._renderWorldCopies&&(i.x=t.av(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(e,i){if(this.orientation=null,!this.position)return;const n=this.position,s=this._elevation?this._elevation.getAtPointOrZero(t._.fromLngLat(e)):0,r=t._.fromLngLat(e,s),o=[r.x-n.x,r.y-n.y,r.z-n.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=Be(o,i)}setPitchBearing(e,i){this.orientation=Ue(t.ac(e),t.ac(-i))}}class He{constructor(e,i){this._transform=t.ae.identity([]),this.orientation=i,this.position=e}get mercatorPosition(){const e=this.position;return new t._(e[0],e[1],e[2])}get position(){const e=t.ax(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var i;e&&t.aA(this._transform,3,[(i=e)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.aw.identity([]),e&&$e(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Ue(t,e),$e(this._transform,this._orientation)}forward(){const e=t.ax(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.ax(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.ax(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,i){const n=new Float64Array(16);return t.ae.invert(n,this.getWorldToCamera(e,i)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,i,n){const s=this.position;t.$.scale(s,s,-e);const r=new Float64Array(16);return t.ae.fromScaling(r,[n,n,n]),t.ae.translate(r,r,s),r[10]*=i,r}getWorldToCamera(e,i){const n=new Float64Array(16),s=new Float64Array(4),r=this.position;return t.aw.conjugate(s,this._orientation),t.$.scale(r,r,-e),t.ae.fromQuat(n,s),t.ae.translate(n,n,r),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=i,n[9]*=i,n[10]*=i,n[11]*=i,n}getCameraToClipPerspective(e,i,n,s){const r=new Float64Array(16);return t.ae.perspective(r,e,i,n,s),r}getCameraToClipOrthographic(e,i,n,s,r,o){const a=new Float64Array(16);return t.ae.ortho(a,e,i,n,s,r,o),a}getDistanceToElevation(e,i=!1){const n=0===e?0:t.ay(e,i?t.az(this.position[1]):this.position[1]),s=this.forward();return(n-this.position[2])/s[2]}clone(){return new He([...this.position],[...this.orientation])}}const Ve={unknown:0,flipRequired:1,flipNotRequired:2},We=Math.tan(85*Math.PI/180);function qe(e,i,n,s,r,o,a){const h=t.ae.create();if(n)if("globe"===o.name){const e=t.aC(r,i);t.ae.multiply(h,h,e)}else{const e=t.aD.invert([],a);h[0]=e[0],h[1]=e[1],h[4]=e[2],h[5]=e[3],s||t.ae.rotateZ(h,h,r.angle)}else t.ae.multiply(h,r.labelPlaneMatrix,e);return h}function Ye(t,e,i,n,s,r,o){const a=qe(t,e,i,n,s,r,o);return"globe"===r.name&&i||(a[2]=a[6]=a[10]=a[14]=0),a}function Xe(e,i,n,s,r,o,a){if(n){if("globe"===o.name){const h=qe(e,i,n,s,r,o,a);return t.ae.invert(h,h),t.ae.multiply(h,e,h),h}{const i=t.ae.clone(e),n=t.ae.identity([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],t.ae.multiply(i,i,n),s||t.ae.rotateZ(i,i,-r.angle),i}}return r.glCoordMatrix}function Ze(e,i,n,s){const r=[e,i,n,1];n?t.aB.transformMat4(r,r,s):ai(r,r,s);const o=r[3];return r[0]/=o,r[1]/=o,r[2]/=o,r}function Je(t,e){return Math.min(.5+t/e*.5,1.5)}function Ke(t,e){const i=t[0]/t[3],n=t[1]/t[3];return i>=-e[0]&&i<=e[0]&&n>=-e[1]&&n<=e[1]}function Qe(e,i,n,s,r,o,a,h,c,u){const l=n.transform,f=s?e.textSizeData:e.iconSizeData,d=t.aE(f,n.transform.zoom),p="globe"===l.projection.name,m=[256/n.width*2+1,256/n.height*2+1],_=s?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;_.clear();let v=null;p&&(v=s?e.text.globeExtVertexArray:e.icon.globeExtVertexArray);const g=e.lineVertexArray,b=s?e.text.placedSymbolArray:e.icon.placedSymbolArray,w=n.transform.width/n.transform.height;let y,x=!1;for(let s=0;s<b.length;s++){const p=b.get(s),{numGlyphs:M,writingMode:T}=p;if(T!==t.aF.vertical||x||y===t.aF.horizontal||(x=!0),y=T,(p.hidden||T===t.aF.vertical)&&!x){oi(M,_);continue}x=!1;const O=new t.P(p.tileAnchorX,p.tileAnchorY);let{x:E,y:A,z:S}=l.projection.projectTilePoint(O.x,O.y,u.canonical);if(c){const[t,e,i]=c(O);E+=t,A+=e,S+=i}const k=[E,A,S,1];if(t.aB.transformMat4(k,k,i),!Ke(k,m)){oi(M,_);continue}const I=k[3],C=Je(n.transform.getCameraToCenterDistance(l.projection),I),j=t.aG(f,d,p),D=a?j/C:j*C,R=Ze(E,A,S,r);if(R[3]<=0){oi(M,_);continue}let P={};const N=a?null:c,F=ii(p,D,!1,h,i,r,o,e.glyphOffsetArray,g,_,v,R,O,P,w,N,l.projection,u,a);x=F.useVertical,N&&F.needsFlipping&&(P={}),(F.notEnoughRoom||x||F.needsFlipping&&ii(p,D,!0,h,i,r,o,e.glyphOffsetArray,g,_,v,R,O,P,w,N,l.projection,u,a).notEnoughRoom)&&oi(M,_)}s?(e.text.dynamicLayoutVertexBuffer.updateData(_),v&&e.text.globeExtVertexBuffer&&e.text.globeExtVertexBuffer.updateData(v)):(e.icon.dynamicLayoutVertexBuffer.updateData(_),v&&e.icon.globeExtVertexBuffer&&e.icon.globeExtVertexBuffer.updateData(v))}function ti(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m){const{lineStartIndex:_,glyphStartIndex:v,segment:g}=a,b=v+a.numGlyphs,w=_+a.lineLength,y=e.getoffsetX(v),x=e.getoffsetX(b-1),M=ri(t*y,i,n,s,r,o,g,_,w,h,c,u,l,f,!0,d,p,m);if(!M)return null;const T=ri(t*x,i,n,s,r,o,g,_,w,h,c,u,l,f,!0,d,p,m);return T?{first:M,last:T}:null}function ei(e,i,n,s){return e===t.aF.horizontal&&Math.abs(s)>Math.abs(n)?{useVertical:!0}:e===t.aF.vertical?s>0?{needsFlipping:!0}:null:i!==Ve.unknown&&function(t,e){return 0===t||Math.abs(e/t)>We}(n,s)?i===Ve.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function ii(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b){const w=i/24,y=e.lineOffsetX*w,x=e.lineOffsetY*w,{lineStartIndex:M,glyphStartIndex:T,numGlyphs:O,segment:E,writingMode:A,flipState:S}=e,k=M+e.lineLength,I=e=>{if(l){const[i,n,s]=e.up,r=u.length;t.aH(l,r+0,i,n,s),t.aH(l,r+1,i,n,s),t.aH(l,r+2,i,n,s),t.aH(l,r+3,i,n,s)}const[i,n,s]=e.point;t.aI(u,i,n,s,e.angle)};if(O>1){const t=ti(w,h,y,x,n,f,d,e,c,o,p,_,!1,v,g,b);if(!t)return{notEnoughRoom:!0};if(s&&!n){let[i,n,s]=t.first.point,[r,o,h]=t.last.point;[i,n]=Ze(i,n,s,a),[r,o]=Ze(r,o,h,a);const c=ei(A,S,(r-i)*m,o-n);if(e.flipState=c&&c.needsFlipping?Ve.flipRequired:Ve.flipNotRequired,c)return c}I(t.first);for(let t=T+1;t<T+O-1;t++){const e=ri(w*h.getoffsetX(t),y,x,n,f,d,E,M,k,c,o,p,_,!1,!1,v,g,b);if(!e)return u.length-=4*(t-T),{notEnoughRoom:!0};I(e)}I(t.last)}else{if(s&&!n){const i=Ze(d.x,d.y,0,r),n=M+E+1,s=new t.P(c.getx(n),c.gety(n)),o=Ze(s.x,s.y,0,r),a=o[3]>0?o:si(d,s,i,1,r,void 0,v,g.canonical),h=ei(A,S,(a[0]-i[0])*m,a[1]-i[1]);if(e.flipState=h&&h.needsFlipping?Ve.flipRequired:Ve.flipNotRequired,h)return h}const i=ri(w*h.getoffsetX(T),y,x,n,f,d,E,M,k,c,o,p,_,!1,!1,v,g,b);if(!i)return{notEnoughRoom:!0};I(i)}return{}}function ni(t,e,i,n,s){const{x:r,y:o,z:a}=n.projectTilePoint(t.x,t.y,e);if(!s)return Ze(r,o,a,i);const[h,c,u]=s(t);return Ze(r+h,o+c,a+u,i)}function si(e,i,n,s,r,o,a,h){const c=ni(e.sub(i)._unit()._add(e),h,r,a,o);return t.$.sub(c,n,c),t.$.normalize(c,c),t.$.scaleAndAdd(c,n,c,s)}function ri(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g){const b=s?e-i:e+i;let w=b>0?1:-1,y=0;s&&(w*=-1,y=Math.PI),w<0&&(y+=Math.PI);let x=h+a+(w>0?0:1)|0,M=r,T=r,O=0,E=0;const A=Math.abs(b),S=[],k=[];let I=o,C=I;const j=()=>si(C,I,T,A-O+1,l,d,_,v.canonical);for(;O+E<=A;){if(x+=w,x<h||x>=c)return null;if(T=M,C=I,S.push(T),p&&k.push(C),I=new t.P(u.getx(x),u.gety(x)),M=f[x],!M){const t=ni(I,v.canonical,l,_,d);M=t[3]>0?f[x]=t:j()}O+=E,E=t.$.distance(T,M)}m&&d&&(f[x]&&(M=j(),E=t.$.distance(T,M)),f[x]=M);const D=(A-O)/E,R=I.sub(C)._mult(D)._add(C),P=t.$.sub([],M,T),N=t.$.scaleAndAdd([],T,P,D);let F=[0,0,1],z=P[0],L=P[1];if(g&&(F=_.upVector(v.canonical,R.x,R.y),0!==F[0]||0!==F[1]||1!==F[2])){const e=[F[2],0,-F[0]],i=t.$.cross([],F,e);t.$.normalize(e,e),t.$.normalize(i,i),z=t.$.dot(P,e),L=t.$.dot(P,i)}if(n){const e=t.$.cross([],F,P);t.$.normalize(e,e),t.$.scaleAndAdd(N,N,e,n*w)}const $=y+Math.atan2(L,z);return S.push(N),p&&k.push(R),{point:N,angle:$,path:S,tilePath:k,up:F}}function oi(t,e){const i=e.length,n=i+4*t;e.resize(n),e.float32.fill(-1/0,4*i,4*n)}function ai(t,e,i){const n=e[0],s=e[1];return t[0]=i[0]*n+i[4]*s+i[12],t[1]=i[1]*n+i[5]*s+i[13],t[3]=i[3]*n+i[7]*s+i[15],t}const hi=(t,e,i)=>(1-i)*t+i*e,ci=t=>t*t*t*t*t;class ui{constructor(e,i,n,s,r,o,a){this.tileSize=512,this._renderWorldCopies=void 0===r||r,this._minZoom=e||0,this._maxZoom=i||22,this._minPitch=n??0,this._maxPitch=s??60,this.setProjection(o),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Le,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new He,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const t=new ui(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(t,e=!1){const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(t||i)&&this._constrainCamera(e),this._calcMatrices()}getProjection(){return t.ai(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};const i=this.projection?this.getProjection():void 0;this.projection=t.aK(this.projectionOptions);const n=this.getProjection(),s=!t.d(i,n);return s&&this._calcMatrices(),this.mercatorFromTransition=!1,s}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.aK({name:"mercator"});const i=e!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.av(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const i=-e*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=t.aD.create(),t.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const i=t.au(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=t.ac(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,e=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!e||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;e||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let s=0,r=0;for(let o=0;o<i.length;o++){const a=new t.P(i[o][0]*this.width,n+i[o][1]*(this.height-n)),h=e.pointCoordinate(a);if(!h)continue;const c=1/Math.hypot(h[0]-this._camera.position[0],h[1]-this._camera.position[1]);s+=h[3]*c,r+=c}return 0===r?NaN:s/r}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*e,n=this._mercatorZfromZoom(t),s=this._mercatorZfromZoom(this._maxZoom),r=Math.max(n-i,s);this._setZoom(this._zoomFromMercatorZ(r))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let n;n=e.z<this._camera.position[2]?[i.x,i.y,i.z]:[e.x,e.y,e.z];const s=t.$.length(t.$.sub([],this._camera.position,n));return t.au(this._zoomFromMercatorZ(s),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let i=!1;if(e.orientation&&!t.aw.exactEquals(e.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(e.orientation)),e.position){const n=[e.position.x,e.position.y,e.position.z];t.$.exactEquals(n,this._camera.position)||(this._setCameraPosition(n),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,i=new Ge;return i.position=new t._(e[0],e[1],e[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(e){if(!t.aw.length(e))return!1;t.aw.normalize(e,e);const i=t.$.transformQuat([],[0,0,-1],e),n=t.$.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;const s=Be(i,n);return!!s&&(this._camera.orientation=s,!0)}_setCameraPosition(e){const i=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,s=this.cameraToCenterDistance;e[2]=t.au(e[2],s/n,s/i),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const i=[new t.aL(0,e)];if(this.renderWorldCopies){const n=this.pointCoordinate(new t.P(0,0)),s=this.pointCoordinate(new t.P(this.width,0)),r=this.pointCoordinate(new t.P(this.width,this.height)),o=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(n.x,s.x,r.x,o.x)),h=Math.floor(Math.max(n.x,s.x,r.x,o.x)),c=1;for(let n=a-c;n<=h+c;n++)0!==n&&i.push(new t.aL(n,e))}return i}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(e,i,n){let s=[];const r=void 0!==n,o=!r;if(o&&this.zoom<i)return s;if(r&&0===n[0]&&0===n[1])return s;const a=new Set,h=(e,i,n,r,o)=>{const h=t.b2(i,e,n,r,o);a.has(h)||(s.push(new t.aQ(e,i,n,r,o)),a.add(h))};for(let t=0;t<e.length;t++){const s=e[t];if(o&&s.canonical.z!==i)continue;const a=s.canonical,c=s.overscaledZ,u=s.wrap,l=1<<a.z,f=a.x+1<l,d=a.x>0,p=a.y+1<l,m=a.y>0,_=s.wrap-(d?0:1),v=s.wrap+(f?0:1),g=d?a.x-1:l-1,b=f?a.x+1:0;if(r)n[0]<0?(h(c,v,a.z,b,a.y),n[1]<0&&p&&(h(c,u,a.z,a.x,a.y+1),h(c,v,a.z,b,a.y+1)),n[1]>0&&m&&(h(c,u,a.z,a.x,a.y-1),h(c,v,a.z,b,a.y-1))):n[0]>0?(h(c,_,a.z,g,a.y),n[1]<0&&p&&(h(c,u,a.z,a.x,a.y+1),h(c,_,a.z,g,a.y+1)),n[1]>0&&m&&(h(c,u,a.z,a.x,a.y-1),h(c,_,a.z,g,a.y-1))):n[1]<0&&p?h(c,u,a.z,a.x,a.y+1):m&&h(c,u,a.z,a.x,a.y-1);else{const t=s.visibleQuadrants;1&t&&(h(c,_,a.z,g,a.y),m&&(h(c,u,a.z,a.x,a.y-1),h(c,_,a.z,g,a.y-1))),2&t&&(h(c,v,a.z,b,a.y),m&&(h(c,u,a.z,a.x,a.y-1),h(c,v,a.z,b,a.y-1))),4&t&&(h(c,_,a.z,g,a.y),p&&(h(c,u,a.z,a.x,a.y+1),h(c,_,a.z,g,a.y+1))),8&t&&(h(c,v,a.z,b,a.y),p&&(h(c,u,a.z,a.x,a.y+1),h(c,v,a.z,b,a.y+1)))}}const c=[];for(const t of s)s.some((e=>t.isChildOf(e)))||c.push(t);if(s=c.filter((t=>!e.some((e=>!!(t.overscaledZ<i&&e.isChildOf(t))||t.equals(e)||t.isChildOf(e))))),o){const t=1<<i,e="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),n=[t*e.x,t*e.y],r=4,o=r*r;s=s.filter((t=>{const e=t.canonical.x+.5-n[0],i=t.canonical.y+.5-n[1];return e*e+i*i<o}))}return s}coveringTiles(e){let i=this.coveringZoomLevel(e);const n=i,s=this.elevation&&this.elevation.exaggeration(),r=s&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&i<e.minzoom)return[];void 0!==e.maxzoom&&i>e.maxzoom&&(i=e.maxzoom);const a=this.locationCoordinate(this.center),h=this.center.lat,c=1<<i,u=[c*a.x,c*a.y,0],l="globe"===this.projection.name,f=!l,d=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,f),p=l?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*t.ay(1,this.center.lat),_=this._camera.position[2]/t.ay(1,this.center.lat),v=[c*p.x,c*p.y,_*(f?1:m)],g=l||s,b=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),w=this.isLODDisabled(!0)?i:0;let y;if(this._elevation&&e.isTerrainDEM)y=1e4*this._elevation.exaggeration();else if(this._elevation){const t=this._elevation.getMinMaxForVisibleTiles();y=t?t.max:this._centerAltitude}else y=this._centerAltitude;const x=e.isTerrainDEM?-y:this._elevation?this._elevation.getMinElevationBelowMSL():0,M=this.projection.isReprojectedInTileSpace?t.aN(this):1,T=e=>{const i=1/4e4,n=new t._(e.x+i,e.y,e.z),s=new t._(e.x,e.y+i,e.z),r=e.toLngLat(),o=n.toLngLat(),a=s.toLngLat(),h=this.locationCoordinate(r),c=this.locationCoordinate(o),u=this.locationCoordinate(a),l=Math.hypot(c.x-h.x,c.y-h.y),f=Math.hypot(u.x-h.x,u.y-h.y);return Math.sqrt(l*f)*M/i},O=e=>{const i=y,n=x;return{aabb:t.aR(this,c,0,0,0,e,n,i,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:i,wrap:e,fullyVisible:!1}},E=[];let A=[];const S=i,k=e.reparseOverscaled?n:i,I=(_-this._centerAltitude)*m,C=t=>{if(!this._elevation||!t.tileID||!o)return;const e=this._elevation.getMinMaxForTile(t.tileID),i=t.aabb;e?(i.min[2]=e.min,i.max[2]=e.max,i.center[2]=(i.min[2]+i.max[2])/2):(t.shouldSplit=D(t),t.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},j=(t,e)=>{if(.707*e<t)return 1;const i=e/t;return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)},D=e=>{if(e.zoom<w)return!0;if(e.zoom===S)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const i=e.aabb.distanceX(v),s=e.aabb.distanceY(v);let a=I,c=1;if(l){a=e.aabb.distanceZ(v);const i=Math.pow(2,e.zoom),n=t.az((e.y+1)/i),s=t.az(e.y/i),r=Math.min(Math.max(h,n),s),o=t.b6(r)/t.b6(h);if(c=r===h?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,o/this._mercatorScaleRatio),this.zoom<=t.b3&&e.zoom===S-1&&o>=.9)return!0}else if(r&&(a=e.aabb.distanceZ(v)*m),this.projection.isReprojectedInTileSpace&&n<=5){const i=Math.pow(2,e.zoom),n=T(new t._((e.x+.5)/i,(e.y+.5)/i));c=n>.85?1:n}if(!o){const t=Math.sqrt(i*i+s*s+a*a);let n=(1<<S-e.zoom)*b*c;return n*=j(Math.max(a,I),t),t<n}let f=Number.MAX_VALUE,d=0;const p=e.aabb.getCorners(),_=[];for(const e of p){t.$.sub(_,e,v),l||(r?_[2]*=m:_[2]=I);const i=t.$.dot(_,this._camera.forward());i<f&&(f=i,d=Math.abs(_[2]))}let g=(1<<S-e.zoom)*b*c;if(g*=j(Math.max(d,I),f),f<g)return!0;const y=e.aabb.closestPoint(u);return y[0]===u[0]&&y[1]===u[1]};if(this.renderWorldCopies)for(let t=1;t<=3;t++)E.push(O(-t)),E.push(O(t));for(E.push(O(0));E.length>0;){const n=E.pop(),s=n.x,a=n.y;let h=n.fullyVisible;const f=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!h){let e=g?n.aabb.intersects(d):n.aabb.intersectsFlat(d);if(0===e&&f()){const i=new t.aO(n.zoom,s,a);e=t.aP(this,c,i,!0).intersects(d)}if(0===e)continue;h=2===e}if(n.zoom!==S&&D(n))for(let e=0;e<4;e++){const i=(s<<1)+e%2,u=(a<<1)+(e>>1),f={aabb:o?n.aabb.quadrant(e):t.aR(this,c,n.zoom+1,i,u,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:i,y:u,wrap:n.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};r&&!l&&(f.tileID=new t.aQ(n.zoom+1===S?k:n.zoom+1,n.wrap,n.zoom+1,i,u),C(f)),E.push(f)}else{const r=n.zoom===S?k:n.zoom;if(e.minzoom&&e.minzoom>r)continue;let o=0;if(!h){let i=g?n.aabb.intersectsPrecise(d):n.aabb.intersectsPreciseFlat(d);if(0===i&&f()){const e=new t.aO(n.zoom,s,a);i=t.aP(this,c,e,!0).intersectsPrecise(d)}if(0===i)continue;if(e.calculateQuadrantVisibility)if(d.containsPoint(n.aabb.center))o=15;else for(let t=0;t<4;t++)0!==n.aabb.quadrant(t).intersects(d)&&(o|=1<<t)}const l=u[0]-(.5+s+(n.wrap<<n.zoom))*(1<<i-n.zoom),p=u[1]-.5-a,m=n.tileID?n.tileID:new t.aQ(r,n.wrap,n.zoom,s,a);e.calculateQuadrantVisibility&&(m.visibleQuadrants=o),A.push({tileID:m,distanceSq:l*l+p*p})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,n=this.horizonLineFromTop();A=A.filter((s=>{const r=[0,0,0,1],o=[t.a4,t.a4,0,1],a=this.calculateFogTileMatrix(s.tileID.toUnwrapped());t.aB.transformMat4(r,r,a),t.aB.transformMat4(o,o,a);const h=t.aB.min([],r,o),c=t.aB.max([],r,o),u=t.aS(h,c);if(0===u)return!0;let l=!1;const f=this._elevation;if(f&&u>i&&0!==n){const i=this.calculateProjMatrix(s.tileID.toUnwrapped());let r;e.isTerrainDEM||(r=f.getMinMaxForTile(s.tileID)),r||(r={min:x,max:y});const o=t.b4(this.rotation),a=[o[0]*t.a4,o[1]*t.a4,r.max];t.$.transformMat4(a,a,i),l=(1-a[1])*this.height*.5<n}return u<i||l}))}return A.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.tileID))}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const i=t.au(e.lat,-t.aT,t.aT),n=this.projection.project(e.lng,i);return new t.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,i){let n,s;const r=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;n=(i.x-r.x)/t,s=(i.y-r.y)/t}else{const t=this.pointCoordinate(i),e=this.pointCoordinate(r);n=t.x-e.x,s=t.y-e.y}const o=this.locationCoordinate(e);this.setLocation(new t._(o.x-n,o.y-s))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,i){const n=i?t.ay(i,e.lat):void 0,s=this.projection.project(e.lng,e.lat);return new t._(s.x,s.y,n)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,i){const n=null!=i?i:this._centerAltitude,s=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.aB.transformMat4(s,s,this.pixelMatrixInverse),t.aB.transformMat4(r,r,this.pixelMatrixInverse);const o=r[3];t.aB.scale(s,s,1/s[3]),t.aB.scale(r,r,1/o);const a=s[2],h=r[2];return{p0:s,p1:r,t:a===h?0:(n-a)/(h-a)}}screenPointToMercatorRay(e){const i=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.aB.transformMat4(i,i,this.pixelMatrixInverse),t.aB.transformMat4(n,n,this.pixelMatrixInverse),t.aB.scale(i,i,1/i[3]),t.aB.scale(n,n,1/n[3]),i[2]=t.ay(i[2],this._center.lat)*this.worldSize,n[2]=t.ay(n[2],this._center.lat)*this.worldSize,t.aB.scale(i,i,1/this.worldSize),t.aB.scale(n,n,1/this.worldSize),new t.aU([i[0],i[1],i[2]],t.$.normalize([],t.$.sub([],n,i)))}rayIntersectionCoordinate(e){const{p0:i,p1:n,t:s}=e,r=t.ay(i[2],this._center.lat),o=t.ay(n[2],this._center.lat);return new t._(t.a3(i[0],n[0],s)/this.worldSize,t.a3(i[1],n[1],s)/this.worldSize,t.a3(r,o,s))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let i=this.projection.pointCoordinate3D(this,e.x,e.y);if(i)return new t._(i[0],i[1],i[2]);let n=0,s=this.horizonLineFromTop();if(e.y>s)return this.pointCoordinate(e);const r=.02*s,o=e.clone();for(let e=0;e<10&&s-n>r;e++){o.y=t.a3(n,s,.66);const e=this.projection.pointCoordinate3D(this,o.x,o.y);e?(s=o.y,i=e):n=o.y}return i?new t._(i[0],i[1],i[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=t.aV)return!this.isPointAboveHorizon(e);const i=this.pointCoordinate(e);return i.y>=0&&i.y<=1}_coordinatePoint(e,i){const n=i&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,s=[e.x*this.worldSize,e.y*this.worldSize,n+e.toAltitude(),1];return t.aB.transformMat4(s,s,this.pixelMatrix),s[3]>0?new t.P(s[0]/s[3],s[1]/s[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:e,left:i}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,s=this.width-this._edgeInsets.right,r=this.pointLocation3D(new t.P(i,e)),o=this.pointLocation3D(new t.P(s,e)),a=this.pointLocation3D(new t.P(s,n)),h=this.pointLocation3D(new t.P(i,n));let c=Math.min(r.lng,o.lng,a.lng,h.lng),u=Math.max(r.lng,o.lng,a.lng,h.lng),l=Math.min(r.lat,o.lat,a.lat,h.lat),f=Math.max(r.lat,o.lat,a.lat,h.lat);const d=Math.pow(2,-this.zoom)/16*270,p="globe"===this.projection.name?1:4,m=(e,i,n,s,r)=>{const o=(e+n)/2,a=(i+s)/2,h=new t.P(o,a),{lng:_,lat:v}=this.pointLocation3D(h),g=Math.max(0,c-_,l-v,_-u,v-f);c=Math.min(c,_),u=Math.max(u,_),l=Math.min(l,v),f=Math.max(f,v),(r<p||g>d)&&(m(e,i,o,a,r+1),m(o,a,n,s,r+1))};if(m(i,e,s,e,1),m(s,e,s,n,1),m(s,n,i,n,1),m(i,n,i,e,1),"globe"===this.projection.name){const[e,i]=t.aW(this);e?(f=90,u=180,c=-180):i&&(l=-90,u=180,c=-180)}return new t.aj(new t.aJ(c,l),new t.aJ(u,f))}_getBoundsRectangular(e,i){const{top:n,left:s}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,a=new t.P(s,n),h=new t.P(o,n),c=new t.P(o,r),u=new t.P(s,r);let l=this.pointCoordinate(a,e),f=this.pointCoordinate(h,e);const d=this.pointCoordinate(c,i),p=this.pointCoordinate(u,i),m=(t,e)=>(e.y-t.y)/(e.x-t.x);return l.y>1&&f.y>=0?l=new t._((1-p.y)/m(p,l)+p.x,1):l.y<0&&f.y<=1&&(l=new t._(-p.y/m(p,l)+p.x,0)),f.y>1&&l.y>=0?f=new t._((1-d.y)/m(d,f)+d.x,1):f.y<0&&l.y<=1&&(f=new t._(-d.y/m(d,f)+d.x,0)),(new t.aj).extend(this.coordinateLocation(l)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p)).extend(this.coordinateLocation(d))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const e=t.visibleDemTiles.reduce(((t,e)=>{if(e.dem){const i=e.dem.tree;t.min=Math.min(t.min,i.minimums[0]),t.max=Math.max(t.max,i.maximums[0])}return t}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.aT,this.maxLat=t.aT,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.ak(this.minLng)*this.tileSize,this.worldMaxX=t.ak(this.maxLng)*this.tileSize,this.worldMinY=t.al(this.maxLat)*this.tileSize,this.worldMaxY=t.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const i=e.key,n=this._distanceTileDataCache;if(n[i])return n[i];const s=e.canonical,r=1/this.height,o=this.cameraWorldSize,a=o/this.zoomScale(s.z),h=(s.x+Math.pow(2,s.z)*e.wrap)*a,c=s.y*a,u=this.point;u.x*=o/this.worldSize,u.y*=o/this.worldSize;const l=this.angle,f=Math.sin(-l),d=-Math.cos(-l);return n[i]={bearing:[f,d],center:[(u.x-h)*r,(u.y-c)*r],scale:a/t.a4*r},n[i]}calculateFogTileMatrix(e){const i=e.key,n=this._fogTileMatrixCache;if(n[i])return n[i];const s=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return t.ae.multiply(s,this.worldToFogMatrix,s),n[i]=new Float32Array(s),n[i]}calculateProjMatrix(e,i=!1,n=!1){const s=e.key;let r;if(r=n?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,r[s])return r[s];const o=this.calculatePosMatrix(e,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,t.ae.multiply(o,a,o),r[s]=new Float32Array(o),r[s]}calculatePixelsToTileUnitsMatrix(e){const i=e.tileID.key,n=this._pixelsToTileUnitsCache;if(n[i])return n[i];const s=t.aX(e,this);return n[i]=s,n[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const e=1/this.worldSize,i=t.ae.fromScaling([],[e,e,e]);return t.ae.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const e=this._elevation;this._updateCameraState();const i=t.ay(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(i),s=this._camera.forward(),r=t.ay(1,this._center.lat);n[2]/=r,s[2]/=r,t.$.normalize(s,s);const o=e.raycast(n,s,e.exaggeration());if(o){const e=t.$.scaleAndAdd([],n,s,o),i=new t._(e[0],e[1],t.ay(e[2],t.az(e[1]))),a=(i.z+t.$.length([i.x-n[0],i.y-n[1],i.z-n[2]*r]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;const i=this._elevation,n=t.ay(1,this._center.lat)*this.worldSize,s=this._computeCameraPosition(n),r=i.getAtPointOrZero(new t._(...s)),o=this.pixelsPerMeter/this.worldSize*r,a=this._minimumHeightOverTerrain(),h=s[2]-o;if(h<=a)if(h<0||e){const e=this.locationCoordinate(this._center,this._centerAltitude),i=[s[0],s[1],e.z-s[2]],n=t.$.length(i);i[2]-=(a-h)/this._pixelsPerMercatorPixel;const r=t.$.length(i);if(0===r)return;t.$.scale(i,i,n/r*this._pixelsPerMercatorPixel),this._camera.position=[s[0],s[1],e.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){const i=this.center;return i.lat=t.au(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(i.lng=t.au(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:n,y:s}=this.point;let r=0,o=n,a=s;const h=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,l=this.worldMaxY*this.scale;if(s-c<u&&(a=u+c),s+c>l&&(a=l-c),l-u<this.height&&(r=Math.max(r,this.height/(l-u)),a=(l+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,i=this.worldSize/2-(t+e)/2;o=(n+i+this.worldSize)%this.worldSize-i,o-h<t&&(o=t+h),o+h>e&&(o=e-h),e-t<this.width&&(r=Math.max(r,this.width/(e-t)),o=(e+t)/2)}o===n&&a===s||(this.center=this.unproject(new t.P(o,a))),r&&(this.zoom+=this.scaleZoom(r)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,i="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=t.ay(1,this.center.lat)/t.ay(1,t.b5));const s=t.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,s),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const r="meters"===this.projection.zAxisUnit?n:1,o=this._camera.getWorldToCamera(this.worldSize,r);let a;const h=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(h[8]=2*-e.x/this.width,h[9]=2*e.y/this.height,this.isOrthographic){let t=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=t*this.aspect,n=-i,s=-t;i-=e.x,n-=e.x,t+=e.y,s+=e.y,a=this._camera.getCameraToClipOrthographic(n,i,s,t,this._nearZ,this._farZ),((t,e,i,n)=>{for(let s=0;s<16;s++)t[s]=hi(e[s],i[s],n)})(a,a,h,ci(this.pitch>=15?1:this.pitch/15))}else a=h;const c=t.ae.mul([],h,o);let u=t.ae.mul([],a,o);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),i=t.ae.identity([]);t.ae.translate(i,i,[e.x*this.worldSize,e.y*this.worldSize,0]),t.ae.multiply(i,i,t.aZ(this)),t.ae.translate(i,i,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.ae.multiply(u,u,i),t.ae.multiply(c,c,i),this.inverseAdjustmentMatrix=t.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ae.scale([],u,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=u,this.invProjMatrix=t.ae.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-e.x/this.width,i[9]=2*e.y/this.height,this.expandedFarZProjMatrix=t.ae.mul([],i,o)}else this.expandedFarZProjMatrix=this.projMatrix;const l=t.ae.invert([],a);this.frustumCorners=t.a$.fromInvProjectionMatrix(l,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const f=new Float32Array(16);t.ae.identity(f),t.ae.scale(f,f,[1,-1,1]),t.ae.rotateX(f,f,this._pitch),t.ae.rotateZ(f,f,this.angle);const d=t.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ae.clone(d);const p=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;d[8]=2*-e.x/this.width,d[9]=2*(e.y+p)/this.height,this.skyboxMatrix=t.ae.multiply(f,d,f);const m=this.point,_=m.x,v=m.y,g=this.width%2/2,b=this.height%2/2,w=Math.cos(this.angle),y=Math.sin(this.angle),x=_-Math.round(_)+w*g+y*b,M=v-Math.round(v)+w*b+y*g,T=new Float64Array(u);if(t.ae.translate(T,T,[x>.5?x-1:x,M>.5?M-1:M,0]),this.alignedProjMatrix=T,u=t.ae.create(),t.ae.scale(u,u,[this.width/2,-this.height/2,1]),t.ae.translate(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=t.ae.create(),t.ae.scale(u,u,[1,-1,1]),t.ae.translate(u,u,[-1,-1,0]),t.ae.scale(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=t.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=t.ae.invert(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=t.b0(this);const e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.$.transformMat4(e,e,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,n=this._camera.position,s=1/this.height/this._pixelsPerMercatorPixel,r=[e,e,i];t.$.scale(r,r,s),t.$.scale(n,n,-1),t.$.multiply(n,n,r);const o=t.ae.create();t.ae.translate(o,o,n),t.ae.scale(o,o,r),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,i,s)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),n=this.point,s=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-i[0]*s,n.y/this.worldSize-i[1]*s,t/this.worldSize*this._centerAltitude-i[2]*s]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],s=e[2];let r=1;this.projection.wrap&&(this.center=this.center.wrap()),s>0&&(r=Math.min((i-n)/s,1)),this._camera.position=t.$.scaleAndAdd([],this._camera.position,e,r),this._updateStateFromCamera()}_updateStateFromCamera(){const e=this._camera.position,i=this._camera.forward(),{pitch:n,bearing:s}=this._camera.getPitchBearing(),r=t.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ac(this._maxPitch)),a=Math.max((e[2]-r)/Math.cos(n),o),h=this._zoomFromMercatorZ(a);t.$.scaleAndAdd(e,e,i,a),this._pitch=t.au(n,t.ac(this.minPitch),t.ac(this.maxPitch)),this.angle=t.av(s,-Math.PI,Math.PI),this._setZoom(t.au(h,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t._(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(e){let i=0,n=t.aV,s=0,r=1/0;for(;n-i>1e-6&&n>i;){const t=i+.5*(n-i),o=this.tileSize*Math.pow(2,t),a=this.getCameraToCenterDistance(this.projection,t,o),h=this.scaleZoom(a/(e*this.tileSize)),c=Math.abs(t-h);c<r&&(r=c,s=t),t<h?i=t:n=t}return s}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,i){const n=Math.min(e.x,i.x),s=Math.max(e.x,i.x),r=Math.min(e.y,i.y),o=Math.max(e.y,i.y);if(r<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.P(n,r),new t.P(s,o),new t.P(n,o),new t.P(s,r)],h=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const i=this.rayIntersectionCoordinate(e);if(i.x<h||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(e,i){const n=t.$.length(t.$.sub([],this._camera.position,e)),s=this._zoomFromMercatorZ(n)+i;return n-this._mercatorZfromZoom(s)}getCameraPoint(){if("globe"===this.projection.name){const e=function([e,i,n],s){const r=[e,i,n,1];t.aB.transformMat4(r,r,s);const o=r[3]=Math.max(r[3],1e-6);return r[0]/=o,r[1]/=o,r[2]/=o,r}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(e[0],e[1])}{const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}}getCameraToCenterDistance(e,i=this.zoom,n=this.worldSize){const s=t.aY(e,i,this.width,this.height,1024),r=e.pixelSpaceConversion(this.center.lat,n,s);let o=.5/Math.tan(.5*this._fov)*this.height*r;return this.isOrthographic&&(o=hi(1,o,ci(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const e=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&t.ae.multiply(e,e,this.globeMatrix),e}getFrustum(e){return t.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,"meters"===this.projection.zAxisUnit)}}const li={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},fi=(e,i)=>{if(i>0&&e.terrain&&t.w("Cutoff is currently disabled on terrain"),i<=0||e.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=e.transform,s=Math.max(Math.abs(n._zoom-(e.minCutoffZoom-1)),1),r=n.isLODDisabled(!1)?t.a0(60,45,n.pitch):t.a0(30,15,n.pitch),o=n._farZ-n._nearZ,a=i*n.height,h=((1-(c=r))*n.cameraToCenterDistance+c*(n._farZ+a))*s;var c;return{shouldRenderCutoff:r<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(h-n._nearZ)/o,(h-a-n._nearZ)/o]}}},di={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class pi{constructor(t,e){this.aabb=t,this.lastCascade=e}}class mi{add(t,e){const i=this.receivers[t.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],e.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],e.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],e.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],e.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],e.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],e.max[2])):this.receivers[t.key]=new pi(e,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(e,i,n){const s=t.b8.fromPoints(e.points);let r=0;for(const e in this.receivers){const o=this.receivers[e];if(!o)continue;if(!s.intersectsAabb(o.aabb))continue;o.aabb.min=s.closestPoint(o.aabb.min),o.aabb.max=s.closestPoint(o.aabb.max);const a=o.aabb.getCorners();for(let e=0;e<n.length;e++){let s=!0;for(const r of a){const o=[r[0]*i,r[1]*i,r[2]];if(t.$.transformMat4(o,o,n[e].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){s=!1;break}}if(o.lastCascade=e,r=Math.max(r,e),s)break}}return r+1}}class _i{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new mi,this._depthMode=new t.af(e.context.gl.LEQUAL,t.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),e.tp.registerParameter(di,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(di,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),e.tp.registerParameter(di,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,i){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const s=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||s<=0)return;if(this._shadowLayerCount=n.style.order.reduce(((t,i)=>{const s=n.style._mergedLayers[i];return t+(s.hasShadowPass()&&!s.isHidden(e.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const r=n.context,o=di.shadowMapResolution,a=di.shadowMapResolution;if(0===this._cascades.length||di.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let e=0;e<di.cascadeCount;++e){const e=n._shadowMapDebug,i=r.gl,s=r.createFramebuffer(o,a,e,"texture"),h=new t.T(r,{width:o,height:a,data:null},i.DEPTH_COMPONENT);if(s.depthAttachment.set(h.texture),e){const e=new t.T(r,{width:o,height:a,data:null},i.RGBA);s.colorAttachment.set(e.texture)}this._cascades.push({framebuffer:s,texture:h,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.aM,scale:0})}}this.shadowDirection=gi(i);let h=0;if(e.elevation){const t=e.elevation,i=[1e4,-1e4];t.visibleDemTiles.filter((t=>t.dem)).forEach((t=>{const e=t.dem.tree;i[0]=Math.min(i[0],e.minimums[0]),i[1]=Math.max(i[1],e.maximums[0])})),1e4!==i[0]&&(h=(i[1]-i[0])*t.exaggeration())}const c=1.5*e.cameraToCenterDistance,u=3*c,l=new Float64Array(16);for(let i=0;i<this._cascades.length;++i){const n=this._cascades[i];let s=e.height/50,r=1;1===di.cascadeCount?r=u:0===i?r=c:(s=c,r=u);const[o,a]=wi(e,this.shadowDirection,s,r,di.shadowMapResolution,h);n.scale=e.scale,n.matrix=o,n.boundingSphereRadius=a,t.ae.invert(l,n.matrix),n.frustum=t.aM.fromInvProjectionMatrix(l,1,0,!0),n.far=r}const f=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[f].far,this._cascades[f].far],this._uniformValues.u_shadow_intensity=s,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/di.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=di.shadowMapResolution,this._uniformValues.u_shadowmap_0=li.ShadowMap0,this._uniformValues.u_shadowmap_1=li.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const d=n.transform.elevation;for(const t of this._groundShadowTiles){let e={min:0,max:0};if(d){const i=d.getMinMaxForTile(t);i&&(e=i)}this.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(e,i){if(!this.enabled)return;const n=this.painter,s=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),s.viewport.set([0,0,di.shadowMapResolution,di.shadowMapResolution]);for(let r=0;r<this._numCascadesToRender;++r){n.currentShadowCascade=r,s.bindFramebuffer.set(this._cascades[r].framebuffer.framebuffer),s.clear({color:t.C.white,depth:1});for(const t of e.order){const s=e._mergedLayers[t];if(!s.hasShadowPass()||s.isHidden(n.transform.zoom))continue;const r=e.getLayerSourceCache(s),o=r?i[r.id]:void 0;("model"===s.type||o&&o.length)&&n.renderLayer(n,r,s,o)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,i=e.style,n=e.context,s=i.directionalLight,r=i.ambientLight;if(!s||!r)return;const o=[],a=fi(e,e.longestCutoffRange);a.shouldRenderCutoff&&o.push("RENDER_CUTOFF");const h=bi(i,s,r),c=new t.af(n.gl.LEQUAL,t.af.ReadOnly,e.depthRangeFor3D);for(const i of this._groundShadowTiles){const s=i.toUnwrapped(),r=e.isTileAffectedByFog(i),u=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:r});this.setupShadows(s,u),e.uploadCommonUniforms(n,u,s,null,a);const l={u_matrix:e.transform.calculateProjMatrix(s),u_ground_shadow_factor:h};u.draw(e,n.gl.TRIANGLES,c,t.ah.disabled,t.a.multiply,t.ag.disabled,l,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?t.a.unblended:t.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){const i=this.painter.transform,n=i.calculatePosMatrix(e,i.worldSize);return t.ae.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(e){return t.ae.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,i,n,s=0){if(!this.enabled)return;const r=this.painter.transform,o=this.painter.context,a=o.gl,h=this._uniformValues,c=new Float64Array(16),u=r.calculatePosMatrix(e,r.worldSize);for(let e=0;e<this._cascades.length;e++)t.ae.multiply(c,this._cascades[e].matrix,u),h[0===e?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),o.activeTexture.set(a.TEXTURE0+li.ShadowMap0+e),this._cascades[e].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=!!n,this.useNormalOffset){const i=t.b7(e.canonical),o=2/r.tileSize*t.a4/di.shadowMapResolution,a=o*this._cascades[0].boundingSphereRadius,c=o*this._cascades[this._cascades.length-1].boundingSphereRadius,u=("vector-tile"===n?1:3)/Math.pow(2,s-e.canonical.z-(1-r.zoom+Math.floor(r.zoom)));h.u_shadow_normal_offset=[i,a*u,c*u],h.u_shadow_bias=[6e-5,.0012,.012]}else h.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(o,h)}setupShadowsFromMatrix(e,i,n=!1){if(!this.enabled)return;const s=this.painter.context,r=s.gl,o=this._uniformValues,a=new Float64Array(16);for(let i=0;i<di.cascadeCount;i++)t.ae.multiply(a,this._cascades[i].matrix,e),o[0===i?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),s.activeTexture.set(r.TEXTURE0+li.ShadowMap0+i),this._cascades[i].texture.bind(r.NEAREST,r.CLAMP_TO_EDGE);if(this.useNormalOffset=n,n){const t=di.normalOffset;o.u_shadow_normal_offset=[1,t,t],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(s,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,i,n,s){if(s[2]>=0)return{};const r=function(e,i,n){const s=n/(1<<e.canonical.z);return new t.b8([e.canonical.x*s+e.wrap*n,e.canonical.y*s+e.wrap*n,0],[(e.canonical.x+1)*s+e.wrap*n,(e.canonical.y+1)*s+e.wrap*n,i])}(e,i,n).getCorners(),o=i/-s[2];s[0]<0?(t.$.add(r[0],r[0],[s[0]*o,0,0]),t.$.add(r[3],r[3],[s[0]*o,0,0])):s[0]>0&&(t.$.add(r[1],r[1],[s[0]*o,0,0]),t.$.add(r[2],r[2],[s[0]*o,0,0])),s[1]<0?(t.$.add(r[0],r[0],[0,s[1]*o,0]),t.$.add(r[1],r[1],[0,s[1]*o,0])):s[1]>0&&(t.$.add(r[2],r[2],[0,s[1]*o,0]),t.$.add(r[3],r[3],[0,s[1]*o,0]));const a={};return a.vertices=r,a.planes=[vi(r[1],r[0],r[4]),vi(r[2],r[1],r[5]),vi(r[3],r[2],r[6]),vi(r[0],r[3],r[7])],a}addShadowReceiver(e,i,n){this._receivers.add(e,t.b8.fromTileIdAndHeight(e,i,n))}getMaxCascadeForTile(t){const e=this._receivers.get(t);return e&&e.lastCascade?e.lastCascade:0}}function vi(e,i,n){const s=t.$.sub([],n,i),r=t.$.sub([],e,i),o=t.$.cross([],s,r),a=t.$.length(o);return 0===a?[0,0,1,0]:(t.$.scale(o,o,1/a),[o[0],o[1],o[2],-t.$.dot(o,i)])}function gi(e){const i=e.properties.get("direction"),n=t.ad(i.x,i.y,i.z);n[2]=t.au(n[2],0,75);const s=t.b9([n[0],n[1],n[2]]);return t.$.fromValues(s.x,s.y,s.z)}function bi(e,i,n){const s=i.properties.get("color"),r=i.properties.get("intensity"),o=i.properties.get("direction"),a=[o.x,o.y,o.z],h=n.properties.get("color"),c=n.properties.get("intensity"),u=Math.max(t.$.dot([0,0,1],a),0),l=[0,0,0];t.$.scale(l,h.toRenderColor(e.getLut(i.scope)).toArray01Linear().slice(0,3),c);const f=[0,0,0];return t.$.scale(f,s.toRenderColor(e.getLut(n.scope)).toArray01Linear().slice(0,3),u*r),t.ba([l[0]>0?l[0]/(l[0]+f[0]):0,l[1]>0?l[1]/(l[1]+f[1]):0,l[2]>0?l[2]/(l[2]+f[2]):0])}function wi(e,i,n,s,r,o){const a=e.zoom,h=e.scale,c=e.worldSize,u=1/c,l=e.aspect,f=Math.sqrt(1+l*l)*Math.tan(.5*e.fovX),d=f*f,p=s-n,m=s+n;let _,v;d>p/m?(_=s,v=s*f):(_=.5*m*(1+d),v=.5*Math.sqrt(p*p+2*(s*s+n*n)*d+m*m*d*d));const g=e.projection.pixelsPerMeter(e.center.lat,c),b=e._camera.getCameraToWorldMercator(),w=[0,0,-_*u];t.$.transformMat4(w,w,b);let y=v*u;const x=e._edgeInsets;if(!(0===x.left&&0===x.top&&0===x.right&&0===x.bottom||x.left===x.right&&x.top===x.bottom)){const i=e._camera.getWorldToCamera(e.worldSize,"meters"===e.projection.zAxisUnit?g:1),r=e._camera.getCameraToClipPerspective(e._fov,e.width/e.height,n,s);r[8]=2*-e.centerOffset.x/e.width,r[9]=2*e.centerOffset.y/e.height;const o=new Float64Array(16);t.ae.mul(o,r,i);const u=new Float64Array(16);t.ae.invert(u,o);const l=t.aM.fromInvProjectionMatrix(u,c,a,!0);for(const i of l.points){const n=((M=i)[0]/=h,M[1]/=h,M[2]=t.ay(M[2],e._center.lat),M);y=Math.max(y,t.$.len(t.$.subtract([],w,n)))}}var M;y*=r/(r-1);const T=Math.acos(i[2]),O=Math.atan2(-i[0],-i[1]),E=new He;E.position=w,E.setPitchBearing(T,O);const A=E.getWorldToCamera(c,g),S=y*c,k=Math.min(e._mercatorZfromZoom(17)*c*-2,-2*S),I=E.getCameraToClipOrthographic(-S,S,-S,S,k,(S+o*g)/i[2]),C=new Float64Array(16);t.ae.multiply(C,I,A);const j=t.$.fromValues(Math.floor(1e6*w[0])/1e6*c,Math.floor(1e6*w[1])/1e6*c,0),D=.5*r,R=[0,0,0];t.$.transformMat4(R,j,C),t.$.scale(R,R,D);const P=[Math.floor(R[0]),Math.floor(R[1]),Math.floor(R[2])],N=[0,0,0];t.$.sub(N,R,P),t.$.scale(N,N,-1/D);const F=new Float64Array(16);return t.ae.identity(F),t.ae.translate(F,F,N),t.ae.multiply(C,F,C),[C,S]}function yi(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const xi=new class{constructor(){this.operations={}}newMorphing(t,e,i,n,s){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==i.tileID.key&&(e.queued=i)}else this.operations[t]={startTime:n,phase:0,duration:s,from:e,to:i,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const i=this.operations[e];for(i.phase=(t-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},Mi={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ti(t,e,i){if(0===e)return 0;const n=e<1&&514===i?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*n}function Oi(t,e){const i=1<<t.z;return!e&&(0===t.x||t.x===i-1)||0===t.y||t.y===i-1}const Ei=t=>({u_matrix:t});function Ai(e,i,n,s,r){if(r>0){const o=t.e.now(),a=(o-e.timeAdded)/r,h=i?(o-i.timeAdded)/r:-1,c=n.getSource(),u=s.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),l=!i||Math.abs(i.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),f=l&&e.refreshedUponExpiration?1:t.au(l?a:1-h,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),i?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}class Si extends Pe{constructor(e,i,n,s){super(e,i,n,s),this.type="raster-array",this.maxzoom=22,this._options=t.Q({type:"raster-array"},i)}triggerRepaint(t){const e=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);e&&e.enabled&&i&&e._clearRenderCacheForTile(i.id,t.tileID),this.map.triggerRepaint()}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),s=this.map._requestManager.transformRequest(n,t.R.Tile);e.requestParams=s,e.actor||(e.actor=this.dispatcher.getActor()),e.request=e.fetchHeader(void 0,((t,n,s,r)=>{if(delete e.request,e.aborted)return e.state="unloaded",i(null);if(t){if(20===t.code)return;return e.state="errored",i(t)}this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:r}),e.state="empty",i(null)}))}unloadTile(e,i){const n=e.texture;n&&n instanceof t.T?(e.destroy(!0),this.map.painter.saveTileTexture(n)):(e.destroy(),e.flushQueues(),e._isHeaderLoaded=!1,delete e._mrt,delete e.textureDescriptor),e.fbo&&(e.fbo.destroy(),delete e.fbo),delete e.request,delete e.requestParams,delete e.neighboringTiles,e.state="unloaded"}prepareTile(e,i,n){e._isHeaderLoaded&&("empty"!==e.state&&(e.state="reloading"),e.fetchBand(i,n,((i,n)=>{if(i)return e.state="errored",this.fire(new t.f(i)),void this.triggerRepaint(e);n&&(e.setTexture(n,this.map.painter),e.state="loaded",this.triggerRepaint(e))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const e=this.rasterLayers.find((({id:e})=>e===t)),i=e&&e.fields,n=i&&i.bands&&i.bands;return n?n[0]:0}getTextureDescriptor(e,i,n){if(!e)return;const s=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!s)return;let r=null;i instanceof t.bm?r=i.paint.get("raster-array-band"):i instanceof t.bn&&(r=i.paint.get("raster-particle-array-band"));const o=r||this.getInitialBand(s);if(null!=o)if(e.textureDescriptor){if(!e.updateNeeded(s,o)||n)return Object.assign({},e.textureDescriptor,{texture:e.texture})}else this.prepareTile(e,s,o)}}const ki={vector:Ne,raster:Pe,"raster-dem":class extends Pe{constructor(e,i,n,s){super(e,i,n,s),this.type="raster-dem",this.maxzoom=22,this._options=t.Q({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function s(t,n){t&&(e.state="errored",i(t)),n&&(e.dem=n,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",i(null))}e.request=t.i(this.map._requestManager.transformRequest(n,t.R.Tile),function(n,r,o,a){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(n)e.state="errored",i(n);else if(r){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:a});const i=ImageBitmap&&r instanceof ImageBitmap&&t.bk(),n=1-(r.width-t.bl(r.width))/2;n<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const h=i?r:t.e.getImageData(r,n),c={uid:e.uid,coord:e.tileID,source:this.id,scope:this.scope,rawImageData:h,encoding:this.encoding,padding:n};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",c,s.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(e){const i=e.canonical,n=Math.pow(2,i.z),s=(i.x-1+n)%n,r=0===i.x?e.wrap-1:e.wrap,o=(i.x+1+n)%n,a=i.x+1===n?e.wrap+1:e.wrap,h={};return h[new t.aQ(e.overscaledZ,r,i.z,s,i.y).key]={backfilled:!1},h[new t.aQ(e.overscaledZ,a,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(h[new t.aQ(e.overscaledZ,r,i.z,s,i.y-1).key]={backfilled:!1},h[new t.aQ(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},h[new t.aQ(e.overscaledZ,a,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<n&&(h[new t.aQ(e.overscaledZ,r,i.z,s,i.y+1).key]={backfilled:!1},h[new t.aQ(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},h[new t.aQ(e.overscaledZ,a,i.z,o,i.y+1).key]={backfilled:!1}),h}},"raster-array":Si,geojson:class extends t.E{constructor(e,i,n,s){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(s),this._data=i.data,this._options=t.Q({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),void 0!==i.minzoom&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const r=t.a4/this.tileSize;this.workerOptions=t.Q({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*r,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*r,extent:t.a4,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.a4,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*r,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(e){if(!this._options.dynamic)return this.fire(new t.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof e&&("Feature"===e.type&&(e={type:"FeatureCollection",features:[e]}),"FeatureCollection"!==e.type))return this.fire(new t.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof e&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const t=new Map;for(const e of this._data.features)t.set(e.id,e);for(const i of e.features)t.set(i.id,i);this._data.features=[...t.values()]}else this._data=e;return this._updateWorkerData(!0),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,i,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:i},n),this}_updateWorkerData(e=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.g("dataloading",{dataType:"source"})),this._loaded=!1;const i=t.Q({append:e},this.workerOptions);i.scope=this.scope;const n=this._data;"string"==typeof n?(i.request=this.map._requestManager.transformRequest(t.e.resolveURL(n),t.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,((i,n)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new t.f(i));else{const i={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(i.resourceTiming=n.resourceTiming[this.id]),e&&(this._partialReload=!0),this.fire(new t.g("data",i)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(e),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(e,i){const n=e.actor?"reloadTile":"loadTile";e.actor=this.actor;const s=this.map.style?this.map.style.getLut(this.scope):null,r=this._partialReload,o={type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:s?{image:s.image.clone()}:null,scope:this.scope,pixelRatio:t.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:r};e.request=this.actor.send(n,o,((t,s)=>r&&!s?(e.state="loaded",i(null)):(delete e.request,e.destroy(),e.aborted?i(null):t?i(t):(e.loadVectorData(s,this.map.painter,"reloadTile"===n),i(null)))),void 0,"loadTile"===n)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t,e){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(t){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.bo{constructor(t,e,i,n){super(t,e,i,n),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const i of e.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.R.Source).url);t.bp(this.urls,((e,i)=>{this._loaded=!0,e?this.fire(new t.f(e)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const i=this.video.seekable;e<i.start(0)||e>i.end(0)?this.fire(new t.f(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,i=e.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(e,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.bo,model:class extends t.E{constructor(t,e,i,n){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){const e=[];for(const i in this._options.models){const n=this._options.models[i],s=t.l(this.map._requestManager.transformRequest(n.uri,t.R.Model).url).then((e=>{if(!e)return;const s=t.c(e),r=new t.M(i,n.position,n.orientation,s);r.computeBoundsAndApplyParent(),this.models.push(r)})).catch((e=>{this.fire(new t.f(new Error(`Could not load model ${i} from ${n.uri}: ${e.message}`)))}));e.push(s)}return Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new t.g("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((e=>{this.fire(new t.f(new Error(`Could not load models: ${e.message}`)))}))}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(t,e,i,n){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(t){this.map=t,this.load()}load(e){this._loaded=!1,this.fire(new t.g("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=De(this._options,this.map._requestManager,i,n,((s,r)=>{this._tileJSONRequest=null,this._loaded=!0,s?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),n&&2!==n.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new t.f(s))):r&&(t.Q(this,r),r.bounds&&(this.tileBounds=new Re(r.bounds,this.minzoom,this.maxzoom)),t.ao(r.tiles,this.map._requestManager._customAccessToken),this.fire(new t.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.g("data",{dataType:"source",sourceDataType:"content"}))),e&&e(s)}))}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(e,i){const n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),s={request:this.map._requestManager.transformRequest(n,t.R.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(e.actor&&"expired"!==e.state)if("loading"===e.state)e.reloadCallback=i;else{if(e.buckets){const t=Object.values(e.buckets);for(const e of t)e.dirty=!0;return void(e.state="loaded")}e.request=e.actor.send("reloadTile",s,r.bind(this))}else e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",s,r.bind(this),void 0,!0);function r(t,n){return e.aborted?i(null):t&&404!==t.status?i(t):(n&&(n.resourceTiming&&(e.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(n),e.buckets={...e.buckets,...n.buckets},n.featureIndex&&(e.latestFeatureIndex=n.featureIndex)),e.state="loaded",void i(null))}}serialize(){return t.Q({},this._options)}},canvas:class extends t.bo{constructor(e,i,n,s){super(e,i,n,s),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((t=>!Array.isArray(t)||2!==t.length||t.some((t=>"number"!=typeof t))))||this.fire(new t.f(new t.V(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.f(new t.V(`sources.${e}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new t.f(new t.V(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new t.f(new t.V(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.f(new t.V(`sources.${e}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(t){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!e&&!this._playing||this.texture instanceof t.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.E{constructor(e,i,n,s){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=i,this.setEventedParent(s),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Re(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.Q(this,t.ai(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this.map=e,this._loaded=!1,this.fire(new t.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:i,z:n}=t.canonical;return this._implementation.hasTile({x:e,y:i,z:n})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){const{x:i,y:n,z:s}=t.tileID.canonical,r=new AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:i,y:n,z:s},{signal:r.signal})).then(function(i){return delete t.request,t.aborted?(t.state="unloaded",e(null)):void 0===i?(t.state="errored",e(null)):null===i?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(t){return t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof ImageBitmap||t instanceof HTMLImageElement}(i)?(this.loadTileData(t,i),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((i=>{20!==i.code&&(t.state="errored",e(i))})),t.request.cancel=()=>r.abort()}loadTileData(t,e){t.setTexture(e,this.map.painter)}unloadTile(e,i){if(e.texture&&e.texture instanceof t.T?(e.destroy(!0),e.texture&&e.texture instanceof t.T&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),this._implementation.unloadTile){const{x:t,y:i,z:n}=e.tileID.canonical;this._implementation.unloadTile({x:t,y:i,z:n})}i&&i()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e&&e()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z})))}_clearTiles(){const e=t.am(this.id,this.scope);this.map.style.clearSource(e)}_update(){this.fire(new t.g("data",{dataType:"source",sourceDataType:"content"}))}}},Ii=function(e,i,n,s){const r=new ki[i.type](e,i,n,s);if(r.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${r.id}`);return t.br(["load","abort","unload","serialize","prepare"],r),r};class Ci extends t.bx{constructor(e){const i={type:"raster-dem",maxzoom:e.transform.maxZoom},n=new t.by(t.bz(),null),s=Ii("mock-dem",i,n,e.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class ji extends t.bx{constructor(e){const i=Ii("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new t.by(t.bz(),null),e.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,i,n){if(e.freezeTileCoverage)return;this.transform=e;const s=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((i,n)=>{if(i[n.key]="",!this._tiles[n.key]){const i=new t.bA(n,this._source.tileSize*n.overscaleFactor(),e.tileZoom);i.state="loaded",this._tiles[n.key]=i}return i}),{});for(const t in this._tiles)t in s||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const i=Object.values(e);this.renderCachePool.push(...i),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Di extends t.aQ{constructor(t,e,i){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=i}}class Ri extends t.bs{constructor(e,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},e.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),e.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,s,r]=function(e){const i=new t.bv,n=new t.bw,s=131;i.reserve(17161),n.reserve(33800);const r=t.a4/128,o=t.a4+r/2,a=o+r;for(let e=-r;e<a;e+=r)for(let n=-r;n<a;n+=r){const s=n<0||n>o||e<0||e>o?24575:0,r=t.au(Math.round(n),0,t.a4),a=t.au(Math.round(e),0,t.a4);i.emplaceBack(r+s,a)}const h=(t,e)=>{const i=e*s+t;n.emplaceBack(i+1,i,i+s),n.emplaceBack(i+s,i+s+1,i+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)h(e,t);return[0,129].forEach((t=>{for(let e=0;e<130;e++)h(e,t),h(t,e)})),[i,n,32768]}(),o=e.context;this.gridBuffer=o.createVertexBuffer(n,t.bt.members),this.gridIndexBuffer=o.createIndexBuffer(s),this.gridSegments=t.b.simpleSegment(0,0,n.length,s.length),this.gridNoSkirtSegments=t.b.simpleSegment(0,0,n.length,r),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ji(i.map),this.orthoMatrix=t.ae.create(),t.ae.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,t.a4,0,t.a4,0,1);const a=o.gl;this._overlapStencilMode=new t.ah({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ci(i.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(e,i,n){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);const s=e.terrain.properties,r=0===e.terrain.drapeRenderMode,o=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.e.now();const a=e.terrain&&e.terrain.scope,h=s.get("source"),c=r?this._mockSourceCache:e.getSourceCache(h,a);if(!c)return void t.w(`Couldn't find terrain source "${h}".`);if(this.sourceCache=c,this._exaggeration=o?this.calculateExaggeration(i):s.get("exaggeration"),!i.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(i,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),i.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(e){const i=this._previousCameraAltitude,n=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=n;const s=null!=i?n-i:Number.MAX_VALUE;if(Math.abs(s)<2)return this._exaggeration;const r=e.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(r);let a=r-this._previousZoom;const h=this._previousUpdateTimestamp;let c=r;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(r-c)>.5&&(a=.5*(r-c+a)),a*s<0&&(c+=a)),this._evaluationZoom=c;const u=o.getExaggeration(c),l=u===o.getExaggeration(Math.max(0,c-.1));if(l&&Math.abs(u-this._exaggeration)<.01)return u;let f=Math.min(.1,.00375*(this._updateTimestamp-h));return(l||u<.1||Math.abs(a)<1e-4)&&(f=Math.min(.2,4*f)),t.a3(this._exaggeration,u,f)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(t._.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const s=this.proxyCoords=i.getIds().map((t=>{const e=i.getTileByID(t).tileID;return e.projMatrix=n.calculateProjMatrix(e.toUnwrapped()),e}));!function(e,i){const n=i.transform.pointCoordinate(i.transform.getCameraPoint()),s=new t.P(n.x,n.y);e.sort(((e,i)=>{if(i.overscaledZ-e.overscaledZ)return i.overscaledZ-e.overscaledZ;const n=new t.P(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),r=new t.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=s.mult(1<<e.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(r)}))}(s,this.painter);const r=this.proxyToSource||{};this.proxyToSource={},s.forEach((t=>{this.proxyToSource[t.key]={}})),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const t in o){const i=o[t];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,e[t],r),i.usedForTerrain)continue;const n=e[t];i.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[i.id]=s.map((t=>new Di(t,t.key,this.orthoMatrix))),this._assignTerrainTiles(s),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(r),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const i=e.tileID.key;i in a||(this._visibleDemTiles.push(e),a[i]=i)}}_assignTerrainTiles(t){this._initializing||t.forEach((t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)}))}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const i in this.terrainTileForTile){const n=this.terrainTileForTile[i],s=n.dem;!s||n.demTexture&&!n.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),Ce(this.painter,n,s))}}_prepareDemTileUniforms(t,e,i,n){if(!e||null==e.demTexture)return!1;const s=t.tileID.canonical,r=Math.pow(2,e.tileID.canonical.z-s.z),o=n||"";return i[`u_dem_tl${o}`]=[s.x*r%1,s.y*r%1],i[`u_dem_scale${o}`]=r,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const e=this._visibleDemTiles.reduce(((e,i)=>{if(!i.dem)return e;const n=i.dem.tree.minimums[0];return n>0&&t++,e+n}),0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,i=e.gl;e.activeTexture.set(i.TEXTURE2);const n=this._getLoadedAreaMinimum(),[s,r]=(()=>{const e=new t.bB({width:1,height:1},new Float32Array([n]));return[i.R32F,e]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(r,{premultiply:!1}):o=this._emptyDEMTexture=new t.T(e,r,s,{premultiply:!1}),o}setupElevationDraw(e,i,n){const s=this.painter.context,r=s.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};o.u_exaggeration=this.exaggeration();let a=null,h=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const t=n.morphing.srcDemTile,i=n.morphing.dstDemTile;c=n.morphing.phase,t&&i&&(this._prepareDemTileUniforms(e,t,o,"_prev")&&(h=t),this._prepareDemTileUniforms(e,i,o)&&(a=i))}const u=t=>t&&t.demTexture&&this.painter.linearFloatFilteringSupported()?r.LINEAR:r.NEAREST;let l=null;var f;if(this.enabled?h&&a?(l=a.demTexture,s.activeTexture.set(r.TEXTURE4),h.demTexture.bind(u(h),r.CLAMP_TO_EDGE),o.u_dem_lerp=c):(a=this.terrainTileForTile[e.tileID.key],l=this._prepareDemTileUniforms(e,a,o)?a.demTexture:this.emptyDEMTexture):l=this.emptyDEMTexture,s.activeTexture.set(r.TEXTURE2),l&&(o.u_dem_size=1===(f=l).size[0]?1:f.size[0]-2,l.bind(u(a),r.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(n&&n.useDepthForOcclusion,i,o),n&&n.useMeterToDem&&a){const e=(1<<a.tileID.canonical.z)*t.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=e}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),i.setTerrainUniformValues(s,o),"globe"===this.painter.transform.projection.name){const t=this.globeUniformValues(this.painter.transform,e.tileID.canonical,n&&n.useDenormalizedUpVectorScale);i.setGlobeUniformValues(s,t)}}globeUniformValues(e,i,n){const s=e.projection;return{u_tile_tl_up:s.upVector(i,0,0),u_tile_tr_up:s.upVector(i,t.a4,0),u_tile_br_up:s.upVector(i,t.a4,t.a4),u_tile_bl_up:s.upVector(i,0,t.a4),u_tile_up_scale:n?t.bu(1):s.upVectorScale(i,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){const i=this.painter,n=this.painter.context;0!==e.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(e,i,n,s,r){if("globe"===e.transform.projection.name)!function(e,i,n,s,r){const o=e.context,a=o.gl;let h,c;const u=e.transform,l=t.bc(e,o,u),f=(t,i)=>{if(c===i)return;const n=[Mi[i],"PROJECTION_GLOBE_VIEW"];l&&n.push("CUSTOM_ANTIALIASING");const s=e.isTileAffectedByFog(t);h=e.getOrCreateProgram("globeRaster",{defines:n,overrideFog:s}),c=i},d=e.colorModeForRenderPass(),p=new t.af(a.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D);xi.update(r);const m=t.bd(u),_=[t.ak(u.center.lng),t.al(u.center.lat)],v=e.globeSharedBuffers,g=[u.width*t.e.devicePixelRatio,u.height*t.e.devicePixelRatio],b=Float32Array.from(u.globeMatrix),w={useDenormalizedUpVectorScale:!0};{const u=e.transform,l=Ti(u.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const y=a.TRIANGLES;for(const c of s){const s=n.getTile(c),x=t.ah.disabled,M=i.prevTerrainTileForTile[c.key],T=i.terrainTileForTile[c.key];yi(M,T)&&xi.newMorphing(c.key,M,T,r,250),o.activeTexture.set(a.TEXTURE0),s.texture&&s.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const O=xi.getMorphValuesForProxy(c.key),E=O?1:0;O&&t.q(w,{morphing:{srcDemTile:O.from,dstDemTile:O.to,phase:t.bb(O.phase)}});const A=t.be(c.canonical),S=t.bf(A.getCenter().lat),k=t.bg(c.canonical,A,S,u.worldSize/u._pixelsPerMercatorPixel),I=t.bh(t.bi(c.canonical)),C=ze(u.expandedFarZProjMatrix,b,m,I,t.a2(u.zoom),_,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,g,l,u._farZ,k);if(f(c,E),h&&(i.setupElevationDraw(s,h,w),e.uploadCommonUniforms(o,h,c.toUnwrapped()),v)){const[i,n,s]=v.getGridBuffers(S,0!==l);h.draw(e,y,p,x,d,t.ag.backCCW,C,"globe_raster",i,n,s)}}}if(v&&(e.renderDefaultNorthPole||e.renderDefaultSouthPole)){const r=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];l&&r.push("CUSTOM_ANTIALIASING"),h=e.getOrCreateProgram("globeRaster",{defines:r});for(const r of s){const{x:s,y:c,z:l}=r.canonical,f=0===c,m=c===(1<<l)-1,[b,y,x,M]=v.getPoleBuffers(l,!1);if(M&&(f||m)){const c=n.getTile(r);o.activeTexture.set(a.TEXTURE0),c.texture&&c.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let v=t.bj(l,s,u);const T=t.bh(t.bi(r.canonical)),O=(i,n)=>i.draw(e,a.TRIANGLES,p,t.ah.disabled,d,t.ag.disabled,ze(u.expandedFarZProjMatrix,v,v,T,0,_,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,g,0,u._farZ),"globe_pole_raster",n,x,M);i.setupElevationDraw(c,h,w),e.uploadCommonUniforms(o,h,r.toUnwrapped()),f&&e.renderDefaultNorthPole&&O(h,b),m&&e.renderDefaultSouthPole&&(v=t.ae.scale(t.ae.create(),v,[1,-1,1]),O(h,y))}}}}(e,i,n,s,r);else{const o=e.context,a=o.gl;let h,c;const u=e.shadowRenderer,l=fi(e,e.longestCutoffRange),f=t=>{if(c===t)return;const i=[];i.push(Mi[t]),l.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),h=e.getOrCreateProgram("terrainRaster",{defines:i}),c=t},d=e.colorModeForRenderPass(),p=new t.af(a.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D);xi.update(r);const m=e.transform,_=Ti(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let v=[0,0,0];if(u){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(v=bi(e.style,t,i))}{c=-1;const g=a.TRIANGLES,[b,w]=[i.gridIndexBuffer,i.gridSegments];for(const c of s){const s=n.getTile(c),y=t.ah.disabled,x=i.prevTerrainTileForTile[c.key],M=i.terrainTileForTile[c.key];yi(x,M)&&xi.newMorphing(c.key,x,M,r,250),o.activeTexture.set(a.TEXTURE0),s.texture&&s.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=xi.getMorphValuesForProxy(c.key),O=T?1:0;let E;T&&(E={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:t.bb(T.phase)}});const A=Fe(c.projMatrix,Oi(c.canonical,m.renderWorldCopies)?_/10:_,v);if(f(O),!h)continue;i.setupElevationDraw(s,h,E);const S=c.toUnwrapped();u&&u.setupShadows(S,h),e.uploadCommonUniforms(o,h,S,null,l),h.draw(e,g,p,y,d,t.ag.backCCW,A,"terrain_raster",i.gridBuffer,b,w)}}}}(i,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const i=this.painter,n=this.painter.context,s=this.proxySourceCache,r=this.proxiedCoords[s.id],o=this._drapedRenderBatches.shift(),a=i.style.order,h=[];let c=0;for(const u of r){const r=s.getTileByID(u.proxyTileKey),l=s.proxyCachedFBO[u.key]?s.proxyCachedFBO[u.key][e]:void 0,f=void 0!==l?s.renderCache[l]:this.pool[c++],d=void 0!==l;if(r.texture=f.tex,d&&!f.dirty){h.push(r.tileID);continue}let p;n.bindFramebuffer.set(f.fb.framebuffer),this.renderedToTile=!1,f.dirty&&(n.clear({color:t.C.transparent,stencil:0}),f.dirty=!1);for(let t=o.start;t<=o.end;++t){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const s=i.style.getLayerSourceCache(e),r=s?this.proxyToSource[u.key][s.id]:[u];if(!r)continue;const o=r;n.viewport.set([0,0,f.fb.width,f.fb.height]),p!==(s?s.id:null)&&(this._setupStencil(f,r,e,s),p=s?s.id:null),i.renderLayer(i,s,e,o)}if(0===this._drapedRenderBatches.length)for(const t of this._pendingGroundEffectLayers){const e=i.style._mergedLayers[a[t]];if(e.isHidden(i.transform.zoom))continue;const s=i.style.getLayerSourceCache(e),r=s?this.proxyToSource[u.key][s.id]:[u];if(!r)continue;const o=r;n.viewport.set([0,0,f.fb.width,f.fb.height]),p!==(s?s.id:null)&&(this._setupStencil(f,r,e,s),p=s?s.id:null),i.renderLayer(i,s,e,o)}this.renderedToTile?(f.dirty=!0,h.push(r.tileID)):d||--c,5===c&&(c=0,this.renderToBackBuffer(h))}return this.renderToBackBuffer(h),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,i.width,i.height]),o.end+1}postRender(){}isLayerOrderingCorrect(t){const e=t.order.length;let i=-1,n=e;for(let s=0;s<e;++s)this._style.isLayerDraped(t._mergedLayers[t.order[s]])?i=Math.max(i,s):n=Math.min(n,s);return n>i}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((t=>t.dem)).forEach((e=>{t=Math.min(t,e.dem.tree.minimums[0])})),0===t?t:(t-30)*this._exaggeration}raycast(t,e,i){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter((t=>t.dem)).map((n=>{const s=n.tileID,r=1<<s.overscaledZ,{x:o,y:a}=s.canonical,h=o/r,c=(o+1)/r,u=a/r,l=(a+1)/r;return{minx:h,miny:u,maxx:c,maxy:l,t:n.dem.tree.raycastRoot(h,u,c,l,t,e,i),tile:n}}));n.sort(((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE)));for(const s of n){if(null==s.t)return null;const n=s.tile.dem.tree.raycast(s.minx,s.miny,s.maxx,s.maxy,t,e,i);if(null!=n)return n}return null}_createFBO(){const e=this.painter.context,i=e.gl,n=this.drapeBufferSize;e.activeTexture.set(i.TEXTURE0);const s=new t.T(e,{width:n[0],height:n[1],data:null},i.RGBA);s.bind(i.LINEAR,i.CLAMP_TO_EDGE);const r=e.createFramebuffer(n[0],n[1],!0,null);return r.colorAttachment.set(s.texture),r.depthAttachment=new it(e,r.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,r.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):r.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:r,tex:s,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const e=this._style._mergedLayers[t],i=e.isHidden(this.painter.transform.zoom);return"custom"===e.type?!i&&e.shouldRedrape():!i&&e.hasTransition()}))}_clearLineLayersFromRenderCache(){let e=!1;for(const t of this._style.getSources())if(t instanceof Ne){e=!0;break}if(!e)return;const i={};for(let e=0;e<this._style.order.length;++e){const n=this._style._mergedLayers[this._style.order[e]],s=this._style.getLayerSourceCache(n);if(s&&!i[s.id]&&!n.isHidden(this.painter.transform.zoom)&&"line"===n.type&&n.widthExpression()instanceof t.Z){i[s.id]=!0;for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][s.id];if(e)for(const t of e)this._clearRenderCacheForTile(s.id,t)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e]._source instanceof Pe){t=!0;break}if(!t)return;const e={};for(let t=0;t<this._style.order.length;++t){const i=this._style._mergedLayers[this._style.order[t]],n=this._style.getLayerSourceCache(i);if(!n||e[n.id])continue;if(i.isHidden(this.painter.transform.zoom)||"raster"!==i.type)continue;const s=i.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e){const e=Ai(n.getTile(t),n.findLoadedParent(t,0),n,this.painter.transform,s);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(n.id,t)}}}}_setupDrapedRenderBatches(){const e=this._style.order,i=e.length;if(0===i)return;const n=[];this._pendingGroundEffectLayers=[];let s,r=0,o=this._style._mergedLayers[e[r]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++r<i;)o=this._style._mergedLayers[e[r]];for(;r<i;++r){const t=this._style._mergedLayers[e[r]];t.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(t)?void 0===s&&(s=r):("fill-extrusion"===t.type&&this._pendingGroundEffectLayers.push(r),void 0!==s&&(n.push({start:s,end:r-1}),s=void 0)))}if(void 0!==s&&n.push({start:s,end:r-1}),0!==n.length){const e=n[n.length-1];this._pendingGroundEffectLayers.every((t=>t>e.end))||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let i=0;i<t.length;++i){const n=Object.values(t[i]);e.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,n=this._tilesDirty;for(let s=i.length-1;s>=0;s--){const r=i[s];if(e.getTileByID(r.key),void 0!==e.proxyCachedFBO[r.key]){const i=t[r.key],s=this.proxyToSource[r.key];let o=0;for(const t in s){const e=s[t],r=i[t];if(!r||r.length!==e.length||e.some(((e,i)=>e!==r[i]||n[t]&&n[t].hasOwnProperty(e.key)))){o=-1;break}++o}for(const t in e.proxyCachedFBO[r.key])e.renderCache[e.proxyCachedFBO[r.key][t]].dirty=o<0||o!==Object.values(i).length}}const s=[...this._drapedRenderBatches];s.sort(((t,e)=>e.end-e.start-(t.end-t.start)));for(const t of s)for(const n of i){if(e.proxyCachedFBO[n.key])continue;let i=e.renderCachePool.pop();void 0===i&&e.renderCache.length<50&&(i=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==i&&(e.proxyCachedFBO[n.key]={},e.proxyCachedFBO[n.key][t.start]=i,e.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,i,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const s=this.painter.context,r=s.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let o;if(i.isTileClipped())o=e.length,this._overlapStencilMode.test={func:r.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:r.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(s.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):t.ah.disabled}_renderTileClippingMasks(e,i){const n=this.painter,s=this.painter.context,r=s.gl;n._tileClippingMaskIDs={},s.setColorMode(t.a.disabled),s.setDepthMode(t.af.disabled);const o=n.getOrCreateProgram("clippingMask");for(const s of e){const e=n._tileClippingMaskIDs[s.key]=--i;o.draw(n,r.TRIANGLES,t.af.disabled,new t.ah({func:r.ALWAYS,mask:0},e,255,r.KEEP,r.KEEP,r.REPLACE),t.a.disabled,t.ag.disabled,Ei(s.projMatrix),"$clipping",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}pointCoordinate(e){const i=this.painter.transform;if(e.x<0||e.x>i.width||e.y<0||e.y>i.height)return null;const n=[e.x,e.y,1,1];t.aB.transformMat4(n,n,i.pixelMatrixInverse),t.aB.scale(n,n,1/n[3]),n[0]/=i.worldSize,n[1]/=i.worldSize;const s=i._camera.position,r=t.ay(1,i.center.lat),o=[s[0],s[1],s[2]/r,0],a=t.$.subtract([],n.slice(0,3),o);t.$.normalize(a,a);const h=this.raycast(o,a,this._exaggeration);return null!==h&&h?(t.$.scaleAndAdd(o,o,a,h),o[3]=o[2],o[2]*=r,o):null}_setupProxiedCoordsForOrtho(e,i,n){if(e.getSource()instanceof t.bo)return this._setupProxiedCoordsForImageSource(e,i,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};const s=this.proxiedCoords[e.id]=[],r=this.proxyCoords;for(let t=0;t<r.length;t++){const i=r[t],o=this._findTileCoveringTileID(i,e);if(o){const t=this._createProxiedId(i,o,n[i.key]&&n[i.key][e.id]);s.push(t),this.proxyToSource[i.key][e.id]=[t]}}let o=!1;const a=new Set;for(let t=0;t<i.length;t++){const r=e.getTile(i[t]);if(!r||!r.hasData())continue;const h=this._findTileCoveringTileID(r.tileID,this.proxySourceCache);if(h&&h.tileID.canonical.z!==r.tileID.canonical.z){const t=this.proxyToSource[h.tileID.key][e.id],i=this._createProxiedId(h.tileID,r,n[h.tileID.key]&&n[h.tileID.key][e.id]);t?t.splice(t.length-1,0,i):this.proxyToSource[h.tileID.key][e.id]=[i];const c=this.proxyToSource[h.tileID.key][e.id];a.has(c)||a.add(c),s.push(i),o=!0}}if(this._sourceTilesOverlap[e.id]=o,o&&this._debugParams.sortTilesHiZFirst)for(const t of a)t.sort(((t,e)=>e.overscaledZ-t.overscaledZ))}_setupProxiedCoordsForImageSource(e,i,n){if(!e.getSource().loaded())return;const s=this.proxiedCoords[e.id]=[],r=this.proxyCoords,o=e.getSource(),a=o.tileID;if(!a)return;const h=new t.P(a.x,a.y)._div(1<<a.z),c=o.coordinates.map(t._.fromLngLat).reduce(((t,e)=>(t.min.x=Math.min(t.min.x,e.x-h.x),t.min.y=Math.min(t.min.y,e.y-h.y),t.max.x=Math.max(t.max.x,e.x-h.x),t.max.y=Math.max(t.max.y,e.y-h.y),t)),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(e,i)=>{const n=e.wrap+e.canonical.x/(1<<e.canonical.z),s=e.canonical.y/(1<<e.canonical.z),r=t.a4/(1<<e.canonical.z),o=i.wrap+i.canonical.x/(1<<i.canonical.z),a=i.canonical.y/(1<<i.canonical.z);return n+r<o+c.min.x||n>o+c.max.x||s+r<a+c.min.y||s>a+c.max.y};for(let t=0;t<r.length;t++){const o=r[t];for(let t=0;t<i.length;t++){const r=e.getTile(i[t]);if(!r||!r.hasData())continue;if(u(o,r.tileID))continue;const a=this._createProxiedId(o,r,n[o.key]&&n[o.key][e.id]),h=this.proxyToSource[o.key][e.id];h?h.push(a):this.proxyToSource[o.key][e.id]=[a],s.push(a)}}}_createProxiedId(e,i,n){let s=this.orthoMatrix;if(n){const t=n.find((t=>t.key===i.tileID.key));if(t)return t}if(i.tileID.key!==e.key){const n=e.canonical.z-i.tileID.canonical.z;let r,o,a;s=t.ae.create();const h=i.tileID.wrap-e.wrap<<e.overscaledZ;n>0?(r=t.a4>>n,o=r*((i.tileID.canonical.x<<n)-e.canonical.x+h),a=r*((i.tileID.canonical.y<<n)-e.canonical.y)):(r=t.a4<<-n,o=t.a4*(i.tileID.canonical.x-(e.canonical.x+h<<-n)),a=t.a4*(i.tileID.canonical.y-(e.canonical.y<<-n))),t.ae.ortho(s,0,r,0,r,0,1),t.ae.translate(s,s,[o,a,0])}return new Di(i.tileID,e.key,s)}_findTileCoveringTileID(e,i){let n=i.getTile(e);if(n&&n.hasData())return n;const s=this._findCoveringTileCache[i.id],r=s[e.key];if(n=r?i.getTileByID(r):null,n&&n.hasData()||null===r)return n;let o=n?n.tileID:e,a=o.overscaledZ;const h=i.getSource().minzoom,c=[];if(!r){const s=i.getSource().maxzoom;if(e.canonical.z>=s){const n=e.canonical.z-s;i.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,i.transform.tileZoom),o=new t.aQ(a,e.wrap,s,e.canonical.x>>n,e.canonical.y>>n)):0!==n&&(a=s,o=new t.aQ(a,e.wrap,s,e.canonical.x>>n,e.canonical.y>>n))}o.key!==e.key&&(c.push(o.key),n=i.getTile(o))}const u=t=>{c.forEach((e=>{s[e]=t})),c.length=0};for(a-=1;a>=h&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const t=o.calculateScaledKey(a);if(n=i.getTileByID(t),n&&n.hasData())break;const e=s[t];if(null===e)break;void 0===e?c.push(t):n=i.getTileByID(e)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let i=this._tilesDirty[t];i||(i=this._tilesDirty[t]={}),i[e.key]=!0}}function Pi(e,i,n){const s=function(e,i,n){const s=t.$.dot(i,e),r=t.$.dot(n,[.2126,.7152,.0722]),o=(t,e,i)=>(1-i)*t+i*e,a=o(1-.3*Math.min(r,1),1,Math.min(s+1,1));return o(.92,1,Math.asin(t.au(i[2],-1,1))/Math.PI+.5)*a}(e,[0,0,1],i),r=[0,0,0];t.$.scale(r,n.slice(0,3),s);const o=[0,0,0];t.$.scale(o,i.slice(0,3),e[2]);const a=[0,0,0];return t.$.add(a,r,o),t.ba(a)}const Ni=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Fi=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class zi{static cacheKey(t,e,i,n){let s=`${e}${n?n.cacheKey:""}`;for(const e of i)t.usedDefines.includes(e)&&(s+=`/${e}`);return s}constructor(e,i,n,s,r,o){const a=e.gl;this.program=a.createProgram(),this.configuration=s,this.name=i,this.fixedDefines=[...o];const h=s?s.getBinderAttributes():[],c=(n.staticAttributes||[]).concat(h);let u=s?s.defines():[];u=u.concat(o.map((t=>`#define ${t}`)));const l="#version 300 es\n";let f=l+u.concat("precision mediump float;",Te,Me.fragmentSource).join("\n");for(const t of n.fragmentIncludes)f+=`\n${ye[t]}`;f+=`\n${n.fragmentSource}`;let d=l+u.concat("precision highp float;",Te,Me.vertexSource).join("\n");for(const t of n.vertexIncludes)d+=`\n${ye[t]}`;d+=`\n${n.vertexSource}`;const p=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(p,f),a.compileShader(p),a.attachShader(this.program,p);const m=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(m,d),a.compileShader(m),a.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let t=0;t<this.numAttributes;t++)if(c[t]){const e=c[t].startsWith("a_")?c[t]:`a_${c[t]}`;a.bindAttribLocation(this.program,t,e),this.attributes[e]=t}a.linkProgram(this.program),a.deleteShader(m),a.deleteShader(p),this.fixedUniforms=r(e),this.binderUniforms=s?s.getUniforms(e):[],(o.includes("TERRAIN")||-1!==i.indexOf("symbol")||-1!==i.indexOf("circle"))&&(this.terrainUniforms=(e=>({u_dem:new t.a8(e),u_dem_prev:new t.a8(e),u_dem_tl:new t.a9(e),u_dem_scale:new t.ab(e),u_dem_tl_prev:new t.a9(e),u_dem_scale_prev:new t.ab(e),u_dem_size:new t.ab(e),u_dem_lerp:new t.ab(e),u_exaggeration:new t.ab(e),u_depth:new t.a8(e),u_depth_size_inv:new t.a9(e),u_depth_range_unpack:new t.a9(e),u_occluder_half_size:new t.ab(e),u_occlusion_depth_offset:new t.ab(e),u_meter_to_dem:new t.ab(e),u_label_plane_matrix_inv:new t.a7(e)}))(e)),o.includes("GLOBE")&&(this.globeUniforms=(e=>({u_tile_tl_up:new t.ar(e),u_tile_tr_up:new t.ar(e),u_tile_br_up:new t.ar(e),u_tile_bl_up:new t.ar(e),u_tile_up_scale:new t.ab(e)}))(e)),o.includes("FOG")&&(this.fogUniforms=(e=>({u_fog_matrix:new t.a7(e),u_fog_range:new t.a9(e),u_fog_color:new t.at(e),u_fog_horizon_blend:new t.ab(e),u_fog_vertical_limit:new t.a9(e),u_fog_temporal_offset:new t.ab(e),u_frustum_tl:new t.ar(e),u_frustum_tr:new t.ar(e),u_frustum_br:new t.ar(e),u_frustum_bl:new t.ar(e),u_globe_pos:new t.ar(e),u_globe_radius:new t.ab(e),u_globe_transition:new t.ab(e),u_is_globe:new t.a8(e),u_viewport:new t.a9(e)}))(e)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(e=>({u_cutoff_params:new t.at(e)}))(e)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(e=>({u_lighting_ambient_color:new t.ar(e),u_lighting_directional_dir:new t.ar(e),u_lighting_directional_color:new t.ar(e),u_ground_radiance:new t.ar(e)}))(e)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(e=>({u_light_matrix_0:new t.a7(e),u_light_matrix_1:new t.a7(e),u_fade_range:new t.a9(e),u_shadow_normal_offset:new t.ar(e),u_shadow_intensity:new t.ab(e),u_shadow_texel_size:new t.ab(e),u_shadow_map_resolution:new t.ab(e),u_shadow_direction:new t.ar(e),u_shadow_bias:new t.ar(e),u_shadowmap_0:new t.a8(e),u_shadowmap_1:new t.a8(e)}))(e))}}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setGlobeUniformValues(t,e){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t]&&i[t].set(this.program,t,e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setCutoffUniformValues(t,e){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setLightsUniformValues(t,e){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}}setShadowUniformValues(t,e){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;t.program.set(this.program);for(const t in e)i[t].set(this.program,t,e[t])}_drawDebugWireframe(e,i,n,s,r,o,a,h,c,u){const l=e.options.wireframe;if(!1===l.terrain&&!1===l.layers2D&&!1===l.layers3D)return;const f=e.context;if(!(()=>!(!l.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!l.layers2D||e._terrain&&e._terrain.renderingToTexture||!Ni.includes(this.name))||!(!l.layers3D||!Fi.includes(this.name)))())return;const d=f.gl,p=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,r,f);if(!p)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const _=e.getOrCreateProgram(this.name,{config:this.configuration,defines:m});f.program.set(_.program);const v=(t,e,i)=>{if(e[t]&&i[t])for(const n in e[t])i[t][n]&&i[t][n].set(i.program,n,e[t][n].current)};c&&c.setUniforms(_.program,f,_.binderUniforms,a,{zoom:h}),v("fixedUniforms",this,_),v("terrainUniforms",this,_),v("globeUniforms",this,_),v("fogUniforms",this,_),v("lightsUniforms",this,_),v("shadowUniforms",this,_),p.bind(),f.setColorMode(new t.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE],t.C.transparent,[!0,!0,!0,!1])),f.setDepthMode(new t.af(i.func===d.LESS?d.LEQUAL:i.func,t.af.ReadOnly,i.range)),f.setStencilMode(t.ah.disabled);const g=3*o.primitiveLength*2,b=3*o.primitiveOffset*2*2;u&&u>1?d.drawElementsInstanced(d.LINES,g,d.UNSIGNED_SHORT,b,u):d.drawElements(d.LINES,g,d.UNSIGNED_SHORT,b),r.bind(),f.program.set(this.program),f.setDepthMode(i),f.setStencilMode(n),f.setColorMode(s)}draw(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m){const _=t.context,v=_.gl;if(this.failedToCreate)return;_.program.set(this.program),_.setDepthMode(i),_.setStencilMode(n),_.setColorMode(s),_.setCullFace(r);for(const t of Object.keys(this.fixedUniforms))this.fixedUniforms[t].set(this.program,t,o[t]);d&&d.setUniforms(this.program,_,this.binderUniforms,l,{zoom:f});const g={[v.POINTS]:1,[v.LINES]:2,[v.TRIANGLES]:3,[v.LINE_STRIP]:1}[e],b=m&&m>0?1:void 0;for(const r of u.get()){const o=r.vaos||(r.vaos={});(o[a]||(o[a]=new Se)).bind(_,this,h,d?d.getPaintVertexBuffers():[],c,r.vertexOffset,p||[],b),m&&m>1?v.drawElementsInstanced(e,r.primitiveLength*g,v.UNSIGNED_SHORT,r.primitiveOffset*g*2,m):c?v.drawElements(e,r.primitiveLength*g,v.UNSIGNED_SHORT,r.primitiveOffset*g*2):v.drawArrays(e,r.vertexOffset,r.vertexLength),e===v.TRIANGLES&&c&&this._drawDebugWireframe(t,i,n,s,c,r,l,f,d,m)}}}function Li(e,i){const n=Math.pow(2,i.tileID.overscaledZ),s=i.tileSize*Math.pow(2,e.transform.tileZoom)/n,r=s*(i.tileID.canonical.x+i.tileID.wrap*n),o=s*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.bD(i,1,e.transform.tileZoom),u_pixel_coord_upper:[r>>16,o>>16],u_pixel_coord_lower:[65535&r,65535&o]}}const $i=t.ae.create(),Ui=(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g)=>{const b=i.style.light,w=b.properties.get("position"),y=[w.x,w.y,w.z],x=t.bE.create();"viewport"===b.properties.get("anchor")&&(t.bE.fromRotation(x,-i.transform.angle),t.$.transformMat3(y,y,x));const M=b.properties.get("color"),T=i.transform,O={u_matrix:e,u_lightpos:y,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[M.r,M.g,M.b],u_vertical_gradient:+n,u_opacity:s,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$i,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:r,u_edge_radius:o,u_alignment:a,u_width_scale:h,u_flood_light_color:p,u_vertical_scale:m,u_flood_light_intensity:_,u_ground_shadow_factor:v,u_emissive_strength:g};return"globe"===T.projection.name&&(O.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],O.u_zoom_transition=l,O.u_inv_rot_matrix=d,O.u_merc_center=f,O.u_up_dir=T.projection.upVector(new t.aO(0,0,0),f[0]*t.a4,f[1]*t.a4),O.u_height_lift=u),O},Bi=(t,e,i,n,s)=>({u_matrix:t,u_edge_radius:e,u_alignment:i,u_width_scale:n,u_vertical_scale:s}),Gi=(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_)=>{const v=Ui(e,i,n,s,r,o,a,h,c,l,f,d,p,m,_,1,[0,0,0],0),g={u_height_factor:-Math.pow(2,c.overscaledZ)/u.tileSize/8};return t.Q(v,Li(i,u),g)},Hi=(t,e)=>({u_matrix:t,u_emissive_strength:e}),Vi=(e,i,n,s)=>t.Q(Hi(e,i),Li(n,s)),Wi=(t,e,i)=>({u_matrix:t,u_world:i,u_emissive_strength:e}),qi=(e,i,n,s,r)=>t.Q(Vi(e,i,n,s),{u_world:r}),Yi=(e,i,n,s)=>{const r=t.a4/n.tileSize;return{u_matrix:e,u_camera_to_center_distance:i.getCameraToCenterDistance(s),u_extrude_scale:[i.pixelsToGLUnits[0]/r,i.pixelsToGLUnits[1]/r]}},Xi=(t,e,i=1)=>({u_matrix:t,u_color:e.toRenderColor(null),u_overlay:0,u_overlay_scale:i}),Zi=t.ae.create(),Ji=(e,i,n,s,r,o,a)=>{const h=e.transform,c="globe"===h.projection.name,u=c?t.bF(h.zoom,i.canonical)*h._pixelsPerMercatorPixel:t.bD(n,1,o),l={u_matrix:i.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Zi,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){l.u_inv_rot_matrix=s,l.u_merc_center=r,l.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],l.u_zoom_transition=t.a2(h.zoom);const e=r[0]*t.a4,n=r[1]*t.a4;l.u_up_dir=h.projection.upVector(new t.aO(0,0,0),e,n)}return l};function Ki(t,[e,i,n,s],[r,o]){if(r===o)return[0,0,0,0];const a=255*(t-1)/(t*(o-r));return[e*a,i*a,n*a,s*a]}function Qi(t,e,[i,n]){return i===n?0:.5/t+(e-i)*(t-1)/(t*(n-i))}const tn=(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y)=>({u_matrix:e,u_normalize_matrix:i,u_globe_matrix:n,u_merc_matrix:s,u_grid_matrix:r,u_tl_parent:o,u_scale_parent:u,u_fade_t:l.mix,u_opacity:l.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:t.bG(f.paint.get("raster-saturation")),u_contrast_factor:t.bH(f.paint.get("raster-contrast")),u_spin_weights:en(f.paint.get("raster-hue-rotate")),u_perspective_transform:d,u_raster_elevation:p,u_zoom_transition:a,u_merc_center:h,u_cutoff_params:c,u_colorization_mix:Ki(t.bI,_,g),u_colorization_offset:Qi(t.bI,v,g),u_color_ramp:m,u_texture_offset:[w/(b+2*w),b/(b+2*w)],u_texture_res:[b+2*w,b+2*w],u_emissive_strength:y});function en(t){t*=Math.PI/180;const e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}const nn=.05,sn=(t,e,i,n,s,r,o,a,h,c,u,l)=>({u_matrix:t,u_normalize_matrix:e,u_globe_matrix:i,u_merc_matrix:n,u_grid_matrix:s,u_tl_parent:r,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:l,u_zoom_transition:o,u_merc_center:a,u_cutoff_params:h}),rn=(t,e,i,n,s,r,o,a,h,c)=>({u_particle_texture:t,u_particle_texture_side_len:e,u_tile_offset:i,u_velocity:n,u_color_ramp:r,u_velocity_res:s,u_max_speed:o,u_uv_offset:a,u_data_scale:[255*h[0],255*h[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[nn,nn]}),on=(t,e,i,n,s,r,o,a,h,c)=>({u_particle_texture:t,u_particle_texture_side_len:e,u_velocity:i,u_velocity_res:n,u_max_speed:s,u_speed_factor:r,u_reset_rate:o,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*h[0],255*h[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[nn,nn]}),an=t.ae.create(),hn=(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g)=>{const b=r.transform,w={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:b.getCameraToCenterDistance(_),u_rotate_symbol:+n,u_aspect_ratio:b.width/b.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:h,u_is_text:+c,u_pitch_with_map:+s,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:an,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:an,u_up_vector:[0,-1,0],u_color_adj_mat:v,u_icon_transition:g||0};return"globe"===_.name&&(w.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],w.u_zoom_transition=f,w.u_inv_rot_matrix=p,w.u_merc_center=d,w.u_camera_forward=b._camera.forward(),w.u_ecef_origin=t.bJ(b.globeMatrix,l.toUnwrapped()),w.u_tile_matrix=Float32Array.from(b.globeMatrix),w.u_up_vector=m),w},cn=(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v)=>t.Q(hn(e,i,n,s,r,o,a,h,c,u,f,d,p,m,_,v),{u_gamma_scale:s?r.transform.getCameraToCenterDistance(v)*Math.cos(r.terrain?0:r.transform._pitch):1,u_device_pixel_ratio:t.e.devicePixelRatio,u_is_halo:+l,undefined:void 0}),un=(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_)=>t.Q(cn(e,i,n,s,r,o,a,h,!0,c,!0,l,f,d,p,m,_),{u_texsize_icon:u,u_texture_icon:1}),ln=(t,e,i,n)=>({u_matrix:t,u_emissive_strength:e,u_opacity:i,u_color:n}),fn=(e,i,n,s,r,o,a,h)=>t.Q(function(e,i,n,s,r){const{width:o,height:a}=s.imageManager.getPixelSize(i),h=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,s.transform.tileZoom)/h,u=c*(r.tileID.canonical.x+r.tileID.wrap*h),l=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[o,a],u_pattern_size:n.displaySize,u_tile_units_to_pixels:1/t.bD(r,1,s.transform.tileZoom),u_pixel_coord_upper:[u>>16,l>>16],u_pixel_coord_lower:[65535&u,65535&l]}}(0,o,a,s,h),{u_matrix:e,u_emissive_strength:i,u_opacity:n}),dn=new Float32Array(t.ae.identity([])),pn=(e,i,n,s,r,o,a,h,c,u,l,f,d,p=[0,0,0],m)=>{const _=r.style.light,v=_.properties.get("position"),g=[-v.x,-v.y,v.z],b=t.bE.create();"viewport"===_.properties.get("anchor")&&(t.bE.fromRotation(b,-r.transform.angle),t.$.transformMat3(g,g,b));const w="MASK"===l.alphaMode,y=_.properties.get("color").toRenderColor(null),x=d.paint.get("model-ambient-occlusion-intensity"),M=d.paint.get("model-color").constantOr(t.C.white).toRenderColor(null),T=d.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:e,u_lighting_matrix:i,u_normal_matrix:n,u_node_matrix:s||dn,u_lightpos:g,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[y.r,y.g,y.b],u_camera_pos:p,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+w,u_alphaCutoff:l.alphaCutoff,u_baseColorFactor:[a.r,a.g,a.b,a.a],u_emissiveFactor:[h[0],h[1],h[2],1],u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:li.BaseColor,u_metallicRoughnessTexture:li.MetallicRoughness,u_normalTexture:li.Normal,u_occlusionTexture:li.Occlusion,u_emissionTexture:li.Emission,u_lutTexture:li.LUT,u_color_mix:[M.r,M.g,M.b,T],u_aoIntensity:x,u_emissive_strength:f,u_occlusionTextureTransform:m||[0,0,0,0]}},mn=(t,e=dn,i=dn)=>({u_matrix:t,u_instance:e,u_node_matrix:i}),_n={fillExtrusion:e=>({u_matrix:new t.a7(e),u_lightpos:new t.ar(e),u_lightintensity:new t.ab(e),u_lightcolor:new t.ar(e),u_vertical_gradient:new t.ab(e),u_opacity:new t.ab(e),u_edge_radius:new t.ab(e),u_alignment:new t.ab(e),u_width_scale:new t.ab(e),u_ao:new t.a9(e),u_tile_id:new t.ar(e),u_zoom_transition:new t.ab(e),u_inv_rot_matrix:new t.a7(e),u_merc_center:new t.a9(e),u_up_dir:new t.ar(e),u_height_lift:new t.ab(e),u_flood_light_color:new t.ar(e),u_vertical_scale:new t.ab(e),u_flood_light_intensity:new t.ab(e),u_ground_shadow_factor:new t.ar(e),u_emissive_strength:new t.ab(e)}),fillExtrusionDepth:e=>({u_matrix:new t.a7(e),u_edge_radius:new t.ab(e),u_alignment:new t.ab(e),u_width_scale:new t.ab(e),u_vertical_scale:new t.ab(e)}),fillExtrusionPattern:e=>({u_matrix:new t.a7(e),u_lightpos:new t.ar(e),u_lightintensity:new t.ab(e),u_lightcolor:new t.ar(e),u_vertical_gradient:new t.ab(e),u_height_factor:new t.ab(e),u_edge_radius:new t.ab(e),u_alignment:new t.ab(e),u_width_scale:new t.ab(e),u_ao:new t.a9(e),u_tile_id:new t.ar(e),u_zoom_transition:new t.ab(e),u_inv_rot_matrix:new t.a7(e),u_merc_center:new t.a9(e),u_up_dir:new t.ar(e),u_height_lift:new t.ab(e),u_image:new t.a8(e),u_texsize:new t.a9(e),u_pixel_coord_upper:new t.a9(e),u_pixel_coord_lower:new t.a9(e),u_tile_units_to_pixels:new t.ab(e),u_opacity:new t.ab(e)}),fillExtrusionGroundEffect:e=>({u_matrix:new t.a7(e),u_opacity:new t.ab(e),u_ao_pass:new t.ab(e),u_meter_to_tile:new t.ab(e),u_ao:new t.a9(e),u_flood_light_intensity:new t.ab(e),u_flood_light_color:new t.ar(e),u_attenuation:new t.ab(e),u_edge_radius:new t.ab(e),u_fb:new t.a8(e),u_fb_size:new t.ab(e)}),fill:e=>({u_matrix:new t.a7(e),u_emissive_strength:new t.ab(e)}),fillPattern:e=>({u_matrix:new t.a7(e),u_emissive_strength:new t.ab(e),u_image:new t.a8(e),u_texsize:new t.a9(e),u_pixel_coord_upper:new t.a9(e),u_pixel_coord_lower:new t.a9(e),u_tile_units_to_pixels:new t.ab(e)}),fillOutline:e=>({u_matrix:new t.a7(e),u_emissive_strength:new t.ab(e),u_world:new t.a9(e)}),fillOutlinePattern:e=>({u_matrix:new t.a7(e),u_emissive_strength:new t.ab(e),u_world:new t.a9(e),u_image:new t.a8(e),u_texsize:new t.a9(e),u_pixel_coord_upper:new t.a9(e),u_pixel_coord_lower:new t.a9(e),u_tile_units_to_pixels:new t.ab(e)}),circle:t.bK,collisionBox:e=>({u_matrix:new t.a7(e),u_camera_to_center_distance:new t.ab(e),u_extrude_scale:new t.a9(e)}),collisionCircle:e=>({u_matrix:new t.a7(e),u_inv_matrix:new t.a7(e),u_camera_to_center_distance:new t.ab(e),u_viewport_size:new t.a9(e)}),debug:e=>({u_color:new t.aa(e),u_matrix:new t.a7(e),u_overlay:new t.a8(e),u_overlay_scale:new t.ab(e)}),clippingMask:e=>({u_matrix:new t.a7(e)}),heatmap:e=>({u_extrude_scale:new t.ab(e),u_intensity:new t.ab(e),u_matrix:new t.a7(e),u_inv_rot_matrix:new t.a7(e),u_merc_center:new t.a9(e),u_tile_id:new t.ar(e),u_zoom_transition:new t.ab(e),u_up_dir:new t.ar(e)}),heatmapTexture:e=>({u_image:new t.a8(e),u_color_ramp:new t.a8(e),u_opacity:new t.ab(e)}),hillshade:e=>({u_matrix:new t.a7(e),u_image:new t.a8(e),u_latrange:new t.a9(e),u_light:new t.a9(e),u_shadow:new t.aa(e),u_highlight:new t.aa(e),u_emissive_strength:new t.ab(e),u_accent:new t.aa(e)}),hillshadePrepare:e=>({u_matrix:new t.a7(e),u_image:new t.a8(e),u_dimension:new t.a9(e),u_zoom:new t.ab(e)}),line:t.bL,linePattern:t.bM,raster:e=>({u_matrix:new t.a7(e),u_normalize_matrix:new t.a7(e),u_globe_matrix:new t.a7(e),u_merc_matrix:new t.a7(e),u_grid_matrix:new t.as(e),u_tl_parent:new t.a9(e),u_scale_parent:new t.ab(e),u_fade_t:new t.ab(e),u_opacity:new t.ab(e),u_image0:new t.a8(e),u_image1:new t.a8(e),u_brightness_low:new t.ab(e),u_brightness_high:new t.ab(e),u_saturation_factor:new t.ab(e),u_contrast_factor:new t.ab(e),u_spin_weights:new t.ar(e),u_perspective_transform:new t.a9(e),u_raster_elevation:new t.ab(e),u_zoom_transition:new t.ab(e),u_merc_center:new t.a9(e),u_cutoff_params:new t.at(e),u_colorization_mix:new t.at(e),u_colorization_offset:new t.ab(e),u_color_ramp:new t.a8(e),u_texture_offset:new t.a9(e),u_texture_res:new t.a9(e),u_emissive_strength:new t.ab(e)}),rasterParticle:e=>({u_matrix:new t.a7(e),u_normalize_matrix:new t.a7(e),u_globe_matrix:new t.a7(e),u_merc_matrix:new t.a7(e),u_grid_matrix:new t.as(e),u_tl_parent:new t.a9(e),u_scale_parent:new t.ab(e),u_fade_t:new t.ab(e),u_opacity:new t.ab(e),u_image0:new t.a8(e),u_image1:new t.a8(e),u_raster_elevation:new t.ab(e),u_zoom_transition:new t.ab(e),u_merc_center:new t.a9(e),u_cutoff_params:new t.at(e)}),rasterParticleTexture:e=>({u_texture:new t.a8(e),u_opacity:new t.ab(e)}),rasterParticleDraw:e=>({u_particle_texture:new t.a8(e),u_particle_texture_side_len:new t.ab(e),u_tile_offset:new t.a9(e),u_velocity:new t.a8(e),u_color_ramp:new t.a8(e),u_velocity_res:new t.a9(e),u_max_speed:new t.ab(e),u_uv_offset:new t.a9(e),u_data_scale:new t.a9(e),u_data_offset:new t.ab(e),u_particle_pos_scale:new t.ab(e),u_particle_pos_offset:new t.a9(e)}),rasterParticleUpdate:e=>({u_particle_texture:new t.a8(e),u_particle_texture_side_len:new t.ab(e),u_velocity:new t.a8(e),u_velocity_res:new t.a9(e),u_max_speed:new t.ab(e),u_speed_factor:new t.ab(e),u_reset_rate:new t.ab(e),u_rand_seed:new t.ab(e),u_uv_offset:new t.a9(e),u_data_scale:new t.a9(e),u_data_offset:new t.ab(e),u_particle_pos_scale:new t.ab(e),u_particle_pos_offset:new t.a9(e)}),symbolIcon:e=>({u_is_size_zoom_constant:new t.a8(e),u_is_size_feature_constant:new t.a8(e),u_size_t:new t.ab(e),u_size:new t.ab(e),u_camera_to_center_distance:new t.ab(e),u_rotate_symbol:new t.a8(e),u_aspect_ratio:new t.ab(e),u_fade_change:new t.ab(e),u_matrix:new t.a7(e),u_label_plane_matrix:new t.a7(e),u_coord_matrix:new t.a7(e),u_is_text:new t.a8(e),u_pitch_with_map:new t.a8(e),u_texsize:new t.a9(e),u_tile_id:new t.ar(e),u_zoom_transition:new t.ab(e),u_inv_rot_matrix:new t.a7(e),u_merc_center:new t.a9(e),u_camera_forward:new t.ar(e),u_tile_matrix:new t.a7(e),u_up_vector:new t.ar(e),u_ecef_origin:new t.ar(e),u_texture:new t.a8(e),u_icon_transition:new t.ab(e),u_color_adj_mat:new t.a7(e)}),symbolSDF:e=>({u_is_size_zoom_constant:new t.a8(e),u_is_size_feature_constant:new t.a8(e),u_size_t:new t.ab(e),u_size:new t.ab(e),u_camera_to_center_distance:new t.ab(e),u_rotate_symbol:new t.a8(e),u_aspect_ratio:new t.ab(e),u_fade_change:new t.ab(e),u_matrix:new t.a7(e),u_label_plane_matrix:new t.a7(e),u_coord_matrix:new t.a7(e),u_is_text:new t.a8(e),u_pitch_with_map:new t.a8(e),u_texsize:new t.a9(e),u_texture:new t.a8(e),u_gamma_scale:new t.ab(e),u_device_pixel_ratio:new t.ab(e),u_tile_id:new t.ar(e),u_zoom_transition:new t.ab(e),u_inv_rot_matrix:new t.a7(e),u_merc_center:new t.a9(e),u_camera_forward:new t.ar(e),u_tile_matrix:new t.a7(e),u_up_vector:new t.ar(e),u_ecef_origin:new t.ar(e),u_is_halo:new t.a8(e)}),symbolTextAndIcon:e=>({u_is_size_zoom_constant:new t.a8(e),u_is_size_feature_constant:new t.a8(e),u_size_t:new t.ab(e),u_size:new t.ab(e),u_camera_to_center_distance:new t.ab(e),u_rotate_symbol:new t.a8(e),u_aspect_ratio:new t.ab(e),u_fade_change:new t.ab(e),u_matrix:new t.a7(e),u_label_plane_matrix:new t.a7(e),u_coord_matrix:new t.a7(e),u_is_text:new t.a8(e),u_pitch_with_map:new t.a8(e),u_texsize:new t.a9(e),u_texsize_icon:new t.a9(e),u_texture:new t.a8(e),u_texture_icon:new t.a8(e),u_gamma_scale:new t.ab(e),u_device_pixel_ratio:new t.ab(e),u_is_halo:new t.a8(e)}),background:e=>({u_matrix:new t.a7(e),u_emissive_strength:new t.ab(e),u_opacity:new t.ab(e),u_color:new t.aa(e)}),backgroundPattern:e=>({u_matrix:new t.a7(e),u_emissive_strength:new t.ab(e),u_opacity:new t.ab(e),u_image:new t.a8(e),u_pattern_tl:new t.a9(e),u_pattern_br:new t.a9(e),u_texsize:new t.a9(e),u_pattern_size:new t.a9(e),u_pixel_coord_upper:new t.a9(e),u_pixel_coord_lower:new t.a9(e),u_tile_units_to_pixels:new t.ab(e)}),terrainRaster:e=>({u_matrix:new t.a7(e),u_image0:new t.a8(e),u_skirt_height:new t.ab(e),u_ground_shadow_factor:new t.ar(e)}),skybox:e=>({u_matrix:new t.a7(e),u_sun_direction:new t.ar(e),u_cubemap:new t.a8(e),u_opacity:new t.ab(e),u_temporal_offset:new t.ab(e)}),skyboxGradient:e=>({u_matrix:new t.a7(e),u_color_ramp:new t.a8(e),u_center_direction:new t.ar(e),u_radius:new t.ab(e),u_opacity:new t.ab(e),u_temporal_offset:new t.ab(e)}),skyboxCapture:e=>({u_matrix_3f:new t.as(e),u_sun_direction:new t.ar(e),u_sun_intensity:new t.ab(e),u_color_tint_r:new t.at(e),u_color_tint_m:new t.at(e),u_luminance:new t.ab(e)}),globeRaster:e=>({u_proj_matrix:new t.a7(e),u_globe_matrix:new t.a7(e),u_normalize_matrix:new t.a7(e),u_merc_matrix:new t.a7(e),u_zoom_transition:new t.ab(e),u_merc_center:new t.a9(e),u_image0:new t.a8(e),u_grid_matrix:new t.as(e),u_skirt_height:new t.ab(e),u_far_z_cutoff:new t.ab(e),u_frustum_tl:new t.ar(e),u_frustum_tr:new t.ar(e),u_frustum_br:new t.ar(e),u_frustum_bl:new t.ar(e),u_globe_pos:new t.ar(e),u_globe_radius:new t.ab(e),u_viewport:new t.a9(e)}),globeAtmosphere:e=>({u_frustum_tl:new t.ar(e),u_frustum_tr:new t.ar(e),u_frustum_br:new t.ar(e),u_frustum_bl:new t.ar(e),u_horizon:new t.ab(e),u_transition:new t.ab(e),u_fadeout_range:new t.ab(e),u_color:new t.at(e),u_high_color:new t.at(e),u_space_color:new t.at(e),u_temporal_offset:new t.ab(e),u_horizon_angle:new t.ab(e)}),model:e=>({u_matrix:new t.a7(e),u_lighting_matrix:new t.a7(e),u_normal_matrix:new t.a7(e),u_node_matrix:new t.a7(e),u_lightpos:new t.ar(e),u_lightintensity:new t.ab(e),u_lightcolor:new t.ar(e),u_camera_pos:new t.ar(e),u_opacity:new t.ab(e),u_baseColorFactor:new t.at(e),u_emissiveFactor:new t.at(e),u_metallicFactor:new t.ab(e),u_roughnessFactor:new t.ab(e),u_baseTextureIsAlpha:new t.a8(e),u_alphaMask:new t.a8(e),u_alphaCutoff:new t.ab(e),u_baseColorTexture:new t.a8(e),u_metallicRoughnessTexture:new t.a8(e),u_normalTexture:new t.a8(e),u_occlusionTexture:new t.a8(e),u_emissionTexture:new t.a8(e),u_lutTexture:new t.a8(e),u_color_mix:new t.at(e),u_aoIntensity:new t.ab(e),u_emissive_strength:new t.ab(e),u_occlusionTextureTransform:new t.at(e)}),modelDepth:e=>({u_matrix:new t.a7(e),u_instance:new t.a7(e),u_node_matrix:new t.a7(e)}),groundShadow:e=>({u_matrix:new t.a7(e),u_ground_shadow_factor:new t.ar(e)}),stars:e=>({u_matrix:new t.a7(e),u_up:new t.ar(e),u_right:new t.ar(e),u_intensity_multiplier:new t.ab(e)}),occlusion:e=>({u_matrix:new t.a7(e),u_anchorPos:new t.ar(e),u_screenSizePx:new t.a9(e),u_occluderSizePx:new t.a9(e),u_color:new t.at(e)})};function vn(e,i,n){const s=i.createTileMatrix(e,e.worldSize,n.toUnwrapped());return t.ae.multiply(new Float32Array(16),e.projMatrix,s)}function gn(t,e,i){if(e.projection.name===i.projection.name)return t.projMatrix;const n=i.clone();return n.setProjection(e.projection),vn(n,e.getProjection(),t)}function bn(t,e,i){return e.name===i.projection.name?t.projMatrix:vn(i,e,t)}let wn;function yn(e,i,n,s,r,o,a){const h=e.context,c=h.gl,u=e.transform,l=e.getOrCreateProgram("collisionBox"),f=[];let d=0,p=0;for(let h=0;h<s.length;h++){const m=s[h],_=i.getTile(m),v=_.getBucket(n);if(!v)continue;const g=gn(m,v,u);let b=g;0===r[0]&&0===r[1]||(b=e.translatePosMatrix(g,_,r,o));const w=a?v.textCollisionBox:v.iconCollisionBox,y=v.collisionCircleArray;if(y.length>0){const e=t.ae.create(),i=b;t.ae.mul(e,v.placementInvProjMatrix,u.glCoordMatrix),t.ae.mul(e,e,v.placementViewportMatrix),f.push({circleArray:y,circleOffset:p,transform:i,invTransform:e,projection:v.getProjection()}),d+=y.length/4,p=d}w&&(e.terrain&&e.terrain.setupElevationDraw(_,l),l.draw(e,c.LINES,t.af.disabled,t.ah.disabled,e.colorModeForRenderPass(),t.ag.disabled,Yi(b,u,_,v.getProjection()),n.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,null,u.zoom,null,[w.collisionVertexBuffer,w.collisionVertexBufferExt]))}if(!a||!f.length)return;const m=e.getOrCreateProgram("collisionCircle"),_=new t.bN;_.resize(4*d),_._trim();let v=0;for(const t of f)for(let e=0;e<t.circleArray.length/4;e++){const i=4*e,n=t.circleArray[i+0],s=t.circleArray[i+1],r=t.circleArray[i+2],o=t.circleArray[i+3];_.emplace(v++,n,s,r,o,0),_.emplace(v++,n,s,r,o,1),_.emplace(v++,n,s,r,o,2),_.emplace(v++,n,s,r,o,3)}(!wn||wn.length<2*d)&&(wn=function(e){const i=2*e,n=new t.bw;n.resize(i),n._trim();for(let t=0;t<i;t++){const e=6*t;n.uint16[e+0]=4*t+0,n.uint16[e+1]=4*t+1,n.uint16[e+2]=4*t+2,n.uint16[e+3]=4*t+2,n.uint16[e+4]=4*t+3,n.uint16[e+5]=4*t+0}return n}(d));const g=h.createIndexBuffer(wn,!0),b=h.createVertexBuffer(_,t.bO.members,!0);for(const i of f){const s={u_matrix:i.transform,u_inv_matrix:i.invTransform,u_camera_to_center_distance:(w=u).getCameraToCenterDistance(i.projection),u_viewport_size:[w.width,w.height]};m.draw(e,c.TRIANGLES,t.af.disabled,t.ah.disabled,e.colorModeForRenderPass(),t.ag.disabled,s,n.id,b,g,t.b.simpleSegment(0,2*i.circleOffset,i.circleArray.length,i.circleArray.length/2),null,u.zoom)}var w;b.destroy(),g.destroy()}const xn=t.ae.create();function Mn(e){const i=e._camera.getWorldToCamera(e.worldSize,1),n=t.ae.multiply([],i,e.globeMatrix);t.ae.invert(n,n);const s=[0,0,0],r=[0,1,0,0];return t.aB.transformMat4(r,r,n),s[0]=r[0],s[1]=r[1],s[2]=r[2],t.$.normalize(s,s),s}function Tn({width:e,height:i,anchor:n,textOffset:s,textScale:r},o){const{horizontalAlign:a,verticalAlign:h}=t.bS(n),c=-(a-.5)*e,u=-(h-.5)*i,l=t.bR(n,s);return new t.P((c/r+l[0])*o,(u/r+l[1])*o)}function On(e,i,n,s,r,o,a,h,c,u,l){const f=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,m={},_=e.getProjection(),v=bn(h,_,o),g=o.elevation,b=_.upVectorScale(h.canonical,o.center.lat,o.worldSize).metersToTile;d.clear();for(let p=0;p<f.length;p++){const w=f.get(p),{tileAnchorX:y,tileAnchorY:x,numGlyphs:M}=w,T=w.hidden||!w.crossTileID||e.allowVerticalPlacement&&!w.placedOrientation?null:s[w.crossTileID];if(T){let s=0,f=0,p=0;if(g){const t=g?g.getAtTileOffset(h,y,x):0,[e,i,n]=_.upVector(h.canonical,y,x);s=t*e*b,f=t*i*b,p=t*n*b}let[O,E,A,S]=Ze(w.projectedAnchorX+s,w.projectedAnchorY+f,w.projectedAnchorZ+p,n?v:a);const k=Je(o.getCameraToCenterDistance(_),S);let I=r.evaluateSizeForFeature(e.textSizeData,u,w)*k/t.bP;n&&(I*=e.tilePixelRatio/c);const C=Tn(T,I);n?(({x:O,y:E,z:A}=_.projectTilePoint(y+C.x,x+C.y,h.canonical)),[O,E,A]=Ze(O+s,E+f,A+p,a)):(i&&C._rotate(-o.angle),O+=C.x,E+=C.y,A=0);const j=e.allowVerticalPlacement&&w.placedOrientation===t.aF.vertical?Math.PI/2:0;for(let e=0;e<M;e++)t.aI(d,O,E,A,j);l&&w.associatedIconIndex>=0&&(m[w.associatedIconIndex]={x:O,y:E,z:A,angle:j})}else oi(M,d)}if(l){p.clear();const i=e.icon.placedSymbolArray;for(let e=0;e<i.length;e++){const n=i.get(e),{numGlyphs:s}=n,r=m[e];if(n.hidden||!r)oi(s,p);else{const{x:e,y:i,z:n,angle:o}=r;for(let r=0;r<s;r++)t.aI(p,e,i,n,o)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function En(e,i,n,s,r,o,a={}){const h=n.paint.get("icon-translate"),c=n.paint.get("text-translate"),u=n.paint.get("icon-translate-anchor"),l=n.paint.get("text-translate-anchor"),f=n.layout.get("icon-rotation-alignment"),d=n.layout.get("text-rotation-alignment"),p=n.layout.get("icon-pitch-alignment"),m=n.layout.get("text-pitch-alignment"),_=n.layout.get("icon-keep-upright"),v=n.layout.get("text-keep-upright"),g=n.paint.get("icon-color-saturation"),b=n.paint.get("icon-color-contrast"),w=n.paint.get("icon-color-brightness-min"),y=n.paint.get("icon-color-brightness-max");n.paint.get("icon-occlusion-opacity").constantOr(0),n.paint.get("text-occlusion-opacity").constantOr(0);const x=e.context,M=x.gl,T=e.transform,O="map"===f,E="map"===d,A="map"===p,S="map"===m,k=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let I=!1;const C=e.depthModeForSublayer(0,t.af.ReadOnly),j=[t.ak(T.center.lng),t.al(T.center.lat)],D=n.layout.get("text-variable-anchor"),R="globe"===T.projection.name,P=[],N=[0,-1,0];for(const r of s){const s=i.getTile(r),o=s.getBucket(n);if(!o)continue;if("mercator"===o.projection.name&&R)continue;if(o.fullyClipped)continue;const f="globe"===o.projection.name,d=f?t.a2(T.zoom):0,p=bn(r,o.getProjection(),T),m=T.calculatePixelsToTileUnitsMatrix(s),x=D&&o.hasTextData(),C=o.hasIconTextFit()&&x&&o.hasIconData(),F=o.getProjection().createInversionMatrix(T,r.canonical),z=t=>{T.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||e.terrain)&&(t.push("DEPTH_D24"),t.push("DEPTH_OCCLUSION"))},L=()=>{const i=O&&"point"!==n.layout.get("symbol-placement"),a=[];z(a);const c=i||C,l=n.paint.get("icon-image-cross-fade").constantOr(0);e.terrainRenderModeElevated()&&A&&a.push("PITCH_WITH_MAP_TERRAIN"),f&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),l>0&&a.push("ICON_TRANSITION"),o.icon.zOffsetVertexBuffer&&a.push("Z_OFFSET"),0===g&&0===b&&0===w&&1===y||a.push("COLOR_ADJUSTMENT");const v=o.icon.programConfigurations.get(n.id),x=e.getOrCreateProgram(o.sdfIcons?"symbolSDF":"symbolIcon",{config:v,defines:a});let E;const S=s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],k=o.iconSizeData,I=t.aE(k,T.zoom),D=A||0!==T.pitch,P=qe(p,s.tileID.canonical,A,O,T,o.getProjection(),m),L=Xe(p,s.tileID.canonical,A,O,T,o.getProjection(),m),$=e.translatePosMatrix(L,s,h,u,!0),U=e.translatePosMatrix(p,s,h,u),B=c?xn:P,G=O&&!A&&!i;let H=N;!R&&!T.mercatorFromTransition||O||(H=Mn(T));const V=f?H:N;if(o.sdfIcons&&!o.iconsInText)E=cn(k.kind,I,G,A,e,U,B,$,!1,S,!0,r,d,j,F,V,o.getProjection());else{const t=n.getColorAdjustmentMatrix(g,b,w,y);E=hn(k.kind,I,G,A,e,U,B,$,!1,S,r,d,j,F,V,o.getProjection(),t,l)}const W=s.imageAtlasTexture?s.imageAtlasTexture:null,q=1!==n.layout.get("icon-size").constantOr(0)||o.iconsNeedLinear,Y=o.sdfIcons||e.options.rotating||e.options.zooming||q||D?M.LINEAR:M.NEAREST,X=o.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),Z=e.terrain&&A&&i?t.ae.invert(t.ae.create(),P):xn;if(i&&o.icon){const t=T.elevation,i=t?t.getAtTileOffsetFunc(r,T.center.lat,T.worldSize,o.getProjection()):null,n=Ye(p,s.tileID.canonical,A,O,T,o.getProjection(),m);Qe(o,p,e,!1,n,L,A,_,i,r)}return{program:x,buffers:o.icon,uniformValues:E,atlasTexture:W,atlasTextureIcon:null,atlasInterpolation:Y,atlasInterpolationIcon:null,isSDF:o.sdfIcons,hasHalo:X,tile:s,labelPlaneMatrixInv:Z}},$=()=>{const i=E&&"point"!==n.layout.get("symbol-placement"),a=[],h=i||D||C;e.terrainRenderModeElevated()&&S&&a.push("PITCH_WITH_MAP_TERRAIN"),f&&(a.push("PROJECTION_GLOBE_VIEW"),h&&a.push("PROJECTED_POS_ON_VIEWPORT")),o.text.zOffsetVertexBuffer&&a.push("Z_OFFSET"),z(a);const u=o.text.programConfigurations.get(n.id),_=e.getOrCreateProgram(o.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:u,defines:a});let g,b=[0,0],w=null;const y=o.textSizeData;o.iconsInText&&(b=s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],w=s.imageAtlasTexture?s.imageAtlasTexture:null,g=S||0!==T.pitch||e.options.rotating||e.options.zooming||"composite"===y.kind||"camera"===y.kind?M.LINEAR:M.NEAREST);const x=s.glyphAtlasTexture?s.glyphAtlasTexture.size:[0,0],O=t.aE(y,T.zoom),A=qe(p,s.tileID.canonical,S,E,T,o.getProjection(),m),k=Xe(p,s.tileID.canonical,S,E,T,o.getProjection(),m),I=e.translatePosMatrix(k,s,c,l,!0),P=e.translatePosMatrix(p,s,c,l),L=h?xn:A,$=E&&!S&&!i;let U=N;!R&&!T.mercatorFromTransition||E||(U=Mn(T));const B=f?U:N;let G;G=o.iconsInText?un(y.kind,O,$,S,e,P,L,I,x,b,r,d,j,F,B,o.getProjection()):cn(y.kind,O,$,S,e,P,L,I,!0,x,!0,r,d,j,F,B,o.getProjection());const H=s.glyphAtlasTexture?s.glyphAtlasTexture:null,V=M.LINEAR,W=0!==n.paint.get("text-halo-width").constantOr(1),q=e.terrain&&S&&i?t.ae.invert(t.ae.create(),A):xn;if(i&&o.text){const t=T.elevation,i=t?t.getAtTileOffsetFunc(r,T.center.lat,T.worldSize,o.getProjection()):null,n=Ye(p,s.tileID.canonical,S,E,T,o.getProjection(),m);Qe(o,p,e,!0,n,k,S,v,i,r)}return{program:_,buffers:o.text,uniformValues:G,atlasTexture:H,atlasTextureIcon:w,atlasInterpolation:V,atlasInterpolationIcon:g,isSDF:!0,hasHalo:W,tile:s,labelPlaneMatrixInv:q}},U=o.icon.segments.get().length,B=o.text.segments.get().length,G=U&&!a.onlyText?L():null,H=B&&!a.onlyIcons?$():null,V=n.paint.get("icon-opacity").constantOr(1),W=n.paint.get("text-opacity").constantOr(1);if(k&&o.canOverlap){I=!0;const e=V&&!a.onlyText?o.icon.segments.get():[],i=W&&!a.onlyIcons?o.text.segments.get():[];for(const i of e)P.push({segments:new t.b([i]),sortKey:i.sortKey,state:G});for(const e of i)P.push({segments:new t.b([e]),sortKey:e.sortKey,state:H})}else a.onlyText||P.push({segments:V?o.icon.segments:new t.b([]),sortKey:0,state:G}),a.onlyIcons||P.push({segments:W?o.text.segments:new t.b([]),sortKey:0,state:H})}I&&P.sort(((t,e)=>t.sortKey-e.sortKey));for(const t of P){const i=t.state;if(i)if(e.terrain?e.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:T.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}):e.setupDepthForOcclusion(T.depthOcclusionForSymbolsAndCircles,i.program),x.activeTexture.set(M.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,M.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(x.activeTexture.set(M.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,M.CLAMP_TO_EDGE,!0)),e.uploadCommonLightUniforms(e.context,i.program),i.hasHalo){const s=i.uniformValues;s.u_is_halo=1,An(i.buffers,t.segments,n,e,i.program,C,r,o,s,2),s.u_is_halo=0}else{if(i.isSDF){const s=i.uniformValues;i.hasHalo&&(s.u_is_halo=1,An(i.buffers,t.segments,n,e,i.program,C,r,o,s,1)),s.u_is_halo=0}An(i.buffers,t.segments,n,e,i.program,C,r,o,i.uniformValues,1)}}}function An(e,i,n,s,r,o,a,h,c,u){const l=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];r.draw(s,s.context.gl.TRIANGLES,o,a,h,t.ag.disabled,c,n.id,e.layoutVertexBuffer,e.indexBuffer,i,n.paint,s.transform.zoom,e.programConfigurations.get(n.id),l,u)}function Sn(e,i,n,s,r,o,a){const h=e.context.gl,c=n.paint.get("fill-pattern"),u=c&&c.constantOr(1);let l,f,d,p,m;a?(f=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",l=h.LINES):(f=u?"fillPattern":"fill",l=h.TRIANGLES);for(const _ of s){const s=i.getTile(_);if(u&&!s.patternsLoaded())continue;const v=s.getBucket(n);if(!v)continue;e.prepareDrawTile();const g=v.programConfigurations.get(n.id),b=e.isTileAffectedByFog(_),w=e.getOrCreateProgram(f,{config:g,overrideFog:b});u&&(e.context.activeTexture.set(h.TEXTURE0),s.imageAtlasTexture&&s.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),g.updatePaintBuffers());const y=c.constantOr(null);if(y&&s.imageAtlas){const t=s.imageAtlas.patternPositions[y.toString()];t&&g.setConstantPatternPositions(t)}const x=e.translatePosMatrix(_.projMatrix,s,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),M=n.paint.get("fill-emissive-strength");if(a){p=v.indexBuffer2,m=v.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[h.drawingBufferWidth,h.drawingBufferHeight];d="fillOutlinePattern"===f&&u?qi(x,M,e,s,t):Wi(x,M,t)}else p=v.indexBuffer,m=v.segments,d=u?Vi(x,M,e,s):Hi(x,M);e.uploadCommonUniforms(e.context,w,_.toUnwrapped()),w.draw(e,l,r,e.stencilModeForClipping(_),o,t.ag.disabled,d,n.id,v.layoutVertexBuffer,p,m,n.paint,e.transform.zoom,g,void 0)}}function kn(e,i,n,s,r,o,a,h){n.resetLayerRenderingStats(e);const c=e.context,u=c.gl,l=e.transform,f=n.paint.get("fill-extrusion-pattern"),d=f.constantOr(1),p=n.paint.get("fill-extrusion-opacity"),m=e.style.enable3dLights(),_=n.paint.get(m&&!d?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),v=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),_],g=n.layout.get("fill-extrusion-edge-radius"),b=g>0&&!n.paint.get("fill-extrusion-rounded-roof"),w=b?0:g,y="globe"===l.projection.name?t.b_():0,x="globe"===l.projection.name,M=x?t.a2(l.zoom):0,T=[t.ak(l.center.lng),t.al(l.center.lat)],O=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(n.lut).toArray01().slice(0,3),E=n.paint.get("fill-extrusion-flood-light-intensity"),A=n.paint.get("fill-extrusion-vertical-scale"),S=0!==n.paint.get("fill-extrusion-line-width").constantOr(1),k=fi(e,n.paint.get("fill-extrusion-cutoff-fade-range")),I=n.paint.get("fill-extrusion-emissive-strength"),C=[];x&&C.push("PROJECTION_GLOBE_VIEW"),v[0]>0&&C.push("FAUX_AO"),b&&C.push("ZERO_ROOF_RADIUS"),h&&C.push("HAS_CENTROID"),E>0&&C.push("FLOOD_LIGHT"),k.shouldRenderCutoff&&C.push("RENDER_CUTOFF"),S&&C.push("RENDER_WALL_MODE");const j=(()=>{const e=n.paint.get("fill-extrusion-line-alignment");switch(e){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return t.w(`Unsupported value for fill-extrusion-line-alignment: ${e}`),0}})();let D;const R="shadow"===e.renderPass,P=e.shadowRenderer,N=R&&!!P;e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0);let F=[0,0,0];if(P){const t=e.style.directionalLight,i=e.style.ambientLight;t&&i&&(F=bi(e.style,t,i)),D=C.concat(["SHADOWS_SINGLE_CASCADE"])}const z=N?"fillExtrusionDepth":d?"fillExtrusionPattern":"fillExtrusion",L=n.getLayerRenderingStats();for(const m of s){const s=i.getTile(m),_=s.getBucket(n);if(!_||_.projection.name!==l.projection.name)continue;let g=!1;P&&(g=0===P.getMaxCascadeForTile(m.toUnwrapped()));const b=e.isTileAffectedByFog(m),N=_.programConfigurations.get(n.id),$=e.getOrCreateProgram(z,{config:N,defines:g?D:C,overrideFog:b});if(e.terrain&&e.terrain.setupElevationDraw(s,$,{useMeterToDem:!0}),!_.centroidVertexBuffer){const t=$.attributes.a_centroid_pos;void 0!==t&&u.vertexAttrib2f(t,0,0)}!R&&P&&P.setupShadows(s.tileID.toUnwrapped(),$,"vector-tile",s.tileID.overscaledZ),d&&(e.context.activeTexture.set(u.TEXTURE0),s.imageAtlasTexture&&s.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),N.updatePaintBuffers());const U=f.constantOr(null);if(U&&s.imageAtlas){const t=s.imageAtlas.patternPositions[U.toString()];t&&N.setConstantPatternPositions(t)}const B=n.paint.get("fill-extrusion-vertical-gradient"),G=1/_.tileToMeter;let H;if(R&&P){if(Pn(s.tileID,_,e))continue;const t=P.calculateShadowPassMatrixFromTile(s.tileID.toUnwrapped());H=Bi(t,w,j,G,A)}else{const t=e.translatePosMatrix(m.expandedProjMatrix,s,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=l.projection.createInversionMatrix(l,m.canonical);H=d?Gi(t,e,B,p,v,w,j,G,m,s,y,M,T,i,O,A):Ui(t,e,B,p,v,w,j,G,m,y,M,T,i,O,A,E,F,I)}e.uploadCommonUniforms(c,$,m.toUnwrapped(),null,k);let V=_.segments;if("mercator"===l.projection.name&&!R&&(V=_.getVisibleSegments(s.tileID,e.terrain,e.transform.getFrustum(0)),!V.get().length))continue;if(L)if(R)for(const t of V.get())L.numRenderedVerticesInShadowPass+=t.primitiveLength;else for(const t of V.get())L.numRenderedVerticesInTransparentPass+=t.primitiveLength;const W=[];(e.terrain||h)&&W.push(_.centroidVertexBuffer),x&&W.push(_.layoutVertexExtBuffer),S&&W.push(_.wallVertexBuffer),$.draw(e,c.gl.TRIANGLES,r,o,a,t.ag.backCCW,H,n.id,_.layoutVertexBuffer,_.indexBuffer,V,n.paint,e.transform.zoom,N,W)}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1)}function In(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b){const w=e.context,y=w.gl,x=e.transform,M=e.transform.zoom,T=[],O=fi(e,n.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===u?(T.push("CLEAR_SUBPASS"),b&&(T.push("CLEAR_FROM_TEXTURE"),w.activeTexture.set(y.TEXTURE0),b.bind(y.LINEAR,y.CLAMP_TO_EDGE))):"sdf"===u&&T.push("SDF_SUBPASS"),v&&T.push("HAS_CENTROID"),O.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const E=n.layout.get("fill-extrusion-edge-radius"),A=(t,i,s,u,g)=>{const y=i.programConfigurations.get(n.id),x=e.isTileAffectedByFog(t),A=e.getOrCreateProgram("fillExtrusionGroundEffect",{config:y,defines:T,overrideFog:x}),S=((t,e,i,n,s,r,o,a,h,c,u)=>({u_matrix:e,u_opacity:i,u_ao_pass:n?1:0,u_meter_to_tile:s,u_ao:r,u_flood_light_intensity:o,u_flood_light_color:a,u_attenuation:h,u_edge_radius:c,u_fb:0,u_fb_size:u}))(0,u,l,c,g,[f,d*g],p,m,_,M>=17?0:E*g,b?b.size[0]:0),k=[];v&&k.push(i.hiddenByLandmarkVertexBuffer),e.uploadCommonUniforms(w,A,t.toUnwrapped(),null,O),A.draw(e,w.gl.TRIANGLES,r,o,a,h,S,n.id,i.vertexBuffer,i.indexBuffer,s,n.paint,M,y,k)};for(const r of s){const s=i.getTile(r),o=s.getBucket(n);if(!o||o.projection.name!==x.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const a=o.groundEffect,h=1/o.tileToMeter;{const t=e.translatePosMatrix(r.projMatrix,s,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),i=a.getDefaultSegment();A(r,a,i,t,h)}if(g)for(let o=0;o<4;o++){const a=t.b$[o](r),c=i.getTile(a);if(!c)continue;const u=c.getBucket(n);if(!u||u.projection.name!==x.projection.name||!u.groundEffect||u.groundEffect&&!u.groundEffect.hasData())continue;const l=u.groundEffect;let f,d;0===o?(f=[-t.a4,0,0],d=1):1===o?(f=[t.a4,0,0],d=0):2===o?(f=[0,-t.a4,0],d=3):(f=[0,t.a4,0],d=2);const p=l.regionSegments[d];if(!p)continue;const m=new Float32Array(16);t.ae.translate(m,r.projMatrix,f),A(r,l,p,e.translatePosMatrix(m,s,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),h)}}}function Cn(e,i,n,s,r,o,a){0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const h=o?o.findDEMTileFor(n):null;if(!(h&&h.dem||a))return;const c=e=>new t.P(Math.ceil((e+t.c2)*t.c3),0),u=t=>{const e=i.getSource().minzoom,n=t=>{const e=i.getTileByID(t);if(e&&e.hasData())return e.getBucket(r)},s=[0,-1,1];for(const i of s){if(t.overscaledZ+i<e)continue;const s=n(t.calculateScaledKey(t.overscaledZ+i));if(s)return s}},l=[0,0,0],f=(e,i)=>(l[0]=Math.min(e.min.y,i.min.y),l[1]=Math.max(e.max.y,i.max.y),l[2]=t.a4-i.min.x>e.max.x?i.min.x-t.a4:e.max.x,l),d=(e,i)=>(l[0]=Math.min(e.min.x,i.min.x),l[1]=Math.max(e.max.x,i.max.x),l[2]=t.a4-i.min.y>e.max.y?i.min.y-t.a4:e.max.y,l),p=[(t,e)=>f(t,e),(t,e)=>f(e,t),(t,e)=>d(t,e),(t,e)=>d(e,t)],m=(e,i,s,r,a,c,u)=>{if(!o)return 0;const l=[[c?s:e,c?e:s,0],[c?s:i,c?i:s,0]],f=u<0?t.a4+u:u,d=[c?f:(e+i)/2,c?(e+i)/2:f,0];return 0===s&&u<0||0!==s&&u>0?o.getForTilePoints(a,[d],!0,r):l.push(d),o.getForTilePoints(n,l,!0,h),Math.max(l[0][2],l[1][2],d[2])/o.exaggeration()};for(let e=0;e<4;e++){const i=s.borderFeatureIndices[e];if(0===i.length)continue;const r=t.b$[e](n),h=u(r);if(!(h&&h instanceof t.c0))continue;if(s.borderDoneWithNeighborZ[e]===h.canonical.z)continue;0===h.centroidVertexArray.length&&h.createCentroidsBuffer();const l=o?o.findDEMTileFor(r):null;if(!(l&&l.dem||a))continue;const f=(e<2?1:5)-e,d=h.borderDoneWithNeighborZ[f]!==s.canonical.z,g=h.borderFeatureIndices[f];let b=0;if(s.canonical.z!==h.canonical.z){for(const t of i)s.showCentroid(s.featuresOnBorder[t]);if(d)for(const t of g)h.showCentroid(h.featuresOnBorder[t]);s.borderDoneWithNeighborZ[e]=h.canonical.z,h.borderDoneWithNeighborZ[f]=s.canonical.z}for(const n of i){const i=s.featuresOnBorder[n],o=s.centroidData[i.centroidDataIndex],u=i.borders[e];let d;for(;b<g.length;){d=h.featuresOnBorder[g[b]];const t=d.borders[f];if(t[1]>u[0]+3||t[0]>u[0]-3)break;h.showCentroid(d),b++}if(d&&b<g.length){const n=b;let w=0;for(;!(d.borders[f][0]>u[1]-3)&&(w++,++b!==g.length);)d=h.featuresOnBorder[g[b]];if(d=h.featuresOnBorder[g[n]],w>1){const t=d.borders[f];Math.abs(u[0]-t[0])<3&&Math.abs(u[1]-t[1])<3&&(w=1,b=n+1)}else if(0===w){s.showCentroid(i);continue}const y=h.centroidData[d.centroidDataIndex];a&&1===w&&(((_=o).flags|(v=y).flags)&t.c1?(_.flags|=t.c1,v.flags|=t.c1):(_.flags&=~t.c1,v.flags&=~t.c1));const x=i.intersectsCount()>1||d.intersectsCount()>1;if(w>1)b=n,o.centroidXY=y.centroidXY=new t.P(0,0);else if(l&&l.dem&&!x){const i=p[e](o,y),n=e%2?t.a4-1:0,s=m(i[0],Math.min(t.a4-1,i[1]),n,l,r,e<2,i[2]);o.centroidXY=y.centroidXY=c(s)}else x?o.centroidXY=y.centroidXY=new t.P(0,0):(o.centroidXY=s.encodeBorderCentroid(i),y.centroidXY=h.encodeBorderCentroid(d));s.writeCentroidToBuffer(o),h.writeCentroidToBuffer(y)}else s.showCentroid(i)}s.borderDoneWithNeighborZ[e]=h.canonical.z,h.borderDoneWithNeighborZ[f]=s.canonical.z}var _,v;(s.needsCentroidUpdate||!s.centroidVertexBuffer&&0!==s.centroidVertexArray.length)&&s.uploadCentroid(e)}const jn=[1,0,0],Dn=[0,1,0],Rn=[0,0,1];function Pn(e,i,n){const s=n.transform,r=n.shadowRenderer;if(!r)return!0;const o=e.toUnwrapped(),a=s.tileSize*r._cascades[n.currentShadowCascade].scale;let h=i.maxHeight;if(s.elevation){const t=s.elevation.getMinMaxForTile(e);t&&(h+=t.max)}const c=[...r.shadowDirection];c[2]=-c[2];const u=r.computeSimplifiedTileShadowVolume(o,h,a,c);if(!u)return!1;const l=[jn,Dn,Rn,c,[c[0],0,c[2]],[0,c[1],c[2]]],f="globe"===s.projection.name,d=s.scaleZoom(a),p=t.aM.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,d,!f),m=r.getCurrentCascadeFrustum();return 0===p.intersectsPrecise(u.vertices,u.planes,l)||0===m.intersectsPrecise(u.vertices,u.planes,l)}function Nn(e){return[e[0]*t.c4,e[1]*t.c4,e[2]*t.c4,0]}function Fn(e,i,n,s,r,o,a,h,c){const u=s.getSource(),l=n.globeSharedBuffers;if(!l)return;let f,d,p;if(i&&(f=s.getTile(i)),u instanceof t.bo?(d=u.texture,p=t.bj(0,0,n.transform)):f&&i&&(d=f.texture,p=t.bj(i.canonical.z,i.canonical.x,n.transform)),!d||!p)return;e||(p=t.ae.scale(t.ae.create(),p,[1,-1,1]));const m=n.context,_=m.gl,v="nearest"===r.paint.get("raster-resampling")?_.NEAREST:_.LINEAR,g=n.colorModeForDrapableLayerRenderPass(o),b=a.defines;b.push("GLOBE_POLES");const w=new t.af(_.LEQUAL,t.af.ReadWrite,n.depthRangeFor3D),y=Float32Array.from(n.transform.expandedFarZProjMatrix),x=Float32Array.from(t.bh(t.bi(new t.aO(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),m.activeTexture.set(_.TEXTURE0),d.bind(v,_.CLAMP_TO_EDGE),m.activeTexture.set(_.TEXTURE1),d.bind(v,_.CLAMP_TO_EDGE),d.useMipmap&&m.extTextureFilterAnisotropic&&n.transform.pitch>20&&_.texParameterf(_.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[M,T,O,E]=i?l.getPoleBuffers(i.canonical.z,!1):l.getPoleBuffers(0,!0),A=r.paint.get("raster-elevation");let S;e?(S=M,n.renderDefaultNorthPole=0!==A):(S=T,n.renderDefaultSouthPole=0!==A);const k=Nn(a.mix),I=((t,e,i,n,s,r,o,a,h,c,u,l,f)=>tn(t,e,i,new Float32Array(16),new Float32Array(9),[0,0],n,[0,0],[0,0,0,0],1,{opacity:1,mix:0},r,[0,0]||[0,0],a,2,c,u,l,1,0,f))(y,x,p,t.a2(n.transform.zoom),0,r,0,A,0,k,a.offset,a.range,o),C=n.getOrCreateProgram("raster",{defines:b});n.uploadCommonUniforms(m,C,null),C.draw(n,_.TRIANGLES,w,c,g,h,I,r.id,S,O,E)}function zn(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),n=i-e,s=.2*t.height,r=e+s;return[e,i,(r-s-e)/n,(r-e)/n]}function Ln(e,i,n,s){if(e)return i instanceof Si&&e instanceof t.c5?i.getTextureDescriptor(e,n,!0):{texture:e.texture,mix:Nn(s.mix),offset:s.offset,buffer:0,tileSize:1}}function $n(e,i,n){if(!e)return null;const s=i.getTextureDescriptor(e,n,!0);if(!s)return null;let{texture:r,mix:o,offset:a,tileSize:h,buffer:c,format:u}=s;if(!r||!u)return null;let l=!1;return"uint32"===u&&(l=!0,o[3]=0,o=Ki(t.c6,o,[0,n.paint.get("raster-particle-max-speed")]),a=Qi(t.c6,a,[0,n.paint.get("raster-particle-max-speed")])),{texture:r,textureOffset:[c/(h+2*c),h/(h+2*c)],tileSize:h,scalarData:l,scale:o,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function Un(t){const e=t._nearZ,i=t.projection.farthestPixelDistance(t),n=i-e,s=.2*t.height,r=e+s;return[e,i,(r-s-e)/n,(r-e)/n]}const Bn=new t.C(1,0,0,1),Gn=new t.C(0,1,0,1),Hn=new t.C(0,0,1,1),Vn=new t.C(1,0,1,1),Wn=new t.C(0,1,1,1);function qn(e,i,n,s,r,o,a){const h=e.context,c=e.transform,u=h.gl,l="globe"===c.projection.name,f=l?["PROJECTION_GLOBE_VIEW"]:[];let d=t.ae.clone(n.projMatrix);if(l&&t.a2(c.zoom)>0){const e=t.c7(n.canonical,c),i=t.c8(e);d=t.ae.multiply(new Float32Array(16),c.globeMatrix,i),t.ae.multiply(d,c.projMatrix,d)}const p=t.ae.create();p[12]+=2*r/(t.e.devicePixelRatio*c.width),p[13]+=2*o/(t.e.devicePixelRatio*c.height),t.ae.multiply(d,p,d);const m=e.getOrCreateProgram("debug",{defines:f}),_=i.getTileByID(n.key);e.terrain&&e.terrain.setupElevationDraw(_,m);const v=t.af.disabled,g=t.ah.disabled,b=e.colorModeForRenderPass(),w="$debug";h.activeTexture.set(u.TEXTURE0),e.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),l?_._makeGlobeTileDebugBuffers(e.context,c):_._makeDebugTileBoundsBuffers(e.context,c.projection);const y=_._tileDebugBuffer||e.debugBuffer,x=_._tileDebugIndexBuffer||e.debugIndexBuffer,M=_._tileDebugSegments||e.debugSegments;if(m.draw(e,u.LINE_STRIP,v,g,b,t.ag.disabled,Xi(d,s),w,y,x,M,null,null,null,[_._globeTileDebugBorderBuffer]),a){const t=_.latestRawTileData,i=Math.floor((t&&t.byteLength||0)/1024);let s=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(s+=` => ${n.overscaledZ}`),s+=` ${_.state}`,s+=` ${i}kb`,function(t,e){t.initDebugOverlayCanvas();const i=t.debugOverlayCanvas,n=t.context.gl,s=t.debugOverlayCanvas.getContext("2d");s.clearRect(0,0,i.width,i.height),s.shadowColor="white",s.shadowBlur=2,s.lineWidth=1.5,s.strokeStyle="white",s.textBaseline="top",s.font="bold 36px Open Sans, sans-serif",s.fillText(e,5,5),s.strokeText(e,5,5),t.debugOverlayTexture.update(i),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,s)}const T=i.getTile(n).tileSize,O=512/Math.min(T,512)*(n.overscaledZ/c.zoom)*.5,E=_._tileDebugTextBuffer||e.debugBuffer,A=_._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,S=_._tileDebugTextSegments||e.debugSegments;m.draw(e,u.TRIANGLES,v,g,t.a.alphaBlended,t.ag.disabled,Xi(d,t.C.transparent,O),w,E,A,S,null,null,null,[_._globeTileDebugTextBuffer])}function Yn(t,e,i,n){Zn(t,0,e+i/2,t.transform.width,i,n)}function Xn(t,e,i,n){Zn(t,e-i/2,0,i,t.transform.height,n)}function Zn(e,i,n,s,r,o){const a=e.context,h=a.gl;h.enable(h.SCISSOR_TEST),h.scissor(i*t.e.devicePixelRatio,n*t.e.devicePixelRatio,s*t.e.devicePixelRatio,r*t.e.devicePixelRatio),a.clear({color:o}),h.disable(h.SCISSOR_TEST)}const Jn=t.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Kn}=Jn;function Qn(t,e,i,n){t.emplaceBack(e,i,n)}class ts{constructor(e){this.vertexArray=new t.ca,this.indices=new t.bw,Qn(this.vertexArray,-1,-1,1),Qn(this.vertexArray,1,-1,1),Qn(this.vertexArray,-1,1,1),Qn(this.vertexArray,1,1,1),Qn(this.vertexArray,-1,-1,-1),Qn(this.vertexArray,1,-1,-1),Qn(this.vertexArray,-1,1,-1),Qn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Kn),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.b.simpleSegment(0,0,36,12)}}function es(e,i,n,s,r,o){const a=e.context.gl,h=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),u=i.paint.get("sky-atmosphere-sun-intensity"),l=((t,e,i,n,s)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:i,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[s.r,s.g,s.b,s.a],u_luminance:5e-5}))(t.bE.fromMat4(t.bE.create(),s),r,u,h,c);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o,i.skyboxTexture,0),n.draw(e,a.TRIANGLES,t.af.disabled,t.ah.disabled,t.a.unblended,t.ag.frontCW,l,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const is=t.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ns{constructor(e){const i=new t.cb;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const n=new t.bw;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(i,is.members),this.indexBuffer=e.createIndexBuffer(n),this.segments=t.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ss=t.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class rs{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class os{constructor(e){this.colorModeAlphaBlendedWriteRGB=new t.a([t.cc,t.cd,t.cc,t.cd],t.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new t.a([t.cc,t.ce,t.cc,t.ce],t.C.transparent,[!1,!1,!1,!0]),this.params=new rs,this.updateNeeded=!0,e.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),e.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),e.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(e){const i=e.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ns(i);const e=this.params.sizeRange,n=this.params.intensityRange,s=function(e){const i=t.ch(30),n=[];for(let s=0;s<e;++s){const e=2*Math.PI*i(),s=Math.acos(1-2*i())-.5*Math.PI;n.push(t.$.fromValues(Math.cos(s)*Math.cos(e),Math.cos(s)*Math.sin(e),Math.sin(s)))}return n}(this.params.starsCount),r=t.ch(300),o=new t.cf,a=new t.bw;let h=0;for(let i=0;i<s.length;++i){const c=t.$.scale([],s[i],200),u=Math.max(0,1+.01*e*(1*r()-.5)),l=Math.max(0,1+.01*n*(1*r()-.5));o.emplaceBack(c[0],c[1],c[2],-1,-1,u,l),o.emplaceBack(c[0],c[1],c[2],1,-1,u,l),o.emplaceBack(c[0],c[1],c[2],1,1,u,l),o.emplaceBack(c[0],c[1],c[2],-1,1,u,l),a.emplaceBack(h+0,h+1,h+2),a.emplaceBack(h+0,h+2,h+3),h+=4}this.starsVx=i.createVertexBuffer(o,ss.members),this.starsIdx=i.createIndexBuffer(a),this.starsSegments=t.b.simpleSegment(0,0,o.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,i){const n=e.context,s=n.gl,r=e.transform,o=new t.af(s.LEQUAL,t.af.ReadOnly,[0,1]),a=t.a2(r.zoom),h=e.style.getLut(i.scope),c=i.properties.get("color").toRenderColor(h).toArray01(),u=i.properties.get("high-color").toRenderColor(h).toArray01(),l=i.properties.get("space-color").toRenderColor(h).toArray01PremultipliedAlpha(),f=5e-4,d=t.cg(i.properties.get("horizon-blend"),0,1,f,.25),p=t.bc(e,n,r)&&d===f?r.worldSize/(2*Math.PI*1.025)-1:r.globeRadius,m=e.frameCounter/1e3%1,_=t.$.length(r.globeCenterInViewSpace),v=Math.sqrt(Math.pow(_,2)-Math.pow(p,2)),g=Math.acos(v/_),b=i=>{const h="globe"===r.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];i&&h.push("ALPHA_PASS");const f=e.getOrCreateProgram("globeAtmosphere",{defines:h}),p=((t,e,i,n,s,r,o,a,h,c,u,l)=>({u_frustum_tl:t,u_frustum_tr:e,u_frustum_br:i,u_frustum_bl:n,u_horizon:s,u_transition:r,u_fadeout_range:o,u_color:a,u_high_color:h,u_space_color:c,u_temporal_offset:u,u_horizon_angle:l}))(r.frustumCorners.TL,r.frustumCorners.TR,r.frustumCorners.BR,r.frustumCorners.BL,r.frustumCorners.horizon,a,d,c,u,l,m,g);e.uploadCommonUniforms(n,f);const _=this.atmosphereBuffer;_&&f.draw(e,s.TRIANGLES,o,t.ah.disabled,i?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,t.ag.backCW,p,i?"atmosphere_glow_alpha":"atmosphere_glow",_.vertexBuffer,_.indexBuffer,_.segments)};b(!1),b(!0)}drawStars(e,i){const n=t.au(i.properties.get("star-intensity"),0,1);if(0===n)return;const s=e.context,r=s.gl,o=e.transform,a=e.getOrCreateProgram("stars"),h=t.aw.identity([]);t.aw.rotateX(h,h,-o._pitch),t.aw.rotateZ(h,h,-o.angle),t.aw.rotateX(h,h,t.ac(o._center.lat)),t.aw.rotateY(h,h,-t.ac(o._center.lng));const c=t.ae.fromQuat(new Float32Array(16),h),u=t.ae.multiply([],o.starsProjMatrix,c),l=t.bE.fromMat4([],c),f=t.bE.invert([],l),d=[0,1,0];t.$.transformMat3(d,d,f),t.$.scale(d,d,this.params.sizeMultiplier);const p=[1,0,0];t.$.transformMat3(p,p,f),t.$.scale(p,p,this.params.sizeMultiplier);const m=(_=d,v=p,g=n,{u_matrix:Float32Array.from(u),u_up:_,u_right:v,u_intensity_multiplier:g});var _,v,g;e.uploadCommonUniforms(s,a),this.starsVx&&this.starsIdx&&a.draw(e,r.TRIANGLES,t.af.disabled,t.ah.disabled,this.colorModeAlphaBlendedWriteRGB,t.ag.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function as(e,i){const n=[...e],s=i.cameraWorldSizeForFog/i.worldSize,r=t.ae.identity([]);return t.ae.scale(r,r,[s,s,1]),t.ae.multiply(n,r,n),t.ae.multiply(n,i.worldToFogMatrix,n),n}function hs(e,i,n,s,r){const o=n.material,a=s.context,{baseColorTexture:h,metallicRoughnessTexture:c}=o.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:l,emissionTexture:f}=o;function d(t,i,n){if(t&&(e.push(i),a.activeTexture.set(a.gl.TEXTURE0+n),t.gfxTexture)){const{minFilter:e,magFilter:i,wrapS:n,wrapT:s}=t.sampler;t.gfxTexture.bindExtraParam(e,i,n,s)}}d(h,"HAS_TEXTURE_u_baseColorTexture",li.BaseColor),d(c,"HAS_TEXTURE_u_metallicRoughnessTexture",li.MetallicRoughness),d(u,"HAS_TEXTURE_u_normalTexture",li.Normal),d(l,"HAS_TEXTURE_u_occlusionTexture",li.Occlusion),d(f,"HAS_TEXTURE_u_emissionTexture",li.Emission),r&&(r.texture||(r.texture=new t.cj(s.context,r.image,[r.image.height,r.image.height,r.image.height],a.gl.RGBA)),a.activeTexture.set(a.gl.TEXTURE0+li.LUT),r.texture&&r.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),e.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(n.texcoordBuffer)),n.colorBuffer&&(e.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(n.colorBuffer)),n.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(n.normalBuffer)),n.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(n.pbrBuffer)),"OPAQUE"!==o.alphaMode&&"MASK"!==o.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),o.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function cs(e,i,n,s,r,o){const a=n.paint.get("model-opacity"),h=i.context,c=new t.af(i.context.gl.LEQUAL,t.af.ReadWrite,i.depthRangeFor3D),u=i.transform,l=e.mesh,f=l.material,d=f.pbrMetallicRoughness,p=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...e.nodeModelMatrix]:t.ae.multiply([],s.zScaleMatrix,e.nodeModelMatrix),t.ae.multiply(m,s.negCameraPosMatrix,m);const _=t.ae.invert([],m);t.ae.transpose(_,_);const v=n.paint.get("model-emissive-strength").constantOr(0),g=pn(new Float32Array(e.worldViewProjection),new Float32Array(m),new Float32Array(_),null,i,a,d.baseColorFactor.toRenderColor(null),f.emissiveFactor,d.metallicFactor,d.roughnessFactor,f,v,n),b={defines:[]},w=[];hs(b.defines,w,l,i,n.lut);const y=i.shadowRenderer;y&&(y.useNormalOffset=!1);let x=null;if(p){const t=as(e.nodeModelMatrix,i.transform);if(x=new Float32Array(t),"globe"!==u.projection.name){const e=l.aabb.min,i=l.aabb.max,[n,s]=p.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);b.overrideFog=n>=Qt||s>=Qt}}const M=fi(i,n.paint.get("model-cutoff-fade-range"));M.shouldRenderCutoff&&b.defines.push("RENDER_CUTOFF");const T=i.getOrCreateProgram("model",b);i.uploadCommonUniforms(h,T,null,x,M),"shadow"!==i.renderPass&&y&&y.setupShadowsFromMatrix(e.nodeModelMatrix,T),T.draw(i,h.gl.TRIANGLES,c,r,o,l.material.doubleSided?t.ag.disabled:t.ag.backCCW,g,n.id,l.vertexBuffer,l.indexBuffer,l.segments,n.paint,i.transform.zoom,void 0,w)}function us(e,i,n,s,r,o,a){let h;h="globe"===e.projection.name?t.ck(n,e):[...n],t.ae.multiply(h,h,i.matrix);const c=t.ae.multiply([],s,h);if(i.meshes)for(const e of i.meshes){if("BLEND"!==e.material.alphaMode){a.push({mesh:e,depth:0,modelIndex:r,worldViewProjection:c,nodeModelMatrix:h});continue}const i=t.$.transformMat4([],e.centroid,c);i[2]>0&&o.push({mesh:e,depth:i[2],modelIndex:r,worldViewProjection:c,nodeModelMatrix:h})}if(i.children)for(const t of i.children)us(e,t,n,s,r,o,a)}function ls(e,i,n,s){const r=n.shadowRenderer;if(!r)return;const o=r.getShadowPassDepthMode(),a=r.getShadowPassColorMode(),h=r.calculateShadowPassMatrixFromMatrix(i),c=mn(h);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,t.ah.disabled,a,t.ag.backCCW,c,s.id,e.vertexBuffer,e.indexBuffer,e.segments,s.paint,n.transform.zoom,void 0,void 0)}function fs(e,i,n){const s=i.updateZoomBasedPaintProperties(),r=function(e,i,n){let s,r,o,a=e.terrain?e.terrain.exaggeration():0;if(e.terrain&&a>0){const i=e.terrain,r=i.findDEMTileFor(n);r&&r.dem?s=t.cm.create(i,n,r):a=0}if(0===a&&(i.terrainElevationMin=0,i.terrainElevationMax=0),a===i.validForExaggeration&&(0===a||s&&s._demTile&&s._demTile.tileID===i.validForDEMTile.id&&s._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const t in i.instancesPerModel){const e=i.instancesPerModel[t];for(let t=0;t<e.instancedDataArray.length;++t){const n=(s?a*s.getElevationAt(0|e.instancedDataArray.float32[16*t],0|e.instancedDataArray.float32[16*t+1],!0,!0):0)+e.instancesEvaluatedElevation[t];e.instancedDataArray.float32[16*t+6]=n,r=r?Math.min(i.terrainElevationMin,n):n,o=o?Math.max(i.terrainElevationMax,n):n}}return i.terrainElevationMin=r||0,i.terrainElevationMax=o||0,i.validForExaggeration=a,i.validForDEMTile=s&&s._demTile?{id:s._demTile.tileID,timestamp:s._dem._timestamp}:{id:void 0,timestamp:0},!0}(e,i,n);(s||r)&&(i.uploaded=!1,i.upload(e.context))}const ds={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.b8([0,0,0],[t.a4,t.a4,0])};function ps(e,i){const n=1<<e.canonical.z,s=i.getFreeCameraOptions().position,r=i.elevation,o=e.canonical.x/n,a=(e.canonical.x+1)/n,h=e.canonical.y/n,c=(e.canonical.y+1)/n;let u=i._centerAltitude;if(r){const t=r.getMinMaxForTile(e);t&&t.max>u&&(u=t.max)}const l=t.au(s.x,o,a)-s.x,f=t.au(s.y,h,c)-s.y,d=t.ay(u,i.center.lat)-s.z;return i._zoomFromMercatorZ(Math.sqrt(l*l+f*f+d*d))}function ms(e,i,n,s,r,o,a){const h=e.context,c="shadow"===e.renderPass,u=e.shadowRenderer,l=c&&u?u.getShadowPassDepthMode():new t.af(h.gl.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D),f=e.isTileAffectedByFog(o);if(n.meshes)for(const d of n.meshes){const p=["MODEL_POSITION_ON_GPU"],m=[];let _,v,g;s.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const b=fi(e,i.paint.get("model-cutoff-fade-range"));if(b.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),c&&u)_=e.getOrCreateProgram("modelDepth",{defines:p}),v=mn(a.shadowTileMatrix,a.shadowTileMatrix,Float32Array.from(n.matrix)),g=u.getShadowPassColorMode();else{hs(p,m,d,e,i.lut),_=e.getOrCreateProgram("model",{defines:p,overrideFog:f});const s=d.material,c=s.pbrMetallicRoughness,l=i.paint.get("model-opacity"),w=i.paint.get("model-emissive-strength").constantOr(0);v=pn(o.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,e,l,c.baseColorFactor.toRenderColor(null),s.emissiveFactor,c.metallicFactor,c.roughnessFactor,s,w,i,r),u&&(a.shadowUniformsInitialized?_.setShadowUniformValues(h,u.getShadowUniformValues()):(u.setupShadows(o.toUnwrapped(),_,"model-tile",o.overscaledZ),a.shadowUniformsInitialized=!0)),g=b.shouldRenderCutoff||l<1||"OPAQUE"!==s.alphaMode?t.a.alphaBlended:t.a.unblended}e.uploadCommonUniforms(h,_,o.toUnwrapped(),null,b);const w=d.material.doubleSided?t.ag.disabled:t.ag.backCCW;if(s.instancedDataArray.length>20)m.push(s.instancedDataBuffer),_.draw(e,h.gl.TRIANGLES,l,t.ah.disabled,g,w,v,i.id,d.vertexBuffer,d.indexBuffer,d.segments,i.paint,e.transform.zoom,void 0,m,s.instancedDataArray.length);else{const n=c?"u_instance":"u_normal_matrix";for(let r=0;r<s.instancedDataArray.length;++r)v[n]=new Float32Array(s.instancedDataArray.arrayBuffer,64*r,16),_.draw(e,h.gl.TRIANGLES,l,t.ah.disabled,g,w,v,i.id,d.vertexBuffer,d.indexBuffer,d.segments,i.paint,e.transform.zoom,void 0,m)}}if(n.children)for(const t of n.children)ms(e,i,t,s,r,o,a)}const _s=[1,-1,1];function vs(e,i,n,s){if(!n.modelManager)return!0;const r=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,a=i.aabb;let h=!0,c=e.maxHeight;if(0===c){let t=0;for(const i in e.instancesPerModel){const e=r.getModel(i,s);e?t=Math.max(t,Math.max(Math.max(e.aabb.max[0],e.aabb.max[1]),e.aabb.max[2])):h=!1}c=e.maxScale*t*1.41+e.maxVerticalOffset,h&&(e.maxHeight=c)}a.max[2]=c,a.min[2]+=e.terrainElevationMin,a.max[2]+=e.terrainElevationMax,t.$.transformMat4(a.min,a.min,i.tileMatrix),t.$.transformMat4(a.max,a.max,i.tileMatrix);const u=a.intersects(o.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(e.isInsideFirstShadowMapFrustum=2===u),0===u}function gs(e,i){const n=e.uniformValues.u_cutoff_params[0],s=e.uniformValues.u_cutoff_params[1],r=e.uniformValues.u_cutoff_params[2],o=e.uniformValues.u_cutoff_params[3];return s===n||o===r?1:t.au(((i-n)/(s-n)-r)/(o-r),0,1)}function bs(e,i,n,s){if(i.pitch<20)return 1;const r=i.getWorldToCameraMatrix(),o=t.ae.multiply([],r,e),a=[...n.min,1];let h=t.aB.transformMat4([],a,o),c=h,u=h;a[1]=n.max[1],h=t.aB.transformMat4([],a,o),c=h[1]<c[1]?h:c,u=h[1]>u[1]?h:u,a[0]=n.max[0],h=t.aB.transformMat4([],a,o),c=h[1]<c[1]?h:c,u=h[1]>u[1]?h:u,a[1]=n.min[1],h=t.aB.transformMat4([],a,o),c=h[1]<c[1]?h:c,u=h[1]>u[1]?h:u;const l=t.au(s[0],0,1),f=100*i.pixelsPerMeter*t.au(s[1],0,1),d=t.au(s[2],0,1),p=t.$.lerp([],c,u,l),m=Math.tan(.5*i.fovX),_=-p[2]*m;if(0===f)return p[1]<-Math.abs(_)?d:1;const v=(-Math.abs(_)-p[1])/f,g=(t,e,i)=>(1-i)*t+i*e,b=t.au(g(1,d,v),d,1);return g(1,b,t.au((i.pitch-20)/20,0,1))}class ws{}class ys{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,i,n){{const t=this._storage.get(i.id);if(t)return t.lastUsedFrameIdx=e,t.buf}const s=n.gl,r=s.getBufferParameter(s.ELEMENT_ARRAY_BUFFER,s.BUFFER_SIZE),o=new ArrayBuffer(r),a=new Int16Array(o);s.getBufferSubData(s.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const h=new t.co;for(let t=0;t<r/2;t+=3){const e=a[t],i=a[t+1],n=a[t+2];h.emplaceBack(e,i),h.emplaceBack(i,n),h.emplaceBack(n,e)}const c=n.bindVertexArrayOES.current,u=new ws;return u.buf=new t.I(n,h),u.lastUsedFrameIdx=e,this._storage.set(i.id,u),n.bindVertexArrayOES.set(c),u.buf}update(t){for(const[e,i]of this._storage)t-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(e))}destroy(){for(const[t,e]of this._storage)e.buf.destroy(),this._storage.delete(t)}}class xs{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ms={symbol:function(e,i,n,s,r){if("translucent"!==e.renderPass)return;const o=t.ah.disabled,a=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,i,n,s,r,o,a){const h=i.transform,c="map"===r,u="map"===o;for(const i of e){const e=s.getTile(i),r=e.getBucket(n);if(!r||!r.text||!r.text.segments.get().length)continue;const o=t.aE(r.textSizeData,h.zoom),l=bn(i,r.getProjection(),h),f=h.calculatePixelsToTileUnitsMatrix(e),d=qe(l,e.tileID.canonical,u,c,h,r.getProjection(),f),p=r.hasIconTextFit()&&r.hasIconData();if(o){const n=Math.pow(2,h.zoom-e.tileID.overscaledZ);On(r,c,u,a,t.bQ,h,d,i,n,o,p)}}}(s,e,n,i,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),r);const h=0!==n.paint.get("icon-opacity").constantOr(1),c=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(h||c)?En(e,i,n,s,o,a):(h&&En(e,i,n,s,o,a,{onlyIcons:!0}),c&&En(e,i,n,s,o,a,{onlyText:!0})),i.map.showCollisionBoxes&&(yn(e,i,n,s,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),yn(e,i,n,s,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(e,i,n,s){if("translucent"!==e.renderPass)return;const r=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),h=void 0!==n.layout.get("circle-sort-key").constantOr(1),c=n.paint.get("circle-emissive-strength");if(0===r.constantOr(1)&&(0===o.constantOr(1)||0===a.constantOr(1)))return;const u=e.context,l=u.gl,f=e.transform,d=e.depthModeForSublayer(0,t.af.ReadOnly),p=t.ah.disabled,m=e.colorModeForDrapableLayerRenderPass(c),_="globe"===f.projection.name,v=[t.ak(f.center.lng),t.al(f.center.lat)],g=[];for(let r=0;r<s.length;r++){const o=s[r],a=i.getTile(o),c=a.getBucket(n);if(!c||c.projection.name!==f.projection.name)continue;const u=c.programConfigurations.get(n.id),l=t.bT(n),d=e.isTileAffectedByFog(o);_&&l.push("PROJECTION_GLOBE_VIEW"),l.push("DEPTH_D24"),e.terrain&&f.depthOcclusionForSymbolsAndCircles&&l.push("DEPTH_OCCLUSION");const p=e.getOrCreateProgram("circle",{config:u,defines:l,overrideFog:d}),m=c.layoutVertexBuffer,b=c.globeExtVertexBuffer,w=c.indexBuffer,y=f.projection.createInversionMatrix(f,o.canonical),x={programConfiguration:u,program:p,layoutVertexBuffer:m,globeExtVertexBuffer:b,indexBuffer:w,uniformValues:t.bU(e,o,a,y,v,n),tile:a};if(h){const e=c.segments.get();for(const i of e)g.push({segments:new t.b([i]),sortKey:i.sortKey,state:x})}else g.push({segments:c.segments,sortKey:0,state:x})}h&&g.sort(((t,e)=>t.sortKey-e.sortKey));const b={useDepthForOcclusion:f.depthOcclusionForSymbolsAndCircles};for(const i of g){const{programConfiguration:s,program:r,layoutVertexBuffer:o,globeExtVertexBuffer:a,indexBuffer:h,uniformValues:c,tile:_}=i.state,v=i.segments;e.terrain&&e.terrain.setupElevationDraw(_,r,b),e.uploadCommonUniforms(u,r,_.tileID.toUnwrapped()),r.draw(e,l.TRIANGLES,d,p,m,t.ag.disabled,c,n.id,o,h,v,n.paint,f.zoom,s,[a])}},heatmap:function(e,i,n,s){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const r=e.context,o=r.gl,a=t.ah.disabled,h=new t.a([o.ONE,o.ONE,o.ONE,o.ONE],t.C.transparent,[!0,!0,!0,!0]);!function(t,e,i,n){const s=t.gl,r=e.width*n,o=e.height*n;t.activeTexture.set(s.TEXTURE1),t.viewport.set([0,0,r,o]);let a=i.heatmapFbo;if(!a||a&&(a.width!==r||a.height!==o)){a&&a.destroy();const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),a=i.heatmapFbo=t.createFramebuffer(r,o,!0,null),function(t,e,i,n,s,r){const o=t.gl;o.texImage2D(o.TEXTURE_2D,0,t.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,s,r,0,o.RGBA,t.extRenderToTextureHalfFloat?o.HALF_FLOAT:o.UNSIGNED_BYTE,null),n.colorAttachment.set(i)}(t,0,e,a,r,o)}else s.bindTexture(s.TEXTURE_2D,a.colorAttachment.get()),t.bindFramebuffer.set(a.framebuffer)}(r,e,n,"globe"===e.transform.projection.name?.5:.25),r.clear({color:t.C.transparent});const c=e.transform,u="globe"===c.projection.name,l=u?["PROJECTION_GLOBE_VIEW"]:[],f=u?t.ag.frontCCW:t.ag.disabled,d=[t.ak(c.center.lng),t.al(c.center.lat)];for(let p=0;p<s.length;p++){const m=s[p];if(i.hasRenderableParent(m))continue;const _=i.getTile(m),v=_.getBucket(n);if(!v||v.projection.name!==c.projection.name)continue;const g=e.isTileAffectedByFog(m),b=v.programConfigurations.get(n.id),w=e.getOrCreateProgram("heatmap",{config:b,defines:l,overrideFog:g}),{zoom:y}=e.transform;e.terrain&&e.terrain.setupElevationDraw(_,w),e.uploadCommonUniforms(r,w,m.toUnwrapped());const x=c.projection.createInversionMatrix(c,m.canonical);w.draw(e,o.TRIANGLES,t.af.disabled,a,h,f,Ji(e,m,_,x,d,y,n.paint.get("heatmap-intensity")),n.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,n.paint,e.transform.zoom,b,u?[v.globeExtVertexBuffer]:null)}r.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,i){const n=e.context,s=n.gl,r=i.heatmapFbo;if(!r)return;n.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,r.colorAttachment.get()),n.activeTexture.set(s.TEXTURE1);let o=i.colorRampTexture;o||(o=i.colorRampTexture=new t.T(n,i.colorRamp,s.RGBA)),o.bind(s.LINEAR,s.CLAMP_TO_EDGE),e.getOrCreateProgram("heatmapTexture").draw(e,s.TRIANGLES,t.af.disabled,t.ah.disabled,e.colorModeForRenderPass(),t.ag.disabled,((t,e,i,n)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,i),i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,i.paint,e.transform.zoom)}(e,n))},line:function(e,i,n,s){if("translucent"!==e.renderPass)return;const r=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===r.constantOr(1)||0===o.constantOr(1))return;const a=n.paint.get("line-emissive-strength"),h=n.paint.get("line-occlusion-opacity"),c=e.context,u=c.gl,l=n.layout.get("line-z-offset"),f=!l.isConstant()||!!l.constantOr(0),d=f?new t.af(e.depthOcclusion?u.GREATER:u.LEQUAL,t.af.ReadOnly,e.depthRangeFor3D):e.depthModeForSublayer(0,t.af.ReadOnly),p=e.colorModeForDrapableLayerRenderPass(a),m=e.terrain&&e.terrain.renderingToTexture,_=m?1:t.e.devicePixelRatio,v=n.paint.get("line-dasharray"),g=v.constantOr(1),b=n.layout.get("line-cap"),w=v.constantOr(null),y=b.constantOr(null),x=n.paint.get("line-pattern"),M=x.constantOr(1),T=x.constantOr(null),O=n.paint.get("line-opacity").constantOr(1);let E=!M&&1!==O||e.depthOcclusion&&h>0&&h<1;const A=n.paint.get("line-gradient"),S=M?"linePattern":"line",k=t.bV(n);let I;if(m&&e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(E=!1),0!==h&&e.depthOcclusion){const e=n.paint._values["line-opacity"];e&&e.value&&"constant"===e.value.kind?I=e.value:t.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}if(f&&(e.forceTerrainMode=!0),!f&&0!==h&&e.terrain&&!m)return void t.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const C=E&&f?e.stencilModeFor3D():t.ah.disabled;for(const r of s){const s=i.getTile(r);if(M&&!s.patternsLoaded())continue;const o=s.getBucket(n);if(!o)continue;e.prepareDrawTile();const a=o.programConfigurations.get(n.id),l=e.isTileAffectedByFog(r),v=e.getOrCreateProgram(S,{config:a,defines:f?[...k,"ELEVATED"]:k,overrideFog:l});if(T&&s.imageAtlas){const t=s.imageAtlas.patternPositions[T.toString()];t&&a.setConstantPatternPositions(t)}if(!M&&w&&y&&s.lineAtlas){const t=s.lineAtlas.getDash(w,y);t&&a.setConstantPatternPositions(t)}let[b,x]=n.paint.get("line-trim-offset");if("round"===y||"square"===y){const t=1;b!==x&&(0===b&&(b-=t),1===x&&(x+=t))}const j=m?r.projMatrix:null,D=M?t.bW(e,s,n,j,_,[b,x]):t.bX(e,s,n,j,o.lineClipsArray.length,_,[b,x]);if(A){const s=o.gradients[n.id];let a=s.texture;if(n.gradientVersion!==s.version){let h=256;if(n.stepInterpolant){const n=i.getSource().maxzoom,s=r.canonical.z===n?Math.ceil(1<<e.transform.maxZoom-r.canonical.z):1;h=t.au(t.bY(o.maxLineLength/t.a4*1024*s),256,c.maxTextureSize)}s.gradient=t.bZ({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:h,image:s.gradient||void 0,clips:o.lineClipsArray}),s.texture?s.texture.update(s.gradient):s.texture=new t.T(c,s.gradient,u.RGBA),s.version=n.gradientVersion,a=s.texture}c.activeTexture.set(u.TEXTURE1),a.bind(n.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}g&&(c.activeTexture.set(u.TEXTURE0),s.lineAtlasTexture&&s.lineAtlasTexture.bind(u.LINEAR,u.REPEAT),a.updatePaintBuffers()),M&&(c.activeTexture.set(u.TEXTURE0),s.imageAtlasTexture&&s.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),a.updatePaintBuffers()),f&&e.terrain.setupElevationDraw(s,v),e.uploadCommonUniforms(c,v,r.toUnwrapped());const R=i=>{null!=I&&(I.value=O*h),v.draw(e,u.TRIANGLES,d,i,p,t.ag.disabled,D,n.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,n.paint,e.transform.zoom,a,[o.layoutVertexBuffer2,o.patternVertexBuffer,o.zOffsetVertexBuffer]),null!=I&&(I.value=O)};if(E&&!f){const i=e.stencilModeForClipping(r).ref;0===i&&m&&c.clear({stencil:0});const n={func:u.EQUAL,mask:255};D.u_alpha_discard_threshold=.8,R(new t.ah(n,i,255,u.KEEP,u.KEEP,u.INVERT)),D.u_alpha_discard_threshold=0,R(new t.ah(n,i,255,u.KEEP,u.KEEP,u.KEEP))}else E&&f&&(D.u_alpha_discard_threshold=.001),R(f?C:e.stencilModeForClipping(r))}E&&(e.resetStencilClippingMasks(),m&&c.clear({stencil:0})),0===h||e.depthOcclusion||m||e.layersWithOcclusionOpacity.push(e.currentLayer),f&&(e.forceTerrainMode=!1)},fill:function(e,i,n,s){const r=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const a=n.paint.get("fill-emissive-strength"),h=e.colorModeForDrapableLayerRenderPass(a),c=n.paint.get("fill-pattern"),u=e.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===r.constantOr(t.C.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===u){const r=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.af.ReadWrite:t.af.ReadOnly);Sn(e,i,n,s,r,h,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){const r=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,t.af.ReadOnly);Sn(e,i,n,s,r,h,!0)}},"fill-extrusion":function(e,i,n,s){const r=n.paint.get("fill-extrusion-opacity"),o=e.context,a=o.gl,h=e.terrain,c=h&&h.renderingToTexture;if(0===r)return;const u=e.conflationActive&&e.style.isLayerClipped(n,i.getSource()),l=e.style.order.indexOf(n.fqid);if(u&&function(t,e,i,n,s){for(const r of n){const n=e.getTile(r).getBucket(i);n&&(n.updateReplacement(r,t.replacementSource,s),n.uploadCentroid(t.context))}}(e,i,n,s,l),h||u)for(const t of s){const s=i.getTile(t).getBucket(n);s&&Cn(e.context,i,t,s,n,h,u)}if("shadow"===e.renderPass&&e.shadowRenderer){const o=e.shadowRenderer;if(h&&r<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.Z)return;const a=o.getShadowPassDepthMode(),c=o.getShadowPassColorMode();kn(e,i,n,s,a,t.ah.disabled,c,u)}else if("translucent"===e.renderPass){const l=!n.paint.get("fill-extrusion-pattern").constantOr(1),f=n.paint.get("fill-extrusion-color").constantOr(t.C.white);if(!c&&0!==f.a){const o=new t.af(e.context.gl.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D);1===r&&l?kn(e,i,n,s,o,t.ah.disabled,t.a.unblended,u):(kn(e,i,n,s,o,t.ah.disabled,t.a.disabled,u),kn(e,i,n,s,o,e.stencilModeFor3D(),e.colorModeForRenderPass(),u),e.resetStencilClippingMasks())}if(e.style.enable3dLights()&&l&&(!h&&"globe"!==e.transform.projection.name||c)){const r=n.paint.get("fill-extrusion-opacity"),l=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),f=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),d=n.paint.get("fill-extrusion-flood-light-intensity"),p=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(n.lut).toArray01().slice(0,3),m=l>0&&f>0,_=d>0,v=(t,e,i)=>(1-i)*t+i*e,g=o=>{const h=e.depthModeForSublayer(1,t.af.ReadOnly,a.LEQUAL,!0),c=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=v(.1,3,c),_=e._showOverdrawInspector;if(!_){const c=new t.ah({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),_=new t.a([a.ONE,a.ONE,a.ONE,a.ONE],t.C.transparent,[!1,!1,!1,!0],a.MIN);In(e,i,n,s,h,c,_,t.ag.disabled,o,"sdf",r,l,f,d,p,m,u,!1)}{const c=_?t.ah.disabled:new t.ah({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),v=_?e.colorModeForRenderPass():new t.a([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],t.C.transparent,[!0,!0,!0,!0]);In(e,i,n,s,h,c,v,t.ag.disabled,o,"color",r,l,f,d,p,m,u,!1)}};if(c){const c=(o,h,c)=>{const m=e.depthModeForSublayer(1,t.af.ReadOnly,a.LEQUAL,!1),_=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),g=v(.1,3,_);{const c=new t.a([a.ONE,a.ONE,a.ONE,a.ONE],t.C.transparent,[!1,!1,!1,!0]);In(e,i,n,s,m,t.ah.disabled,c,t.ag.disabled,o,"clear",r,l,f,d,p,g,u,h)}{const c=new t.ah({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),_=new t.a([a.ONE,a.ONE,a.ONE,a.ONE],t.C.transparent,[!1,!1,!1,!0],a.MIN);In(e,i,n,s,m,c,_,t.ag.disabled,o,"sdf",r,l,f,d,p,g,u,h)}{const c=o?a.ZERO:a.ONE_MINUS_DST_ALPHA,_=new t.ah({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),v=new t.a([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],t.C.transparent,[!0,!0,!0,!0]);In(e,i,n,s,m,_,v,t.ag.disabled,o,"color",r,l,f,d,p,g,u,h)}{const _=new t.a([a.ONE,a.ONE,a.ONE,o?a.ZERO:a.ONE],t.C.transparent,[!1,!1,!1,!0],o?a.FUNC_ADD:a.MAX);In(e,i,n,s,m,t.ah.disabled,_,t.ag.disabled,o,"clear",r,l,f,d,p,g,u,h,c)}};if(m||_){let i;if(e.prepareDrawTile(),h){const e=h.drapeBufferSize[0],n=h.drapeBufferSize[1];i=h.framebufferCopyTexture,i&&(!i||i.size[0]===e&&i.size[1]===n)||(i&&i.destroy(),i=h.framebufferCopyTexture=new t.T(o,new t.j({width:e,height:n}),a.RGBA)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,e,n,0)}m&&c(!0,!1,i),_&&c(!1,!0,i)}}else m&&g(!0),_&&g(!1),(m||_)&&e.resetStencilClippingMasks()}}},hillshade:function(e,i,n,s){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const r=e.context,o=e.terrain&&e.terrain.renderingToTexture,[a,h]="translucent"!==e.renderPass||o?[{},s]:e.stencilConfigForOverlap(s);for(const s of h){const r=i.getTile(s);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)je(e,r,n);else if("translucent"===e.renderPass){const i=e.depthModeForSublayer(0,t.af.ReadOnly),h=n.paint.get("hillshade-emissive-strength"),c=e.colorModeForDrapableLayerRenderPass(h),u=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(s):a[s.overscaledZ];Ie(e,s,r,n,i,u,c)}}r.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,i,n,s,r,o){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const a="globe"===e.transform.projection.name,h=0!==n.paint.get("raster-elevation"),c=h&&a;if(e.renderElevatedRasterBackface&&!c)return;const u=e.context,l=u.gl,f=i.getSource(),d=function(e,i,n,s){const r=i.paint.get("raster-color"),o="raster-array"===e.type,a=[],h=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let u=i.paint.get("raster-color-range");const l=[c[0],c[1],c[2],0],f=c[3];let d="nearest"===h?s.NEAREST:s.LINEAR;if(o&&(a.push("RASTER_ARRAY"),r||a.push("RASTER_COLOR"),"linear"===h&&a.push("RASTER_ARRAY_LINEAR"),d=s.NEAREST,!u&&e.rasterLayers)){const t=e.rasterLayers.find((({id:t})=>t===i.sourceLayer));t&&t.fields&&t.fields.range&&(u=t.fields.range)}if(u=u||[0,1],r){a.push("RASTER_COLOR"),n.activeTexture.set(s.TEXTURE2),i.updateColorRamp(u);let e=i.colorRampTexture;e||(e=i.colorRampTexture=new t.T(n,i.colorRamp,s.RGBA)),e.bind(s.LINEAR,s.CLAMP_TO_EDGE)}return{mix:l,range:u,offset:f,defines:a,resampling:d}}(f,n,u,l);if(f instanceof t.bo&&!s.length&&!a)return;const p=n.paint.get("raster-emissive-strength"),m=e.colorModeForDrapableLayerRenderPass(p),_=e.terrain&&e.terrain.renderingToTexture,v=!e.options.moving,g="nearest"===n.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;if(f instanceof t.bo&&!s.length&&(f.onNorthPole||f.onSouthPole)){const s=h?e.stencilModeFor3D():t.ah.disabled;return void Fn(!!f.onNorthPole,null,e,i,n,p,d,t.ag.disabled,s)}if(!s.length)return;const[b,w]=f instanceof t.bo||_?[{},s]:e.stencilConfigForOverlap(s),y=w[w.length-1].overscaledZ;c&&d.defines.push("PROJECTION_GLOBE_VIEW"),h&&d.defines.push("RENDER_CUTOFF");const x=(s,r,w)=>{for(const x of s){const s=x.toUnwrapped(),M=i.getTile(x);if(_&&(!M||!M.hasData()))continue;u.activeTexture.set(l.TEXTURE0);const T=Ln(M,f,n,d);if(!T||!T.texture)continue;const{texture:O,mix:E,offset:A,tileSize:S,buffer:k}=T;let I,C;_?(I=t.af.disabled,C=x.projMatrix):h?(I=new t.af(l.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D),C=a?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(s,v)):(I=e.depthModeForSublayer(x.overscaledZ-y,1===n.paint.get("raster-opacity")?t.af.ReadWrite:t.af.ReadOnly,l.LESS),C=e.transform.calculateProjMatrix(s,v));const j=e.terrain&&_?e.terrain.stencilModeForRTTOverlap(x):b[x.overscaledZ],D=o?0:n.paint.get("raster-fade-duration");M.registerFadeDuration(D);const R=i.findLoadedParent(x,0),P=Ai(M,R,i,e.transform,D);let N,F;e.terrain&&e.terrain.prepareDrawTile(),u.activeTexture.set(l.TEXTURE0),O.bind(g,l.CLAMP_TO_EDGE),u.activeTexture.set(l.TEXTURE1),R?(R.texture&&R.texture.bind(g,l.CLAMP_TO_EDGE),N=Math.pow(2,R.tileID.overscaledZ-M.tileID.overscaledZ),F=[M.tileID.canonical.x*N%1,M.tileID.canonical.y*N%1]):O.bind(g,l.CLAMP_TO_EDGE),O.useMipmap&&u.extTextureFilterAnisotropic&&e.transform.pitch>20&&l.texParameterf(l.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const z=e.transform;let L;const $=h?zn(z):[0,0,0,0];let U,B,G,H,V,W=0;if(c&&f instanceof t.bo&&f.coordinates.length>3)U=Float32Array.from(t.bh(t.bi(new t.aO(0,0,0)))),B=Float32Array.from(z.globeMatrix),G=Float32Array.from(t.bd(z)),H=[t.ak(z.center.lng),t.al(z.center.lat)],L=f.elevatedGlobePerspectiveTransform,V=f.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const e=t.be(x.canonical);W=t.bf(e.getCenter().lat),U=Float32Array.from(t.bh(t.bi(x.canonical))),B=Float32Array.from(z.globeMatrix),G=Float32Array.from(t.bd(z)),H=[t.ak(z.center.lng),t.al(z.center.lat)],L=[0,0],V=Float32Array.from(t.bg(x.canonical,e,W,z.worldSize/z._pixelsPerMercatorPixel))}else L=f instanceof t.bo?f.perspectiveTransform:[0,0],U=new Float32Array(16),B=new Float32Array(9),G=new Float32Array(16),H=[0,0],V=new Float32Array(9);const q=tn(C,U,B,G,V,F||[0,0],t.a2(e.transform.zoom),H,$,N||1,P,n,L,h?n.paint.get("raster-elevation"):0,2,E,A,d.range,S,k,p),Y=e.isTileAffectedByFog(x),X=e.getOrCreateProgram("raster",{defines:d.defines,overrideFog:Y});if(e.uploadCommonUniforms(u,X,s),f instanceof t.bo){const i=f.elevatedGlobeVertexBuffer,s=f.elevatedGlobeIndexBuffer;if(_||!a)f.boundsBuffer&&f.boundsSegments&&X.draw(e,l.TRIANGLES,I,t.ah.disabled,m,t.ag.disabled,q,n.id,f.boundsBuffer,e.quadTriangleIndexBuffer,f.boundsSegments);else if(i&&s){const o=z.zoom<=t.b3?f.elevatedGlobeSegments:f.getSegmentsForLongitude(z.center.lng);o&&X.draw(e,l.TRIANGLES,I,t.ah.disabled,m,r,q,n.id,i,s,o)}}else if(c){I=new t.af(l.LEQUAL,t.af.ReadOnly,e.depthRangeFor3D);const i=e.globeSharedBuffers;if(i){const[t,s,o]=i.getGridBuffers(W,!1);X.draw(e,l.TRIANGLES,I,w||j,e.colorModeForRenderPass(),r,q,n.id,t,s,o)}}else{const{tileBoundsBuffer:i,tileBoundsIndexBuffer:s,tileBoundsSegments:r}=e.getTileBoundsBuffers(M);X.draw(e,l.TRIANGLES,I,j,m,t.ag.disabled,q,n.id,i,s,r)}}if(!(f instanceof t.bo)&&c)for(const o of s){const s=o.canonical.y===(1<<o.canonical.z)-1;0===o.canonical.y&&Fn(!0,o,e,i,n,p,d,r,w||t.ah.disabled),s&&Fn(!1,o,e,i,n,p,d,r===t.ag.frontCW?t.ag.backCW:t.ag.frontCW,w||t.ah.disabled)}};c?x(w,e.renderElevatedRasterBackface?t.ag.backCW:t.ag.frontCW,e.stencilModeFor3D()):x(w,t.ag.disabled,void 0),e.resetStencilClippingMasks()},"raster-particle":function(e,i,n,s,r,o){"offscreen"===e.renderPass&&function(e,i,n,s){if(!s.length)return;const r=e.context,o=r.gl,a=i.getSource();if(!(a instanceof Si))return;const h=Math.ceil(Math.sqrt(n.paint.get("raster-particle-count")));let c=n.particlePositionRGBAImage;if(!c||c.width!==h){const e=function(t){const e=t*t,i=new Uint8Array(4*e),n=function(t){return t|=0,t=Math.imul(2747636419^t,2654435769),t=Math.imul(t^t>>>16,2654435769),((t=Math.imul(t^t>>>16,2654435769))>>>0)/4294967296},s=1/1.1;for(let t=0;t<e;t++){const e=s*(n(2*t+0)+nn),r=s*(n(2*t+1)+nn),o=255*e%1,a=255*r%1,h=o,c=r-a/255,u=a;i[4*t+0]=255*(e-o/255),i[4*t+1]=255*h,i[4*t+2]=255*c,i[4*t+3]=255*u}return i}(h);c=n.particlePositionRGBAImage=new t.j({width:h,height:h},e)}let u=n.particleFramebuffer;u?u.width!==h&&(u.destroy(),u=n.particleFramebuffer=r.createFramebuffer(h,h,!0,null)):u=n.particleFramebuffer=r.createFramebuffer(h,h,!0,null);const l=[];for(const e of s){const s=i.getTile(e);if(!(s instanceof t.c5))continue;const o=$n(s,a,n);if(!o)continue;const u=[s.tileSize,s.tileSize];let f=n.tileFramebuffer;f||(f=n.tileFramebuffer=r.createFramebuffer(u[0],u[1],!0,null));let d=s.rasterParticleState;d||(d=s.rasterParticleState=new rt(r,e,u,c));const p=d.update(n.lastInvalidatedAt);d.particleTextureDimension!==h&&d.updateParticleTexture(e,c);const m=d.targetColorTexture;d.targetColorTexture=d.backgroundColorTexture,d.backgroundColorTexture=m;const _=d.particleTexture0;d.particleTexture0=d.particleTexture1,d.particleTexture1=_,l.push([e,o,d,p])}if(0===l.length)return;const f=t.e.now(),d=n.previousDrawTimestamp?.001*(f-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=f,n.hasColorMap()){r.activeTexture.set(o.TEXTURE0+2);let e=n.colorRampTexture;e||(e=n.colorRampTexture=new t.T(r,n.colorRamp,o.RGBA)),e.bind(o.LINEAR,o.CLAMP_TO_EDGE)}r.bindFramebuffer.set(n.tileFramebuffer.framebuffer),function(e,i,n){const s=e.context,r=s.gl,o=i.tileFramebuffer;s.activeTexture.set(r.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},h=e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const c of n){const[,,n,u]=c;o.colorAttachment.set(n.targetColorTexture.texture),s.viewport.set([0,0,o.width,o.height]),s.clear({color:t.C.transparent}),u&&(n.backgroundColorTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE),h.draw(e,r.TRIANGLES,t.af.disabled,t.ah.disabled,t.a.alphaBlended,t.ag.disabled,a,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments))}}(e,n,l),function(e,i,n,s){const r=e.context,o=r.gl,a=n.tileFramebuffer,h="globe"===e.transform.projection.name,c=n.paint.get("raster-particle-max-speed");for(const u of s){const[s,l,f]=u;r.activeTexture.set(o.TEXTURE0+0),l.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.colorAttachment.set(f.targetColorTexture.texture);const d=e.getOrCreateProgram("rasterParticleDraw",{defines:l.defines,overrideFog:!1});r.activeTexture.set(o.TEXTURE0+1);const p=l.scalarData?[]:[0,1,2,3].map((e=>t.b$[e](s)));p.push(s);const m=s.canonical.x,_=s.canonical.y;for(const r of p){const a=i.getTile(h?r.wrapped():r);if(!a)continue;const u=a.rasterParticleState;if(!u)continue;const f=r.canonical.x+(1<<r.canonical.z)*(r.wrap-s.wrap),p=r.canonical.y;u.particleTexture0.bind(o.NEAREST,o.CLAMP_TO_EDGE);const v=rn(1,u.particleTexture0.size[0],[f-m,p-_],0,l.texture.size,2,c,l.textureOffset,l.scale,l.offset);d.draw(e,o.POINTS,t.af.disabled,t.ah.disabled,t.a.alphaBlended,t.ag.disabled,v,n.id,u.particleIndexBuffer,void 0,u.particleSegment)}}}(e,i,n,l),r.bindFramebuffer.set(n.particleFramebuffer.framebuffer),function(e,i,n,s){const r=e.context,o=r.gl,a=i.paint.get("raster-particle-max-speed"),h=s*i.paint.get("raster-particle-speed-factor")*.15,c=function(t){return Math.pow(t,6)}(.01+1*i.paint.get("raster-particle-reset-rate-factor")),u=i.particleFramebuffer;r.viewport.set([0,0,u.width,u.height]);for(const s of n){const[,n,l]=s;r.activeTexture.set(o.TEXTURE0+0),n.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),r.activeTexture.set(o.TEXTURE0+1);const f=l.particleTexture0;f.bind(o.NEAREST,o.CLAMP_TO_EDGE);const d=on(1,f.size[0],0,n.texture.size,a,h,c,n.textureOffset,n.scale,n.offset);u.colorAttachment.set(l.particleTexture1.texture),r.clear({color:t.C.transparent}),e.getOrCreateProgram("rasterParticleUpdate",{defines:n.defines}).draw(e,o.TRIANGLES,t.af.disabled,t.ah.disabled,t.a.unblended,t.ag.disabled,d,i.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments)}}(e,n,l,d)}(e,i,n,s),"translucent"===e.renderPass&&(function(e,i,n,s,r){const o=e.context,a=o.gl,h=i.getSource().tileSize,c=5*(1-t.a0(t.aV,t.aV+1,e.transform.zoom))*h+n.paint.get("raster-particle-elevation"),u=!e.options.moving,l="globe"===e.transform.projection.name;if(!s.length)return;const[f,d]=e.stencilConfigForOverlap(s),p=[];l&&p.push("PROJECTION_GLOBE_VIEW");const m=e.stencilModeFor3D();for(const s of d){const r=s.toUnwrapped(),h=i.getTile(s);if(!h.rasterParticleState)continue;const d=h.rasterParticleState,_=100;h.registerFadeDuration(_);const v=i.findLoadedParent(s,0),g=Ai(h,v,i,e.transform,_);let b,w;e.terrain&&e.terrain.prepareDrawTile(),o.activeTexture.set(a.TEXTURE0),d.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE1),v&&v.rasterParticleState?(v.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),b=Math.pow(2,v.tileID.overscaledZ-h.tileID.overscaledZ),w=[h.tileID.canonical.x*b%1,h.tileID.canonical.y*b%1]):d.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const y=l?Float32Array.from(e.transform.expandedFarZProjMatrix):e.transform.calculateProjMatrix(r,u),x=e.transform,M=Un(x),T=t.be(s.canonical),O=t.bf(T.getCenter().lat);let E,A,S,k,I;l?(E=Float32Array.from(t.bh(t.bi(s.canonical))),A=Float32Array.from(x.globeMatrix),S=Float32Array.from(t.bd(x)),k=[t.ak(x.center.lng),t.al(x.center.lat)],I=Float32Array.from(t.bg(s.canonical,T,O,x.worldSize/x._pixelsPerMercatorPixel))):(E=new Float32Array(16),A=new Float32Array(9),S=new Float32Array(16),k=[0,0],I=new Float32Array(9));const C=sn(y,E,A,S,I,w||[0,0],t.a2(e.transform.zoom),k,M,b||1,g,c),j=e.isTileAffectedByFog(s),D=e.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:j});if(e.uploadCommonUniforms(o,D,r),l){const i=new t.af(a.LEQUAL,t.af.ReadOnly,e.depthRangeFor3D),s=0,r=e.globeSharedBuffers;if(r){const[o,h,c]=r.getGridBuffers(O,0!==s);D.draw(e,a.TRIANGLES,i,m,t.a.alphaBlended,e.renderElevatedRasterBackface?t.ag.frontCCW:t.ag.backCCW,C,n.id,o,h,c)}}else{const i=e.depthModeForSublayer(0,t.af.ReadOnly),r=f[s.overscaledZ],{tileBoundsBuffer:o,tileBoundsIndexBuffer:c,tileBoundsSegments:u}=e.getTileBoundsBuffers(h);D.draw(e,a.TRIANGLES,i,r,t.a.alphaBlended,t.ag.disabled,C,n.id,o,c,u)}}e.resetStencilClippingMasks()}(e,i,n,s),e.style.map.triggerRepaint())},background:function(e,i,n,s){const r=n.paint.get("background-color"),o=n.paint.get("background-opacity"),a=n.paint.get("background-emissive-strength");if(0===o)return;const h=e.context,c=h.gl,u=e.transform,l=u.tileSize,f=n.paint.get("background-pattern");let d;if(void 0!==f){if(null===f)return;if(d=e.imageManager.getPattern(f.toString(),n.scope,e.style.getLut(n.scope)),!d)return}const p=!f&&1===r.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==p)return;const m=t.ah.disabled,_=e.depthModeForSublayer(0,"opaque"===p?t.af.ReadWrite:t.af.ReadOnly),v=e.colorModeForDrapableLayerRenderPass(a),g=f?"backgroundPattern":"background";let b,w=s;w||(b=e.getBackgroundTiles(),w=Object.values(b).map((t=>t.tileID))),f&&(h.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context,n.scope));for(const p of w){const w=e.isTileAffectedByFog(p),y=e.getOrCreateProgram(g,{overrideFog:w}),x=p.toUnwrapped(),M=s?p.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const T=i?i.getTile(p):b?b[p.key]:new t.bA(p,l,u.zoom,e),O=f?fn(M,a,o,e,0,n.scope,d,{tileID:p,tileSize:l}):ln(M,a,o,r.toRenderColor(n.lut));e.uploadCommonUniforms(h,y,x);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:A,tileBoundsSegments:S}=e.getTileBoundsBuffers(T);y.draw(e,c.TRIANGLES,_,m,v,t.ag.disabled,O,n.id,E,A,S)}},sky:function(e,i,n){const s=e._atmosphere?t.a2(e.transform.zoom):1,r=n.paint.get("sky-opacity")*s;if(0===r)return;const o=e.context,a=n.paint.get("sky-type"),h=new t.af(o.gl.LEQUAL,t.af.ReadOnly,[0,1]),c=e.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===e.renderPass?n.needsSkyboxCapture(e)&&(function(e,i,n,s){const r=e.context,o=r.gl;let a=i.skyboxFbo;if(!a){a=i.skyboxFbo=r.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new ts(r),i.skyboxTexture=r.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,i.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let t=0;t<6;++t)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}r.bindFramebuffer.set(a.framebuffer),r.viewport.set([0,0,32,32]);const h=i.getCenter(e,!0),c=e.getOrCreateProgram("skyboxCapture"),u=new Float64Array(16);t.ae.identity(u),t.ae.rotateY(u,u,.5*-Math.PI),es(e,i,c,u,h,0),t.ae.identity(u),t.ae.rotateY(u,u,.5*Math.PI),es(e,i,c,u,h,1),t.ae.identity(u),t.ae.rotateX(u,u,.5*-Math.PI),es(e,i,c,u,h,2),t.ae.identity(u),t.ae.rotateX(u,u,.5*Math.PI),es(e,i,c,u,h,3),t.ae.identity(u),es(e,i,c,u,h,4),t.ae.identity(u),t.ae.rotateY(u,u,Math.PI),es(e,i,c,u,h,5),r.viewport.set([0,0,e.width,e.height])}(e,n),n.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,i,n,s,r){const o=e.context,a=o.gl,h=e.transform,c=e.getOrCreateProgram("skybox");o.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,i.skyboxTexture);const u=((t,e,i,n,s)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:n,u_temporal_offset:s}))(h.skyboxMatrix,i.getCenter(e,!1),0,s,r);e.uploadCommonUniforms(o,c),c.draw(e,a.TRIANGLES,n,t.ah.disabled,e.colorModeForRenderPass(),t.ag.backCW,u,"skybox",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,h,r,c):"gradient"===a&&"sky"===e.renderPass&&function(e,i,n,s,r){const o=e.context,a=o.gl,h=e.transform,c=e.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new ts(o)),o.activeTexture.set(a.TEXTURE0);let u=i.colorRampTexture;u||(u=i.colorRampTexture=new t.T(o,i.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const l=((e,i,n,s,r)=>({u_matrix:e,u_color_ramp:0,u_center_direction:i,u_radius:t.ac(n),u_opacity:s,u_temporal_offset:r}))(h.skyboxMatrix,i.getCenter(e,!1),i.paint.get("sky-gradient-radius"),s,r);e.uploadCommonUniforms(o,c),c.draw(e,a.TRIANGLES,n,t.ah.disabled,e.colorModeForRenderPass(),t.ag.backCW,l,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(e,n,h,r,c)},debug:function(e,i,n,s,r,o){for(let a=0;a<n.length;a++)if(r){const r=1,h=.8,c=new t.C(s.r*h,s.g*h,s.b*h,1);qn(e,i,n[a],s,-r,-r,o),qn(e,i,n[a],s,-r,r,o),qn(e,i,n[a],s,r,r,o),qn(e,i,n[a],s,r,-r,o),qn(e,i,n[a],c,0,0,o)}else qn(e,i,n[a],s,0,0,o)},custom:function(e,i,n,s){const r=e.context,o=n.implementation;if(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes("custom")||e.terrain&&(e.terrain.renderingToTexture||"offscreen"===e.renderPass)&&n.isDraped(i)){if("offscreen"===e.renderPass){const i=o.prerender;if(i){if(e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),"globe"===e.transform.projection.name){const n=e.transform.pointMerc;i.call(o,r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.a2(e.transform.zoom),[n.x,n.y],e.transform.pixelsPerMeterRatio)}else i.call(o,r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState()}}else if("translucent"===e.renderPass){if(e.terrain&&e.terrain.renderingToTexture){const i=o.renderToTile;if(i){const n=s[0].canonical,a=new t._(n.x+s[0].wrap*(1<<n.z),n.y,n.z);r.setDepthMode(t.af.disabled),r.setStencilMode(t.ah.disabled),r.setColorMode(e.colorModeForRenderPass()),e.setCustomLayerDefaults(),i.call(o,r.gl,a),r.setDirty(),e.setBaseState()}return}e.setCustomLayerDefaults(),r.setColorMode(e.colorModeForRenderPass()),r.setStencilMode(t.ah.disabled);const i="3d"===o.renderingMode?new t.af(e.context.gl.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.af.ReadOnly);if(r.setDepthMode(i),"globe"===e.transform.projection.name){const i=e.transform.pointMerc;o.render(r.gl,e.transform.customLayerMatrix(),e.transform.getProjection(),e.transform.globeToMercatorMatrix(),t.a2(e.transform.zoom),[i.x,i.y],e.transform.pixelsPerMeterRatio)}else o.render(r.gl,e.transform.customLayerMatrix());r.setDirty(),e.setBaseState(),r.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(e,i,n,s){if("opaque"===e.renderPass)return;const r=n.paint.get("model-opacity");if(0===r)return;const o=n.paint.get("model-cast-shadows");if("shadow"===e.renderPass){if(!o)return;if(e.terrain&&r<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof t.Z)return}const a=e.shadowRenderer,h=n.paint.get("model-receive-shadows");a&&(a.useNormalOffset=!0,h||(a.enabled=!1));const c=()=>{a&&(a.useNormalOffset=!0,h||(a.enabled=!0))},u=i.getSource();if("light-beam"===e.renderPass&&"batched-model"!==u.type)return;if("vector"===u.type||"geojson"===u.type)return function(e,i,n,s,r){const o=e.transform;if("mercator"!==o.projection.name)return void t.w(`Drawing 3D models for ${o.projection.name} projection is not yet implemented`);const a=o.getFreeCameraOptions().position;if(!e.modelManager)return;const h=e.modelManager;n.modelManager=h;const c=e.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const u=n._unevaluatedLayout._values["model-id"],l={...n.layout.get("model-id").parameters},f=e.style.order.indexOf(n.fqid);for(const d of s){const s=i.getTile(d).getBucket(n);if(!s||s.projection.name!==o.projection.name)continue;const p=s.getModelUris();p&&!s.modelsRequested&&(h.addModelsFromBucket(p,r),s.modelsRequested=!0);const m=ps(d,o);l.zoom=m;const _=u.possiblyEvaluate(l);if(fs(e,s,d),ds.shadowUniformsInitialized=!1,ds.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(d.toUnwrapped()),"shadow"===e.renderPass&&c){if(1===e.currentShadowCascade&&s.isInsideFirstShadowMapFrustum)continue;const i=o.calculatePosMatrix(d.toUnwrapped(),o.worldSize);if(ds.tileMatrix.set(i),ds.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(i)),ds.aabb.min.fill(0),ds.aabb.max[0]=ds.aabb.max[1]=t.a4,ds.aabb.max[2]=0,vs(s,ds,e,n.scope))continue}const v=1<<d.canonical.z,g=[((a.x-d.wrap)*v-d.canonical.x)*t.a4,(a.y*v-d.canonical.y)*t.a4,a.z*v*t.a4];e.conflationActive&&Object.keys(s.instancesPerModel).length>0&&e.style.isLayerClipped(n,i.getSource())&&s.updateReplacement(d,e.replacementSource,f,r)&&(s.uploaded=!1,s.upload(e.context));for(let t in s.instancesPerModel){const i=s.instancesPerModel[t];i.features.length>0&&(t=_.evaluate(i.features[0].feature,{}));const o=h.getModel(t,r);if(o&&o.uploaded)for(const t of o.nodes)ms(e,n,t,i,g,d,ds)}}}(e,i,n,s,"vector"===u.type?n.scope:""),void c();if(!u.loaded())return;if("batched-model"===u.type)return function(e,i,n,s){n.resetLayerRenderingStats(e);const r=e.context,o=e.transform,a=e.style.fog,h=e.shadowRenderer;if("mercator"!==o.projection.name)return void t.w(`Drawing 3D landmark models for ${o.projection.name} projection is not yet implemented`);const c=e.transform.getFreeCameraOptions().position,u=t.$.scale([],[c.x,c.y,c.z],e.transform.worldSize);t.$.negate(u,u);const l=t.ae.identity([]),f=t.ci(o.center.lat,o.zoom),d=t.ae.fromScaling([],[1,1,1/f]);t.ae.translate(l,l,u);const p=n.paint.get("model-opacity"),m=new t.af(r.gl.LEQUAL,t.af.ReadWrite,e.depthRangeFor3D),_=new t.af(r.gl.LEQUAL,t.af.ReadOnly,e.depthRangeFor3D),v=new t.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),g="shadow"===e.renderPass,b=g&&h?h.getCurrentCascadeFrustum():o.getFrustum(o.scaleZoom(o.worldSize)),w=n.paint.get("model-front-cutoff"),y=w[2]<1,x=fi(e,n.paint.get("model-cutoff-fade-range")),M=n.getLayerRenderingStats();(function(t,e,i,n){const s=t.terrain?t.terrain.exaggeration():0,r=t.transform.zoom;for(const o of n){const n=e.getTile(o).getBucket(i);n&&(t.conflationActive&&n.updateReplacement(o,t.replacementSource),n.evaluateScale(t,i),t.terrain&&s>0&&n.elevationUpdate(t.terrain,s,o,i.source),n.needsReEvaluation(t,r,i)&&n.evaluate(i))}})(e,i,n,s),function(){let c,u,f;y?(c=s.length-1,u=-1,f=-1):(c=0,u=s.length,f=1);for(let T=c;T!==u;T+=f){const c=s[T],u=i.getTile(c).getBucket(n);if(!u||!u.uploaded)continue;let f=!1;h&&(f=0===h.getMaxCascadeForTile(c.toUnwrapped()));const O=o.calculatePosMatrix(c.toUnwrapped(),o.worldSize),E=u.modelTraits,A=[];for(const i of u.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const n=i.node;let s=0;e.terrain&&n.elevation&&(s=n.elevation*e.terrain.exaggeration());const r=i.evaluatedScale;if(r[0]<=1&&r[1]<=1&&r[2]<=1&&0===(()=>{const e=i.aabb;return v.min=[...e.min],v.max=[...e.max],v.min[2]+=s,v.max[2]+=s,t.$.transformMat4(v.min,v.min,O),t.$.transformMat4(v.max,v.max,O),v})().intersects(b))continue;const a=[...O],h=n.anchor?n.anchor[0]:0,c=n.anchor?n.anchor[1]:0;t.ae.translate(a,a,[h*(r[0]-1),c*(r[1]-1),s]),t.$.exactEquals(r,t.cl)||t.ae.scale(a,a,r);const u=t.ae.multiply([],a,n.matrix),l=t.ae.multiply([],o.expandedFarZProjMatrix,u),f=t.ae.multiply([],o.expandedFarZProjMatrix,a),d=t.aB.transformMat4([],[h,c,s,1],l)[2];n.hidden=!1;let m=p;g||(y&&(m*=bs(a,o,i.aabb,w)),m*=gs(x,d)),0!==m?A.push({nodeInfo:i,depth:d,opacity:m,wvpForNode:l,wvpForTile:f,nodeModelMatrix:u,tileModelMatrix:a}):n.hidden=!0}g||A.sort(((t,e)=>!y||1===t.opacity&&1===e.opacity?t.depth<e.depth?-1:1:1===t.opacity?-1:1===e.opacity?1:t.depth>e.depth?-1:1));for(const i of A){const s=i.nodeInfo,c=s.node;let u=t.ae.multiply([],d,i.tileModelMatrix);t.ae.multiply(u,l,u);const p=t.ae.invert([],u);t.ae.transpose(p,p),t.ae.scale(p,p,_s),u=t.ae.multiply(u,u,c.matrix);const v="light-beam"===e.renderPass,b=E&t.cn.HasMapboxMeshFeatures,w=b?0:s.evaluatedRMEA[0][2];for(let l=0;l<c.meshes.length;++l){const d=c.meshes[l],y=l===c.lightMeshIndex;let x=i.wvpForNode;if(y){if(!v&&!e.terrain&&e.shadowRenderer){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);continue}x=i.wvpForTile}else if(v)continue;const T={defines:[]},O=[];if(hs(T.defines,O,d,e,n.lut),b||T.defines.push("DIFFUSE_SHADED"),f&&T.defines.push("SHADOWS_SINGLE_CASCADE"),M&&(g?M.numRenderedVerticesInShadowPass+=d.vertexArray.length:M.numRenderedVerticesInTransparentPass+=d.vertexArray.length),g){ls(d,i.nodeModelMatrix,e,n);continue}let E=null;if(a){const t=as(i.nodeModelMatrix,e.transform);if(E=new Float32Array(t),"globe"!==o.projection.name){const e=d.aabb.min,i=d.aabb.max,[n,s]=a.getOpacityForBounds(t,e[0],e[1],i[0],i[1]);T.overrideFog=n>=Qt||s>=Qt}}const A=d.material;let S;A.occlusionTexture&&A.occlusionTexture.offsetScale&&(S=A.occlusionTexture.offsetScale,T.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!g&&h&&(h.useNormalOffset=!!d.normalBuffer);const k=e.getOrCreateProgram("model",T);!g&&h&&h.setupShadowsFromMatrix(i.tileModelMatrix,k,h.useNormalOffset),e.uploadCommonUniforms(r,k,null,E);const I=A.pbrMetallicRoughness;I.metallicFactor=.9,I.roughnessFactor=.5;const C=pn(new Float32Array(x),new Float32Array(u),new Float32Array(p),new Float32Array(c.matrix),e,i.opacity,I.baseColorFactor.toRenderColor(null),A.emissiveFactor,I.metallicFactor,I.roughnessFactor,A,w,n,[0,0,0],S);!y&&(s.hasTranslucentParts||i.opacity<1)&&k.draw(e,r.gl.TRIANGLES,m,t.ah.disabled,t.a.disabled,t.ag.backCCW,C,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,O),k.draw(e,r.gl.TRIANGLES,y?_:m,t.ah.disabled,y||i.opacity<1||s.hasTranslucentParts?t.a.alphaBlended:t.a.unblended,t.ag.backCCW,C,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,e.transform.zoom,void 0,O)}}}}()}(e,i,n,s),void c();if("model"!==u.type)return;const l=u.getModels(),f=[],d=e.transform.getFreeCameraOptions().position,p=t.$.scale([],[d.x,d.y,d.z],e.transform.worldSize);t.$.negate(p,p);const m=[],_=[];let v=0;for(const i of l){const s=n.paint.get("model-rotation").constantOr(null),r=n.paint.get("model-scale").constantOr(null),o=n.paint.get("model-translation").constantOr(null);i.computeModelMatrix(e,s,r,o,!0,!0,!1);const a=t.ae.identity([]),h=t.ci(i.position.lat,e.transform.zoom),c=t.ae.fromScaling([],[1,1,1/h]);t.ae.translate(a,a,p),f.push({zScaleMatrix:c,negCameraPosMatrix:a});for(const t of i.nodes)us(e.transform,t,i.matrix,e.transform.expandedFarZProjMatrix,v,m,_);v++}if(m.sort(((t,e)=>e.depth-t.depth)),"shadow"!==e.renderPass){if(1===r)for(const i of _)cs(i,e,n,f[i.modelIndex],t.ah.disabled,e.colorModeForRenderPass());else{for(const i of _)cs(i,e,n,f[i.modelIndex],t.ah.disabled,t.a.disabled);for(const t of _)cs(t,e,n,f[t.modelIndex],e.stencilModeFor3D(),e.colorModeForRenderPass());e.resetStencilClippingMasks()}for(const i of m)cs(i,e,n,f[i.modelIndex],t.ah.disabled,e.colorModeForRenderPass());c()}else{for(const t of _)ls(t.mesh,t.nodeModelMatrix,e,n);for(const t of m)ls(t.mesh,t.nodeModelMatrix,e,n);c()}}},Ts={model:function(t,e,i){const n=e.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(i.modelManager&&i.modelManager.upload(i,"vector"===n.type?t.scope:""));if("batched-model"===n.type)return;if("model"!==n.type)return;const s=n.getModels();for(const t of s)t.upload(i.context)},raster:function(t,e,i){const n=e.getSource();if(!(n instanceof Si&&n.loaded()))return;const s=t.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!s)return;const r=t.paint.get("raster-array-band")||n.getInitialBand(s);if(null==r)return;const o=e.getIds().map((t=>e.getTileByID(t)));for(const t of o)t.updateNeeded(s,r)&&n.prepareTile(t,s,r)},"raster-particle":function(t,e,i){const n=e.getSource();if(!(n instanceof Si&&n.loaded()))return;const s=t.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!s)return;const r=t.paint.get("raster-particle-array-band")||n.getInitialBand(s);if(null==r)return;const o=e.getIds().map((t=>e.getTileByID(t)));for(const t of o)t.updateNeeded(s,r)&&n.prepareTile(t,s,r)}};class Os{constructor(e,i,n,s){this.context=new st(e,i),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=s,this._timeStamp=t.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const r=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const t of r)this._debugParams.enabledLayers[t]=!0;s.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),s.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),s.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),s.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),s.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const t of r)s.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],t);this.occlusionParams=new xs(s),this.setup(),this.numSublayers=t.bx.maxUnderzooming+t.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _i(this),this._wireframeDebugCache=new ys,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const o=new t.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new t.T(this.context,o,e.RGBA)}updateTerrain(t,e){const i=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ri(this,t));const n=this._terrain;this.transform.elevation=i?n:null,n.update(t,this.transform,e),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(t){const e=t.fog;if(!e||"globe"===this.transform.projection.name||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,n]=e.getFovAdjustedRange(this.transform._fov);if(i>n)return void(this.transform.fogCullDistSq=null);const s=i+.78*(n-i);this.transform.fogCullDistSq=s*s}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ri(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,i){if(this.width=e*t.e.devicePixelRatio,this.height=i*t.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._mergedLayers[t].resize()}setup(){const e=this.context,i=new t.bv;i.emplaceBack(0,0),i.emplaceBack(t.a4,0),i.emplaceBack(0,t.a4),i.emplaceBack(t.a4,t.a4),this.tileExtentBuffer=e.createVertexBuffer(i,t.bt.members),this.tileExtentSegments=t.b.simpleSegment(0,0,4,2);const n=new t.bv;n.emplaceBack(0,0),n.emplaceBack(t.a4,0),n.emplaceBack(0,t.a4),n.emplaceBack(t.a4,t.a4),this.debugBuffer=e.createVertexBuffer(n,t.bt.members),this.debugSegments=t.b.simpleSegment(0,0,4,5);const s=new t.bv;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(-1,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,t.bt.members),this.viewportSegments=t.b.simpleSegment(0,0,4,2);const r=new t.cq;r.emplaceBack(0,0,0,0),r.emplaceBack(t.a4,0,t.a4,0),r.emplaceBack(0,t.a4,0,t.a4),r.emplaceBack(t.a4,t.a4,t.a4,t.a4),this.mercatorBoundsBuffer=e.createVertexBuffer(r,t.cr.members),this.mercatorBoundsSegments=t.b.simpleSegment(0,0,4,2);const o=new t.bw;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(o);const a=new t.cs;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.T(e,new t.j({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.ae.create();const h=this.context.gl;this.stencilClearMode=new t.ah({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,t.af.disabled,this.stencilClearMode,t.a.disabled,t.ag.disabled,Ei(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,i,n){if(!i||this.currentStencilSource===i.id||!e.isTileClipped()||!n||0===n.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let t=!1;for(const e of n)if(void 0===this._tileClippingMaskIDs[e.key]){t=!0;break}if(!t)return}this.currentStencilSource=i.id;const s=this.context,r=s.gl;this.nextStencilID+n.length>256&&this.clearStencil(),s.setColorMode(t.a.disabled),s.setDepthMode(t.af.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of n){const n=i.getTile(e),s=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,{tileBoundsBuffer:a,tileBoundsIndexBuffer:h,tileBoundsSegments:c}=this.getTileBoundsBuffers(n);o.draw(this,r.TRIANGLES,t.af.disabled,new t.ah({func:r.ALWAYS,mask:0},s,255,r.KEEP,r.KEEP,r.REPLACE),t.a.disabled,t.ag.disabled,Ei(e.projMatrix),"$clipping",a,h,c)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,i=this.context.gl;return new t.ah({func:i.NOTEQUAL,mask:255},e,255,i.KEEP,i.KEEP,i.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const i=this.context.gl;return new t.ah({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,i.KEEP,i.KEEP,i.REPLACE)}stencilConfigForOverlap(e){const i=this.context.gl,n=e.sort(((t,e)=>e.overscaledZ-t.overscaledZ)),s=n[n.length-1].overscaledZ,r=n[0].overscaledZ-s+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+s]=new t.ah({func:i.GEQUAL,mask:255},n+this.nextStencilID,255,i.KEEP,i.KEEP,i.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[s]:t.ah.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new t.a([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new t.C(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.a.unblended:t.a.alphaBlended}colorModeForDrapableLayerRenderPass(e){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new t.a([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new t.C(0,0,0,void 0===e?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,i,n,s=!1){if(this.depthOcclusion)return new t.af(this.context.gl.GREATER,t.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!s)return t.af.disabled;const r=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.af(n||this.context.gl.LEQUAL,i,[r,r])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const e=this.context.gl,i=Math.ceil(this.width),n=Math.ceil(this.height),s=this.context.bindFramebuffer.get(),r=e.getParameter(e.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===i&&this.depthFBO.height===n||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==i&&0!==n&&(this.depthFBO=new nt(this.context,i,n,!1,"texture"),this.depthTexture=new t.T(this.context,{width:i,height:n,data:null},e.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(s),e.bindTexture(e.TEXTURE_2D,r),this.depthFBO&&(e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),e.blitFramebuffer(0,0,i,n,0,0,i,n,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(e.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,e)=>t+e/this._fpsHistory.length),0))}render(e,i){const n=t.e.now();this._dt=n-this._timeStamp,this._timeStamp=n,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=e.map.repaint,this.style=e,this.options=i;const s=this.style._mergedLayers,r=this.style.order.filter((t=>{const e=s[t];return!(e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[e.type]}));let o=!1,a=!1;for(const t of r){const e=s[t];"circle"===e.type&&(o=!0),"symbol"===e.type&&(e.hasInitialOcclusionOpacityProperties?a=!0:o=!0)}const h=r.map((t=>s[t])),c=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.e.now()),this.imageManager.beginFrame();let u=0,l=!1;for(const t in c){const e=c[t];e.used&&(e.prepare(this.context),e.getSource().usedInConflation&&++u)}let f=!1;for(const t of h)t.isHidden(this.transform.zoom)||("clip"===t.type&&(f=!0),this.prepareLayer(t));const d={},p={},m={},_={},v={};for(const t in c){const e=c[t];d[t]=e.getVisibleCoordinates(),p[t]=d[t].slice().reverse(),m[t]=e.getVisibleCoordinates(!0).reverse(),_[t]=e.getShadowCasterCoordinates(),v[t]=e.sortCoordinatesByDistance(d[t])}const g=t=>{const e=this.style.getLayerSourceCache(t);return e&&e.used?e.getSource():null};if(u||f){const e=[],i=[];let n=0;for(const t of h)this.isSourceForClippingOrConflation(t,g(t))&&(e.push(t),i.push(n)),n++;if(e&&(f||e.length>1)){const n=[];for(let s=0;s<e.length;s++){const r=e[s],o=i[s],a=this.style.getLayerSourceCache(r);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==r.type)continue;let h=t.cv,c=t.cw.None;const u=[];if("clip"===r.type){h=o;for(const e of r.layout.get("clip-layer-types"))c|="model"===e?t.cw.Model:"symbol"===e?t.cw.Symbol:t.cw.FillExtrusion;for(const t of r.layout.get("clip-layer-scope"))u.push(t)}n.push({layer:r.fqid,cache:a,order:h,clipMask:c,clipScope:u})}this.replacementSource.setSources(n),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let t=0;t<h.length;t++){const e=h[t],i=e.cutoffRange();if(this.longestCutoffRange=Math.max(i,this.longestCutoffRange),i>0){const t=g(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}e.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=t),this._lastOcclusionLayer=t)}const b=this.style&&this.style.fog;b?(this._fogVisible=0!==b.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=b.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(m),this.opaquePassCutoff=0);const w=this._shadowRenderer;if(w){w.updateShadowParameters(this.transform,this.style.directionalLight);for(const t in c)for(const e of d[t]){let t={min:0,max:0};this.terrain&&(t=this.terrain.getMinMaxForTile(e)||t),w.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new os(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!t.cu(this.context.gl))return;this.renderPass="offscreen";for(const t of h){const i=e.getLayerSourceCache(t);if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=i?p[i.id]:void 0;("custom"===t.type||"raster"===t.type||"raster-particle"===t.type||t.isSky()||n&&n.length)&&this.renderLayer(this,i,t,n)}this.depthRangeFor3D=[0,1-(h.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),x=(()=>{if(i.showOverdrawInspector)return t.C.black;const e=this.style.fog;if(e&&this.transform.projection.supportsFog){const i=this.style.getLut(e.scope);if(!y){const n=e.properties.get("color").toRenderColor(i).toArray01();return new t.C(...n)}if(y){const n=e.properties.get("space-color").toRenderColor(i).toArray01();return new t.C(...n)}}return t.C.transparent})();if(this.context.clear({color:x,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=h[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())continue;const n=i?(t.is3D()?v:p)[i.id]:void 0;this._renderTileClippingMasks(t,i,n),this.renderLayer(this,i,t,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.a2(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=h[this.currentLayer],i=e.getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,i,t,i?p[i.id]:void 0)}function M(t,e){let i;return e&&(i=("symbol"===t.type?m:t.is3D()?v:p)[e.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<r.length;){const t=h[this.currentLayer];if("raster"===t.type||"raster-particle"===t.type){const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,M(t,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let T=0;w&&(T=w.getShadowCastingLayerCount());let O=!1,E=-1;for(let t=0;t<r.length;++t){const e=h[t];e.isHidden(this.transform.zoom)||e.is3D()&&(E=t)}for(a&&-1===E&&(o=!0);this.currentLayer<r.length;){const t=h[this.currentLayer],i=e.getLayerSourceCache(t);if(t.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(o&&!O&&this.terrain&&!this.transform.isOrthographic&&(O=!0,this.blitDepth()),a&&-1!==E&&this.currentLayer===E+1&&!this.transform.isOrthographic&&this.blitDepth(),t.is3D()||this.terrain||this._renderTileClippingMasks(t,i,i?d[i.id]:void 0),this.renderLayer(this,i,t,M(t,i)),!this.terrain&&w&&T>0&&t.hasShadowPass()&&0==--T&&(w.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const t=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=t;this.currentLayer++){const t=h[this.currentLayer];if(!t.hasLightBeamPass())continue;const i=e.getLayerSourceCache(t);this.renderLayer(this,i,t,i?p[i.id]:void 0)}this.currentLayer=t,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const t=this.currentLayer;this.depthOcclusion=!0;for(const t of this.layersWithOcclusionOpacity){this.currentLayer=t;const i=h[this.currentLayer],n=e.getLayerSourceCache(i),s=n?p[n.id]:void 0;i.is3D()||this.terrain||this._renderTileClippingMasks(i,n,n?d[n.id]:void 0),this.renderLayer(this,n,i,s)}this.depthOcclusion=!1,this.currentLayer=t,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;h.forEach((t=>{const n=e.getLayerSourceCache(t);n&&!t.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<n.getSource().maxzoom)&&(i=n)})),i&&this.options.showTileBoundaries&&Ms.debug(this,i,i.getVisibleCoordinates(),t.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ms.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(t){const e=t.transform.padding;Yn(t,t.transform.height-(e.top||0),3,Bn),Yn(t,e.bottom||0,3,Gn),Xn(t,e.left||0,3,Hn),Xn(t,t.transform.width-(e.right||0),3,Vn);const i=t.transform.centerPoint;!function(t,e,i,n){Zn(t,e-1,i-10,2,20,n),Zn(t,e-10,i-1,20,2,n)}(t,i.x,t.transform.height-i.y,Wn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:e}=this.transform.projection,i=!e||!e.includes(t.type);if(Ts[t.type]&&(i||this.terrain&&"custom"===t.type)){const e=this.style.getLayerSourceCache(t);Ts[t.type](t,e,this)}this.gpuTimingEnd()}renderLayer(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||n&&n.length)&&(this.id=i.id,this.gpuTimingStart(i),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(i.type)&&(!t.terrain||"custom"!==i.type)||"clip"===i.type||Ms[i.type](t,e,i,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery,i=this.context.gl;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:i.createQuery()}),n.calls++,i.beginQuery(e.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,e=this.context.gl,i=e.createQuery();this.deferredRenderGpuTimeQueries.push(i),e.beginQuery(t.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const e={};for(const i in t){const n=t[i],s=this.context.extTimerQuery,r=s.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;s.deleteQueryEXT(n.query),e[i]=r}return e}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const e=this.context.extTimerQuery,i=this.context.gl;let n=0;for(const s of t)n+=e.getQueryParameter(s,i.QUERY_RESULT)/1e6,e.deleteQueryEXT(s);return n}translatePosMatrix(e,i,n,s,r){if(!n[0]&&!n[1])return e;const o=r?"map"===s?this.transform.angle:0:"viewport"===s?-this.transform.angle:0;if(o){const t=Math.sin(o),e=Math.cos(o);n=[n[0]*e-n[1]*t,n[0]*t+n[1]*e]}const a=[r?n[0]:t.bD(i,n[0],this.transform.zoom),r?n[1]:t.bD(i,n[1],this.transform.zoom),0],h=new Float32Array(16);return t.ae.translate(h,e,a),h}saveTileTexture(t){const e=t.size[0],i=this._tileTextures[e];i?i.push(t):this._tileTextures[e]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(t,e,i){const n=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,s=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===t||"terrainRaster"===t?(s.push("LIGHTING_3D_MODE"),s.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||s.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||s.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):s.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(s.push("TERRAIN"),this.linearFloatFilteringSupported()&&s.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&s.push("GLOBE"),!this._fogVisible||n||void 0!==e&&!e||s.push("FOG","FOG_DITHERING"),n&&s.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&s.push("OVERDRAW_INSPECTOR"),s}getOrCreateProgram(t,e){this.cache=this.cache||{};const i=e&&e.defines||[],n=e&&e.config,s=this.currentGlobalDefines(t,e&&e.overrideFog,e&&e.overrideRtt).concat(i),r=zi.cacheKey(Oe[t],t,s,n);return this.cache[r]||(this.cache[r]=new zi(this.context,t,Oe[t],n,_n[t],s)),this.cache[r]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,i){if(this.style.enable3dLights()){const n=this.style.directionalLight,s=this.style.ambientLight;if(n&&s){const r=((e,i,n)=>{const s=e.properties.get("direction"),r=e.properties.get("color").toRenderColor(n.getLut(e.scope)).toArray01(),o=e.properties.get("intensity"),a=i.properties.get("color").toRenderColor(n.getLut(i.scope)).toArray01(),h=i.properties.get("intensity"),c=[s.x,s.y,s.z],u=t.bC(a,h),l=t.bC(r,o);return{u_lighting_ambient_color:u,u_lighting_directional_dir:c,u_lighting_directional_color:l,u_ground_radiance:Pi(c,l,u)}})(n,s,this.style);i.setLightsUniformValues(e,r)}}}uploadCommonUniforms(e,i,n,s,r){if(this.uploadCommonLightUniforms(e,i),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const r=o.getOpacity(this.transform.pitch),a=((e,i,n,s,r,o,a,h,c,u,l,f)=>{const d=e.transform,p=i.properties.get("color").toRenderColor(e.style.getLut(i.scope)).toArray01();p[3]=s;const m=e.frameCounter/1e3%1,[_,v]=i.properties.get("vertical-range");return{u_fog_matrix:n?d.calculateFogTileMatrix(n):f||e.identityMat,u_fog_range:i.getFovAdjustedRange(d._fov),u_fog_color:p,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_,v),v],u_fog_temporal_offset:m,u_frustum_tl:r,u_frustum_tr:o,u_frustum_br:a,u_frustum_bl:h,u_globe_pos:c,u_globe_radius:u,u_viewport:l,u_globe_transition:t.a2(d.zoom),u_is_globe:+("globe"===d.projection.name)}})(this,o,n,r,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.e.devicePixelRatio,this.transform.height*t.e.devicePixelRatio],s);i.setFogUniformValues(e,a)}r&&i.setCutoffUniformValues(e,r.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,i=this._backgroundTiles={},n=this.transform.coveringTiles({tileSize:512});for(const s of n)i[s.key]=e[s.key]||new t.bA(s,512,this.transform.tileZoom,this);return i}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,e){return!(!t.is3D()||t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||"building"!==t.sourceLayer)&&"clip"!==t.type&&(!e||"batched-model"!==e.type))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let e=this._cachedTileFogOpacities[t.key];return e||(this._cachedTileFogOpacities[t.key]=e=this.style.fog.getOpacityForTile(t)),e[0]>=Qt||e[1]>=Qt}setupDepthForOcclusion(t,e,i){const n=this.context,s=n.gl,r=!!i;var o;i||(i={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),n.activeTexture.set(s.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),i.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],i.u_depth_range_unpack=[2/((o=this.depthRangeFor3D)[1]-o[0]),-1-2*o[0]/(o[1]-o[0])],i.u_occluder_half_size=.5*this.occlusionParams.occluderSize,i.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),n.activeTexture.set(s.TEXTURE0),r||e.setTerrainUniformValues(n,i)}}class Es{constructor(t,e,i,n){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,n)}static createFromScreenPoints(e,i){let n,s;if(e instanceof t.P||"number"==typeof e[0]){const r=t.P.convert(e);n=[r],s=i.isPointAboveHorizon(r)}else{const r=t.P.convert(e[0]),o=t.P.convert(e[1]);n=[r,o],s=t.cx(r,o).every((t=>i.isPointAboveHorizon(t)))}return new Es(n,i.getCameraPoint(),s,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.cx(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],s=t.cx(i,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<n.x?s.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?s[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(s[3]=this.cameraPoint)),t.cy(s,e)}bufferedCameraGeometryGlobe(e){const i=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],s=t.cx(i,n,e),r=this.cameraPoint.clone();switch(3*((r.y>i.y)+(r.y>n.y))+((r.x>i.x)+(r.x>n.x))){case 0:s[0]=r,s[4]=r.clone();break;case 1:s.splice(1,0,r);break;case 2:s[1]=r;break;case 3:s.splice(4,0,r);break;case 5:s.splice(2,0,r);break;case 6:s[3]=r;break;case 7:s.splice(3,0,r);break;case 8:s[2]=r}return s}containsTile(e,i,n,s=0){const r=e.queryPadding/i._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(r,i):this._bufferedScreenMercator(r,i);let a=e.tileID.wrap+(o.unwrapped?s:0);const h=o.polygon.map((i=>t.cz(e.tileTransform,i,a)));if(!t.cA(h,0,0,t.a4,t.a4))return;a=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?s:0);const c=this.screenGeometryMercator.polygon.map((i=>t.cB(e.tileTransform,i,a))),u=c.map((e=>new t.P(e[0],e[1]))),l=i.getFreeCameraOptions().position||new t._(0,0,0),f=t.cB(e.tileTransform,l,a),d=c.map((e=>{const i=t.$.sub(e,e,f);return t.$.normalize(i,i),new t.aU(f,i)})),p=t.bD(e,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:d,bufferedTilespaceGeometry:h,bufferedTilespaceBounds:(m=t.cC(h),m.min.x=t.au(m.min.x,0,t.a4),m.min.y=t.au(m.min.y,0,t.a4),m.max.x=t.au(m.max.x,0,t.a4),m.max.y=t.au(m.max.y,0,t.a4),m),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:p};var m}_bufferedScreenMercator(t,e){const i=ks(t);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),e):{polygon:this.bufferedScreenGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._screenRaycastCache[i]=n,n}}_bufferedCameraMercator(t,e){const i=ks(t);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let n;return n="globe"===e.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),e):{polygon:this.bufferedCameraGeometry(t).map((t=>e.pointCoordinate3D(t))),unwrapped:!0},this._cameraRaycastCache[i]=n,n}}_projectAndResample(e,i){const n=function(e,i){const n=t.ae.multiply([],i.pixelMatrix,i.globeMatrix),s=[0,-t.cF,0,1],r=[0,t.cF,0,1],o=[0,0,0,1];t.aB.transformMat4(s,s,n),t.aB.transformMat4(r,r,n),t.aB.transformMat4(o,o,n);const a=new t.P(s[0]/s[3],s[1]/s[3]),h=new t.P(r[0]/r[3],r[1]/r[3]),c=t.cD(e,a)&&s[3]<o[3],u=t.cD(e,h)&&r[3]<o[3];if(!c&&!u)return null;const l=function(t,e,i){for(let n=1;n<t.length;n++){const s=Ss(e.pointCoordinate3D(t[n-1]).x),r=Ss(e.pointCoordinate3D(t[n]).x);if(i<0){if(s<r)return{idx:n,t:-s/(r-1-s)}}else if(r<s)return{idx:n,t:(1-s)/(r+1-s)}}return null}(e,i,c?-1:1);if(!l)return null;const{idx:f,t:d}=l;let p=f>1?As(e.slice(0,f),i):[],m=f<e.length?As(e.slice(f),i):[];p=p.map((e=>new t.P(Ss(e.x),e.y))),m=m.map((e=>new t.P(Ss(e.x),e.y)));const _=[...p];0===_.length&&_.push(m[m.length-1]);const v=t.a3(_[_.length-1].y,(0===m.length?p[0]:m[0]).y,d);let g;return g=c?[new t.P(0,v),new t.P(0,0),new t.P(1,0),new t.P(1,v)]:[new t.P(1,v),new t.P(1,1),new t.P(0,1),new t.P(0,v)],_.push(...g),0===m.length?_.push(p[0]):_.push(...m),{polygon:_.map((e=>new t._(e.x,e.y))),unwrapped:!1}}(e,i);if(n)return n;const s=function(e,i){let n=!1,s=-1/0,r=0;for(let t=0;t<e.length-1;t++)e[t].x>s&&(s=e[t].x,r=t);for(let t=0;t<e.length-1;t++){const i=(r+t)%(e.length-1),s=e[i],o=e[i+1];Math.abs(s.x-o.x)>.5&&(s.x<o.x?(s.x+=1,0===i&&(e[e.length-1].x+=1)):(o.x+=1,i+1===e.length-1&&(e[0].x+=1)),n=!0)}const o=t.ak(i.center.lng);return n&&o<Math.abs(o-1)&&e.forEach((t=>{t.x-=1})),{polygon:e,unwrapped:n}}(As(e,i).map((e=>new t.P(Ss(e.x),e.y))),i);return{polygon:s.polygon.map((e=>new t._(e.x,e.y))),unwrapped:s.unwrapped}}}function As(e,i){return t.cE(e,(t=>{const e=i.pointCoordinate3D(t);t.x=e.x,t.y=e.y}),1/256)}function Ss(t){return t<0?1+t%1:t%1}function ks(t){return 100*t|0}function Is(e,i){const n=t.ae.identity([]);return t.ae.scale(n,n,[.5*e.width,.5*-e.height,1]),t.ae.translate(n,n,[1,-1,0]),t.ae.multiply(n,n,e.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(n)}function Cs(t,e,i,n,s,r,o,a=!1){const h=t.tilesIn(n,o,a);h.sort(Ds);const c=[];for(const n of h)c.push({wrappedTileID:n.tile.tileID.wrapped().key,queryResults:n.tile.queryRenderedFeatures(e,i,t._state,n,s,r,Is(t.transform,n.tile.tileID),a)});const u=function(t){const e={},i={};for(const n of t){const t=n.queryResults,s=n.wrappedTileID,r=i[s]=i[s]||{};for(const i in t){const n=t[i],s=r[i]=r[i]||{},o=e[i]=e[i]||[];for(const t of n)s[t.featureIndex]||(s[t.featureIndex]=!0,o.push(t))}}return e}(c);for(const e in u)u[e].forEach((e=>{const i=e.feature,n=i.layer;n&&"background"!==n.type&&"sky"!==n.type&&"slot"!==n.type&&(i.source=n.source,n["source-layer"]&&(i.sourceLayer=n["source-layer"]),i.state=void 0!==i.id?t.getFeatureState(n["source-layer"],i.id):{})}));return u}function js(t,e){const i=t.getRenderableIds().map((e=>t.getTileByID(e))),n=[],s={};for(let t=0;t<i.length;t++){const r=i[t],o=r.tileID.canonical.key;s[o]||(s[o]=!0,r.querySourceFeatures(n,e))}return n}function Ds(t,e){const i=t.tileID,n=e.tileID;return i.overscaledZ-n.overscaledZ||i.canonical.y-n.canonical.y||i.wrap-n.wrap||i.canonical.x-n.canonical.x}class Rs{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,e=!1;for(const i in this.style._mergedLayers){const n=this.style._mergedLayers[i];if("fill-extrusion"===n.type)this.layers.push({layer:n,visible:t,visibilityChanged:e});else if("model"===n.type){const i=this.style.getLayerSource(n);i&&"batched-model"===i.type&&this.layers.push({layer:n,visible:t,visibilityChanged:e})}}}onNewFrame(t){this.layersGotHidden=!1;for(const e of this.layers){const i=e.layer;let n=!1;"fill-extrusion"===i.type?n=!i.isHidden(t)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(n=!i.isHidden(t)&&i.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!n&&e.visible,e.visible=n}}updateZOffset(t,e){this.currentBuildingBuckets=[];for(const t of this.layers){const i=t.layer,n=this.style.getLayerSourceCache(i);let s=1;"fill-extrusion"===i.type&&(s=t.visible?i.paint.get("fill-extrusion-vertical-scale"):0);let r=n?n.getTile(e):null;if(!r&&n&&e.canonical.z>n.getSource().minzoom){let t=e.scaledTo(Math.min(n.getSource().maxzoom,e.overscaledZ-1));for(;t.overscaledZ>=n.getSource().minzoom&&(r=n.getTile(t),!r&&0!==t.overscaledZ);)t=t.scaledTo(t.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:r?r.getBucket(i):null,tileID:r?r.tileID:e,verticalScale:s})}t.hasAnyZOffset=!1;let i=!1;for(let n=0;n<t.symbolInstances.length;n++){const s=t.symbolInstances.get(n),r=s.zOffset,o=this._getHeightAtTileOffset(e,s.tileAnchorX,s.tileAnchorY);s.zOffset=o!==Number.NEGATIVE_INFINITY?o:r,i||r===s.zOffset||(i=!0),t.hasAnyZOffset||0===s.zOffset||(t.hasAnyZOffset=!0)}i&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,i,n,s){let r=i,o=n;if(e.canonical.z!==s.canonical.z){const a=s.canonical,h=1/(1<<e.canonical.z-a.z);r=(i+e.canonical.x*t.a4)*h-a.x*t.a4|0,o=(n+e.canonical.y*t.a4)*h-a.y*t.a4|0}return{tileX:r,tileY:o}}_getHeightAtTileOffset(t,e,i){let n,s;for(let r=0;r<this.layers.length;++r){if("fill-extrusion"!==this.layers[r].layer.type)continue;const{bucket:o,tileID:a,verticalScale:h}=this.currentBuildingBuckets[r];if(!o)continue;const{tileX:c,tileY:u}=this._mapCoordToOverlappingTile(t,e,i,a),l=o.getHeightAtTileCoord(c,u);l&&void 0!==l.height&&(l.hidden?n=l.height:s=Math.max(l.height*h,s||0))}if(void 0!==s)return s;for(let s=0;s<this.layers.length;++s){const r=this.layers[s];if("model"!==r.layer.type||!r.visible)continue;const{bucket:o,tileID:a}=this.currentBuildingBuckets[s];if(!o)continue;const{tileX:h,tileY:c}=this._mapCoordToOverlappingTile(t,e,i,a),u=o.getHeightAtTileCoord(h,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==n?Math.min(u.maxHeight,n)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ps(e,i){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return t.cG.forEach((t=>{t in i&&(n[t]=i[t])})),n}function Ns(t){t=t.slice();const e=Object.create(null);for(let i=0;i<t.length;i++)e[t[i].id]=t[i];for(let i=0;i<t.length;i++)"ref"in t[i]&&(t[i]=Ps(t[i],e[t[i].ref]));return t}const Fs={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function zs(t,e,i){i.push({command:Fs.addSource,args:[t,e[t]]})}function Ls(t,e,i){e.push({command:Fs.removeSource,args:[t]}),i[t]=!0}function $s(t,e,i,n){Ls(t,i,n),zs(t,e,i)}function Us(e,i,n){let s;for(s in e[n])if(e[n].hasOwnProperty(s)&&"data"!==s&&!t.d(e[n][s],i[n][s]))return!1;for(s in i[n])if(i[n].hasOwnProperty(s)&&"data"!==s&&!t.d(e[n][s],i[n][s]))return!1;return!0}function Bs(e,i,n,s,r,o){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(t.d(e[a],i[a])||n.push({command:o,args:[s,a,i[a],r]}));for(a in i)i.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(t.d(e[a],i[a])||n.push({command:o,args:[s,a,i[a],r]}))}function Gs(t){return t.id}function Hs(t,e){return t[e.id]=e,t}class Vs{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let t=1;t<this.points.length;t++)this._distances[t]=this._distances[t-1]+this.points[t].dist(this.points[t-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.au(e,0,1);let i=1,n=this._distances[i];const s=e*this.paddedLength+this.padding;for(;n<s&&i<this._distances.length;)n=this._distances[++i];const r=i-1,o=this._distances[r],a=n-o,h=a>0?(s-o)/a:0;return this.points[r].mult(1-h).add(this.points[i].mult(h))}}class Ws{constructor(t,e,i){const n=this.boxCells=[],s=this.circleCells=[];this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let t=0;t<this.xCellCount*this.yCellCount;t++)n.push([]),s.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,i,n,s){this._forEachCell(e,i,n,s,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(s)}insertCircle(t,e,i,n){this._forEachCell(e-n,i-n,e+n,i+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(i),this.circles.push(n)}_insertBoxCell(t,e,i,n,s,r){this.boxCells[s].push(r)}_insertCircleCell(t,e,i,n,s,r){this.circleCells[s].push(r)}_query(t,e,i,n,s,r){if(i<0||t>this.width||n<0||e>this.height)return!s&&[];const o=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(s)return!0;for(let t=0;t<this.boxKeys.length;t++)o.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],i=this.circles[3*t+1],n=this.circles[3*t+2];o.push({key:this.circleKeys[t],x1:e-n,y1:i-n,x2:e+n,y2:i+n})}return r?o.filter(r):o}return this._forEachCell(t,e,i,n,this._queryCell,o,{hitTest:s,seenUids:{box:{},circle:{}}},r),s?o.length>0:o}_queryCircle(t,e,i,n,s){const r=t-i,o=t+i,a=e-i,h=e+i;if(o<0||r>this.width||h<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(r,a,o,h,this._queryCellCircle,c,{hitTest:n,circle:{x:t,y:e,radius:i},seenUids:{box:{},circle:{}}},s),n?c.length>0:c}query(t,e,i,n,s){return this._query(t,e,i,n,!1,s)}hitTest(t,e,i,n,s){return this._query(t,e,i,n,!0,s)}hitTestCircle(t,e,i,n){return this._queryCircle(t,e,i,!0,n)}_queryCell(t,e,i,n,s,r,o,a){const h=o.seenUids,c=this.boxCells[s];if(null!==c){const s=this.bboxes;for(const u of c)if(!h.box[u]){h.box[u]=!0;const c=4*u;if(t<=s[c+2]&&e<=s[c+3]&&i>=s[c+0]&&n>=s[c+1]&&(!a||a(this.boxKeys[u]))){if(o.hitTest)return r.push(!0),!0;r.push({key:this.boxKeys[u],x1:s[c],y1:s[c+1],x2:s[c+2],y2:s[c+3]})}}}const u=this.circleCells[s];if(null!==u){const s=this.circles;for(const c of u)if(!h.circle[c]){h.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(s[u],s[u+1],s[u+2],t,e,i,n)&&(!a||a(this.circleKeys[c]))){if(o.hitTest)return r.push(!0),!0;{const t=s[u],e=s[u+1],i=s[u+2];r.push({key:this.circleKeys[c],x1:t-i,y1:e-i,x2:t+i,y2:e+i})}}}}}_queryCellCircle(t,e,i,n,s,r,o,a){const h=o.circle,c=o.seenUids,u=this.boxCells[s];if(null!==u){const t=this.bboxes;for(const e of u)if(!c.box[e]){c.box[e]=!0;const i=4*e;if(this._circleAndRectCollide(h.x,h.y,h.radius,t[i+0],t[i+1],t[i+2],t[i+3])&&(!a||a(this.boxKeys[e])))return r.push(!0),!0}}const l=this.circleCells[s];if(null!==l){const t=this.circles;for(const e of l)if(!c.circle[e]){c.circle[e]=!0;const i=3*e;if(this._circlesCollide(t[i],t[i+1],t[i+2],h.x,h.y,h.radius)&&(!a||a(this.circleKeys[e])))return r.push(!0),!0}}}_forEachCell(t,e,i,n,s,r,o,a){const h=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),u=this._convertToXCellCoord(i),l=this._convertToYCellCoord(n);for(let f=h;f<=u;f++)for(let h=c;h<=l;h++)if(s.call(this,t,e,i,n,this.xCellCount*h+f,r,o,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,i,n,s,r){const o=n-t,a=s-e,h=i+r;return h*h>o*o+a*a}_circleAndRectCollide(t,e,i,n,s,r,o){const a=(r-n)/2,h=Math.abs(t-(n+a));if(h>a+i)return!1;const c=(o-s)/2,u=Math.abs(e-(s+c));if(u>c+i)return!1;if(h<=a||u<=c)return!0;const l=h-a,f=u-c;return l*l+f*f<=i*i}}const qs=100;class Ys{constructor(t,e,i=new Ws(t.width+200,t.height+200,25),n=new Ws(t.width+200,t.height+200,25)){this.transform=t,this.grid=i,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+qs,this.screenBottomBoundary=t.height+qs,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,i,n,s,r,o,a){let h=i.projectedAnchorX,c=i.projectedAnchorY,u=i.projectedAnchorZ;const l=i.elevation,f=i.tileID,d=t.getProjection();if(l&&f){const[t,e,n]=d.upVector(f.canonical,i.tileAnchorX,i.tileAnchorY),s=d.upVectorScale(f.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;h+=t*l*s,c+=e*l*s,u+=n*l*s}const p=this.projectAndGetPerspectiveRatio(o,h,c,u,i.tileID,"globe"===d.name||!!l||this.transform.pitch>0,d),m=r*p.perspectiveRatio,_=(i.x1*e+n.x-i.padding)*m+p.point.x,v=(i.y1*e+n.y-i.padding)*m+p.point.y,g=(i.x2*e+n.x+i.padding)*m+p.point.x,b=(i.y2*e+n.y+i.padding)*m+p.point.y,w=p.perspectiveRatio<=.55||p.occluded;return!this.isInsideGrid(_,v,g,b)||!s&&this.grid.hitTest(_,v,g,b,a)||w?{box:[],offscreen:!1,occluded:p.occluded}:{box:[_,v,g,b],offscreen:this.isOffscreen(_,v,g,b),occluded:!1}}placeCollisionCircles(e,i,n,s,r,o,a,h,c,u,l,f,d,p,m){const _=[],v=this.transform.elevation,g=e.getProjection(),b=v?v.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,g):null,w=new t.P(n.tileAnchorX,n.tileAnchorY);let{x:y,y:x,z:M}=g.projectTilePoint(w.x,w.y,m.canonical);if(b){const[t,e,i]=b(w);y+=t,x+=e,M+=i}const T="globe"===g.name,O=this.projectAndGetPerspectiveRatio(a,y,x,M,m,T||!!v||this.transform.pitch>0,g),{perspectiveRatio:E}=O,A=(l?o/E:o*E)/t.bP,S=Ze(y,x,M,h),k=O.signedDistanceFromCamera>0?ti(A,r,n.lineOffsetX*A,n.lineOffsetY*A,!1,S,w,n,s,h,{},v&&!l?b:null,l&&!!v,g,m,l):null;let I=!1,C=!1,j=!0;if(k&&!O.occluded){const e=.5*d*E+p,n=new t.P(-100,-100),s=new t.P(this.screenRightBoundary,this.screenBottomBoundary),r=new Vs,{first:o,last:a}=k,h=o.path.length;let l=[];for(let t=h-1;t>=1;t--)l.push(o.path[t]);for(let t=1;t<a.path.length;t++)l.push(a.path[t]);const m=2.5*e;c&&(l=l.map((([t,e,i],n)=>(b&&!T&&(i=b(n<h-1?o.tilePath[h-1-n]:a.tilePath[n-h+2])[2]),Ze(t,e,i,c)))),l.some((t=>t[3]<=0))&&(l=[]));let v=[];if(l.length>0){let e=1/0,i=-1/0,r=1/0,o=-1/0;for(const t of l)e=Math.min(e,t[0]),r=Math.min(r,t[1]),i=Math.max(i,t[0]),o=Math.max(o,t[1]);i>=n.x&&e<=s.x&&o>=n.y&&r<=s.y&&(v=[l.map((e=>new t.P(e[0],e[1])))],(e<n.x||i>s.x||r<n.y||o>s.y)&&(v=t.cH(v,n.x,n.y,s.x,s.y)))}for(const t of v){r.reset(t,.25*e);let n=0;n=r.length<=.5*e?1:Math.ceil(r.paddedLength/m)+1;for(let t=0;t<n;t++){const s=t/Math.max(n-1,1),o=r.lerp(s),a=o.x+qs,h=o.y+qs;_.push(a,h,e,0);const c=a-e,l=h-e,d=a+e,p=h+e;if(j=j&&this.isOffscreen(c,l,d,p),C=C||this.isInsideGrid(c,l,d,p),!i&&this.grid.hitTestCircle(a,h,e,f)&&(I=!0,!u))return{circles:[],offscreen:!1,collisionDetected:I,occluded:!1}}}}return{circles:!u&&I||!C?[]:_,offscreen:j,collisionDetected:I,occluded:O.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let n=1/0,s=1/0,r=-1/0,o=-1/0;for(const a of e){const e=new t.P(a.x+qs,a.y+qs);n=Math.min(n,e.x),s=Math.min(s,e.y),r=Math.max(r,e.x),o=Math.max(o,e.y),i.push(e)}const a=this.grid.query(n,s,r,o).concat(this.ignoredGrid.query(n,s,r,o)),h={},c={};for(const e of a){const n=e.key;if(void 0===h[n.bucketInstanceId]&&(h[n.bucketInstanceId]={}),h[n.bucketInstanceId][n.featureIndex])continue;const s=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.cI(i,s)&&(h[n.bucketInstanceId][n.featureIndex]=!0,void 0===c[n.bucketInstanceId]&&(c[n.bucketInstanceId]=[]),c[n.bucketInstanceId].push(n.featureIndex))}return c}insertCollisionBox(t,e,i,n,s){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:n,collisionGroupID:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,i,n,s){const r=e?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:n,collisionGroupID:s};for(let e=0;e<t.length;e+=4)r.insertCircle(o,t[e],t[e+1],t[e+2])}projectAndGetPerspectiveRatio(e,i,n,s,r,o,a){const h=[i,n,s,1];let c=!1;if(s||this.transform.pitch>0){if(t.aB.transformMat4(h,h,e),this.fogState&&r&&"globe"!==a.name){const e=function(e,i,n,s,r,o){const a=o.calculateFogTileMatrix(r),h=[i,n,s];return t.$.transformMat4(h,h,a),te(e,t.$.length(h),o.pitch,o._fov)}(this.fogState,i,n,s,r.toUnwrapped(),this.transform);c=e>.9}}else ai(h,h,e);const u=h[3];return{point:new t.P((h[0]/u+1)/2*this.transform.width+qs,(-h[1]/u+1)/2*this.transform.height+qs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:o&&h[2]>u||c}}isOffscreen(t,e,i,n){return i<qs||t>=this.screenRightBoundary||n<qs||e>this.screenBottomBoundary}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.ae.identity([]);return t.ae.translate(e,e,[-100,-100,0]),e}}class Xs{constructor(t,e,i,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Zs{constructor(t,e,i,n,s,r=!1){this.text=new Xs(t?t.text:null,e,i,s),this.icon=new Xs(t?t.icon:null,e,n,s),this.clipped=r}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Js{constructor(t,e,i,n=!1){this.text=t,this.icon=e,this.skipFade=i,this.clipped=n}}class Ks{constructor(){this.invProjMatrix=t.ae.create(),this.viewportMatrix=t.ae.create(),this.circles=[]}}class Qs{constructor(t,e,i,n,s){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=i,this.bucketIndex=n,this.tileID=s}}class tr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function er(e,i,n,s,r){const{horizontalAlign:o,verticalAlign:a}=t.bS(e),h=-(o-.5)*i,c=-(a-.5)*n,u=t.bR(e,s);return new t.P(h+u[0]*r,c+u[1]*r)}function ir(e,i,n,s,r){const o=new t.P(e,i);return n&&o._rotate(s?r:-r),o}class nr{constructor(t,e,i,n,s,r){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Ys(this.transform,s),this.buildingIndex=r,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new tr(i),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,i,n,s){const r=n.getBucket(i),o=n.latestFeatureIndex;if(!r||!o||i.fqid!==r.layerIds[0])return;const a=r.layers[0].layout,h=n.collisionBoxArray,c=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),u=n.tileSize/t.a4,l=n.tileID.toUnwrapped();this.transform.setProjection(r.projection);const f=(d=n.tileID,p=r.getProjection(),m=this.transform,p.name===this.projection?m.calculateProjMatrix(d.toUnwrapped()):vn(m,p,d));var d,p,m;const _="map"===a.get("text-pitch-alignment"),v="map"===a.get("text-rotation-alignment");i.compileFilter();const g=i.dynamicFilter(),b=i.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(n),y=Ye(f,n.tileID.canonical,_,v,this.transform,r.getProjection(),w);let x=null;if(_){const e=Xe(f,n.tileID.canonical,_,v,this.transform,r.getProjection(),w);x=t.ae.multiply([],this.transform.labelPlaneMatrix,e)}let M=null;g&&n.latestFeatureIndex&&(M={unwrappedTileID:l,dynamicFilter:g,dynamicFilterNeedsFeature:b,featureIndex:n.latestFeatureIndex}),this.retainedQueryData[r.bucketInstanceId]=new Qs(r.bucketInstanceId,o,r.sourceLayerIndex,r.index,n.tileID);const T={bucket:r,layout:a,posMatrix:f,textLabelPlaneMatrix:y,labelToScreenMatrix:x,clippingData:M,scale:c,textPixelRatio:u,holdingForFade:n.holdingForFade(),collisionBoxArray:h,partiallyEvaluatedTextSize:t.aE(r.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.aE(r.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(r.sourceID)};if(s)for(const t of r.sortKeyRanges){const{sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:s}=t;e.push({sortKey:i,symbolInstanceStart:n,symbolInstanceEnd:s,parameters:T})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:r.symbolInstances.length,parameters:T})}attemptAnchorPlacement(t,e,i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v){const{textOffset0:g,textOffset1:b,crossTileID:w}=l,y=[g,b],x=er(t,i,n,y,s),M=this.collisionIndex.placeCollisionBox(d,s,e,ir(x.x,x.y,r,o,this.transform.angle),u,a,h,c.predicate);if(m){const t=d.getSymbolInstanceIconSize(v,this.transform.zoom,l.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(d,t,m,ir(x.x,x.y,r,o,this.transform.angle),u,a,h,c.predicate).box.length)return}if(M.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[w]&&this.prevPlacement.placements[w]&&this.prevPlacement.placements[w].text&&(e=this.prevPlacement.variableOffsets[w].anchor),this.variableOffsets[w]={textOffset:y,width:i,height:n,anchor:t,textScale:s,prevAnchor:e},this.markUsedJustification(d,t,l,p),d.allowVerticalPlacement&&(this.markUsedOrientation(d,p,l),this.placedOrientations[w]=p),{shift:x,placedGlyphBoxes:M}}}placeLayerBucketPart(e,i,n,s){const{bucket:r,layout:o,posMatrix:a,textLabelPlaneMatrix:h,labelToScreenMatrix:c,clippingData:u,textPixelRatio:l,holdingForFade:f,collisionBoxArray:d,partiallyEvaluatedTextSize:p,partiallyEvaluatedIconSize:m,collisionGroup:_}=e.parameters,v=o.get("text-optional"),g=o.get("icon-optional"),b=o.get("text-allow-overlap"),w=o.get("icon-allow-overlap"),y="map"===o.get("text-rotation-alignment"),x="map"===o.get("text-pitch-alignment"),M="viewport-y"===o.get("symbol-z-order"),T=o.get("symbol-z-elevate");this.transform.setProjection(r.projection);let O=b&&(w||!r.hasIconData()||g),E=w&&(b||!r.hasTextData()||v);!r.collisionArrays&&d&&r.deserializeCollisionBoxes(d),n&&s&&r.updateCollisionDebugBuffers(this.transform.zoom,d);const A=(e,s,d)=>{const{crossTileID:M,numVerticalGlyphVertices:T}=e;if(u){const n={zoom:this.transform.zoom,pitch:this.transform.pitch};let s=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[r.bucketInstanceId];s=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(n,s,this.retainedQueryData[r.bucketInstanceId].tileID.canonical,new t.P(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[M]=new Js(!1,!1,!1,!0),void i.add(M)}if(i.has(M))return;if(f)return void(this.placements[M]=new Js(!1,!1,!1));let A=!1,S=!1,k=!0,I=!1,C=!1,j=null,D={box:null,offscreen:null,occluded:null},R={box:null,offscreen:null,occluded:null},P=null,N=null,F=null,z=0,L=0,$=0;d.textFeatureIndex?z=d.textFeatureIndex:e.useRuntimeCollisionCircles&&(z=e.featureIndex),d.verticalTextFeatureIndex&&(L=d.verticalTextFeatureIndex);const U=t=>{t.tileID=this.retainedQueryData[r.bucketInstanceId].tileID;const i=this.transform.elevation;t.elevation=e.zOffset+(i?i.getAtTileOffset(t.tileID,t.tileAnchorX,t.tileAnchorY):0)},B=d.textBox;if(B){U(B);const i=i=>{let n=t.aF.horizontal;if(r.allowVerticalPlacement&&!i&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[M];t&&(this.placedOrientations[M]=t,n=t,this.markUsedOrientation(r,n,e))}return n},n=(e,i)=>{if(r.allowVerticalPlacement&&T>0&&d.verticalTextBox){for(const n of r.writingModes)if(n===t.aF.vertical?(D=i(),R=D):D=e(),D&&D.box&&D.box.length)break}else D=e()};if(o.get("text-variable-anchor")){let h=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[M]){const t=this.prevPlacement.variableOffsets[M];h.indexOf(t.anchor)>0&&(h=h.filter((e=>e!==t.anchor)),h.unshift(t.anchor))}const c=(t,i,n)=>{const o=r.getSymbolInstanceTextSize(p,e,this.transform.zoom,s),c=(t.x2-t.x1)*o+2*t.padding,u=(t.y2-t.y1)*o+2*t.padding,f=e.hasIconTextFit&&!w?i:null;f&&U(f);let d={box:[],offscreen:!1,occluded:!1};const v=b?2*h.length:h.length;for(let i=0;i<v;++i){const v=this.attemptAnchorPlacement(h[i%h.length],t,c,u,o,y,x,l,a,_,i>=h.length,e,s,r,n,f,p,m);if(v&&(d=v.placedGlyphBoxes,d&&d.box&&d.box.length)){A=!0,j=v.shift;break}}return d};n((()=>c(B,d.iconBox,t.aF.horizontal)),(()=>{const e=d.verticalTextBox;return e&&U(e),r.allowVerticalPlacement&&!(D&&D.box&&D.box.length)&&T>0&&e?c(e,d.verticalIconBox,t.aF.vertical):{box:null,offscreen:null,occluded:null}})),D&&(A=D.box,k=D.offscreen,I=D.occluded);const u=i(!(!D||!D.box));if(!A&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[M];t&&(this.variableOffsets[M]=t,this.markUsedJustification(r,t.anchor,e,u))}}else{const o=(i,n)=>{const o=r.getSymbolInstanceTextSize(p,e,this.transform.zoom,s),h=this.collisionIndex.placeCollisionBox(r,o,i,new t.P(0,0),b,l,a,_.predicate);return h&&h.box&&h.box.length&&(this.markUsedOrientation(r,n,e),this.placedOrientations[M]=n),h};n((()=>o(B,t.aF.horizontal)),(()=>{const e=d.verticalTextBox;return r.allowVerticalPlacement&&T>0&&e?(U(e),o(e,t.aF.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(D&&D.box&&D.box.length))}}if(P=D,A=P&&P.box&&P.box.length>0,k=P&&P.offscreen,I=P&&P.occluded,e.useRuntimeCollisionCircles){const i=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),s=t.aG(r.textSizeData,p,i),u=o.get("text-padding");N=this.collisionIndex.placeCollisionCircles(r,b,i,r.lineVertexArray,r.glyphOffsetArray,s,a,h,c,n,x,_.predicate,e.collisionCircleDiameter*s/t.bP,u,this.retainedQueryData[r.bucketInstanceId].tileID),A=b||N.circles.length>0&&!N.collisionDetected,k=k&&N.offscreen,I=N.occluded}if(d.iconFeatureIndex&&($=d.iconFeatureIndex),d.iconBox){const i=i=>{U(i);const n=e.hasIconTextFit&&j?ir(j.x,j.y,y,x,this.transform.angle):new t.P(0,0),s=r.getSymbolInstanceIconSize(m,this.transform.zoom,e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(r,s,i,n,w,l,a,_.predicate)};R&&R.box&&R.box.length&&d.verticalIconBox?(F=i(d.verticalIconBox),S=F.box.length>0):(F=i(d.iconBox),S=F.box.length>0),k=k&&F.offscreen,C=F.occluded}const G=v||0===e.numHorizontalGlyphVertices&&0===T,H=g||0===e.numIconVertices;if(G||H?H?G||(S=S&&A):A=S&&A:S=A=S&&A,A&&P&&P.box&&this.collisionIndex.insertCollisionBox(P.box,o.get("text-ignore-placement"),r.bucketInstanceId,R&&R.box&&L?L:z,_.ID),S&&F&&this.collisionIndex.insertCollisionBox(F.box,o.get("icon-ignore-placement"),r.bucketInstanceId,$,_.ID),N&&(A&&this.collisionIndex.insertCollisionCircles(N.circles,o.get("text-ignore-placement"),r.bucketInstanceId,z,_.ID),n)){const t=r.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new Ks);for(let t=0;t<N.circles.length;t+=4)e.circles.push(N.circles[t+0]),e.circles.push(N.circles[t+1]),e.circles.push(N.circles[t+2]),e.circles.push(N.collisionDetected?1:0)}const V="globe"!==r.projection.name;O=O&&(V||!I),E=E&&(V||!C),this.placements[M]=new Js(A||O,S||E,k||r.justReloaded),i.add(M)};if(T&&this.buildingIndex&&(this.buildingIndex.updateZOffset(r,this.retainedQueryData[r.bucketInstanceId].tileID),r.updateZOffset()),M){const e=r.getSortedSymbolIndexes(this.transform.angle);for(let t=e.length-1;t>=0;--t){const i=e[t];A(r.symbolInstances.get(i),i,r.collisionArrays[i])}r.hasAnyZOffset&&t.w(`${r.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(r.hasAnyZOffset){const t=r.getSortedIndexesByZOffset();for(let e=0;e<t.length;++e){const i=t[e];A(r.symbolInstances.get(i),i,r.collisionArrays[i])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)A(r.symbolInstances.get(t),t,r.collisionArrays[t]);if(n&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];t.ae.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}markUsedJustification(e,i,n,s){const{leftJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:h,crossTileID:c}=n,u=t.cM(i),l=s===t.aF.vertical?h:"left"===u?r:"center"===u?o:"right"===u?a:-1;r>=0&&(e.text.placedSymbolArray.get(r).crossTileID=l>=0&&r!==l?0:c),o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=l>=0&&o!==l?0:c),a>=0&&(e.text.placedSymbolArray.get(a).crossTileID=l>=0&&a!==l?0:c),h>=0&&(e.text.placedSymbolArray.get(h).crossTileID=l>=0&&h!==l?0:c)}markUsedOrientation(e,i,n){const s=i===t.aF.horizontal||i===t.aF.horizontalOnly?i:0,r=i===t.aF.vertical?i:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:c}=n,u=e.text.placedSymbolArray;o>=0&&(u.get(o).placedOrientation=s),a>=0&&(u.get(a).placedOrientation=s),h>=0&&(u.get(h).placedOrientation=s),c>=0&&(u.get(c).placedOrientation=r)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let i=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const n=e?e.symbolFadeChange(t):1,s=e?e.opacities:{},r=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(const t in this.placements){const e=this.placements[t],r=s[t];r?(this.opacities[t]=new Zs(r,n,e.text,e.icon,null,e.clipped),i=i||e.text!==r.text.placed||e.icon!==r.icon.placed):(this.opacities[t]=new Zs(null,n,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const t in s){const e=s[t];if(!this.opacities[t]){const s=new Zs(e,n,!1,!1);s.isHidden()||(this.opacities[t]=s,i=i||e.text.placed||e.icon.placed)}}for(const t in r)this.variableOffsets[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.variableOffsets[t]=r[t]);for(const t in o)this.placedOrientations[t]||!this.opacities[t]||this.opacities[t].isHidden()||(this.placedOrientations[t]=o[t]);i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e,i,n){const s=new Set;for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.fqid===e.layerIds[0]&&(this.updateBucketOpacities(e,s,r.collisionBoxArray,i,n,r.tileID,t.scope),e.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(e,r.tileID),e.updateZOffset()))}}updateBucketOpacities(e,i,n,s,r,o,a){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0].layout,c=!!e.layers[0].dynamicFilter(),u=new Zs(null,0,!1,!1,!0),l=h.get("text-allow-overlap"),f=h.get("icon-allow-overlap"),d=h.get("text-variable-anchor"),p="map"===h.get("text-rotation-alignment"),m="map"===h.get("text-pitch-alignment"),_=new Zs(null,0,l&&(f||!e.hasIconData()||h.get("icon-optional")),f&&(l||!e.hasTextData()||h.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);const v=(t,e,i)=>{for(let n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(i)};let g=0;r&&e.updateReplacement(o,r);for(let n=0;n<e.symbolInstances.length;n++){const h=e.symbolInstances.get(n),{numHorizontalGlyphVertices:l,numVerticalGlyphVertices:f,crossTileID:b,numIconVertices:w,tileAnchorX:y,tileAnchorY:x}=h,M=i.has(b);let T=this.opacities[b];M?T=u:T||(T=_,this.opacities[b]=T),i.add(b);const O=l>0||f>0,E=w>0,A=this.placedOrientations[b],S=A===t.aF.vertical,k=A===t.aF.horizontal||A===t.aF.horizontalOnly;!O&&!E||T.isHidden()||g++;let I=!1;if((O||E)&&r)for(const i of e.activeReplacements){if(t.cJ(i,s,t.cw.Symbol,a))continue;if(i.min.x>y||y>i.max.x||i.min.y>x||x>i.max.y)continue;const e=t.cK(y,x,o.canonical,i.footprintTileId.canonical);if(I=t.cL(e,i),I)break}if(O){const t=I?dr:fr(T.text);v(e.text,l,S?dr:t),v(e.text,f,k?dr:t);const i=T.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:r,verticalPlacedTextSymbolIndex:o}=h,a=e.text.placedSymbolArray,c=i||S?1:0;n>=0&&(a.get(n).hidden=c),s>=0&&(a.get(s).hidden=c),r>=0&&(a.get(r).hidden=c),o>=0&&(a.get(o).hidden=i||k?1:0);const u=this.variableOffsets[b];u&&this.markUsedJustification(e,u.anchor,h,A);const d=this.placedOrientations[b];d&&(this.markUsedJustification(e,"left",h,d),this.markUsedOrientation(e,d,h))}if(E){const t=I?dr:fr(T.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=h,s=e.icon.placedSymbolArray,r=T.icon.isHidden()?1:0;i>=0&&(v(e.icon,w,S?dr:t),s.get(i).hidden=r),n>=0&&(v(e.icon,h.numVerticalIconVertices,k?dr:t),s.get(n).hidden=r)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[n];if(i){let n=new t.P(0,0),s=!0;if(i.textBox||i.verticalTextBox){if(d){const t=this.variableOffsets[b];t?(n=er(t.anchor,t.width,t.height,t.textOffset,t.textScale),p&&n._rotate(m?this.transform.angle:-this.transform.angle)):s=!1}c&&(s=!T.clipped),i.textBox&&sr(e.textCollisionBox.collisionVertexArray,T.text.placed,!s||S,n.x,n.y),i.verticalTextBox&&sr(e.textCollisionBox.collisionVertexArray,T.text.placed,!s||k,n.x,n.y)}const r=s&&Boolean(!k&&i.verticalIconBox);i.iconBox&&sr(e.iconCollisionBox.collisionVertexArray,T.icon.placed,r,h.hasIconTextFit?n.x:0,h.hasIconTextFit?n.y:0),i.verticalIconBox&&sr(e.iconCollisionBox.collisionVertexArray,T.icon.placed,!r,h.hasIconTextFit?n.x:0,h.hasIconTextFit?n.y:0)}}}if(e.fullyClipped=0===g,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const i=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*i>t}setStale(){this.stale=!0}}function sr(t,e,i,n,s){t.emplaceBack(e?1:0,i?1:0,n||0,s||0),t.emplaceBack(e?1:0,i?1:0,n||0,s||0),t.emplaceBack(e?1:0,i?1:0,n||0,s||0),t.emplaceBack(e?1:0,i?1:0,n||0,s||0)}const rr=Math.pow(2,25),or=Math.pow(2,24),ar=Math.pow(2,17),hr=Math.pow(2,16),cr=Math.pow(2,9),ur=Math.pow(2,8),lr=Math.pow(2,1);function fr(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*rr+e*or+i*ar+e*hr+i*cr+e*ur+i*lr+e}const dr=0;class pr{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,e,i,n,s){const r=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(r,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,s())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,r.sort(((t,e)=>t.sortKey-e.sortKey)));this._currentPartIndex<r.length;){const t=r[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,i,0===t.symbolInstanceStart),this._currentPartIndex++,s())return!0}return!1}}class mr{constructor(t,e,i,n,s,r,o,a,h){this.placement=new nr(t,s,r,o,a,h),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(e,i,n,s){const r=t.e.now(),o=()=>{const e=t.e.now()-r;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const r=i[e[this._currentPlacementIndex]],a=this.placement.collisionIndex.transform.zoom;if("symbol"===r.type&&(!r.minzoom||r.minzoom<=a)&&(!r.maxzoom||r.maxzoom>a)){const e=r,i=e.layout.get("symbol-z-elevate"),a=this._inProgressLayer=this._inProgressLayer||new pr(e),h=t.am(r.source,r.scope);if(a.continuePlacement(i?s[h]:n[h],this.placement,this._showCollisionBoxes,r,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const _r=512/t.a4/2;class vr{constructor(e,i,n){this.tileID=e,this.bucketInstanceId=n,this.index=new t.cN(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const s=e.canonical.x*t.a4,r=e.canonical.y*t.a4;for(let t=0;t<i.length;t++){const{key:e,crossTileID:n,tileAnchorX:o,tileAnchorY:a}=i.get(t),h=Math.floor((s+o)*_r),c=Math.floor((r+a)*_r);this.index.add(h,c),this.keys.push(e),this.crossTileIDs.push(n)}this.index.finish()}findMatches(e,i,n){const s=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),r=_r/Math.pow(2,i.canonical.z-this.tileID.canonical.z),o=i.canonical.x*t.a4,a=i.canonical.y*t.a4;for(let t=0;t<e.length;t++){const i=e.get(t);if(i.crossTileID)continue;const{key:h,tileAnchorX:c,tileAnchorY:u}=i,l=Math.floor((o+c)*r),f=Math.floor((a+u)*r),d=this.index.range(l-s,f-s,l+s,f+s);for(const t of d){const e=this.crossTileIDs[t];if(this.keys[t]===h&&!n.has(e)){n.add(e),i.crossTileID=e;break}}}}}class gr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class br{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const t in this.indexes){const i=this.indexes[t],n={};for(const t in i){const s=i[t];s.tileID=s.tileID.unwrapTo(s.tileID.wrap+e),n[s.tileID.key]=s}this.indexes[t]=n}this.lng=t}addBucket(t,e,i){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let t=0;t<e.symbolInstances.length;t++)e.symbolInstances.get(t).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const n=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const s=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in s){const r=s[i];r.tileID.isChildOf(t)&&r.findMatches(e.symbolInstances,t,n)}else{const r=s[t.scaledTo(Number(i)).key];r&&r.findMatches(e.symbolInstances,t,n)}}for(let t=0;t<e.symbolInstances.length;t++){const s=e.symbolInstances.get(t);s.crossTileID||(s.crossTileID=i.generate(),n.add(s.crossTileID))}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new vr(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const i of e.crossTileIDs)this.usedCrossTileIDs[t].delete(i)}removeStaleBuckets(t){let e=!1;for(const i in this.indexes){const n=this.indexes[i];for(const s in n)t[n[s].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,n[s]),delete n[s],e=!0)}return e}}class wr{constructor(){this.layerIndexes={},this.crossTileIDs=new gr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,i,n){let s=this.layerIndexes[t.fqid];void 0===s&&(s=this.layerIndexes[t.fqid]=new br);let r=!1;const o={};"globe"!==n.name&&s.handleWrapJump(i);for(const i of e){const e=i.getBucket(t);e&&t.fqid===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),s.addBucket(i.tileID,e,this.crossTileIDs)&&(r=!0),o[e.bucketInstanceId]=!0)}return s.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(t){const e={};t.forEach((t=>{e[t]=!0}));for(const t in this.layerIndexes)e[t]||delete this.layerIndexes[t]}}const yr=new t.U({data:new t.W(t.N.colorTheme.data)}),xr=(t,e)=>Wt(t,e&&e.filter((t=>"source.canvas"!==t.identifier))),Mr=t.ai(Fs,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Tr=t.ai(Fs,["setCenter","setZoom","setBearing","setPitch"]),Or={version:8,layers:[],sources:{}},Er={duration:300,delay:0};class Ar extends t.E{constructor(e,i={}){super(),this.map=e,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=t.Q({},Er),this._buildingIndex=new Rs(this),this.crossTileSymbolIndex=new wr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new v,this.dispatcher=i.dispatcher?i.dispatcher:new t.by(t.bz(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new ht,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new t.cP(e._requestManager,i.localFontFamily?t.cQ.all:i.localIdeographFontFamily?t.cQ.ideographs:t.cQ.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new ot(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",t.cR());const n=this;this._rtlTextPluginCallback=Ar.registerForPluginStateChange((e=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},((e,i)=>{if(t.cS(e),i&&i.every((t=>t)))for(const t in n._sourceCaches){const e=n._sourceCaches[t],i=e.getSource().type;"vector"!==i&&"geojson"!==i||e.reload()}}))})),this.on("data",(t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getOwnSource(t.sourceId);if(e&&e.vectorLayerIds)for(const t in this._layers){const i=this._layers[t];i.source===e.id&&this._validateLayer(i)}}))}load(t){return t?("string"==typeof t?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(e){if(!e)return null;if("string"==typeof e){if(t.cT(e))return e;const i=t.cU(e);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch(t){return i}return i}return`json://${t.cV(JSON.stringify(e))}`}_diffStyle(e,i,n){this.globalId=this._getGlobalId(e);const s=(t,e)=>{try{e(null,this.setState(t,n))}catch(t){e(t,!1)}};if("string"==typeof e){const n=this.map._requestManager.normalizeStyleURL(e),r=this.map._requestManager.transformRequest(n,t.R.Style);t.h(r,((e,n)=>{e?this.fire(new t.f(e)):n&&s(n,i)}))}else"object"==typeof e&&s(e,i)}loadURL(e,i={}){this.fire(new t.g("dataloading",{dataType:"style"}));const n="boolean"==typeof i.validate?i.validate:!t.cT(e);this.globalId=this._getGlobalId(e),e=this.map._requestManager.normalizeStyleURL(e,i.accessToken),this.resolvedImports.add(e);const s=this.importsCache.get(e);if(s)return this._load(s,n);const r=this.map._requestManager.transformRequest(e,t.R.Style);this._request=t.h(r,((i,s)=>{if(this._request=null,i)this.fire(new t.f(i));else if(s)return this.importsCache.set(e,s),this._load(s,n)}))}loadJSON(e,i={}){this.fire(new t.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(e),this._request=t.e.frame((()=>{this._request=null,this._load(e,!1!==i.validate)}))}loadEmpty(){this.fire(new t.g("dataloading",{dataType:"style"})),this._load(Or,!1)}_loadImports(e,i,n){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const s=[];for(const t of e){const e=this._createFragmentStyle(t),r=new Promise((t=>{e.once("style.import.load",t),e.once("error",t)})).then((()=>this.mergeAll()));if(s.push(r),this.resolvedImports.has(t.url)){e.loadEmpty();continue}const o=t.data||this.importsCache.get(t.url);o?(e.loadJSON(o,{validate:i}),this._isInternalStyle(o)&&(e.globalId=null)):t.url?e.loadURL(t.url,{validate:i}):e.loadEmpty();const a={style:e,id:t.id,config:t.config};if(n){const t=this.fragments.findIndex((({id:t})=>t===n));this.fragments=this.fragments.slice(0,t).concat(a).concat(this.fragments.slice(t))}else this.fragments.push(a)}return Promise.allSettled(s)}getImportGlobalIds(t=this,e=new Set){for(const i of t.fragments)i.style.globalId&&e.add(i.style.globalId),this.getImportGlobalIds(i.style,e);return[...e.values()]}_createFragmentStyle(e){const i=this.scope?t.am(e.id,this.scope):e.id;let n;const s=this._initialConfig&&this._initialConfig[i];(e.config||s)&&(n=t.Q({},e.config,s));const r=new Ar(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n,configOptions:this.options,configDependentLayers:this._configDependentLayers});return r.setEventedParent(this.map,{style:r}),r}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&!1!==t.fragment)}_load(e,i){const n=e.schema;if(this._isInternalStyle(e)){const n=t.Q({},Or,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(n,i)}if(this.updateConfig(this._config,n),i&&xr(this,Rt(e)))return;this._loaded=!0,this.stylesheet=t.cW(e);const s=()=>{for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);const n=Ns(this.stylesheet.layers);if(this._order=n.map((t=>t.id)),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const t=this.stylesheet.lights[0];this.light=new Yt(t.properties,t.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Yt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const e of n){const i=t.c$(e,this.scope,this._styleColorTheme.lut,this.options);0!==i.configDependencies.size&&this._configDependentLayers.add(i.fqid),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize();const n=this.getOwnLayerSourceCache(i),s=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&i.canCastShadows()&&s&&(n.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const s=this.stylesheet.terrain;s&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(s,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.g("data",{dataType:"style"}));const r=this.isRootStyle();e.imports?this._loadImports(e.imports,i).then((()=>{this._reloadImports(),this.fire(new t.g(r?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new t.g(r?"style.load":"style.import.load")))},r=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=r,r){const e=this._evaluateColorThemeData(r);this._loadColorTheme(e).then((()=>{s()})).catch((e=>{t.w(`Couldn't load color theme from the stylesheet: ${e}`),s()}))}else this._styleColorTheme.lut=null,s()}isRootStyle(){return 0===this.importDepth}mergeAll(){let e,i,n,s,r,o,a,h;const c={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{if(t.stylesheet){if(null!=t.light&&(e=t.light),t.stylesheet.lights)for(const e of t.stylesheet.lights)"ambient"===e.type&&null!=t.ambientLight&&(i=t.ambientLight),"directional"===e.type&&null!=t.directionalLight&&(n=t.directionalLight);s=this._prioritizeTerrain(s,t.terrain,t.stylesheet.terrain),t.stylesheet.fog&&null!=t.fog&&(r=t.fog),null!=t.stylesheet.camera&&(h=t.stylesheet.camera),null!=t.stylesheet.projection&&(o=t.stylesheet.projection),null!=t.stylesheet.transition&&(a=t.stylesheet.transition),c[t.scope]=t._styleColorTheme}})),this.light=e,this.ambientLight=i,this.directionalLight=n,this.fog=r,this._styleColorThemeForScope=c,null===s?delete this.terrain:this.terrain=s,this.camera=h||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=t.Q({},Er,a),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const e=i=>{for(const t of i.fragments)e(t.style);t(i)};e(this)}_prioritizeTerrain(t,e,i){const n=t&&0===t.drapeRenderMode;return null===i?e&&0===e.drapeRenderMode?e:n?t:null:null!=e&&(!t||n||e&&1===e.drapeRenderMode)?e:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{t=this._prioritizeTerrain(t,e.terrain,e.stylesheet.terrain)})),null===t?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((e=>{null!=e.stylesheet.projection&&(t=e.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const e={},i={},n={};this.forEachFragmentStyle((s=>{for(const i in s._sourceCaches){const n=t.am(i,s.scope);e[n]=s._sourceCaches[i]}for(const e in s._otherSourceCaches){const n=t.am(e,s.scope);i[n]=s._otherSourceCaches[e]}for(const e in s._symbolSourceCaches){const i=t.am(e,s.scope);n[i]=s._symbolSourceCaches[e]}})),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=n}mergeLayers(){const e={},i=[],n={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((n=>{for(const s of n._order){const r=n._layers[s];if("slot"===r.type){const i=t.cX(s);if(e[i])continue;e[i]=[]}r.slot&&e[r.slot]?e[r.slot].push(r):i.push(r)}})),this._mergedOrder=[],this._clipLayerIndices=[];let s=0;const r=(i=[])=>{for(const o of i)if("slot"===o.type){const i=t.cX(o.id);e[i]&&r(e[i]),this._mergedSlots.push(i)}else{const e=t.am(o.id,o.scope);this._mergedOrder.push(e),n[e]=o,o.is3D()&&(this._has3DLayers=!0),"circle"===o.type&&(this._hasCircleLayers=!0),"symbol"===o.type&&(this._hasSymbolLayers=!0),"clip"===o.type&&this._clipLayerIndices.push(s),s++}};r(i),this._mergedOrder.sort(((t,e)=>{const i=n[t],s=n[e];return i.hasInitialOcclusionOpacityProperties?s.is3D()?1:0:i.is3D()&&s.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=t.Q({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(e){return e.data?function(e,i,n){const s=t.Q({},i);for(const e of Object.keys(t.N.colorTheme))void 0===s[e]&&(s[e]=t.N.colorTheme[e].default);const r=new t.O(yr,e,new Map(n));return r.setTransitionOrValue(s,n),r.untransitioned().possiblyEvaluate(new t.Y(0))}(this.scope,e,this.options).get("data"):null}_loadColorTheme(e){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const i=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((n,s)=>{const r="data:image/png;base64,";if(!e||0===e.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void n();let o=e;o.startsWith(r)||(o=r+o);const a="mapbox-reserved-lut",h=new Image;h.src=o,h.onerror=()=>{this._styleColorTheme.lutLoading=!1,s(new Error("Failed to load image data"))},h.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==i)return void n();this._styleColorTheme.lutLoading=!1;const{width:r,height:o,data:c}=t.e.getImageData(h);if(o>32)return void s(new Error("The height of the image must be less than or equal to 32 pixels."));if(r!==o*o)return void s(new Error("The width of the image must be equal to the height squared."));this.getImage(a)&&this.removeImage(a),this.addImage(a,{data:new t.j({width:r,height:o},c),pixelRatio:1,sdf:!1,version:0});const u=this.imageManager.getImage(a,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:e},n()):s(new Error("Missing LUT image."))}}))}getLut(t){const e=this._styleColorThemeForScope[t];return e?e.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(e,i,n){let s,r,o;const a=t.e.devicePixelRatio>1?"@2x":"";let h=t.h(i.transformRequest(i.normalizeSpriteURL(e,a,".json"),t.R.SpriteJSON),((t,e)=>{h=null,o||(o=t,s=e,u())})),c=t.i(i.transformRequest(i.normalizeSpriteURL(e,a,".png"),t.R.SpriteImage),((t,e)=>{c=null,o||(o=t,r=e,u())}));function u(){if(o)n(o);else if(s&&r){const e=t.e.getImageData(r),i={};for(const n in s){const{width:r,height:o,x:a,y:h,sdf:c,pixelRatio:u,stretchX:l,stretchY:f,content:d}=s[n],p=new t.j({width:r,height:o});t.j.copy(e,p,{x:a,y:h},{x:0,y:0},{width:r,height:o},null),i[n]={data:p,pixelRatio:u,sdf:c,stretchX:l,stretchY:f,content:d}}n(null,i)}}return{cancel(){h&&(h.cancel(),h=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,((e,i)=>{if(this._spriteRequest=null,e)this.fire(new t.f(e));else if(i)for(const t in i)this.imageManager.addImage(t,this.scope,i[t]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.g("data",{dataType:"style"}))}))}_validateLayer(e){const i=this.getOwnSource(e.source);if(!i)return;const n=e.sourceLayer;n&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.f(new Error(`Source layer "${n}" does not exist on source "${i.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,e)=>{const i=this.fragments[e];return i&&i.style&&(t.data=i.style.serialize()),t}))}_serializeSources(){const t={};for(const e in this._sourceCaches){const i=this._sourceCaches[e].getSource();t[i.id]||(t[i.id]=i.serialize())}return t}_serializeLayers(t){const e=[];for(const i of t){const t=this._layers[i];t&&"custom"!==t.type&&e.push(t.serialize())}return e}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){const i=this.getOwnLayer(e);if(i)return i;this.fire(new t.f(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){const i=this.getOwnSource(e);if(i)return i;this.fire(new t.f(new Error(`The source '${e}' does not exist in the map's style.`)))}precompilePrograms(t,e){const i=this.map.painter;if(i)for(let n=t.minzoom||0;n<(t.maxzoom||25.5);n++){const n=t.getProgramIds();if(n)for(const s of n){const n=t.getDefaultProgramParams(s,e.zoom,this._styleColorTheme.lut);n&&(i.style=this,this.fog&&(i._fogVisible=!0,n.overrideFog=!0,i.getOrCreateProgram(s,n)),i._fogVisible=!1,n.overrideFog=!1,i.getOrCreateProgram(s,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,i.getOrCreateProgram(s,n)))}}}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);const i=this.calculateLightsBrightness();e.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const n=this._changes.isDirty();let s=!1;if(this._changes.isDirty()){const t=this._changes.getLayerUpdatesByScope();for(const e in t){const{updatedIds:i,removedIds:n}=t[e];(i||n)&&(this._updateWorkerLayers(e,i,n),s=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}const r={};for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t];r[t]=e.used,e.used=!1,e.tileCoverLift=0}for(const t of this._mergedOrder){const i=this._mergedLayers[t];if(i.recalculate(e,this._availableImages),!i.isHidden(e.zoom)){const t=this.getLayerSourceCache(i);t&&(t.used=!0,t.tileCoverLift=Math.max(t.tileCoverLift,i.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(i,e)})):this.precompilePrograms(i,e))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&s&&this.mergeLayers();for(const e in r){const i=this._mergedSourceCaches[e];r[e]!==i.used&&i.getSource().fire(new t.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:i.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new t.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,e,i){const n=this.getFragmentStyle(t);n&&this.dispatcher.broadcast("updateLayers",{layers:e?n._serializeLayers(e):[],scope:t,removedIds:i||[],options:n.options})}setState(e,i){if(this._checkLoaded(),xr(this,Rt(e)))return!1;(e=t.cW(e)).layers=Ns(e.layers);const n=function(e,i){if(!e)return[{command:Fs.setStyle,args:[i]}];let n=[];try{if(!t.d(e.version,i.version))return[{command:Fs.setStyle,args:[i]}];if(t.d(e.center,i.center)||n.push({command:Fs.setCenter,args:[i.center]}),t.d(e.zoom,i.zoom)||n.push({command:Fs.setZoom,args:[i.zoom]}),t.d(e.bearing,i.bearing)||n.push({command:Fs.setBearing,args:[i.bearing]}),t.d(e.pitch,i.pitch)||n.push({command:Fs.setPitch,args:[i.pitch]}),t.d(e.sprite,i.sprite)||n.push({command:Fs.setSprite,args:[i.sprite]}),t.d(e.glyphs,i.glyphs)||n.push({command:Fs.setGlyphs,args:[i.glyphs]}),t.d(e.imports,i.imports)||function(e=[],i=[],n){i=i||[];const s=(e=e||[]).map(Gs),r=i.map(Gs),o=e.reduce(Hs,{}),a=i.reduce(Hs,{}),h=s.slice();let c,u,l,f;for(c=0,u=0;c<s.length;c++)l=s[c],a.hasOwnProperty(l)?u++:(n.push({command:Fs.removeImport,args:[l]}),h.splice(h.indexOf(l,u),1));for(c=0,u=0;c<r.length;c++)l=r[r.length-1-c],h[h.length-1-c]!==l&&(o.hasOwnProperty(l)?(n.push({command:Fs.removeImport,args:[l]}),h.splice(h.lastIndexOf(l,h.length-u),1)):u++,f=h[h.length-c],n.push({command:Fs.addImport,args:[a[l],f]}),h.splice(h.length-c,0,l));for(const e of i){const i=o[e.id];i&&!t.d(i,e)&&n.push({command:Fs.updateImport,args:[e.id,e]})}}(e.imports,i.imports,n),t.d(e.transition,i.transition)||n.push({command:Fs.setTransition,args:[i.transition]}),t.d(e.light,i.light)||n.push({command:Fs.setLight,args:[i.light]}),t.d(e.fog,i.fog)||n.push({command:Fs.setFog,args:[i.fog]}),t.d(e.projection,i.projection)||n.push({command:Fs.setProjection,args:[i.projection]}),t.d(e.lights,i.lights)||n.push({command:Fs.setLights,args:[i.lights]}),t.d(e.camera,i.camera)||n.push({command:Fs.setCamera,args:[i.camera]}),!t.d(e["color-theme"],i["color-theme"]))return[{command:Fs.setStyle,args:[i]}];const s={},r=[];!function(e,i,n,s){let r;for(r in i=i||{},e=e||{})e.hasOwnProperty(r)&&(i.hasOwnProperty(r)||Ls(r,n,s));for(r in i){if(!i.hasOwnProperty(r))continue;const o=i[r];e.hasOwnProperty(r)?t.d(e[r],o)||("geojson"===e[r].type&&"geojson"===o.type&&Us(e,i,r)?n.push({command:Fs.setGeoJSONSourceData,args:[r,o.data]}):$s(r,i,n,s)):zs(r,i,n)}}(e.sources,i.sources,r,s);const o=[];e.layers&&e.layers.forEach((t=>{t.source&&s[t.source]?n.push({command:Fs.removeLayer,args:[t.id]}):o.push(t)}));let a=e.terrain;a&&s[a.source]&&(n.push({command:Fs.setTerrain,args:[void 0]}),a=void 0),n=n.concat(r),t.d(a,i.terrain)||n.push({command:Fs.setTerrain,args:[i.terrain]}),function(e,i,n){i=i||[];const s=(e=e||[]).map(Gs),r=i.map(Gs),o=e.reduce(Hs,{}),a=i.reduce(Hs,{}),h=s.slice(),c=Object.create(null);let u,l,f,d,p,m,_;for(u=0,l=0;u<s.length;u++)f=s[u],a.hasOwnProperty(f)?l++:(n.push({command:Fs.removeLayer,args:[f]}),h.splice(h.indexOf(f,l),1));for(u=0,l=0;u<r.length;u++)f=r[r.length-1-u],h[h.length-1-u]!==f&&(o.hasOwnProperty(f)?(n.push({command:Fs.removeLayer,args:[f]}),h.splice(h.lastIndexOf(f,h.length-l),1)):l++,m=h[h.length-u],n.push({command:Fs.addLayer,args:[a[f],m]}),h.splice(h.length-u,0,f),c[f]=!0);for(u=0;u<r.length;u++)if(f=r[u],d=o[f],p=a[f],!c[f]&&!t.d(d,p))if(t.d(d.source,p.source)&&t.d(d["source-layer"],p["source-layer"])&&t.d(d.type,p.type)){for(_ in Bs(d.layout,p.layout,n,f,null,Fs.setLayoutProperty),Bs(d.paint,p.paint,n,f,null,Fs.setPaintProperty),t.d(d.slot,p.slot)||n.push({command:Fs.setSlot,args:[f,p.slot]}),t.d(d.filter,p.filter)||n.push({command:Fs.setFilter,args:[f,p.filter]}),t.d(d.minzoom,p.minzoom)&&t.d(d.maxzoom,p.maxzoom)||n.push({command:Fs.setLayerZoomRange,args:[f,p.minzoom,p.maxzoom]}),d)d.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&"slot"!==_&&(0===_.indexOf("paint.")?Bs(d[_],p[_],n,f,_.slice(6),Fs.setPaintProperty):t.d(d[_],p[_])||n.push({command:Fs.setLayerProperty,args:[f,_,p[_]]}));for(_ in p)p.hasOwnProperty(_)&&!d.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&"slot"!==_&&(0===_.indexOf("paint.")?Bs(d[_],p[_],n,f,_.slice(6),Fs.setPaintProperty):t.d(d[_],p[_])||n.push({command:Fs.setLayerProperty,args:[f,_,p[_]]}))}else n.push({command:Fs.removeLayer,args:[f]}),m=h[h.lastIndexOf(f)+1],n.push({command:Fs.addLayer,args:[p,m]})}(o,i.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Fs.setStyle,args:[i]}]}return n}(this.serialize(),e).filter((t=>!(t.command in Tr)));if(0===n.length)return!1;const s=n.filter((t=>!(t.command in Mr)));if(s.length>0)throw new Error(`Unimplemented: ${s.map((t=>t.command)).join(", ")}.`);const r=[];return n.forEach((t=>{r.push(this[t.command].apply(this,t.args))})),i&&Promise.all(r).then(i),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,i){return this.getImage(e)?this.fire(new t.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,i),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,this.scope,e)}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new t.f(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,e,i={}){return this._checkLoaded(),this._validate(Ht,`models.${t}`,e,null,i)||(this.modelManager.addModel(t,e,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new t.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,i,n={}){if(this._checkLoaded(),void 0!==this.getOwnSource(e))throw new Error(`There is already a source with ID "${e}".`);if(!i.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(i).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(Pt,`sources.${e}`,i,null,n))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const s=Ii(e,i,this.dispatcher,this);s.scope=this.scope,s.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(s.id),source:s.serialize(),sourceId:s.id})));const r=e=>{const i=(e?"symbol:":"other:")+s.id,n=t.am(i,this.scope),r=this._sourceCaches[i]=new t.bx(n,s,e);(e?this._symbolSourceCaches:this._otherSourceCaches)[s.id]=r,r.onAdd(this.map)};r(!1),"vector"!==i.type&&"geojson"!==i.type||r(!0),s.onAdd&&s.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();const i=this.getOwnSource(e);if(!i)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.f(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new t.f(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const n=this.getOwnSourceCaches(e);for(const e of n){const i=t.cX(e.id);delete this._sourceCaches[i],this._changes.discardSourceCacheUpdate(e.id),e.fire(new t.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:e.getSource().id})),e.setEventedParent(null),e.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getOwnSource(t).setData(e),this._changes.setDirty()}getOwnSource(t){const e=this.getOwnSourceCache(t);return e&&e.getSource()}getOwnSources(){const t=[];for(const e in this._otherSourceCaches){const i=this.getOwnSourceCache(e);i&&t.push(i.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const e in t){const i=t[e]._tiles;for(const t in i){const e=i[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const n of e){if(this._validate(Ft,"lights",n))return;switch(n.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(n),t.updateTransitions(i)}else this.ambientLight=new oe(n,ae||(ae=new t.U({color:new t.W(t.N.properties_light_ambient.color),intensity:new t.W(t.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(n),t.updateTransitions(i)}else this.directionalLight=new oe(n,he||(he=new t.U({direction:new t.a6(t.N.properties_light_directional.direction),color:new t.W(t.N.properties_light_directional.color),intensity:new t.W(t.N.properties_light_directional.intensity),"cast-shadows":new t.W(t.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new t.W(t.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const n=new t.Y(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const e=this.directionalLight,i=this.ambientLight;if(!e||!i)return;const n=t=>.2126*(t[0]<=.03928?t[0]/12.92:Math.pow((t[0]+.055)/1.055,2.4))+.7152*(t[1]<=.03928?t[1]/12.92:Math.pow((t[1]+.055)/1.055,2.4))+.0722*(t[2]<=.03928?t[2]/12.92:Math.pow((t[2]+.055)/1.055,2.4)),s=e.properties.get("color").toRenderColor(null).toArray01(),r=e.properties.get("intensity"),o=e.properties.get("direction"),a=1-t.ad(o.x,o.y,o.z)[2]/90,h=n(s)*r*a,c=i.properties.get("color").toRenderColor(null).toArray01(),u=i.properties.get("intensity");return(h+n(c)*u)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(t.cY(e)){const i=t.cZ(e),n=this.fragments.find((({id:t})=>t===i));if(!n)throw new Error(`Style import not found: ${e}`);const s=t.cX(e);return n.style.getFragmentStyle(s)}{const t=this.fragments.find((({id:t})=>t===e));if(!t)throw new Error(`Style import not found: ${e}`);return t.style}}getConfigProperty(e,i){const n=this.getFragmentStyle(e);if(!n)return null;const s=t.am(i,n.scope),r=n.options.get(s),o=r?r.value||r.default:null;return o?o.serialize():null}setConfigProperty(e,i,n){const s=this.getFragmentStyle(e);if(!s)return;const r=s.stylesheet.schema;if(!r||!r[i])return;const o=t.z(n);if("success"!==o.result)return void xr(this,o.value);const a=o.value.expression,h=t.am(i,s.scope),c=s.options.get(h);if(!c)return;let u;const{minValue:l,maxValue:f,stepValue:d,type:p,values:m}=r[i],_=t.z(r[i].default);"success"===_.result&&(u=_.value.expression),u?(this.options.set(h,{...c,value:a,default:u,minValue:l,maxValue:f,stepValue:d,type:p,values:m}),this.updateConfigDependencies(i)):this.fire(new t.f(new Error(`No schema defined for the config option "${i}" in the "${e}" fragment.`)))}getConfig(e){const i=this.getFragmentStyle(e);if(!i)return null;const n=i.stylesheet.schema;if(!n)return null;const s={};for(const e in n){const n=t.am(e,i.scope),r=i.options.get(n),o=r?r.value||r.default:null;s[e]=o?o.serialize():null}return s}setConfig(t,e){const i=this.getFragmentStyle(t);i&&(i.updateConfig(e,i.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const e=this.getFragmentStyle(t);return e?e.stylesheet.schema:null}setSchema(t,e){const i=this.getFragmentStyle(t);i&&(i.stylesheet.schema=e,i.updateConfig(i._config,e),this.updateConfigDependencies())}updateConfig(e,i){if(this._config=e,e||i)if(i)for(const n in i){let s,r;const o=t.z(i[n].default);if("success"===o.result&&(s=o.value.expression),e&&void 0!==e[n]){const i=t.z(e[n]);"success"===i.result&&(r=i.value.expression)}const{minValue:a,maxValue:h,stepValue:c,type:u,values:l}=i[n];if(s){const e=t.am(n,this.scope);this.options.set(e,{default:s,value:r,minValue:a,maxValue:h,stepValue:c,type:u,values:l})}else this.fire(new t.f(new Error(`No schema defined for config option "${n}".`)))}else this.fire(new t.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const e of this._configDependentLayers){const i=this.getLayer(e);if(i){if(t&&!i.configDependencies.has(t))continue;i.possiblyEvaluateVisibility(),this._updateLayer(i)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle((t=>{if(t._styleColorTheme.colorTheme){const e=t._evaluateColorThemeData(t._styleColorTheme.colorTheme);(!t._styleColorTheme.lut&&""!==e||t._styleColorTheme.lut&&e!==t._styleColorTheme.lut.data)&&t.setColorTheme(t._styleColorTheme.colorTheme)}})),this._changes.setDirty()}addLayer(e,i,n={}){this._checkLoaded();const s=e.id;if(this._layers[s])return void this.fire(new t.f(new Error(`Layer with id "${s}" already exists on this map`)));let r;if("custom"===e.type){if(xr(this,t.c_(e)))return;r=t.c$(e,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof e.source&&(this.addSource(s,e.source),e=t.cW(e),e=t.Q(e,{source:s})),this._validate($t,`layers.${s}`,e,{arrayIndex:-1},n))return;r=t.c$(e,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(r),r.setEventedParent(this,{layer:{id:s}}),this._serializedLayers[r.id]=r.serialize()}0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid);let o=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.f(new Error(`Layer with id "${i}" does not exist on this map.`)));r.slot===this._layers[i].slot?o=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,s),this._layerOrderChanged=!0,this._layers[s]=r;const a=this.getOwnLayerSourceCache(r),h=!!this.directionalLight&&this.directionalLight.shadowsEnabled();a&&r.canCastShadows()&&h&&(a.castsShadows=!0);const c=this._changes.getRemovedLayer(r);if(c&&r.source&&a&&"custom"!==r.type){this._changes.discardLayerRemoval(r);const e=t.am(r.source,r.scope);c.type!==r.type?this._changes.updateSourceCache(e,"clear"):(this._changes.updateSourceCache(e,"reload"),a.pause())}this._updateLayer(r),r.onAdd&&r.onAdd(this.map),r.scope=this.scope,this.mergeLayers()}moveLayer(e,i){this._checkLoaded();const n=this._checkLayer(e);if(!n)return;if(e===i)return;const s=this._order.indexOf(e);this._order.splice(s,1);let r=this._order.length;if(i){const e=this._order.indexOf(i);if(-1===e)return void this.fire(new t.f(new Error(`Layer with id "${i}" does not exist on this map.`)));n.slot===this._layers[i].slot?r=e:t.w(`Layer with id "${i}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(r,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const e=this._checkLayer(t);if(!e)return;e.setEventedParent(null);const i=this._order.indexOf(t);this._order.splice(i,1),delete this._layers[t],delete this._serializedLayers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(e.fqid),this._changes.removeLayer(e);const n=this.getOwnLayerSourceCache(e);if(n&&n.castsShadows){let t=!1;for(const i in this._layers)if(this._layers[i].source===e.source&&this._layers[i].canCastShadows()){t=!0;break}n.castsShadows=t}e.onRemove&&e.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(t,e,i){this._checkLoaded();const n=this._checkLayer(t);n&&(n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,e){this._checkLoaded();const i=this._checkLayer(t);i&&i.slot!==e&&(i.slot=e,this._updateLayer(i))}setFilter(e,i,n={}){this._checkLoaded();const s=this._checkLayer(e);if(s&&!t.d(s.filter,i))return null==i?(s.filter=void 0,void this._updateLayer(s)):void(this._validate(Ut,`layers.${s.id}.filter`,i,{layerType:s.type},n)||(s.filter=t.cW(i),this._updateLayer(s)))}getFilter(e){const i=this._checkLayer(e);if(i)return t.cW(i.filter)}setLayoutProperty(e,i,n,s={}){this._checkLoaded();const r=this._checkLayer(e);if(r&&!t.d(r.getLayoutProperty(i),n)){if(null!=n&&(!s||!1!==s.validate)&&xr(r,Gt.call(Rt,{key:`layers.${e}.layout.${i}`,layerType:r.type,objectKey:i,value:n,styleSpec:t.N,style:{glyphs:!0,sprite:!0}})))return;r.setLayoutProperty(i,n),0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid),this._updateLayer(r)}}getLayoutProperty(t,e){const i=this._checkLayer(t);if(i)return i.getLayoutProperty(e)}setPaintProperty(e,i,n,s={}){this._checkLoaded();const r=this._checkLayer(e);if(!r)return;if(t.d(r.getPaintProperty(i),n))return;if(null!=n&&(!s||!1!==s.validate)&&xr(r,Bt.call(Rt,{key:`layers.${e}.paint.${i}`,layerType:r.type,objectKey:i,value:n,styleSpec:t.N})))return;const o=r.setPaintProperty(i,n);0!==r.configDependencies.size&&this._configDependentLayers.add(r.fqid),o&&this._updateLayer(r),this._changes.updatePaintProperties(r)}getPaintProperty(t,e){const i=this._checkLayer(t);if(i)return i.getPaintProperty(e)}setFeatureState(e,i){this._checkLoaded();const n=e.source,s=e.sourceLayer,r=this._checkSource(n);if(!r)return;const o=r.type;if("geojson"===o&&s)return void this.fire(new t.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!s)return void this.fire(new t.f(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.f(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(n);for(const t of a)t.setFeatureState(s,e.id,i)}removeFeatureState(e,i){this._checkLoaded();const n=e.source,s=this._checkSource(n);if(!s)return;const r=s.type,o="vector"===r?e.sourceLayer:void 0;if("vector"===r&&!o)return void this.fire(new t.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.f(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(n);for(const t of a)t.removeFeatureState(o,e.id,i)}getFeatureState(e){this._checkLoaded();const i=e.source,n=e.sourceLayer,s=this._checkSource(i);if(s){if("vector"!==s.type||n)return void 0===e.id&&this.fire(new t.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(n,e.id);this.fire(new t.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=t.Q({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return t.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const e=this.getTerrain(),i=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return t.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(t=>void 0!==t))}_updateLayer(e){this._changes.updateLayer(e);const i=this.getLayerSourceCache(e),n=t.am(e.source,e.scope),s=this._changes.getUpdatedSourceCaches();e.source&&!s[n]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(n,"reload"),i.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._mergedLayers[t].type||"model"===this._mergedLayers[t].type,i=this.order,n={},s=[];for(let r=i.length-1;r>=0;r--){const o=i[r];if(e(o)){n[o]=r;for(const e of t){const t=e[o];if(t)for(const e of t)s.push(e)}}}s.sort(((t,e)=>e.intersectionZ-t.intersectionZ));const r=[];for(let o=i.length-1;o>=0;o--){const a=i[o];if(e(a))for(let t=s.length-1;t>=0;t--){const e=s[t].feature;if(e.layer&&n[e.layer.id]<o)break;r.push(e),s.pop()}else for(const e of t){const t=e[a];if(t)for(const e of t)r.push(e.feature)}}return r}queryRenderedFeatures(e,i,n){i&&i.filter&&this._validate(Ut,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const s={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new t.f(new Error("parameters.layers must be an Array."))),[];for(const e of i.layers){const i=this._mergedLayers[e];if(!i)return this.fire(new t.f(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];s[i.source]=!0}}const r=[],o=i.serializedLayers||{},a=i&&i.layers?i.layers.some((t=>{const e=this.getLayer(t);return e&&e.is3D()})):this.has3DLayers(),h=Es.createFromScreenPoints(e,n);for(const t in this._mergedSourceCaches){const e=this._mergedSourceCaches[t].getSource();if(!e||e.scope!==i.scope)continue;const c=this._mergedSourceCaches[t].getSource().id;i.layers&&!s[c]||r.push(Cs(this._mergedSourceCaches[t],this._mergedLayers,o,h,i,n,a,!!this.map._showQueryGeometry))}return this.placement&&r.push(function(t,e,i,n,s,r,o){const a={},h=r.queryRenderedSymbols(n),c=[];for(const t of Object.keys(h).map(Number))c.push(o[t]);c.sort(Ds);for(const i of c){const n=i.featureIndex.lookupSymbolFeatures(h[i.bucketInstanceId],e,i.bucketIndex,i.sourceLayerIndex,s.filter,s.layers,s.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],s=n[t];s.sort(((t,e)=>{const n=i.featureSortOrder;if(n){const i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(const t of s)e.push(t)}}for(const e in a)a[e].forEach((n=>{const s=n.feature,r=i(t[e]);if(!r)return;const o=r.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=o}));return a}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),h.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(r)}querySourceFeatures(t,e){e&&e.filter&&this._validate(Ut,"querySourceFeatures.filter",e.filter,null,e);const i=this.getOwnSourceCaches(t);let n=[];for(const t of i)n=n.concat(js(t,e));return n}addSourceType(t,e,i){return Ar.getSourceType(t)?i(new Error(`A source type called "${t}" already exists.`)):(Ar.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,i,n={}){this._checkLoaded();const s=this.light.getLight();let r=!1;for(const i in e)if(!t.d(e[i],s[i])){r=!0;break}if(!r)return;const o=this._getTransitionParameters();this.light.setLight(e,i,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=t.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(e,i=1){if(this._checkLoaded(),!e)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===i&&delete this.terrain,null===e?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let n=e;const s=null==e.source;if(1===i){if(this.disableElevatedTerrain)return;if("object"==typeof n.source){const e="terrain-dem-src";this.addSource(e,n.source),n=t.cW(n),n=t.Q(n,{source:e})}const e=t.Q({},n),i={};if(this.terrain&&s){e.source=this.terrain.get().source;const t=this.terrain?this.getFragmentStyle(this.terrain.scope):null;t&&(i.style=t.serialize())}if(this._validate(zt,"terrain",e,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!s||this.terrain&&i!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,i),this.fire(new t.g("data",{dataType:"style"}))}else{const i=this.terrain,s=i.get();for(const e of Object.keys(t.N.terrain))!n.hasOwnProperty(e)&&t.N.terrain[e].default&&(n[e]=t.N.terrain[e].default);for(const n in e)if(!t.d(e[n],s[n])){i.set(e,this.options),this.stylesheet.terrain=e;const n=this._getTransitionParameters({duration:0});i.updateTransitions(n),this.fire(new t.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const e=this.fog=new re(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=e.get();const i=this._getTransitionParameters({duration:0});e.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!t.d(i.get(),e)){i.set(e,this.options),this.stylesheet.fog=i.get();const t=this._getTransitionParameters({duration:0});i.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}setColorTheme(e){this._checkLoaded();const i=()=>{for(const t in this._layers)this._layers[t].lut=this._styleColorTheme.lut;for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles()};if(this._styleColorTheme.colorTheme=e,!e)return this._styleColorTheme.lut=null,void i();const n=this._evaluateColorThemeData(e);this._loadColorTheme(n).then((()=>{this.fire(new t.g("colorthemeset")),i()})).catch((e=>{t.w(`Couldn't set color theme: ${e}`)}))}_getTransitionParameters(e){return{now:t.e.now(),transition:t.Q(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],e=[];for(const i of this._mergedOrder)this.isLayerDraped(this._mergedLayers[i])?t.push(i):e.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(t,e){const i=this.terrain=new Zt(t,e,this.scope,this.options);1===e&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});i.updateTransitions(n)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,i,n,s,r={}){if(r&&!1===r.validate)return!1;const o=t.Q({},this.serialize());return xr(this,e.call(Rt,t.Q({key:i,style:o,value:n,styleSpec:t.N},s)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const e=this.getSourceCaches(t);for(const t of e)t.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const e=this.getSourceCaches(t);for(const t of e)t.resume(),t.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}updateSources(t){let e;this.directionalLight&&(e=gi(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(t,void 0,void 0,e)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,i,n,s,r,o,a=!1){let h=!1,c=!1;const u={},l={};for(const e of this._mergedOrder){const n=this._mergedLayers[e];if("symbol"!==n.type)continue;const s=t.am(n.source,n.scope);let r=u[s];if(!r){const t=this.getLayerSourceCache(n);if(!t)continue;const e=t.getRenderableIds(!0).map((e=>t.getTileByID(e)));l[s]=e.slice(),r=u[s]=e.sort(((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)))}const o=this.crossTileSymbolIndex.addLayer(n,r,i.center.lng,i.projection);h=h||o}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===s,this._layerOrderChanged&&this.fire(new t.g("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.e.now(),i.zoom))&&(this.pauseablePlacement=new mr(i,this._mergedOrder,a,n,s,r,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.e.now()),c=!0),h&&this.pauseablePlacement.placement.setStale()),c||h){this._buildingIndex.onNewFrame(i.zoom);for(let e=0;e<this._mergedOrder.length;e++){const i=this._mergedLayers[this._mergedOrder[e]];if("symbol"!==i.type)continue;const n=this.isLayerClipped(i)&&this._clipLayerIndices.some((t=>e<t));this.placement.updateLayerOpacities(i,u[t.am(i.source,i.scope)],e,n?o:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.e.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(e,i){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex((({id:t})=>t===e.id)))return void this.fire(new t.f(new Error(`Import with id '${e.id}' already exists in the map's style.`)));if(!i)return n.push(e),this._loadImports([e],!0);const s=n.findIndex((({id:t})=>t===i));return-1===s&&this.fire(new t.f(new Error(`Import with id "${i}" does not exist on this map.`))),this.stylesheet.imports=n.slice(0,s).concat(e).concat(n.slice(s)),this._loadImports([e],!0,i)}updateImport(e,i){this._checkLoaded();const n=this.stylesheet.imports||[],s=this.getImportIndex(e);return-1===s?this:"string"==typeof i?(this.setImportUrl(e,i),this):(i.url&&i.url!==n[s].url&&this.setImportUrl(e,i.url),t.d(i.config,n[s].config)||this.setImportConfig(e,i.config),t.d(i.data,n[s].data)||this.setImportData(e,i.data),this)}moveImport(t,e){this._checkLoaded();let i=this.stylesheet.imports||[];const n=this.getImportIndex(t);if(-1===n)return this;const s=this.getImportIndex(e);if(-1===s)return this;const r=i[n],o=this.fragments[n];return i=i.filter((({id:e})=>e!==t)),this.fragments=this.fragments.filter((({id:e})=>e!==t)),this.stylesheet.imports=i.slice(0,s).concat(r).concat(i.slice(s)),this.fragments=this.fragments.slice(0,s).concat(o).concat(this.fragments.slice(s)),this.mergeLayers(),this}setImportUrl(t,e){this._checkLoaded();const i=this.stylesheet.imports||[],n=this.getImportIndex(t);if(-1===n)return this;i[n].url=e;const s=this.fragments[n];return s.style=this._createFragmentStyle(i[n]),s.style.on("style.import.load",(()=>this.mergeAll())),s.style.loadURL(e),this}setImportData(t,e){this._checkLoaded();const i=this.getImportIndex(t),n=this.stylesheet.imports||[];return-1===i?this:e?(this.fragments[i].style.setState(e),this._reloadImports(),this):(delete n[i].data,this.setImportUrl(t,n[i].url))}setImportConfig(t,e){this._checkLoaded();const i=this.getImportIndex(t),n=this.stylesheet.imports||[];if(-1===i)return this;e?n[i].config=e:delete n[i].config;const s=this.fragments[i],r=s.style.stylesheet&&s.style.stylesheet.schema;return s.config=e,s.style.updateConfig(e,r),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const e=this.stylesheet.imports||[],i=this.getImportIndex(t);-1!==i&&(e.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports())}getImportIndex(e){const i=(this.stylesheet.imports||[]).findIndex((t=>t.id===e));return-1===i&&this.fire(new t.f(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),i}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const e in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[e];i&&t.push(i.getSource())}return t}getSource(t,e){const i=this.getSourceCache(t,e);return i&&i.getSource()}getLayerSource(t){const e=this.getLayerSourceCache(t);return e&&e.getSource()}getSourceCache(e,i){const n=t.am(e,i);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(e){const i=t.am(e.source,e.scope);return"symbol"===e.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(t){if(null==t)return Object.values(this._mergedSourceCaches);const e=[];return this._mergedOtherSourceCaches[t]&&e.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&e.push(this._mergedSymbolSourceCaches[t]),e}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const e in t){const i=t[e];"reload"===i?this.reloadSource(e):"clear"===i&&this.clearSource(e)}}updateLayers(t){const e=this._changes.getUpdatedPaintProperties();for(const i of e){const e=this.getLayer(i);e&&e.updateTransitions(t)}}getImages(t,e,i){this.imageManager.getImages(e.icons,e.scope,i),this._updateTilesForChangedImages();const n=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};n(this._otherSourceCaches[e.source]),n(this._symbolSourceCaches[e.source])}getGlyphs(t,e,i){this.glyphManager.getGlyphs(e.stacks,e.scope,i)}getResource(e,i,n){return t.d2(i,n)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const i=this.getOwnSourceCaches(e);return 0===i.length?(this.fire(new t.f(new Error(`There is no source with ID '${e}'`))),!1):i.every((t=>t.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,i){if(0===this._clipLayerIndices.length&&"fill-extrusion"!==e.type)return!1;const n="fill-extrusion"===e.type&&"building"===e.sourceLayer;let s=0;if(e.is3D()){if(n||i&&"batched-model"===i.type)return!0;"model"===e.type&&(s=t.cw.Model)}else"symbol"===e.type&&(s=t.cw.Symbol);for(const e of this._clipLayerIndices){const i=this._mergedLayers[this._mergedOrder[e]];if(!i)continue;const n=[];for(const e of i.layout.get("clip-layer-types"))n.push("model"===e?t.cw.Model:"symbol"===e?t.cw.Symbol:t.cw.FillExtrusion);for(const t of n)if(s&t)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Sr(t,e){let i=!1,n=null;const s=()=>{n=null,i&&(t(),n=setTimeout(s,e),i=!1)};return()=>(i=!0,n||s(),n)}Ar.getSourceType=function(t){return ki[t]},Ar.setSourceType=function(t,e){ki[t]=e},Ar.registerForPluginStateChange=t.cO;class kr{constructor(e){this._hashName=e&&encodeURIComponent(e),t.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Sr(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const e=Ir(t);if(this._hashName){const t=this._hashName;let i=!1;const n=location.hash.slice(1).split("&").map((n=>{const s=n.split("=")[0];return s===t?(i=!0,`${s}=${e}`):n})).filter((t=>t));return i||n.push(`${t}=${e}`),`#${n.join("&")}`}return`#${e}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let e;return t.split("&").map((t=>t.split("="))).forEach((t=>{t[0]===this._hashName&&(e=t)})),(e&&e[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some((t=>isNaN(t)))){const i=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:i,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ir(t,e){const i=t.getCenter(),n=Math.round(100*t.getZoom())/100,s=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,s),o=Math.round(i.lng*r)/r,a=Math.round(i.lat*r)/r,h=t.getBearing(),c=t.getPitch();let u=e?`/${o}/${a}/${n}`:`${n}/${a}/${o}`;return(h||c)&&(u+="/"+Math.round(10*h)/10),c&&(u+=`/${Math.round(c)}`),u}const Cr={linearity:.3,easing:t.d3(0,0,.3,1)},jr=t.Q({deceleration:2500,maxSpeed:1400},Cr),Dr=t.Q({deceleration:20,maxSpeed:1400},Cr),Rr=t.Q({deceleration:1e3,maxSpeed:360},Cr),Pr=t.Q({deceleration:1e3,maxSpeed:90},Cr);class Nr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.e.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,i=t.e.now();for(;e.length>0&&i-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)i.zoom+=t.zoomDelta||0,i.bearing+=t.bearingDelta||0,i.pitch+=t.pitchDelta||0,t.panDelta&&i.pan._add(t.panDelta),t.around&&(i.around=t.around),t.pinchAround&&(i.pinchAround=t.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(i.pan.mag()){const r=zr(i.pan.mag(),n,t.Q({},jr,e||{}));s.offset=i.pan.mult(r.amount/i.pan.mag()),s.center=this._map.transform.center,Fr(s,r)}if(i.zoom){const t=zr(i.zoom,n,Dr);s.zoom=this._map.transform.zoom+t.amount,Fr(s,t)}if(i.bearing){const e=zr(i.bearing,n,Rr);s.bearing=this._map.transform.bearing+t.au(e.amount,-179,179),Fr(s,e)}if(i.pitch){const t=zr(i.pitch,n,Pr);s.pitch=this._map.transform.pitch+t.amount,Fr(s,t)}if(s.zoom||s.bearing){const t=void 0===i.pinchAround?i.around:i.pinchAround;s.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),s.noMoveStart=!0,s}}function Fr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function zr(e,i,n){const{maxSpeed:s,linearity:r,deceleration:o}=n,a=t.au(e*r/(i/1e3),-s,s),h=Math.abs(a)/(o*r);return{easing:n.easing,duration:1e3*h,amount:a*(h/2)}}class Lr extends t.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n,s={}){const r=d(i.getCanvasContainer(),n),o=i.unproject(r);super(e,t.Q({point:r,lngLat:o,originalEvent:n},s)),this._defaultPrevented=!1,this.target=i}}class $r extends t.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,i,n){const s="touchend"===e?n.changedTouches:n.touches,r=p(i.getCanvasContainer(),s),o=r.map((t=>i.unproject(t))),a=r.reduce(((t,e,i,n)=>t.add(e.div(n.length))),new t.P(0,0));super(e,{points:r,point:a,lngLats:o,lngLat:i.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class Ur extends t.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e){super("wheel",{originalEvent:e}),this._defaultPrevented=!1}}class Br{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Ur(this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Lr(t.type,this._map,t))}mouseup(t){this._map.fire(new Lr(t.type,this._map,t))}preclick(e){const i=t.Q({},e);i.type="preclick",this._map.fire(new Lr(i.type,this._map,i))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Lr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Lr(t.type,this._map,t))}mouseover(t){this._map.fire(new Lr(t.type,this._map,t))}mouseout(t){this._map.fire(new Lr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $r(t.type,this._map,t))}touchmove(t){this._map.fire(new $r(t.type,this._map,t))}touchend(t){this._map.fire(new $r(t.type,this._map,t))}touchcancel(t){this._map.fire(new $r(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gr{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Lr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Lr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hr{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(c(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e,n=this._startPos,r=this._lastPos;if(!n||!r||r.equals(i)||!this._box&&i.dist(n)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=s("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const o=Math.min(n.x,i.x),a=Math.max(n.x,i.x),h=Math.min(n.y,i.y),c=Math.max(n.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${o}px,${h}px)`,this._box.style.width=a-o+"px",this._box.style.height=c-h+"px")}))}mouseupWindow(e,i){if(!this._active)return;const n=this._startPos,s=i;if(n&&0===e.button){if(this.reset(),f(),n.x!==s.x||n.y!==s.y)return this._map.fire(new t.g("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(n,s,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),u(),delete this._startPos,delete this._lastPos}_fireEvent(e,i){return this._map.fire(new t.g(e,{originalEvent:i}))}}function Vr(t,e){const i={};for(let n=0;n<t.length;n++)i[t[n].identifier]=e[n];return i}class Wr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,i,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){const i=new t.P(0,0);for(const t of e)i._add(t);return i.div(e.length)}(i),this.touches=Vr(n,i)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=Vr(i,e);for(const t in this.touches){const e=n[t];(!e||e.dist(this.touches[t])>30)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class qr{constructor(t){this.singleTap=new Wr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const e=t.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(n)<30;if(e&&i||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class Yr{constructor(){this._zoomIn=new qr({numTouches:1,numTaps:2}),this._zoomOut=new qr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),s=this._zoomOut.touchend(t,e,i);return n?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(n)},{originalEvent:t})}):s?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(s)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xr={0:1,2:2};class Zr{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const i=m(t);this._correctButton(t,i)&&(this._lastPoint=e,this._eventButton=i)}mousemoveWindow(t,e){const i=this._lastPoint;if(i)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const i=Xr[e];return void 0===t.buttons||(t.buttons&i)!==i}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(i,e)}mouseupWindow(t){this._lastPoint&&m(t)===this._eventButton&&(this._moved&&f(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jr extends Zr{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class Kr extends Zr{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=.8*(e.x-t.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(t){t.preventDefault()}}class Qr extends Zr{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const i=-.5*(e.y-t.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(t){t.preventDefault()}}class to{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),t.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(e,i,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!t.d4())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,i,n)}}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,i,n){n.length>0&&(this._active=!0);const s=Vr(n,i),r=new t.P(0,0),o=new t.P(0,0);let a=0;for(const t in s){const e=s[t],i=this._touches[t];i&&(r._add(e),o._add(e.sub(i)),a++,s[t]=e)}if(this._touches=s,a<this._minTouches||!o.mag())return;const h=o.div(a);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:r.div(a),panDelta:h}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=s("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class eo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,i){return{}}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){const n=this._firstTwoTouches;if(!n)return;t.preventDefault();const[s,r]=n,o=io(i,e,s),a=io(i,e,r);if(!o||!a)return;const h=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],h,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,s]=this._firstTwoTouches,r=io(i,e,n),o=io(i,e,s);r&&o||(this._active&&f(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function io(t,e,i){for(let n=0;n<t.length;n++)if(t[n].identifier===i)return e[n]}function no(t,e){return Math.log(t/e)/Math.LN2}class so extends eo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(no(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:no(this._distance,i),pinchAround:e}}}function ro(t,e){return 180*t.angleWith(e)/Math.PI}class oo extends eo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const i=this._vector;if(this._vector=t[0].sub(t[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ro(this._vector,i),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const n=ro(t,i);return Math.abs(n)<e}}function ao(t){return Math.abs(t.y)>Math.abs(t.x)}class ho extends eo{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ao(t[0].sub(t[1]))&&(this._valid=!1)}_move(e,i,n){const s=this._lastPoints;if(!s)return;const r=e[0].sub(s[0]),o=e[1].sub(s[1]);return this._map._cooperativeGestures&&!t.d4()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(r,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+o.y)/2*-.5})}gestureBeginsVertically(t,e,i){if(void 0!==this._valid)return this._valid;const n=t.mag()>=2,s=e.mag()>=2;if(!n&&!s)return;if(!n||!s)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const r=t.y>0==e.y>0;return ao(t)&&ao(e)&&r}}const co={panStep:100,bearingStep:15,pitchStep:10};class uo{constructor(){const t=co;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,s=0,r=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),s=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),s=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),r=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),r=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:o=>{const a=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:lo,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:o.getBearing()+i*this._bearingStep,pitch:o.getPitch()+n*this._pitchStep,offset:[-s*this._panStep,-r*this._panStep],center:o.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function lo(t){return t*(2-t)}const fo=4.000244140625,po=1/450;class mo{constructor(e,i){this._map=e,this._el=e.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=po,t.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||t.d4()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=t.e.now(),s=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==i&&i%fo==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":s>400?(this._type=null,this._lastValue=i,this._timeout=window.setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(s*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),e.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=e,this._delta-=i,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=d(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform;"wheel"===this._type&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>fo?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const s=i(),r=Math.pow(2,s),o="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):r;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=s,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:i(),s=this._startZoom,r=this._easing;let o,a=!1;if("wheel"===this._type&&s&&r){const e=Math.min((t.e.now()-this._lastWheelEventTime)/200,1),i=r(e);o=t.a3(s,n,i),e<1?this._frameId||(this._frameId=!0):a=!0}else o=n,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let h=o-i();return h*this._lastDelta<0&&(h=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:h,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let i=t.d5;if(this._prevEase){const e=this._prevEase,n=(t.e.now()-e.start)/e.duration,s=e.easing(n+.01)-e.easing(n),r=.27/Math.sqrt(s*s+1e-4)*.01,o=Math.sqrt(.0729-r*r);i=t.d3(r,o,.25,1)}return this._prevEase={start:t.e.now(),duration:e,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=s("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class _o{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(t.shiftKey?-1:1),around:i.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(){this._tap=new qr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,i){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=e[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(t,e,i))}touchmove(t,e,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],s=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:s/128}}}else this._tap.touchmove(t,e,i)}touchend(t,e,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(t,e,i)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bo{constructor(t,e,i){this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wo{constructor(t,e,i){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class yo{constructor(t,e,i,n){this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xo=t=>t.zoom||t.drag||t.pitch||t.rotate;class Mo extends t.g{}class To{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,i){const n=t.$.sub([],i,e);this.radius=t.$.length(n[2]<0?t.$.div([],n,this.constants):[n[0],n[1],0])}projectRay(e){t.$.div(e,e,this.constants),t.$.normalize(e,e),t.$.mul(e,e,this.constants);const i=t.$.scale([],e,this.radius);if(i[2]>0){const e=t.$.scale([],[0,0,1],t.$.dot(i,[0,0,1])),n=t.$.scale([],t.$.normalize([],[i[0],i[1],0]),this.radius),s=t.$.add([],i,t.$.scale([],t.$.sub([],t.$.add([],n,e),i),2));i[0]=s[0],i[1]=s[1]}return i}}function Oo(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class Eo{constructor(e,i){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nr(e),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new To,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),t.br(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[t,e,i]of this._listeners){const n=t===document?this.handleWindowEvent:this.handleEvent;t.addEventListener(e,n,i)}}destroy(){for(const[t,e,i]of this._listeners){const n=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(e,n,i)}}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new Br(e,t));const n=e.boxZoom=new Hr(e,t);this._add("boxZoom",n);const s=new Yr,r=new vo;e.doubleClickZoom=new _o(r,s),this._add("tapZoom",s),this._add("clickZoom",r);const o=new go;this._add("tapDragZoom",o);const a=e.touchPitch=new ho(e);this._add("touchPitch",a);const h=new Kr(t),c=new Qr(t);e.dragRotate=new wo(t,h,c),this._add("mouseRotate",h,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new Jr(t),l=new to(e,t);e.dragPan=new bo(i,u,l),this._add("mousePan",u),this._add("touchPan",l,["touchZoom","touchRotate"]);const f=new oo,d=new so;e.touchZoomRotate=new yo(i,d,f,o),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Gr(e));const p=e.scrollZoom=new mo(e,this);this._add("scrollZoom",p,["mousePan"]);const m=e.keyboard=new uo;this._add("keyboard",m);for(const i of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[i]&&e[i].enable(t[i])}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const i of t)this._el.contains(i.target)&&e.push(i);return e}handleEvent(t,e){this._updatingCamera=!0;const i="renderFrame"===t.type,n=i?void 0:t,s={needsRenderFrame:!1},r={},o={},a=t.touches?this._getMapTouches(t.touches):void 0,h=a?p(this._el,a):i?void 0:d(this._el,t);for(const{handlerName:i,handler:c,allowed:u}of this._handlers){if(!c.isEnabled())continue;let l;this._blockedByActive(o,u,i)?c.reset():c[e||t.type]&&(l=c[e||t.type](t,h,a),this.mergeHandlerResult(s,r,l,i,n),l&&l.needsRenderFrame&&this._triggerRenderFrame()),(l||c.isActive())&&(o[i]=c)}const c={};for(const t in this._previousActiveHandlers)o[t]||(c[t]=n);this._previousActiveHandlers=o,(Object.keys(c).length||Oo(s))&&(this._changes.push([s,r,c]),this._triggerRenderFrame()),(Object.keys(o).length||Oo(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=s;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,i,n,s,r){if(!n)return;t.Q(e,n);const o={handlerName:s,originalEvent:n.originalEvent||r};void 0!==n.zoomDelta&&(i.zoom=o),void 0!==n.panDelta&&(i.drag=o),void 0!==n.pitchDelta&&(i.pitch=o),void 0!==n.bearingDelta&&(i.rotate=o)}_applyChanges(){const e={},i={},n={};for(const[s,r,o]of this._changes)s.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.aroundCoord&&(e.aroundCoord=s.aroundCoord),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.Q(i,r),t.Q(n,o);this._updateMapTransform(e,i,n),this._changes=[]}_updateMapTransform(e,i,n){const s=this._map,r=s.transform,o=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Oo(e)){const t=r.zoom;r.cameraElevationReference="sea",null!=this._originalZoom&&r._orthographicProjectionAtLowPitch&&"globe"!==r.projection.name&&0===r.pitch?(r.cameraElevationReference="ground",r.zoom=this._originalZoom):(r.recenterOnTerrain(),r.cameraElevationReference="ground"),t!==r.zoom&&this._map._update(!0)}if(r._isCameraConstrained&&s._stop(!0),!Oo(e))return void this._fireEvents(i,n,!0);let{panDelta:a,zoomDelta:h,bearingDelta:c,pitchDelta:u,around:l,aroundCoord:f,pinchAround:d}=e;r._isCameraConstrained&&(h>0&&(h=0),r._isCameraConstrained=!1),void 0!==d&&(l=d),(h||(t=>i[t]&&!this._eventsInProgress[t])("drag"))&&l&&(this._dragOrigin=o(r.pointCoordinate3D(l)),this._originalZoom=r.zoom,this._trackingEllipsoid.setup(r._camera.position,this._dragOrigin)),r.cameraElevationReference="sea",s._stop(!0),l=l||s.transform.centerPoint,c&&(r.bearing+=c),u&&(r.pitch+=u),r._updateCameraState();const p=[0,0,0];if(a)if("mercator"===r.projection.name){const t=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(l).dir),e=this._trackingEllipsoid.projectRay(r.screenPointToMercatorRay(l.sub(a)).dir);p[0]=e[0]-t[0],p[1]=e[1]-t[1]}else{const e=r.pointCoordinate(l);if("globe"===r.projection.name){a=a.rotate(-r.angle);const i=r._pixelsPerMercatorPixel/r.worldSize;p[0]=-a.x*t.d6(t.az(e.y))*i,p[1]=-a.y*t.d6(r.center.lat)*i}else{const t=r.pointCoordinate(l.sub(a));e&&t&&(p[0]=t.x-e.x,p[1]=t.y-e.y)}}const m=r.zoom,_=[0,0,0];if(h){const e=o(f||r.pointCoordinate3D(l)),i={dir:t.$.normalize([],t.$.sub([],e,r._camera.position))};if(i.dir[2]<0){const n=r.zoomDeltaToMovement(e,h);t.$.scale(_,i.dir,n)}}const v=t.$.add(p,p,_);r._translateCameraConstrained(v),h&&Math.abs(r.zoom-m)>1e-4&&r.recenterOnTerrain(),r.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(i,n,!0)}_fireEvents(e,i,n){const s=xo(this._eventsInProgress),r=xo(e),o={};for(const t in e){const{originalEvent:i}=e[t];this._eventsInProgress[t]||(o[`${t}start`]=i),this._eventsInProgress[t]=e[t]}!s&&r&&this._fireEvent("movestart",r.originalEvent);for(const t in o)this._fireEvent(t,o[t]);r&&this._fireEvent("move",r.originalEvent);for(const t in e){const{originalEvent:i}=e[t];this._fireEvent(t,i)}const a={};let h;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:n}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],h=i[e]||n,a[`${t}end`]=h)}for(const t in a)this._fireEvent(t,a[t]);const c=xo(this._eventsInProgress);if(n&&(s||r)&&!c){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(i(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:h})):(this._map.fire(new t.g("moveend",{originalEvent:h})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,i){this._map.fire(new t.g(e,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Mo("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ao="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class So extends t.E{constructor(e,i){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,t.br(["_renderFrameCallback"],this)}getCenter(){return new t.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,i,n){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.Q({offset:e},i),n)}panTo(e,i,n){return this.easeTo(t.Q({center:e},i),n)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,i,n){return this.easeTo(t.Q({zoom:e},i),n)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,i,n){return this.easeTo(t.Q({bearing:e},i),n)}resetNorth(e,i){return this.rotateTo(0,t.Q({duration:1e3},e),i),this}resetNorthPitch(e,i){return this.easeTo(t.Q({bearing:0,pitch:0,duration:1e3},e),i),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,i){e=t.aj.convert(e);const n=i&&i.bearing||0,s=i&&i.pitch||0,r=e.getNorthWest(),o=e.getSouthEast();return this._cameraForBounds(this.transform,r,o,n,s,i)}_extendPadding(e){const i={top:0,right:0,bottom:0,left:0};return null==e?t.Q({},i,this.transform.padding):"number"==typeof e?{top:e,bottom:e,right:e,left:e}:t.Q({},i,e)}_extendCameraOptions(e){return(e=t.Q({offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=this._extendPadding(e.padding),e}_minimumAABBFrustumDistance(t,e){const i=e.max[0]-e.min[0],n=e.max[1]-e.min[1];return i/n>t.aspect?i/(2*Math.tan(.5*t.fovX)*t.aspect):n/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(e,i,n,s,r,o){const a=e.clone(),h=this._extendCameraOptions(o);a.bearing=s,a.pitch=r;const c=t.aJ.convert(i),u=t.aJ.convert(n),l=.5*(c.lat+u.lat),f=.5*(c.lng+u.lng),d=t.d7(l,f),p=t.$.normalize([],d),m=t.$.normalize([],t.$.cross([],p,[0,1,0])),_=t.$.cross([],m,p),v=[m[0],m[1],m[2],0,_[0],_[1],_[2],0,p[0],p[1],p[2],0,0,0,0,1],g=[d,t.d7(c.lat,c.lng),t.d7(u.lat,c.lng),t.d7(u.lat,u.lng),t.d7(c.lat,u.lng),t.d7(l,c.lng),t.d7(l,u.lng),t.d7(c.lat,f),t.d7(u.lat,f)];let b=t.b8.fromPoints(g.map((e=>[t.$.dot(m,e),t.$.dot(_,e),t.$.dot(p,e)])));const w=t.$.transformMat4([],b.center,v);0===t.$.squaredLength(w)&&t.$.set(w,0,0,1),t.$.normalize(w,w),t.$.scale(w,w,t.cF),a.center=t.d8(w);const y=a.getWorldToCameraMatrix(),x=t.ae.invert(new Float64Array(16),y);b=t.b8.applyTransform(b,t.ae.multiply([],y,v));const M=this._extendAABB(b,a,h,s);if(!M)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");b=M,t.$.transformMat4(w,w,y);const T=.5*(b.max[2]-b.min[2]),O=this._minimumAABBFrustumDistance(a,b),E=t.$.scale([],[0,0,1],T),A=t.$.add(E,w,E),S=O+(0===a.pitch?0:t.$.distance(w,A)),k=a.globeCenterInViewSpace,I=t.$.sub([],w,[k[0],k[1],k[2]]);t.$.normalize(I,I),t.$.scale(I,I,S);const C=t.$.add([],w,I);t.$.transformMat4(C,C,x);const j=t.da/t.cF,D=t.$.length(C),R=t.ay(Math.max(D*j-t.da,Number.EPSILON),0),P=Math.min(a.zoomFromMercatorZAdjusted(R),h.maxZoom);return P>.5*(t.b3+t.aV)?(a.setProjection({name:"mercator"}),a.zoom=P,this._cameraForBounds(a,i,n,s,r,o)):{center:a.center,zoom:P,bearing:s,pitch:r}}_extendAABB(e,i,n,s){const r=.5*((n.padding.left||0)+(n.padding.right||0)),o=.5*((n.padding.top||0)+(n.padding.bottom||0)),a=o,h=r,c=r,u=o,l=i.width-(h+c),f=i.height-(a+u),d=t.$.sub([],e.max,e.min),p=Math.min(l/d[0],f/d[1]),m=Math.min(i.scaleZoom(i.scale*p),n.maxZoom);if(isNaN(m))return null;const _=i.scale/i.zoomScale(m),v=new t.b8([e.min[0]-h*_,e.min[1]-u*_,e.min[2]],[e.max[0]+c*_,e.max[1]+a*_,e.max[2]]),g=("number"==typeof n.offset.x&&"number"==typeof n.offset.y?new t.P(n.offset.x,n.offset.y):t.P.convert(n.offset)).rotate(-t.ac(s));return v.center[0]-=g.x*_,v.center[1]+=g.y*_,v}queryTerrainElevation(e,i){const n=this.transform.elevation;return n?(i=t.Q({},{exaggerated:!0},i),n.getAtPoint(t._.fromLngLat(e),null,i.exaggerated)):null}_cameraForBounds(e,i,n,s,r,o){if("globe"===e.projection.name)return this._cameraForBoundsOnGlobe(e,i,n,s,r,o);const a=e.clone(),h=this._extendCameraOptions(o);a.bearing=s,a.pitch=r;const c=t.aJ.convert(i),u=t.aJ.convert(n),l=new t.aJ(c.lng,u.lat),f=new t.aJ(u.lng,c.lat),d=a.project(c),p=a.project(u),m=this.queryTerrainElevation(c),_=this.queryTerrainElevation(u),v=this.queryTerrainElevation(l),g=this.queryTerrainElevation(f),b=[[d.x,d.y,Math.min(m||0,_||0,v||0,g||0)],[p.x,p.y,Math.max(m||0,_||0,v||0,g||0)]];let w=t.b8.fromPoints(b);const y=a.getWorldToCameraMatrix(),x=t.ae.invert(new Float64Array(16),y);w=t.b8.applyTransform(w,y);const M=this._extendAABB(w,a,h,s);if(!M)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");w=M;const T=.5*t.$.sub([],w.max,w.min)[2],O=this._minimumAABBFrustumDistance(a,w),E=[0,0,1,0];t.aB.transformMat4(E,E,y),t.aB.normalize(E,E);const A=t.$.scale([],E,O+T),S=t.$.add([],w.center,A);t.$.transformMat4(w.center,w.center,x),t.$.transformMat4(S,S,x);const k=[w.center[0],w.center[1],S[2]*a.pixelsPerMeter];t.$.scale(k,k,1/a.worldSize);const I=t.d9(k[0]),C=t.az(k[1]),j=Math.min(a._zoomFromMercatorZ(k[2]),h.maxZoom),D=new t.aJ(I,C);return a.mercatorFromTransition&&j<.5*(t.b3+t.aV)?(a.setProjection({name:"globe"}),a.zoom=j,this._cameraForBounds(a,i,n,s,r,o)):{center:D,zoom:j,bearing:s,pitch:r}}fitBounds(t,e,i){const n=this.cameraForBounds(t,e);return this._fitInternal(n,e,i)}fitScreenCoordinates(e,i,n,s,r){const o=t.P.convert(e),a=t.P.convert(i),h=new t.P(Math.min(o.x,a.x),Math.min(o.y,a.y)),c=new t.P(Math.max(o.x,a.x),Math.max(o.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,a))return this;const u=this.transform.pointLocation3D(h),l=this.transform.pointLocation3D(c),f=this.transform.pointLocation3D(new t.P(h.x,c.y)),d=this.transform.pointLocation3D(new t.P(c.x,h.y)),p=[Math.min(u.lng,l.lng,f.lng,d.lng),Math.min(u.lat,l.lat,f.lat,d.lat)],m=[Math.max(u.lng,l.lng,f.lng,d.lng),Math.max(u.lat,l.lat,f.lat,d.lat)],_=s&&s.pitch?s.pitch:this.getPitch(),v=this._cameraForBounds(this.transform,p,m,n,_,s);return this._fitInternal(v,s,r)}_fitInternal(e,i,n){return e?(i=t.Q(e,i)).linear?this.easeTo(i,n):this.flyTo(i,n):this}jumpTo(e,i){this.stop();const n=e.preloadOnly?this.transform.clone():this.transform;let s=!1,r=!1,o=!1;if("zoom"in e&&n.zoom!==+e.zoom&&(s=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.aJ.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(r=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null!=e.padding){const t="number"==typeof e.padding?this._extendPadding(e.padding):e.padding;n.isPaddingEqual(t)||(n.padding=t)}return e.preloadOnly?(this._preloadTiles(n),this):(this.fire(new t.g("movestart",i)).fire(new t.g("move",i)),s&&this.fire(new t.g("zoomstart",i)).fire(new t.g("zoom",i)).fire(new t.g("zoomend",i)),r&&this.fire(new t.g("rotatestart",i)).fire(new t.g("rotate",i)).fire(new t.g("rotateend",i)),o&&this.fire(new t.g("pitchstart",i)).fire(new t.g("pitch",i)).fire(new t.g("pitchend",i)),this.fire(new t.g("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(Ao),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,i){const n=this.transform;if(!n.projection.supportsFreeCamera)return t.w(Ao),this;this.stop();const s=n.zoom,r=n.pitch,o=n.bearing;n.setFreeCameraOptions(e);const a=s!==n.zoom,h=r!==n.pitch,c=o!==n.bearing;return this.fire(new t.g("movestart",i)).fire(new t.g("move",i)),a&&this.fire(new t.g("zoomstart",i)).fire(new t.g("zoom",i)).fire(new t.g("zoomend",i)),c&&this.fire(new t.g("rotatestart",i)).fire(new t.g("rotate",i)).fire(new t.g("rotateend",i)),h&&this.fire(new t.g("pitchstart",i)).fire(new t.g("pitch",i)).fire(new t.g("pitchend",i)),this.fire(new t.g("moveend",i)),this}easeTo(e,i){this._stop(!1,e.easeId),(!1===(e=t.Q({offset:[0,0],duration:500,easing:t.d5},e)).animate||this._prefersReducedMotion(e))&&(e.duration=0);const n=this.transform,s=this.getZoom(),r=this.getBearing(),o=this.getPitch(),a=this.getPadding(),h="zoom"in e?+e.zoom:s,c="bearing"in e?this._normalizeBearing(e.bearing,r):r,u="pitch"in e?+e.pitch:o,l=this._extendPadding(e.padding),f=t.P.convert(e.offset);let d,p,m;if("globe"===n.projection.name){const i=t._.fromLngLat(n.center),s=f.rotate(-n.angle);i.x+=s.x/n.worldSize,i.y+=s.y/n.worldSize;const r=i.toLngLat(),o=t.aJ.convert(e.center||r);this._normalizeCenter(o),d=n.centerPoint.add(s),p=new t.P(i.x,i.y).mult(n.worldSize),m=new t.P(t.ak(o.lng),t.al(o.lat)).mult(n.worldSize).sub(p)}else{d=n.centerPoint.add(f);const i=n.pointLocation(d),s=t.aJ.convert(e.center||i);this._normalizeCenter(s),p=n.project(i),m=n.project(s).sub(p)}const _=n.zoomScale(h-s);let v,g;e.around&&(v=t.aJ.convert(e.around),g=n.locationPoint(v));const b=this._zooming||h!==s,w=this._rotating||r!==c,y=this._pitching||u!==o,x=!n.isPaddingEqual(l),M=n=>M=>{if(b&&(n.zoom=t.a3(s,h,M)),w&&(n.bearing=t.a3(r,c,M)),y&&(n.pitch=t.a3(o,u,M)),x&&(n.interpolatePadding(a,l,M),d=n.centerPoint.add(f)),v)n.setLocationAtPoint(v,g);else{const t=n.zoomScale(n.zoom-s),e=h>s?Math.min(2,_):Math.max(.5,_),i=Math.pow(e,1-M),r=n.unproject(p.add(m.mult(M*i)).mult(t));n.setLocationAtPoint(n.renderWorldCopies?r.wrap():r,d)}return e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(M,e.duration,n);return this._preloadTiles(t),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=b,this._rotating=w,this._pitching=y,this._padding=x,this._easeId=e.easeId,this._prepareEase(i,e.noMoveStart,T),this._ease(M(n),(t=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(i,t)}),e),this}_prepareEase(e,i,n={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||n.moving||this.fire(new t.g("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.g("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.g("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.g("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.g("move",e)),this._zooming&&this.fire(new t.g("zoom",e)),this._rotating&&this.fire(new t.g("rotate",e)),this._pitching&&this.fire(new t.g("pitch",e))}_afterEase(e,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,s=this._rotating,r=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.g("zoomend",e)),s&&this.fire(new t.g("rotateend",e)),r&&this.fire(new t.g("pitchend",e)),this.fire(new t.g("moveend",e))}flyTo(e,i){if(this._prefersReducedMotion(e)){const n=t.ai(e,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(n,i)}this.stop(),e=t.Q({offset:[0,0],speed:1.2,curve:1.42,easing:t.d5},e);const n=this.transform,s=this.getZoom(),r=this.getBearing(),o=this.getPitch(),a=this.getPadding(),h="zoom"in e?t.au(+e.zoom,n.minZoom,n.maxZoom):s,c="bearing"in e?this._normalizeBearing(e.bearing,r):r,u="pitch"in e?+e.pitch:o,l=this._extendPadding(e.padding),f=n.zoomScale(h-s),d=t.P.convert(e.offset);let p=n.centerPoint.add(d);const m=n.pointLocation(p),_=t.aJ.convert(e.center||m);this._normalizeCenter(_);const v=n.project(m),g=n.project(_).sub(v);let b=e.curve;const w=Math.max(n.width,n.height),y=w/f,x=g.mag();if("minZoom"in e){const i=t.au(Math.min(e.minZoom,s,h),n.minZoom,n.maxZoom),r=w/n.zoomScale(i-s);b=Math.sqrt(r/x*2)}const M=b*b;function T(t){const e=(y*y-w*w+(t?-1:1)*M*M*x*x)/(2*(t?y:w)*M*x);return Math.log(Math.sqrt(e*e+1)-e)}function O(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}const A=T(0);let S=function(t){return E(A)/E(A+b*t)},k=function(t){return w*((E(A)*(O(e=A+b*t)/E(e))-O(A))/M)/x;var e},I=(T(1)-A)/b;if(Math.abs(x)<1e-6||!isFinite(I)){if(Math.abs(w-y)<1e-6)return this.easeTo(e,i);const t=y<w?-1:1;I=Math.abs(Math.log(y/w))/b,k=function(){return 0},S=function(e){return Math.exp(t*b*e)}}e.duration="duration"in e?+e.duration:1e3*I/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const C=r!==c,j=u!==o,D=!n.isPaddingEqual(l),R=n=>f=>{const m=f*I,b=1/S(m);n.zoom=1===f?h:s+n.scaleZoom(b),C&&(n.bearing=t.a3(r,c,f)),j&&(n.pitch=t.a3(o,u,f)),D&&(n.interpolatePadding(a,l,f),p=n.centerPoint.add(d));const w=1===f?_:n.unproject(v.add(g.mult(k(m))).mult(b));return n.setLocationAtPoint(n.renderWorldCopies?w.wrap():w,p),n._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(i),n};if(e.preloadOnly){const t=this._emulate(R,e.duration,n);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=C,this._pitching=j,this._padding=D,this._prepareEase(i,!1),this._ease(R(n),(()=>this._afterEase(i)),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,i,n){!1===n.animate||0===n.duration?(e(1),i()):(this._easeStart=t.e.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.e.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,i){e=t.av(e,-180,180);const n=Math.abs(e-i);return Math.abs(e-360-i)<n&&(e-=360),Math.abs(e+360-i)<n&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(e.maxBounds)return;if("globe"!==e.projection.name&&!e.renderWorldCopies)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&t.e.prefersReducedMotion&&!(e&&e.essential)}_emulate(t,e,i){const n=Math.ceil(15*e/1e3),s=[],r=t(i.clone());for(let t=0;t<=n;t++){const e=r(t/n);s.push(e.clone())}return s}_preloadTiles(t,e){}}class ko{constructor(e={}){this.options=e,t.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact,i=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=s("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",i);const n=s("span","mapboxgl-ctrl-icon",this._compactButton);return n.setAttribute("aria-hidden","true"),n.setAttribute("title",i),this._innerContainer=s("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.db.ACCESS_TOKEN}];if(e){const n=i.reduce(((t,e,n)=>(e.value&&(t+=`${e.key}=${e.value}${n<i.length-1?"&":""}`),t)),"?");e.href=`${t.db.FEEDBACK_URL}/${n}#${Ir(this._map,!0)}`,e.rel="noopener nofollow"}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._mergedSourceCaches;for(const i in e){const n=e[i];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort(((t,e)=>t.length-e.length)),t=t.filter(((e,i)=>{for(let n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const i=t.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,t.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Io{constructor(){t.br(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=s("div","mapboxgl-ctrl");const e=s("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const i=t[e].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Co{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const e of i)if(e.id===t)return void(e.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function jo(e,i,n){if(e=new t.aJ(e.lng,e.lat),i){const s=new t.aJ(e.lng-360,e.lat),r=new t.aJ(e.lng+360,e.lat),o=360*Math.ceil(Math.abs(e.lng-n.center.lng)/360),a=n.locationPoint(e).distSqr(i),h=i.x<0||i.y<0||i.x>n.width||i.y>n.height;n.locationPoint(s).distSqr(i)<a&&(h||Math.abs(s.lng-n.center.lng)<o)?e=s:n.locationPoint(r).distSqr(i)<a&&(h||Math.abs(r.lng-n.center.lng)<o)&&(e=r)}for(;Math.abs(e.lng-n.center.lng)>180;){const t=n.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=n.width&&t.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}const Do={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ro extends t.E{constructor(e,i){if(super(),(e instanceof HTMLElement||i)&&(e=t.Q({element:e},i)),t.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=s("div");const i=41,n=27,o=r("svg",{display:"block",height:i*this._scale+"px",width:n*this._scale+"px",viewBox:`0 0 ${n} ${i}`},this._element),a=r("radialGradient",{id:"shadowGradient"},r("defs",{},o));r("stop",{offset:"10%","stop-opacity":.4},a),r("stop",{offset:"100%","stop-opacity":.05},a),r("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o),r("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),r("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),r("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),this._offset=t.P.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(t=>{t.preventDefault()})),this._element.addEventListener("mousedown",(t=>{t.preventDefault()}));const n=this._element.classList;for(const t in Do)n.remove(`mapboxgl-marker-anchor-${t}`);n.add(`mapboxgl-marker-anchor-${this._anchor}`);const o=e&&e.className?e.className.trim().split(/\s+/):[];n.add(...o),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.aJ.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,i=13.5,n=Math.sqrt(Math.pow(i,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[n,-1*(e-i+n)],"bottom-right":[-n,-1*(e-i+n)],left:[i,-1*(e-i)],right:[-i,-1*(e-i)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,i=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==i&&13!==i||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,e=this._pos;if(!t||!e)return!1;const i=t.unproject(e),n=t.getFreeCameraOptions();if(!n.position)return!1;const s=n.position.toLngLat();return s.distanceTo(i)<.9*s.distanceTo(this._lngLat)}_evaluateOpacity(){const e=this._map;if(!e)return;const i=this._pos;if(!i||i.x<0||i.x>e.transform.width||i.y<0||i.y>e.transform.height)return void this._clearFadeTimer();const n=e.unproject(i);let s;e._showingGlobe()&&t.dc(e.transform,this._lngLat)?s=0:(s=1-e._queryFogOpacity(n),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(s*=this._occludedOpacity)),this._element.style.opacity=`${s}`,this._element.style.pointerEvents=s>0?"auto":"none",this._popup&&this._popup._setOpacity(s),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const e=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${Do[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${e.x}px,${e.y}px)\n        `}_calculateXYTransform(){const e=this._pos,i=this._map,n=this.getPitchAlignment();if(!i||!e||"map"!==n)return"";if(!i._showingGlobe()){const t=i.getPitch();return t?`rotateX(${t}deg)`:""}const s=t.b1(t.dd(i.transform,this._lngLat)),r=e.sub(t.de(i.transform)),o=Math.abs(r.x)+Math.abs(r.y);if(0===o)return"";const a=s/o;return`rotateX(${-r.y*a}deg) rotateY(${r.x*a}deg)`}_calculateZTransform(){const e=this._pos,i=this._map;if(!i||!e)return"";let n=0;const s=this.getRotationAlignment();if("map"===s)if(i._showingGlobe()){const e=i.project(new t.aJ(this._lngLat.lng,this._lngLat.lat+.001)),s=i.project(new t.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(e);n=t.b1(Math.atan2(s.y,s.x))-90}else n=-i.getBearing();else if("horizon"===s){const s=t.a0(4,6,i.getZoom()),r=t.de(i.transform);r.y+=s*i.transform.height;const o=e.sub(r),a=t.b1(Math.atan2(o.y,o.x));n=(a>90?a-270:a+90)*(1-s)}return n+=this._rotation,n?`rotateZ(${n}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const e=this._map;e&&(e.transform.renderWorldCopies&&(this._lngLat=jo(this._lngLat,this._pos,e.transform)),this._pos=e.project(this._lngLat),!0===t?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),e._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(e._showingGlobe()||e.getTerrain()||e.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(e){const i=this._map;if(!i)return;const n=this._pointerdownPos,s=this._positionDelta;if(n&&s){if(!this._isDragging){const t=this._clickTolerance||i._clickTolerance;if(e.point.dist(n)<t)return;this._isDragging=!0}this._pos=e.point.sub(s),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.g("dragstart"))),this.fire(new t.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.g("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map,i=this._pos;e&&i&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(i),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Po={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},No=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fo(e=new t.P(0,0),i="bottom"){if("number"==typeof e){const n=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(i){case"top":return new t.P(0,e);case"top-left":return new t.P(n,n);case"top-right":return new t.P(-n,n);case"bottom":return new t.P(0,-e);case"bottom-left":return new t.P(n,-n);case"bottom-right":return new t.P(-n,-n);case"left":return new t.P(e,0);case"right":return new t.P(-e,0)}return new t.P(0,0)}return e instanceof t.P||Array.isArray(e)?t.P.convert(e):t.P.convert(e[i]||[0,0])}class zo{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const i=t.bb((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,i){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+i}}const Lo={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class $o{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const Uo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},Bo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Go{constructor(e,i,n=!1){this._clickTolerance=10,this.element=i,this.mouseRotate=new Kr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,n&&(this.mousePitch=new Qr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),c()}move(t,e){const i=this.map,n=this.mouseRotate.mousemoveWindow(t,e),s=n&&n.bearingDelta;if(s&&i.setBearing(i.getBearing()+s),this.mousePitch){const n=this.mousePitch.mousemoveWindow(t,e),s=n&&n.pitchDelta;s&&i.setPitch(i.getPitch()+s)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){u(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.Q({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),d(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,d(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=p(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=p(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Ho={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vo={maxWidth:100,unit:"metric"},Wo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},qo={version:t.dw,supported:e,setRTLTextPlugin:t.dy,getRTLTextPluginStatus:t.dz,Map:class extends So{constructor(e){t.df.mark(t.dg.create);const i=e;if(null!=(e=t.Q({},Uo,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.dh(window)&&(e.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ui(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._repaint=!!e.repaint,this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._collectResourceTiming=e.collectResourceTiming,this._language=this._parseLanguage(e.language),this._worldview=e.worldview,this._renderTaskQueue=new Co,this._domRenderTaskQueue=new Co,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.di(),this._locale=t.Q({},Lo,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._performanceMetricsCollection=e.performanceMetricsCollection,this._tessellationStep=e.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=e.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new t.dj(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,this._contextCreateOptions=e.contextCreateOptions?{...e.contextCreateOptions}:{},"string"==typeof e.container){const t=document.getElementById(e.container);if(!t)throw new Error(`Container '${e.container.toString()}' not found.`);this._container=t}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new $o),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Eo(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,(e.style||!e.testMode)&&this.setStyle(e.style||t.db.DEFAULT_STYLE,{config:e.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),e.hash&&(this._hash=new kr("string"==typeof e.hash&&e.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch});const n=e.bounds;n&&(this.resize(),this.fitBounds(n,t.Q({},e.fitBoundsOptions,{duration:0})))}this.resize(),e.attributionControl&&this.addControl(new ko({customAttribution:e.customAttribution})),this._logoControl=new Io,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.g(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.g(`${e.dataType}dataloading`,e))}))}_getMapId(){return this._mapId}addControl(e,i){if(void 0===i&&(i=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=e.onAdd(this);this._controls.push(e);const s=this._controlPositions[i];return-1!==i.indexOf("bottom")?s.insertBefore(n,s.firstChild):s.appendChild(n),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(e);return i>-1&&this._controls.splice(i,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.g("movestart",e)).fire(new t.g("move",e)),this.fire(new t.g("resize",e)),i&&this.fire(new t.g("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.aj.convert(e)),this._update()}setMinZoom(e){if((e=e??-2)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.g("zoomstart")).fire(new t.g("zoom")).fire(new t.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=e??22)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.g("zoomstart")).fire(new t.g("zoom")).fire(new t.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=e??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.g("pitchstart")).fire(new t.g("pitch")).fire(new t.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=e??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.g("pitchstart")).fire(new t.g("pitch")).fire(new t.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return"auto"===t?navigator.language:Array.isArray(t)?0===t.length?void 0:t.map((t=>"auto"===t?navigator.language:t)):t}setLanguage(t){const e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(const t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const e=this.transform,i=e.projection.name;let n;"globe"===i&&e.zoom>=t.aV?(e.setMercatorFromTransition(),n=!0):"mercator"===i&&e.zoom<t.aV&&(e.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(e){let i;return i="globe"===e.name&&this.transform.zoom>=t.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(e),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(e){return this.transform.locationPoint3D(t.aJ.convert(e))}unproject(e){return this.transform.pointLocation3D(t.P.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,i){if("mouseenter"===t||"mouseover"===t){let n=!1;const s=s=>{const r=e.filter((t=>this.getLayer(t))),o=r.length?this.queryRenderedFeatures(s.point,{layers:r}):[];o.length?n||(n=!0,i.call(this,new Lr(t,this,s.originalEvent,{features:o}))):n=!1},r=()=>{n=!1};return{layers:new Set(e),listener:i,delegates:{mousemove:s,mouseout:r}}}if("mouseleave"===t||"mouseout"===t){let n=!1;const s=s=>{const r=e.filter((t=>this.getLayer(t)));(r.length?this.queryRenderedFeatures(s.point,{layers:r}):[]).length?n=!0:n&&(n=!1,i.call(this,new Lr(t,this,s.originalEvent)))},r=e=>{n&&(n=!1,i.call(this,new Lr(t,this,e.originalEvent)))};return{layers:new Set(e),listener:i,delegates:{mousemove:s,mouseout:r}}}{const n=t=>{const n=e.filter((t=>this.getLayer(t))),s=n.length?this.queryRenderedFeatures(t.point,{layers:n}):[];s.length&&(t.features=s,i.call(this,t),delete t.features)};return{layers:new Set(e),listener:i,delegates:{[t]:n}}}}on(t,e,i){if("function"==typeof e||void 0===i)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const n=this._createDelegatedListener(t,e,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(n);for(const t in n.delegates)this.on(t,n.delegates[t]);return this}once(t,e,i){if("function"==typeof e||void 0===i)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e)for(const t of e)if(!this._isValidId(t))return this;const n=this._createDelegatedListener(t,e,i);for(const t in n.delegates)this.once(t,n.delegates[t]);return this}off(t,e,i){if("function"==typeof e||void 0===i)return super.off(t,e);const n=new Set(Array.isArray(e)?e:[e]);for(const t of n)if(!this._isValidId(t))return this;const s=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[t]:void 0;return r&&(t=>{for(let e=0;e<t.length;e++){const r=t[e];if(r.listener===i&&s(r.layers,n)){for(const t in r.delegates)this.off(t,r.delegates[t]);return t.splice(e,1),this}}})(r),this}queryRenderedFeatures(e,i){if(!this.style)return[];if(void 0!==i||void 0===e||e instanceof t.P||Array.isArray(e)||(i=e,e=void 0),e=e||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const t of i.layers)if(!this._isValidId(t))return[];return this.style.queryRenderedFeatures(e,i,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(e){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&t.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(e))}setStyle(e,i){return i=t.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&e&&!1!==i.diff&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(e,((n,s)=>{n?(t.w(`Unable to perform style diff: ${String(n.message||n.error||n)}. Rebuilding the style from scratch.`),this._updateStyle(e,i)):s&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(e,i))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(e,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e){const n=t.Q({},i);i&&i.config&&(n.initialConfig=i.config,delete n.config),this.style=new Ar(this,n).load(e),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ar(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(e){return null==e?(this.fire(new t.f(new Error("IDs can't be empty."))),!1):!t.cY(e)||(this.fire(new t.f(new Error(`IDs can't contain special symbols: "${e}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(t,e,i){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,i)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(e,i,{pixelRatio:n=1,sdf:s=!1,stretchX:r,stretchY:o,content:a}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:h,height:c,data:u}=t.e.getImageData(i);this.style.addImage(e,{data:new t.j({width:h,height:c},u),pixelRatio:n,stretchX:r,stretchY:o,content:a,sdf:s,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new t.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:h,height:c}=i,u=i;this.style.addImage(e,{data:new t.j({width:h,height:c},new Uint8Array(u.data)),pixelRatio:n,stretchX:r,stretchY:o,content:a,sdf:s,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,i){this._lazyInitEmptyStyle();const n=this.style.getImage(e);if(!n)return void this.fire(new t.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?t.e.getImageData(i):i,{width:r,height:o,data:a}=s;if(void 0===r||void 0===o)return void this.fire(new t.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(r!==n.data.width||o!==n.data.height)return void this.fire(new t.f(new Error(`The width and height of the updated image (${r}, ${o})\n                must be that same as the previous version of the image\n                (${n.data.width}, ${n.data.height})`)));const h=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);n.data.replace(a,h),this.style.updateImage(e,n)}hasImage(e){return e?!!this.style&&!!this.style.getImage(e):(this.fire(new t.f(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,i){t.i(this._requestManager.transformRequest(e,t.R.Image),((e,n)=>{i(e,n instanceof HTMLImageElement?t.e.getImageData(n):n)}))}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(e){return e?this.style.hasModel(e):(this.fire(new t.f(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}getSlot(t){const e=this.getLayer(t);return e&&e.slot||null}setSlot(t,e){return this.style.setSlot(t,e),this.style.mergeLayers(),this._update(!0)}addImport(t,e){return this.style.addImport(t,e),this}updateImport(t,e){return"string"!=typeof e&&e.id!==t?(this.removeImport(t),this.addImport(e)):(this.style.updateImport(t,e),this._update(!0))}removeImport(t){return this.style.removeImport(t),this}moveImport(t,e){return this.style.moveImport(t,e),this._update(!0)}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){if(!this._isValidId(t))return null;const e=this.style.getOwnLayer(t);return e?"custom"===e.type?e.implementation:e.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(t,e,i){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,i),this._update(!0)):this}setFilter(t,e,i={}){return this._isValidId(t)?(this.style.setFilter(t,e,i),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,i,n={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,i,n),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,i,n={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,i,n),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getSchema(t){return this.style.getSchema(t)}setSchema(t,e){return this.style.setSchema(t,e),this._update(!0)}getConfig(t){return this.style.getConfig(t)}setConfig(t,e){return this.style.setConfig(t,e),this._update(!0)}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,i){return this.style.setConfigProperty(t,e,i),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&1===t.length&&"flat"===t[0].type){const e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const t=this.style.getLights()||[];return 0===t.length&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(t){return this._lazyInitEmptyStyle(),this.style.setColorTheme(t),this._update(!0)}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===t["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.aJ.convert(e),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;const t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300;let i,n,s,r=this._container;for(;r&&(!n||!s);){const t=window.getComputedStyle(r).transform;t&&"none"!==t&&(i=t.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(n=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(s=i[3])),r=r.parentElement}this._containerWidth=n?Math.abs(t/n):t,this._containerHeight=s?Math.abs(e/s):e}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=s("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=s("div","mapboxgl-canvas-container",t);this._canvas=s("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=s("div","mapboxgl-control-container",t),n=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((t=>{n[t]=s("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,i){const n=t.e.devicePixelRatio||1;this._canvas.width=n*Math.ceil(e),this._canvas.height=n*Math.ceil(i),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${i}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){const e=this._popups.indexOf(t);-1!==e&&this._popups.splice(e,1)}_setupPainter(){const i=t.Q({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",i);n?(t.dk(n,!0),this.painter=new Os(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",(t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)})),t.dl.testSupport(n)):this.fire(new t.f(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.g("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.g("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let i;this.fire(new t.g("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,s=t.e.now(),r=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=r.createQuery(),r.beginQuery(n.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,i=this.transform.pitch,n=t.e.now(),s=new t.Y(e,{now:n,fadeDuration:o,pitch:i,transition:this.style.transition});this.style.update(s)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(s),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):a=this._updateAverageElevation(s);const h=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions,this.painter.replacementSource);if(h&&(this._placementDirty=h.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.df.mark(t.dg.load),this.fire(new t.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const e=t.e.now()-s;r.endQuery(n.TIME_ELAPSED_EXT),setTimeout((()=>{const n=r.getQueryParameter(i,r.QUERY_RESULT)/1e6;r.deleteQuery(i),this.fire(new t.g("gpu-timing-frame",{cpuTime:e,gpuTime:n}))}),50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(e);this.fire(new t.g("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const e=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(e);this.fire(new t.g("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const c=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(c||this._repaint)this.triggerRepaint();else{const e=this.idle();if(e&&(a=this._updateAverageElevation(s,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.g("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,t.df.mark(t.dg.fullLoad),this._performanceMetricsCollection&&t.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(const e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(const e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){const i=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let s=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(s)?s=0:this._averageElevationLastSampledAt=t;const r=Math.abs(e-s);if(r>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(s),i(s);this._averageElevation.easeTo(s,t,300)}else if(r>1e-4)return this._averageElevation.jumpTo(s),i(s)}return!!this._averageElevation.isEasing(t)&&i(this._averageElevation.getValue(t))}_authenticate(){t.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(e=>{if(e&&(e.message===t.dp||401===e.status)){const e=this.painter.context.gl;t.dk(e,!1),this._logoControl instanceof Io&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),t.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&t.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const i=this.painter.context.gl,n=i.createFramebuffer();function s(t){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,t,0);const e=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,e),e}return i.bindFramebuffer(i.FRAMEBUFFER,n),this._canvasPixelComparison(s(t),e.canvasCopies.map(s),e.timeStamps)}_canvasPixelComparison(t,e,i){let n=i[1]-i[0];const s=t.length/4;for(let r=0;r<e.length;r++){const o=e[r];let a=0;for(let e=0;e<o.length;e+=4)o[e]===t[e]&&o[e+1]===t[e+1]&&o[e+2]===t[e+2]&&o[e+3]===t[e+3]&&(a+=1);n+=(i[r+2]-i[r+1])*(1-a/s)}return n}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),t.ds(this.painter.context.gl),t.dt.remove(),t.du.remove(),this._removed=!0,this.fire(new t.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.e.frame((t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)})))}_preloadTiles(e){const i=this.style?this.style.getSourceCaches():[];return t.dv(i,((t,i)=>t._preloadTiles(e,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(t){this._showParseStatus!==t&&(this._showParseStatus=t,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this._tp.refreshUI(),t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,this._tp.refreshUI(),t&&this._update())}_setCacheLimits(e,i){t.dx(e,i)}get version(){return t.dw}},NavigationControl:class{constructor(e={}){this.options=t.Q({},Bo,e),this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(t.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),s("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),s("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))})),this._compassIcon=s("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),i=e===t.getMaxZoom(),n=e===t.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=e)}))}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Go(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const i=s("button",t,this._container);return i.type="button",i.addEventListener("click",e),i}_setButtonTitle(t,e){if(!this._map)return;const i=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",i),t.firstElementChild&&t.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends t.E{constructor(e={}){super();const i=navigator.geolocation;this.options=t.Q({geolocation:i},Ho,e),t.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Sr(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){const e=(e=!!this.options.geolocation)=>{this._supportsGeolocation=e,t(e)};void 0!==this._supportsGeolocation?t(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((t=>e("denied"!==t.state))).catch((()=>e())):e()}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),i=t.coords;return!!e&&(i.longitude<e.getWest()||i.longitude>e.getEast()||i.latitude<e.getSouth()||i.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.g("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.g("geolocate",e)),this._finish()}}_updateCamera(e){const i=new t.aJ(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,s=this._map.getBearing(),r=t.Q({bearing:s},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(n),r,{geolocateSource:!0})}_updateMarker(e){if(e){const i=new t.aJ(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const e=this._map.transform,i=t.ay(1,e._center.lat)*e.worldSize,n=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.g("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=s("button","mapboxgl-ctrl-geolocate",this._container),s("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s("div","mapboxgl-user-location"),this._dotElement.appendChild(s("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(s("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ro({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=s("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ro({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.g("trackuserlocationend")))}))}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const t=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e&&t()})).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ko,ScaleControl:class{constructor(e={}){this.options=t.Q({},Vo,e),this._isNumberFormatSupported=function(){try{return!0}catch(t){return!1}}(),t.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const t=this.options.maxWidth||100,e=this._map,i=e._containerHeight/2,n=e._containerWidth/2-t/2,s=e.unproject([n,i]),r=e.unproject([n+t,i]),o=s.distanceTo(r);if("imperial"===this.options.unit){const e=3.2808*o;e>5280?this._setScale(t,e/5280,"mile"):this._setScale(t,e,"foot")}else"nautical"===this.options.unit?this._setScale(t,o/1852,"nautical-mile"):o>=1e3?this._setScale(t,o/1e3,"kilometer"):this._setScale(t,o,"meter")}_setScale(t,e,i){this._map._requestDomTask((()=>{const n=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(i),e*i}(e),s=n/e;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(n):`${n}&nbsp;${Wo[i]}`,this._container.style.width=t*s+"px"}))}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=s("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(e={}){this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),t.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=s("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const t=this._fullscreenButton=s("button","mapboxgl-ctrl-fullscreen",this._controlContainer);s("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(e){super(),this.options=t.Q(Object.create(Po),e),t.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),e._addPopup(this),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),e._canvasContainer&&e._canvasContainer.classList.remove("mapboxgl-track-pointer"),e._removePopup(this),this._map=void 0),this.fire(new t.g("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.aJ.convert(e),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(document.createTextNode(t))}setHTML(t){const e=document.createDocumentFragment(),i=document.createElement("body");let n;for(i.innerHTML=t;n=i.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=s("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=s("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,i=this._container,n=this._pos;if(!e||!i||!n)return"bottom";const s=i.offsetWidth,r=i.offsetHeight,o=n.x<s/2,a=n.x>e.transform.width-s/2;if(n.y+t<r)return o?"top-left":a?"top-right":"top";if(n.y>e.transform.height-r){if(o)return"bottom-left";if(a)return"bottom-right"}return o?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(e){const i=this._map,n=this._content;if(!i||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=s("div","mapboxgl-popup",i.getContainer()),this._tip=s("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=jo(this._lngLat,this._pos,i.transform)),!this._trackPointer||e){const n=this._pos=this._trackPointer&&e instanceof t.P?e:i.project(this._lngLat),s=Fo(this.options.offset),r=this._anchor=this._getAnchor(s.y),o=Fo(this.options.offset,r),a=n.add(o).round();i._requestDomTask((()=>{this._container&&r&&(this._container.style.transform=`${Do[r]} translate(${a.x}px,${a.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const e=t.dc(i.transform,this._lngLat)?0:1;this._setOpacity(e)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(No);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:Ro,Style:Ar,LngLat:t.aJ,LngLatBounds:t.aj,Point:t.P,MercatorCoordinate:t._,FreeCameraOptions:Ge,Evented:t.E,config:t.db,prewarm:t.dA,clearPrewarmedResources:t.dB,get accessToken(){return t.db.ACCESS_TOKEN},set accessToken(e){t.db.ACCESS_TOKEN=e},get baseApiUrl(){return t.db.API_URL},set baseApiUrl(e){t.db.API_URL=e},get workerCount(){return t.dC.workerCount},set workerCount(e){t.dC.workerCount=e},get maxParallelImageRequests(){return t.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.db.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.dD(e)},get workerUrl(){return t.dE.workerUrl},set workerUrl(e){t.dE.workerUrl=e},get workerClass(){return t.dE.workerClass},set workerClass(e){t.dE.workerClass=e},get workerParams(){return t.dE.workerParams},set workerParams(e){t.dE.workerParams=e},get dracoUrl(){return t.dF()},set dracoUrl(e){t.dG(e)},get meshoptUrl(){return t.dH()},set meshoptUrl(e){t.dI(e)},setNow:t.e.setNow,restoreNow:t.e.restoreNow};return qo}));var s=i;return s}))})(BN);const GN=xt(BN.exports);class HN{constructor(t){this.plantID=t&&t.plantID?t.plantID:t&&t.plant_ID?t.plant_ID:null;this.fullName=t&&t.fullName?t.fullName:t&&t.plant_name_en?t.plant_name_en:null;this.fullNameOther=t&&t.fullNameOther?t.fullNameOther:t&&t.plant_name_other?t.plant_name_other:null;this.shortName=t&&t.shortName?t.shortName:null;this.otherPlantName=t&&t.otherPlantName?t.otherPlantName:t&&t.other_plant_name_en?t.other_plant_name_en:null;this.otherPlantNameOther=t&&t.otherPlantNameOther?t.otherPlantNameOther:t&&t.other_plant_name_other?t.other_plant_name_other:null;this.coverURL=t&&t.coverURL?t.coverURL:null;this.typeId=t&&t.typeId?t.typeId:null;this.locations=[];t&&t.locations?t.locations.forEach((t=>{this.locations.push(new G(t))})):undefined;this.conditions=t&&t.conditions?new H(t.conditions):{EAF:[],LF:[],CCM:[]};this.productionData=t&&t.productionData?new V(t.productionData):new V;this.group=[];if(t&&t.group){t.group.forEach((t=>{const e={groupId:t.groupId?t.groupId:null,groupName:t.groupName?t.groupName:null,groupOwnershipPerc:t.groupOwnershipPerc?dt.exports.toNumber(t.groupOwnershipPerc):null};this.group.push(e)}))}this.owner={groupId:t&&t.owner&&t.owner.groupId?t.owner.groupId:null,groupName:t&&t.owner&&t.owner.groupName?t.owner.groupName:null,groupOwnershipPerc:null};this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}}class VN{constructor(t){this.groupId=t&&t.groupId?t.groupId:null;this.groupName=t&&t.groupName?t.groupName:null;this.groupOwnershipPerc=t&&t.groupOwnershipPerc?dt.exports.toNumber(t.groupOwnershipPerc):null}}class WN{constructor(t){this.typeId=t&&t.typeId?t.typeId:null;this.typeName=t&&t.typeName?t.typeName:null}}class qN{constructor(t){this.locationId=t&&t.locationId?t.locationId:null;this.locationName=t&&t.locationName?t.locationName:null}}class YN{constructor(t){this.customerGroups=t&&t.customerGroups?t.customerGroups:[];this.customerTypes=t&&t.customerTypes?t.customerTypes:[];this.customerLocationTypes=t&&t.customerLocationTypes?t.customerLocationTypes:[];this.oldCustomersIds=t&&t.oldCustomersIds?t.oldCustomersIds:[]}}class XN{constructor(t){this.locations=[];if(t){Object.keys(t).forEach((e=>{if(e=="location"){this.locations=[];if(this[e].lat&&this[e].lon)this.locations.push(new G(this[e]))}else{this[e]=t[e]}}))}}getLngLat(){const t=[];this.locations.map((e=>{if(e.position&&e.position.geopoint)t.push(new BN.exports.LngLat(e.position.geopoint.longitude,e.position.geopoint.latitude))}));return t}}const ZN="customers";class JN{constructor(){this.customersList=[];this.customersList$=new L([]);this.customerGroups=[];this.customerTypes=[];this.customerLocationTypes=[];this.serviceInit=true;this.customersIndex=0}init(){if(this.serviceInit){this.serviceInit=false;nz.mapDataSub$.subscribe((()=>{const t=nz.getCollectionArray(ZN);if(t&&t.length>0){this.customersList=t;this.customersList$.next(this.customersList)}else{this.customersList$.next([])}}));this.downloadCustomerSettings()}}getMapData(t){const e={};if(t&&Object.keys(t)){Object.keys(t).forEach((i=>{e[i]=new XN(t[i])}))}return e}async presentCustomerUpdate(t){return await pP.openModal("modal-customer-update",{customerId:t})}async presentCustomerDetails(t){pP.push("/"+ZN+"/"+t,"forward")}async getCustomer(t){const e=new HN(await $L.getDocument(ZN,t));return e}async updateCustomer(t,e,i){return $L.saveItem(t,e,i,ZN)}async deleteCustomer(t){return new Promise((async(e,i)=>{const n=await pt.create({header:aP.getTransl("delete-customer-header","Delete Customer?"),message:aP.getTransl("delete-customer-message","This customer will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{i()}},{text:aP.getTransl("ok","OK"),handler:async()=>{$L.deleteItem(ZN,t);pP.goBack();e(null)}}]});n.present()}))}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(ZN,t,e,i)}getCustomersDetails(t){if(this.customersList.length>0){return this.customersList.find((e=>e.id==t))}else{return null}}createMapData(t,e){const i=[];e.locations.forEach((t=>{i.push({type:t.type,position:t.position})}));return new XN({id:t,fullName:e.fullName,photoURL:e.photoURL,coverURL:e.coverURL,locations:i})}getCustomerGroups(t){if(t){return[this.customerGroups.find((e=>e.groupId==t))]}else{return dt.exports.orderBy(this.customerGroups,["groupName"],"asc")}}getLocationsTypes(t){if(t){return[this.customerLocationTypes.find((e=>e.locationId==t))]}else{return this.customerLocationTypes}}getCustomerTypes(t){if(t){return[this.customerTypes.find((e=>e.typeId==t))]}else{return this.customerTypes}}async editCustomerGroups(){return await pP.openModal("modal-customer-group")}async editCustomerTypes(){return await pP.openModal("modal-customer-type")}async editCustomerLocationTypes(){return await pP.openModal("modal-customer-location-type")}async openSelectCustomer(t){return new Promise((async e=>{const i=await pP.openModal("modal-search-list",{list:this.customersList,item:t,searchTitle:{tag:"customer",text:"Customer"},showField:"fullName",filterBy:["fullName"],orderBy:["fullName"],placeholder:"Search by customer name"});i.onDidDismiss().then((async t=>{if(t){e(t.data)}}));i.present()}))}async downloadCustomerSettings(){let t=new YN;try{t=await $L.getDocument(ZN,NL)}catch(t){}const e=[];t.customerGroups.forEach((t=>{e.push(new VN(t))}));this.customerGroups=dt.exports.orderBy(e,["groupName"]);const i=[];t.customerTypes.forEach((t=>{i.push(new WN(t))}));this.customerTypes=dt.exports.orderBy(i,["typeName"]);const n=[];t.customerLocationTypes.forEach((t=>{n.push(new qN(t))}));this.customerLocationTypes=dt.exports.orderBy(n,["locationName"]);return t}async uploadCustomerSettings(){await $L.updateDocument(ZN,NL,{customerGroups:this.customerGroups,customerTypes:this.customerTypes,customerLocationTypes:this.customerLocationTypes})}async uploadCustomerSettingsDoc(t,e){await $L.updateDocument(ZN,t,e)}async uploadCustomerGroups(t){this.customerGroups=t;await this.uploadCustomerSettings()}async uploadCustomerTypes(t){this.customerTypes=t;await this.uploadCustomerSettings()}async uploadCustomerLocationTypes(t){this.customerLocationTypes=t;await this.uploadCustomerSettings()}}const KN=new JN;class QN{constructor(t){this.public=false;this.id=t&&t.id?t.id:KR();this.order=t&&t.order?t.order:0;this.title=t&&t.title?t.title:null;this.subtitle=t&&t.subtitle?t.subtitle:null;this.description=t&&t.description?t.description:null;this.type=t&&t.type&&this.checkType(t.type)?t.type:null;this.name=t&&t.name?t.name:null;this.size=t&&t.size?t.size:null;this.url=t&&t.url?t.url:null;this.lastModified=t&&t.lastModified?t.lastModified:null;this.public=t&&t.public?true:false}setType(t){if(this.checkType(t)){this.type=t}}getTypes(){return["image/jpg","image/jpeg","image/png","video/mp4","video/mov","application/pdf"]}checkType(t){return this.getTypes().includes(t)}}class tF{constructor(t){this.shapeTypeId_operator="=";this.shapeTypeId=t&&t.shapeTypeId?t.shapeTypeId:null;this.H=t&&t.H?dt.exports.toNumber(t.H):null;this.H_operator=t&&t.H_operator?t.H_operator:"=";this.L=t&&t.L?dt.exports.toNumber(t.L):null;this.L_operator=t&&t.L_operator?t.L_operator:"=";this.A=t&&t.A?dt.exports.toNumber(t.A):null;this.A_operator=t&&t.A_operator?t.A_operator:"=";this.B=t&&t.B?dt.exports.toNumber(t.B):null;this.B_operator=t&&t.B_operator?t.B_operator:"="}isActive(){return this.shapeTypeId!=null||this.H>0||this.A>0||this.L>0||this.B>0}}class eF{constructor(t){this.shapeTypeId=t&&t.shapeTypeId?t.shapeTypeId:null;this.shapeName=t&&t.shapeName?t.shapeName:null;this.shapeShortName=t&&t.shapeShortName?t.shapeShortName:null;this.produce=t&&t.produce?true:false;this.H=t&&t.H?dt.exports.toNumber(t.H):null;this.H1=t&&t.H1?dt.exports.toNumber(t.H1):null;this.H2=t&&t.H2?dt.exports.toNumber(t.H2):null;this.L=t&&t.L?dt.exports.toNumber(t.L):null;this.L1=t&&t.L1?dt.exports.toNumber(t.L1):null;this.A=t&&t.A?dt.exports.toNumber(t.A):null;this.A1=t&&t.A1?dt.exports.toNumber(t.A1):null;this.B=t&&t.B?dt.exports.toNumber(t.B):null;this.B1=t&&t.B1?dt.exports.toNumber(t.B1):null;this.La=t&&t.La?dt.exports.toNumber(t.La):null;this.Lb=t&&t.Lb?dt.exports.toNumber(t.Lb):null;this.ANG=t&&t.ANG?dt.exports.toNumber(t.ANG):null;this.ANG1=t&&t.ANG1?dt.exports.toNumber(t.ANG1):null;this.D=t&&t.D?dt.exports.toNumber(t.D):null;this.Di=t&&t.Di?dt.exports.toNumber(t.Di):null;this.De=t&&t.De?dt.exports.toNumber(t.De):null;this.D1=t&&t.D1?dt.exports.toNumber(t.D1):null;this.D2=t&&t.D2?dt.exports.toNumber(t.D2):null;this.D3=t&&t.D3?dt.exports.toNumber(t.D3):null;this.D4=t&&t.D4?dt.exports.toNumber(t.D4):null;this.N=t&&t.N?dt.exports.toNumber(t.N):null;this.radius=t&&t.radius?dt.exports.toNumber(t.radius):null;this.radius_max=t&&t.radius_max?dt.exports.toNumber(t.radius_max):null;this.volume=t&&t.volume?dt.exports.toNumber(t.volume):null;this.decimals=t&&t.decimals?dt.exports.toNumber(t.decimals):2;this.dwg=t&&t.dwg?new QN(t.dwg):null;this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}getWeight(t){return t>0?QR(this.getVolume()*parseFloat(t),this.decimals):0}getWeightForVolume(t,e){return e>0?QR(parseFloat(t)*parseFloat(e),this.decimals):0}getVolume(){return QR((this.A+this.B)*this.L/2*this.H/1e6,this.decimals)}getInternalRadius(){if(this.A>0&&this.B>0&&this.H>0&&this.L>0){const t=this.B*this.H/(this.A-this.B);return QR(t,0)}return 0}getExternalRadius(){if(this.A>0&&this.B>0&&this.H>0&&this.L>0){const t=this.A*this.H/(this.A-this.B);return QR(t,0)}return 0}getDimensions(){return this.L+"x"+this.H+"x"+this.A+"/"+this.B}}class iF{constructor(t){this.shapeTypes=t&&t.shapeTypes?t.shapeTypes:[]}}class nF{constructor(t){this.position=t&&t.position?dt.exports.toNumber(t.position):1;this.typeId=t&&t.typeId?t.typeId:"";this.typeName=t&&t.typeName?tP(t.typeName):{en:null};this.decimals=t&&t.decimals?t.decimals:2;this.dwg=t&&t.dwg?new QN(t.dwg):new QN}}class sF{constructor(t){this.areaIndex=t&&t.areaIndex>=0?t.areaIndex:null;this.shapes=t&&t.shapes?t.shapes:[]}}class rF{constructor(t){if(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))}}}class oF{constructor(t){this.setsAmount=1;this.liquidMetalDensity=7.04;this.projectLocalId=t&&t.projectLocalId?t.projectLocalId:null;this.docsCaption=t&&t.docsCaption?t.docsCaption:null;this.projectDescription=t&&t.projectDescription?t.projectDescription:null;this.drawing=t&&t.drawing?t.drawing:null;this.drawingDate=t&&t.drawingDate&&nP(t.drawingDate)?new Date(t.drawingDate).toISOString():(new Date).toISOString();this.finishedDate=t&&t.finishedDate&&nP(t.finishedDate)?new Date(t.finishedDate).toISOString():(new Date).toISOString();this.customerId=t&&t.customerId?t.customerId:null;this.setsAmount=t&&t.setsAmount?dt.exports.toNumber(t.setsAmount):1;this.unitCapacity=t&&t.unitCapacity?t.unitCapacity:null;this.applicationId=t&&t.applicationId?t.applicationId:t&&t.applicationUnitId?t.applicationUnitId:null;this.guaranteedLife=t&&t.guaranteedLife?t.guaranteedLife:null;this.steelAmount=t&&t.steelAmount?dt.exports.toNumber(t.steelAmount):null;this.liquidMetalDensity=t&&t.liquidMetalDensity?dt.exports.toNumber(t.liquidMetalDensity):7.04;this.projectAreaQuality=[];if(t&&t.projectAreaQuality){t.projectAreaQuality.forEach((t=>{this.projectAreaQuality.push(new aF(t))}))}this.projectMass=[];if(t&&t.projectMass){t.projectMass.forEach((t=>{this.projectMass.push(new pF(t))}))}this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}}class aF{constructor(t){this.includeSafety=0;this.onlyForRepair=false;this.datasheetId="";this.density=0;this.shapes=[];this.courses=[];if(t){Object.keys(t).forEach((e=>{if(e=="courses"){this.courses=[];if(t.courses)t.courses.forEach((t=>{this.courses.push(new dF(t))}))}else if(e=="onlyForRepair"){const i=t[e];this.onlyForRepair=i==1?true:i===true?true:false}else if(e=="density"||e=="includeSafety"){this[e]=dt.exports.toNumber(t[e])}else if(e=="autoFillCourses"){this[e]=new _F(t[e])}else if(e=="shapes"){this.shapes=[];t[e].forEach((t=>{if(t.shapeId!=="other_empty"){this.shapes.push(new hF(t))}}))}else{this[e]=t[e]}}))}}}class hF{constructor(t){this.position=t&&t.position?dt.exports.toNumber(t.position):null;this.shapeId=t&&t.shapeId?this.validateLegacyShape(t.shapeId):null;this.specialShapeVolume=t&&t.specialShapeVolume?dt.exports.toNumber(t.specialShapeVolume):0}validateLegacyShape(t){return t.replace(".","_").replace(".","_").replace(".","_").replace("(","").replace(")","").replace("[","").replace("]","")}}class cF{constructor(t){this.bricksAllocationArea=t&&t.bricksAllocationArea?t.bricksAllocationArea:[];this.applicationUnits=t&&t.applicationUnits?t.applicationUnits:[];this.quantityUnits=t&&t.quantityUnits?t.quantityUnits:[]}}class uF{constructor(t){this.bricksAllocationAreaId=t&&t.bricksAllocationAreaId?t.bricksAllocationAreaId:null;this.bricksAllocationAreaName=t&&t.bricksAllocationAreaName?tP(t.bricksAllocationAreaName):{en:null}}}class lF{constructor(t){this.applicationId=t&&t.applicationId?t.applicationId:null;this.applicationName=t&&t.applicationName?tP(t.applicationName):{en:null};this.applicationAssociatedGoodsDesc=t&&t.applicationAssociatedGoodsDesc?tP(t.applicationAssociatedGoodsDesc):{en:null};this.applicationPackingDesc=t&&t.applicationPackingDesc?tP(t.applicationPackingDesc):{en:null}}}class fF{constructor(t){this.quantityUnitName=t&&t.quantityUnitName?tP(t.quantityUnitName):{en:null};this.quantityUnitId=t&&t.quantityUnitId?t.quantityUnitId:null}}class dF{constructor(t){this.courseNumber=0;this.layer=0;this.startAngle=0;this.endAngle=360;this.widthAngle=360;this.height=0;this.innerRadius=0;this.quantityShapes=[];this.repairSets=0;if(t){Object.keys(t).forEach((e=>{if(e=="quantityShapes"){this.quantityShapes=[];t.quantityShapes.forEach((t=>{if(t.shapeId!=="other_empty"){this.quantityShapes.push({shapeId:this.validateLegacyShape(t.shapeId),quantity:dt.exports.toNumber(t.quantity)})}}))}else{this[e]=dt.exports.toNumber(t[e])}}))}}validateLegacyShape(t){if(t)return t.replace(".","_").replace(".","_").replace(".","_").replace("(","").replace(")","").replace("[","").replace("]","");else return null}}class pF{constructor(t){if(t){Object.keys(t).forEach((e=>{if(e=="bricksAllocationAreaId"||e=="quantityUnit"||e=="datasheetId"){this[e]=t[e]}else{this[e]=dt.exports.toNumber(t[e])}}))}}}class mF{constructor(t){if(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))}}}class _F{constructor(t){this.fromCourse=0;this.step=1;this.layer=0;this.startAngle=0;this.endAngle=360;this.startHeight=0;this.startRadius=0;this.radiusStep=0;this.repairSets=0;this.quantityShape=[];if(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))}}}var vF={exports:{}};
/*! ExcelJS 19-10-2023 */(function(t,e){!function(e){t.exports=e()}((function(){return function t(e,i,n){function s(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof Mt&&Mt;if(!a&&h)return h(o,!0);if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};e[o][0].call(u.exports,(function(t){return s(e[o][1][t]||t)}),u,u.exports,t,e,i,n)}return i[o].exports}for(var r="function"==typeof Mt&&Mt,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){const n=t("fs"),s=t("fast-csv"),r=t("dayjs/plugin/customParseFormat"),o=t("dayjs/plugin/utc"),a=t("dayjs").extend(r).extend(o),h=t("../utils/stream-buf"),{fs:{exists:c}}=t("../utils/utils"),u={true:!0,false:!1,"#N/A":{error:"#N/A"},"#REF!":{error:"#REF!"},"#NAME?":{error:"#NAME?"},"#DIV/0!":{error:"#DIV/0!"},"#NULL!":{error:"#NULL!"},"#VALUE!":{error:"#VALUE!"},"#NUM!":{error:"#NUM!"}};e.exports=class{constructor(t){this.workbook=t,this.worksheet=null}async readFile(t,e){if(e=e||{},!await c(t))throw new Error("File not found: "+t);const i=n.createReadStream(t),s=await this.read(i,e);return i.close(),s}read(t,e){return e=e||{},new Promise(((i,n)=>{const r=this.workbook.addWorksheet(e.sheetName),o=e.dateFormats||["YYYY-MM-DD[T]HH:mm:ssZ","YYYY-MM-DD[T]HH:mm:ss","MM-DD-YYYY","YYYY-MM-DD"],h=e.map||function(t){if(""===t)return null;const e=Number(t);if(!Number.isNaN(e)&&e!==1/0)return e;const i=o.reduce(((e,i)=>{if(e)return e;const n=a(t,i,!0);return n.isValid()?n:null}),null);if(i)return new Date(i.valueOf());const n=u[t];return void 0!==n?n:t},c=s.parse(e.parserOptions).on("data",(t=>{r.addRow(t.map(h))})).on("end",(()=>{c.emit("worksheet",r)}));c.on("worksheet",i).on("error",n),t.pipe(c)}))}createInputStream(){throw new Error("`CSV#createInputStream` is deprecated. You should use `CSV#read` instead. This method will be removed in version 5.0. Please follow upgrade instruction: https://github.com/exceljs/exceljs/blob/master/UPGRADE-4.0.md")}write(t,e){return new Promise(((i,n)=>{e=e||{};const r=this.workbook.getWorksheet(e.sheetName||e.sheetId),o=s.format(e.formatterOptions);t.on("finish",(()=>{i()})),o.on("error",n),o.pipe(t);const{dateFormat:h,dateUTC:c}=e,u=e.map||(t=>{if(t){if(t.text||t.hyperlink)return t.hyperlink||t.text||"";if(t.formula||t.result)return t.result||"";if(t instanceof Date)return h?c?a.utc(t).format(h):a(t).format(h):c?a.utc(t).format():a(t).format();if(t.error)return t.error;if("object"==typeof t)return JSON.stringify(t)}return t}),l=void 0===e.includeEmptyRows||e.includeEmptyRows;let f=1;r&&r.eachRow(((t,e)=>{if(l)for(;f++<e-1;)o.write([]);const{values:i}=t;i.shift(),o.write(i.map(u)),f=e})),o.end()}))}writeFile(t,e){const i={encoding:(e=e||{}).encoding||"utf8"},s=n.createWriteStream(t,i);return this.write(s,e)}async writeBuffer(t){const e=new h;return await this.write(e,t),e.read()}}},{"../utils/stream-buf":24,"../utils/utils":27,dayjs:391,"dayjs/plugin/customParseFormat":392,"dayjs/plugin/utc":393,"fast-csv":424,fs:216}],2:[function(t,e,i){const n=t("../utils/col-cache");class s{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(this.worksheet=t,e)if("string"==typeof e){const t=n.decodeAddress(e);this.nativeCol=t.col+i,this.nativeColOff=0,this.nativeRow=t.row+i,this.nativeRowOff=0}else void 0!==e.nativeCol?(this.nativeCol=e.nativeCol||0,this.nativeColOff=e.nativeColOff||0,this.nativeRow=e.nativeRow||0,this.nativeRowOff=e.nativeRowOff||0):void 0!==e.col?(this.col=e.col+i,this.row=e.row+i):(this.nativeCol=0,this.nativeColOff=0,this.nativeRow=0,this.nativeRowOff=0);else this.nativeCol=0,this.nativeColOff=0,this.nativeRow=0,this.nativeRowOff=0}static asInstance(t){return t instanceof s||null==t?t:new s(t)}get col(){return this.nativeCol+Math.min(this.colWidth-1,this.nativeColOff)/this.colWidth}set col(t){this.nativeCol=Math.floor(t),this.nativeColOff=Math.floor((t-this.nativeCol)*this.colWidth)}get row(){return this.nativeRow+Math.min(this.rowHeight-1,this.nativeRowOff)/this.rowHeight}set row(t){this.nativeRow=Math.floor(t),this.nativeRowOff=Math.floor((t-this.nativeRow)*this.rowHeight)}get colWidth(){return this.worksheet&&this.worksheet.getColumn(this.nativeCol+1)&&this.worksheet.getColumn(this.nativeCol+1).isCustomWidth?Math.floor(1e4*this.worksheet.getColumn(this.nativeCol+1).width):64e4}get rowHeight(){return this.worksheet&&this.worksheet.getRow(this.nativeRow+1)&&this.worksheet.getRow(this.nativeRow+1).height?Math.floor(1e4*this.worksheet.getRow(this.nativeRow+1).height):18e4}get model(){return{nativeCol:this.nativeCol,nativeColOff:this.nativeColOff,nativeRow:this.nativeRow,nativeRowOff:this.nativeRowOff}}set model(t){this.nativeCol=t.nativeCol,this.nativeColOff=t.nativeColOff,this.nativeRow=t.nativeRow,this.nativeRowOff=t.nativeRowOff}}e.exports=s},{"../utils/col-cache":19}],3:[function(t,e,i){const n=t("../utils/col-cache"),s=t("../utils/under-dash"),r=t("./enums"),{slideFormula:o}=t("../utils/shared-formula"),a=t("./note");class h{constructor(t,e,i){if(!t||!e)throw new Error("A Cell needs a Row");this._row=t,this._column=e,n.validateAddress(i),this._address=i,this._value=c.create(h.Types.Null,this),this.style=this._mergeStyle(t.style,e.style,{}),this._mergeCount=0}get worksheet(){return this._row.worksheet}get workbook(){return this._row.worksheet.workbook}destroy(){delete this.style,delete this._value,delete this._row,delete this._column,delete this._address}get numFmt(){return this.style.numFmt}set numFmt(t){this.style.numFmt=t}get font(){return this.style.font}set font(t){this.style.font=t}get alignment(){return this.style.alignment}set alignment(t){this.style.alignment=t}get border(){return this.style.border}set border(t){this.style.border=t}get fill(){return this.style.fill}set fill(t){this.style.fill=t}get protection(){return this.style.protection}set protection(t){this.style.protection=t}_mergeStyle(t,e,i){const n=t&&t.numFmt||e&&e.numFmt;n&&(i.numFmt=n);const s=t&&t.font||e&&e.font;s&&(i.font=s);const r=t&&t.alignment||e&&e.alignment;r&&(i.alignment=r);const o=t&&t.border||e&&e.border;o&&(i.border=o);const a=t&&t.fill||e&&e.fill;a&&(i.fill=a);const h=t&&t.protection||e&&e.protection;return h&&(i.protection=h),i}get address(){return this._address}get row(){return this._row.number}get col(){return this._column.number}get $col$row(){return`$${this._column.letter}$${this.row}`}get type(){return this._value.type}get effectiveType(){return this._value.effectiveType}toCsvString(){return this._value.toCsvString()}addMergeRef(){this._mergeCount++}releaseMergeRef(){this._mergeCount--}get isMerged(){return this._mergeCount>0||this.type===h.Types.Merge}merge(t,e){this._value.release(),this._value=c.create(h.Types.Merge,this,t),e||(this.style=t.style)}unmerge(){this.type===h.Types.Merge&&(this._value.release(),this._value=c.create(h.Types.Null,this),this.style=this._mergeStyle(this._row.style,this._column.style,{}))}isMergedTo(t){return this._value.type===h.Types.Merge&&this._value.isMergedTo(t)}get master(){return this.type===h.Types.Merge?this._value.master:this}get isHyperlink(){return this._value.type===h.Types.Hyperlink}get hyperlink(){return this._value.hyperlink}get value(){return this._value.value}set value(t){this.type!==h.Types.Merge?(this._value.release(),this._value=c.create(c.getType(t),this,t)):this._value.master.value=t}get note(){return this._comment&&this._comment.note}set note(t){this._comment=new a(t)}get text(){return this._value.toString()}get html(){return s.escapeHtml(this.text)}toString(){return this.text}_upgradeToHyperlink(t){this.type===h.Types.String&&(this._value=c.create(h.Types.Hyperlink,this,{text:this._value.value,hyperlink:t}))}get formula(){return this._value.formula}get result(){return this._value.result}get formulaType(){return this._value.formulaType}get fullAddress(){const{worksheet:t}=this._row;return{sheetName:t.name,address:this.address,row:this.row,col:this.col}}get name(){return this.names[0]}set name(t){this.names=[t]}get names(){return this.workbook.definedNames.getNamesEx(this.fullAddress)}set names(t){const{definedNames:e}=this.workbook;e.removeAllNames(this.fullAddress),t.forEach((t=>{e.addEx(this.fullAddress,t)}))}addName(t){this.workbook.definedNames.addEx(this.fullAddress,t)}removeName(t){this.workbook.definedNames.removeEx(this.fullAddress,t)}removeAllNames(){this.workbook.definedNames.removeAllNames(this.fullAddress)}get _dataValidations(){return this.worksheet.dataValidations}get dataValidation(){return this._dataValidations.find(this.address)}set dataValidation(t){this._dataValidations.add(this.address,t)}get model(){const{model:t}=this._value;return t.style=this.style,this._comment&&(t.comment=this._comment.model),t}set model(t){if(this._value.release(),this._value=c.create(t.type,this),this._value.model=t,t.comment)switch(t.comment.type){case"note":this._comment=a.fromModel(t.comment)}t.style?this.style=t.style:this.style={}}}h.Types=r.ValueType;const c={getType:t=>null==t?h.Types.Null:t instanceof String||"string"==typeof t?h.Types.String:"number"==typeof t?h.Types.Number:"boolean"==typeof t?h.Types.Boolean:t instanceof Date?h.Types.Date:t.text&&t.hyperlink?h.Types.Hyperlink:t.formula||t.sharedFormula?h.Types.Formula:t.richText?h.Types.RichText:t.sharedString?h.Types.SharedString:t.error?h.Types.Error:h.Types.JSON,types:[{t:h.Types.Null,f:class{constructor(t){this.model={address:t.address,type:h.Types.Null}}get value(){return null}set value(t){}get type(){return h.Types.Null}get effectiveType(){return h.Types.Null}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return""}release(){}toString(){return""}}},{t:h.Types.Number,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.Number,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}get type(){return h.Types.Number}get effectiveType(){return h.Types.Number}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.model.value.toString()}release(){}toString(){return this.model.value.toString()}}},{t:h.Types.String,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.String,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}get type(){return h.Types.String}get effectiveType(){return h.Types.String}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return`"${this.model.value.replace(/"/g,'""')}"`}release(){}toString(){return this.model.value}}},{t:h.Types.Date,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.Date,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}get type(){return h.Types.Date}get effectiveType(){return h.Types.Date}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.model.value.toISOString()}release(){}toString(){return this.model.value.toString()}}},{t:h.Types.Hyperlink,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.Hyperlink,text:e?e.text:void 0,hyperlink:e?e.hyperlink:void 0},e&&e.tooltip&&(this.model.tooltip=e.tooltip)}get value(){const t={text:this.model.text,hyperlink:this.model.hyperlink};return this.model.tooltip&&(t.tooltip=this.model.tooltip),t}set value(t){this.model={text:t.text,hyperlink:t.hyperlink},t.tooltip&&(this.model.tooltip=t.tooltip)}get text(){return this.model.text}set text(t){this.model.text=t}get hyperlink(){return this.model.hyperlink}set hyperlink(t){this.model.hyperlink=t}get type(){return h.Types.Hyperlink}get effectiveType(){return h.Types.Hyperlink}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.model.hyperlink}release(){}toString(){return this.model.text}}},{t:h.Types.Formula,f:class{constructor(t,e){this.cell=t,this.model={address:t.address,type:h.Types.Formula,shareType:e?e.shareType:void 0,ref:e?e.ref:void 0,formula:e?e.formula:void 0,sharedFormula:e?e.sharedFormula:void 0,result:e?e.result:void 0}}_copyModel(t){const e={},i=i=>{const n=t[i];n&&(e[i]=n)};return i("formula"),i("result"),i("ref"),i("shareType"),i("sharedFormula"),e}get value(){return this._copyModel(this.model)}set value(t){this.model=this._copyModel(t)}validate(t){switch(c.getType(t)){case h.Types.Null:case h.Types.String:case h.Types.Number:case h.Types.Date:break;case h.Types.Hyperlink:case h.Types.Formula:default:throw new Error("Cannot process that type of result value")}}get dependencies(){return{ranges:this.formula.match(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\d{1,4}:[A-Z]{1,3}\d{1,4}/g),cells:this.formula.replace(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\d{1,4}:[A-Z]{1,3}\d{1,4}/g,"").match(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\d{1,4}/g)}}get formula(){return this.model.formula||this._getTranslatedFormula()}set formula(t){this.model.formula=t}get formulaType(){return this.model.formula?r.FormulaType.Master:this.model.sharedFormula?r.FormulaType.Shared:r.FormulaType.None}get result(){return this.model.result}set result(t){this.model.result=t}get type(){return h.Types.Formula}get effectiveType(){const t=this.model.result;return null==t?r.ValueType.Null:t instanceof String||"string"==typeof t?r.ValueType.String:"number"==typeof t?r.ValueType.Number:t instanceof Date?r.ValueType.Date:t.text&&t.hyperlink?r.ValueType.Hyperlink:t.formula?r.ValueType.Formula:r.ValueType.Null}get address(){return this.model.address}set address(t){this.model.address=t}_getTranslatedFormula(){if(!this._translatedFormula&&this.model.sharedFormula){const{worksheet:t}=this.cell,e=t.findCell(this.model.sharedFormula);this._translatedFormula=e&&o(e.formula,e.address,this.model.address)}return this._translatedFormula}toCsvString(){return""+(this.model.result||"")}release(){}toString(){return this.model.result?this.model.result.toString():""}}},{t:h.Types.Merge,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.Merge,master:e?e.address:void 0},this._master=e,e&&e.addMergeRef()}get value(){return this._master.value}set value(t){t instanceof h?(this._master&&this._master.releaseMergeRef(),t.addMergeRef(),this._master=t):this._master.value=t}isMergedTo(t){return t===this._master}get master(){return this._master}get type(){return h.Types.Merge}get effectiveType(){return this._master.effectiveType}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return""}release(){this._master.releaseMergeRef()}toString(){return this.value.toString()}}},{t:h.Types.JSON,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.String,value:JSON.stringify(e),rawValue:e}}get value(){return this.model.rawValue}set value(t){this.model.rawValue=t,this.model.value=JSON.stringify(t)}get type(){return h.Types.String}get effectiveType(){return h.Types.String}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.model.value}release(){}toString(){return this.model.value}}},{t:h.Types.SharedString,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.SharedString,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}get type(){return h.Types.SharedString}get effectiveType(){return h.Types.SharedString}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.model.value.toString()}release(){}toString(){return this.model.value.toString()}}},{t:h.Types.RichText,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.String,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}toString(){return this.model.value.richText.map((t=>t.text)).join("")}get type(){return h.Types.RichText}get effectiveType(){return h.Types.RichText}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return`"${this.text.replace(/"/g,'""')}"`}release(){}}},{t:h.Types.Boolean,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.Boolean,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}get type(){return h.Types.Boolean}get effectiveType(){return h.Types.Boolean}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.model.value?1:0}release(){}toString(){return this.model.value.toString()}}},{t:h.Types.Error,f:class{constructor(t,e){this.model={address:t.address,type:h.Types.Error,value:e}}get value(){return this.model.value}set value(t){this.model.value=t}get type(){return h.Types.Error}get effectiveType(){return h.Types.Error}get address(){return this.model.address}set address(t){this.model.address=t}toCsvString(){return this.toString()}release(){}toString(){return this.model.value.error.toString()}}}].reduce(((t,e)=>(t[e.t]=e.f,t)),[]),create(t,e,i){const n=this.types[t];if(!n)throw new Error("Could not create Value of type "+t);return new n(e,i)}};e.exports=h},{"../utils/col-cache":19,"../utils/shared-formula":23,"../utils/under-dash":26,"./enums":7,"./note":9}],4:[function(t,e,i){const n=t("../utils/under-dash"),s=t("./enums"),r=t("../utils/col-cache");class o{constructor(t,e,i){this._worksheet=t,this._number=e,!1!==i&&(this.defn=i)}get number(){return this._number}get worksheet(){return this._worksheet}get letter(){return r.n2l(this._number)}get isCustomWidth(){return void 0!==this.width&&9!==this.width}get defn(){return{header:this._header,key:this.key,width:this.width,style:this.style,hidden:this.hidden,outlineLevel:this.outlineLevel}}set defn(t){t?(this.key=t.key,this.width=void 0!==t.width?t.width:9,this.outlineLevel=t.outlineLevel,t.style?this.style=t.style:this.style={},this.header=t.header,this._hidden=!!t.hidden):(delete this._header,delete this._key,delete this.width,this.style={},this.outlineLevel=0)}get headers(){return this._header&&this._header instanceof Array?this._header:[this._header]}get header(){return this._header}set header(t){void 0!==t?(this._header=t,this.headers.forEach(((t,e)=>{this._worksheet.getCell(e+1,this.number).value=t}))):this._header=void 0}get key(){return this._key}set key(t){(this._key&&this._worksheet.getColumnKey(this._key))===this&&this._worksheet.deleteColumnKey(this._key),this._key=t,t&&this._worksheet.setColumnKey(this._key,this)}get hidden(){return!!this._hidden}set hidden(t){this._hidden=t}get outlineLevel(){return this._outlineLevel||0}set outlineLevel(t){this._outlineLevel=t}get collapsed(){return!!(this._outlineLevel&&this._outlineLevel>=this._worksheet.properties.outlineLevelCol)}toString(){return JSON.stringify({key:this.key,width:this.width,headers:this.headers.length?this.headers:void 0})}equivalentTo(t){return this.width===t.width&&this.hidden===t.hidden&&this.outlineLevel===t.outlineLevel&&n.isEqual(this.style,t.style)}get isDefault(){if(this.isCustomWidth)return!1;if(this.hidden)return!1;if(this.outlineLevel)return!1;const t=this.style;return!t||!(t.font||t.numFmt||t.alignment||t.border||t.fill||t.protection)}get headerCount(){return this.headers.length}eachCell(t,e){const i=this.number;e||(e=t,t=null),this._worksheet.eachRow(t,((t,n)=>{e(t.getCell(i),n)}))}get values(){const t=[];return this.eachCell(((e,i)=>{e&&e.type!==s.ValueType.Null&&(t[i]=e.value)})),t}set values(t){if(!t)return;const e=this.number;let i=0;t.hasOwnProperty("0")&&(i=1),t.forEach(((t,n)=>{this._worksheet.getCell(n+i,e).value=t}))}_applyStyle(t,e){return this.style[t]=e,this.eachCell((i=>{i[t]=e})),e}get numFmt(){return this.style.numFmt}set numFmt(t){this._applyStyle("numFmt",t)}get font(){return this.style.font}set font(t){this._applyStyle("font",t)}get alignment(){return this.style.alignment}set alignment(t){this._applyStyle("alignment",t)}get protection(){return this.style.protection}set protection(t){this._applyStyle("protection",t)}get border(){return this.style.border}set border(t){this._applyStyle("border",t)}get fill(){return this.style.fill}set fill(t){this._applyStyle("fill",t)}static toModel(t){const e=[];let i=null;return t&&t.forEach(((t,n)=>{t.isDefault?i&&(i=null):i&&t.equivalentTo(i)?i.max=n+1:(i={min:n+1,max:n+1,width:void 0!==t.width?t.width:9,style:t.style,isCustomWidth:t.isCustomWidth,hidden:t.hidden,outlineLevel:t.outlineLevel,collapsed:t.collapsed},e.push(i))})),e.length?e:void 0}static fromModel(t,e){const i=[];let n=1,s=0;for(e=(e=e||[]).sort((function(t,e){return t.min-e.min}));s<e.length;){const r=e[s++];for(;n<r.min;)i.push(new o(t,n++));for(;n<=r.max;)i.push(new o(t,n++,r))}return i.length?i:null}}e.exports=o},{"../utils/col-cache":19,"../utils/under-dash":26,"./enums":7}],5:[function(t,e,i){e.exports=class{constructor(t){this.model=t||{}}add(t,e){return this.model[t]=e}find(t){return this.model[t]}remove(t){this.model[t]=void 0}}},{}],6:[function(t,e,i){const n=t("../utils/under-dash"),s=t("../utils/col-cache"),r=t("../utils/cell-matrix"),o=t("./range"),a=/[$](\w+)[$](\d+)(:[$](\w+)[$](\d+))?/;e.exports=class{constructor(){this.matrixMap={}}getMatrix(t){return this.matrixMap[t]||(this.matrixMap[t]=new r)}add(t,e){const i=s.decodeEx(t);this.addEx(i,e)}addEx(t,e){const i=this.getMatrix(e);if(t.top)for(let e=t.left;e<=t.right;e++)for(let n=t.top;n<=t.bottom;n++){const r={sheetName:t.sheetName,address:s.n2l(e)+n,row:n,col:e};i.addCellEx(r)}else i.addCellEx(t)}remove(t,e){const i=s.decodeEx(t);this.removeEx(i,e)}removeEx(t,e){this.getMatrix(e).removeCellEx(t)}removeAllNames(t){n.each(this.matrixMap,(e=>{e.removeCellEx(t)}))}forEach(t){n.each(this.matrixMap,((e,i)=>{e.forEach((e=>{t(i,e)}))}))}getNames(t){return this.getNamesEx(s.decodeEx(t))}getNamesEx(t){return n.map(this.matrixMap,((e,i)=>e.findCellEx(t)&&i)).filter(Boolean)}_explore(t,e){e.mark=!1;const{sheetName:i}=e,n=new o(e.row,e.col,e.row,e.col,i);let s,r;function a(s,r){const o=t.findCellAt(i,s,e.col);return!(!o||!o.mark)&&(n[r]=s,o.mark=!1,!0)}for(r=e.row-1;a(r,"top");r--);for(r=e.row+1;a(r,"bottom");r++);function h(e,s){const o=[];for(r=n.top;r<=n.bottom;r++){const n=t.findCellAt(i,r,e);if(!n||!n.mark)return!1;o.push(n)}n[s]=e;for(let t=0;t<o.length;t++)o[t].mark=!1;return!0}for(s=e.col-1;h(s,"left");s--);for(s=e.col+1;h(s,"right");s++);return n}getRanges(t,e){if(!(e=e||this.matrixMap[t]))return{name:t,ranges:[]};e.forEach((t=>{t.mark=!0}));return{name:t,ranges:e.map((t=>t.mark&&this._explore(e,t))).filter(Boolean).map((t=>t.$shortRange))}}normaliseMatrix(t,e){t.forEachInSheet(e,((t,e,i)=>{t&&(t.row===e&&t.col===i||(t.row=e,t.col=i,t.address=s.n2l(i)+e))}))}spliceRows(t,e,i,s){n.each(this.matrixMap,(n=>{n.spliceRows(t,e,i,s),this.normaliseMatrix(n,t)}))}spliceColumns(t,e,i,s){n.each(this.matrixMap,(n=>{n.spliceColumns(t,e,i,s),this.normaliseMatrix(n,t)}))}get model(){return n.map(this.matrixMap,((t,e)=>this.getRanges(e,t))).filter((t=>t.ranges.length))}set model(t){const e=this.matrixMap={};t.forEach((t=>{const i=e[t.name]=new r;t.ranges.forEach((t=>{a.test(t.split("!").pop()||"")&&i.addCell(t)}))}))}}},{"../utils/cell-matrix":18,"../utils/col-cache":19,"../utils/under-dash":26,"./range":10}],7:[function(t,e,i){e.exports={ValueType:{Null:0,Merge:1,Number:2,String:3,Date:4,Hyperlink:5,Formula:6,SharedString:7,RichText:8,Boolean:9,Error:10},FormulaType:{None:0,Master:1,Shared:2},RelationshipType:{None:0,OfficeDocument:1,Worksheet:2,CalcChain:3,SharedStrings:4,Styles:5,Theme:6,Hyperlink:7},DocumentType:{Xlsx:1},ReadingOrder:{LeftToRight:1,RightToLeft:2},ErrorValue:{NotApplicable:"#N/A",Ref:"#REF!",Name:"#NAME?",DivZero:"#DIV/0!",Null:"#NULL!",Value:"#VALUE!",Num:"#NUM!"}}},{}],8:[function(t,e,i){const n=t("../utils/col-cache"),s=t("./anchor");e.exports=class{constructor(t,e){this.worksheet=t,this.model=e}get model(){switch(this.type){case"background":return{type:this.type,imageId:this.imageId};case"image":return{type:this.type,imageId:this.imageId,hyperlinks:this.range.hyperlinks,range:{tl:this.range.tl.model,br:this.range.br&&this.range.br.model,ext:this.range.ext,editAs:this.range.editAs}};default:throw new Error("Invalid Image Type")}}set model(t){let{type:e,imageId:i,range:r,hyperlinks:o}=t;if(this.type=e,this.imageId=i,"image"===e)if("string"==typeof r){const t=n.decode(r);this.range={tl:new s(this.worksheet,{col:t.left,row:t.top},-1),br:new s(this.worksheet,{col:t.right,row:t.bottom},0),editAs:"oneCell"}}else this.range={tl:new s(this.worksheet,r.tl,0),br:r.br&&new s(this.worksheet,r.br,0),ext:r.ext,editAs:r.editAs,hyperlinks:o||r.hyperlinks}}}},{"../utils/col-cache":19,"./anchor":2}],9:[function(t,e,i){const n=t("../utils/under-dash");class s{constructor(t){this.note=t}get model(){let t=null;switch(typeof this.note){case"string":t={type:"note",note:{texts:[{text:this.note}]}};break;default:t={type:"note",note:this.note}}return n.deepMerge({},s.DEFAULT_CONFIGS,t)}set model(t){const{note:e}=t,{texts:i}=e;1===i.length&&1===Object.keys(i[0]).length?this.note=i[0].text:this.note=e}static fromModel(t){const e=new s;return e.model=t,e}}s.DEFAULT_CONFIGS={note:{margins:{insetmode:"auto",inset:[.13,.13,.25,.25]},protection:{locked:"True",lockText:"True"},editAs:"absolute"}},e.exports=s},{"../utils/under-dash":26}],10:[function(t,e,i){const n=t("../utils/col-cache");class s{constructor(){this.decode(arguments)}setTLBR(t,e,i,s,r){if(arguments.length<4){const s=n.decodeAddress(t),o=n.decodeAddress(e);this.model={top:Math.min(s.row,o.row),left:Math.min(s.col,o.col),bottom:Math.max(s.row,o.row),right:Math.max(s.col,o.col),sheetName:i},this.setTLBR(s.row,s.col,o.row,o.col,r)}else this.model={top:Math.min(t,i),left:Math.min(e,s),bottom:Math.max(t,i),right:Math.max(e,s),sheetName:r}}decode(t){switch(t.length){case 5:this.setTLBR(t[0],t[1],t[2],t[3],t[4]);break;case 4:this.setTLBR(t[0],t[1],t[2],t[3]);break;case 3:this.setTLBR(t[0],t[1],t[2]);break;case 2:this.setTLBR(t[0],t[1]);break;case 1:{const e=t[0];if(e instanceof s)this.model={top:e.model.top,left:e.model.left,bottom:e.model.bottom,right:e.model.right,sheetName:e.sheetName};else if(e instanceof Array)this.decode(e);else if(e.top&&e.left&&e.bottom&&e.right)this.model={top:e.top,left:e.left,bottom:e.bottom,right:e.right,sheetName:e.sheetName};else{const t=n.decodeEx(e);t.top?this.model={top:t.top,left:t.left,bottom:t.bottom,right:t.right,sheetName:t.sheetName}:this.model={top:t.row,left:t.col,bottom:t.row,right:t.col,sheetName:t.sheetName}}break}case 0:this.model={top:0,left:0,bottom:0,right:0};break;default:throw new Error("Invalid number of arguments to _getDimensions() - "+t.length)}}get top(){return this.model.top||1}set top(t){this.model.top=t}get left(){return this.model.left||1}set left(t){this.model.left=t}get bottom(){return this.model.bottom||1}set bottom(t){this.model.bottom=t}get right(){return this.model.right||1}set right(t){this.model.right=t}get sheetName(){return this.model.sheetName}set sheetName(t){this.model.sheetName=t}get _serialisedSheetName(){const{sheetName:t}=this.model;return t?/^[a-zA-Z0-9]*$/.test(t)?t+"!":`'${t}'!`:""}expand(t,e,i,n){(!this.model.top||t<this.top)&&(this.top=t),(!this.model.left||e<this.left)&&(this.left=e),(!this.model.bottom||i>this.bottom)&&(this.bottom=i),(!this.model.right||n>this.right)&&(this.right=n)}expandRow(t){if(t){const{dimensions:e,number:i}=t;e&&this.expand(i,e.min,i,e.max)}}expandToAddress(t){const e=n.decodeEx(t);this.expand(e.row,e.col,e.row,e.col)}get tl(){return n.n2l(this.left)+this.top}get $t$l(){return`$${n.n2l(this.left)}$${this.top}`}get br(){return n.n2l(this.right)+this.bottom}get $b$r(){return`$${n.n2l(this.right)}$${this.bottom}`}get range(){return`${this._serialisedSheetName+this.tl}:${this.br}`}get $range(){return`${this._serialisedSheetName+this.$t$l}:${this.$b$r}`}get shortRange(){return this.count>1?this.range:this._serialisedSheetName+this.tl}get $shortRange(){return this.count>1?this.$range:this._serialisedSheetName+this.$t$l}get count(){return(1+this.bottom-this.top)*(1+this.right-this.left)}toString(){return this.range}intersects(t){return(!t.sheetName||!this.sheetName||t.sheetName===this.sheetName)&&(!(t.bottom<this.top)&&(!(t.top>this.bottom)&&(!(t.right<this.left)&&!(t.left>this.right))))}contains(t){const e=n.decodeEx(t);return this.containsEx(e)}containsEx(t){return(!t.sheetName||!this.sheetName||t.sheetName===this.sheetName)&&(t.row>=this.top&&t.row<=this.bottom&&t.col>=this.left&&t.col<=this.right)}forEachAddress(t){for(let e=this.left;e<=this.right;e++)for(let i=this.top;i<=this.bottom;i++)t(n.encodeAddress(i,e),i,e)}}e.exports=s},{"../utils/col-cache":19}],11:[function(t,e,i){const n=t("../utils/under-dash"),s=t("./enums"),r=t("../utils/col-cache"),o=t("./cell");e.exports=class{constructor(t,e){this._worksheet=t,this._number=e,this._cells=[],this.style={},this.outlineLevel=0}get number(){return this._number}get worksheet(){return this._worksheet}commit(){this._worksheet._commitRow(this)}destroy(){delete this._worksheet,delete this._cells,delete this.style}findCell(t){return this._cells[t-1]}getCellEx(t){let e=this._cells[t.col-1];if(!e){const i=this._worksheet.getColumn(t.col);e=new o(this,i,t.address),this._cells[t.col-1]=e}return e}getCell(t){if("string"==typeof t){const e=this._worksheet.getColumnKey(t);t=e?e.number:r.l2n(t)}return this._cells[t-1]||this.getCellEx({address:r.encodeAddress(this._number,t),row:this._number,col:t})}splice(t,e){const i=t+e;for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];const o=s.length-e,a=this._cells.length;let h,c,u;if(o<0)for(h=t+s.length;h<=a;h++)u=this._cells[h-1],c=this._cells[h-o-1],c?(u=this.getCell(h),u.value=c.value,u.style=c.style,u._comment=c._comment):u&&(u.value=null,u.style={},u._comment=void 0);else if(o>0)for(h=a;h>=i;h--)c=this._cells[h-1],c?(u=this.getCell(h+o),u.value=c.value,u.style=c.style,u._comment=c._comment):this._cells[h+o-1]=void 0;for(h=0;h<s.length;h++)u=this.getCell(t+h),u.value=s[h],u.style={},u._comment=void 0}eachCell(t,e){if(e||(e=t,t=null),t&&t.includeEmpty){const t=this._cells.length;for(let i=1;i<=t;i++)e(this.getCell(i),i)}else this._cells.forEach(((t,i)=>{t&&t.type!==s.ValueType.Null&&e(t,i+1)}))}addPageBreak(t,e){const i=this._worksheet,n=Math.max(0,t-1)||0,s=Math.max(0,e-1)||16838,r={id:this._number,max:s,man:1};n&&(r.min=n),i.rowBreaks.push(r)}get values(){const t=[];return this._cells.forEach((e=>{e&&e.type!==s.ValueType.Null&&(t[e.col]=e.value)})),t}set values(t){if(this._cells=[],t)if(t instanceof Array){let e=0;t.hasOwnProperty("0")&&(e=1),t.forEach(((t,i)=>{void 0!==t&&(this.getCellEx({address:r.encodeAddress(this._number,i+e),row:this._number,col:i+e}).value=t)}))}else this._worksheet.eachColumnKey(((e,i)=>{void 0!==t[i]&&(this.getCellEx({address:r.encodeAddress(this._number,e.number),row:this._number,col:e.number}).value=t[i])}))}get hasValues(){return n.some(this._cells,(t=>t&&t.type!==s.ValueType.Null))}get cellCount(){return this._cells.length}get actualCellCount(){let t=0;return this.eachCell((()=>{t++})),t}get dimensions(){let t=0,e=0;return this._cells.forEach((i=>{i&&i.type!==s.ValueType.Null&&((!t||t>i.col)&&(t=i.col),e<i.col&&(e=i.col))})),t>0?{min:t,max:e}:null}_applyStyle(t,e){return this.style[t]=e,this._cells.forEach((i=>{i&&(i[t]=e)})),e}get numFmt(){return this.style.numFmt}set numFmt(t){this._applyStyle("numFmt",t)}get font(){return this.style.font}set font(t){this._applyStyle("font",t)}get alignment(){return this.style.alignment}set alignment(t){this._applyStyle("alignment",t)}get protection(){return this.style.protection}set protection(t){this._applyStyle("protection",t)}get border(){return this.style.border}set border(t){this._applyStyle("border",t)}get fill(){return this.style.fill}set fill(t){this._applyStyle("fill",t)}get hidden(){return!!this._hidden}set hidden(t){this._hidden=t}get outlineLevel(){return this._outlineLevel||0}set outlineLevel(t){this._outlineLevel=t}get collapsed(){return!!(this._outlineLevel&&this._outlineLevel>=this._worksheet.properties.outlineLevelRow)}get model(){const t=[];let e=0,i=0;return this._cells.forEach((n=>{if(n){const s=n.model;s&&((!e||e>n.col)&&(e=n.col),i<n.col&&(i=n.col),t.push(s))}})),this.height||t.length?{cells:t,number:this.number,min:e,max:i,height:this.height,style:this.style,hidden:this.hidden,outlineLevel:this.outlineLevel,collapsed:this.collapsed}:null}set model(t){if(t.number!==this._number)throw new Error("Invalid row number in model");let e;this._cells=[],t.cells.forEach((t=>{switch(t.type){case o.Types.Merge:break;default:{let i;if(t.address)i=r.decodeAddress(t.address);else if(e){const{row:t}=e,n=e.col+1;i={row:t,col:n,address:r.encodeAddress(t,n),$col$row:`$${r.n2l(n)}$${t}`}}e=i;this.getCellEx(i).model=t;break}}})),t.height?this.height=t.height:delete this.height,this.hidden=t.hidden,this.outlineLevel=t.outlineLevel||0,this.style=t.style&&JSON.parse(JSON.stringify(t.style))||{}}}},{"../utils/col-cache":19,"../utils/under-dash":26,"./cell":3,"./enums":7}],12:[function(t,e,i){const n=t("../utils/col-cache");class s{constructor(t,e,i){this.table=t,this.column=e,this.index=i}_set(t,e){this.table.cacheState(),this.column[t]=e}get name(){return this.column.name}set name(t){this._set("name",t)}get filterButton(){return this.column.filterButton}set filterButton(t){this.column.filterButton=t}get style(){return this.column.style}set style(t){this.column.style=t}get totalsRowLabel(){return this.column.totalsRowLabel}set totalsRowLabel(t){this._set("totalsRowLabel",t)}get totalsRowFunction(){return this.column.totalsRowFunction}set totalsRowFunction(t){this._set("totalsRowFunction",t)}get totalsRowResult(){return this.column.totalsRowResult}set totalsRowResult(t){this._set("totalsRowResult",t)}get totalsRowFormula(){return this.column.totalsRowFormula}set totalsRowFormula(t){this._set("totalsRowFormula",t)}}e.exports=class{constructor(t,e){this.worksheet=t,e&&(this.table=e,this.validate(),this.store())}getFormula(t){switch(t.totalsRowFunction){case"none":return null;case"average":return`SUBTOTAL(101,${this.table.name}[${t.name}])`;case"countNums":return`SUBTOTAL(102,${this.table.name}[${t.name}])`;case"count":return`SUBTOTAL(103,${this.table.name}[${t.name}])`;case"max":return`SUBTOTAL(104,${this.table.name}[${t.name}])`;case"min":return`SUBTOTAL(105,${this.table.name}[${t.name}])`;case"stdDev":return`SUBTOTAL(106,${this.table.name}[${t.name}])`;case"var":return`SUBTOTAL(107,${this.table.name}[${t.name}])`;case"sum":return`SUBTOTAL(109,${this.table.name}[${t.name}])`;case"custom":return t.totalsRowFormula;default:throw new Error("Invalid Totals Row Function: "+t.totalsRowFunction)}}get width(){return this.table.columns.length}get height(){return this.table.rows.length}get filterHeight(){return this.height+(this.table.headerRow?1:0)}get tableHeight(){return this.filterHeight+(this.table.totalsRow?1:0)}validate(){const{table:t}=this,e=(t,e,i)=>{void 0===t[e]&&(t[e]=i)};e(t,"headerRow",!0),e(t,"totalsRow",!1),e(t,"style",{}),e(t.style,"theme","TableStyleMedium2"),e(t.style,"showFirstColumn",!1),e(t.style,"showLastColumn",!1),e(t.style,"showRowStripes",!1),e(t.style,"showColumnStripes",!1);const i=(t,e)=>{if(!t)throw new Error(e)};i(t.ref,"Table must have ref"),i(t.columns,"Table must have column definitions"),i(t.rows,"Table must have row definitions"),t.tl=n.decodeAddress(t.ref);const{row:s,col:r}=t.tl;i(s>0,"Table must be on valid row"),i(r>0,"Table must be on valid col");const{width:o,filterHeight:a,tableHeight:h}=this;t.autoFilterRef=n.encode(s,r,s+a-1,r+o-1),t.tableRef=n.encode(s,r,s+h-1,r+o-1),t.columns.forEach(((t,n)=>{i(t.name,`Column ${n} must have a name`),0===n?e(t,"totalsRowLabel","Total"):(e(t,"totalsRowFunction","none"),t.totalsRowFormula=this.getFormula(t))}))}store(){const t=(t,e)=>{e&&Object.keys(e).forEach((i=>{t[i]=e[i]}))},{worksheet:e,table:i}=this,{row:n,col:s}=i.tl;let r=0;if(i.headerRow){const o=e.getRow(n+r++);i.columns.forEach(((e,i)=>{const{style:n,name:r}=e,a=o.getCell(s+i);a.value=r,t(a,n)}))}if(i.rows.forEach((o=>{const a=e.getRow(n+r++);o.forEach(((e,n)=>{const r=a.getCell(s+n);r.value=e,t(r,i.columns[n].style)}))})),i.totalsRow){const o=e.getRow(n+r++);i.columns.forEach(((e,i)=>{const n=o.getCell(s+i);if(0===i)n.value=e.totalsRowLabel;else{const t=this.getFormula(e);n.value=t?{formula:e.totalsRowFormula,result:e.totalsRowResult}:null}t(n,e.style)}))}}load(t){const{table:e}=this,{row:i,col:n}=e.tl;let s=0;if(e.headerRow){const r=t.getRow(i+s++);e.columns.forEach(((t,e)=>{r.getCell(n+e).value=t.name}))}if(e.rows.forEach((e=>{const r=t.getRow(i+s++);e.forEach(((t,e)=>{r.getCell(n+e).value=t}))})),e.totalsRow){const r=t.getRow(i+s++);e.columns.forEach(((t,e)=>{const i=r.getCell(n+e);if(0===e)i.value=t.totalsRowLabel;else{this.getFormula(t)&&(i.value={formula:t.totalsRowFormula,result:t.totalsRowResult})}}))}}get model(){return this.table}set model(t){this.table=t}cacheState(){this._cache||(this._cache={ref:this.ref,width:this.width,tableHeight:this.tableHeight})}commit(){if(!this._cache)return;this.validate();const t=n.decodeAddress(this._cache.ref);if(this.ref!==this._cache.ref)for(let e=0;e<this._cache.tableHeight;e++){const i=this.worksheet.getRow(t.row+e);for(let e=0;e<this._cache.width;e++){i.getCell(t.col+e).value=null}}else{for(let e=this.tableHeight;e<this._cache.tableHeight;e++){const i=this.worksheet.getRow(t.row+e);for(let e=0;e<this._cache.width;e++){i.getCell(t.col+e).value=null}}for(let e=0;e<this.tableHeight;e++){const i=this.worksheet.getRow(t.row+e);for(let e=this.width;e<this._cache.width;e++){i.getCell(t.col+e).value=null}}}this.store()}addRow(t,e){this.cacheState(),void 0===e?this.table.rows.push(t):this.table.rows.splice(e,0,t)}removeRows(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.cacheState(),this.table.rows.splice(t,e)}getColumn(t){const e=this.table.columns[t];return new s(this,e,t)}addColumn(t,e,i){this.cacheState(),void 0===i?(this.table.columns.push(t),this.table.rows.forEach(((t,i)=>{t.push(e[i])}))):(this.table.columns.splice(i,0,t),this.table.rows.forEach(((t,n)=>{t.splice(i,0,e[n])})))}removeColumns(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.cacheState(),this.table.columns.splice(t,e),this.table.rows.forEach((i=>{i.splice(t,e)}))}_assign(t,e,i){this.cacheState(),t[e]=i}get ref(){return this.table.ref}set ref(t){this._assign(this.table,"ref",t)}get name(){return this.table.name}set name(t){this.table.name=t}get displayName(){return this.table.displyName||this.table.name}set displayNamename(t){this.table.displayName=t}get headerRow(){return this.table.headerRow}set headerRow(t){this._assign(this.table,"headerRow",t)}get totalsRow(){return this.table.totalsRow}set totalsRow(t){this._assign(this.table,"totalsRow",t)}get theme(){return this.table.style.name}set theme(t){this.table.style.name=t}get showFirstColumn(){return this.table.style.showFirstColumn}set showFirstColumn(t){this.table.style.showFirstColumn=t}get showLastColumn(){return this.table.style.showLastColumn}set showLastColumn(t){this.table.style.showLastColumn=t}get showRowStripes(){return this.table.style.showRowStripes}set showRowStripes(t){this.table.style.showRowStripes=t}get showColumnStripes(){return this.table.style.showColumnStripes}set showColumnStripes(t){this.table.style.showColumnStripes=t}}},{"../utils/col-cache":19}],13:[function(t,e,i){const n=t("./worksheet"),s=t("./defined-names"),r=t("../xlsx/xlsx"),o=t("../csv/csv");e.exports=class{constructor(){this.category="",this.company="",this.created=new Date,this.description="",this.keywords="",this.manager="",this.modified=this.created,this.properties={},this.calcProperties={},this._worksheets=[],this.subject="",this.title="",this.views=[],this.media=[],this._definedNames=new s}get xlsx(){return this._xlsx||(this._xlsx=new r(this)),this._xlsx}get csv(){return this._csv||(this._csv=new o(this)),this._csv}get nextId(){for(let t=1;t<this._worksheets.length;t++)if(!this._worksheets[t])return t;return this._worksheets.length||1}addWorksheet(t,e){const i=this.nextId;e&&("string"==typeof e?(console.trace('tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { argb: "rbg value" } }'),e={properties:{tabColor:{argb:e}}}):(e.argb||e.theme||e.indexed)&&(console.trace("tabColor argument is now deprecated. Please use workbook.addWorksheet(name, {properties: { tabColor: { ... } }"),e={properties:{tabColor:e}}));const s=this._worksheets.reduce(((t,e)=>(e&&e.orderNo)>t?e.orderNo:t),0),r=Object.assign({},e,{id:i,name:t,orderNo:s+1,workbook:this}),o=new n(r);return this._worksheets[i]=o,o}removeWorksheetEx(t){delete this._worksheets[t.id]}removeWorksheet(t){const e=this.getWorksheet(t);e&&e.destroy()}getWorksheet(t){return void 0===t?this._worksheets.find(Boolean):"number"==typeof t?this._worksheets[t]:"string"==typeof t?this._worksheets.find((e=>e&&e.name===t)):void 0}get worksheets(){return this._worksheets.slice(1).sort(((t,e)=>t.orderNo-e.orderNo)).filter(Boolean)}eachSheet(t){this.worksheets.forEach((e=>{t(e,e.id)}))}get definedNames(){return this._definedNames}clearThemes(){this._themes=void 0}addImage(t){const e=this.media.length;return this.media.push(Object.assign({},t,{type:"image"})),e}getImage(t){return this.media[t]}get model(){return{creator:this.creator||"Unknown",lastModifiedBy:this.lastModifiedBy||"Unknown",lastPrinted:this.lastPrinted,created:this.created,modified:this.modified,properties:this.properties,worksheets:this.worksheets.map((t=>t.model)),sheets:this.worksheets.map((t=>t.model)).filter(Boolean),definedNames:this._definedNames.model,views:this.views,company:this.company,manager:this.manager,title:this.title,subject:this.subject,keywords:this.keywords,category:this.category,description:this.description,language:this.language,revision:this.revision,contentStatus:this.contentStatus,themes:this._themes,media:this.media,calcProperties:this.calcProperties}}set model(t){this.creator=t.creator,this.lastModifiedBy=t.lastModifiedBy,this.lastPrinted=t.lastPrinted,this.created=t.created,this.modified=t.modified,this.company=t.company,this.manager=t.manager,this.title=t.title,this.subject=t.subject,this.keywords=t.keywords,this.category=t.category,this.description=t.description,this.language=t.language,this.revision=t.revision,this.contentStatus=t.contentStatus,this.properties=t.properties,this.calcProperties=t.calcProperties,this._worksheets=[],t.worksheets.forEach((e=>{const{id:i,name:s,state:r}=e,o=t.sheets&&t.sheets.findIndex((t=>t.id===i));(this._worksheets[i]=new n({id:i,name:s,orderNo:o,state:r,workbook:this})).model=e})),this._definedNames.model=t.definedNames,this.views=t.views,this._themes=t.themes,this.media=t.media||[]}}},{"../csv/csv":1,"../xlsx/xlsx":144,"./defined-names":6,"./worksheet":14}],14:[function(t,e,i){const n=t("../utils/under-dash"),s=t("../utils/col-cache"),r=t("./range"),o=t("./row"),a=t("./column"),h=t("./enums"),c=t("./image"),u=t("./table"),l=t("./data-validations"),f=t("../utils/encryptor"),{copyStyle:d}=t("../utils/copy-style");e.exports=class{constructor(t){t=t||{},this._workbook=t.workbook,this.id=t.id,this.orderNo=t.orderNo,this.name=t.name,this.state=t.state||"visible",this._rows=[],this._columns=null,this._keys={},this._merges={},this.rowBreaks=[],this.properties=Object.assign({},{defaultRowHeight:15,dyDescent:55,outlineLevelCol:0,outlineLevelRow:0},t.properties),this.pageSetup=Object.assign({},{margins:{left:.7,right:.7,top:.75,bottom:.75,header:.3,footer:.3},orientation:"portrait",horizontalDpi:4294967295,verticalDpi:4294967295,fitToPage:!(!t.pageSetup||!t.pageSetup.fitToWidth&&!t.pageSetup.fitToHeight||t.pageSetup.scale),pageOrder:"downThenOver",blackAndWhite:!1,draft:!1,cellComments:"None",errors:"displayed",scale:100,fitToWidth:1,fitToHeight:1,paperSize:void 0,showRowColHeaders:!1,showGridLines:!1,firstPageNumber:void 0,horizontalCentered:!1,verticalCentered:!1,rowBreaks:null,colBreaks:null},t.pageSetup),this.headerFooter=Object.assign({},{differentFirst:!1,differentOddEven:!1,oddHeader:null,oddFooter:null,evenHeader:null,evenFooter:null,firstHeader:null,firstFooter:null},t.headerFooter),this.dataValidations=new l,this.views=t.views||[],this.autoFilter=t.autoFilter||null,this._media=[],this.sheetProtection=null,this.tables={},this.conditionalFormattings=[]}get name(){return this._name}set name(t){if(void 0===t&&(t="sheet"+this.id),this._name!==t){if("string"!=typeof t)throw new Error("The name has to be a string.");if(""===t)throw new Error("The name can't be empty.");if("History"===t)throw new Error('The name "History" is protected. Please use a different name.');if(/[*?:/\\[\]]/.test(t))throw new Error(`Worksheet name ${t} cannot include any of the following characters: * ? : \\ / [ ]`);if(/(^')|('$)/.test(t))throw new Error("The first or last character of worksheet name cannot be a single quotation mark: "+t);if(t&&t.length>31&&(console.warn(`Worksheet name ${t} exceeds 31 chars. This will be truncated`),t=t.substring(0,31)),this._workbook._worksheets.find((e=>e&&e.name.toLowerCase()===t.toLowerCase())))throw new Error("Worksheet name already exists: "+t);this._name=t}}get workbook(){return this._workbook}destroy(){this._workbook.removeWorksheetEx(this)}get dimensions(){const t=new r;return this._rows.forEach((e=>{if(e){const i=e.dimensions;i&&t.expand(e.number,i.min,e.number,i.max)}})),t}get columns(){return this._columns}set columns(t){this._headerRowCount=t.reduce(((t,e)=>{const i=(e.header?1:e.headers&&e.headers.length)||0;return Math.max(t,i)}),0);let e=1;const i=this._columns=[];t.forEach((t=>{const n=new a(this,e++,!1);i.push(n),n.defn=t}))}getColumnKey(t){return this._keys[t]}setColumnKey(t,e){this._keys[t]=e}deleteColumnKey(t){delete this._keys[t]}eachColumnKey(t){n.each(this._keys,t)}getColumn(t){if("string"==typeof t){const e=this._keys[t];if(e)return e;t=s.l2n(t)}if(this._columns||(this._columns=[]),t>this._columns.length){let e=this._columns.length+1;for(;e<=t;)this._columns.push(new a(this,e++))}return this._columns[t-1]}spliceColumns(t,e){const i=this._rows.length;for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];if(s.length>0)for(let n=0;n<i;n++){const i=[t,e];s.forEach((t=>{i.push(t[n]||null)}));const r=this.getRow(n+1);r.splice.apply(r,i)}else this._rows.forEach((i=>{i&&i.splice(t,e)}));const o=s.length-e,a=t+e,h=this._columns.length;if(o<0)for(let e=t+s.length;e<=h;e++)this.getColumn(e).defn=this.getColumn(e-o).defn;else if(o>0)for(let t=h;t>=a;t--)this.getColumn(t+o).defn=this.getColumn(t).defn;for(let e=t;e<t+s.length;e++)this.getColumn(e).defn=null;this.workbook.definedNames.spliceColumns(this.name,t,e,s.length)}get lastColumn(){return this.getColumn(this.columnCount)}get columnCount(){let t=0;return this.eachRow((e=>{t=Math.max(t,e.cellCount)})),t}get actualColumnCount(){const t=[];let e=0;return this.eachRow((i=>{i.eachCell((i=>{let{col:n}=i;t[n]||(t[n]=!0,e++)}))})),e}_commitRow(){}get _lastRowNumber(){const t=this._rows;let e=t.length;for(;e>0&&void 0===t[e-1];)e--;return e}get _nextRow(){return this._lastRowNumber+1}get lastRow(){if(this._rows.length)return this._rows[this._rows.length-1]}findRow(t){return this._rows[t-1]}findRows(t,e){return this._rows.slice(t-1,t-1+e)}get rowCount(){return this._lastRowNumber}get actualRowCount(){let t=0;return this.eachRow((()=>{t++})),t}getRow(t){let e=this._rows[t-1];return e||(e=this._rows[t-1]=new o(this,t)),e}getRows(t,e){if(e<1)return;const i=[];for(let n=t;n<t+e;n++)i.push(this.getRow(n));return i}addRow(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"n";const i=this._nextRow,n=this.getRow(i);return n.values=t,this._setStyleOption(i,"i"===e[0]?e:"n"),n}addRows(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"n";const i=[];return t.forEach((t=>{i.push(this.addRow(t,e))})),i}insertRow(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"n";return this.spliceRows(t,0,e),this._setStyleOption(t,i),this.getRow(t)}insertRows(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"n";if(this.spliceRows(t,0,...e),"n"!==i)for(let n=0;n<e.length;n++)"o"===i[0]&&void 0!==this.findRow(e.length+t+n)?this._copyStyle(e.length+t+n,t+n,"+"===i[1]):"i"===i[0]&&void 0!==this.findRow(t-1)&&this._copyStyle(t-1,t+n,"+"===i[1]);return this.getRows(t,e.length)}_setStyleOption(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"n";"o"===e[0]&&void 0!==this.findRow(t+1)?this._copyStyle(t+1,t,"+"===e[1]):"i"===e[0]&&void 0!==this.findRow(t-1)&&this._copyStyle(t-1,t,"+"===e[1])}_copyStyle(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this.getRow(t),s=this.getRow(e);s.style=d(n.style),n.eachCell({includeEmpty:i},((t,e)=>{s.getCell(e).style=d(t.style)})),s.height=n.height}duplicateRow(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=this._rows[t-1],s=new Array(e).fill(n.values);this.spliceRows(t+1,i?0:e,...s);for(let i=0;i<e;i++){const e=this._rows[t+i];e.style=n.style,e.height=n.height,n.eachCell({includeEmpty:!0},((t,i)=>{e.getCell(i).style=t.style}))}}spliceRows(t,e){const i=t+e;for(var n=arguments.length,s=new Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];const o=s.length,a=o-e,h=this._rows.length;let c,u;if(a<0)for(t===h&&(this._rows[h-1]=void 0),c=i;c<=h;c++)if(u=this._rows[c-1],u){const t=this.getRow(c+a);t.values=u.values,t.style=u.style,t.height=u.height,u.eachCell({includeEmpty:!0},((e,i)=>{t.getCell(i).style=e.style})),this._rows[c-1]=void 0}else this._rows[c+a-1]=void 0;else if(a>0)for(c=h;c>=i;c--)if(u=this._rows[c-1],u){const t=this.getRow(c+a);t.values=u.values,t.style=u.style,t.height=u.height,u.eachCell({includeEmpty:!0},((e,i)=>{if(t.getCell(i).style=e.style,"MergeValue"===e._value.constructor.name){const t=this.getRow(e._row._number+o).getCell(i),n=e._value._master,s=this.getRow(n._row._number+o).getCell(n._column._number);t.merge(s)}}))}else this._rows[c+a-1]=void 0;for(c=0;c<o;c++){const e=this.getRow(t+c);e.style={},e.values=s[c]}this.workbook.definedNames.spliceRows(this.name,t,e,o)}eachRow(t,e){if(e||(e=t,t=void 0),t&&t.includeEmpty){const t=this._rows.length;for(let i=1;i<=t;i++)e(this.getRow(i),i)}else this._rows.forEach((t=>{t&&t.hasValues&&e(t,t.number)}))}getSheetValues(){const t=[];return this._rows.forEach((e=>{e&&(t[e.number]=e.values)})),t}findCell(t,e){const i=s.getAddress(t,e),n=this._rows[i.row-1];return n?n.findCell(i.col):void 0}getCell(t,e){const i=s.getAddress(t,e);return this.getRow(i.row).getCellEx(i)}mergeCells(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const n=new r(e);this._mergeCellsInternal(n)}mergeCellsWithoutStyle(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const n=new r(e);this._mergeCellsInternal(n,!0)}_mergeCellsInternal(t,e){n.each(this._merges,(e=>{if(e.intersects(t))throw new Error("Cannot merge already merged cells")}));const i=this.getCell(t.top,t.left);for(let n=t.top;n<=t.bottom;n++)for(let s=t.left;s<=t.right;s++)(n>t.top||s>t.left)&&this.getCell(n,s).merge(i,e);this._merges[i.address]=t}_unMergeMaster(t){const e=this._merges[t.address];if(e){for(let t=e.top;t<=e.bottom;t++)for(let i=e.left;i<=e.right;i++)this.getCell(t,i).unmerge();delete this._merges[t.address]}}get hasMerges(){return n.some(this._merges,Boolean)}unMergeCells(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];const n=new r(e);for(let t=n.top;t<=n.bottom;t++)for(let e=n.left;e<=n.right;e++){const i=this.findCell(t,e);i&&(i.type===h.ValueType.Merge?this._unMergeMaster(i.master):this._merges[i.address]&&this._unMergeMaster(i))}}fillFormula(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"shared";const r=s.decode(t),{top:o,left:a,bottom:h,right:c}=r,u=c-a+1,l=s.encodeAddress(o,a),f="shared"===n;let d;d="function"==typeof i?i:Array.isArray(i)?Array.isArray(i[0])?(t,e)=>i[t-o][e-a]:(t,e)=>i[(t-o)*u+(e-a)]:()=>{};let p=!0;for(let i=o;i<=h;i++)for(let s=a;s<=c;s++)p?(this.getCell(i,s).value={shareType:n,formula:e,ref:t,result:d(i,s)},p=!1):this.getCell(i,s).value=f?{sharedFormula:l,result:d(i,s)}:d(i,s)}addImage(t,e){const i={type:"image",imageId:t,range:e};this._media.push(new c(this,i))}getImages(){return this._media.filter((t=>"image"===t.type))}addBackgroundImage(t){const e={type:"background",imageId:t};this._media.push(new c(this,e))}getBackgroundImageId(){const t=this._media.find((t=>"background"===t.type));return t&&t.imageId}protect(t,e){return new Promise((i=>{this.sheetProtection={sheet:!0},e&&"spinCount"in e&&(e.spinCount=Number.isFinite(e.spinCount)?Math.round(Math.max(0,e.spinCount)):1e5),t&&(this.sheetProtection.algorithmName="SHA-512",this.sheetProtection.saltValue=f.randomBytes(16).toString("base64"),this.sheetProtection.spinCount=e&&"spinCount"in e?e.spinCount:1e5,this.sheetProtection.hashValue=f.convertPasswordToHash(t,"SHA512",this.sheetProtection.saltValue,this.sheetProtection.spinCount)),e&&(this.sheetProtection=Object.assign(this.sheetProtection,e),!t&&"spinCount"in e&&delete this.sheetProtection.spinCount),i()}))}unprotect(){this.sheetProtection=null}addTable(t){const e=new u(this,t);return this.tables[t.name]=e,e}getTable(t){return this.tables[t]}removeTable(t){delete this.tables[t]}getTables(){return Object.values(this.tables)}addConditionalFormatting(t){this.conditionalFormattings.push(t)}removeConditionalFormatting(t){"number"==typeof t?this.conditionalFormattings.splice(t,1):this.conditionalFormattings=t instanceof Function?this.conditionalFormattings.filter(t):[]}get tabColor(){return console.trace("worksheet.tabColor property is now deprecated. Please use worksheet.properties.tabColor"),this.properties.tabColor}set tabColor(t){console.trace("worksheet.tabColor property is now deprecated. Please use worksheet.properties.tabColor"),this.properties.tabColor=t}get model(){const t={id:this.id,name:this.name,dataValidations:this.dataValidations.model,properties:this.properties,state:this.state,pageSetup:this.pageSetup,headerFooter:this.headerFooter,rowBreaks:this.rowBreaks,views:this.views,autoFilter:this.autoFilter,media:this._media.map((t=>t.model)),sheetProtection:this.sheetProtection,tables:Object.values(this.tables).map((t=>t.model)),conditionalFormattings:this.conditionalFormattings};t.cols=a.toModel(this.columns);const e=t.rows=[],i=t.dimensions=new r;return this._rows.forEach((t=>{const n=t&&t.model;n&&(i.expand(n.number,n.min,n.number,n.max),e.push(n))})),t.merges=[],n.each(this._merges,(e=>{t.merges.push(e.range)})),t}_parseRows(t){this._rows=[],t.rows.forEach((t=>{const e=new o(this,t.number);this._rows[e.number-1]=e,e.model=t}))}_parseMergeCells(t){n.each(t.mergeCells,(t=>{this.mergeCellsWithoutStyle(t)}))}set model(t){this.name=t.name,this._columns=a.fromModel(this,t.cols),this._parseRows(t),this._parseMergeCells(t),this.dataValidations=new l(t.dataValidations),this.properties=t.properties,this.pageSetup=t.pageSetup,this.headerFooter=t.headerFooter,this.views=t.views,this.autoFilter=t.autoFilter,this._media=t.media.map((t=>new c(this,t))),this.sheetProtection=t.sheetProtection,this.tables=t.tables.reduce(((t,e)=>{const i=new u;return i.model=e,t[e.name]=i,t}),{}),this.conditionalFormattings=t.conditionalFormattings}}},{"../utils/col-cache":19,"../utils/copy-style":20,"../utils/encryptor":21,"../utils/under-dash":26,"./column":4,"./data-validations":5,"./enums":7,"./image":8,"./range":10,"./row":11,"./table":12}],15:[function(t,e,i){t("core-js/modules/es.promise"),t("core-js/modules/es.promise.finally"),t("core-js/modules/es.object.assign"),t("core-js/modules/es.object.keys"),t("core-js/modules/es.object.values"),t("core-js/modules/es.symbol"),t("core-js/modules/es.symbol.async-iterator"),t("core-js/modules/es.array.iterator"),t("core-js/modules/es.array.includes"),t("core-js/modules/es.array.find-index"),t("core-js/modules/es.array.find"),t("core-js/modules/es.string.from-code-point"),t("core-js/modules/es.string.includes"),t("core-js/modules/es.number.is-nan"),t("regenerator-runtime/runtime");const n={Workbook:t("./doc/workbook")},s=t("./doc/enums");Object.keys(s).forEach((t=>{n[t]=s[t]})),e.exports=n},{"./doc/enums":7,"./doc/workbook":13,"core-js/modules/es.array.find":359,"core-js/modules/es.array.find-index":358,"core-js/modules/es.array.includes":360,"core-js/modules/es.array.iterator":361,"core-js/modules/es.number.is-nan":363,"core-js/modules/es.object.assign":364,"core-js/modules/es.object.keys":366,"core-js/modules/es.object.values":367,"core-js/modules/es.promise":372,"core-js/modules/es.promise.finally":371,"core-js/modules/es.string.from-code-point":376,"core-js/modules/es.string.includes":377,"core-js/modules/es.symbol":381,"core-js/modules/es.symbol.async-iterator":378,"regenerator-runtime/runtime":492}],16:[function(t,e,i){const n="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");i.bufferToString=function(t){return"string"==typeof t?t:n?n.decode(t):t.toString()}},{}],17:[function(t,e,i){const n="undefined"==typeof TextEncoder?null:new TextEncoder("utf-8"),{Buffer:s}=t("buffer");i.stringToBuffer=function(t){return"string"!=typeof t?t:n?s.from(n.encode(t).buffer):s.from(t)}},{buffer:220}],18:[function(t,e,i){const n=t("./under-dash"),s=t("./col-cache");e.exports=class{constructor(t){this.template=t,this.sheets={}}addCell(t){this.addCellEx(s.decodeEx(t))}getCell(t){return this.findCellEx(s.decodeEx(t),!0)}findCell(t){return this.findCellEx(s.decodeEx(t),!1)}findCellAt(t,e,i){const n=this.sheets[t],s=n&&n[e];return s&&s[i]}addCellEx(t){if(t.top)for(let e=t.top;e<=t.bottom;e++)for(let i=t.left;i<=t.right;i++)this.getCellAt(t.sheetName,e,i);else this.findCellEx(t,!0)}getCellEx(t){return this.findCellEx(t,!0)}findCellEx(t,e){const i=this.findSheet(t,e),n=this.findSheetRow(i,t,e);return this.findRowCell(n,t,e)}getCellAt(t,e,i){const n=this.sheets[t]||(this.sheets[t]=[]),r=n[e]||(n[e]=[]);return r[i]||(r[i]={sheetName:t,address:s.n2l(i)+e,row:e,col:i})}removeCellEx(t){const e=this.findSheet(t);if(!e)return;const i=this.findSheetRow(e,t);i&&delete i[t.col]}forEachInSheet(t,e){const i=this.sheets[t];i&&i.forEach(((t,i)=>{t&&t.forEach(((t,n)=>{t&&e(t,i,n)}))}))}forEach(t){n.each(this.sheets,((e,i)=>{this.forEachInSheet(i,t)}))}map(t){const e=[];return this.forEach((i=>{e.push(t(i))})),e}findSheet(t,e){const i=t.sheetName;return this.sheets[i]?this.sheets[i]:e?this.sheets[i]=[]:void 0}findSheetRow(t,e,i){const{row:n}=e;return t&&t[n]?t[n]:i?t[n]=[]:void 0}findRowCell(t,e,i){const{col:n}=e;return t&&t[n]?t[n]:i?t[n]=this.template?Object.assign(e,JSON.parse(JSON.stringify(this.template))):e:void 0}spliceRows(t,e,i,n){const s=this.sheets[t];if(s){const t=[];for(let e=0;e<n;e++)t.push([]);s.splice(e,i,...t)}}spliceColumns(t,e,i,s){const r=this.sheets[t];if(r){const t=[];for(let e=0;e<s;e++)t.push(null);n.each(r,(n=>{n.splice(e,i,...t)}))}}}},{"./col-cache":19,"./under-dash":26}],19:[function(t,e,i){const n=/^[A-Z]+\d+$/,s={_dictionary:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],_l2nFill:0,_l2n:{},_n2l:[],_level:t=>t<=26?1:t<=676?2:3,_fill(t){let e,i,n,s,r,o=1;if(t>=4)throw new Error("Out of bounds. Excel supports columns from 1 to 16384");if(this._l2nFill<1&&t>=1){for(;o<=26;)e=this._dictionary[o-1],this._n2l[o]=e,this._l2n[e]=o,o++;this._l2nFill=1}if(this._l2nFill<2&&t>=2){for(o=27;o<=702;)i=o-27,n=i%26,s=Math.floor(i/26),e=this._dictionary[s]+this._dictionary[n],this._n2l[o]=e,this._l2n[e]=o,o++;this._l2nFill=2}if(this._l2nFill<3&&t>=3){for(o=703;o<=16384;)i=o-703,n=i%26,s=Math.floor(i/26)%26,r=Math.floor(i/676),e=this._dictionary[r]+this._dictionary[s]+this._dictionary[n],this._n2l[o]=e,this._l2n[e]=o,o++;this._l2nFill=3}},l2n(t){if(this._l2n[t]||this._fill(t.length),!this._l2n[t])throw new Error("Out of bounds. Invalid column letter: "+t);return this._l2n[t]},n2l(t){if(t<1||t>16384)throw new Error(t+" is out of bounds. Excel supports columns from 1 to 16384");return this._n2l[t]||this._fill(this._level(t)),this._n2l[t]},_hash:{},validateAddress(t){if(!n.test(t))throw new Error("Invalid Address: "+t);return!0},decodeAddress(t){const e=t.length<5&&this._hash[t];if(e)return e;let i=!1,n="",s=0,r=!1,o="",a=0;for(let e,h=0;h<t.length;h++)if(e=t.charCodeAt(h),!r&&e>=65&&e<=90)i=!0,n+=t[h],s=26*s+e-64;else if(e>=48&&e<=57)r=!0,o+=t[h],a=10*a+e-48;else if(r&&i&&36!==e)break;if(i){if(s>16384)throw new Error("Out of bounds. Invalid column letter: "+n)}else s=void 0;r||(a=void 0);const h={address:t=n+o,col:s,row:a,$col$row:`$${n}$${o}`};return s<=100&&a<=100&&(this._hash[t]=h,this._hash[h.$col$row]=h),h},getAddress(t,e){if(e){const i=this.n2l(e)+t;return this.decodeAddress(i)}return this.decodeAddress(t)},decode(t){const e=t.split(":");if(2===e.length){const t=this.decodeAddress(e[0]),i=this.decodeAddress(e[1]),n={top:Math.min(t.row,i.row),left:Math.min(t.col,i.col),bottom:Math.max(t.row,i.row),right:Math.max(t.col,i.col)};return n.tl=this.n2l(n.left)+n.top,n.br=this.n2l(n.right)+n.bottom,n.dimensions=`${n.tl}:${n.br}`,n}return this.decodeAddress(t)},decodeEx(t){const e=t.match(/(?:(?:(?:'((?:[^']|'')*)')|([^'^ !]*))!)?(.*)/),i=e[1]||e[2],n=e[3],s=n.split(":");if(s.length>1){let t=this.decodeAddress(s[0]),e=this.decodeAddress(s[1]);const n=Math.min(t.row,e.row),r=Math.min(t.col,e.col),o=Math.max(t.row,e.row),a=Math.max(t.col,e.col);return t=this.n2l(r)+n,e=this.n2l(a)+o,{top:n,left:r,bottom:o,right:a,sheetName:i,tl:{address:t,col:r,row:n,$col$row:`$${this.n2l(r)}$${n}`,sheetName:i},br:{address:e,col:a,row:o,$col$row:`$${this.n2l(a)}$${o}`,sheetName:i},dimensions:`${t}:${e}`}}if(n.startsWith("#"))return i?{sheetName:i,error:n}:{error:n};const r=this.decodeAddress(n);return i?{sheetName:i,...r}:r},encodeAddress:(t,e)=>s.n2l(e)+t,encode(){switch(arguments.length){case 2:return s.encodeAddress(arguments[0],arguments[1]);case 4:return`${s.encodeAddress(arguments[0],arguments[1])}:${s.encodeAddress(arguments[2],arguments[3])}`;default:throw new Error("Can only encode with 2 or 4 arguments")}},inRange(t,e){const[i,n,,s,r]=t,[o,a]=e;return o>=i&&o<=s&&a>=n&&a<=r}};e.exports=s},{}],20:[function(t,e,i){const n=(t,e)=>({...t,...e.reduce(((e,i)=>(t[i]&&(e[i]={...t[i]}),e)),{})}),s=function(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];t[i]&&(e[i]=n(t[i],s))};i.copyStyle=t=>{if(!t)return t;if(e=t,0===Object.keys(e).length)return{};var e;const i={...t};return s(t,i,"font",["color"]),s(t,i,"alignment"),s(t,i,"protection"),t.border&&(s(t,i,"border"),s(t.border,i.border,"top",["color"]),s(t.border,i.border,"left",["color"]),s(t.border,i.border,"bottom",["color"]),s(t.border,i.border,"right",["color"]),s(t.border,i.border,"diagonal",["color"])),t.fill&&(s(t,i,"fill",["fgColor","bgColor","center"]),t.fill.stops&&(i.fill.stops=t.fill.stops.map((t=>n(t,["color"]))))),i}},{}],21:[function(t,e,i){(function(i){(function(){const n=t("crypto"),s={hash(t){const e=n.createHash(t);for(var s=arguments.length,r=new Array(s>1?s-1:0),o=1;o<s;o++)r[o-1]=arguments[o];return e.update(i.concat(r)),e.digest()},convertPasswordToHash(t,e,s,r){e=e.toLowerCase();if(n.getHashes().indexOf(e)<0)throw new Error(`Hash algorithm '${e}' not supported!`);const o=i.from(t,"utf16le");let a=this.hash(e,i.from(s,"base64"),o);for(let t=0;t<r;t++){const n=i.alloc(4);n.writeUInt32LE(t,0),a=this.hash(e,a,n)}return a.toString("base64")},randomBytes:t=>n.randomBytes(t)};e.exports=s}).call(this)}).call(this,t("buffer").Buffer)},{buffer:220,crypto:390}],22:[function(t,e,i){const{SaxesParser:n}=t("saxes"),{PassThrough:s}=t("readable-stream"),{bufferToString:r}=t("./browser-buffer-decode");e.exports=async function*(t){t.pipe&&!t[Symbol.asyncIterator]&&(t=t.pipe(new s));const e=new n;let i;e.on("error",(t=>{i=t}));let o=[];e.on("opentag",(t=>o.push({eventType:"opentag",value:t}))),e.on("text",(t=>o.push({eventType:"text",value:t}))),e.on("closetag",(t=>o.push({eventType:"closetag",value:t})));for await(const n of t){if(e.write(r(n)),i)throw i;yield o,o=[]}}},{"./browser-buffer-decode":16,"readable-stream":491,saxes:496}],23:[function(t,e,i){const n=t("./col-cache"),s=/(([a-z_\-0-9]*)!)?([a-z0-9_$]{2,})([(])?/gi,r=/^([$])?([a-z]+)([$])?([1-9][0-9]*)$/i;e.exports={slideFormula:function(t,e,i){const o=n.decode(e),a=n.decode(i);return t.replace(s,((t,e,i,s,h)=>{if(h)return t;const c=r.exec(s);if(c){const i=c[1],s=c[2].toUpperCase(),r=c[3],h=c[4];if(s.length>3||3===s.length&&s>"XFD")return t;let u=n.l2n(s),l=parseInt(h,10);i||(u+=a.col-o.col),r||(l+=a.row-o.row);return(e||"")+(i||"")+n.n2l(u)+(r||"")+l}return t}))}}},{"./col-cache":19}],24:[function(t,e,i){(function(i,n){(function(){const s=t("readable-stream"),r=t("./utils"),o=t("./string-buf");class a{constructor(t,e){this._data=t,this._encoding=e}get length(){return this.toBuffer().length}copy(t,e,i,n){return this.toBuffer().copy(t,e,i,n)}toBuffer(){return this._buffer||(this._buffer=n.from(this._data,this._encoding)),this._buffer}}class h{constructor(t){this._data=t}get length(){return this._data.length}copy(t,e,i,n){return this._data._buf.copy(t,e,i,n)}toBuffer(){return this._data.toBuffer()}}class c{constructor(t){this._data=t}get length(){return this._data.length}copy(t,e,i,n){this._data.copy(t,e,i,n)}toBuffer(){return this._data}}class u{constructor(t){this.size=t,this.buffer=n.alloc(t),this.iRead=0,this.iWrite=0}toBuffer(){if(0===this.iRead&&this.iWrite===this.size)return this.buffer;const t=n.alloc(this.iWrite-this.iRead);return this.buffer.copy(t,0,this.iRead,this.iWrite),t}get length(){return this.iWrite-this.iRead}get eod(){return this.iRead===this.iWrite}get full(){return this.iWrite===this.size}read(t){let e;return 0===t?null:void 0===t||t>=this.length?(e=this.toBuffer(),this.iRead=this.iWrite,e):(e=n.alloc(t),this.buffer.copy(e,0,this.iRead,t),this.iRead+=t,e)}write(t,e,i){const n=Math.min(i,this.size-this.iWrite);return t.copy(this.buffer,this.iWrite,e,e+n),this.iWrite+=n,n}}const l=function(t){t=t||{},this.bufSize=t.bufSize||1048576,this.buffers=[],this.batch=t.batch||!1,this.corked=!1,this.inPos=0,this.outPos=0,this.pipes=[],this.paused=!1,this.encoding=null};r.inherits(l,s.Duplex,{toBuffer(){switch(this.buffers.length){case 0:return null;case 1:return this.buffers[0].toBuffer();default:return n.concat(this.buffers.map((t=>t.toBuffer())))}},_getWritableBuffer(){if(this.buffers.length){const t=this.buffers[this.buffers.length-1];if(!t.full)return t}const t=new u(this.bufSize);return this.buffers.push(t),t},async _pipe(t){await Promise.all(this.pipes.map((function(e){return new Promise((i=>{e.write(t.toBuffer(),(()=>{i()}))}))})))},_writeToBuffers(t){let e=0;const i=t.length;for(;e<i;){e+=this._getWritableBuffer().write(t,e,i-e)}},async write(t,e,s){let u;if(e instanceof Function&&(s=e,e="utf8"),s=s||r.nop,t instanceof o)u=new h(t);else if(t instanceof n)u=new c(t);else{if(!("string"==typeof t||t instanceof String||t instanceof ArrayBuffer))throw new Error("Chunk must be one of type String, Buffer or StringBuf.");u=new a(t,e)}if(this.pipes.length)if(this.batch)for(this._writeToBuffers(u);!this.corked&&this.buffers.length>1;)this._pipe(this.buffers.shift());else this.corked?(this._writeToBuffers(u),i.nextTick(s)):(await this._pipe(u),s());else this.paused||this.emit("data",u.toBuffer()),this._writeToBuffers(u),this.emit("readable");return!0},cork(){this.corked=!0},_flush(){if(this.pipes.length)for(;this.buffers.length;)this._pipe(this.buffers.shift())},uncork(){this.corked=!1,this._flush()},end(t,e,i){const n=t=>{t?i(t):(this._flush(),this.pipes.forEach((t=>{t.end()})),this.emit("finish"))};t?this.write(t,e,n):n()},read(t){let e;if(t){for(e=[];t&&this.buffers.length&&!this.buffers[0].eod;){const i=this.buffers[0],n=i.read(t);t-=n.length,e.push(n),i.eod&&i.full&&this.buffers.shift()}return n.concat(e)}return e=this.buffers.map((t=>t.toBuffer())).filter(Boolean),this.buffers=[],n.concat(e)},setEncoding(t){this.encoding=t},pause(){this.paused=!0},resume(){this.paused=!1},isPaused(){return!!this.paused},pipe(t){this.pipes.push(t),!this.paused&&this.buffers.length&&this.end()},unpipe(t){this.pipes=this.pipes.filter((e=>e!==t))},unshift(){throw new Error("Not Implemented")},wrap(){throw new Error("Not Implemented")}}),e.exports=l}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{"./string-buf":25,"./utils":27,_process:467,buffer:220,"readable-stream":491}],25:[function(t,e,i){(function(t){(function(){e.exports=class{constructor(e){this._buf=t.alloc(e&&e.size||16384),this._encoding=e&&e.encoding||"utf8",this._inPos=0,this._buffer=void 0}get length(){return this._inPos}get capacity(){return this._buf.length}get buffer(){return this._buf}toBuffer(){return this._buffer||(this._buffer=t.alloc(this.length),this._buf.copy(this._buffer,0,0,this.length)),this._buffer}reset(t){t=t||0,this._buffer=void 0,this._inPos=t}_grow(e){let i=2*this._buf.length;for(;i<e;)i*=2;const n=t.alloc(i);this._buf.copy(n,0),this._buf=n}addText(t){this._buffer=void 0;let e=this._inPos+this._buf.write(t,this._inPos,this._encoding);for(;e>=this._buf.length-4;)this._grow(this._inPos+t.length),e=this._inPos+this._buf.write(t,this._inPos,this._encoding);this._inPos=e}addStringBuf(t){t.length&&(this._buffer=void 0,this.length+t.length>this.capacity&&this._grow(this.length+t.length),t._buf.copy(this._buf,this._inPos,0,t.length),this._inPos+=t.length)}}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:220}],26:[function(t,e,i){const{toString:n}=Object.prototype,s=/["&<>]/,r={each:function(t,e){t&&(Array.isArray(t)?t.forEach(e):Object.keys(t).forEach((i=>{e(t[i],i)})))},some:function(t,e){return!!t&&(Array.isArray(t)?t.some(e):Object.keys(t).some((i=>e(t[i],i))))},every:function(t,e){return!t||(Array.isArray(t)?t.every(e):Object.keys(t).every((i=>e(t[i],i))))},map:function(t,e){return t?Array.isArray(t)?t.map(e):Object.keys(t).map((i=>e(t[i],i))):[]},keyBy:(t,e)=>t.reduce(((t,i)=>(t[i[e]]=i,t)),{}),isEqual:function(t,e){const i=typeof t,n=typeof e,s=Array.isArray(t),o=Array.isArray(e);let a;if(i!==n)return!1;switch(typeof t){case"object":if(s||o)return!(!s||!o)&&(t.length===e.length&&t.every(((t,i)=>{const n=e[i];return r.isEqual(t,n)})));if(null===t||null===e)return t===e;if(a=Object.keys(t),Object.keys(e).length!==a.length)return!1;for(const t of a)if(!e.hasOwnProperty(t))return!1;return r.every(t,((t,i)=>{const n=e[i];return r.isEqual(t,n)}));default:return t===e}},escapeHtml(t){const e=s.exec(t);if(!e)return t;let i="",n="",r=0,o=e.index;for(;o<t.length;o++){switch(t.charAt(o)){case'"':n="&quot;";break;case"&":n="&amp;";break;case"'":n="&apos;";break;case"<":n="&lt;";break;case">":n="&gt;";break;default:continue}r!==o&&(i+=t.substring(r,o)),r=o+1,i+=n}return r!==o?i+t.substring(r,o):i},strcmp:(t,e)=>t<e?-1:t>e?1:0,isUndefined:t=>"[object Undefined]"===n.call(t),isObject:t=>"[object Object]"===n.call(t),deepMerge(){const t=arguments[0]||{},{length:e}=arguments;let i,n,s;function o(e,o){i=t[o],s=Array.isArray(e),r.isObject(e)||s?(s?(s=!1,n=i&&Array.isArray(i)?i:[]):n=i&&r.isObject(i)?i:{},t[o]=r.deepMerge(n,e)):r.isUndefined(e)||(t[o]=e)}for(let t=0;t<e;t++)r.each(arguments[t],o);return t}};e.exports=r},{}],27:[function(t,e,i){(function(i,n){(function(){const s=t("fs"),r=/[<>&'"\x7F\x00-\x08\x0B-\x0C\x0E-\x1F]/,o={nop(){},promiseImmediate:t=>new Promise((e=>{i.setImmediate?n((()=>{e(t)})):setTimeout((()=>{e(t)}),1)})),inherits:function(t,e,i,n){t.super_=e,n||(n=i,i=null),i&&Object.keys(i).forEach((e=>{Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}));const s={constructor:{value:t,enumerable:!1,writable:!1,configurable:!0}};n&&Object.keys(n).forEach((t=>{s[t]=Object.getOwnPropertyDescriptor(n,t)})),t.prototype=Object.create(e.prototype,s)},dateToExcel:(t,e)=>25569+t.getTime()/864e5-(e?1462:0),excelToDate(t,e){const i=Math.round(24*(t-25569+(e?1462:0))*3600*1e3);return new Date(i)},parsePath(t){const e=t.lastIndexOf("/");return{path:t.substring(0,e),name:t.substring(e+1)}},getRelsPath(t){const e=o.parsePath(t);return`${e.path}/_rels/${e.name}.rels`},xmlEncode(t){const e=r.exec(t);if(!e)return t;let i="",n="",s=0,o=e.index;for(;o<t.length;o++){const e=t.charCodeAt(o);switch(e){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&apos;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;case 127:n="";break;default:if(e<=31&&(e<=8||e>=11&&13!==e)){n="";break}continue}s!==o&&(i+=t.substring(s,o)),s=o+1,n&&(i+=n)}return s!==o?i+t.substring(s,o):i},xmlDecode:t=>t.replace(/&([a-z]*);/g,(t=>{switch(t){case"&lt;":return"<";case"&gt;":return">";case"&amp;":return"&";case"&apos;":return"'";case"&quot;":return'"';default:return t}})),validInt(t){const e=parseInt(t,10);return Number.isNaN(e)?0:e},isDateFmt(t){if(!t)return!1;return null!==(t=(t=t.replace(/\[[^\]]*]/g,"")).replace(/"[^"]*"/g,"")).match(/[ymdhMsb]+/)},fs:{exists:t=>new Promise((e=>{s.access(t,s.constants.F_OK,(t=>{e(!t)}))}))},toIsoDateString:t=>t.toIsoString().subsstr(0,10),parseBoolean:t=>!0===t||"true"===t||1===t||"1"===t};e.exports=o}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("timers").setImmediate)},{fs:216,timers:523}],28:[function(t,e,i){const n=t("./under-dash"),s=t("./utils");function r(t,e,i){t.push(` ${e}="${s.xmlEncode(i.toString())}"`)}function o(t,e){if(e){const i=[];n.each(e,((t,e)=>{void 0!==t&&r(i,e,t)})),t.push(i.join(""))}}class a{constructor(){this._xml=[],this._stack=[],this._rollbacks=[]}get tos(){return this._stack.length?this._stack[this._stack.length-1]:void 0}get cursor(){return this._xml.length}openXml(t){const e=this._xml;e.push("<?xml"),o(e,t),e.push("?>\n")}openNode(t,e){const i=this.tos,n=this._xml;i&&this.open&&n.push(">"),this._stack.push(t),n.push("<"),n.push(t),o(n,e),this.leaf=!0,this.open=!0}addAttribute(t,e){if(!this.open)throw new Error("Cannot write attributes to node if it is not open");void 0!==e&&r(this._xml,t,e)}addAttributes(t){if(!this.open)throw new Error("Cannot write attributes to node if it is not open");o(this._xml,t)}writeText(t){const e=this._xml;this.open&&(e.push(">"),this.open=!1),this.leaf=!1,e.push(s.xmlEncode(t.toString()))}writeXml(t){this.open&&(this._xml.push(">"),this.open=!1),this.leaf=!1,this._xml.push(t)}closeNode(){const t=this._stack.pop(),e=this._xml;this.leaf?e.push("/>"):(e.push("</"),e.push(t),e.push(">")),this.open=!1,this.leaf=!1}leafNode(t,e,i){this.openNode(t,e),void 0!==i&&this.writeText(i),this.closeNode()}closeAll(){for(;this._stack.length;)this.closeNode()}addRollback(){return this._rollbacks.push({xml:this._xml.length,stack:this._stack.length,leaf:this.leaf,open:this.open}),this.cursor}commit(){this._rollbacks.pop()}rollback(){const t=this._rollbacks.pop();this._xml.length>t.xml&&this._xml.splice(t.xml,this._xml.length-t.xml),this._stack.length>t.stack&&this._stack.splice(t.stack,this._stack.length-t.stack),this.leaf=t.leaf,this.open=t.open}get xml(){return this.closeAll(),this._xml.join("")}}a.StdDocAttributes={version:"1.0",encoding:"UTF-8",standalone:"yes"},e.exports=a},{"./under-dash":26,"./utils":27}],29:[function(t,e,i){(function(i){(function(){const n=t("events"),s=t("jszip"),r=t("./stream-buf"),{stringToBuffer:o}=t("./browser-buffer-encode");class a extends n.EventEmitter{constructor(t){super(),this.options=Object.assign({type:"nodebuffer",compression:"DEFLATE"},t),this.zip=new s,this.stream=new r}append(t,e){e.hasOwnProperty("base64")&&e.base64?this.zip.file(e.name,t,{base64:!0}):(i.browser&&"string"==typeof t&&(t=o(t)),this.zip.file(e.name,t))}async finalize(){const t=await this.zip.generateAsync(this.options);this.stream.end(t),this.emit("finish")}read(t){return this.stream.read(t)}setEncoding(t){return this.stream.setEncoding(t)}pause(){return this.stream.pause()}resume(){return this.stream.resume()}isPaused(){return this.stream.isPaused()}pipe(t,e){return this.stream.pipe(t,e)}unpipe(t){return this.stream.unpipe(t)}unshift(t){return this.stream.unshift(t)}wrap(t){return this.stream.wrap(t)}}e.exports={ZipWriter:a}}).call(this)}).call(this,t("_process"))},{"./browser-buffer-encode":17,"./stream-buf":24,_process:467,events:422,jszip:441}],30:[function(t,e,i){e.exports={0:{f:"General"},1:{f:"0"},2:{f:"0.00"},3:{f:"#,##0"},4:{f:"#,##0.00"},9:{f:"0%"},10:{f:"0.00%"},11:{f:"0.00E+00"},12:{f:"# ?/?"},13:{f:"# ??/??"},14:{f:"mm-dd-yy"},15:{f:"d-mmm-yy"},16:{f:"d-mmm"},17:{f:"mmm-yy"},18:{f:"h:mm AM/PM"},19:{f:"h:mm:ss AM/PM"},20:{f:"h:mm"},21:{f:"h:mm:ss"},22:{f:'m/d/yy "h":mm'},27:{"zh-tw":"[$-404]e/m/d","zh-cn":'yyyy""m""',"ja-jp":"[$-411]ge.m.d","ko-kr":'yyyy"" mm"" dd""'},28:{"zh-tw":'[$-404]e""m""d""',"zh-cn":'m""d""',"ja-jp":'[$-411]ggge""m""d""',"ko-kr":"mm-dd"},29:{"zh-tw":'[$-404]e""m""d""',"zh-cn":'m""d""',"ja-jp":'[$-411]ggge""m""d""',"ko-kr":"mm-dd"},30:{"zh-tw":"m/d/yy ","zh-cn":"m-d-yy","ja-jp":"m/d/yy","ko-kr":"mm-dd-yy"},31:{"zh-tw":'yyyy""m""d""',"zh-cn":'yyyy""m""d""',"ja-jp":'yyyy""m""d""',"ko-kr":'yyyy"" mm"" dd""'},32:{"zh-tw":'hh""mm""',"zh-cn":'h""mm""',"ja-jp":'h""mm""',"ko-kr":'h"" mm""'},33:{"zh-tw":'hh""mm""ss""',"zh-cn":'h""mm""ss""',"ja-jp":'h""mm""ss""',"ko-kr":'h"" mm"" ss""'},34:{"zh-tw":'/ hh""mm""',"zh-cn":'/ h""mm""',"ja-jp":'yyyy""m""',"ko-kr":"yyyy-mm-dd"},35:{"zh-tw":'/ hh""mm""ss""',"zh-cn":'/ h""mm""ss""',"ja-jp":'m""d""',"ko-kr":"yyyy-mm-dd"},36:{"zh-tw":"[$-404]e/m/d","zh-cn":'yyyy""m""',"ja-jp":"[$-411]ge.m.d","ko-kr":'yyyy"" mm"" dd""'},37:{f:"#,##0 ;(#,##0)"},38:{f:"#,##0 ;[Red](#,##0)"},39:{f:"#,##0.00 ;(#,##0.00)"},40:{f:"#,##0.00 ;[Red](#,##0.00)"},45:{f:"mm:ss"},46:{f:"[h]:mm:ss"},47:{f:"mmss.0"},48:{f:"##0.0E+0"},49:{f:"@"},50:{"zh-tw":"[$-404]e/m/d","zh-cn":'yyyy""m""',"ja-jp":"[$-411]ge.m.d","ko-kr":'yyyy"" mm"" dd""'},51:{"zh-tw":'[$-404]e""m""d""',"zh-cn":'m""d""',"ja-jp":'[$-411]ggge""m""d""',"ko-kr":"mm-dd"},52:{"zh-tw":'/ hh""mm""',"zh-cn":'yyyy""m""',"ja-jp":'yyyy""m""',"ko-kr":"yyyy-mm-dd"},53:{"zh-tw":'/ hh""mm""ss""',"zh-cn":'m""d""',"ja-jp":'m""d""',"ko-kr":"yyyy-mm-dd"},54:{"zh-tw":'[$-404]e""m""d""',"zh-cn":'m""d""',"ja-jp":'[$-411]ggge""m""d""',"ko-kr":"mm-dd"},55:{"zh-tw":'/ hh""mm""',"zh-cn":'/ h""mm""',"ja-jp":'yyyy""m""',"ko-kr":"yyyy-mm-dd"},56:{"zh-tw":'/ hh""mm""ss""',"zh-cn":'/ h""mm""ss""',"ja-jp":'m""d""',"ko-kr":"yyyy-mm-dd"},57:{"zh-tw":"[$-404]e/m/d","zh-cn":'yyyy""m""',"ja-jp":"[$-411]ge.m.d","ko-kr":'yyyy"" mm"" dd""'},58:{"zh-tw":'[$-404]e""m""d""',"zh-cn":'m""d""',"ja-jp":'[$-411]ggge""m""d""',"ko-kr":"mm-dd"},59:{"th-th":"t0"},60:{"th-th":"t0.00"},61:{"th-th":"t#,##0"},62:{"th-th":"t#,##0.00"},67:{"th-th":"t0%"},68:{"th-th":"t0.00%"},69:{"th-th":"t# ?/?"},70:{"th-th":"t# ??/??"},81:{"th-th":"d/m/bb"}}},{}],31:[function(t,e,i){e.exports={OfficeDocument:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",Worksheet:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet",CalcChain:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/calcChain",SharedStrings:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",Styles:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",Theme:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",Hyperlink:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",Image:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",CoreProperties:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",ExtenderProperties:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",Comments:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",VmlDrawing:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",Table:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/table"}},{}],32:[function(t,e,i){const n=t("../../utils/parse-sax"),s=t("../../utils/xml-stream");class r{prepare(){}render(){}parseOpen(t){}parseText(t){}parseClose(t){}reconcile(t,e){}reset(){this.model=null,this.map&&Object.values(this.map).forEach((t=>{t instanceof r?t.reset():t.xform&&t.xform.reset()}))}mergeModel(t){this.model=Object.assign(this.model||{},t)}async parse(t){for await(const e of t)for(const{eventType:t,value:i}of e)if("opentag"===t)this.parseOpen(i);else if("text"===t)this.parseText(i);else if("closetag"===t&&!this.parseClose(i.name))return this.model;return this.model}async parseStream(t){return this.parse(n(t))}get xml(){return this.toXml(this.model)}toXml(t){const e=new s;return this.render(e,t),e.xml}static toAttribute(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t){if(i)return e}else if(i||t!==e)return t.toString()}static toStringAttribute(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r.toAttribute(t,e,i)}static toStringValue(t,e){return void 0===t?e:t}static toBoolAttribute(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===t){if(i)return e}else if(i||t!==e)return t?"1":"0"}static toBoolValue(t,e){return void 0===t?e:"1"===t}static toIntAttribute(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r.toAttribute(t,e,i)}static toIntValue(t,e){return void 0===t?e:parseInt(t,10)}static toFloatAttribute(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r.toAttribute(t,e,i)}static toFloatValue(t,e){return void 0===t?e:parseFloat(t)}}e.exports=r},{"../../utils/parse-sax":22,"../../utils/xml-stream":28}],33:[function(t,e,i){const n=t("../base-xform"),s=t("../../../utils/col-cache");function r(t){try{return s.decodeEx(t),!0}catch(t){return!1}}function o(t){const e=[];let i=!1,n="";return t.split(",").forEach((t=>{if(!t)return;const s=(t.match(/'/g)||[]).length;if(!s)return void(i?n+=t+",":r(t)&&e.push(t));const o=s%2==0;!i&&o&&r(t)?e.push(t):i&&!o?(i=!1,r(n+t)&&e.push(n+t),n=""):(i=!0,n+=t+",")})),e}e.exports=class extends n{render(t,e){t.openNode("definedName",{name:e.name,localSheetId:e.localSheetId}),t.writeText(e.ranges.join(",")),t.closeNode()}parseOpen(t){switch(t.name){case"definedName":return this._parsedName=t.attributes.name,this._parsedLocalSheetId=t.attributes.localSheetId,this._parsedText=[],!0;default:return!1}}parseText(t){this._parsedText.push(t)}parseClose(){return this.model={name:this._parsedName,ranges:o(this._parsedText.join(""))},void 0!==this._parsedLocalSheetId&&(this.model.localSheetId=parseInt(this._parsedLocalSheetId,10)),!1}}},{"../../../utils/col-cache":19,"../base-xform":32}],34:[function(t,e,i){const n=t("../../../utils/utils"),s=t("../base-xform");e.exports=class extends s{render(t,e){t.leafNode("sheet",{sheetId:e.id,name:e.name,state:e.state,"r:id":e.rId})}parseOpen(t){return"sheet"===t.name&&(this.model={name:n.xmlDecode(t.attributes.name),id:parseInt(t.attributes.sheetId,10),state:t.attributes.state,rId:t.attributes["r:id"]},!0)}parseText(){}parseClose(){return!1}}},{"../../../utils/utils":27,"../base-xform":32}],35:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{render(t,e){t.leafNode("calcPr",{calcId:171027,fullCalcOnLoad:e.fullCalcOnLoad?1:void 0})}parseOpen(t){return"calcPr"===t.name&&(this.model={},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],36:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{render(t,e){t.leafNode("workbookPr",{date1904:e.date1904?1:void 0,defaultThemeVersion:164011,filterPrivacy:1})}parseOpen(t){return"workbookPr"===t.name&&(this.model={date1904:"1"===t.attributes.date1904},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],37:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{render(t,e){const i={xWindow:e.x||0,yWindow:e.y||0,windowWidth:e.width||12e3,windowHeight:e.height||24e3,firstSheet:e.firstSheet,activeTab:e.activeTab};e.visibility&&"visible"!==e.visibility&&(i.visibility=e.visibility),t.leafNode("workbookView",i)}parseOpen(t){if("workbookView"===t.name){const e=this.model={},i=function(t,i,n){const s=void 0!==i?e[t]=i:n;void 0!==s&&(e[t]=s)},n=function(t,i,n){const s=void 0!==i?e[t]=parseInt(i,10):n;void 0!==s&&(e[t]=s)};return n("x",t.attributes.xWindow,0),n("y",t.attributes.yWindow,0),n("width",t.attributes.windowWidth,25e3),n("height",t.attributes.windowHeight,1e4),i("visibility",t.attributes.visibility,"visible"),n("activeTab",t.attributes.activeTab,void 0),n("firstSheet",t.attributes.firstSheet,void 0),!0}return!1}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],38:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../../../utils/col-cache"),r=t("../../../utils/xml-stream"),o=t("../base-xform"),a=t("../static-xform"),h=t("../list-xform"),c=t("./defined-name-xform"),u=t("./sheet-xform"),l=t("./workbook-view-xform"),f=t("./workbook-properties-xform"),d=t("./workbook-calc-properties-xform");class p extends o{constructor(){super(),this.map={fileVersion:p.STATIC_XFORMS.fileVersion,workbookPr:new f,bookViews:new h({tag:"bookViews",count:!1,childXform:new l}),sheets:new h({tag:"sheets",count:!1,childXform:new u}),definedNames:new h({tag:"definedNames",count:!1,childXform:new c}),calcPr:new d}}prepare(t){t.sheets=t.worksheets;const e=[];let i=0;t.sheets.forEach((t=>{if(t.pageSetup&&t.pageSetup.printArea&&t.pageSetup.printArea.split("&&").forEach((n=>{const s=n.split(":"),r={name:"_xlnm.Print_Area",ranges:[`'${t.name}'!$${s[0]}:$${s[1]}`],localSheetId:i};e.push(r)})),t.pageSetup&&(t.pageSetup.printTitlesRow||t.pageSetup.printTitlesColumn)){const n=[];if(t.pageSetup.printTitlesColumn){const e=t.pageSetup.printTitlesColumn.split(":");n.push(`'${t.name}'!$${e[0]}:$${e[1]}`)}if(t.pageSetup.printTitlesRow){const e=t.pageSetup.printTitlesRow.split(":");n.push(`'${t.name}'!$${e[0]}:$${e[1]}`)}const s={name:"_xlnm.Print_Titles",ranges:n,localSheetId:i};e.push(s)}i++})),e.length&&(t.definedNames=t.definedNames.concat(e)),(t.media||[]).forEach(((t,e)=>{t.name=t.type+(e+1)}))}render(t,e){t.openXml(r.StdDocAttributes),t.openNode("workbook",p.WORKBOOK_ATTRIBUTES),this.map.fileVersion.render(t),this.map.workbookPr.render(t,e.properties),this.map.bookViews.render(t,e.views),this.map.sheets.render(t,e.sheets),this.map.definedNames.render(t,e.definedNames),this.map.calcPr.render(t,e.calcProperties),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"workbook":return!0;default:return this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t),!0}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case"workbook":return this.model={sheets:this.map.sheets.model,properties:this.map.workbookPr.model||{},views:this.map.bookViews.model,calcProperties:{}},this.map.definedNames.model&&(this.model.definedNames=this.map.definedNames.model),!1;default:return!0}}reconcile(t){const e=(t.workbookRels||[]).reduce(((t,e)=>(t[e.Id]=e,t)),{}),i=[];let r,o=0;(t.sheets||[]).forEach((n=>{const s=e[n.rId];s&&(r=t.worksheetHash["xl/"+s.Target.replace(/^(\s|\/xl\/)+/,"")],r&&(r.name=n.name,r.id=n.id,r.state=n.state,i[o++]=r))}));const a=[];n.each(t.definedNames,(t=>{if("_xlnm.Print_Area"===t.name){if(r=i[t.localSheetId],r){r.pageSetup||(r.pageSetup={});const e=s.decodeEx(t.ranges[0]);r.pageSetup.printArea=r.pageSetup.printArea?`${r.pageSetup.printArea}&&${e.dimensions}`:e.dimensions}}else if("_xlnm.Print_Titles"===t.name){if(r=i[t.localSheetId],r){r.pageSetup||(r.pageSetup={});const e=t.ranges.join(","),i=/\$/g,n=/\$\d+:\$\d+/,s=e.match(n);if(s&&s.length){const t=s[0];r.pageSetup.printTitlesRow=t.replace(i,"")}const o=/\$[A-Z]+:\$[A-Z]+/,a=e.match(o);if(a&&a.length){const t=a[0];r.pageSetup.printTitlesColumn=t.replace(i,"")}}}else a.push(t)})),t.definedNames=a,t.media.forEach(((t,e)=>{t.index=e}))}}p.WORKBOOK_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main","xmlns:r":"http://schemas.openxmlformats.org/officeDocument/2006/relationships","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","mc:Ignorable":"x15","xmlns:x15":"http://schemas.microsoft.com/office/spreadsheetml/2010/11/main"},p.STATIC_XFORMS={fileVersion:new a({tag:"fileVersion",$:{appName:"xl",lastEdited:5,lowestEdited:5,rupBuild:9303}})},e.exports=p},{"../../../utils/col-cache":19,"../../../utils/under-dash":26,"../../../utils/xml-stream":28,"../base-xform":32,"../list-xform":71,"../static-xform":120,"./defined-name-xform":33,"./sheet-xform":34,"./workbook-calc-properties-xform":35,"./workbook-properties-xform":36,"./workbook-view-xform":37}],39:[function(t,e,i){const n=t("../strings/rich-text-xform"),s=t("../../../utils/utils"),r=t("../base-xform"),o=e.exports=function(t){this.model=t};s.inherits(o,r,{get tag(){return"r"},get richTextXform(){return this._richTextXform||(this._richTextXform=new n),this._richTextXform},render(t,e){e=e||this.model,t.openNode("comment",{ref:e.ref,authorId:0}),t.openNode("text"),e&&e.note&&e.note.texts&&e.note.texts.forEach((e=>{this.richTextXform.render(t,e)})),t.closeNode(),t.closeNode()},parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"comment":return this.model={type:"note",note:{texts:[]},...t.attributes},!0;case"r":return this.parser=this.richTextXform,this.parser.parseOpen(t),!0;default:return!1}},parseText(t){this.parser&&this.parser.parseText(t)},parseClose(t){switch(t){case"comment":return!1;case"r":return this.model.note.texts.push(this.parser.model),this.parser=void 0,!0;default:return this.parser&&this.parser.parseClose(t),!0}}})},{"../../../utils/utils":27,"../base-xform":32,"../strings/rich-text-xform":122}],40:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../../../utils/utils"),r=t("../base-xform"),o=t("./comment-xform"),a=e.exports=function(){this.map={comment:new o}};s.inherits(a,r,{COMMENTS_ATTRIBUTES:{xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main"}},{render(t,e){e=e||this.model,t.openXml(n.StdDocAttributes),t.openNode("comments",a.COMMENTS_ATTRIBUTES),t.openNode("authors"),t.leafNode("author",null,"Author"),t.closeNode(),t.openNode("commentList"),e.comments.forEach((e=>{this.map.comment.render(t,e)})),t.closeNode(),t.closeNode()},parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"commentList":return this.model={comments:[]},!0;case"comment":return this.parser=this.map.comment,this.parser.parseOpen(t),!0;default:return!1}},parseText(t){this.parser&&this.parser.parseText(t)},parseClose(t){switch(t){case"commentList":return!1;case"comment":return this.model.comments.push(this.parser.model),this.parser=void 0,!0;default:return this.parser&&this.parser.parseClose(t),!0}}})},{"../../../utils/utils":27,"../../../utils/xml-stream":28,"../base-xform":32,"./comment-xform":39}],41:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{constructor(t){super(),this._model=t}get tag(){return this._model&&this._model.tag}render(t,e,i){(e===i[2]||"x:SizeWithCells"===this.tag&&e===i[1])&&t.leafNode(this.tag)}parseOpen(t){switch(t.name){case this.tag:return this.model={},this.model[this.tag]=!0,!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../../base-xform":32}],42:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{constructor(t){super(),this._model=t}get tag(){return this._model&&this._model.tag}render(t,e){t.leafNode(this.tag,null,e)}parseOpen(t){switch(t.name){case this.tag:return this.text="",!0;default:return!1}}parseText(t){this.text=t}parseClose(){return!1}}},{"../../base-xform":32}],43:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"x:Anchor"}getAnchorRect(t){const e=Math.floor(t.left),i=Math.floor(68*(t.left-e)),n=Math.floor(t.top),s=Math.floor(18*(t.top-n)),r=Math.floor(t.right),o=Math.floor(68*(t.right-r)),a=Math.floor(t.bottom);return[e,i,n,s,r,o,a,Math.floor(18*(t.bottom-a))]}getDefaultRect(t){const e=t.col,i=Math.max(t.row-2,0);return[e,6,i,14,e+2,2,i+4,16]}render(t,e){const i=e.anchor?this.getAnchorRect(e.anchor):this.getDefaultRect(e.refAddress);t.leafNode("x:Anchor",null,i.join(", "))}parseOpen(t){switch(t.name){case this.tag:return this.text="",!0;default:return!1}}parseText(t){this.text=t}parseClose(){return!1}}},{"../base-xform":32}],44:[function(t,e,i){const n=t("../base-xform"),s=t("./vml-anchor-xform"),r=t("./style/vml-protection-xform"),o=t("./style/vml-position-xform"),a=["twoCells","oneCells","absolute"];e.exports=class extends n{constructor(){super(),this.map={"x:Anchor":new s,"x:Locked":new r({tag:"x:Locked"}),"x:LockText":new r({tag:"x:LockText"}),"x:SizeWithCells":new o({tag:"x:SizeWithCells"}),"x:MoveWithCells":new o({tag:"x:MoveWithCells"})}}get tag(){return"x:ClientData"}render(t,e){const{protection:i,editAs:n}=e.note;t.openNode(this.tag,{ObjectType:"Note"}),this.map["x:MoveWithCells"].render(t,n,a),this.map["x:SizeWithCells"].render(t,n,a),this.map["x:Anchor"].render(t,e),this.map["x:Locked"].render(t,i.locked),t.leafNode("x:AutoFill",null,"False"),this.map["x:LockText"].render(t,i.lockText),t.leafNode("x:Row",null,e.refAddress.row-1),t.leafNode("x:Column",null,e.refAddress.col-1),t.closeNode()}parseOpen(t){switch(t.name){case this.tag:this.reset(),this.model={anchor:[],protection:{},editAs:""};break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.normalizeModel(),!1;default:return!0}}normalizeModel(){const t=Object.assign({},this.map["x:MoveWithCells"].model,this.map["x:SizeWithCells"].model),e=Object.keys(t).length;this.model.editAs=a[e],this.model.anchor=this.map["x:Anchor"].text,this.model.protection.locked=this.map["x:Locked"].text,this.model.protection.lockText=this.map["x:LockText"].text}}},{"../base-xform":32,"./style/vml-position-xform":41,"./style/vml-protection-xform":42,"./vml-anchor-xform":43}],45:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform"),r=t("./vml-shape-xform");class o extends s{constructor(){super(),this.map={"v:shape":new r}}get tag(){return"xml"}render(t,e){t.openXml(n.StdDocAttributes),t.openNode(this.tag,o.DRAWING_ATTRIBUTES),t.openNode("o:shapelayout",{"v:ext":"edit"}),t.leafNode("o:idmap",{"v:ext":"edit",data:1}),t.closeNode(),t.openNode("v:shapetype",{id:"_x0000_t202",coordsize:"21600,21600","o:spt":202,path:"m,l,21600r21600,l21600,xe"}),t.leafNode("v:stroke",{joinstyle:"miter"}),t.leafNode("v:path",{gradientshapeok:"t","o:connecttype":"rect"}),t.closeNode(),e.comments.forEach(((e,i)=>{this.map["v:shape"].render(t,e,i)})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset(),this.model={comments:[]};break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.model.comments.push(this.parser.model),this.parser=void 0),!0;switch(t){case this.tag:return!1;default:return!0}}reconcile(t,e){t.anchors.forEach((t=>{t.br?this.map["xdr:twoCellAnchor"].reconcile(t,e):this.map["xdr:oneCellAnchor"].reconcile(t,e)}))}}o.DRAWING_ATTRIBUTES={"xmlns:v":"urn:schemas-microsoft-com:vml","xmlns:o":"urn:schemas-microsoft-com:office:office","xmlns:x":"urn:schemas-microsoft-com:office:excel"},e.exports=o},{"../../../utils/xml-stream":28,"../base-xform":32,"./vml-shape-xform":46}],46:[function(t,e,i){const n=t("../base-xform"),s=t("./vml-textbox-xform"),r=t("./vml-client-data-xform");class o extends n{constructor(){super(),this.map={"v:textbox":new s,"x:ClientData":new r}}get tag(){return"v:shape"}render(t,e,i){t.openNode("v:shape",o.V_SHAPE_ATTRIBUTES(e,i)),t.leafNode("v:fill",{color2:"infoBackground [80]"}),t.leafNode("v:shadow",{color:"none [81]",obscured:"t"}),t.leafNode("v:path",{"o:connecttype":"none"}),this.map["v:textbox"].render(t,e),this.map["x:ClientData"].render(t,e),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset(),this.model={margins:{insetmode:t.attributes["o:insetmode"]},anchor:"",editAs:"",protection:{}};break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model.margins.inset=this.map["v:textbox"].model&&this.map["v:textbox"].model.inset,this.model.protection=this.map["x:ClientData"].model&&this.map["x:ClientData"].model.protection,this.model.anchor=this.map["x:ClientData"].model&&this.map["x:ClientData"].model.anchor,this.model.editAs=this.map["x:ClientData"].model&&this.map["x:ClientData"].model.editAs,!1;default:return!0}}}o.V_SHAPE_ATTRIBUTES=(t,e)=>({id:"_x0000_s"+(1025+e),type:"#_x0000_t202",style:"position:absolute; margin-left:105.3pt;margin-top:10.5pt;width:97.8pt;height:59.1pt;z-index:1;visibility:hidden",fillcolor:"infoBackground [80]",strokecolor:"none [81]","o:insetmode":t.note.margins&&t.note.margins.insetmode}),e.exports=o},{"../base-xform":32,"./vml-client-data-xform":44,"./vml-textbox-xform":47}],47:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"v:textbox"}conversionUnit(t,e,i){return`${parseFloat(t)*e.toFixed(2)}${i}`}reverseConversionUnit(t){return(t||"").split(",").map((t=>Number(parseFloat(this.conversionUnit(parseFloat(t),.1,"")).toFixed(2))))}render(t,e){const i={style:"mso-direction-alt:auto"};if(e&&e.note){let{inset:t}=e.note&&e.note.margins;Array.isArray(t)&&(t=t.map((t=>this.conversionUnit(t,10,"mm"))).join(",")),t&&(i.inset=t)}t.openNode("v:textbox",i),t.leafNode("div",{style:"text-align:left"}),t.closeNode()}parseOpen(t){switch(t.name){case this.tag:return this.model={inset:this.reverseConversionUnit(t.attributes.inset)},!0;default:return!0}}parseText(){}parseClose(t){switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32}],48:[function(t,e,i){const n=t("./base-xform");e.exports=class extends n{createNewModel(t){return{}}parseOpen(t){return this.parser=this.parser||this.map[t.name],this.parser?(this.parser.parseOpen(t),!0):t.name===this.tag&&(this.model=this.createNewModel(t),!0)}parseText(t){this.parser&&this.parser.parseText(t)}onParserClose(t,e){this.model[t]=e.model}parseClose(t){return this.parser?(this.parser.parseClose(t)||(this.onParserClose(t,this.parser),this.parser=void 0),!0):t!==this.tag}}},{"./base-xform":32}],49:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{render(t,e){t.openNode("HeadingPairs"),t.openNode("vt:vector",{size:2,baseType:"variant"}),t.openNode("vt:variant"),t.leafNode("vt:lpstr",void 0,"Worksheets"),t.closeNode(),t.openNode("vt:variant"),t.leafNode("vt:i4",void 0,e.length),t.closeNode(),t.closeNode(),t.closeNode()}parseOpen(t){return"HeadingPairs"===t.name}parseText(){}parseClose(t){return"HeadingPairs"!==t}}},{"../base-xform":32}],50:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{render(t,e){t.openNode("TitlesOfParts"),t.openNode("vt:vector",{size:e.length,baseType:"lpstr"}),e.forEach((e=>{t.leafNode("vt:lpstr",void 0,e.name)})),t.closeNode(),t.closeNode()}parseOpen(t){return"TitlesOfParts"===t.name}parseText(){}parseClose(t){return"TitlesOfParts"!==t}}},{"../base-xform":32}],51:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform"),r=t("../simple/string-xform"),o=t("./app-heading-pairs-xform"),a=t("./app-titles-of-parts-xform");class h extends s{constructor(){super(),this.map={Company:new r({tag:"Company"}),Manager:new r({tag:"Manager"}),HeadingPairs:new o,TitleOfParts:new a}}render(t,e){t.openXml(n.StdDocAttributes),t.openNode("Properties",h.PROPERTY_ATTRIBUTES),t.leafNode("Application",void 0,"Microsoft Excel"),t.leafNode("DocSecurity",void 0,"0"),t.leafNode("ScaleCrop",void 0,"false"),this.map.HeadingPairs.render(t,e.worksheets),this.map.TitleOfParts.render(t,e.worksheets),this.map.Company.render(t,e.company||""),this.map.Manager.render(t,e.manager),t.leafNode("LinksUpToDate",void 0,"false"),t.leafNode("SharedDoc",void 0,"false"),t.leafNode("HyperlinksChanged",void 0,"false"),t.leafNode("AppVersion",void 0,"16.0300"),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"Properties":return!0;default:return this.parser=this.map[t.name],!!this.parser&&(this.parser.parseOpen(t),!0)}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case"Properties":return this.model={worksheets:this.map.TitleOfParts.model,company:this.map.Company.model,manager:this.map.Manager.model},!1;default:return!0}}}h.DateFormat=function(t){return t.toISOString().replace(/[.]\d{3,6}/,"")},h.DateAttrs={"xsi:type":"dcterms:W3CDTF"},h.PROPERTY_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties","xmlns:vt":"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes"},e.exports=h},{"../../../utils/xml-stream":28,"../base-xform":32,"../simple/string-xform":119,"./app-heading-pairs-xform":49,"./app-titles-of-parts-xform":50}],52:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform");class r extends s{render(t,e){t.openXml(n.StdDocAttributes),t.openNode("Types",r.PROPERTY_ATTRIBUTES);const i={};(e.media||[]).forEach((e=>{if("image"===e.type){const n=e.extension;i[n]||(i[n]=!0,t.leafNode("Default",{Extension:n,ContentType:"image/"+n}))}})),t.leafNode("Default",{Extension:"rels",ContentType:"application/vnd.openxmlformats-package.relationships+xml"}),t.leafNode("Default",{Extension:"xml",ContentType:"application/xml"}),t.leafNode("Override",{PartName:"/xl/workbook.xml",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"}),e.worksheets.forEach((e=>{const i=`/xl/worksheets/sheet${e.id}.xml`;t.leafNode("Override",{PartName:i,ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"})})),t.leafNode("Override",{PartName:"/xl/theme/theme1.xml",ContentType:"application/vnd.openxmlformats-officedocument.theme+xml"}),t.leafNode("Override",{PartName:"/xl/styles.xml",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml"});e.sharedStrings&&e.sharedStrings.count&&t.leafNode("Override",{PartName:"/xl/sharedStrings.xml",ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml"}),e.tables&&e.tables.forEach((e=>{t.leafNode("Override",{PartName:"/xl/tables/"+e.target,ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml"})})),e.drawings&&e.drawings.forEach((e=>{t.leafNode("Override",{PartName:`/xl/drawings/${e.name}.xml`,ContentType:"application/vnd.openxmlformats-officedocument.drawing+xml"})})),e.commentRefs&&(t.leafNode("Default",{Extension:"vml",ContentType:"application/vnd.openxmlformats-officedocument.vmlDrawing"}),e.commentRefs.forEach((e=>{let{commentName:i}=e;t.leafNode("Override",{PartName:`/xl/${i}.xml`,ContentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml"})}))),t.leafNode("Override",{PartName:"/docProps/core.xml",ContentType:"application/vnd.openxmlformats-package.core-properties+xml"}),t.leafNode("Override",{PartName:"/docProps/app.xml",ContentType:"application/vnd.openxmlformats-officedocument.extended-properties+xml"}),t.closeNode()}parseOpen(){return!1}parseText(){}parseClose(){return!1}}r.PROPERTY_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/package/2006/content-types"},e.exports=r},{"../../../utils/xml-stream":28,"../base-xform":32}],53:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform"),r=t("../simple/date-xform"),o=t("../simple/string-xform"),a=t("../simple/integer-xform");class h extends s{constructor(){super(),this.map={"dc:creator":new o({tag:"dc:creator"}),"dc:title":new o({tag:"dc:title"}),"dc:subject":new o({tag:"dc:subject"}),"dc:description":new o({tag:"dc:description"}),"dc:identifier":new o({tag:"dc:identifier"}),"dc:language":new o({tag:"dc:language"}),"cp:keywords":new o({tag:"cp:keywords"}),"cp:category":new o({tag:"cp:category"}),"cp:lastModifiedBy":new o({tag:"cp:lastModifiedBy"}),"cp:lastPrinted":new r({tag:"cp:lastPrinted",format:h.DateFormat}),"cp:revision":new a({tag:"cp:revision"}),"cp:version":new o({tag:"cp:version"}),"cp:contentStatus":new o({tag:"cp:contentStatus"}),"cp:contentType":new o({tag:"cp:contentType"}),"dcterms:created":new r({tag:"dcterms:created",attrs:h.DateAttrs,format:h.DateFormat}),"dcterms:modified":new r({tag:"dcterms:modified",attrs:h.DateAttrs,format:h.DateFormat})}}render(t,e){t.openXml(n.StdDocAttributes),t.openNode("cp:coreProperties",h.CORE_PROPERTY_ATTRIBUTES),this.map["dc:creator"].render(t,e.creator),this.map["dc:title"].render(t,e.title),this.map["dc:subject"].render(t,e.subject),this.map["dc:description"].render(t,e.description),this.map["dc:identifier"].render(t,e.identifier),this.map["dc:language"].render(t,e.language),this.map["cp:keywords"].render(t,e.keywords),this.map["cp:category"].render(t,e.category),this.map["cp:lastModifiedBy"].render(t,e.lastModifiedBy),this.map["cp:lastPrinted"].render(t,e.lastPrinted),this.map["cp:revision"].render(t,e.revision),this.map["cp:version"].render(t,e.version),this.map["cp:contentStatus"].render(t,e.contentStatus),this.map["cp:contentType"].render(t,e.contentType),this.map["dcterms:created"].render(t,e.created),this.map["dcterms:modified"].render(t,e.modified),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"cp:coreProperties":case"coreProperties":return!0;default:if(this.parser=this.map[t.name],this.parser)return this.parser.parseOpen(t),!0;throw new Error("Unexpected xml node in parseOpen: "+JSON.stringify(t))}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case"cp:coreProperties":case"coreProperties":return this.model={creator:this.map["dc:creator"].model,title:this.map["dc:title"].model,subject:this.map["dc:subject"].model,description:this.map["dc:description"].model,identifier:this.map["dc:identifier"].model,language:this.map["dc:language"].model,keywords:this.map["cp:keywords"].model,category:this.map["cp:category"].model,lastModifiedBy:this.map["cp:lastModifiedBy"].model,lastPrinted:this.map["cp:lastPrinted"].model,revision:this.map["cp:revision"].model,contentStatus:this.map["cp:contentStatus"].model,contentType:this.map["cp:contentType"].model,created:this.map["dcterms:created"].model,modified:this.map["dcterms:modified"].model},!1;default:throw new Error("Unexpected xml node in parseClose: "+t)}}}h.DateFormat=function(t){return t.toISOString().replace(/[.]\d{3}/,"")},h.DateAttrs={"xsi:type":"dcterms:W3CDTF"},h.CORE_PROPERTY_ATTRIBUTES={"xmlns:cp":"http://schemas.openxmlformats.org/package/2006/metadata/core-properties","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:dcterms":"http://purl.org/dc/terms/","xmlns:dcmitype":"http://purl.org/dc/dcmitype/","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance"},e.exports=h},{"../../../utils/xml-stream":28,"../base-xform":32,"../simple/date-xform":117,"../simple/integer-xform":118,"../simple/string-xform":119}],54:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{render(t,e){t.leafNode("Relationship",e)}parseOpen(t){switch(t.name){case"Relationship":return this.model=t.attributes,!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],55:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform"),r=t("./relationship-xform");class o extends s{constructor(){super(),this.map={Relationship:new r}}render(t,e){e=e||this._values,t.openXml(n.StdDocAttributes),t.openNode("Relationships",o.RELATIONSHIPS_ATTRIBUTES),e.forEach((e=>{this.map.Relationship.render(t,e)})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"Relationships":return this.model=[],!0;default:if(this.parser=this.map[t.name],this.parser)return this.parser.parseOpen(t),!0;throw new Error("Unexpected xml node in parseOpen: "+JSON.stringify(t))}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.model.push(this.parser.model),this.parser=void 0),!0;switch(t){case"Relationships":return!1;default:throw new Error("Unexpected xml node in parseClose: "+t)}}}o.RELATIONSHIPS_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/package/2006/relationships"},e.exports=o},{"../../../utils/xml-stream":28,"../base-xform":32,"./relationship-xform":54}],56:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset(),this.model={range:{editAs:t.attributes.editAs||"oneCell"}};break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}reconcilePicture(t,e){if(t&&t.rId){const i=e.rels[t.rId].Target.match(/.*\/media\/(.+[.][a-zA-Z]{3,4})/);if(i){const t=i[1],n=e.mediaIndex[t];return e.media[n]}}}}},{"../base-xform":32}],57:[function(t,e,i){const n=t("../base-xform"),s=t("./blip-xform");e.exports=class extends n{constructor(){super(),this.map={"a:blip":new s}}get tag(){return"xdr:blipFill"}render(t,e){t.openNode(this.tag),this.map["a:blip"].render(t,e),t.openNode("a:stretch"),t.leafNode("a:fillRect"),t.closeNode(),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset();break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(){}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model=this.map["a:blip"].model,!1;default:return!0}}}},{"../base-xform":32,"./blip-xform":58}],58:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"a:blip"}render(t,e){t.leafNode(this.tag,{"xmlns:r":"http://schemas.openxmlformats.org/officeDocument/2006/relationships","r:embed":e.rId,cstate:"print"})}parseOpen(t){switch(t.name){case this.tag:return this.model={rId:t.attributes["r:embed"]},!0;default:return!0}}parseText(){}parseClose(t){switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32}],59:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"xdr:cNvPicPr"}render(t){t.openNode(this.tag),t.leafNode("a:picLocks",{noChangeAspect:"1"}),t.closeNode()}parseOpen(t){switch(t.name){case this.tag:default:return!0}}parseText(){}parseClose(t){switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32}],60:[function(t,e,i){const n=t("../base-xform"),s=t("./hlink-click-xform"),r=t("./ext-lst-xform");e.exports=class extends n{constructor(){super(),this.map={"a:hlinkClick":new s,"a:extLst":new r}}get tag(){return"xdr:cNvPr"}render(t,e){t.openNode(this.tag,{id:e.index,name:"Picture "+e.index}),this.map["a:hlinkClick"].render(t,e),this.map["a:extLst"].render(t,e),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset();break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(){}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model=this.map["a:hlinkClick"].model,!1;default:return!0}}}},{"../base-xform":32,"./ext-lst-xform":63,"./hlink-click-xform":65}],61:[function(t,e,i){const n=t("../base-xform"),s=t("../simple/integer-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.map={"xdr:col":new s({tag:"xdr:col",zero:!0}),"xdr:colOff":new s({tag:"xdr:colOff",zero:!0}),"xdr:row":new s({tag:"xdr:row",zero:!0}),"xdr:rowOff":new s({tag:"xdr:rowOff",zero:!0})}}render(t,e){t.openNode(this.tag),this.map["xdr:col"].render(t,e.nativeCol),this.map["xdr:colOff"].render(t,e.nativeColOff),this.map["xdr:row"].render(t,e.nativeRow),this.map["xdr:rowOff"].render(t,e.nativeRowOff),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset();break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model={nativeCol:this.map["xdr:col"].model,nativeColOff:this.map["xdr:colOff"].model,nativeRow:this.map["xdr:row"].model,nativeRowOff:this.map["xdr:rowOff"].model},!1;default:return!0}}}},{"../base-xform":32,"../simple/integer-xform":118}],62:[function(t,e,i){const n=t("../../../utils/col-cache"),s=t("../../../utils/xml-stream"),r=t("../base-xform"),o=t("./two-cell-anchor-xform"),a=t("./one-cell-anchor-xform");class h extends r{constructor(){super(),this.map={"xdr:twoCellAnchor":new o,"xdr:oneCellAnchor":new a}}prepare(t){t.anchors.forEach(((t,e)=>{t.anchorType=function(t){return("string"==typeof t.range?n.decode(t.range):t.range).br?"xdr:twoCellAnchor":"xdr:oneCellAnchor"}(t);this.map[t.anchorType].prepare(t,{index:e})}))}get tag(){return"xdr:wsDr"}render(t,e){t.openXml(s.StdDocAttributes),t.openNode(this.tag,h.DRAWING_ATTRIBUTES),e.anchors.forEach((e=>{this.map[e.anchorType].render(t,e)})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset(),this.model={anchors:[]};break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.model.anchors.push(this.parser.model),this.parser=void 0),!0;switch(t){case this.tag:return!1;default:return!0}}reconcile(t,e){t.anchors.forEach((t=>{t.br?this.map["xdr:twoCellAnchor"].reconcile(t,e):this.map["xdr:oneCellAnchor"].reconcile(t,e)}))}}h.DRAWING_ATTRIBUTES={"xmlns:xdr":"http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing","xmlns:a":"http://schemas.openxmlformats.org/drawingml/2006/main"},e.exports=h},{"../../../utils/col-cache":19,"../../../utils/xml-stream":28,"../base-xform":32,"./one-cell-anchor-xform":67,"./two-cell-anchor-xform":70}],63:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"a:extLst"}render(t){t.openNode(this.tag),t.openNode("a:ext",{uri:"{FF2B5EF4-FFF2-40B4-BE49-F238E27FC236}"}),t.leafNode("a16:creationId",{"xmlns:a16":"http://schemas.microsoft.com/office/drawing/2014/main",id:"{00000000-0008-0000-0000-000002000000}"}),t.closeNode(),t.closeNode()}parseOpen(t){switch(t.name){case this.tag:default:return!0}}parseText(){}parseClose(t){switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32}],64:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.map={}}render(t,e){t.openNode(this.tag);const i=Math.floor(9525*e.width),n=Math.floor(9525*e.height);t.addAttribute("cx",i),t.addAttribute("cy",n),t.closeNode()}parseOpen(t){return t.name===this.tag&&(this.model={width:parseInt(t.attributes.cx||"0",10)/9525,height:parseInt(t.attributes.cy||"0",10)/9525},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],65:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"a:hlinkClick"}render(t,e){e.hyperlinks&&e.hyperlinks.rId&&t.leafNode(this.tag,{"xmlns:r":"http://schemas.openxmlformats.org/officeDocument/2006/relationships","r:id":e.hyperlinks.rId,tooltip:e.hyperlinks.tooltip})}parseOpen(t){switch(t.name){case this.tag:return this.model={hyperlinks:{rId:t.attributes["r:id"],tooltip:t.attributes.tooltip}},!0;default:return!0}}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],66:[function(t,e,i){const n=t("../base-xform"),s=t("./c-nv-pr-xform"),r=t("./c-nv-pic-pr-xform");e.exports=class extends n{constructor(){super(),this.map={"xdr:cNvPr":new s,"xdr:cNvPicPr":new r}}get tag(){return"xdr:nvPicPr"}render(t,e){t.openNode(this.tag),this.map["xdr:cNvPr"].render(t,e),this.map["xdr:cNvPicPr"].render(t,e),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset();break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(){}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model=this.map["xdr:cNvPr"].model,!1;default:return!0}}}},{"../base-xform":32,"./c-nv-pic-pr-xform":59,"./c-nv-pr-xform":60}],67:[function(t,e,i){const n=t("./base-cell-anchor-xform"),s=t("../static-xform"),r=t("./cell-position-xform"),o=t("./ext-xform"),a=t("./pic-xform");e.exports=class extends n{constructor(){super(),this.map={"xdr:from":new r({tag:"xdr:from"}),"xdr:ext":new o({tag:"xdr:ext"}),"xdr:pic":new a,"xdr:clientData":new s({tag:"xdr:clientData"})}}get tag(){return"xdr:oneCellAnchor"}prepare(t,e){this.map["xdr:pic"].prepare(t.picture,e)}render(t,e){t.openNode(this.tag,{editAs:e.range.editAs||"oneCell"}),this.map["xdr:from"].render(t,e.range.tl),this.map["xdr:ext"].render(t,e.range.ext),this.map["xdr:pic"].render(t,e.picture),this.map["xdr:clientData"].render(t,{}),t.closeNode()}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model.range.tl=this.map["xdr:from"].model,this.model.range.ext=this.map["xdr:ext"].model,this.model.picture=this.map["xdr:pic"].model,!1;default:return!0}}reconcile(t,e){t.medium=this.reconcilePicture(t.picture,e)}}},{"../static-xform":120,"./base-cell-anchor-xform":56,"./cell-position-xform":61,"./ext-xform":64,"./pic-xform":68}],68:[function(t,e,i){const n=t("../base-xform"),s=t("../static-xform"),r=t("./blip-fill-xform"),o=t("./nv-pic-pr-xform"),a=t("./sp-pr");e.exports=class extends n{constructor(){super(),this.map={"xdr:nvPicPr":new o,"xdr:blipFill":new r,"xdr:spPr":new s(a)}}get tag(){return"xdr:pic"}prepare(t,e){t.index=e.index+1}render(t,e){t.openNode(this.tag),this.map["xdr:nvPicPr"].render(t,e),this.map["xdr:blipFill"].render(t,e),this.map["xdr:spPr"].render(t,e),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:this.reset();break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(){}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.mergeModel(this.parser.model),this.parser=void 0),!0;switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32,"../static-xform":120,"./blip-fill-xform":57,"./nv-pic-pr-xform":66,"./sp-pr":69}],69:[function(t,e,i){e.exports={tag:"xdr:spPr",c:[{tag:"a:xfrm",c:[{tag:"a:off",$:{x:"0",y:"0"}},{tag:"a:ext",$:{cx:"0",cy:"0"}}]},{tag:"a:prstGeom",$:{prst:"rect"},c:[{tag:"a:avLst"}]}]}},{}],70:[function(t,e,i){const n=t("./base-cell-anchor-xform"),s=t("../static-xform"),r=t("./cell-position-xform"),o=t("./pic-xform");e.exports=class extends n{constructor(){super(),this.map={"xdr:from":new r({tag:"xdr:from"}),"xdr:to":new r({tag:"xdr:to"}),"xdr:pic":new o,"xdr:clientData":new s({tag:"xdr:clientData"})}}get tag(){return"xdr:twoCellAnchor"}prepare(t,e){this.map["xdr:pic"].prepare(t.picture,e)}render(t,e){t.openNode(this.tag,{editAs:e.range.editAs||"oneCell"}),this.map["xdr:from"].render(t,e.range.tl),this.map["xdr:to"].render(t,e.range.br),this.map["xdr:pic"].render(t,e.picture),this.map["xdr:clientData"].render(t,{}),t.closeNode()}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model.range.tl=this.map["xdr:from"].model,this.model.range.br=this.map["xdr:to"].model,this.model.picture=this.map["xdr:pic"].model,!1;default:return!0}}reconcile(t,e){t.medium=this.reconcilePicture(t.picture,e)}}},{"../static-xform":120,"./base-cell-anchor-xform":56,"./cell-position-xform":61,"./pic-xform":68}],71:[function(t,e,i){const n=t("./base-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.always=!!t.always,this.count=t.count,this.empty=t.empty,this.$count=t.$count||"count",this.$=t.$,this.childXform=t.childXform,this.maxItems=t.maxItems}prepare(t,e){const{childXform:i}=this;t&&t.forEach(((t,n)=>{e.index=n,i.prepare(t,e)}))}render(t,e){if(this.always||e&&e.length){t.openNode(this.tag,this.$),this.count&&t.addAttribute(this.$count,e&&e.length||0);const{childXform:i}=this;(e||[]).forEach(((e,n)=>{i.render(t,e,n)})),t.closeNode()}else this.empty&&t.leafNode(this.tag)}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:return this.model=[],!0;default:return!!this.childXform.parseOpen(t)&&(this.parser=this.childXform,!0)}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser){if(!this.parser.parseClose(t)&&(this.model.push(this.parser.model),this.parser=void 0,this.maxItems&&this.model.length>this.maxItems))throw new Error(`Max ${this.childXform.tag} count (${this.maxItems}) exceeded`);return!0}return!1}reconcile(t,e){if(t){const{childXform:i}=this;t.forEach((t=>{i.reconcile(t,e)}))}}}},{"./base-xform":32}],72:[function(t,e,i){const n=t("../../../utils/col-cache"),s=t("../base-xform");e.exports=class extends s{get tag(){return"autoFilter"}render(t,e){if(e)if("string"==typeof e)t.leafNode("autoFilter",{ref:e});else{const i=function(t){return"string"==typeof t?t:n.getAddress(t.row,t.column).address},s=i(e.from),r=i(e.to);s&&r&&t.leafNode("autoFilter",{ref:`${s}:${r}`})}}parseOpen(t){"autoFilter"===t.name&&(this.model=t.attributes.ref)}}},{"../../../utils/col-cache":19,"../base-xform":32}],73:[function(t,e,i){const n=t("../../../utils/utils"),s=t("../base-xform"),r=t("../../../doc/range"),o=t("../../../doc/enums"),a=t("../strings/rich-text-xform");function h(t){if(null==t)return o.ValueType.Null;if(t instanceof String||"string"==typeof t)return o.ValueType.String;if("number"==typeof t)return o.ValueType.Number;if("boolean"==typeof t)return o.ValueType.Boolean;if(t instanceof Date)return o.ValueType.Date;if(t.text&&t.hyperlink)return o.ValueType.Hyperlink;if(t.formula)return o.ValueType.Formula;if(t.error)return o.ValueType.Error;throw new Error("I could not understand type of value")}e.exports=class extends s{constructor(){super(),this.richTextXForm=new a}get tag(){return"c"}prepare(t,e){const i=e.styles.addStyleModel(t.style||{},function(t){switch(t.type){case o.ValueType.Formula:return h(t.result);default:return t.type}}(t));switch(i&&(t.styleId=i),t.comment&&e.comments.push({...t.comment,ref:t.address}),t.type){case o.ValueType.String:case o.ValueType.RichText:e.sharedStrings&&(t.ssId=e.sharedStrings.add(t.value));break;case o.ValueType.Date:e.date1904&&(t.date1904=!0);break;case o.ValueType.Hyperlink:e.sharedStrings&&void 0!==t.text&&null!==t.text&&(t.ssId=e.sharedStrings.add(t.text)),e.hyperlinks.push({address:t.address,target:t.hyperlink,tooltip:t.tooltip});break;case o.ValueType.Merge:e.merges.add(t);break;case o.ValueType.Formula:if(e.date1904&&(t.date1904=!0),"shared"===t.shareType&&(t.si=e.siFormulae++),t.formula)e.formulae[t.address]=t;else if(t.sharedFormula){const i=e.formulae[t.sharedFormula];if(!i)throw new Error("Shared Formula master must exist above and or left of clone for cell "+t.address);void 0===i.si?(i.shareType="shared",i.si=e.siFormulae++,i.range=new r(i.address,t.address)):i.range&&i.range.expandToAddress(t.address),t.si=i.si}}}renderFormula(t,e){let i=null;switch(e.shareType){case"shared":i={t:"shared",ref:e.ref||e.range.range,si:e.si};break;case"array":i={t:"array",ref:e.ref};break;default:void 0!==e.si&&(i={t:"shared",si:e.si})}switch(h(e.result)){case o.ValueType.Null:t.leafNode("f",i,e.formula);break;case o.ValueType.String:t.addAttribute("t","str"),t.leafNode("f",i,e.formula),t.leafNode("v",null,e.result);break;case o.ValueType.Number:t.leafNode("f",i,e.formula),t.leafNode("v",null,e.result);break;case o.ValueType.Boolean:t.addAttribute("t","b"),t.leafNode("f",i,e.formula),t.leafNode("v",null,e.result?1:0);break;case o.ValueType.Error:t.addAttribute("t","e"),t.leafNode("f",i,e.formula),t.leafNode("v",null,e.result.error);break;case o.ValueType.Date:t.leafNode("f",i,e.formula),t.leafNode("v",null,n.dateToExcel(e.result,e.date1904));break;default:throw new Error("I could not understand type of value")}}render(t,e){if(e.type!==o.ValueType.Null||e.styleId){switch(t.openNode("c"),t.addAttribute("r",e.address),e.styleId&&t.addAttribute("s",e.styleId),e.type){case o.ValueType.Null:break;case o.ValueType.Number:t.leafNode("v",null,e.value);break;case o.ValueType.Boolean:t.addAttribute("t","b"),t.leafNode("v",null,e.value?"1":"0");break;case o.ValueType.Error:t.addAttribute("t","e"),t.leafNode("v",null,e.value.error);break;case o.ValueType.String:case o.ValueType.RichText:void 0!==e.ssId?(t.addAttribute("t","s"),t.leafNode("v",null,e.ssId)):e.value&&e.value.richText?(t.addAttribute("t","inlineStr"),t.openNode("is"),e.value.richText.forEach((e=>{this.richTextXForm.render(t,e)})),t.closeNode("is")):(t.addAttribute("t","str"),t.leafNode("v",null,e.value));break;case o.ValueType.Date:t.leafNode("v",null,n.dateToExcel(e.value,e.date1904));break;case o.ValueType.Hyperlink:void 0!==e.ssId?(t.addAttribute("t","s"),t.leafNode("v",null,e.ssId)):(t.addAttribute("t","str"),t.leafNode("v",null,e.text));break;case o.ValueType.Formula:this.renderFormula(t,e);break}t.closeNode()}}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"c":return this.model={address:t.attributes.r},this.t=t.attributes.t,t.attributes.s&&(this.model.styleId=parseInt(t.attributes.s,10)),!0;case"f":return this.currentNode="f",this.model.si=t.attributes.si,this.model.shareType=t.attributes.t,this.model.ref=t.attributes.ref,!0;case"v":return this.currentNode="v",!0;case"t":return this.currentNode="t",!0;case"r":return this.parser=this.richTextXForm,this.parser.parseOpen(t),!0;default:return!1}}parseText(t){if(this.parser)this.parser.parseText(t);else switch(this.currentNode){case"f":this.model.formula=this.model.formula?this.model.formula+t:t;break;case"v":case"t":this.model.value&&this.model.value.richText?this.model.value.richText.text=this.model.value.richText.text?this.model.value.richText.text+t:t:this.model.value=this.model.value?this.model.value+t:t}}parseClose(t){switch(t){case"c":{const{model:t}=this;if(t.formula||t.shareType)t.type=o.ValueType.Formula,t.value&&("str"===this.t?t.result=n.xmlDecode(t.value):"b"===this.t?t.result=0!==parseInt(t.value,10):"e"===this.t?t.result={error:t.value}:t.result=parseFloat(t.value),t.value=void 0);else if(void 0!==t.value)switch(this.t){case"s":t.type=o.ValueType.String,t.value=parseInt(t.value,10);break;case"str":t.type=o.ValueType.String,t.value=n.xmlDecode(t.value);break;case"inlineStr":t.type=o.ValueType.String;break;case"b":t.type=o.ValueType.Boolean,t.value=0!==parseInt(t.value,10);break;case"e":t.type=o.ValueType.Error,t.value={error:t.value};break;default:t.type=o.ValueType.Number,t.value=parseFloat(t.value)}else t.styleId?t.type=o.ValueType.Null:t.type=o.ValueType.Merge;return!1}case"f":case"v":case"is":return this.currentNode=void 0,!0;case"t":return this.parser?(this.parser.parseClose(t),!0):(this.currentNode=void 0,!0);case"r":return this.model.value=this.model.value||{},this.model.value.richText=this.model.value.richText||[],this.model.value.richText.push(this.parser.model),this.parser=void 0,this.currentNode=void 0,!0;default:return!!this.parser&&(this.parser.parseClose(t),!0)}}reconcile(t,e){const i=t.styleId&&e.styles&&e.styles.getStyleModel(t.styleId);switch(i&&(t.style=i),void 0!==t.styleId&&(t.styleId=void 0),t.type){case o.ValueType.String:"number"==typeof t.value&&e.sharedStrings&&(t.value=e.sharedStrings.getString(t.value)),t.value.richText&&(t.type=o.ValueType.RichText);break;case o.ValueType.Number:i&&n.isDateFmt(i.numFmt)&&(t.type=o.ValueType.Date,t.value=n.excelToDate(t.value,e.date1904));break;case o.ValueType.Formula:void 0!==t.result&&i&&n.isDateFmt(i.numFmt)&&(t.result=n.excelToDate(t.result,e.date1904)),"shared"===t.shareType&&(t.ref?e.formulae[t.si]=t.address:(t.sharedFormula=e.formulae[t.si],delete t.shareType),delete t.si)}const s=e.hyperlinkMap[t.address];s&&(t.type===o.ValueType.Formula?(t.text=t.result,t.result=void 0):(t.text=t.value,t.value=void 0),t.type=o.ValueType.Hyperlink,t.hyperlink=s);const r=e.commentsMap&&e.commentsMap[t.address];r&&(t.comment=r)}}},{"../../../doc/enums":7,"../../../doc/range":10,"../../../utils/utils":27,"../base-xform":32,"../strings/rich-text-xform":122}],74:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{get tag(){return"x14:cfIcon"}render(t,e){t.leafNode(this.tag,{iconSet:e.iconSet,iconId:e.iconId})}parseOpen(t){let{attributes:e}=t;this.model={iconSet:e.iconSet,iconId:n.toIntValue(e.iconId)}}parseClose(t){return t!==this.tag}}},{"../../base-xform":32}],75:[function(t,e,i){const{v4:n}=t("uuid"),s=t("../../base-xform"),r=t("../../composite-xform"),o=t("./databar-ext-xform"),a=t("./icon-set-ext-xform"),h={"3Triangles":!0,"3Stars":!0,"5Boxes":!0};class c extends r{constructor(){super(),this.map={"x14:dataBar":this.databarXform=new o,"x14:iconSet":this.iconSetXform=new a}}get tag(){return"x14:cfRule"}static isExt(t){return"dataBar"===t.type?o.isExt(t):!("iconSet"!==t.type||!t.custom&&!h[t.iconSet])}prepare(t){c.isExt(t)&&(t.x14Id=`{${n()}}`.toUpperCase())}render(t,e){if(c.isExt(e))switch(e.type){case"dataBar":this.renderDataBar(t,e);break;case"iconSet":this.renderIconSet(t,e)}}renderDataBar(t,e){t.openNode(this.tag,{type:"dataBar",id:e.x14Id}),this.databarXform.render(t,e),t.closeNode()}renderIconSet(t,e){t.openNode(this.tag,{type:"iconSet",priority:e.priority,id:e.x14Id||`{${n()}}`}),this.iconSetXform.render(t,e),t.closeNode()}createNewModel(t){let{attributes:e}=t;return{type:e.type,x14Id:e.id,priority:s.toIntValue(e.priority)}}onParserClose(t,e){Object.assign(this.model,e.model)}}e.exports=c},{"../../base-xform":32,"../../composite-xform":48,"./databar-ext-xform":79,"./icon-set-ext-xform":81,uuid:528}],76:[function(t,e,i){const n=t("../../composite-xform"),s=t("./f-ext-xform");e.exports=class extends n{constructor(){super(),this.map={"xm:f":this.fExtXform=new s}}get tag(){return"x14:cfvo"}render(t,e){t.openNode(this.tag,{type:e.type}),void 0!==e.value&&this.fExtXform.render(t,e.value),t.closeNode()}createNewModel(t){return{type:t.attributes.type}}onParserClose(t,e){switch(t){case"xm:f":this.model.value=e.model?parseFloat(e.model):0}}}},{"../../composite-xform":48,"./f-ext-xform":80}],77:[function(t,e,i){const n=t("../../composite-xform"),s=t("./sqref-ext-xform"),r=t("./cf-rule-ext-xform");e.exports=class extends n{constructor(){super(),this.map={"xm:sqref":this.sqRef=new s,"x14:cfRule":this.cfRule=new r}}get tag(){return"x14:conditionalFormatting"}prepare(t,e){t.rules.forEach((t=>{this.cfRule.prepare(t,e)}))}render(t,e){e.rules.some(r.isExt)&&(t.openNode(this.tag,{"xmlns:xm":"http://schemas.microsoft.com/office/excel/2006/main"}),e.rules.filter(r.isExt).forEach((e=>this.cfRule.render(t,e))),this.sqRef.render(t,e.ref),t.closeNode())}createNewModel(){return{rules:[]}}onParserClose(t,e){switch(t){case"xm:sqref":this.model.ref=e.model;break;case"x14:cfRule":this.model.rules.push(e.model)}}}},{"../../composite-xform":48,"./cf-rule-ext-xform":75,"./sqref-ext-xform":82}],78:[function(t,e,i){const n=t("../../composite-xform"),s=t("./cf-rule-ext-xform"),r=t("./conditional-formatting-ext-xform");e.exports=class extends n{constructor(){super(),this.map={"x14:conditionalFormatting":this.cfXform=new r}}get tag(){return"x14:conditionalFormattings"}hasContent(t){return void 0===t.hasExtContent&&(t.hasExtContent=t.some((t=>t.rules.some(s.isExt)))),t.hasExtContent}prepare(t,e){t.forEach((t=>{this.cfXform.prepare(t,e)}))}render(t,e){this.hasContent(e)&&(t.openNode(this.tag),e.forEach((e=>this.cfXform.render(t,e))),t.closeNode())}createNewModel(){return[]}onParserClose(t,e){this.model.push(e.model)}}},{"../../composite-xform":48,"./cf-rule-ext-xform":75,"./conditional-formatting-ext-xform":77}],79:[function(t,e,i){const n=t("../../base-xform"),s=t("../../composite-xform"),r=t("../../style/color-xform"),o=t("./cfvo-ext-xform");e.exports=class extends s{constructor(){super(),this.map={"x14:cfvo":this.cfvoXform=new o,"x14:borderColor":this.borderColorXform=new r("x14:borderColor"),"x14:negativeBorderColor":this.negativeBorderColorXform=new r("x14:negativeBorderColor"),"x14:negativeFillColor":this.negativeFillColorXform=new r("x14:negativeFillColor"),"x14:axisColor":this.axisColorXform=new r("x14:axisColor")}}static isExt(t){return!t.gradient}get tag(){return"x14:dataBar"}render(t,e){t.openNode(this.tag,{minLength:n.toIntAttribute(e.minLength,0,!0),maxLength:n.toIntAttribute(e.maxLength,100,!0),border:n.toBoolAttribute(e.border,!1),gradient:n.toBoolAttribute(e.gradient,!0),negativeBarColorSameAsPositive:n.toBoolAttribute(e.negativeBarColorSameAsPositive,!0),negativeBarBorderColorSameAsPositive:n.toBoolAttribute(e.negativeBarBorderColorSameAsPositive,!0),axisPosition:n.toAttribute(e.axisPosition,"auto"),direction:n.toAttribute(e.direction,"leftToRight")}),e.cfvo.forEach((e=>{this.cfvoXform.render(t,e)})),this.borderColorXform.render(t,e.borderColor),this.negativeBorderColorXform.render(t,e.negativeBorderColor),this.negativeFillColorXform.render(t,e.negativeFillColor),this.axisColorXform.render(t,e.axisColor),t.closeNode()}createNewModel(t){let{attributes:e}=t;return{cfvo:[],minLength:n.toIntValue(e.minLength,0),maxLength:n.toIntValue(e.maxLength,100),border:n.toBoolValue(e.border,!1),gradient:n.toBoolValue(e.gradient,!0),negativeBarColorSameAsPositive:n.toBoolValue(e.negativeBarColorSameAsPositive,!0),negativeBarBorderColorSameAsPositive:n.toBoolValue(e.negativeBarBorderColorSameAsPositive,!0),axisPosition:n.toStringValue(e.axisPosition,"auto"),direction:n.toStringValue(e.direction,"leftToRight")}}onParserClose(t,e){const[,i]=t.split(":");switch(i){case"cfvo":this.model.cfvo.push(e.model);break;default:this.model[i]=e.model}}}},{"../../base-xform":32,"../../composite-xform":48,"../../style/color-xform":128,"./cfvo-ext-xform":76}],80:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{get tag(){return"xm:f"}render(t,e){t.leafNode(this.tag,null,e)}parseOpen(){this.model=""}parseText(t){this.model+=t}parseClose(t){return t!==this.tag}}},{"../../base-xform":32}],81:[function(t,e,i){const n=t("../../base-xform"),s=t("../../composite-xform"),r=t("./cfvo-ext-xform"),o=t("./cf-icon-ext-xform");e.exports=class extends s{constructor(){super(),this.map={"x14:cfvo":this.cfvoXform=new r,"x14:cfIcon":this.cfIconXform=new o}}get tag(){return"x14:iconSet"}render(t,e){t.openNode(this.tag,{iconSet:n.toStringAttribute(e.iconSet),reverse:n.toBoolAttribute(e.reverse,!1),showValue:n.toBoolAttribute(e.showValue,!0),custom:n.toBoolAttribute(e.icons,!1)}),e.cfvo.forEach((e=>{this.cfvoXform.render(t,e)})),e.icons&&e.icons.forEach(((e,i)=>{e.iconId=i,this.cfIconXform.render(t,e)})),t.closeNode()}createNewModel(t){let{attributes:e}=t;return{cfvo:[],iconSet:n.toStringValue(e.iconSet,"3TrafficLights"),reverse:n.toBoolValue(e.reverse,!1),showValue:n.toBoolValue(e.showValue,!0)}}onParserClose(t,e){const[,i]=t.split(":");switch(i){case"cfvo":this.model.cfvo.push(e.model);break;case"cfIcon":this.model.icons||(this.model.icons=[]),this.model.icons.push(e.model);break;default:this.model[i]=e.model}}}},{"../../base-xform":32,"../../composite-xform":48,"./cf-icon-ext-xform":74,"./cfvo-ext-xform":76}],82:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{get tag(){return"xm:sqref"}render(t,e){t.leafNode(this.tag,null,e)}parseOpen(){this.model=""}parseText(t){this.model+=t}parseClose(t){return t!==this.tag}}},{"../../base-xform":32}],83:[function(t,e,i){const n=t("../../base-xform"),s=t("../../composite-xform"),r=t("../../../../doc/range"),o=t("./databar-xform"),a=t("./ext-lst-ref-xform"),h=t("./formula-xform"),c=t("./color-scale-xform"),u=t("./icon-set-xform"),l={"3Triangles":!0,"3Stars":!0,"5Boxes":!0},f=t=>{const{type:e,operator:i}=t;switch(e){case"containsText":case"containsBlanks":case"notContainsBlanks":case"containsErrors":case"notContainsErrors":return{type:"containsText",operator:e};default:return{type:e,operator:i}}};class d extends s{constructor(){super(),this.map={dataBar:this.databarXform=new o,extLst:this.extLstRefXform=new a,formula:this.formulaXform=new h,colorScale:this.colorScaleXform=new c,iconSet:this.iconSetXform=new u}}get tag(){return"cfRule"}static isPrimitive(t){return"iconSet"!==t.type||!t.custom&&!l[t.iconSet]}render(t,e){switch(e.type){case"expression":this.renderExpression(t,e);break;case"cellIs":this.renderCellIs(t,e);break;case"top10":this.renderTop10(t,e);break;case"aboveAverage":this.renderAboveAverage(t,e);break;case"dataBar":this.renderDataBar(t,e);break;case"colorScale":this.renderColorScale(t,e);break;case"iconSet":this.renderIconSet(t,e);break;case"containsText":this.renderText(t,e);break;case"timePeriod":this.renderTimePeriod(t,e)}}renderExpression(t,e){t.openNode(this.tag,{type:"expression",dxfId:e.dxfId,priority:e.priority}),this.formulaXform.render(t,e.formulae[0]),t.closeNode()}renderCellIs(t,e){t.openNode(this.tag,{type:"cellIs",dxfId:e.dxfId,priority:e.priority,operator:e.operator}),e.formulae.forEach((e=>{this.formulaXform.render(t,e)})),t.closeNode()}renderTop10(t,e){t.leafNode(this.tag,{type:"top10",dxfId:e.dxfId,priority:e.priority,percent:n.toBoolAttribute(e.percent,!1),bottom:n.toBoolAttribute(e.bottom,!1),rank:n.toIntValue(e.rank,10,!0)})}renderAboveAverage(t,e){t.leafNode(this.tag,{type:"aboveAverage",dxfId:e.dxfId,priority:e.priority,aboveAverage:n.toBoolAttribute(e.aboveAverage,!0)})}renderDataBar(t,e){t.openNode(this.tag,{type:"dataBar",priority:e.priority}),this.databarXform.render(t,e),this.extLstRefXform.render(t,e),t.closeNode()}renderColorScale(t,e){t.openNode(this.tag,{type:"colorScale",priority:e.priority}),this.colorScaleXform.render(t,e),t.closeNode()}renderIconSet(t,e){d.isPrimitive(e)&&(t.openNode(this.tag,{type:"iconSet",priority:e.priority}),this.iconSetXform.render(t,e),t.closeNode())}renderText(t,e){t.openNode(this.tag,{type:e.operator,dxfId:e.dxfId,priority:e.priority,operator:n.toStringAttribute(e.operator,"containsText")});const i=(t=>{if(t.formulae&&t.formulae[0])return t.formulae[0];const e=new r(t.ref),{tl:i}=e;switch(t.operator){case"containsText":return`NOT(ISERROR(SEARCH("${t.text}",${i})))`;case"containsBlanks":return`LEN(TRIM(${i}))=0`;case"notContainsBlanks":return`LEN(TRIM(${i}))>0`;case"containsErrors":return`ISERROR(${i})`;case"notContainsErrors":return`NOT(ISERROR(${i}))`;default:return}})(e);i&&this.formulaXform.render(t,i),t.closeNode()}renderTimePeriod(t,e){t.openNode(this.tag,{type:"timePeriod",dxfId:e.dxfId,priority:e.priority,timePeriod:e.timePeriod});const i=(t=>{if(t.formulae&&t.formulae[0])return t.formulae[0];const e=new r(t.ref),{tl:i}=e;switch(t.timePeriod){case"thisWeek":return`AND(TODAY()-ROUNDDOWN(${i},0)<=WEEKDAY(TODAY())-1,ROUNDDOWN(${i},0)-TODAY()<=7-WEEKDAY(TODAY()))`;case"lastWeek":return`AND(TODAY()-ROUNDDOWN(${i},0)>=(WEEKDAY(TODAY())),TODAY()-ROUNDDOWN(${i},0)<(WEEKDAY(TODAY())+7))`;case"nextWeek":return`AND(ROUNDDOWN(${i},0)-TODAY()>(7-WEEKDAY(TODAY())),ROUNDDOWN(${i},0)-TODAY()<(15-WEEKDAY(TODAY())))`;case"yesterday":return`FLOOR(${i},1)=TODAY()-1`;case"today":return`FLOOR(${i},1)=TODAY()`;case"tomorrow":return`FLOOR(${i},1)=TODAY()+1`;case"last7Days":return`AND(TODAY()-FLOOR(${i},1)<=6,FLOOR(${i},1)<=TODAY())`;case"lastMonth":return`AND(MONTH(${i})=MONTH(EDATE(TODAY(),0-1)),YEAR(${i})=YEAR(EDATE(TODAY(),0-1)))`;case"thisMonth":return`AND(MONTH(${i})=MONTH(TODAY()),YEAR(${i})=YEAR(TODAY()))`;case"nextMonth":return`AND(MONTH(${i})=MONTH(EDATE(TODAY(),0+1)),YEAR(${i})=YEAR(EDATE(TODAY(),0+1)))`;default:return}})(e);i&&this.formulaXform.render(t,i),t.closeNode()}createNewModel(t){let{attributes:e}=t;return{...f(e),dxfId:n.toIntValue(e.dxfId),priority:n.toIntValue(e.priority),timePeriod:e.timePeriod,percent:n.toBoolValue(e.percent),bottom:n.toBoolValue(e.bottom),rank:n.toIntValue(e.rank),aboveAverage:n.toBoolValue(e.aboveAverage)}}onParserClose(t,e){switch(t){case"dataBar":case"extLst":case"colorScale":case"iconSet":Object.assign(this.model,e.model);break;case"formula":this.model.formulae=this.model.formulae||[],this.model.formulae.push(e.model)}}}e.exports=d},{"../../../../doc/range":10,"../../base-xform":32,"../../composite-xform":48,"./color-scale-xform":85,"./databar-xform":88,"./ext-lst-ref-xform":89,"./formula-xform":90,"./icon-set-xform":91}],84:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{get tag(){return"cfvo"}render(t,e){t.leafNode(this.tag,{type:e.type,val:e.value})}parseOpen(t){this.model={type:t.attributes.type,value:n.toFloatValue(t.attributes.val)}}parseClose(t){return t!==this.tag}}},{"../../base-xform":32}],85:[function(t,e,i){const n=t("../../composite-xform"),s=t("../../style/color-xform"),r=t("./cfvo-xform");e.exports=class extends n{constructor(){super(),this.map={cfvo:this.cfvoXform=new r,color:this.colorXform=new s}}get tag(){return"colorScale"}render(t,e){t.openNode(this.tag),e.cfvo.forEach((e=>{this.cfvoXform.render(t,e)})),e.color.forEach((e=>{this.colorXform.render(t,e)})),t.closeNode()}createNewModel(t){return{cfvo:[],color:[]}}onParserClose(t,e){this.model[t].push(e.model)}}},{"../../composite-xform":48,"../../style/color-xform":128,"./cfvo-xform":84}],86:[function(t,e,i){const n=t("../../composite-xform"),s=t("./cf-rule-xform");e.exports=class extends n{constructor(){super(),this.map={cfRule:new s}}get tag(){return"conditionalFormatting"}render(t,e){e.rules.some(s.isPrimitive)&&(t.openNode(this.tag,{sqref:e.ref}),e.rules.forEach((i=>{s.isPrimitive(i)&&(i.ref=e.ref,this.map.cfRule.render(t,i))})),t.closeNode())}createNewModel(t){let{attributes:e}=t;return{ref:e.sqref,rules:[]}}onParserClose(t,e){this.model.rules.push(e.model)}}},{"../../composite-xform":48,"./cf-rule-xform":83}],87:[function(t,e,i){const n=t("../../base-xform"),s=t("./conditional-formatting-xform");e.exports=class extends n{constructor(){super(),this.cfXform=new s}get tag(){return"conditionalFormatting"}reset(){this.model=[]}prepare(t,e){let i=t.reduce(((t,e)=>Math.max(t,...e.rules.map((t=>t.priority||0)))),1);t.forEach((t=>{t.rules.forEach((t=>{t.priority||(t.priority=i++),t.style&&(t.dxfId=e.styles.addDxfStyle(t.style))}))}))}render(t,e){e.forEach((e=>{this.cfXform.render(t,e)}))}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"conditionalFormatting":return this.parser=this.cfXform,this.parser.parseOpen(t),!0;default:return!1}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return!!this.parser&&(!!this.parser.parseClose(t)||(this.model.push(this.parser.model),this.parser=void 0,!1))}reconcile(t,e){t.forEach((t=>{t.rules.forEach((t=>{void 0!==t.dxfId&&(t.style=e.styles.getDxfStyle(t.dxfId),delete t.dxfId)}))}))}}},{"../../base-xform":32,"./conditional-formatting-xform":86}],88:[function(t,e,i){const n=t("../../composite-xform"),s=t("../../style/color-xform"),r=t("./cfvo-xform");e.exports=class extends n{constructor(){super(),this.map={cfvo:this.cfvoXform=new r,color:this.colorXform=new s}}get tag(){return"dataBar"}render(t,e){t.openNode(this.tag),e.cfvo.forEach((e=>{this.cfvoXform.render(t,e)})),this.colorXform.render(t,e.color),t.closeNode()}createNewModel(){return{cfvo:[]}}onParserClose(t,e){switch(t){case"cfvo":this.model.cfvo.push(e.model);break;case"color":this.model.color=e.model}}}},{"../../composite-xform":48,"../../style/color-xform":128,"./cfvo-xform":84}],89:[function(t,e,i){const n=t("../../base-xform"),s=t("../../composite-xform");class r extends n{get tag(){return"x14:id"}render(t,e){t.leafNode(this.tag,null,e)}parseOpen(){this.model=""}parseText(t){this.model+=t}parseClose(t){return t!==this.tag}}class o extends s{constructor(){super(),this.map={"x14:id":this.idXform=new r}}get tag(){return"ext"}render(t,e){t.openNode(this.tag,{uri:"{B025F937-C7B1-47D3-B67F-A62EFF666E3E}","xmlns:x14":"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main"}),this.idXform.render(t,e.x14Id),t.closeNode()}createNewModel(){return{}}onParserClose(t,e){this.model.x14Id=e.model}}e.exports=class extends s{constructor(){super(),this.map={ext:new o}}get tag(){return"extLst"}render(t,e){t.openNode(this.tag),this.map.ext.render(t,e),t.closeNode()}createNewModel(){return{}}onParserClose(t,e){Object.assign(this.model,e.model)}}},{"../../base-xform":32,"../../composite-xform":48}],90:[function(t,e,i){const n=t("../../base-xform");e.exports=class extends n{get tag(){return"formula"}render(t,e){t.leafNode(this.tag,null,e)}parseOpen(){this.model=""}parseText(t){this.model+=t}parseClose(t){return t!==this.tag}}},{"../../base-xform":32}],91:[function(t,e,i){const n=t("../../base-xform"),s=t("../../composite-xform"),r=t("./cfvo-xform");e.exports=class extends s{constructor(){super(),this.map={cfvo:this.cfvoXform=new r}}get tag(){return"iconSet"}render(t,e){t.openNode(this.tag,{iconSet:n.toStringAttribute(e.iconSet,"3TrafficLights"),reverse:n.toBoolAttribute(e.reverse,!1),showValue:n.toBoolAttribute(e.showValue,!0)}),e.cfvo.forEach((e=>{this.cfvoXform.render(t,e)})),t.closeNode()}createNewModel(t){let{attributes:e}=t;return{iconSet:n.toStringValue(e.iconSet,"3TrafficLights"),reverse:n.toBoolValue(e.reverse),showValue:n.toBoolValue(e.showValue),cfvo:[]}}onParserClose(t,e){this.model[t].push(e.model)}}},{"../../base-xform":32,"../../composite-xform":48,"./cfvo-xform":84}],92:[function(t,e,i){const n=t("../../../utils/utils"),s=t("../base-xform");e.exports=class extends s{get tag(){return"col"}prepare(t,e){const i=e.styles.addStyleModel(t.style||{});i&&(t.styleId=i)}render(t,e){t.openNode("col"),t.addAttribute("min",e.min),t.addAttribute("max",e.max),e.width&&t.addAttribute("width",e.width),e.styleId&&t.addAttribute("style",e.styleId),e.hidden&&t.addAttribute("hidden","1"),e.bestFit&&t.addAttribute("bestFit","1"),e.outlineLevel&&t.addAttribute("outlineLevel",e.outlineLevel),e.collapsed&&t.addAttribute("collapsed","1"),t.addAttribute("customWidth","1"),t.closeNode()}parseOpen(t){if("col"===t.name){const e=this.model={min:parseInt(t.attributes.min||"0",10),max:parseInt(t.attributes.max||"0",10),width:void 0===t.attributes.width?void 0:parseFloat(t.attributes.width||"0")};return t.attributes.style&&(e.styleId=parseInt(t.attributes.style,10)),n.parseBoolean(t.attributes.hidden)&&(e.hidden=!0),n.parseBoolean(t.attributes.bestFit)&&(e.bestFit=!0),t.attributes.outlineLevel&&(e.outlineLevel=parseInt(t.attributes.outlineLevel,10)),n.parseBoolean(t.attributes.collapsed)&&(e.collapsed=!0),!0}return!1}parseText(){}parseClose(){return!1}reconcile(t,e){t.styleId&&(t.style=e.styles.getStyleModel(t.styleId))}}},{"../../../utils/utils":27,"../base-xform":32}],93:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../../../utils/utils"),r=t("../../../utils/col-cache"),o=t("../base-xform"),a=t("../../../doc/range");function h(t,e,i,n){const s=e[i];void 0!==s?t[i]=s:void 0!==n&&(t[i]=n)}function c(t,e,i,n){const r=e[i];void 0!==r?t[i]=s.parseBoolean(r):void 0!==n&&(t[i]=n)}e.exports=class extends o{get tag(){return"dataValidations"}render(t,e){const i=function(t){const e=n.map(t,((t,e)=>({address:e,dataValidation:t,marked:!1}))).sort(((t,e)=>n.strcmp(t.address,e.address))),i=n.keyBy(e,"address"),s=(e,i,s)=>{for(let o=0;o<i;o++){const i=r.encodeAddress(e.row+o,s);if(!t[i]||!n.isEqual(t[e.address],t[i]))return!1}return!0};return e.map((e=>{if(!e.marked){const o=r.decodeEx(e.address);if(o.dimensions)return i[o.dimensions].marked=!0,{...e.dataValidation,sqref:e.address};let a=1,h=r.encodeAddress(o.row+a,o.col);for(;t[h]&&n.isEqual(e.dataValidation,t[h]);)a++,h=r.encodeAddress(o.row+a,o.col);let c=1;for(;s(o,a,o.col+c);)c++;for(let t=0;t<a;t++)for(let e=0;e<c;e++)h=r.encodeAddress(o.row+t,o.col+e),i[h].marked=!0;if(a>1||c>1){const t=o.row+(a-1),i=o.col+(c-1);return{...e.dataValidation,sqref:`${e.address}:${r.encodeAddress(t,i)}`}}return{...e.dataValidation,sqref:e.address}}return null})).filter(Boolean)}(e);i.length&&(t.openNode("dataValidations",{count:i.length}),i.forEach((e=>{t.openNode("dataValidation"),"any"!==e.type&&(t.addAttribute("type",e.type),e.operator&&"list"!==e.type&&"between"!==e.operator&&t.addAttribute("operator",e.operator),e.allowBlank&&t.addAttribute("allowBlank","1")),e.showInputMessage&&t.addAttribute("showInputMessage","1"),e.promptTitle&&t.addAttribute("promptTitle",e.promptTitle),e.prompt&&t.addAttribute("prompt",e.prompt),e.showErrorMessage&&t.addAttribute("showErrorMessage","1"),e.errorStyle&&t.addAttribute("errorStyle",e.errorStyle),e.errorTitle&&t.addAttribute("errorTitle",e.errorTitle),e.error&&t.addAttribute("error",e.error),t.addAttribute("sqref",e.sqref),(e.formulae||[]).forEach(((i,n)=>{t.openNode("formula"+(n+1)),"date"===e.type?t.writeText(s.dateToExcel(new Date(i))):t.writeText(i),t.closeNode()})),t.closeNode()})),t.closeNode())}parseOpen(t){switch(t.name){case"dataValidations":return this.model={},!0;case"dataValidation":{this._address=t.attributes.sqref;const e={type:t.attributes.type||"any",formulae:[]};switch(t.attributes.type&&c(e,t.attributes,"allowBlank"),c(e,t.attributes,"showInputMessage"),c(e,t.attributes,"showErrorMessage"),e.type){case"any":case"list":case"custom":break;default:h(e,t.attributes,"operator","between")}return h(e,t.attributes,"promptTitle"),h(e,t.attributes,"prompt"),h(e,t.attributes,"errorStyle"),h(e,t.attributes,"errorTitle"),h(e,t.attributes,"error"),this._dataValidation=e,!0}case"formula1":case"formula2":return this._formula=[],!0;default:return!1}}parseText(t){this._formula&&this._formula.push(t)}parseClose(t){switch(t){case"dataValidations":return!1;case"dataValidation":this._dataValidation.formulae&&this._dataValidation.formulae.length||(delete this._dataValidation.formulae,delete this._dataValidation.operator);return(this._address.split(/\s+/g)||[]).forEach((t=>{if(t.includes(":")){new a(t).forEachAddress((t=>{this.model[t]=this._dataValidation}))}else this.model[t]=this._dataValidation})),!0;case"formula1":case"formula2":{let t=this._formula.join("");switch(this._dataValidation.type){case"whole":case"textLength":t=parseInt(t,10);break;case"decimal":t=parseFloat(t);break;case"date":t=s.excelToDate(parseFloat(t))}return this._dataValidation.formulae.push(t),this._formula=void 0,!0}default:return!0}}}},{"../../../doc/range":10,"../../../utils/col-cache":19,"../../../utils/under-dash":26,"../../../utils/utils":27,"../base-xform":32}],94:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"dimension"}render(t,e){e&&t.leafNode("dimension",{ref:e})}parseOpen(t){return"dimension"===t.name&&(this.model=t.attributes.ref,!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],95:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"drawing"}render(t,e){e&&t.leafNode(this.tag,{"r:id":e.rId})}parseOpen(t){switch(t.name){case this.tag:return this.model={rId:t.attributes["r:id"]},!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],96:[function(t,e,i){const n=t("../composite-xform"),s=t("./cf-ext/conditional-formattings-ext-xform");class r extends n{constructor(){super(),this.map={"x14:conditionalFormattings":this.conditionalFormattings=new s}}get tag(){return"ext"}hasContent(t){return this.conditionalFormattings.hasContent(t.conditionalFormattings)}prepare(t,e){this.conditionalFormattings.prepare(t.conditionalFormattings,e)}render(t,e){t.openNode("ext",{uri:"{78C0D931-6437-407d-A8EE-F0AAD7539E65}","xmlns:x14":"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main"}),this.conditionalFormattings.render(t,e.conditionalFormattings),t.closeNode()}createNewModel(){return{}}onParserClose(t,e){this.model[t]=e.model}}e.exports=class extends n{constructor(){super(),this.map={ext:this.ext=new r}}get tag(){return"extLst"}prepare(t,e){this.ext.prepare(t,e)}hasContent(t){return this.ext.hasContent(t)}render(t,e){this.hasContent(e)&&(t.openNode("extLst"),this.ext.render(t,e),t.closeNode())}createNewModel(){return{}}onParserClose(t,e){Object.assign(this.model,e.model)}}},{"../composite-xform":48,"./cf-ext/conditional-formattings-ext-xform":78}],97:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"headerFooter"}render(t,e){if(e){t.addRollback();let i=!1;t.openNode("headerFooter"),e.differentFirst&&(t.addAttribute("differentFirst","1"),i=!0),e.differentOddEven&&(t.addAttribute("differentOddEven","1"),i=!0),e.oddHeader&&"string"==typeof e.oddHeader&&(t.leafNode("oddHeader",null,e.oddHeader),i=!0),e.oddFooter&&"string"==typeof e.oddFooter&&(t.leafNode("oddFooter",null,e.oddFooter),i=!0),e.evenHeader&&"string"==typeof e.evenHeader&&(t.leafNode("evenHeader",null,e.evenHeader),i=!0),e.evenFooter&&"string"==typeof e.evenFooter&&(t.leafNode("evenFooter",null,e.evenFooter),i=!0),e.firstHeader&&"string"==typeof e.firstHeader&&(t.leafNode("firstHeader",null,e.firstHeader),i=!0),e.firstFooter&&"string"==typeof e.firstFooter&&(t.leafNode("firstFooter",null,e.firstFooter),i=!0),i?(t.closeNode(),t.commit()):t.rollback()}}parseOpen(t){switch(t.name){case"headerFooter":return this.model={},t.attributes.differentFirst&&(this.model.differentFirst=1===parseInt(t.attributes.differentFirst,0)),t.attributes.differentOddEven&&(this.model.differentOddEven=1===parseInt(t.attributes.differentOddEven,0)),!0;case"oddHeader":return this.currentNode="oddHeader",!0;case"oddFooter":return this.currentNode="oddFooter",!0;case"evenHeader":return this.currentNode="evenHeader",!0;case"evenFooter":return this.currentNode="evenFooter",!0;case"firstHeader":return this.currentNode="firstHeader",!0;case"firstFooter":return this.currentNode="firstFooter",!0;default:return!1}}parseText(t){switch(this.currentNode){case"oddHeader":this.model.oddHeader=t;break;case"oddFooter":this.model.oddFooter=t;break;case"evenHeader":this.model.evenHeader=t;break;case"evenFooter":this.model.evenFooter=t;break;case"firstHeader":this.model.firstHeader=t;break;case"firstFooter":this.model.firstFooter=t}}parseClose(){switch(this.currentNode){case"oddHeader":case"oddFooter":case"evenHeader":case"evenFooter":case"firstHeader":case"firstFooter":return this.currentNode=void 0,!0;default:return!1}}}},{"../base-xform":32}],98:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"hyperlink"}render(t,e){this.isInternalLink(e)?t.leafNode("hyperlink",{ref:e.address,"r:id":e.rId,tooltip:e.tooltip,location:e.target}):t.leafNode("hyperlink",{ref:e.address,"r:id":e.rId,tooltip:e.tooltip})}parseOpen(t){return"hyperlink"===t.name&&(this.model={address:t.attributes.ref,rId:t.attributes["r:id"],tooltip:t.attributes.tooltip},t.attributes.location&&(this.model.target=t.attributes.location),!0)}parseText(){}parseClose(){return!1}isInternalLink(t){return t.target&&/^[^!]+![a-zA-Z]+[\d]+$/.test(t.target)}}},{"../base-xform":32}],99:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"mergeCell"}render(t,e){t.leafNode("mergeCell",{ref:e})}parseOpen(t){return"mergeCell"===t.name&&(this.model=t.attributes.ref,!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],100:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../../../doc/range"),r=t("../../../utils/col-cache"),o=t("../../../doc/enums");e.exports=class{constructor(){this.merges={}}add(t){if(this.merges[t.master])this.merges[t.master].expandToAddress(t.address);else{const e=`${t.master}:${t.address}`;this.merges[t.master]=new s(e)}}get mergeCells(){return n.map(this.merges,(t=>t.range))}reconcile(t,e){n.each(t,(t=>{const i=r.decode(t);for(let t=i.top;t<=i.bottom;t++){const n=e[t-1];for(let e=i.left;e<=i.right;e++){const s=n.cells[e-1];s?s.type===o.ValueType.Merge&&(s.master=i.tl):n.cells[e]={type:o.ValueType.Null,address:r.encodeAddress(t,e)}}}}))}getMasterAddress(t){const e=this.hash[t];return e&&e.tl}}},{"../../../doc/enums":7,"../../../doc/range":10,"../../../utils/col-cache":19,"../../../utils/under-dash":26}],101:[function(t,e,i){const n=t("../base-xform"),s=t=>void 0!==t;e.exports=class extends n{get tag(){return"outlinePr"}render(t,e){return!(!e||!s(e.summaryBelow)&&!s(e.summaryRight))&&(t.leafNode(this.tag,{summaryBelow:s(e.summaryBelow)?Number(e.summaryBelow):void 0,summaryRight:s(e.summaryRight)?Number(e.summaryRight):void 0}),!0)}parseOpen(t){return t.name===this.tag&&(this.model={summaryBelow:s(t.attributes.summaryBelow)?Boolean(Number(t.attributes.summaryBelow)):void 0,summaryRight:s(t.attributes.summaryRight)?Boolean(Number(t.attributes.summaryRight)):void 0},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],102:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"brk"}render(t,e){t.leafNode("brk",e)}parseOpen(t){return"brk"===t.name&&(this.model=t.attributes.ref,!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],103:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../base-xform");e.exports=class extends s{get tag(){return"pageMargins"}render(t,e){if(e){const i={left:e.left,right:e.right,top:e.top,bottom:e.bottom,header:e.header,footer:e.footer};n.some(i,(t=>void 0!==t))&&t.leafNode(this.tag,i)}}parseOpen(t){switch(t.name){case this.tag:return this.model={left:parseFloat(t.attributes.left||.7),right:parseFloat(t.attributes.right||.7),top:parseFloat(t.attributes.top||.75),bottom:parseFloat(t.attributes.bottom||.75),header:parseFloat(t.attributes.header||.3),footer:parseFloat(t.attributes.footer||.3)},!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../../../utils/under-dash":26,"../base-xform":32}],104:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"pageSetUpPr"}render(t,e){return!(!e||!e.fitToPage)&&(t.leafNode(this.tag,{fitToPage:e.fitToPage?"1":void 0}),!0)}parseOpen(t){return t.name===this.tag&&(this.model={fitToPage:"1"===t.attributes.fitToPage},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],105:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../base-xform");function r(t){return t?"1":void 0}function o(t){switch(t){case"overThenDown":return t;default:return}}function a(t){switch(t){case"atEnd":case"asDisplyed":return t;default:return}}function h(t){switch(t){case"dash":case"blank":case"NA":return t;default:return}}e.exports=class extends s{get tag(){return"pageSetup"}render(t,e){if(e){const i={paperSize:e.paperSize,orientation:e.orientation,horizontalDpi:e.horizontalDpi,verticalDpi:e.verticalDpi,pageOrder:o(e.pageOrder),blackAndWhite:r(e.blackAndWhite),draft:r(e.draft),cellComments:a(e.cellComments),errors:h(e.errors),scale:e.scale,fitToWidth:e.fitToWidth,fitToHeight:e.fitToHeight,firstPageNumber:e.firstPageNumber,useFirstPageNumber:r(e.firstPageNumber),usePrinterDefaults:r(e.usePrinterDefaults),copies:e.copies};n.some(i,(t=>void 0!==t))&&t.leafNode(this.tag,i)}}parseOpen(t){switch(t.name){case this.tag:return this.model={paperSize:(e=t.attributes.paperSize,void 0!==e?parseInt(e,10):void 0),orientation:t.attributes.orientation||"portrait",horizontalDpi:parseInt(t.attributes.horizontalDpi||"4294967295",10),verticalDpi:parseInt(t.attributes.verticalDpi||"4294967295",10),pageOrder:t.attributes.pageOrder||"downThenOver",blackAndWhite:"1"===t.attributes.blackAndWhite,draft:"1"===t.attributes.draft,cellComments:t.attributes.cellComments||"None",errors:t.attributes.errors||"displayed",scale:parseInt(t.attributes.scale||"100",10),fitToWidth:parseInt(t.attributes.fitToWidth||"1",10),fitToHeight:parseInt(t.attributes.fitToHeight||"1",10),firstPageNumber:parseInt(t.attributes.firstPageNumber||"1",10),useFirstPageNumber:"1"===t.attributes.useFirstPageNumber,usePrinterDefaults:"1"===t.attributes.usePrinterDefaults,copies:parseInt(t.attributes.copies||"1",10)},!0;default:return!1}var e}parseText(){}parseClose(){return!1}}},{"../../../utils/under-dash":26,"../base-xform":32}],106:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"picture"}render(t,e){e&&t.leafNode(this.tag,{"r:id":e.rId})}parseOpen(t){switch(t.name){case this.tag:return this.model={rId:t.attributes["r:id"]},!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],107:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../base-xform");function r(t){return t?"1":void 0}e.exports=class extends s{get tag(){return"printOptions"}render(t,e){if(e){const i={headings:r(e.showRowColHeaders),gridLines:r(e.showGridLines),horizontalCentered:r(e.horizontalCentered),verticalCentered:r(e.verticalCentered)};n.some(i,(t=>void 0!==t))&&t.leafNode(this.tag,i)}}parseOpen(t){switch(t.name){case this.tag:return this.model={showRowColHeaders:"1"===t.attributes.headings,showGridLines:"1"===t.attributes.gridLines,horizontalCentered:"1"===t.attributes.horizontalCentered,verticalCentered:"1"===t.attributes.verticalCentered},!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../../../utils/under-dash":26,"../base-xform":32}],108:[function(t,e,i){const n=t("./page-breaks-xform"),s=t("../list-xform");e.exports=class extends s{constructor(){super({tag:"rowBreaks",count:!0,childXform:new n})}render(t,e){if(e&&e.length){t.openNode(this.tag,this.$),this.count&&(t.addAttribute(this.$count,e.length),t.addAttribute("manualBreakCount",e.length));const{childXform:i}=this;e.forEach((e=>{i.render(t,e)})),t.closeNode()}else this.empty&&t.leafNode(this.tag)}}},{"../list-xform":71,"./page-breaks-xform":102}],109:[function(t,e,i){const n=t("../base-xform"),s=t("../../../utils/utils"),r=t("./cell-xform");e.exports=class extends n{constructor(t){super(),this.maxItems=t&&t.maxItems,this.map={c:new r}}get tag(){return"row"}prepare(t,e){const i=e.styles.addStyleModel(t.style);i&&(t.styleId=i);const n=this.map.c;t.cells.forEach((t=>{n.prepare(t,e)}))}render(t,e,i){t.openNode("row"),t.addAttribute("r",e.number),e.height&&(t.addAttribute("ht",e.height),t.addAttribute("customHeight","1")),e.hidden&&t.addAttribute("hidden","1"),e.min>0&&e.max>0&&e.min<=e.max&&t.addAttribute("spans",`${e.min}:${e.max}`),e.styleId&&(t.addAttribute("s",e.styleId),t.addAttribute("customFormat","1")),t.addAttribute("x14ac:dyDescent","0.25"),e.outlineLevel&&t.addAttribute("outlineLevel",e.outlineLevel),e.collapsed&&t.addAttribute("collapsed","1");const n=this.map.c;e.cells.forEach((e=>{n.render(t,e,i)})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;if("row"===t.name){this.numRowsSeen+=1;const e=t.attributes.spans?t.attributes.spans.split(":").map((t=>parseInt(t,10))):[void 0,void 0],i=this.model={number:parseInt(t.attributes.r,10),min:e[0],max:e[1],cells:[]};return t.attributes.s&&(i.styleId=parseInt(t.attributes.s,10)),s.parseBoolean(t.attributes.hidden)&&(i.hidden=!0),s.parseBoolean(t.attributes.bestFit)&&(i.bestFit=!0),t.attributes.ht&&(i.height=parseFloat(t.attributes.ht)),t.attributes.outlineLevel&&(i.outlineLevel=parseInt(t.attributes.outlineLevel,10)),s.parseBoolean(t.attributes.collapsed)&&(i.collapsed=!0),!0}return this.parser=this.map[t.name],!!this.parser&&(this.parser.parseOpen(t),!0)}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser){if(!this.parser.parseClose(t)){if(this.model.cells.push(this.parser.model),this.maxItems&&this.model.cells.length>this.maxItems)throw new Error(`Max column count (${this.maxItems}) exceeded`);this.parser=void 0}return!0}return!1}reconcile(t,e){t.style=t.styleId?e.styles.getStyleModel(t.styleId):{},void 0!==t.styleId&&(t.styleId=void 0);const i=this.map.c;t.cells.forEach((t=>{i.reconcile(t,e)}))}}},{"../../../utils/utils":27,"../base-xform":32,"./cell-xform":73}],110:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../base-xform");e.exports=class extends s{get tag(){return"sheetFormatPr"}render(t,e){if(e){const i={defaultRowHeight:e.defaultRowHeight,outlineLevelRow:e.outlineLevelRow,outlineLevelCol:e.outlineLevelCol,"x14ac:dyDescent":e.dyDescent};e.defaultColWidth&&(i.defaultColWidth=e.defaultColWidth),e.defaultRowHeight&&15===e.defaultRowHeight||(i.customHeight="1"),n.some(i,(t=>void 0!==t))&&t.leafNode("sheetFormatPr",i)}}parseOpen(t){return"sheetFormatPr"===t.name&&(this.model={defaultRowHeight:parseFloat(t.attributes.defaultRowHeight||"0"),dyDescent:parseFloat(t.attributes["x14ac:dyDescent"]||"0"),outlineLevelRow:parseInt(t.attributes.outlineLevelRow||"0",10),outlineLevelCol:parseInt(t.attributes.outlineLevelCol||"0",10)},t.attributes.defaultColWidth&&(this.model.defaultColWidth=parseFloat(t.attributes.defaultColWidth)),!0)}parseText(){}parseClose(){return!1}}},{"../../../utils/under-dash":26,"../base-xform":32}],111:[function(t,e,i){const n=t("../base-xform"),s=t("../style/color-xform"),r=t("./page-setup-properties-xform"),o=t("./outline-properties-xform");e.exports=class extends n{constructor(){super(),this.map={tabColor:new s("tabColor"),pageSetUpPr:new r,outlinePr:new o}}get tag(){return"sheetPr"}render(t,e){if(e){t.addRollback(),t.openNode("sheetPr");let i=!1;i=this.map.tabColor.render(t,e.tabColor)||i,i=this.map.pageSetUpPr.render(t,e.pageSetup)||i,i=this.map.outlinePr.render(t,e.outlineProperties)||i,i?(t.closeNode(),t.commit()):t.rollback()}}parseOpen(t){return this.parser?(this.parser.parseOpen(t),!0):t.name===this.tag?(this.reset(),!0):!!this.map[t.name]&&(this.parser=this.map[t.name],this.parser.parseOpen(t),!0)}parseText(t){return!!this.parser&&(this.parser.parseText(t),!0)}parseClose(t){return this.parser?(this.parser.parseClose(t)||(this.parser=void 0),!0):(this.map.tabColor.model||this.map.pageSetUpPr.model||this.map.outlinePr.model?(this.model={},this.map.tabColor.model&&(this.model.tabColor=this.map.tabColor.model),this.map.pageSetUpPr.model&&(this.model.pageSetup=this.map.pageSetUpPr.model),this.map.outlinePr.model&&(this.model.outlineProperties=this.map.outlinePr.model)):this.model=null,!1)}}},{"../base-xform":32,"../style/color-xform":128,"./outline-properties-xform":101,"./page-setup-properties-xform":104}],112:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../base-xform");function r(t,e){return t?e:void 0}function o(t,e){return t===e||void 0}e.exports=class extends s{get tag(){return"sheetProtection"}render(t,e){if(e){const i={sheet:r(e.sheet,"1"),selectLockedCells:!1===e.selectLockedCells?"1":void 0,selectUnlockedCells:!1===e.selectUnlockedCells?"1":void 0,formatCells:r(e.formatCells,"0"),formatColumns:r(e.formatColumns,"0"),formatRows:r(e.formatRows,"0"),insertColumns:r(e.insertColumns,"0"),insertRows:r(e.insertRows,"0"),insertHyperlinks:r(e.insertHyperlinks,"0"),deleteColumns:r(e.deleteColumns,"0"),deleteRows:r(e.deleteRows,"0"),sort:r(e.sort,"0"),autoFilter:r(e.autoFilter,"0"),pivotTables:r(e.pivotTables,"0")};e.sheet&&(i.algorithmName=e.algorithmName,i.hashValue=e.hashValue,i.saltValue=e.saltValue,i.spinCount=e.spinCount,i.objects=r(!1===e.objects,"1"),i.scenarios=r(!1===e.scenarios,"1")),n.some(i,(t=>void 0!==t))&&t.leafNode(this.tag,i)}}parseOpen(t){switch(t.name){case this.tag:return this.model={sheet:o(t.attributes.sheet,"1"),objects:"1"!==t.attributes.objects&&void 0,scenarios:"1"!==t.attributes.scenarios&&void 0,selectLockedCells:"1"!==t.attributes.selectLockedCells&&void 0,selectUnlockedCells:"1"!==t.attributes.selectUnlockedCells&&void 0,formatCells:o(t.attributes.formatCells,"0"),formatColumns:o(t.attributes.formatColumns,"0"),formatRows:o(t.attributes.formatRows,"0"),insertColumns:o(t.attributes.insertColumns,"0"),insertRows:o(t.attributes.insertRows,"0"),insertHyperlinks:o(t.attributes.insertHyperlinks,"0"),deleteColumns:o(t.attributes.deleteColumns,"0"),deleteRows:o(t.attributes.deleteRows,"0"),sort:o(t.attributes.sort,"0"),autoFilter:o(t.attributes.autoFilter,"0"),pivotTables:o(t.attributes.pivotTables,"0")},t.attributes.algorithmName&&(this.model.algorithmName=t.attributes.algorithmName,this.model.hashValue=t.attributes.hashValue,this.model.saltValue=t.attributes.saltValue,this.model.spinCount=parseInt(t.attributes.spinCount,10)),!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../../../utils/under-dash":26,"../base-xform":32}],113:[function(t,e,i){const n=t("../../../utils/col-cache"),s=t("../base-xform"),r={frozen:"frozen",frozenSplit:"frozen",split:"split"};e.exports=class extends s{get tag(){return"sheetView"}prepare(t){switch(t.state){case"frozen":case"split":break;default:t.state="normal"}}render(t,e){t.openNode("sheetView",{workbookViewId:e.workbookViewId||0});const i=function(e,i,n){n&&t.addAttribute(e,i)};let s,r,o,a;switch(i("rightToLeft","1",!0===e.rightToLeft),i("tabSelected","1",e.tabSelected),i("showRuler","0",!1===e.showRuler),i("showRowColHeaders","0",!1===e.showRowColHeaders),i("showGridLines","0",!1===e.showGridLines),i("zoomScale",e.zoomScale,e.zoomScale),i("zoomScaleNormal",e.zoomScaleNormal,e.zoomScaleNormal),i("view",e.style,e.style),e.state){case"frozen":r=e.xSplit||0,o=e.ySplit||0,s=e.topLeftCell||n.getAddress(o+1,r+1).address,a=(e.xSplit&&e.ySplit?"bottomRight":e.xSplit&&"topRight")||"bottomLeft",t.leafNode("pane",{xSplit:e.xSplit||void 0,ySplit:e.ySplit||void 0,topLeftCell:s,activePane:a,state:"frozen"}),t.leafNode("selection",{pane:a,activeCell:e.activeCell,sqref:e.activeCell});break;case"split":"topLeft"===e.activePane&&(e.activePane=void 0),t.leafNode("pane",{xSplit:e.xSplit||void 0,ySplit:e.ySplit||void 0,topLeftCell:e.topLeftCell,activePane:e.activePane}),t.leafNode("selection",{pane:e.activePane,activeCell:e.activeCell,sqref:e.activeCell});break;case"normal":e.activeCell&&t.leafNode("selection",{activeCell:e.activeCell,sqref:e.activeCell})}t.closeNode()}parseOpen(t){switch(t.name){case"sheetView":return this.sheetView={workbookViewId:parseInt(t.attributes.workbookViewId,10),rightToLeft:"1"===t.attributes.rightToLeft,tabSelected:"1"===t.attributes.tabSelected,showRuler:!("0"===t.attributes.showRuler),showRowColHeaders:!("0"===t.attributes.showRowColHeaders),showGridLines:!("0"===t.attributes.showGridLines),zoomScale:parseInt(t.attributes.zoomScale||"100",10),zoomScaleNormal:parseInt(t.attributes.zoomScaleNormal||"100",10),style:t.attributes.view},this.pane=void 0,this.selections={},!0;case"pane":return this.pane={xSplit:parseInt(t.attributes.xSplit||"0",10),ySplit:parseInt(t.attributes.ySplit||"0",10),topLeftCell:t.attributes.topLeftCell,activePane:t.attributes.activePane||"topLeft",state:t.attributes.state},!0;case"selection":{const e=t.attributes.pane||"topLeft";return this.selections[e]={pane:e,activeCell:t.attributes.activeCell},!0}default:return!1}}parseText(){}parseClose(t){let e,i;switch(t){case"sheetView":return this.sheetView&&this.pane?(e=this.model={workbookViewId:this.sheetView.workbookViewId,rightToLeft:this.sheetView.rightToLeft,state:r[this.pane.state]||"split",xSplit:this.pane.xSplit,ySplit:this.pane.ySplit,topLeftCell:this.pane.topLeftCell,showRuler:this.sheetView.showRuler,showRowColHeaders:this.sheetView.showRowColHeaders,showGridLines:this.sheetView.showGridLines,zoomScale:this.sheetView.zoomScale,zoomScaleNormal:this.sheetView.zoomScaleNormal},"split"===this.model.state&&(e.activePane=this.pane.activePane),i=this.selections[this.pane.activePane],i&&i.activeCell&&(e.activeCell=i.activeCell),this.sheetView.style&&(e.style=this.sheetView.style)):(e=this.model={workbookViewId:this.sheetView.workbookViewId,rightToLeft:this.sheetView.rightToLeft,state:"normal",showRuler:this.sheetView.showRuler,showRowColHeaders:this.sheetView.showRowColHeaders,showGridLines:this.sheetView.showGridLines,zoomScale:this.sheetView.zoomScale,zoomScaleNormal:this.sheetView.zoomScaleNormal},i=this.selections.topLeft,i&&i.activeCell&&(e.activeCell=i.activeCell),this.sheetView.style&&(e.style=this.sheetView.style)),!1;default:return!0}}reconcile(){}}},{"../../../utils/col-cache":19,"../base-xform":32}],114:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"tablePart"}render(t,e){e&&t.leafNode(this.tag,{"r:id":e.rId})}parseOpen(t){switch(t.name){case this.tag:return this.model={rId:t.attributes["r:id"]},!0;default:return!1}}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],115:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../../../utils/col-cache"),r=t("../../../utils/xml-stream"),o=t("../../rel-type"),a=t("./merges"),h=t("../base-xform"),c=t("../list-xform"),u=t("./row-xform"),l=t("./col-xform"),f=t("./dimension-xform"),d=t("./hyperlink-xform"),p=t("./merge-cell-xform"),m=t("./data-validations-xform"),_=t("./sheet-properties-xform"),v=t("./sheet-format-properties-xform"),g=t("./sheet-view-xform"),b=t("./sheet-protection-xform"),w=t("./page-margins-xform"),y=t("./page-setup-xform"),x=t("./print-options-xform"),M=t("./auto-filter-xform"),T=t("./picture-xform"),O=t("./drawing-xform"),E=t("./table-part-xform"),A=t("./row-breaks-xform"),S=t("./header-footer-xform"),k=t("./cf/conditional-formattings-xform"),I=t("./ext-lst-xform"),C=(t,e)=>{if(!e||!e.length)return t;if(!t||!t.length)return e;const i={},n={};return t.forEach((t=>{i[t.ref]=t,t.rules.forEach((t=>{const{x14Id:e}=t;e&&(n[e]=t)}))})),e.forEach((e=>{e.rules.forEach((s=>{const r=n[s.x14Id];r?((t,e)=>{Object.keys(e).forEach((i=>{const n=t[i],s=e[i];void 0===n&&void 0!==s&&(t[i]=s)}))})(r,s):i[e.ref]?i[e.ref].rules.push(s):t.push({ref:e.ref,rules:[s]})}))})),t};class j extends h{constructor(t){super();const{maxRows:e,maxCols:i,ignoreNodes:n}=t||{};this.ignoreNodes=n||[],this.map={sheetPr:new _,dimension:new f,sheetViews:new c({tag:"sheetViews",count:!1,childXform:new g}),sheetFormatPr:new v,cols:new c({tag:"cols",count:!1,childXform:new l}),sheetData:new c({tag:"sheetData",count:!1,empty:!0,childXform:new u({maxItems:i}),maxItems:e}),autoFilter:new M,mergeCells:new c({tag:"mergeCells",count:!0,childXform:new p}),rowBreaks:new A,hyperlinks:new c({tag:"hyperlinks",count:!1,childXform:new d}),pageMargins:new w,dataValidations:new m,pageSetup:new y,headerFooter:new S,printOptions:new x,picture:new T,drawing:new O,sheetProtection:new b,tableParts:new c({tag:"tableParts",count:!0,childXform:new E}),conditionalFormatting:new k,extLst:new I}}prepare(t,e){e.merges=new a,t.hyperlinks=e.hyperlinks=[],t.comments=e.comments=[],e.formulae={},e.siFormulae=0,this.map.cols.prepare(t.cols,e),this.map.sheetData.prepare(t.rows,e),this.map.conditionalFormatting.prepare(t.conditionalFormattings,e),t.mergeCells=e.merges.mergeCells;const i=t.rels=[];function n(t){return"rId"+(t.length+1)}if(t.hyperlinks.forEach((t=>{const e=n(i);t.rId=e,i.push({Id:e,Type:o.Hyperlink,Target:t.target,TargetMode:"External"})})),t.comments.length>0){const r={Id:n(i),Type:o.Comments,Target:`../comments${t.id}.xml`};i.push(r);const a={Id:n(i),Type:o.VmlDrawing,Target:`../drawings/vmlDrawing${t.id}.vml`};i.push(a),t.comments.forEach((t=>{t.refAddress=s.decodeAddress(t.ref)})),e.commentRefs.push({commentName:"comments"+t.id,vmlDrawing:"vmlDrawing"+t.id})}const r=[];let h;t.media.forEach((s=>{if("background"===s.type){const r=n(i);h=e.media[s.imageId],i.push({Id:r,Type:o.Image,Target:`../media/${h.name}.${h.extension}`}),t.background={rId:r},t.image=e.media[s.imageId]}else if("image"===s.type){let{drawing:a}=t;h=e.media[s.imageId],a||(a=t.drawing={rId:n(i),name:"drawing"+ ++e.drawingsCount,anchors:[],rels:[]},e.drawings.push(a),i.push({Id:a.rId,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",Target:`../drawings/${a.name}.xml`}));let c=this.preImageId===s.imageId?r[s.imageId]:r[a.rels.length];c||(c=n(a.rels),r[a.rels.length]=c,a.rels.push({Id:c,Type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",Target:`../media/${h.name}.${h.extension}`}));const u={picture:{rId:c},range:s.range};if(s.hyperlinks&&s.hyperlinks.hyperlink){const t=n(a.rels);r[a.rels.length]=t,u.picture.hyperlinks={tooltip:s.hyperlinks.tooltip,rId:t},a.rels.push({Id:t,Type:o.Hyperlink,Target:s.hyperlinks.hyperlink,TargetMode:"External"})}this.preImageId=s.imageId,a.anchors.push(u)}})),t.tables.forEach((t=>{const s=n(i);t.rId=s,i.push({Id:s,Type:o.Table,Target:"../tables/"+t.target}),t.columns.forEach((t=>{const{style:i}=t;i&&(t.dxfId=e.styles.addDxfStyle(i))}))})),this.map.extLst.prepare(t,e)}render(t,e){t.openXml(r.StdDocAttributes),t.openNode("worksheet",j.WORKSHEET_ATTRIBUTES);const i=e.properties?{defaultRowHeight:e.properties.defaultRowHeight,dyDescent:e.properties.dyDescent,outlineLevelCol:e.properties.outlineLevelCol,outlineLevelRow:e.properties.outlineLevelRow}:void 0;e.properties&&e.properties.defaultColWidth&&(i.defaultColWidth=e.properties.defaultColWidth);const n={outlineProperties:e.properties&&e.properties.outlineProperties,tabColor:e.properties&&e.properties.tabColor,pageSetup:e.pageSetup&&e.pageSetup.fitToPage?{fitToPage:e.pageSetup.fitToPage}:void 0},s=e.pageSetup&&e.pageSetup.margins,a={showRowColHeaders:e.pageSetup&&e.pageSetup.showRowColHeaders,showGridLines:e.pageSetup&&e.pageSetup.showGridLines,horizontalCentered:e.pageSetup&&e.pageSetup.horizontalCentered,verticalCentered:e.pageSetup&&e.pageSetup.verticalCentered},h=e.sheetProtection;this.map.sheetPr.render(t,n),this.map.dimension.render(t,e.dimensions),this.map.sheetViews.render(t,e.views),this.map.sheetFormatPr.render(t,i),this.map.cols.render(t,e.cols),this.map.sheetData.render(t,e.rows),this.map.sheetProtection.render(t,h),this.map.autoFilter.render(t,e.autoFilter),this.map.mergeCells.render(t,e.mergeCells),this.map.conditionalFormatting.render(t,e.conditionalFormattings),this.map.dataValidations.render(t,e.dataValidations),this.map.hyperlinks.render(t,e.hyperlinks),this.map.printOptions.render(t,a),this.map.pageMargins.render(t,s),this.map.pageSetup.render(t,e.pageSetup),this.map.headerFooter.render(t,e.headerFooter),this.map.rowBreaks.render(t,e.rowBreaks),this.map.drawing.render(t,e.drawing),this.map.picture.render(t,e.background),this.map.tableParts.render(t,e.tables),this.map.extLst.render(t,e),e.rels&&e.rels.forEach((e=>{e.Type===o.VmlDrawing&&t.leafNode("legacyDrawing",{"r:id":e.Id})})),t.closeNode()}parseOpen(t){return this.parser?(this.parser.parseOpen(t),!0):"worksheet"===t.name?(n.each(this.map,(t=>{t.reset()})),!0):(this.map[t.name]&&!this.ignoreNodes.includes(t.name)&&(this.parser=this.map[t.name],this.parser.parseOpen(t)),!0)}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case"worksheet":{const t=this.map.sheetFormatPr.model||{};this.map.sheetPr.model&&this.map.sheetPr.model.tabColor&&(t.tabColor=this.map.sheetPr.model.tabColor),this.map.sheetPr.model&&this.map.sheetPr.model.outlineProperties&&(t.outlineProperties=this.map.sheetPr.model.outlineProperties);const e={fitToPage:this.map.sheetPr.model&&this.map.sheetPr.model.pageSetup&&this.map.sheetPr.model.pageSetup.fitToPage||!1,margins:this.map.pageMargins.model},i=Object.assign(e,this.map.pageSetup.model,this.map.printOptions.model),n=C(this.map.conditionalFormatting.model,this.map.extLst.model&&this.map.extLst.model["x14:conditionalFormattings"]);return this.model={dimensions:this.map.dimension.model,cols:this.map.cols.model,rows:this.map.sheetData.model,mergeCells:this.map.mergeCells.model,hyperlinks:this.map.hyperlinks.model,dataValidations:this.map.dataValidations.model,properties:t,views:this.map.sheetViews.model,pageSetup:i,headerFooter:this.map.headerFooter.model,background:this.map.picture.model,drawing:this.map.drawing.model,tables:this.map.tableParts.model,conditionalFormattings:n},this.map.autoFilter.model&&(this.model.autoFilter=this.map.autoFilter.model),this.map.sheetProtection.model&&(this.model.sheetProtection=this.map.sheetProtection.model),!1}default:return!0}}reconcile(t,e){const i=(t.relationships||[]).reduce(((i,n)=>{if(i[n.Id]=n,n.Type===o.Comments&&(t.comments=e.comments[n.Target].comments),n.Type===o.VmlDrawing&&t.comments&&t.comments.length){const i=e.vmlDrawings[n.Target].comments;t.comments.forEach(((t,e)=>{t.note=Object.assign({},t.note,i[e])}))}return i}),{});if(e.commentsMap=(t.comments||[]).reduce(((t,e)=>(e.ref&&(t[e.ref]=e),t)),{}),e.hyperlinkMap=(t.hyperlinks||[]).reduce(((t,e)=>(e.rId&&(t[e.address]=i[e.rId].Target),t)),{}),e.formulae={},t.rows=t.rows&&t.rows.filter(Boolean)||[],t.rows.forEach((t=>{t.cells=t.cells&&t.cells.filter(Boolean)||[]})),this.map.cols.reconcile(t.cols,e),this.map.sheetData.reconcile(t.rows,e),this.map.conditionalFormatting.reconcile(t.conditionalFormattings,e),t.media=[],t.drawing){const n=i[t.drawing.rId].Target.match(/\/drawings\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);if(n){const i=n[1];e.drawings[i].anchors.forEach((e=>{if(e.medium){const i={type:"image",imageId:e.medium.index,range:e.range,hyperlinks:e.picture.hyperlinks};t.media.push(i)}}))}}const n=t.background&&i[t.background.rId];if(n){const i=n.Target.split("/media/")[1],s=e.mediaIndex&&e.mediaIndex[i];void 0!==s&&t.media.push({type:"background",imageId:s})}t.tables=(t.tables||[]).map((t=>{const n=i[t.rId];return e.tables[n.Target]})),delete t.relationships,delete t.hyperlinks,delete t.comments}}j.WORKSHEET_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main","xmlns:r":"http://schemas.openxmlformats.org/officeDocument/2006/relationships","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","mc:Ignorable":"x14ac","xmlns:x14ac":"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"},e.exports=j},{"../../../utils/col-cache":19,"../../../utils/under-dash":26,"../../../utils/xml-stream":28,"../../rel-type":31,"../base-xform":32,"../list-xform":71,"./auto-filter-xform":72,"./cf/conditional-formattings-xform":87,"./col-xform":92,"./data-validations-xform":93,"./dimension-xform":94,"./drawing-xform":95,"./ext-lst-xform":96,"./header-footer-xform":97,"./hyperlink-xform":98,"./merge-cell-xform":99,"./merges":100,"./page-margins-xform":103,"./page-setup-xform":105,"./picture-xform":106,"./print-options-xform":107,"./row-breaks-xform":108,"./row-xform":109,"./sheet-format-properties-xform":110,"./sheet-properties-xform":111,"./sheet-protection-xform":112,"./sheet-view-xform":113,"./table-part-xform":114}],116:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.attr=t.attr}render(t,e){e&&(t.openNode(this.tag),t.closeNode())}parseOpen(t){t.name===this.tag&&(this.model=!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],117:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.attr=t.attr,this.attrs=t.attrs,this._format=t.format||function(t){try{return Number.isNaN(t.getTime())?"":t.toISOString()}catch(t){return""}},this._parse=t.parse||function(t){return new Date(t)}}render(t,e){e&&(t.openNode(this.tag),this.attrs&&t.addAttributes(this.attrs),this.attr?t.addAttribute(this.attr,this._format(e)):t.writeText(this._format(e)),t.closeNode())}parseOpen(t){t.name===this.tag&&(this.attr?this.model=this._parse(t.attributes[this.attr]):this.text=[])}parseText(t){this.attr||this.text.push(t)}parseClose(){return this.attr||(this.model=this._parse(this.text.join(""))),!1}}},{"../base-xform":32}],118:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.attr=t.attr,this.attrs=t.attrs,this.zero=t.zero}render(t,e){(e||this.zero)&&(t.openNode(this.tag),this.attrs&&t.addAttributes(this.attrs),this.attr?t.addAttribute(this.attr,e):t.writeText(e),t.closeNode())}parseOpen(t){return t.name===this.tag&&(this.attr?this.model=parseInt(t.attributes[this.attr],10):this.text=[],!0)}parseText(t){this.attr||this.text.push(t)}parseClose(){return this.attr||(this.model=parseInt(this.text.join("")||0,10)),!1}}},{"../base-xform":32}],119:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{constructor(t){super(),this.tag=t.tag,this.attr=t.attr,this.attrs=t.attrs}render(t,e){void 0!==e&&(t.openNode(this.tag),this.attrs&&t.addAttributes(this.attrs),this.attr?t.addAttribute(this.attr,e):t.writeText(e),t.closeNode())}parseOpen(t){t.name===this.tag&&(this.attr?this.model=t.attributes[this.attr]:this.text=[])}parseText(t){this.attr||this.text.push(t)}parseClose(){return this.attr||(this.model=this.text.join("")),!1}}},{"../base-xform":32}],120:[function(t,e,i){const n=t("./base-xform"),s=t("../../utils/xml-stream");e.exports=class extends n{constructor(t){super(),this._model=t}render(t){if(!this._xml){const t=new s;!function t(e,i){e.openNode(i.tag,i.$),i.c&&i.c.forEach((i=>{t(e,i)})),i.t&&e.writeText(i.t),e.closeNode()}(t,this._model),this._xml=t.xml}t.writeXml(this._xml)}parseOpen(){return!0}parseText(){}parseClose(t){switch(t){case this._model.tag:return!1;default:return!0}}}},{"../../utils/xml-stream":28,"./base-xform":32}],121:[function(t,e,i){const n=t("./text-xform"),s=t("./rich-text-xform"),r=t("../base-xform");e.exports=class extends r{constructor(){super(),this.map={r:new s,t:new n}}get tag(){return"rPh"}render(t,e){if(t.openNode(this.tag,{sb:e.sb||0,eb:e.eb||0}),e&&e.hasOwnProperty("richText")&&e.richText){const{r:i}=this.map;e.richText.forEach((e=>{i.render(t,e)}))}else e&&this.map.t.render(t,e.text);t.closeNode()}parseOpen(t){const{name:e}=t;return this.parser?(this.parser.parseOpen(t),!0):e===this.tag?(this.model={sb:parseInt(t.attributes.sb,10),eb:parseInt(t.attributes.eb,10)},!0):(this.parser=this.map[e],!!this.parser&&(this.parser.parseOpen(t),!0))}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser){if(!this.parser.parseClose(t)){switch(t){case"r":{let t=this.model.richText;t||(t=this.model.richText=[]),t.push(this.parser.model);break}case"t":this.model.text=this.parser.model}this.parser=void 0}return!0}switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32,"./rich-text-xform":122,"./text-xform":125}],122:[function(t,e,i){const n=t("./text-xform"),s=t("../style/font-xform"),r=t("../base-xform");class o extends r{constructor(t){super(),this.model=t}get tag(){return"r"}get textXform(){return this._textXform||(this._textXform=new n)}get fontXform(){return this._fontXform||(this._fontXform=new s(o.FONT_OPTIONS))}render(t,e){e=e||this.model,t.openNode("r"),e.font&&this.fontXform.render(t,e.font),this.textXform.render(t,e.text),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"r":return this.model={},!0;case"t":return this.parser=this.textXform,this.parser.parseOpen(t),!0;case"rPr":return this.parser=this.fontXform,this.parser.parseOpen(t),!0;default:return!1}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){switch(t){case"r":return!1;case"t":return this.model.text=this.parser.model,this.parser=void 0,!0;case"rPr":return this.model.font=this.parser.model,this.parser=void 0,!0;default:return this.parser&&this.parser.parseClose(t),!0}}}o.FONT_OPTIONS={tagName:"rPr",fontNameTag:"rFont"},e.exports=o},{"../base-xform":32,"../style/font-xform":131,"./text-xform":125}],123:[function(t,e,i){const n=t("./text-xform"),s=t("./rich-text-xform"),r=t("./phonetic-text-xform"),o=t("../base-xform");e.exports=class extends o{constructor(t){super(),this.model=t,this.map={r:new s,t:new n,rPh:new r}}get tag(){return"si"}render(t,e){t.openNode(this.tag),e&&e.hasOwnProperty("richText")&&e.richText?e.richText.length?e.richText.forEach((e=>{this.map.r.render(t,e)})):this.map.t.render(t,""):null!=e&&this.map.t.render(t,e),t.closeNode()}parseOpen(t){const{name:e}=t;return this.parser?(this.parser.parseOpen(t),!0):e===this.tag?(this.model={},!0):(this.parser=this.map[e],!!this.parser&&(this.parser.parseOpen(t),!0))}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser){if(!this.parser.parseClose(t)){switch(t){case"r":{let t=this.model.richText;t||(t=this.model.richText=[]),t.push(this.parser.model);break}case"t":this.model=this.parser.model}this.parser=void 0}return!0}switch(t){case this.tag:return!1;default:return!0}}}},{"../base-xform":32,"./phonetic-text-xform":121,"./rich-text-xform":122,"./text-xform":125}],124:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform"),r=t("./shared-string-xform");e.exports=class extends s{constructor(t){super(),this.model=t||{values:[],count:0},this.hash=Object.create(null),this.rich=Object.create(null)}get sharedStringXform(){return this._sharedStringXform||(this._sharedStringXform=new r)}get values(){return this.model.values}get uniqueCount(){return this.model.values.length}get count(){return this.model.count}getString(t){return this.model.values[t]}add(t){return t.richText?this.addRichText(t):this.addText(t)}addText(t){let e=this.hash[t];return void 0===e&&(e=this.hash[t]=this.model.values.length,this.model.values.push(t)),this.model.count++,e}addRichText(t){const e=this.sharedStringXform.toXml(t);let i=this.rich[e];return void 0===i&&(i=this.rich[e]=this.model.values.length,this.model.values.push(t)),this.model.count++,i}render(t,e){e=e||this._values,t.openXml(n.StdDocAttributes),t.openNode("sst",{xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main",count:e.count,uniqueCount:e.values.length});const i=this.sharedStringXform;e.values.forEach((e=>{i.render(t,e)})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"sst":return!0;case"si":return this.parser=this.sharedStringXform,this.parser.parseOpen(t),!0;default:throw new Error("Unexpected xml node in parseOpen: "+JSON.stringify(t))}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.model.values.push(this.parser.model),this.model.count++,this.parser=void 0),!0;switch(t){case"sst":return!1;default:throw new Error("Unexpected xml node in parseClose: "+t)}}}},{"../../../utils/xml-stream":28,"../base-xform":32,"./shared-string-xform":123}],125:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"t"}render(t,e){t.openNode("t"),/^\s|\n|\s$/.test(e)&&t.addAttribute("xml:space","preserve"),t.writeText(e),t.closeNode()}get model(){return this._text.join("").replace(/_x([0-9A-F]{4})_/g,((t,e)=>String.fromCharCode(parseInt(e,16))))}parseOpen(t){switch(t.name){case"t":return this._text=[],!0;default:return!1}}parseText(t){this._text.push(t)}parseClose(){return!1}}},{"../base-xform":32}],126:[function(t,e,i){const n=t("../../../doc/enums"),s=t("../../../utils/utils"),r=t("../base-xform"),o={horizontalValues:["left","center","right","fill","centerContinuous","distributed","justify"].reduce(((t,e)=>(t[e]=!0,t)),{}),horizontal(t){return this.horizontalValues[t]?t:void 0},verticalValues:["top","middle","bottom","distributed","justify"].reduce(((t,e)=>(t[e]=!0,t)),{}),vertical(t){return"middle"===t?"center":this.verticalValues[t]?t:void 0},wrapText:t=>!!t||void 0,shrinkToFit:t=>!!t||void 0,textRotation(t){switch(t){case"vertical":return t;default:return(t=s.validInt(t))>=-90&&t<=90?t:void 0}},indent:t=>(t=s.validInt(t),Math.max(0,t)),readingOrder(t){switch(t){case"ltr":return n.ReadingOrder.LeftToRight;case"rtl":return n.ReadingOrder.RightToLeft;default:return}}},a={toXml(t){if(t=o.textRotation(t)){if("vertical"===t)return 255;const e=Math.round(t);if(e>=0&&e<=90)return e;if(e<0&&e>=-90)return 90-e}},toModel(t){const e=s.validInt(t);if(void 0!==e){if(255===e)return"vertical";if(e>=0&&e<=90)return e;if(e>90&&e<=180)return 90-e}}};e.exports=class extends r{get tag(){return"alignment"}render(t,e){t.addRollback(),t.openNode("alignment");let i=!1;function n(e,n){n&&(t.addAttribute(e,n),i=!0)}n("horizontal",o.horizontal(e.horizontal)),n("vertical",o.vertical(e.vertical)),n("wrapText",!!o.wrapText(e.wrapText)&&"1"),n("shrinkToFit",!!o.shrinkToFit(e.shrinkToFit)&&"1"),n("indent",o.indent(e.indent)),n("textRotation",a.toXml(e.textRotation)),n("readingOrder",o.readingOrder(e.readingOrder)),t.closeNode(),i?t.commit():t.rollback()}parseOpen(t){const e={};let i=!1;function n(t,n,s){t&&(e[n]=s,i=!0)}n(t.attributes.horizontal,"horizontal",t.attributes.horizontal),n(t.attributes.vertical,"vertical","center"===t.attributes.vertical?"middle":t.attributes.vertical),n(t.attributes.wrapText,"wrapText",s.parseBoolean(t.attributes.wrapText)),n(t.attributes.shrinkToFit,"shrinkToFit",s.parseBoolean(t.attributes.shrinkToFit)),n(t.attributes.indent,"indent",parseInt(t.attributes.indent,10)),n(t.attributes.textRotation,"textRotation",a.toModel(t.attributes.textRotation)),n(t.attributes.readingOrder,"readingOrder","2"===t.attributes.readingOrder?"rtl":"ltr"),this.model=i?e:null}parseText(){}parseClose(){return!1}}},{"../../../doc/enums":7,"../../../utils/utils":27,"../base-xform":32}],127:[function(t,e,i){const n=t("../base-xform"),s=t("../../../utils/utils"),r=t("./color-xform");class o extends n{constructor(t){super(),this.name=t,this.map={color:new r}}get tag(){return this.name}render(t,e,i){const n=e&&e.color||i||this.defaultColor;t.openNode(this.name),e&&e.style&&(t.addAttribute("style",e.style),n&&this.map.color.render(t,n)),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.name:{const{style:e}=t.attributes;return this.model=e?{style:e}:void 0,!0}case"color":return this.parser=this.map.color,this.parser.parseOpen(t),!0;default:return!1}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return this.parser?(this.parser.parseClose(t)||(this.parser=void 0),!0):(t===this.name&&this.map.color.model&&(this.model||(this.model={}),this.model.color=this.map.color.model),!1)}validStyle(t){return o.validStyleValues[t]}}o.validStyleValues=["thin","dashed","dotted","dashDot","hair","dashDotDot","slantDashDot","mediumDashed","mediumDashDotDot","mediumDashDot","medium","double","thick"].reduce(((t,e)=>(t[e]=!0,t)),{});e.exports=class extends n{constructor(){super(),this.map={top:new o("top"),left:new o("left"),bottom:new o("bottom"),right:new o("right"),diagonal:new o("diagonal")}}render(t,e){const{color:i}=e;function n(n,s){n&&!n.color&&e.color&&(n={...n,color:e.color}),s.render(t,n,i)}t.openNode("border"),e.diagonal&&e.diagonal.style&&(e.diagonal.up&&t.addAttribute("diagonalUp","1"),e.diagonal.down&&t.addAttribute("diagonalDown","1")),n(e.left,this.map.left),n(e.right,this.map.right),n(e.top,this.map.top),n(e.bottom,this.map.bottom),n(e.diagonal,this.map.diagonal),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"border":return this.reset(),this.diagonalUp=s.parseBoolean(t.attributes.diagonalUp),this.diagonalDown=s.parseBoolean(t.attributes.diagonalDown),!0;default:return this.parser=this.map[t.name],!!this.parser&&(this.parser.parseOpen(t),!0)}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;if("border"===t){const t=this.model={},e=function(e,i,n){i&&(n&&Object.assign(i,n),t[e]=i)};e("left",this.map.left.model),e("right",this.map.right.model),e("top",this.map.top.model),e("bottom",this.map.bottom.model),e("diagonal",this.map.diagonal.model,{up:this.diagonalUp,down:this.diagonalDown})}return!1}}},{"../../../utils/utils":27,"../base-xform":32,"./color-xform":128}],128:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{constructor(t){super(),this.name=t||"color"}get tag(){return this.name}render(t,e){return!!e&&(t.openNode(this.name),e.argb?t.addAttribute("rgb",e.argb):void 0!==e.theme?(t.addAttribute("theme",e.theme),void 0!==e.tint&&t.addAttribute("tint",e.tint)):void 0!==e.indexed?t.addAttribute("indexed",e.indexed):t.addAttribute("auto","1"),t.closeNode(),!0)}parseOpen(t){return t.name===this.name&&(t.attributes.rgb?this.model={argb:t.attributes.rgb}:t.attributes.theme?(this.model={theme:parseInt(t.attributes.theme,10)},t.attributes.tint&&(this.model.tint=parseFloat(t.attributes.tint))):t.attributes.indexed?this.model={indexed:parseInt(t.attributes.indexed,10)}:this.model=void 0,!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],129:[function(t,e,i){const n=t("../base-xform"),s=t("./alignment-xform"),r=t("./border-xform"),o=t("./fill-xform"),a=t("./font-xform"),h=t("./numfmt-xform"),c=t("./protection-xform");e.exports=class extends n{constructor(){super(),this.map={alignment:new s,border:new r,fill:new o,font:new a,numFmt:new h,protection:new c}}get tag(){return"dxf"}render(t,e){if(t.openNode(this.tag),e.font&&this.map.font.render(t,e.font),e.numFmt&&e.numFmtId){const i={id:e.numFmtId,formatCode:e.numFmt};this.map.numFmt.render(t,i)}e.fill&&this.map.fill.render(t,e.fill),e.alignment&&this.map.alignment.render(t,e.alignment),e.border&&this.map.border.render(t,e.border),e.protection&&this.map.protection.render(t,e.protection),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:return this.reset(),!0;default:return this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t),!0}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return this.parser?(this.parser.parseClose(t)||(this.parser=void 0),!0):t!==this.tag||(this.model={alignment:this.map.alignment.model,border:this.map.border.model,fill:this.map.fill.model,font:this.map.font.model,numFmt:this.map.numFmt.model,protection:this.map.protection.model},!1)}}},{"../base-xform":32,"./alignment-xform":126,"./border-xform":127,"./fill-xform":130,"./font-xform":131,"./numfmt-xform":132,"./protection-xform":133}],130:[function(t,e,i){const n=t("../base-xform"),s=t("./color-xform");class r extends n{constructor(){super(),this.map={color:new s}}get tag(){return"stop"}render(t,e){t.openNode("stop"),t.addAttribute("position",e.position),this.map.color.render(t,e.color),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"stop":return this.model={position:parseFloat(t.attributes.position)},!0;case"color":return this.parser=this.map.color,this.parser.parseOpen(t),!0;default:return!1}}parseText(){}parseClose(t){return!!this.parser&&(this.parser.parseClose(t)||(this.model.color=this.parser.model,this.parser=void 0),!0)}}class o extends n{constructor(){super(),this.map={fgColor:new s("fgColor"),bgColor:new s("bgColor")}}get name(){return"pattern"}get tag(){return"patternFill"}render(t,e){t.openNode("patternFill"),t.addAttribute("patternType",e.pattern),e.fgColor&&this.map.fgColor.render(t,e.fgColor),e.bgColor&&this.map.bgColor.render(t,e.bgColor),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"patternFill":return this.model={type:"pattern",pattern:t.attributes.patternType},!0;default:return this.parser=this.map[t.name],!!this.parser&&(this.parser.parseOpen(t),!0)}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return!!this.parser&&(this.parser.parseClose(t)||(this.parser.model&&(this.model[t]=this.parser.model),this.parser=void 0),!0)}}class a extends n{constructor(){super(),this.map={stop:new r}}get name(){return"gradient"}get tag(){return"gradientFill"}render(t,e){switch(t.openNode("gradientFill"),e.gradient){case"angle":t.addAttribute("degree",e.degree);break;case"path":t.addAttribute("type","path"),e.center.left&&(t.addAttribute("left",e.center.left),void 0===e.center.right&&t.addAttribute("right",e.center.left)),e.center.right&&t.addAttribute("right",e.center.right),e.center.top&&(t.addAttribute("top",e.center.top),void 0===e.center.bottom&&t.addAttribute("bottom",e.center.top)),e.center.bottom&&t.addAttribute("bottom",e.center.bottom)}const i=this.map.stop;e.stops.forEach((e=>{i.render(t,e)})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"gradientFill":{const e=this.model={stops:[]};return t.attributes.degree?(e.gradient="angle",e.degree=parseInt(t.attributes.degree,10)):"path"===t.attributes.type&&(e.gradient="path",e.center={left:t.attributes.left?parseFloat(t.attributes.left):0,top:t.attributes.top?parseFloat(t.attributes.top):0},t.attributes.right!==t.attributes.left&&(e.center.right=t.attributes.right?parseFloat(t.attributes.right):0),t.attributes.bottom!==t.attributes.top&&(e.center.bottom=t.attributes.bottom?parseFloat(t.attributes.bottom):0)),!0}case"stop":return this.parser=this.map.stop,this.parser.parseOpen(t),!0;default:return!1}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return!!this.parser&&(this.parser.parseClose(t)||(this.model.stops.push(this.parser.model),this.parser=void 0),!0)}}class h extends n{constructor(){super(),this.map={patternFill:new o,gradientFill:new a}}get tag(){return"fill"}render(t,e){switch(t.addRollback(),t.openNode("fill"),e.type){case"pattern":this.map.patternFill.render(t,e);break;case"gradient":this.map.gradientFill.render(t,e);break;default:return void t.rollback()}t.closeNode(),t.commit()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"fill":return this.model={},!0;default:return this.parser=this.map[t.name],!!this.parser&&(this.parser.parseOpen(t),!0)}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return!!this.parser&&(this.parser.parseClose(t)||(this.model=this.parser.model,this.model.type=this.parser.name,this.parser=void 0),!0)}validStyle(t){return h.validPatternValues[t]}}h.validPatternValues=["none","solid","darkVertical","darkGray","mediumGray","lightGray","gray125","gray0625","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","lightGrid"].reduce(((t,e)=>(t[e]=!0,t)),{}),h.StopXform=r,h.PatternFillXform=o,h.GradientFillXform=a,e.exports=h},{"../base-xform":32,"./color-xform":128}],131:[function(t,e,i){const n=t("./color-xform"),s=t("../simple/boolean-xform"),r=t("../simple/integer-xform"),o=t("../simple/string-xform"),a=t("./underline-xform"),h=t("../../../utils/under-dash"),c=t("../base-xform");class u extends c{constructor(t){super(),this.options=t||u.OPTIONS,this.map={b:{prop:"bold",xform:new s({tag:"b",attr:"val"})},i:{prop:"italic",xform:new s({tag:"i",attr:"val"})},u:{prop:"underline",xform:new a},charset:{prop:"charset",xform:new r({tag:"charset",attr:"val"})},color:{prop:"color",xform:new n},condense:{prop:"condense",xform:new s({tag:"condense",attr:"val"})},extend:{prop:"extend",xform:new s({tag:"extend",attr:"val"})},family:{prop:"family",xform:new r({tag:"family",attr:"val"})},outline:{prop:"outline",xform:new s({tag:"outline",attr:"val"})},vertAlign:{prop:"vertAlign",xform:new o({tag:"vertAlign",attr:"val"})},scheme:{prop:"scheme",xform:new o({tag:"scheme",attr:"val"})},shadow:{prop:"shadow",xform:new s({tag:"shadow",attr:"val"})},strike:{prop:"strike",xform:new s({tag:"strike",attr:"val"})},sz:{prop:"size",xform:new r({tag:"sz",attr:"val"})}},this.map[this.options.fontNameTag]={prop:"name",xform:new o({tag:this.options.fontNameTag,attr:"val"})}}get tag(){return this.options.tagName}render(t,e){const{map:i}=this;t.openNode(this.options.tagName),h.each(this.map,((n,s)=>{i[s].xform.render(t,e[n.prop])})),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;if(this.map[t.name])return this.parser=this.map[t.name].xform,this.parser.parseOpen(t);switch(t.name){case this.options.tagName:return this.model={},!0;default:return!1}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser&&!this.parser.parseClose(t)){const e=this.map[t];return this.parser.model&&(this.model[e.prop]=this.parser.model),this.parser=void 0,!0}switch(t){case this.options.tagName:return!1;default:return!0}}}u.OPTIONS={tagName:"font",fontNameTag:"name"},e.exports=u},{"../../../utils/under-dash":26,"../base-xform":32,"../simple/boolean-xform":116,"../simple/integer-xform":118,"../simple/string-xform":119,"./color-xform":128,"./underline-xform":136}],132:[function(t,e,i){const n=t("../../../utils/under-dash"),s=t("../../defaultnumformats"),r=t("../base-xform");const o=function(){const t={};return n.each(s,((e,i)=>{e.f&&(t[e.f]=parseInt(i,10))})),t}();class a extends r{constructor(t,e){super(),this.id=t,this.formatCode=e}get tag(){return"numFmt"}render(t,e){t.leafNode("numFmt",{numFmtId:e.id,formatCode:e.formatCode})}parseOpen(t){switch(t.name){case"numFmt":return this.model={id:parseInt(t.attributes.numFmtId,10),formatCode:t.attributes.formatCode.replace(/[\\](.)/g,"$1")},!0;default:return!1}}parseText(){}parseClose(){return!1}}a.getDefaultFmtId=function(t){return o[t]},a.getDefaultFmtCode=function(t){return s[t]&&s[t].f},e.exports=a},{"../../../utils/under-dash":26,"../../defaultnumformats":30,"../base-xform":32}],133:[function(t,e,i){const n=t("../base-xform"),s={boolean:(t,e)=>void 0===t?e:t};e.exports=class extends n{get tag(){return"protection"}render(t,e){t.addRollback(),t.openNode("protection");let i=!1;function n(e,n){void 0!==n&&(t.addAttribute(e,n),i=!0)}n("locked",s.boolean(e.locked,!0)?void 0:"0"),n("hidden",s.boolean(e.hidden,!1)?"1":void 0),t.closeNode(),i?t.commit():t.rollback()}parseOpen(t){const e={locked:!("0"===t.attributes.locked),hidden:"1"===t.attributes.hidden},i=!e.locked||e.hidden;this.model=i?e:null}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],134:[function(t,e,i){const n=t("../base-xform"),s=t("./alignment-xform"),r=t("./protection-xform");e.exports=class extends n{constructor(t){super(),this.xfId=!(!t||!t.xfId),this.map={alignment:new s,protection:new r}}get tag(){return"xf"}render(t,e){t.openNode("xf",{numFmtId:e.numFmtId||0,fontId:e.fontId||0,fillId:e.fillId||0,borderId:e.borderId||0}),this.xfId&&t.addAttribute("xfId",e.xfId||0),e.numFmtId&&t.addAttribute("applyNumberFormat","1"),e.fontId&&t.addAttribute("applyFont","1"),e.fillId&&t.addAttribute("applyFill","1"),e.borderId&&t.addAttribute("applyBorder","1"),e.alignment&&t.addAttribute("applyAlignment","1"),e.protection&&t.addAttribute("applyProtection","1"),e.alignment&&this.map.alignment.render(t,e.alignment),e.protection&&this.map.protection.render(t,e.protection),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"xf":return this.model={numFmtId:parseInt(t.attributes.numFmtId,10),fontId:parseInt(t.attributes.fontId,10),fillId:parseInt(t.attributes.fillId,10),borderId:parseInt(t.attributes.borderId,10)},this.xfId&&(this.model.xfId=parseInt(t.attributes.xfId,10)),!0;case"alignment":return this.parser=this.map.alignment,this.parser.parseOpen(t),!0;case"protection":return this.parser=this.map.protection,this.parser.parseOpen(t),!0;default:return!1}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){return this.parser?(this.parser.parseClose(t)||(this.map.protection===this.parser?this.model.protection=this.parser.model:this.model.alignment=this.parser.model,this.parser=void 0),!0):"xf"!==t}}},{"../base-xform":32,"./alignment-xform":126,"./protection-xform":133}],135:[function(t,e,i){const n=t("../../../doc/enums"),s=t("../../../utils/xml-stream"),r=t("../base-xform"),o=t("../static-xform"),a=t("../list-xform"),h=t("./font-xform"),c=t("./fill-xform"),u=t("./border-xform"),l=t("./numfmt-xform"),f=t("./style-xform"),d=t("./dxf-xform");class p extends r{constructor(t){super(),this.map={numFmts:new a({tag:"numFmts",count:!0,childXform:new l}),fonts:new a({tag:"fonts",count:!0,childXform:new h,$:{"x14ac:knownFonts":1}}),fills:new a({tag:"fills",count:!0,childXform:new c}),borders:new a({tag:"borders",count:!0,childXform:new u}),cellStyleXfs:new a({tag:"cellStyleXfs",count:!0,childXform:new f}),cellXfs:new a({tag:"cellXfs",count:!0,childXform:new f({xfId:!0})}),dxfs:new a({tag:"dxfs",always:!0,count:!0,childXform:new d}),numFmt:new l,font:new h,fill:new c,border:new u,style:new f({xfId:!0}),cellStyles:p.STATIC_XFORMS.cellStyles,tableStyles:p.STATIC_XFORMS.tableStyles,extLst:p.STATIC_XFORMS.extLst},t&&this.init()}initIndex(){this.index={style:{},numFmt:{},numFmtNextId:164,font:{},border:{},fill:{}}}init(){this.model={styles:[],numFmts:[],fonts:[],borders:[],fills:[],dxfs:[]},this.initIndex(),this._addBorder({}),this._addStyle({numFmtId:0,fontId:0,fillId:0,borderId:0,xfId:0}),this._addFill({type:"pattern",pattern:"none"}),this._addFill({type:"pattern",pattern:"gray125"}),this.weakMap=new WeakMap}render(t,e){e=e||this.model,t.openXml(s.StdDocAttributes),t.openNode("styleSheet",p.STYLESHEET_ATTRIBUTES),this.index?(e.numFmts&&e.numFmts.length&&(t.openNode("numFmts",{count:e.numFmts.length}),e.numFmts.forEach((e=>{t.writeXml(e)})),t.closeNode()),e.fonts.length||this._addFont({size:11,color:{theme:1},name:"Calibri",family:2,scheme:"minor"}),t.openNode("fonts",{count:e.fonts.length,"x14ac:knownFonts":1}),e.fonts.forEach((e=>{t.writeXml(e)})),t.closeNode(),t.openNode("fills",{count:e.fills.length}),e.fills.forEach((e=>{t.writeXml(e)})),t.closeNode(),t.openNode("borders",{count:e.borders.length}),e.borders.forEach((e=>{t.writeXml(e)})),t.closeNode(),this.map.cellStyleXfs.render(t,[{numFmtId:0,fontId:0,fillId:0,borderId:0,xfId:0}]),t.openNode("cellXfs",{count:e.styles.length}),e.styles.forEach((e=>{t.writeXml(e)})),t.closeNode()):(this.map.numFmts.render(t,e.numFmts),this.map.fonts.render(t,e.fonts),this.map.fills.render(t,e.fills),this.map.borders.render(t,e.borders),this.map.cellStyleXfs.render(t,[{numFmtId:0,fontId:0,fillId:0,borderId:0,xfId:0}]),this.map.cellXfs.render(t,e.styles)),p.STATIC_XFORMS.cellStyles.render(t),this.map.dxfs.render(t,e.dxfs),p.STATIC_XFORMS.tableStyles.render(t),p.STATIC_XFORMS.extLst.render(t),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case"styleSheet":return this.initIndex(),!0;default:return this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t),!0}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case"styleSheet":{this.model={};const t=(t,e)=>{e.model&&e.model.length&&(this.model[t]=e.model)};if(t("numFmts",this.map.numFmts),t("fonts",this.map.fonts),t("fills",this.map.fills),t("borders",this.map.borders),t("styles",this.map.cellXfs),t("dxfs",this.map.dxfs),this.index={model:[],numFmt:[]},this.model.numFmts){const t=this.index.numFmt;this.model.numFmts.forEach((e=>{t[e.id]=e.formatCode}))}return!1}default:return!0}}addStyleModel(t,e){if(!t)return 0;if(this.model.fonts.length||this._addFont({size:11,color:{theme:1},name:"Calibri",family:2,scheme:"minor"}),this.weakMap&&this.weakMap.has(t))return this.weakMap.get(t);const i={};if(e=e||n.ValueType.Number,t.numFmt)i.numFmtId=this._addNumFmtStr(t.numFmt);else switch(e){case n.ValueType.Number:i.numFmtId=this._addNumFmtStr("General");break;case n.ValueType.Date:i.numFmtId=this._addNumFmtStr("mm-dd-yy")}t.font&&(i.fontId=this._addFont(t.font)),t.border&&(i.borderId=this._addBorder(t.border)),t.fill&&(i.fillId=this._addFill(t.fill)),t.alignment&&(i.alignment=t.alignment),t.protection&&(i.protection=t.protection);const s=this._addStyle(i);return this.weakMap&&this.weakMap.set(t,s),s}getStyleModel(t){const e=this.model.styles[t];if(!e)return null;let i=this.index.model[t];if(i)return i;if(i=this.index.model[t]={},e.numFmtId){const t=this.index.numFmt[e.numFmtId]||l.getDefaultFmtCode(e.numFmtId);t&&(i.numFmt=t)}function n(t,e,n){if(n||0===n){const s=e[n];s&&(i[t]=s)}}return n("font",this.model.fonts,e.fontId),n("border",this.model.borders,e.borderId),n("fill",this.model.fills,e.fillId),e.alignment&&(i.alignment=e.alignment),e.protection&&(i.protection=e.protection),i}addDxfStyle(t){return t.numFmt&&(t.numFmtId=this._addNumFmtStr(t.numFmt)),this.model.dxfs.push(t),this.model.dxfs.length-1}getDxfStyle(t){return this.model.dxfs[t]}_addStyle(t){const e=this.map.style.toXml(t);let i=this.index.style[e];return void 0===i&&(i=this.index.style[e]=this.model.styles.length,this.model.styles.push(e)),i}_addNumFmtStr(t){let e=l.getDefaultFmtId(t);if(void 0!==e)return e;if(e=this.index.numFmt[t],void 0!==e)return e;e=this.index.numFmt[t]=164+this.model.numFmts.length;const i=this.map.numFmt.toXml({id:e,formatCode:t});return this.model.numFmts.push(i),e}_addFont(t){const e=this.map.font.toXml(t);let i=this.index.font[e];return void 0===i&&(i=this.index.font[e]=this.model.fonts.length,this.model.fonts.push(e)),i}_addBorder(t){const e=this.map.border.toXml(t);let i=this.index.border[e];return void 0===i&&(i=this.index.border[e]=this.model.borders.length,this.model.borders.push(e)),i}_addFill(t){const e=this.map.fill.toXml(t);let i=this.index.fill[e];return void 0===i&&(i=this.index.fill[e]=this.model.fills.length,this.model.fills.push(e)),i}}p.STYLESHEET_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","mc:Ignorable":"x14ac x16r2","xmlns:x14ac":"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac","xmlns:x16r2":"http://schemas.microsoft.com/office/spreadsheetml/2015/02/main"},p.STATIC_XFORMS={cellStyles:new o({tag:"cellStyles",$:{count:1},c:[{tag:"cellStyle",$:{name:"Normal",xfId:0,builtinId:0}}]}),dxfs:new o({tag:"dxfs",$:{count:0}}),tableStyles:new o({tag:"tableStyles",$:{count:0,defaultTableStyle:"TableStyleMedium2",defaultPivotStyle:"PivotStyleLight16"}}),extLst:new o({tag:"extLst",c:[{tag:"ext",$:{uri:"{EB79DEF2-80B8-43e5-95BD-54CBDDF9020C}","xmlns:x14":"http://schemas.microsoft.com/office/spreadsheetml/2009/9/main"},c:[{tag:"x14:slicerStyles",$:{defaultSlicerStyle:"SlicerStyleLight1"}}]},{tag:"ext",$:{uri:"{9260A510-F301-46a8-8635-F512D64BE5F5}","xmlns:x15":"http://schemas.microsoft.com/office/spreadsheetml/2010/11/main"},c:[{tag:"x15:timelineStyles",$:{defaultTimelineStyle:"TimeSlicerStyleLight1"}}]}]})};p.Mock=class extends p{constructor(){super(),this.model={styles:[{numFmtId:0,fontId:0,fillId:0,borderId:0,xfId:0}],numFmts:[],fonts:[{size:11,color:{theme:1},name:"Calibri",family:2,scheme:"minor"}],borders:[{}],fills:[{type:"pattern",pattern:"none"},{type:"pattern",pattern:"gray125"}]}}parseStream(t){return t.autodrain(),Promise.resolve()}addStyleModel(t,e){switch(e){case n.ValueType.Date:return this.dateStyleId;default:return 0}}get dateStyleId(){if(!this._dateStyleId){const t={numFmtId:l.getDefaultFmtId("mm-dd-yy")};this._dateStyleId=this.model.styles.length,this.model.styles.push(t)}return this._dateStyleId}getStyleModel(){return{}}},e.exports=p},{"../../../doc/enums":7,"../../../utils/xml-stream":28,"../base-xform":32,"../list-xform":71,"../static-xform":120,"./border-xform":127,"./dxf-xform":129,"./fill-xform":130,"./font-xform":131,"./numfmt-xform":132,"./style-xform":134}],136:[function(t,e,i){const n=t("../base-xform");class s extends n{constructor(t){super(),this.model=t}get tag(){return"u"}render(t,e){if(!0===(e=e||this.model))t.leafNode("u");else{const i=s.Attributes[e];i&&t.leafNode("u",i)}}parseOpen(t){"u"===t.name&&(this.model=t.attributes.val||!0)}parseText(){}parseClose(){return!1}}s.Attributes={single:{},double:{val:"double"},singleAccounting:{val:"singleAccounting"},doubleAccounting:{val:"doubleAccounting"}},e.exports=s},{"../base-xform":32}],137:[function(t,e,i){const n=t("../base-xform"),s=t("./filter-column-xform");e.exports=class extends n{constructor(){super(),this.map={filterColumn:new s}}get tag(){return"autoFilter"}prepare(t){t.columns.forEach(((t,e)=>{this.map.filterColumn.prepare(t,{index:e})}))}render(t,e){return t.openNode(this.tag,{ref:e.autoFilterRef}),e.columns.forEach((e=>{this.map.filterColumn.render(t,e)})),t.closeNode(),!0}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;switch(t.name){case this.tag:return this.model={autoFilterRef:t.attributes.ref,columns:[]},!0;default:if(this.parser=this.map[t.name],this.parser)return this.parseOpen(t),!0;throw new Error("Unexpected xml node in parseOpen: "+JSON.stringify(t))}}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.model.columns.push(this.parser.model),this.parser=void 0),!0;switch(t){case this.tag:return!1;default:throw new Error("Unexpected xml node in parseClose: "+t)}}}},{"../base-xform":32,"./filter-column-xform":139}],138:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"customFilter"}render(t,e){t.leafNode(this.tag,{val:e.val,operator:e.operator})}parseOpen(t){return t.name===this.tag&&(this.model={val:t.attributes.val,operator:t.attributes.operator},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],139:[function(t,e,i){const n=t("../base-xform"),s=t("../list-xform"),r=t("./custom-filter-xform"),o=t("./filter-xform");e.exports=class extends n{constructor(){super(),this.map={customFilters:new s({tag:"customFilters",count:!1,empty:!0,childXform:new r}),filters:new s({tag:"filters",count:!1,empty:!0,childXform:new o})}}get tag(){return"filterColumn"}prepare(t,e){t.colId=e.index.toString()}render(t,e){return e.customFilters?(t.openNode(this.tag,{colId:e.colId,hiddenButton:e.filterButton?"0":"1"}),this.map.customFilters.render(t,e.customFilters),t.closeNode(),!0):(t.leafNode(this.tag,{colId:e.colId,hiddenButton:e.filterButton?"0":"1"}),!0)}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;const{attributes:e}=t;switch(t.name){case this.tag:return this.model={filterButton:"0"===e.hiddenButton},!0;default:if(this.parser=this.map[t.name],this.parser)return this.parseOpen(t),!0;throw new Error("Unexpected xml node in parseOpen: "+JSON.stringify(t))}}parseText(){}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model.customFilters=this.map.customFilters.model,!1;default:return!0}}}},{"../base-xform":32,"../list-xform":71,"./custom-filter-xform":138,"./filter-xform":140}],140:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"filter"}render(t,e){t.leafNode(this.tag,{val:e.val})}parseOpen(t){return t.name===this.tag&&(this.model={val:t.attributes.val},!0)}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],141:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"tableColumn"}prepare(t,e){t.id=e.index+1}render(t,e){return t.leafNode(this.tag,{id:e.id.toString(),name:e.name,totalsRowLabel:e.totalsRowLabel,totalsRowFunction:e.totalsRowFunction,dxfId:e.dxfId}),!0}parseOpen(t){if(t.name===this.tag){const{attributes:e}=t;return this.model={name:e.name,totalsRowLabel:e.totalsRowLabel,totalsRowFunction:e.totalsRowFunction,dxfId:e.dxfId},!0}return!1}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],142:[function(t,e,i){const n=t("../base-xform");e.exports=class extends n{get tag(){return"tableStyleInfo"}render(t,e){return t.leafNode(this.tag,{name:e.theme?e.theme:void 0,showFirstColumn:e.showFirstColumn?"1":"0",showLastColumn:e.showLastColumn?"1":"0",showRowStripes:e.showRowStripes?"1":"0",showColumnStripes:e.showColumnStripes?"1":"0"}),!0}parseOpen(t){if(t.name===this.tag){const{attributes:e}=t;return this.model={theme:e.name?e.name:null,showFirstColumn:"1"===e.showFirstColumn,showLastColumn:"1"===e.showLastColumn,showRowStripes:"1"===e.showRowStripes,showColumnStripes:"1"===e.showColumnStripes},!0}return!1}parseText(){}parseClose(){return!1}}},{"../base-xform":32}],143:[function(t,e,i){const n=t("../../../utils/xml-stream"),s=t("../base-xform"),r=t("../list-xform"),o=t("./auto-filter-xform"),a=t("./table-column-xform"),h=t("./table-style-info-xform");class c extends s{constructor(){super(),this.map={autoFilter:new o,tableColumns:new r({tag:"tableColumns",count:!0,empty:!0,childXform:new a}),tableStyleInfo:new h}}prepare(t,e){this.map.autoFilter.prepare(t),this.map.tableColumns.prepare(t.columns,e)}get tag(){return"table"}render(t,e){t.openXml(n.StdDocAttributes),t.openNode(this.tag,{...c.TABLE_ATTRIBUTES,id:e.id,name:e.name,displayName:e.displayName||e.name,ref:e.tableRef,totalsRowCount:e.totalsRow?"1":void 0,totalsRowShown:e.totalsRow?void 0:"1",headerRowCount:e.headerRow?"1":"0"}),this.map.autoFilter.render(t,e),this.map.tableColumns.render(t,e.columns),this.map.tableStyleInfo.render(t,e.style),t.closeNode()}parseOpen(t){if(this.parser)return this.parser.parseOpen(t),!0;const{name:e,attributes:i}=t;switch(e){case this.tag:this.reset(),this.model={name:i.name,displayName:i.displayName||i.name,tableRef:i.ref,totalsRow:"1"===i.totalsRowCount,headerRow:"1"===i.headerRowCount};break;default:this.parser=this.map[t.name],this.parser&&this.parser.parseOpen(t)}return!0}parseText(t){this.parser&&this.parser.parseText(t)}parseClose(t){if(this.parser)return this.parser.parseClose(t)||(this.parser=void 0),!0;switch(t){case this.tag:return this.model.columns=this.map.tableColumns.model,this.map.autoFilter.model&&(this.model.autoFilterRef=this.map.autoFilter.model.autoFilterRef,this.map.autoFilter.model.columns.forEach(((t,e)=>{this.model.columns[e].filterButton=t.filterButton}))),this.model.style=this.map.tableStyleInfo.model,!1;default:return!0}}reconcile(t,e){t.columns.forEach((t=>{void 0!==t.dxfId&&(t.style=e.styles.getDxfStyle(t.dxfId))}))}}c.TABLE_ATTRIBUTES={xmlns:"http://schemas.openxmlformats.org/spreadsheetml/2006/main","xmlns:mc":"http://schemas.openxmlformats.org/markup-compatibility/2006","mc:Ignorable":"xr xr3","xmlns:xr":"http://schemas.microsoft.com/office/spreadsheetml/2014/revision","xmlns:xr3":"http://schemas.microsoft.com/office/spreadsheetml/2016/revision3"},e.exports=c},{"../../../utils/xml-stream":28,"../base-xform":32,"../list-xform":71,"./auto-filter-xform":137,"./table-column-xform":141,"./table-style-info-xform":142}],144:[function(t,e,i){(function(i,n){(function(){const s=t("fs"),r=t("jszip"),{PassThrough:o}=t("readable-stream"),a=t("../utils/zip-stream"),h=t("../utils/stream-buf"),c=t("../utils/utils"),u=t("../utils/xml-stream"),{bufferToString:l}=t("../utils/browser-buffer-decode"),f=t("./xform/style/styles-xform"),d=t("./xform/core/core-xform"),p=t("./xform/strings/shared-strings-xform"),m=t("./xform/core/relationships-xform"),_=t("./xform/core/content-types-xform"),v=t("./xform/core/app-xform"),g=t("./xform/book/workbook-xform"),b=t("./xform/sheet/worksheet-xform"),w=t("./xform/drawing/drawing-xform"),y=t("./xform/table/table-xform"),x=t("./xform/comment/comments-xform"),M=t("./xform/comment/vml-notes-xform"),T=t("./xml/theme1");class O{constructor(t){this.workbook=t}async readFile(t,e){if(!await c.fs.exists(t))throw new Error("File not found: "+t);const i=s.createReadStream(t);try{const t=await this.read(i,e);return i.close(),t}catch(t){throw i.close(),t}}parseRels(t){return(new m).parseStream(t)}parseWorkbook(t){return(new g).parseStream(t)}parseSharedStrings(t){return(new p).parseStream(t)}reconcile(t,e){const i=new g,n=new b(e),s=new w,r=new y;i.reconcile(t);const o={media:t.media,mediaIndex:t.mediaIndex};Object.keys(t.drawings).forEach((e=>{const i=t.drawings[e],n=t.drawingRels[e];n&&(o.rels=n.reduce(((t,e)=>(t[e.Id]=e,t)),{}),(i.anchors||[]).forEach((t=>{const e=t.picture&&t.picture.hyperlinks;e&&o.rels[e.rId]&&(e.hyperlink=o.rels[e.rId].Target,delete e.rId)})),s.reconcile(i,o))}));const a={styles:t.styles};Object.values(t.tables).forEach((t=>{r.reconcile(t,a)}));const h={styles:t.styles,sharedStrings:t.sharedStrings,media:t.media,mediaIndex:t.mediaIndex,date1904:t.properties&&t.properties.date1904,drawings:t.drawings,comments:t.comments,tables:t.tables,vmlDrawings:t.vmlDrawings};t.worksheets.forEach((e=>{e.relationships=t.worksheetRels[e.sheetNo],n.reconcile(e,h)})),delete t.worksheetHash,delete t.worksheetRels,delete t.globalRels,delete t.sharedStrings,delete t.workbookRels,delete t.sheetDefs,delete t.styles,delete t.mediaIndex,delete t.drawings,delete t.drawingRels,delete t.vmlDrawings}async _processWorksheetEntry(t,e,i,n,s){const r=new b(n),o=await r.parseStream(t);o.sheetNo=i,e.worksheetHash[s]=o,e.worksheets.push(o)}async _processCommentEntry(t,e,i){const n=new x,s=await n.parseStream(t);e.comments[`../${i}.xml`]=s}async _processTableEntry(t,e,i){const n=new y,s=await n.parseStream(t);e.tables[`../tables/${i}.xml`]=s}async _processWorksheetRelsEntry(t,e,i){const n=new m,s=await n.parseStream(t);e.worksheetRels[i]=s}async _processMediaEntry(t,e,i){const n=i.lastIndexOf(".");if(n>=1){const s=i.substr(n+1),r=i.substr(0,n);await new Promise(((n,o)=>{const a=new h;a.on("finish",(()=>{e.mediaIndex[i]=e.media.length,e.mediaIndex[r]=e.media.length;const t={type:"image",name:r,extension:s,buffer:a.toBuffer()};e.media.push(t),n()})),t.on("error",(t=>{o(t)})),t.pipe(a)}))}}async _processDrawingEntry(t,e,i){const n=new w,s=await n.parseStream(t);e.drawings[i]=s}async _processDrawingRelsEntry(t,e,i){const n=new m,s=await n.parseStream(t);e.drawingRels[i]=s}async _processVmlDrawingEntry(t,e,i){const n=new M,s=await n.parseStream(t);e.vmlDrawings[`../drawings/${i}.vml`]=s}async _processThemeEntry(t,e,i){await new Promise(((n,s)=>{const r=new h;t.on("error",s),r.on("error",s),r.on("finish",(()=>{e.themes[i]=r.read().toString(),n()})),t.pipe(r)}))}createInputStream(){throw new Error("`XLSX#createInputStream` is deprecated. You should use `XLSX#read` instead. This method will be removed in version 5.0. Please follow upgrade instruction: https://github.com/exceljs/exceljs/blob/master/UPGRADE-4.0.md")}async read(t,e){!t[Symbol.asyncIterator]&&t.pipe&&(t=t.pipe(new o));const i=[];for await(const e of t)i.push(e);return this.load(n.concat(i),e)}async load(t,e){let s;s=e&&e.base64?n.from(t.toString(),"base64"):t;const a={worksheets:[],worksheetHash:{},worksheetRels:[],themes:{},media:[],mediaIndex:{},drawings:{},drawingRels:{},comments:{},tables:{},vmlDrawings:{}},h=await r.loadAsync(s);for(const t of Object.values(h.files))if(!t.dir){let n,s=t.name;if("/"===s[0]&&(s=s.substr(1)),s.match(/xl\/media\//)||s.match(/xl\/theme\/([a-zA-Z0-9]+)[.]xml/))n=new o,n.write(await t.async("nodebuffer"));else{let e;n=new o({writableObjectMode:!0,readableObjectMode:!0}),e=i.browser?l(await t.async("nodebuffer")):await t.async("string");const s=16384;for(let t=0;t<e.length;t+=s)n.write(e.substring(t,t+s))}switch(n.end(),s){case"_rels/.rels":a.globalRels=await this.parseRels(n);break;case"xl/workbook.xml":{const t=await this.parseWorkbook(n);a.sheets=t.sheets,a.definedNames=t.definedNames,a.views=t.views,a.properties=t.properties,a.calcProperties=t.calcProperties;break}case"xl/_rels/workbook.xml.rels":a.workbookRels=await this.parseRels(n);break;case"xl/sharedStrings.xml":a.sharedStrings=new p,await a.sharedStrings.parseStream(n);break;case"xl/styles.xml":a.styles=new f,await a.styles.parseStream(n);break;case"docProps/app.xml":{const t=new v,e=await t.parseStream(n);a.company=e.company,a.manager=e.manager;break}case"docProps/core.xml":{const t=new d,e=await t.parseStream(n);Object.assign(a,e);break}default:{let t=s.match(/xl\/worksheets\/sheet(\d+)[.]xml/);if(t){await this._processWorksheetEntry(n,a,t[1],e,s);break}if(t=s.match(/xl\/worksheets\/_rels\/sheet(\d+)[.]xml.rels/),t){await this._processWorksheetRelsEntry(n,a,t[1]);break}if(t=s.match(/xl\/theme\/([a-zA-Z0-9]+)[.]xml/),t){await this._processThemeEntry(n,a,t[1]);break}if(t=s.match(/xl\/media\/([a-zA-Z0-9]+[.][a-zA-Z0-9]{3,4})$/),t){await this._processMediaEntry(n,a,t[1]);break}if(t=s.match(/xl\/drawings\/([a-zA-Z0-9]+)[.]xml/),t){await this._processDrawingEntry(n,a,t[1]);break}if(t=s.match(/xl\/(comments\d+)[.]xml/),t){await this._processCommentEntry(n,a,t[1]);break}if(t=s.match(/xl\/tables\/(table\d+)[.]xml/),t){await this._processTableEntry(n,a,t[1]);break}if(t=s.match(/xl\/drawings\/_rels\/([a-zA-Z0-9]+)[.]xml[.]rels/),t){await this._processDrawingRelsEntry(n,a,t[1]);break}if(t=s.match(/xl\/drawings\/(vmlDrawing\d+)[.]vml/),t){await this._processVmlDrawingEntry(n,a,t[1]);break}}}}return this.reconcile(a,e),this.workbook.model=a,this.workbook}async addMedia(t,e){await Promise.all(e.media.map((async e=>{if("image"===e.type){const i=`xl/media/${e.name}.${e.extension}`;if(e.filename){const n=await function(t,e){return new Promise(((i,n)=>{s.readFile(t,e,((t,e)=>{t?n(t):i(e)}))}))}(e.filename);return t.append(n,{name:i})}if(e.buffer)return t.append(e.buffer,{name:i});if(e.base64){const n=e.base64,s=n.substring(n.indexOf(",")+1);return t.append(s,{name:i,base64:!0})}}throw new Error("Unsupported media")})))}addDrawings(t,e){const i=new w,n=new m;e.worksheets.forEach((e=>{const{drawing:s}=e;if(s){i.prepare(s,{});let e=i.toXml(s);t.append(e,{name:`xl/drawings/${s.name}.xml`}),e=n.toXml(s.rels),t.append(e,{name:`xl/drawings/_rels/${s.name}.xml.rels`})}}))}addTables(t,e){const i=new y;e.worksheets.forEach((e=>{const{tables:n}=e;n.forEach((e=>{i.prepare(e,{});const n=i.toXml(e);t.append(n,{name:"xl/tables/"+e.target})}))}))}async addContentTypes(t,e){const i=(new _).toXml(e);t.append(i,{name:"[Content_Types].xml"})}async addApp(t,e){const i=(new v).toXml(e);t.append(i,{name:"docProps/app.xml"})}async addCore(t,e){const i=new d;t.append(i.toXml(e),{name:"docProps/core.xml"})}async addThemes(t,e){const i=e.themes||{theme1:T};Object.keys(i).forEach((e=>{const n=i[e],s=`xl/theme/${e}.xml`;t.append(n,{name:s})}))}async addOfficeRels(t){const e=(new m).toXml([{Id:"rId1",Type:O.RelType.OfficeDocument,Target:"xl/workbook.xml"},{Id:"rId2",Type:O.RelType.CoreProperties,Target:"docProps/core.xml"},{Id:"rId3",Type:O.RelType.ExtenderProperties,Target:"docProps/app.xml"}]);t.append(e,{name:"_rels/.rels"})}async addWorkbookRels(t,e){let i=1;const n=[{Id:"rId"+i++,Type:O.RelType.Styles,Target:"styles.xml"},{Id:"rId"+i++,Type:O.RelType.Theme,Target:"theme/theme1.xml"}];e.sharedStrings.count&&n.push({Id:"rId"+i++,Type:O.RelType.SharedStrings,Target:"sharedStrings.xml"}),e.worksheets.forEach((t=>{t.rId="rId"+i++,n.push({Id:t.rId,Type:O.RelType.Worksheet,Target:`worksheets/sheet${t.id}.xml`})}));const s=(new m).toXml(n);t.append(s,{name:"xl/_rels/workbook.xml.rels"})}async addSharedStrings(t,e){e.sharedStrings&&e.sharedStrings.count&&t.append(e.sharedStrings.xml,{name:"xl/sharedStrings.xml"})}async addStyles(t,e){const{xml:i}=e.styles;i&&t.append(i,{name:"xl/styles.xml"})}async addWorkbook(t,e){const i=new g;t.append(i.toXml(e),{name:"xl/workbook.xml"})}async addWorksheets(t,e){const i=new b,n=new m,s=new x,r=new M;e.worksheets.forEach((e=>{let o=new u;i.render(o,e),t.append(o.xml,{name:`xl/worksheets/sheet${e.id}.xml`}),e.rels&&e.rels.length&&(o=new u,n.render(o,e.rels),t.append(o.xml,{name:`xl/worksheets/_rels/sheet${e.id}.xml.rels`})),e.comments.length>0&&(o=new u,s.render(o,e),t.append(o.xml,{name:`xl/comments${e.id}.xml`}),o=new u,r.render(o,e),t.append(o.xml,{name:`xl/drawings/vmlDrawing${e.id}.vml`}))}))}_finalize(t){return new Promise(((e,i)=>{t.on("finish",(()=>{e(this)})),t.on("error",i),t.finalize()}))}prepareModel(t,e){t.creator=t.creator||"ExcelJS",t.lastModifiedBy=t.lastModifiedBy||"ExcelJS",t.created=t.created||new Date,t.modified=t.modified||new Date,t.useSharedStrings=void 0===e.useSharedStrings||e.useSharedStrings,t.useStyles=void 0===e.useStyles||e.useStyles,t.sharedStrings=new p,t.styles=t.useStyles?new f(!0):new f.Mock;const i=new g,n=new b;i.prepare(t);const s={sharedStrings:t.sharedStrings,styles:t.styles,date1904:t.properties.date1904,drawingsCount:0,media:t.media};s.drawings=t.drawings=[],s.commentRefs=t.commentRefs=[];let r=0;t.tables=[],t.worksheets.forEach((e=>{e.tables.forEach((e=>{r++,e.target=`table${r}.xml`,e.id=r,t.tables.push(e)})),n.prepare(e,s)}))}async write(t,e){e=e||{};const{model:i}=this.workbook,n=new a.ZipWriter(e.zip);return n.pipe(t),this.prepareModel(i,e),await this.addContentTypes(n,i),await this.addOfficeRels(n,i),await this.addWorkbookRels(n,i),await this.addWorksheets(n,i),await this.addSharedStrings(n,i),await this.addDrawings(n,i),await this.addTables(n,i),await Promise.all([this.addThemes(n,i),this.addStyles(n,i)]),await this.addMedia(n,i),await Promise.all([this.addApp(n,i),this.addCore(n,i)]),await this.addWorkbook(n,i),this._finalize(n)}writeFile(t,e){const i=s.createWriteStream(t);return new Promise(((t,n)=>{i.on("finish",(()=>{t()})),i.on("error",(t=>{n(t)})),this.write(i,e).then((()=>{i.end()})).catch((t=>{n(t)}))}))}async writeBuffer(t){const e=new h;return await this.write(e,t),e.read()}}O.RelType=t("./rel-type"),e.exports=O}).call(this)}).call(this,t("_process"),t("buffer").Buffer)},{"../utils/browser-buffer-decode":16,"../utils/stream-buf":24,"../utils/utils":27,"../utils/xml-stream":28,"../utils/zip-stream":29,"./rel-type":31,"./xform/book/workbook-xform":38,"./xform/comment/comments-xform":40,"./xform/comment/vml-notes-xform":45,"./xform/core/app-xform":51,"./xform/core/content-types-xform":52,"./xform/core/core-xform":53,"./xform/core/relationships-xform":55,"./xform/drawing/drawing-xform":62,"./xform/sheet/worksheet-xform":115,"./xform/strings/shared-strings-xform":124,"./xform/style/styles-xform":135,"./xform/table/table-xform":143,"./xml/theme1":145,_process:467,buffer:220,fs:216,jszip:441,"readable-stream":491}],145:[function(t,e,i){e.exports='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme"> <a:themeElements> <a:clrScheme name="Office"> <a:dk1> <a:sysClr val="windowText" lastClr="000000"/> </a:dk1> <a:lt1> <a:sysClr val="window" lastClr="FFFFFF"/> </a:lt1> <a:dk2> <a:srgbClr val="1F497D"/> </a:dk2> <a:lt2> <a:srgbClr val="EEECE1"/> </a:lt2> <a:accent1> <a:srgbClr val="4F81BD"/> </a:accent1> <a:accent2> <a:srgbClr val="C0504D"/> </a:accent2> <a:accent3> <a:srgbClr val="9BBB59"/> </a:accent3> <a:accent4> <a:srgbClr val="8064A2"/> </a:accent4> <a:accent5> <a:srgbClr val="4BACC6"/> </a:accent5> <a:accent6> <a:srgbClr val="F79646"/> </a:accent6> <a:hlink> <a:srgbClr val="0000FF"/> </a:hlink> <a:folHlink> <a:srgbClr val="800080"/> </a:folHlink> </a:clrScheme> <a:fontScheme name="Office"> <a:majorFont> <a:latin typeface="Cambria"/> <a:ea typeface=""/> <a:cs typeface=""/> <a:font script="Jpan" typeface=" "/> <a:font script="Hang" typeface=" "/> <a:font script="Hans" typeface=""/> <a:font script="Hant" typeface=""/> <a:font script="Arab" typeface="Times New Roman"/> <a:font script="Hebr" typeface="Times New Roman"/> <a:font script="Thai" typeface="Tahoma"/> <a:font script="Ethi" typeface="Nyala"/> <a:font script="Beng" typeface="Vrinda"/> <a:font script="Gujr" typeface="Shruti"/> <a:font script="Khmr" typeface="MoolBoran"/> <a:font script="Knda" typeface="Tunga"/> <a:font script="Guru" typeface="Raavi"/> <a:font script="Cans" typeface="Euphemia"/> <a:font script="Cher" typeface="Plantagenet Cherokee"/> <a:font script="Yiii" typeface="Microsoft Yi Baiti"/> <a:font script="Tibt" typeface="Microsoft Himalaya"/> <a:font script="Thaa" typeface="MV Boli"/> <a:font script="Deva" typeface="Mangal"/> <a:font script="Telu" typeface="Gautami"/> <a:font script="Taml" typeface="Latha"/> <a:font script="Syrc" typeface="Estrangelo Edessa"/> <a:font script="Orya" typeface="Kalinga"/> <a:font script="Mlym" typeface="Kartika"/> <a:font script="Laoo" typeface="DokChampa"/> <a:font script="Sinh" typeface="Iskoola Pota"/> <a:font script="Mong" typeface="Mongolian Baiti"/> <a:font script="Viet" typeface="Times New Roman"/> <a:font script="Uigh" typeface="Microsoft Uighur"/> <a:font script="Geor" typeface="Sylfaen"/> </a:majorFont> <a:minorFont> <a:latin typeface="Calibri"/> <a:ea typeface=""/> <a:cs typeface=""/> <a:font script="Jpan" typeface=" "/> <a:font script="Hang" typeface=" "/> <a:font script="Hans" typeface=""/> <a:font script="Hant" typeface=""/> <a:font script="Arab" typeface="Arial"/> <a:font script="Hebr" typeface="Arial"/> <a:font script="Thai" typeface="Tahoma"/> <a:font script="Ethi" typeface="Nyala"/> <a:font script="Beng" typeface="Vrinda"/> <a:font script="Gujr" typeface="Shruti"/> <a:font script="Khmr" typeface="DaunPenh"/> <a:font script="Knda" typeface="Tunga"/> <a:font script="Guru" typeface="Raavi"/> <a:font script="Cans" typeface="Euphemia"/> <a:font script="Cher" typeface="Plantagenet Cherokee"/> <a:font script="Yiii" typeface="Microsoft Yi Baiti"/> <a:font script="Tibt" typeface="Microsoft Himalaya"/> <a:font script="Thaa" typeface="MV Boli"/> <a:font script="Deva" typeface="Mangal"/> <a:font script="Telu" typeface="Gautami"/> <a:font script="Taml" typeface="Latha"/> <a:font script="Syrc" typeface="Estrangelo Edessa"/> <a:font script="Orya" typeface="Kalinga"/> <a:font script="Mlym" typeface="Kartika"/> <a:font script="Laoo" typeface="DokChampa"/> <a:font script="Sinh" typeface="Iskoola Pota"/> <a:font script="Mong" typeface="Mongolian Baiti"/> <a:font script="Viet" typeface="Arial"/> <a:font script="Uigh" typeface="Microsoft Uighur"/> <a:font script="Geor" typeface="Sylfaen"/> </a:minorFont> </a:fontScheme> <a:fmtScheme name="Office"> <a:fillStyleLst> <a:solidFill> <a:schemeClr val="phClr"/> </a:solidFill> <a:gradFill rotWithShape="1"> <a:gsLst> <a:gs pos="0"> <a:schemeClr val="phClr"> <a:tint val="50000"/> <a:satMod val="300000"/> </a:schemeClr> </a:gs> <a:gs pos="35000"> <a:schemeClr val="phClr"> <a:tint val="37000"/> <a:satMod val="300000"/> </a:schemeClr> </a:gs> <a:gs pos="100000"> <a:schemeClr val="phClr"> <a:tint val="15000"/> <a:satMod val="350000"/> </a:schemeClr> </a:gs> </a:gsLst> <a:lin ang="16200000" scaled="1"/> </a:gradFill> <a:gradFill rotWithShape="1"> <a:gsLst> <a:gs pos="0"> <a:schemeClr val="phClr"> <a:tint val="100000"/> <a:shade val="100000"/> <a:satMod val="130000"/> </a:schemeClr> </a:gs> <a:gs pos="100000"> <a:schemeClr val="phClr"> <a:tint val="50000"/> <a:shade val="100000"/> <a:satMod val="350000"/> </a:schemeClr> </a:gs> </a:gsLst> <a:lin ang="16200000" scaled="0"/> </a:gradFill> </a:fillStyleLst> <a:lnStyleLst> <a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"> <a:solidFill> <a:schemeClr val="phClr"> <a:shade val="95000"/> <a:satMod val="105000"/> </a:schemeClr> </a:solidFill> <a:prstDash val="solid"/> </a:ln> <a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"> <a:solidFill> <a:schemeClr val="phClr"/> </a:solidFill> <a:prstDash val="solid"/> </a:ln> <a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"> <a:solidFill> <a:schemeClr val="phClr"/> </a:solidFill> <a:prstDash val="solid"/> </a:ln> </a:lnStyleLst> <a:effectStyleLst> <a:effectStyle> <a:effectLst> <a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"> <a:srgbClr val="000000"> <a:alpha val="38000"/> </a:srgbClr> </a:outerShdw> </a:effectLst> </a:effectStyle> <a:effectStyle> <a:effectLst> <a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"> <a:srgbClr val="000000"> <a:alpha val="35000"/> </a:srgbClr> </a:outerShdw> </a:effectLst> </a:effectStyle> <a:effectStyle> <a:effectLst> <a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"> <a:srgbClr val="000000"> <a:alpha val="35000"/> </a:srgbClr> </a:outerShdw> </a:effectLst> <a:scene3d> <a:camera prst="orthographicFront"> <a:rot lat="0" lon="0" rev="0"/> </a:camera> <a:lightRig rig="threePt" dir="t"> <a:rot lat="0" lon="0" rev="1200000"/> </a:lightRig> </a:scene3d> <a:sp3d> <a:bevelT w="63500" h="25400"/> </a:sp3d> </a:effectStyle> </a:effectStyleLst> <a:bgFillStyleLst> <a:solidFill> <a:schemeClr val="phClr"/> </a:solidFill> <a:gradFill rotWithShape="1"> <a:gsLst> <a:gs pos="0"> <a:schemeClr val="phClr"> <a:tint val="40000"/> <a:satMod val="350000"/> </a:schemeClr> </a:gs> <a:gs pos="40000"> <a:schemeClr val="phClr"> <a:tint val="45000"/> <a:shade val="99000"/> <a:satMod val="350000"/> </a:schemeClr> </a:gs> <a:gs pos="100000"> <a:schemeClr val="phClr"> <a:shade val="20000"/> <a:satMod val="255000"/> </a:schemeClr> </a:gs> </a:gsLst> <a:path path="circle"> <a:fillToRect l="50000" t="-80000" r="50000" b="180000"/> </a:path> </a:gradFill> <a:gradFill rotWithShape="1"> <a:gsLst> <a:gs pos="0"> <a:schemeClr val="phClr"> <a:tint val="80000"/> <a:satMod val="300000"/> </a:schemeClr> </a:gs> <a:gs pos="100000"> <a:schemeClr val="phClr"> <a:shade val="30000"/> <a:satMod val="200000"/> </a:schemeClr> </a:gs> </a:gsLst> <a:path path="circle"> <a:fillToRect l="50000" t="50000" r="50000" b="50000"/> </a:path> </a:gradFill> </a:bgFillStyleLst> </a:fmtScheme> </a:themeElements> <a:objectDefaults> <a:spDef> <a:spPr/> <a:bodyPr/> <a:lstStyle/> <a:style> <a:lnRef idx="1"> <a:schemeClr val="accent1"/> </a:lnRef> <a:fillRef idx="3"> <a:schemeClr val="accent1"/> </a:fillRef> <a:effectRef idx="2"> <a:schemeClr val="accent1"/> </a:effectRef> <a:fontRef idx="minor"> <a:schemeClr val="lt1"/> </a:fontRef> </a:style> </a:spDef> <a:lnDef> <a:spPr/> <a:bodyPr/> <a:lstStyle/> <a:style> <a:lnRef idx="2"> <a:schemeClr val="accent1"/> </a:lnRef> <a:fillRef idx="0"> <a:schemeClr val="accent1"/> </a:fillRef> <a:effectRef idx="1"> <a:schemeClr val="accent1"/> </a:effectRef> <a:fontRef idx="minor"> <a:schemeClr val="tx1"/> </a:fontRef> </a:style> </a:lnDef> </a:objectDefaults> <a:extraClrSchemeLst/> </a:theme>'},{}],146:[function(t,e,i){(function(e){(function(){Object.defineProperty(i,"__esModule",{value:!0}),i.CsvFormatterStream=void 0;const n=t("stream"),s=t("./formatter");class r extends n.Transform{constructor(t){super({writableObjectMode:t.objectMode}),this.hasWrittenBOM=!1,this.formatterOptions=t,this.rowFormatter=new s.RowFormatter(t),this.hasWrittenBOM=!t.writeBOM}transform(t){return this.rowFormatter.rowTransform=t,this}_transform(t,i,n){let s=!1;try{this.hasWrittenBOM||(this.push(this.formatterOptions.BOM),this.hasWrittenBOM=!0),this.rowFormatter.format(t,((t,i)=>t?(s=!0,n(t)):(i&&i.forEach((t=>{this.push(e.from(t,"utf8"))})),s=!0,n())))}catch(t){if(s)throw t;n(t)}}_flush(t){this.rowFormatter.finish(((i,n)=>i?t(i):(n&&n.forEach((t=>{this.push(e.from(t,"utf8"))})),t())))}}i.CsvFormatterStream=r}).call(this)}).call(this,t("buffer").Buffer)},{"./formatter":150,buffer:220,stream:505}],147:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FormatterOptions=void 0;i.FormatterOptions=class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e;this.objectMode=!0,this.delimiter=",",this.rowDelimiter="\n",this.quote='"',this.escape=this.quote,this.quoteColumns=!1,this.quoteHeaders=this.quoteColumns,this.headers=null,this.includeEndRowDelimiter=!1,this.writeBOM=!1,this.BOM="\ufeff",this.alwaysWriteHeaders=!1,Object.assign(this,t||{}),void 0===(null==t?void 0:t.quoteHeaders)&&(this.quoteHeaders=this.quoteColumns),!0===(null==t?void 0:t.quote)?this.quote='"':!1===(null==t?void 0:t.quote)&&(this.quote=""),"string"!=typeof(null==t?void 0:t.escape)&&(this.escape=this.quote),this.shouldWriteHeaders=!!this.headers&&(null===(e=t.writeHeaders)||void 0===e||e),this.headers=Array.isArray(this.headers)?this.headers:null,this.escapedQuote=`${this.escape}${this.quote}`}}},{}],148:[function(t,e,i){var n=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.FieldFormatter=void 0;const s=n(t("lodash.isboolean")),r=n(t("lodash.isnil")),o=n(t("lodash.escaperegexp"));i.FieldFormatter=class{constructor(t){this._headers=null,this.formatterOptions=t,null!==t.headers&&(this.headers=t.headers),this.REPLACE_REGEXP=new RegExp(t.quote,"g");const e=`[${t.delimiter}${o.default(t.rowDelimiter)}|\r|\n]`;this.ESCAPE_REGEXP=new RegExp(e)}set headers(t){this._headers=t}shouldQuote(t,e){const i=e?this.formatterOptions.quoteHeaders:this.formatterOptions.quoteColumns;return s.default(i)?i:Array.isArray(i)?i[t]:null!==this._headers&&i[this._headers[t]]}format(t,e,i){const n=(""+(r.default(t)?"":t)).replace(/\0/g,""),{formatterOptions:s}=this;if(""!==s.quote){if(-1!==n.indexOf(s.quote))return this.quoteField(n.replace(this.REPLACE_REGEXP,s.escapedQuote))}return-1!==n.search(this.ESCAPE_REGEXP)||this.shouldQuote(e,i)?this.quoteField(n):n}quoteField(t){const{quote:e}=this.formatterOptions;return`${e}${t}${e}`}}},{"lodash.escaperegexp":442,"lodash.isboolean":444,"lodash.isnil":447}],149:[function(t,e,i){var n=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.RowFormatter=void 0;const s=n(t("lodash.isfunction")),r=n(t("lodash.isequal")),o=t("./FieldFormatter"),a=t("../types");class h{constructor(t){this.rowCount=0,this.formatterOptions=t,this.fieldFormatter=new o.FieldFormatter(t),this.headers=t.headers,this.shouldWriteHeaders=t.shouldWriteHeaders,this.hasWrittenHeaders=!1,null!==this.headers&&(this.fieldFormatter.headers=this.headers),t.transform&&(this.rowTransform=t.transform)}static isRowHashArray(t){return!!Array.isArray(t)&&(Array.isArray(t[0])&&2===t[0].length)}static isRowArray(t){return Array.isArray(t)&&!this.isRowHashArray(t)}static gatherHeaders(t){return h.isRowHashArray(t)?t.map((t=>t[0])):Array.isArray(t)?t:Object.keys(t)}static createTransform(t){return a.isSyncTransform(t)?(e,i)=>{let n=null;try{n=t(e)}catch(t){return i(t)}return i(null,n)}:(e,i)=>{t(e,i)}}set rowTransform(t){if(!s.default(t))throw new TypeError("The transform should be a function");this._rowTransform=h.createTransform(t)}format(t,e){this.callTransformer(t,((i,n)=>{if(i)return e(i);if(!t)return e(null);const s=[];if(n){const{shouldFormatColumns:t,headers:e}=this.checkHeaders(n);if(this.shouldWriteHeaders&&e&&!this.hasWrittenHeaders&&(s.push(this.formatColumns(e,!0)),this.hasWrittenHeaders=!0),t){const t=this.gatherColumns(n);s.push(this.formatColumns(t,!1))}}return e(null,s)}))}finish(t){const e=[];if(this.formatterOptions.alwaysWriteHeaders&&0===this.rowCount){if(!this.headers)return t(new Error("`alwaysWriteHeaders` option is set to true but `headers` option not provided."));e.push(this.formatColumns(this.headers,!0))}return this.formatterOptions.includeEndRowDelimiter&&e.push(this.formatterOptions.rowDelimiter),t(null,e)}checkHeaders(t){if(this.headers)return{shouldFormatColumns:!0,headers:this.headers};const e=h.gatherHeaders(t);return this.headers=e,this.fieldFormatter.headers=e,this.shouldWriteHeaders?{shouldFormatColumns:!r.default(e,t),headers:e}:{shouldFormatColumns:!0,headers:null}}gatherColumns(t){if(null===this.headers)throw new Error("Headers is currently null");return Array.isArray(t)?h.isRowHashArray(t)?this.headers.map(((e,i)=>{const n=t[i];return n?n[1]:""})):h.isRowArray(t)&&!this.shouldWriteHeaders?t:this.headers.map(((e,i)=>t[i])):this.headers.map((e=>t[e]))}callTransformer(t,e){return this._rowTransform?this._rowTransform(t,e):e(null,t)}formatColumns(t,e){const i=t.map(((t,i)=>this.fieldFormatter.format(t,i,e))).join(this.formatterOptions.delimiter),{rowCount:n}=this;return this.rowCount+=1,n?[this.formatterOptions.rowDelimiter,i].join(""):i}}i.RowFormatter=h},{"../types":152,"./FieldFormatter":148,"lodash.isequal":445,"lodash.isfunction":446}],150:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldFormatter=i.RowFormatter=void 0;var n=t("./RowFormatter");Object.defineProperty(i,"RowFormatter",{enumerable:!0,get:function(){return n.RowFormatter}});var s=t("./FieldFormatter");Object.defineProperty(i,"FieldFormatter",{enumerable:!0,get:function(){return s.FieldFormatter}})},{"./FieldFormatter":148,"./RowFormatter":149}],151:[function(t,e,i){(function(e){(function(){var n=Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]},s=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return s(e,t),e},o=function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.writeToPath=i.writeToString=i.writeToBuffer=i.writeToStream=i.write=i.format=i.FormatterOptions=i.CsvFormatterStream=void 0;const a=t("util"),h=t("stream"),c=r(t("fs")),u=t("./FormatterOptions"),l=t("./CsvFormatterStream");o(t("./types"),i);var f=t("./CsvFormatterStream");Object.defineProperty(i,"CsvFormatterStream",{enumerable:!0,get:function(){return f.CsvFormatterStream}});var d=t("./FormatterOptions");Object.defineProperty(i,"FormatterOptions",{enumerable:!0,get:function(){return d.FormatterOptions}}),i.format=t=>new l.CsvFormatterStream(new u.FormatterOptions(t)),i.write=(t,e)=>{const n=i.format(e),s=a.promisify(((t,e)=>{n.write(t,void 0,e)}));return t.reduce(((t,e)=>t.then((()=>s(e)))),Promise.resolve()).then((()=>n.end())).catch((t=>{n.emit("error",t)})),n},i.writeToStream=(t,e,n)=>i.write(e,n).pipe(t),i.writeToBuffer=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[],r=new h.Writable({write(t,e,i){s.push(t),i()}});return new Promise(((o,a)=>{r.on("error",a).on("finish",(()=>o(e.concat(s)))),i.write(t,n).pipe(r)}))},i.writeToString=(t,e)=>i.writeToBuffer(t,e).then((t=>t.toString())),i.writeToPath=(t,e,n)=>{const s=c.createWriteStream(t,{encoding:"utf8"});return i.write(e,n).pipe(s)}}).call(this)}).call(this,t("buffer").Buffer)},{"./CsvFormatterStream":146,"./FormatterOptions":147,"./types":152,buffer:220,fs:216,stream:505,util:527}],152:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isSyncTransform=void 0,i.isSyncTransform=t=>1===t.length},{}],153:[function(t,e,i){(function(e){(function(){Object.defineProperty(i,"__esModule",{value:!0}),i.CsvParserStream=void 0;const n=t("string_decoder"),s=t("stream"),r=t("./transforms"),o=t("./parser");class a extends s.Transform{constructor(t){super({objectMode:t.objectMode}),this.lines="",this.rowCount=0,this.parsedRowCount=0,this.parsedLineCount=0,this.endEmitted=!1,this.headersEmitted=!1,this.parserOptions=t,this.parser=new o.Parser(t),this.headerTransformer=new r.HeaderTransformer(t),this.decoder=new n.StringDecoder(t.encoding),this.rowTransformerValidator=new r.RowTransformerValidator}get hasHitRowLimit(){return this.parserOptions.limitRows&&this.rowCount>=this.parserOptions.maxRows}get shouldEmitRows(){return this.parsedRowCount>this.parserOptions.skipRows}get shouldSkipLine(){return this.parsedLineCount<=this.parserOptions.skipLines}transform(t){return this.rowTransformerValidator.rowTransform=t,this}validate(t){return this.rowTransformerValidator.rowValidator=t,this}emit(t){if("end"===t)return this.endEmitted||(this.endEmitted=!0,super.emit("end",this.rowCount)),!1;for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return super.emit(t,...i)}_transform(t,e,i){if(this.hasHitRowLimit)return i();const n=a.wrapDoneCallback(i);try{const{lines:e}=this,i=e+this.decoder.write(t),s=this.parse(i,!0);return this.processRows(s,n)}catch(t){return n(t)}}_flush(t){const e=a.wrapDoneCallback(t);if(this.hasHitRowLimit)return e();try{const t=this.lines+this.decoder.end(),i=this.parse(t,!1);return this.processRows(i,e)}catch(t){return e(t)}}parse(t,e){if(!t)return[];const{line:i,rows:n}=this.parser.parse(t,e);return this.lines=i,n}processRows(t,i){const n=t.length,s=r=>{const o=t=>t?i(t):r%100!=0?s(r+1):void e((()=>s(r+1)));if(this.checkAndEmitHeaders(),r>=n||this.hasHitRowLimit)return i();if(this.parsedLineCount+=1,this.shouldSkipLine)return o();const a=t[r];this.rowCount+=1,this.parsedRowCount+=1;const h=this.rowCount;return this.transformRow(a,((t,e)=>{if(t)return this.rowCount-=1,o(t);if(!e)return o(new Error("expected transform result"));if(e.isValid){if(e.row)return this.pushRow(e.row,o)}else this.emit("data-invalid",e.row,h,e.reason);return o()}))};s(0)}transformRow(t,e){try{this.headerTransformer.transform(t,((i,n)=>i?e(i):n?n.isValid?n.row?this.shouldEmitRows?this.rowTransformerValidator.transformAndValidate(n.row,e):this.skipRow(e):(this.rowCount-=1,this.parsedRowCount-=1,e(null,{row:null,isValid:!0})):this.shouldEmitRows?e(null,{isValid:!1,row:t}):this.skipRow(e):e(new Error("Expected result from header transform"))))}catch(t){e(t)}}checkAndEmitHeaders(){!this.headersEmitted&&this.headerTransformer.headers&&(this.headersEmitted=!0,this.emit("headers",this.headerTransformer.headers))}skipRow(t){return this.rowCount-=1,t(null,{row:null,isValid:!0})}pushRow(t,e){try{this.parserOptions.objectMode?this.push(t):this.push(JSON.stringify(t)),e()}catch(t){e(t)}}static wrapDoneCallback(t){let e=!1;return function(i){if(i){if(e)throw i;return e=!0,void t(i)}for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];t(...s)}}}i.CsvParserStream=a}).call(this)}).call(this,t("timers").setImmediate)},{"./parser":165,"./transforms":168,stream:505,string_decoder:218,timers:523}],154:[function(t,e,i){var n=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.ParserOptions=void 0;const s=n(t("lodash.escaperegexp")),r=n(t("lodash.isnil"));i.ParserOptions=class{constructor(t){var e;if(this.objectMode=!0,this.delimiter=",",this.ignoreEmpty=!1,this.quote='"',this.escape=null,this.escapeChar=this.quote,this.comment=null,this.supportsComments=!1,this.ltrim=!1,this.rtrim=!1,this.trim=!1,this.headers=null,this.renameHeaders=!1,this.strictColumnHandling=!1,this.discardUnmappedColumns=!1,this.carriageReturn="\r",this.encoding="utf8",this.limitRows=!1,this.maxRows=0,this.skipLines=0,this.skipRows=0,Object.assign(this,t||{}),this.delimiter.length>1)throw new Error("delimiter option must be one character long");this.escapedDelimiter=s.default(this.delimiter),this.escapeChar=null!==(e=this.escape)&&void 0!==e?e:this.quote,this.supportsComments=!r.default(this.comment),this.NEXT_TOKEN_REGEXP=new RegExp(`([^\\s]|\\r\\n|\\n|\\r|${this.escapedDelimiter})`),this.maxRows>0&&(this.limitRows=!0)}}},{"lodash.escaperegexp":442,"lodash.isnil":447}],155:[function(t,e,i){var n=Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]},s=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return s(e,t),e},o=function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.parseString=i.parseFile=i.parseStream=i.parse=i.ParserOptions=i.CsvParserStream=void 0;const a=r(t("fs")),h=t("stream"),c=t("./ParserOptions"),u=t("./CsvParserStream");o(t("./types"),i);var l=t("./CsvParserStream");Object.defineProperty(i,"CsvParserStream",{enumerable:!0,get:function(){return l.CsvParserStream}});var f=t("./ParserOptions");Object.defineProperty(i,"ParserOptions",{enumerable:!0,get:function(){return f.ParserOptions}}),i.parse=t=>new u.CsvParserStream(new c.ParserOptions(t)),i.parseStream=(t,e)=>t.pipe(new u.CsvParserStream(new c.ParserOptions(e))),i.parseFile=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.createReadStream(t).pipe(new u.CsvParserStream(new c.ParserOptions(e)))},i.parseString=(t,e)=>{const i=new h.Readable;return i.push(t),i.push(null),i.pipe(new u.CsvParserStream(new c.ParserOptions(e)))}},{"./CsvParserStream":153,"./ParserOptions":154,"./types":169,fs:216,stream:505}],156:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Parser=void 0;const n=t("./Scanner"),s=t("./RowParser"),r=t("./Token");class o{constructor(t){this.parserOptions=t,this.rowParser=new s.RowParser(this.parserOptions)}static removeBOM(t){return t&&65279===t.charCodeAt(0)?t.slice(1):t}parse(t,e){const i=new n.Scanner({line:o.removeBOM(t),parserOptions:this.parserOptions,hasMoreData:e});return this.parserOptions.supportsComments?this.parseWithComments(i):this.parseWithoutComments(i)}parseWithoutComments(t){const e=[];let i=!0;for(;i;)i=this.parseRow(t,e);return{line:t.line,rows:e}}parseWithComments(t){const{parserOptions:e}=this,i=[];for(let n=t.nextCharacterToken;null!==n;n=t.nextCharacterToken)if(r.Token.isTokenComment(n,e)){if(null===t.advancePastLine())return{line:t.lineFromCursor,rows:i};if(!t.hasMoreCharacters)return{line:t.lineFromCursor,rows:i};t.truncateToCursor()}else if(!this.parseRow(t,i))break;return{line:t.line,rows:i}}parseRow(t,e){if(!t.nextNonSpaceToken)return!1;const i=this.rowParser.parse(t);return null!==i&&(this.parserOptions.ignoreEmpty&&s.RowParser.isEmptyRow(i)||e.push(i),!0)}}i.Parser=o},{"./RowParser":157,"./Scanner":158,"./Token":159}],157:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.RowParser=void 0;const n=t("./column"),s=t("./Token");i.RowParser=class{constructor(t){this.parserOptions=t,this.columnParser=new n.ColumnParser(t)}static isEmptyRow(t){return""===t.join("").replace(/\s+/g,"")}parse(t){const{parserOptions:e}=this,{hasMoreData:i}=t,n=t,r=[];let o=this.getStartToken(n,r);for(;o;){if(s.Token.isTokenRowDelimiter(o))return n.advancePastToken(o),!n.hasMoreCharacters&&s.Token.isTokenCarriageReturn(o,e)&&i?null:(n.truncateToCursor(),r);if(!this.shouldSkipColumnParse(n,o,r)){const t=this.columnParser.parse(n);if(null===t)return null;r.push(t)}o=n.nextNonSpaceToken}return i?null:(n.truncateToCursor(),r)}getStartToken(t,e){const i=t.nextNonSpaceToken;return null!==i&&s.Token.isTokenDelimiter(i,this.parserOptions)?(e.push(""),t.nextNonSpaceToken):i}shouldSkipColumnParse(t,e,i){const{parserOptions:n}=this;if(s.Token.isTokenDelimiter(e,n)){t.advancePastToken(e);const r=t.nextCharacterToken;if(!t.hasMoreCharacters||null!==r&&s.Token.isTokenRowDelimiter(r))return i.push(""),!0;if(null!==r&&s.Token.isTokenDelimiter(r,n))return i.push(""),!0}return!1}}},{"./Token":159,"./column":164}],158:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Scanner=void 0;const n=t("./Token"),s=/((?:\r\n)|\n|\r)/;i.Scanner=class{constructor(t){this.cursor=0,this.line=t.line,this.lineLength=this.line.length,this.parserOptions=t.parserOptions,this.hasMoreData=t.hasMoreData,this.cursor=t.cursor||0}get hasMoreCharacters(){return this.lineLength>this.cursor}get nextNonSpaceToken(){const{lineFromCursor:t}=this,e=this.parserOptions.NEXT_TOKEN_REGEXP;if(-1===t.search(e))return null;const i=e.exec(t);if(null==i)return null;const s=i[1],r=this.cursor+(i.index||0);return new n.Token({token:s,startCursor:r,endCursor:r+s.length-1})}get nextCharacterToken(){const{cursor:t,lineLength:e}=this;return e<=t?null:new n.Token({token:this.line[t],startCursor:t,endCursor:t})}get lineFromCursor(){return this.line.substr(this.cursor)}advancePastLine(){const t=s.exec(this.lineFromCursor);return t?(this.cursor+=(t.index||0)+t[0].length,this):this.hasMoreData?null:(this.cursor=this.lineLength,this)}advanceTo(t){return this.cursor=t,this}advanceToToken(t){return this.cursor=t.startCursor,this}advancePastToken(t){return this.cursor=t.endCursor+1,this}truncateToCursor(){return this.line=this.lineFromCursor,this.lineLength=this.line.length,this.cursor=0,this}}},{"./Token":159}],159:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Token=void 0;i.Token=class{constructor(t){this.token=t.token,this.startCursor=t.startCursor,this.endCursor=t.endCursor}static isTokenRowDelimiter(t){const e=t.token;return"\r"===e||"\n"===e||"\r\n"===e}static isTokenCarriageReturn(t,e){return t.token===e.carriageReturn}static isTokenComment(t,e){return e.supportsComments&&!!t&&t.token===e.comment}static isTokenEscapeCharacter(t,e){return t.token===e.escapeChar}static isTokenQuote(t,e){return t.token===e.quote}static isTokenDelimiter(t,e){return t.token===e.delimiter}}},{}],160:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ColumnFormatter=void 0;i.ColumnFormatter=class{constructor(t){t.trim?this.format=t=>t.trim():t.ltrim?this.format=t=>t.trimLeft():t.rtrim?this.format=t=>t.trimRight():this.format=t=>t}}},{}],161:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ColumnParser=void 0;const n=t("./NonQuotedColumnParser"),s=t("./QuotedColumnParser"),r=t("../Token");i.ColumnParser=class{constructor(t){this.parserOptions=t,this.quotedColumnParser=new s.QuotedColumnParser(t),this.nonQuotedColumnParser=new n.NonQuotedColumnParser(t)}parse(t){const{nextNonSpaceToken:e}=t;return null!==e&&r.Token.isTokenQuote(e,this.parserOptions)?(t.advanceToToken(e),this.quotedColumnParser.parse(t)):this.nonQuotedColumnParser.parse(t)}}},{"../Token":159,"./NonQuotedColumnParser":162,"./QuotedColumnParser":163}],162:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.NonQuotedColumnParser=void 0;const n=t("./ColumnFormatter"),s=t("../Token");i.NonQuotedColumnParser=class{constructor(t){this.parserOptions=t,this.columnFormatter=new n.ColumnFormatter(t)}parse(t){if(!t.hasMoreCharacters)return null;const{parserOptions:e}=this,i=[];let n=t.nextCharacterToken;for(;n&&(!s.Token.isTokenDelimiter(n,e)&&!s.Token.isTokenRowDelimiter(n));n=t.nextCharacterToken)i.push(n.token),t.advancePastToken(n);return this.columnFormatter.format(i.join(""))}}},{"../Token":159,"./ColumnFormatter":160}],163:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.QuotedColumnParser=void 0;const n=t("./ColumnFormatter"),s=t("../Token");i.QuotedColumnParser=class{constructor(t){this.parserOptions=t,this.columnFormatter=new n.ColumnFormatter(t)}parse(t){if(!t.hasMoreCharacters)return null;const e=t.cursor,{foundClosingQuote:i,col:n}=this.gatherDataBetweenQuotes(t);if(!i){if(t.advanceTo(e),!t.hasMoreData)throw new Error(`Parse Error: missing closing: '${this.parserOptions.quote||""}' in line: at '${t.lineFromCursor.replace(/[\r\n]/g,"\\n'")}'`);return null}return this.checkForMalformedColumn(t),n}gatherDataBetweenQuotes(t){const{parserOptions:e}=this;let i=!1,n=!1;const r=[];let o=t.nextCharacterToken;for(;!n&&null!==o;o=t.nextCharacterToken){const a=s.Token.isTokenQuote(o,e);if(!i&&a)i=!0;else if(i)if(s.Token.isTokenEscapeCharacter(o,e)){t.advancePastToken(o);const i=t.nextCharacterToken;null!==i&&(s.Token.isTokenQuote(i,e)||s.Token.isTokenEscapeCharacter(i,e))?(r.push(i.token),o=i):a?n=!0:r.push(o.token)}else a?n=!0:r.push(o.token);t.advancePastToken(o)}return{col:this.columnFormatter.format(r.join("")),foundClosingQuote:n}}checkForMalformedColumn(t){const{parserOptions:e}=this,{nextNonSpaceToken:i}=t;if(i){const n=s.Token.isTokenDelimiter(i,e),r=s.Token.isTokenRowDelimiter(i);if(!n&&!r){const n=t.lineFromCursor.substr(0,10).replace(/[\r\n]/g,"\\n'");throw new Error(`Parse Error: expected: '${e.escapedDelimiter}' OR new line got: '${i.token}'. at '${n}`)}t.advanceToToken(i)}else t.hasMoreData||t.advancePastLine()}}},{"../Token":159,"./ColumnFormatter":160}],164:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ColumnFormatter=i.QuotedColumnParser=i.NonQuotedColumnParser=i.ColumnParser=void 0;var n=t("./ColumnParser");Object.defineProperty(i,"ColumnParser",{enumerable:!0,get:function(){return n.ColumnParser}});var s=t("./NonQuotedColumnParser");Object.defineProperty(i,"NonQuotedColumnParser",{enumerable:!0,get:function(){return s.NonQuotedColumnParser}});var r=t("./QuotedColumnParser");Object.defineProperty(i,"QuotedColumnParser",{enumerable:!0,get:function(){return r.QuotedColumnParser}});var o=t("./ColumnFormatter");Object.defineProperty(i,"ColumnFormatter",{enumerable:!0,get:function(){return o.ColumnFormatter}})},{"./ColumnFormatter":160,"./ColumnParser":161,"./NonQuotedColumnParser":162,"./QuotedColumnParser":163}],165:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.QuotedColumnParser=i.NonQuotedColumnParser=i.ColumnParser=i.Token=i.Scanner=i.RowParser=i.Parser=void 0;var n=t("./Parser");Object.defineProperty(i,"Parser",{enumerable:!0,get:function(){return n.Parser}});var s=t("./RowParser");Object.defineProperty(i,"RowParser",{enumerable:!0,get:function(){return s.RowParser}});var r=t("./Scanner");Object.defineProperty(i,"Scanner",{enumerable:!0,get:function(){return r.Scanner}});var o=t("./Token");Object.defineProperty(i,"Token",{enumerable:!0,get:function(){return o.Token}});var a=t("./column");Object.defineProperty(i,"ColumnParser",{enumerable:!0,get:function(){return a.ColumnParser}}),Object.defineProperty(i,"NonQuotedColumnParser",{enumerable:!0,get:function(){return a.NonQuotedColumnParser}}),Object.defineProperty(i,"QuotedColumnParser",{enumerable:!0,get:function(){return a.QuotedColumnParser}})},{"./Parser":156,"./RowParser":157,"./Scanner":158,"./Token":159,"./column":164}],166:[function(t,e,i){var n=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.HeaderTransformer=void 0;const s=n(t("lodash.isundefined")),r=n(t("lodash.isfunction")),o=n(t("lodash.uniq")),a=n(t("lodash.groupby"));i.HeaderTransformer=class{constructor(t){this.headers=null,this.receivedHeaders=!1,this.shouldUseFirstRow=!1,this.processedFirstRow=!1,this.headersLength=0,this.parserOptions=t,!0===t.headers?this.shouldUseFirstRow=!0:Array.isArray(t.headers)?this.setHeaders(t.headers):r.default(t.headers)&&(this.headersTransform=t.headers)}transform(t,e){return this.shouldMapRow(t)?e(null,this.processRow(t)):e(null,{row:null,isValid:!0})}shouldMapRow(t){const{parserOptions:e}=this;if(!this.headersTransform&&e.renameHeaders&&!this.processedFirstRow){if(!this.receivedHeaders)throw new Error("Error renaming headers: new headers must be provided in an array");return this.processedFirstRow=!0,!1}if(!this.receivedHeaders&&Array.isArray(t)){if(this.headersTransform)this.setHeaders(this.headersTransform(t));else{if(!this.shouldUseFirstRow)return!0;this.setHeaders(t)}return!1}return!0}processRow(t){if(!this.headers)return{row:t,isValid:!0};const{parserOptions:e}=this;if(!e.discardUnmappedColumns&&t.length>this.headersLength){if(!e.strictColumnHandling)throw new Error(`Unexpected Error: column header mismatch expected: ${this.headersLength} columns got: ${t.length}`);return{row:t,isValid:!1,reason:`Column header mismatch expected: ${this.headersLength} columns got: ${t.length}`}}return e.strictColumnHandling&&t.length<this.headersLength?{row:t,isValid:!1,reason:`Column header mismatch expected: ${this.headersLength} columns got: ${t.length}`}:{row:this.mapHeaders(t),isValid:!0}}mapHeaders(t){const e={},{headers:i,headersLength:n}=this;for(let r=0;r<n;r+=1){const n=i[r];if(!s.default(n)){const i=t[r];s.default(i)?e[n]="":e[n]=i}}return e}setHeaders(t){var e;const i=t.filter((t=>!!t));if(o.default(i).length!==i.length){const t=a.default(i),e=Object.keys(t).filter((e=>t[e].length>1));throw new Error("Duplicate headers found "+JSON.stringify(e))}this.headers=t,this.receivedHeaders=!0,this.headersLength=(null===(e=this.headers)||void 0===e?void 0:e.length)||0}}},{"lodash.groupby":443,"lodash.isfunction":446,"lodash.isundefined":448,"lodash.uniq":449}],167:[function(t,e,i){var n=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(i,"__esModule",{value:!0}),i.RowTransformerValidator=void 0;const s=n(t("lodash.isfunction")),r=t("../types");class o{constructor(){this._rowTransform=null,this._rowValidator=null}static createTransform(t){return r.isSyncTransform(t)?(e,i)=>{let n=null;try{n=t(e)}catch(t){return i(t)}return i(null,n)}:t}static createValidator(t){return r.isSyncValidate(t)?(e,i)=>{i(null,{row:e,isValid:t(e)})}:(e,i)=>{t(e,((t,n,s)=>t?i(t):i(null,n?{row:e,isValid:n,reason:s}:{row:e,isValid:!1,reason:s})))}}set rowTransform(t){if(!s.default(t))throw new TypeError("The transform should be a function");this._rowTransform=o.createTransform(t)}set rowValidator(t){if(!s.default(t))throw new TypeError("The validate should be a function");this._rowValidator=o.createValidator(t)}transformAndValidate(t,e){return this.callTransformer(t,((t,i)=>t?e(t):i?this.callValidator(i,((t,n)=>t?e(t):n&&!n.isValid?e(null,{row:i,isValid:!1,reason:n.reason}):e(null,{row:i,isValid:!0}))):e(null,{row:null,isValid:!0})))}callTransformer(t,e){return this._rowTransform?this._rowTransform(t,e):e(null,t)}callValidator(t,e){return this._rowValidator?this._rowValidator(t,e):e(null,{row:t,isValid:!0})}}i.RowTransformerValidator=o},{"../types":169,"lodash.isfunction":446}],168:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.HeaderTransformer=i.RowTransformerValidator=void 0;var n=t("./RowTransformerValidator");Object.defineProperty(i,"RowTransformerValidator",{enumerable:!0,get:function(){return n.RowTransformerValidator}});var s=t("./HeaderTransformer");Object.defineProperty(i,"HeaderTransformer",{enumerable:!0,get:function(){return s.HeaderTransformer}})},{"./HeaderTransformer":166,"./RowTransformerValidator":167}],169:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isSyncValidate=i.isSyncTransform=void 0,i.isSyncTransform=t=>1===t.length,i.isSyncValidate=t=>1===t.length},{}],170:[function(t,e,i){const n=i;n.bignum=t("bn.js"),n.define=t("./asn1/api").define,n.base=t("./asn1/base"),n.constants=t("./asn1/constants"),n.decoders=t("./asn1/decoders"),n.encoders=t("./asn1/encoders")},{"./asn1/api":171,"./asn1/base":173,"./asn1/constants":177,"./asn1/decoders":179,"./asn1/encoders":182,"bn.js":184}],171:[function(t,e,i){const n=t("./encoders"),s=t("./decoders"),r=t("inherits");function o(t,e){this.name=t,this.body=e,this.decoders={},this.encoders={}}i.define=function(t,e){return new o(t,e)},o.prototype._createNamed=function(t){const e=this.name;function i(t){this._initNamed(t,e)}return r(i,t),i.prototype._initNamed=function(e,i){t.call(this,e,i)},new i(this)},o.prototype._getDecoder=function(t){return t=t||"der",this.decoders.hasOwnProperty(t)||(this.decoders[t]=this._createNamed(s[t])),this.decoders[t]},o.prototype.decode=function(t,e,i){return this._getDecoder(e).decode(t,i)},o.prototype._getEncoder=function(t){return t=t||"der",this.encoders.hasOwnProperty(t)||(this.encoders[t]=this._createNamed(n[t])),this.encoders[t]},o.prototype.encode=function(t,e,i){return this._getEncoder(e).encode(t,i)}},{"./decoders":179,"./encoders":182,inherits:440}],172:[function(t,e,i){const n=t("inherits"),s=t("../base/reporter").Reporter,r=t("safer-buffer").Buffer;function o(t,e){s.call(this,e),r.isBuffer(t)?(this.base=t,this.offset=0,this.length=t.length):this.error("Input not Buffer")}function a(t,e){if(Array.isArray(t))this.length=0,this.value=t.map((function(t){return a.isEncoderBuffer(t)||(t=new a(t,e)),this.length+=t.length,t}),this);else if("number"==typeof t){if(!(0<=t&&t<=255))return e.error("non-byte EncoderBuffer value");this.value=t,this.length=1}else if("string"==typeof t)this.value=t,this.length=r.byteLength(t);else{if(!r.isBuffer(t))return e.error("Unsupported type: "+typeof t);this.value=t,this.length=t.length}}n(o,s),i.DecoderBuffer=o,o.isDecoderBuffer=function(t){if(t instanceof o)return!0;return"object"==typeof t&&r.isBuffer(t.base)&&"DecoderBuffer"===t.constructor.name&&"number"==typeof t.offset&&"number"==typeof t.length&&"function"==typeof t.save&&"function"==typeof t.restore&&"function"==typeof t.isEmpty&&"function"==typeof t.readUInt8&&"function"==typeof t.skip&&"function"==typeof t.raw},o.prototype.save=function(){return{offset:this.offset,reporter:s.prototype.save.call(this)}},o.prototype.restore=function(t){const e=new o(this.base);return e.offset=t.offset,e.length=this.offset,this.offset=t.offset,s.prototype.restore.call(this,t.reporter),e},o.prototype.isEmpty=function(){return this.offset===this.length},o.prototype.readUInt8=function(t){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(t||"DecoderBuffer overrun")},o.prototype.skip=function(t,e){if(!(this.offset+t<=this.length))return this.error(e||"DecoderBuffer overrun");const i=new o(this.base);return i._reporterState=this._reporterState,i.offset=this.offset,i.length=this.offset+t,this.offset+=t,i},o.prototype.raw=function(t){return this.base.slice(t?t.offset:this.offset,this.length)},i.EncoderBuffer=a,a.isEncoderBuffer=function(t){if(t instanceof a)return!0;return"object"==typeof t&&"EncoderBuffer"===t.constructor.name&&"number"==typeof t.length&&"function"==typeof t.join},a.prototype.join=function(t,e){return t||(t=r.alloc(this.length)),e||(e=0),0===this.length||(Array.isArray(this.value)?this.value.forEach((function(i){i.join(t,e),e+=i.length})):("number"==typeof this.value?t[e]=this.value:"string"==typeof this.value?t.write(this.value,e):r.isBuffer(this.value)&&this.value.copy(t,e),e+=this.length)),t}},{"../base/reporter":175,inherits:440,"safer-buffer":495}],173:[function(t,e,i){const n=i;n.Reporter=t("./reporter").Reporter,n.DecoderBuffer=t("./buffer").DecoderBuffer,n.EncoderBuffer=t("./buffer").EncoderBuffer,n.Node=t("./node")},{"./buffer":172,"./node":174,"./reporter":175}],174:[function(t,e,i){const n=t("../base/reporter").Reporter,s=t("../base/buffer").EncoderBuffer,r=t("../base/buffer").DecoderBuffer,o=t("minimalistic-assert"),a=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],h=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(a);function c(t,e,i){const n={};this._baseState=n,n.name=i,n.enc=t,n.parent=e||null,n.children=null,n.tag=null,n.args=null,n.reverseArgs=null,n.choice=null,n.optional=!1,n.any=!1,n.obj=!1,n.use=null,n.useDecoder=null,n.key=null,n.default=null,n.explicit=null,n.implicit=null,n.contains=null,n.parent||(n.children=[],this._wrap())}e.exports=c;const u=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];c.prototype.clone=function(){const t=this._baseState,e={};u.forEach((function(i){e[i]=t[i]}));const i=new this.constructor(e.parent);return i._baseState=e,i},c.prototype._wrap=function(){const t=this._baseState;h.forEach((function(e){this[e]=function(){const i=new this.constructor(this);return t.children.push(i),i[e].apply(i,arguments)}}),this)},c.prototype._init=function(t){const e=this._baseState;o(null===e.parent),t.call(this),e.children=e.children.filter((function(t){return t._baseState.parent===this}),this),o.equal(e.children.length,1,"Root node can have only one child")},c.prototype._useArgs=function(t){const e=this._baseState,i=t.filter((function(t){return t instanceof this.constructor}),this);t=t.filter((function(t){return!(t instanceof this.constructor)}),this),0!==i.length&&(o(null===e.children),e.children=i,i.forEach((function(t){t._baseState.parent=this}),this)),0!==t.length&&(o(null===e.args),e.args=t,e.reverseArgs=t.map((function(t){if("object"!=typeof t||t.constructor!==Object)return t;const e={};return Object.keys(t).forEach((function(i){i==(0|i)&&(i|=0);const n=t[i];e[n]=i})),e})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(t){c.prototype[t]=function(){const e=this._baseState;throw new Error(t+" not implemented for encoding: "+e.enc)}})),a.forEach((function(t){c.prototype[t]=function(){const e=this._baseState,i=Array.prototype.slice.call(arguments);return o(null===e.tag),e.tag=t,this._useArgs(i),this}})),c.prototype.use=function(t){o(t);const e=this._baseState;return o(null===e.use),e.use=t,this},c.prototype.optional=function(){return this._baseState.optional=!0,this},c.prototype.def=function(t){const e=this._baseState;return o(null===e.default),e.default=t,e.optional=!0,this},c.prototype.explicit=function(t){const e=this._baseState;return o(null===e.explicit&&null===e.implicit),e.explicit=t,this},c.prototype.implicit=function(t){const e=this._baseState;return o(null===e.explicit&&null===e.implicit),e.implicit=t,this},c.prototype.obj=function(){const t=this._baseState,e=Array.prototype.slice.call(arguments);return t.obj=!0,0!==e.length&&this._useArgs(e),this},c.prototype.key=function(t){const e=this._baseState;return o(null===e.key),e.key=t,this},c.prototype.any=function(){return this._baseState.any=!0,this},c.prototype.choice=function(t){const e=this._baseState;return o(null===e.choice),e.choice=t,this._useArgs(Object.keys(t).map((function(e){return t[e]}))),this},c.prototype.contains=function(t){const e=this._baseState;return o(null===e.use),e.contains=t,this},c.prototype._decode=function(t,e){const i=this._baseState;if(null===i.parent)return t.wrapResult(i.children[0]._decode(t,e));let n,s=i.default,o=!0,a=null;if(null!==i.key&&(a=t.enterKey(i.key)),i.optional){let n=null;if(null!==i.explicit?n=i.explicit:null!==i.implicit?n=i.implicit:null!==i.tag&&(n=i.tag),null!==n||i.any){if(o=this._peekTag(t,n,i.any),t.isError(o))return o}else{const n=t.save();try{null===i.choice?this._decodeGeneric(i.tag,t,e):this._decodeChoice(t,e),o=!0}catch(t){o=!1}t.restore(n)}}if(i.obj&&o&&(n=t.enterObject()),o){if(null!==i.explicit){const e=this._decodeTag(t,i.explicit);if(t.isError(e))return e;t=e}const n=t.offset;if(null===i.use&&null===i.choice){let e;i.any&&(e=t.save());const n=this._decodeTag(t,null!==i.implicit?i.implicit:i.tag,i.any);if(t.isError(n))return n;i.any?s=t.raw(e):t=n}if(e&&e.track&&null!==i.tag&&e.track(t.path(),n,t.length,"tagged"),e&&e.track&&null!==i.tag&&e.track(t.path(),t.offset,t.length,"content"),i.any||(s=null===i.choice?this._decodeGeneric(i.tag,t,e):this._decodeChoice(t,e)),t.isError(s))return s;if(i.any||null!==i.choice||null===i.children||i.children.forEach((function(i){i._decode(t,e)})),i.contains&&("octstr"===i.tag||"bitstr"===i.tag)){const n=new r(s);s=this._getUse(i.contains,t._reporterState.obj)._decode(n,e)}}return i.obj&&o&&(s=t.leaveObject(n)),null===i.key||null===s&&!0!==o?null!==a&&t.exitKey(a):t.leaveKey(a,i.key,s),s},c.prototype._decodeGeneric=function(t,e,i){const n=this._baseState;return"seq"===t||"set"===t?null:"seqof"===t||"setof"===t?this._decodeList(e,t,n.args[0],i):/str$/.test(t)?this._decodeStr(e,t,i):"objid"===t&&n.args?this._decodeObjid(e,n.args[0],n.args[1],i):"objid"===t?this._decodeObjid(e,null,null,i):"gentime"===t||"utctime"===t?this._decodeTime(e,t,i):"null_"===t?this._decodeNull(e,i):"bool"===t?this._decodeBool(e,i):"objDesc"===t?this._decodeStr(e,t,i):"int"===t||"enum"===t?this._decodeInt(e,n.args&&n.args[0],i):null!==n.use?this._getUse(n.use,e._reporterState.obj)._decode(e,i):e.error("unknown tag: "+t)},c.prototype._getUse=function(t,e){const i=this._baseState;return i.useDecoder=this._use(t,e),o(null===i.useDecoder._baseState.parent),i.useDecoder=i.useDecoder._baseState.children[0],i.implicit!==i.useDecoder._baseState.implicit&&(i.useDecoder=i.useDecoder.clone(),i.useDecoder._baseState.implicit=i.implicit),i.useDecoder},c.prototype._decodeChoice=function(t,e){const i=this._baseState;let n=null,s=!1;return Object.keys(i.choice).some((function(r){const o=t.save(),a=i.choice[r];try{const i=a._decode(t,e);if(t.isError(i))return!1;n={type:r,value:i},s=!0}catch(e){return t.restore(o),!1}return!0}),this),s?n:t.error("Choice not matched")},c.prototype._createEncoderBuffer=function(t){return new s(t,this.reporter)},c.prototype._encode=function(t,e,i){const n=this._baseState;if(null!==n.default&&n.default===t)return;const s=this._encodeValue(t,e,i);return void 0===s||this._skipDefault(s,e,i)?void 0:s},c.prototype._encodeValue=function(t,e,i){const s=this._baseState;if(null===s.parent)return s.children[0]._encode(t,e||new n);let r=null;if(this.reporter=e,s.optional&&void 0===t){if(null===s.default)return;t=s.default}let o=null,a=!1;if(s.any)r=this._createEncoderBuffer(t);else if(s.choice)r=this._encodeChoice(t,e);else if(s.contains)o=this._getUse(s.contains,i)._encode(t,e),a=!0;else if(s.children)o=s.children.map((function(i){if("null_"===i._baseState.tag)return i._encode(null,e,t);if(null===i._baseState.key)return e.error("Child should have a key");const n=e.enterKey(i._baseState.key);if("object"!=typeof t)return e.error("Child expected, but input is not object");const s=i._encode(t[i._baseState.key],e,t);return e.leaveKey(n),s}),this).filter((function(t){return t})),o=this._createEncoderBuffer(o);else if("seqof"===s.tag||"setof"===s.tag){if(!s.args||1!==s.args.length)return e.error("Too many args for : "+s.tag);if(!Array.isArray(t))return e.error("seqof/setof, but data is not Array");const i=this.clone();i._baseState.implicit=null,o=this._createEncoderBuffer(t.map((function(i){const n=this._baseState;return this._getUse(n.args[0],t)._encode(i,e)}),i))}else null!==s.use?r=this._getUse(s.use,i)._encode(t,e):(o=this._encodePrimitive(s.tag,t),a=!0);if(!s.any&&null===s.choice){const t=null!==s.implicit?s.implicit:s.tag,i=null===s.implicit?"universal":"context";null===t?null===s.use&&e.error("Tag could be omitted only for .use()"):null===s.use&&(r=this._encodeComposite(t,a,i,o))}return null!==s.explicit&&(r=this._encodeComposite(s.explicit,!1,"context",r)),r},c.prototype._encodeChoice=function(t,e){const i=this._baseState,n=i.choice[t.type];return n||o(!1,t.type+" not found in "+JSON.stringify(Object.keys(i.choice))),n._encode(t.value,e)},c.prototype._encodePrimitive=function(t,e){const i=this._baseState;if(/str$/.test(t))return this._encodeStr(e,t);if("objid"===t&&i.args)return this._encodeObjid(e,i.reverseArgs[0],i.args[1]);if("objid"===t)return this._encodeObjid(e,null,null);if("gentime"===t||"utctime"===t)return this._encodeTime(e,t);if("null_"===t)return this._encodeNull();if("int"===t||"enum"===t)return this._encodeInt(e,i.args&&i.reverseArgs[0]);if("bool"===t)return this._encodeBool(e);if("objDesc"===t)return this._encodeStr(e,t);throw new Error("Unsupported tag: "+t)},c.prototype._isNumstr=function(t){return/^[0-9 ]*$/.test(t)},c.prototype._isPrintstr=function(t){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(t)}},{"../base/buffer":172,"../base/reporter":175,"minimalistic-assert":453}],175:[function(t,e,i){const n=t("inherits");function s(t){this._reporterState={obj:null,path:[],options:t||{},errors:[]}}function r(t,e){this.path=t,this.rethrow(e)}i.Reporter=s,s.prototype.isError=function(t){return t instanceof r},s.prototype.save=function(){const t=this._reporterState;return{obj:t.obj,pathLen:t.path.length}},s.prototype.restore=function(t){const e=this._reporterState;e.obj=t.obj,e.path=e.path.slice(0,t.pathLen)},s.prototype.enterKey=function(t){return this._reporterState.path.push(t)},s.prototype.exitKey=function(t){const e=this._reporterState;e.path=e.path.slice(0,t-1)},s.prototype.leaveKey=function(t,e,i){const n=this._reporterState;this.exitKey(t),null!==n.obj&&(n.obj[e]=i)},s.prototype.path=function(){return this._reporterState.path.join("/")},s.prototype.enterObject=function(){const t=this._reporterState,e=t.obj;return t.obj={},e},s.prototype.leaveObject=function(t){const e=this._reporterState,i=e.obj;return e.obj=t,i},s.prototype.error=function(t){let e;const i=this._reporterState,n=t instanceof r;if(e=n?t:new r(i.path.map((function(t){return"["+JSON.stringify(t)+"]"})).join(""),t.message||t,t.stack),!i.options.partial)throw e;return n||i.errors.push(e),e},s.prototype.wrapResult=function(t){const e=this._reporterState;return e.options.partial?{result:this.isError(t)?null:t,errors:e.errors}:t},n(r,Error),r.prototype.rethrow=function(t){if(this.message=t+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,r),!this.stack)try{throw new Error(this.message)}catch(t){this.stack=t.stack}return this}},{inherits:440}],176:[function(t,e,i){function n(t){const e={};return Object.keys(t).forEach((function(i){(0|i)==i&&(i|=0);const n=t[i];e[n]=i})),e}i.tagClass={0:"universal",1:"application",2:"context",3:"private"},i.tagClassByName=n(i.tagClass),i.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},i.tagByName=n(i.tag)},{}],177:[function(t,e,i){const n=i;n._reverse=function(t){const e={};return Object.keys(t).forEach((function(i){(0|i)==i&&(i|=0);const n=t[i];e[n]=i})),e},n.der=t("./der")},{"./der":176}],178:[function(t,e,i){const n=t("inherits"),s=t("bn.js"),r=t("../base/buffer").DecoderBuffer,o=t("../base/node"),a=t("../constants/der");function h(t){this.enc="der",this.name=t.name,this.entity=t,this.tree=new c,this.tree._init(t.body)}function c(t){o.call(this,"der",t)}function u(t,e){let i=t.readUInt8(e);if(t.isError(i))return i;const n=a.tagClass[i>>6],s=0==(32&i);if(31==(31&i)){let n=i;for(i=0;128==(128&n);){if(n=t.readUInt8(e),t.isError(n))return n;i<<=7,i|=127&n}}else i&=31;return{cls:n,primitive:s,tag:i,tagStr:a.tag[i]}}function l(t,e,i){let n=t.readUInt8(i);if(t.isError(n))return n;if(!e&&128===n)return null;if(0==(128&n))return n;const s=127&n;if(s>4)return t.error("length octect is too long");n=0;for(let e=0;e<s;e++){n<<=8;const e=t.readUInt8(i);if(t.isError(e))return e;n|=e}return n}e.exports=h,h.prototype.decode=function(t,e){return r.isDecoderBuffer(t)||(t=new r(t,e)),this.tree._decode(t,e)},n(c,o),c.prototype._peekTag=function(t,e,i){if(t.isEmpty())return!1;const n=t.save(),s=u(t,'Failed to peek tag: "'+e+'"');return t.isError(s)?s:(t.restore(n),s.tag===e||s.tagStr===e||s.tagStr+"of"===e||i)},c.prototype._decodeTag=function(t,e,i){const n=u(t,'Failed to decode tag of "'+e+'"');if(t.isError(n))return n;let s=l(t,n.primitive,'Failed to get length of "'+e+'"');if(t.isError(s))return s;if(!i&&n.tag!==e&&n.tagStr!==e&&n.tagStr+"of"!==e)return t.error('Failed to match tag: "'+e+'"');if(n.primitive||null!==s)return t.skip(s,'Failed to match body of: "'+e+'"');const r=t.save(),o=this._skipUntilEnd(t,'Failed to skip indefinite length body: "'+this.tag+'"');return t.isError(o)?o:(s=t.offset-r.offset,t.restore(r),t.skip(s,'Failed to match body of: "'+e+'"'))},c.prototype._skipUntilEnd=function(t,e){for(;;){const i=u(t,e);if(t.isError(i))return i;const n=l(t,i.primitive,e);if(t.isError(n))return n;let s;if(s=i.primitive||null!==n?t.skip(n):this._skipUntilEnd(t,e),t.isError(s))return s;if("end"===i.tagStr)break}},c.prototype._decodeList=function(t,e,i,n){const s=[];for(;!t.isEmpty();){const e=this._peekTag(t,"end");if(t.isError(e))return e;const r=i.decode(t,"der",n);if(t.isError(r)&&e)break;s.push(r)}return s},c.prototype._decodeStr=function(t,e){if("bitstr"===e){const e=t.readUInt8();return t.isError(e)?e:{unused:e,data:t.raw()}}if("bmpstr"===e){const e=t.raw();if(e.length%2==1)return t.error("Decoding of string type: bmpstr length mismatch");let i="";for(let t=0;t<e.length/2;t++)i+=String.fromCharCode(e.readUInt16BE(2*t));return i}if("numstr"===e){const e=t.raw().toString("ascii");return this._isNumstr(e)?e:t.error("Decoding of string type: numstr unsupported characters")}if("octstr"===e)return t.raw();if("objDesc"===e)return t.raw();if("printstr"===e){const e=t.raw().toString("ascii");return this._isPrintstr(e)?e:t.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(e)?t.raw().toString():t.error("Decoding of string type: "+e+" unsupported")},c.prototype._decodeObjid=function(t,e,i){let n;const s=[];let r=0,o=0;for(;!t.isEmpty();)o=t.readUInt8(),r<<=7,r|=127&o,0==(128&o)&&(s.push(r),r=0);128&o&&s.push(r);const a=s[0]/40|0,h=s[0]%40;if(n=i?s:[a,h].concat(s.slice(1)),e){let t=e[n.join(" ")];void 0===t&&(t=e[n.join(".")]),void 0!==t&&(n=t)}return n},c.prototype._decodeTime=function(t,e){const i=t.raw().toString();let n,s,r,o,a,h;if("gentime"===e)n=0|i.slice(0,4),s=0|i.slice(4,6),r=0|i.slice(6,8),o=0|i.slice(8,10),a=0|i.slice(10,12),h=0|i.slice(12,14);else{if("utctime"!==e)return t.error("Decoding "+e+" time is not supported yet");n=0|i.slice(0,2),s=0|i.slice(2,4),r=0|i.slice(4,6),o=0|i.slice(6,8),a=0|i.slice(8,10),h=0|i.slice(10,12),n=n<70?2e3+n:1900+n}return Date.UTC(n,s-1,r,o,a,h,0)},c.prototype._decodeNull=function(){return null},c.prototype._decodeBool=function(t){const e=t.readUInt8();return t.isError(e)?e:0!==e},c.prototype._decodeInt=function(t,e){const i=t.raw();let n=new s(i);return e&&(n=e[n.toString(10)]||n),n},c.prototype._use=function(t,e){return"function"==typeof t&&(t=t(e)),t._getDecoder("der").tree}},{"../base/buffer":172,"../base/node":174,"../constants/der":176,"bn.js":184,inherits:440}],179:[function(t,e,i){const n=i;n.der=t("./der"),n.pem=t("./pem")},{"./der":178,"./pem":180}],180:[function(t,e,i){const n=t("inherits"),s=t("safer-buffer").Buffer,r=t("./der");function o(t){r.call(this,t),this.enc="pem"}n(o,r),e.exports=o,o.prototype.decode=function(t,e){const i=t.toString().split(/[\r\n]+/g),n=e.label.toUpperCase(),o=/^-----(BEGIN|END) ([^-]+)-----$/;let a=-1,h=-1;for(let t=0;t<i.length;t++){const e=i[t].match(o);if(null!==e&&e[2]===n){if(-1!==a){if("END"!==e[1])break;h=t;break}if("BEGIN"!==e[1])break;a=t}}if(-1===a||-1===h)throw new Error("PEM section not found for: "+n);const c=i.slice(a+1,h).join("");c.replace(/[^a-z0-9+/=]+/gi,"");const u=s.from(c,"base64");return r.prototype.decode.call(this,u,e)}},{"./der":178,inherits:440,"safer-buffer":495}],181:[function(t,e,i){const n=t("inherits"),s=t("safer-buffer").Buffer,r=t("../base/node"),o=t("../constants/der");function a(t){this.enc="der",this.name=t.name,this.entity=t,this.tree=new h,this.tree._init(t.body)}function h(t){r.call(this,"der",t)}function c(t){return t<10?"0"+t:t}e.exports=a,a.prototype.encode=function(t,e){return this.tree._encode(t,e).join()},n(h,r),h.prototype._encodeComposite=function(t,e,i,n){const r=function(t,e,i,n){let s;"seqof"===t?t="seq":"setof"===t&&(t="set");if(o.tagByName.hasOwnProperty(t))s=o.tagByName[t];else{if("number"!=typeof t||(0|t)!==t)return n.error("Unknown tag: "+t);s=t}if(s>=31)return n.error("Multi-octet tag encoding unsupported");e||(s|=32);return s|=o.tagClassByName[i||"universal"]<<6,s}(t,e,i,this.reporter);if(n.length<128){const t=s.alloc(2);return t[0]=r,t[1]=n.length,this._createEncoderBuffer([t,n])}let a=1;for(let t=n.length;t>=256;t>>=8)a++;const h=s.alloc(2+a);h[0]=r,h[1]=128|a;for(let t=1+a,e=n.length;e>0;t--,e>>=8)h[t]=255&e;return this._createEncoderBuffer([h,n])},h.prototype._encodeStr=function(t,e){if("bitstr"===e)return this._createEncoderBuffer([0|t.unused,t.data]);if("bmpstr"===e){const e=s.alloc(2*t.length);for(let i=0;i<t.length;i++)e.writeUInt16BE(t.charCodeAt(i),2*i);return this._createEncoderBuffer(e)}return"numstr"===e?this._isNumstr(t)?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===e?this._isPrintstr(t)?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(e)||"objDesc"===e?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: "+e+" unsupported")},h.prototype._encodeObjid=function(t,e,i){if("string"==typeof t){if(!e)return this.reporter.error("string objid given, but no values map found");if(!e.hasOwnProperty(t))return this.reporter.error("objid not found in values map");t=e[t].split(/[\s.]+/g);for(let e=0;e<t.length;e++)t[e]|=0}else if(Array.isArray(t)){t=t.slice();for(let e=0;e<t.length;e++)t[e]|=0}if(!Array.isArray(t))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(t));if(!i){if(t[1]>=40)return this.reporter.error("Second objid identifier OOB");t.splice(0,2,40*t[0]+t[1])}let n=0;for(let e=0;e<t.length;e++){let i=t[e];for(n++;i>=128;i>>=7)n++}const r=s.alloc(n);let o=r.length-1;for(let e=t.length-1;e>=0;e--){let i=t[e];for(r[o--]=127&i;(i>>=7)>0;)r[o--]=128|127&i}return this._createEncoderBuffer(r)},h.prototype._encodeTime=function(t,e){let i;const n=new Date(t);return"gentime"===e?i=[c(n.getUTCFullYear()),c(n.getUTCMonth()+1),c(n.getUTCDate()),c(n.getUTCHours()),c(n.getUTCMinutes()),c(n.getUTCSeconds()),"Z"].join(""):"utctime"===e?i=[c(n.getUTCFullYear()%100),c(n.getUTCMonth()+1),c(n.getUTCDate()),c(n.getUTCHours()),c(n.getUTCMinutes()),c(n.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+e+" time is not supported yet"),this._encodeStr(i,"octstr")},h.prototype._encodeNull=function(){return this._createEncoderBuffer("")},h.prototype._encodeInt=function(t,e){if("string"==typeof t){if(!e)return this.reporter.error("String int or enum given, but no values map");if(!e.hasOwnProperty(t))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(t));t=e[t]}if("number"!=typeof t&&!s.isBuffer(t)){const e=t.toArray();!t.sign&&128&e[0]&&e.unshift(0),t=s.from(e)}if(s.isBuffer(t)){let e=t.length;0===t.length&&e++;const i=s.alloc(e);return t.copy(i),0===t.length&&(i[0]=0),this._createEncoderBuffer(i)}if(t<128)return this._createEncoderBuffer(t);if(t<256)return this._createEncoderBuffer([0,t]);let i=1;for(let e=t;e>=256;e>>=8)i++;const n=new Array(i);for(let e=n.length-1;e>=0;e--)n[e]=255&t,t>>=8;return 128&n[0]&&n.unshift(0),this._createEncoderBuffer(s.from(n))},h.prototype._encodeBool=function(t){return this._createEncoderBuffer(t?255:0)},h.prototype._use=function(t,e){return"function"==typeof t&&(t=t(e)),t._getEncoder("der").tree},h.prototype._skipDefault=function(t,e,i){const n=this._baseState;let s;if(null===n.default)return!1;const r=t.join();if(void 0===n.defaultBuffer&&(n.defaultBuffer=this._encodeValue(n.default,e,i).join()),r.length!==n.defaultBuffer.length)return!1;for(s=0;s<r.length;s++)if(r[s]!==n.defaultBuffer[s])return!1;return!0}},{"../base/node":174,"../constants/der":176,inherits:440,"safer-buffer":495}],182:[function(t,e,i){const n=i;n.der=t("./der"),n.pem=t("./pem")},{"./der":181,"./pem":183}],183:[function(t,e,i){const n=t("inherits"),s=t("./der");function r(t){s.call(this,t),this.enc="pem"}n(r,s),e.exports=r,r.prototype.encode=function(t,e){const i=s.prototype.encode.call(this,t).toString("base64"),n=["-----BEGIN "+e.label+"-----"];for(let t=0;t<i.length;t+=64)n.push(i.slice(t,t+64));return n.push("-----END "+e.label+"-----"),n.join("\n")}},{"./der":181,inherits:440}],184:[function(t,e,i){!function(e,i){function n(t,e){if(!t)throw new Error(e||"Assertion failed")}function s(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}function r(t,e,i){if(r.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(i=e,e=10),this._init(t||0,e||10,i||"be"))}var o;"object"==typeof e?e.exports=r:(void 0).BN=r,r.BN=r,r.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:t("buffer").Buffer}catch(t){}function a(t,e){var i=t.charCodeAt(e);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(t,e,i){var n=a(t,i);return i-1>=e&&(n|=a(t,i-1)<<4),n}function c(t,e,i,n){for(var s=0,r=Math.min(t.length,i),o=e;o<r;o++){var a=t.charCodeAt(o)-48;s*=n,s+=a>=49?a-49+10:a>=17?a-17+10:a}return s}r.isBN=function(t){return t instanceof r||null!==t&&"object"==typeof t&&t.constructor.wordSize===r.wordSize&&Array.isArray(t.words)},r.max=function(t,e){return t.cmp(e)>0?t:e},r.min=function(t,e){return t.cmp(e)<0?t:e},r.prototype._init=function(t,e,i){if("number"==typeof t)return this._initNumber(t,e,i);if("object"==typeof t)return this._initArray(t,e,i);"hex"===e&&(e=16),n(e===(0|e)&&e>=2&&e<=36);var s=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(s++,this.negative=1),s<t.length&&(16===e?this._parseHex(t,s,i):(this._parseBase(t,e,s),"le"===i&&this._initArray(this.toArray(),e,i)))},r.prototype._initNumber=function(t,e,i){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(n(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),e,i)},r.prototype._initArray=function(t,e,i){if(n("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,o,a=0;if("be"===i)for(s=t.length-1,r=0;s>=0;s-=3)o=t[s]|t[s-1]<<8|t[s-2]<<16,this.words[r]|=o<<a&67108863,this.words[r+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,r++);else if("le"===i)for(s=0,r=0;s<t.length;s+=3)o=t[s]|t[s+1]<<8|t[s+2]<<16,this.words[r]|=o<<a&67108863,this.words[r+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,r++);return this.strip()},r.prototype._parseHex=function(t,e,i){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,r=0,o=0;if("be"===i)for(n=t.length-1;n>=e;n-=2)s=h(t,e,n)<<r,this.words[o]|=67108863&s,r>=18?(r-=18,o+=1,this.words[o]|=s>>>26):r+=8;else for(n=(t.length-e)%2==0?e+1:e;n<t.length;n+=2)s=h(t,e,n)<<r,this.words[o]|=67108863&s,r>=18?(r-=18,o+=1,this.words[o]|=s>>>26):r+=8;this.strip()},r.prototype._parseBase=function(t,e,i){this.words=[0],this.length=1;for(var n=0,s=1;s<=67108863;s*=e)n++;n--,s=s/e|0;for(var r=t.length-i,o=r%n,a=Math.min(r,r-o)+i,h=0,u=i;u<a;u+=n)h=c(t,u,u+n,e),this.imuln(s),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=c(t,u,t.length,e),u=0;u<o;u++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},r.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},r.prototype.clone=function(){var t=new r(null);return this.copy(t),t},r.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},r.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},r.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},r.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var u=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],f=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function d(t,e,i){i.negative=e.negative^t.negative;var n=t.length+e.length|0;i.length=n,n=n-1|0;var s=0|t.words[0],r=0|e.words[0],o=s*r,a=67108863&o,h=o/67108864|0;i.words[0]=a;for(var c=1;c<n;c++){for(var u=h>>>26,l=67108863&h,f=Math.min(c,e.length-1),d=Math.max(0,c-t.length+1);d<=f;d++){var p=c-d|0;u+=(o=(s=0|t.words[p])*(r=0|e.words[d])+l)/67108864|0,l=67108863&o}i.words[c]=0|l,h=0|u}return 0!==h?i.words[c]=0|h:i.length--,i.strip()}r.prototype.toString=function(t,e){var i;if(e=0|e||1,16===(t=t||10)||"hex"===t){i="";for(var s=0,r=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<s|r)).toString(16);i=0!==(r=a>>>24-s&16777215)||o!==this.length-1?u[6-h.length]+h+i:h+i,(s+=2)>=26&&(s-=26,o--)}for(0!==r&&(i=r.toString(16)+i);i.length%e!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(t===(0|t)&&t>=2&&t<=36){var c=l[t],d=f[t];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(d).toString(t);i=(p=p.idivn(d)).isZero()?m+i:u[c-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%e!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}n(!1,"Base should be between 2 and 36")},r.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},r.prototype.toJSON=function(){return this.toString(16)},r.prototype.toBuffer=function(t,e){return n(void 0!==o),this.toArrayLike(o,t,e)},r.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},r.prototype.toArrayLike=function(t,e,i){var s=this.byteLength(),r=i||Math.max(1,s);n(s<=r,"byte array longer than desired length"),n(r>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,c=new t(r),u=this.clone();if(h){for(a=0;!u.isZero();a++)o=u.andln(255),u.iushrn(8),c[a]=o;for(;a<r;a++)c[a]=0}else{for(a=0;a<r-s;a++)c[a]=0;for(a=0;!u.isZero();a++)o=u.andln(255),u.iushrn(8),c[r-a-1]=o}return c},Math.clz32?r.prototype._countBits=function(t){return 32-Math.clz32(t)}:r.prototype._countBits=function(t){var e=t,i=0;return e>=4096&&(i+=13,e>>>=13),e>=64&&(i+=7,e>>>=7),e>=8&&(i+=4,e>>>=4),e>=2&&(i+=2,e>>>=2),i+e},r.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,i=0;return 0==(8191&e)&&(i+=13,e>>>=13),0==(127&e)&&(i+=7,e>>>=7),0==(15&e)&&(i+=4,e>>>=4),0==(3&e)&&(i+=2,e>>>=2),0==(1&e)&&i++,i},r.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},r.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var i=this._zeroBits(this.words[e]);if(t+=i,26!==i)break}return t},r.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},r.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},r.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},r.prototype.isNeg=function(){return 0!==this.negative},r.prototype.neg=function(){return this.clone().ineg()},r.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},r.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},r.prototype.ior=function(t){return n(0==(this.negative|t.negative)),this.iuor(t)},r.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},r.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},r.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var i=0;i<e.length;i++)this.words[i]=this.words[i]&t.words[i];return this.length=e.length,this.strip()},r.prototype.iand=function(t){return n(0==(this.negative|t.negative)),this.iuand(t)},r.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},r.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},r.prototype.iuxor=function(t){var e,i;this.length>t.length?(e=this,i=t):(e=t,i=this);for(var n=0;n<i.length;n++)this.words[n]=e.words[n]^i.words[n];if(this!==e)for(;n<e.length;n++)this.words[n]=e.words[n];return this.length=e.length,this.strip()},r.prototype.ixor=function(t){return n(0==(this.negative|t.negative)),this.iuxor(t)},r.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},r.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},r.prototype.inotn=function(t){n("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),i=t%26;this._expand(e),i>0&&e--;for(var s=0;s<e;s++)this.words[s]=67108863&~this.words[s];return i>0&&(this.words[s]=~this.words[s]&67108863>>26-i),this.strip()},r.prototype.notn=function(t){return this.clone().inotn(t)},r.prototype.setn=function(t,e){n("number"==typeof t&&t>=0);var i=t/26|0,s=t%26;return this._expand(i+1),this.words[i]=e?this.words[i]|1<<s:this.words[i]&~(1<<s),this.strip()},r.prototype.iadd=function(t){var e,i,n;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(i=this,n=t):(i=t,n=this);for(var s=0,r=0;r<n.length;r++)e=(0|i.words[r])+(0|n.words[r])+s,this.words[r]=67108863&e,s=e>>>26;for(;0!==s&&r<i.length;r++)e=(0|i.words[r])+s,this.words[r]=67108863&e,s=e>>>26;if(this.length=i.length,0!==s)this.words[this.length]=s,this.length++;else if(i!==this)for(;r<i.length;r++)this.words[r]=i.words[r];return this},r.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},r.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var i,n,s=this.cmp(t);if(0===s)return this.negative=0,this.length=1,this.words[0]=0,this;s>0?(i=this,n=t):(i=t,n=this);for(var r=0,o=0;o<n.length;o++)r=(e=(0|i.words[o])-(0|n.words[o])+r)>>26,this.words[o]=67108863&e;for(;0!==r&&o<i.length;o++)r=(e=(0|i.words[o])+r)>>26,this.words[o]=67108863&e;if(0===r&&o<i.length&&i!==this)for(;o<i.length;o++)this.words[o]=i.words[o];return this.length=Math.max(this.length,o),i!==this&&(this.negative=1),this.strip()},r.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,i){var n,s,r,o=t.words,a=e.words,h=i.words,c=0,u=0|o[0],l=8191&u,f=u>>>13,d=0|o[1],p=8191&d,m=d>>>13,_=0|o[2],v=8191&_,g=_>>>13,b=0|o[3],w=8191&b,y=b>>>13,x=0|o[4],M=8191&x,T=x>>>13,O=0|o[5],E=8191&O,A=O>>>13,S=0|o[6],k=8191&S,I=S>>>13,C=0|o[7],j=8191&C,D=C>>>13,R=0|o[8],P=8191&R,N=R>>>13,F=0|o[9],z=8191&F,L=F>>>13,$=0|a[0],U=8191&$,B=$>>>13,G=0|a[1],H=8191&G,V=G>>>13,W=0|a[2],q=8191&W,Y=W>>>13,X=0|a[3],Z=8191&X,J=X>>>13,K=0|a[4],Q=8191&K,tt=K>>>13,et=0|a[5],it=8191&et,nt=et>>>13,st=0|a[6],rt=8191&st,ot=st>>>13,at=0|a[7],ht=8191&at,ct=at>>>13,ut=0|a[8],lt=8191&ut,ft=ut>>>13,dt=0|a[9],pt=8191&dt,mt=dt>>>13;i.negative=t.negative^e.negative,i.length=19;var _t=(c+(n=Math.imul(l,U))|0)+((8191&(s=(s=Math.imul(l,B))+Math.imul(f,U)|0))<<13)|0;c=((r=Math.imul(f,B))+(s>>>13)|0)+(_t>>>26)|0,_t&=67108863,n=Math.imul(p,U),s=(s=Math.imul(p,B))+Math.imul(m,U)|0,r=Math.imul(m,B);var vt=(c+(n=n+Math.imul(l,H)|0)|0)+((8191&(s=(s=s+Math.imul(l,V)|0)+Math.imul(f,H)|0))<<13)|0;c=((r=r+Math.imul(f,V)|0)+(s>>>13)|0)+(vt>>>26)|0,vt&=67108863,n=Math.imul(v,U),s=(s=Math.imul(v,B))+Math.imul(g,U)|0,r=Math.imul(g,B),n=n+Math.imul(p,H)|0,s=(s=s+Math.imul(p,V)|0)+Math.imul(m,H)|0,r=r+Math.imul(m,V)|0;var gt=(c+(n=n+Math.imul(l,q)|0)|0)+((8191&(s=(s=s+Math.imul(l,Y)|0)+Math.imul(f,q)|0))<<13)|0;c=((r=r+Math.imul(f,Y)|0)+(s>>>13)|0)+(gt>>>26)|0,gt&=67108863,n=Math.imul(w,U),s=(s=Math.imul(w,B))+Math.imul(y,U)|0,r=Math.imul(y,B),n=n+Math.imul(v,H)|0,s=(s=s+Math.imul(v,V)|0)+Math.imul(g,H)|0,r=r+Math.imul(g,V)|0,n=n+Math.imul(p,q)|0,s=(s=s+Math.imul(p,Y)|0)+Math.imul(m,q)|0,r=r+Math.imul(m,Y)|0;var bt=(c+(n=n+Math.imul(l,Z)|0)|0)+((8191&(s=(s=s+Math.imul(l,J)|0)+Math.imul(f,Z)|0))<<13)|0;c=((r=r+Math.imul(f,J)|0)+(s>>>13)|0)+(bt>>>26)|0,bt&=67108863,n=Math.imul(M,U),s=(s=Math.imul(M,B))+Math.imul(T,U)|0,r=Math.imul(T,B),n=n+Math.imul(w,H)|0,s=(s=s+Math.imul(w,V)|0)+Math.imul(y,H)|0,r=r+Math.imul(y,V)|0,n=n+Math.imul(v,q)|0,s=(s=s+Math.imul(v,Y)|0)+Math.imul(g,q)|0,r=r+Math.imul(g,Y)|0,n=n+Math.imul(p,Z)|0,s=(s=s+Math.imul(p,J)|0)+Math.imul(m,Z)|0,r=r+Math.imul(m,J)|0;var wt=(c+(n=n+Math.imul(l,Q)|0)|0)+((8191&(s=(s=s+Math.imul(l,tt)|0)+Math.imul(f,Q)|0))<<13)|0;c=((r=r+Math.imul(f,tt)|0)+(s>>>13)|0)+(wt>>>26)|0,wt&=67108863,n=Math.imul(E,U),s=(s=Math.imul(E,B))+Math.imul(A,U)|0,r=Math.imul(A,B),n=n+Math.imul(M,H)|0,s=(s=s+Math.imul(M,V)|0)+Math.imul(T,H)|0,r=r+Math.imul(T,V)|0,n=n+Math.imul(w,q)|0,s=(s=s+Math.imul(w,Y)|0)+Math.imul(y,q)|0,r=r+Math.imul(y,Y)|0,n=n+Math.imul(v,Z)|0,s=(s=s+Math.imul(v,J)|0)+Math.imul(g,Z)|0,r=r+Math.imul(g,J)|0,n=n+Math.imul(p,Q)|0,s=(s=s+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,r=r+Math.imul(m,tt)|0;var yt=(c+(n=n+Math.imul(l,it)|0)|0)+((8191&(s=(s=s+Math.imul(l,nt)|0)+Math.imul(f,it)|0))<<13)|0;c=((r=r+Math.imul(f,nt)|0)+(s>>>13)|0)+(yt>>>26)|0,yt&=67108863,n=Math.imul(k,U),s=(s=Math.imul(k,B))+Math.imul(I,U)|0,r=Math.imul(I,B),n=n+Math.imul(E,H)|0,s=(s=s+Math.imul(E,V)|0)+Math.imul(A,H)|0,r=r+Math.imul(A,V)|0,n=n+Math.imul(M,q)|0,s=(s=s+Math.imul(M,Y)|0)+Math.imul(T,q)|0,r=r+Math.imul(T,Y)|0,n=n+Math.imul(w,Z)|0,s=(s=s+Math.imul(w,J)|0)+Math.imul(y,Z)|0,r=r+Math.imul(y,J)|0,n=n+Math.imul(v,Q)|0,s=(s=s+Math.imul(v,tt)|0)+Math.imul(g,Q)|0,r=r+Math.imul(g,tt)|0,n=n+Math.imul(p,it)|0,s=(s=s+Math.imul(p,nt)|0)+Math.imul(m,it)|0,r=r+Math.imul(m,nt)|0;var xt=(c+(n=n+Math.imul(l,rt)|0)|0)+((8191&(s=(s=s+Math.imul(l,ot)|0)+Math.imul(f,rt)|0))<<13)|0;c=((r=r+Math.imul(f,ot)|0)+(s>>>13)|0)+(xt>>>26)|0,xt&=67108863,n=Math.imul(j,U),s=(s=Math.imul(j,B))+Math.imul(D,U)|0,r=Math.imul(D,B),n=n+Math.imul(k,H)|0,s=(s=s+Math.imul(k,V)|0)+Math.imul(I,H)|0,r=r+Math.imul(I,V)|0,n=n+Math.imul(E,q)|0,s=(s=s+Math.imul(E,Y)|0)+Math.imul(A,q)|0,r=r+Math.imul(A,Y)|0,n=n+Math.imul(M,Z)|0,s=(s=s+Math.imul(M,J)|0)+Math.imul(T,Z)|0,r=r+Math.imul(T,J)|0,n=n+Math.imul(w,Q)|0,s=(s=s+Math.imul(w,tt)|0)+Math.imul(y,Q)|0,r=r+Math.imul(y,tt)|0,n=n+Math.imul(v,it)|0,s=(s=s+Math.imul(v,nt)|0)+Math.imul(g,it)|0,r=r+Math.imul(g,nt)|0,n=n+Math.imul(p,rt)|0,s=(s=s+Math.imul(p,ot)|0)+Math.imul(m,rt)|0,r=r+Math.imul(m,ot)|0;var Mt=(c+(n=n+Math.imul(l,ht)|0)|0)+((8191&(s=(s=s+Math.imul(l,ct)|0)+Math.imul(f,ht)|0))<<13)|0;c=((r=r+Math.imul(f,ct)|0)+(s>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,n=Math.imul(P,U),s=(s=Math.imul(P,B))+Math.imul(N,U)|0,r=Math.imul(N,B),n=n+Math.imul(j,H)|0,s=(s=s+Math.imul(j,V)|0)+Math.imul(D,H)|0,r=r+Math.imul(D,V)|0,n=n+Math.imul(k,q)|0,s=(s=s+Math.imul(k,Y)|0)+Math.imul(I,q)|0,r=r+Math.imul(I,Y)|0,n=n+Math.imul(E,Z)|0,s=(s=s+Math.imul(E,J)|0)+Math.imul(A,Z)|0,r=r+Math.imul(A,J)|0,n=n+Math.imul(M,Q)|0,s=(s=s+Math.imul(M,tt)|0)+Math.imul(T,Q)|0,r=r+Math.imul(T,tt)|0,n=n+Math.imul(w,it)|0,s=(s=s+Math.imul(w,nt)|0)+Math.imul(y,it)|0,r=r+Math.imul(y,nt)|0,n=n+Math.imul(v,rt)|0,s=(s=s+Math.imul(v,ot)|0)+Math.imul(g,rt)|0,r=r+Math.imul(g,ot)|0,n=n+Math.imul(p,ht)|0,s=(s=s+Math.imul(p,ct)|0)+Math.imul(m,ht)|0,r=r+Math.imul(m,ct)|0;var Tt=(c+(n=n+Math.imul(l,lt)|0)|0)+((8191&(s=(s=s+Math.imul(l,ft)|0)+Math.imul(f,lt)|0))<<13)|0;c=((r=r+Math.imul(f,ft)|0)+(s>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,n=Math.imul(z,U),s=(s=Math.imul(z,B))+Math.imul(L,U)|0,r=Math.imul(L,B),n=n+Math.imul(P,H)|0,s=(s=s+Math.imul(P,V)|0)+Math.imul(N,H)|0,r=r+Math.imul(N,V)|0,n=n+Math.imul(j,q)|0,s=(s=s+Math.imul(j,Y)|0)+Math.imul(D,q)|0,r=r+Math.imul(D,Y)|0,n=n+Math.imul(k,Z)|0,s=(s=s+Math.imul(k,J)|0)+Math.imul(I,Z)|0,r=r+Math.imul(I,J)|0,n=n+Math.imul(E,Q)|0,s=(s=s+Math.imul(E,tt)|0)+Math.imul(A,Q)|0,r=r+Math.imul(A,tt)|0,n=n+Math.imul(M,it)|0,s=(s=s+Math.imul(M,nt)|0)+Math.imul(T,it)|0,r=r+Math.imul(T,nt)|0,n=n+Math.imul(w,rt)|0,s=(s=s+Math.imul(w,ot)|0)+Math.imul(y,rt)|0,r=r+Math.imul(y,ot)|0,n=n+Math.imul(v,ht)|0,s=(s=s+Math.imul(v,ct)|0)+Math.imul(g,ht)|0,r=r+Math.imul(g,ct)|0,n=n+Math.imul(p,lt)|0,s=(s=s+Math.imul(p,ft)|0)+Math.imul(m,lt)|0,r=r+Math.imul(m,ft)|0;var Ot=(c+(n=n+Math.imul(l,pt)|0)|0)+((8191&(s=(s=s+Math.imul(l,mt)|0)+Math.imul(f,pt)|0))<<13)|0;c=((r=r+Math.imul(f,mt)|0)+(s>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,n=Math.imul(z,H),s=(s=Math.imul(z,V))+Math.imul(L,H)|0,r=Math.imul(L,V),n=n+Math.imul(P,q)|0,s=(s=s+Math.imul(P,Y)|0)+Math.imul(N,q)|0,r=r+Math.imul(N,Y)|0,n=n+Math.imul(j,Z)|0,s=(s=s+Math.imul(j,J)|0)+Math.imul(D,Z)|0,r=r+Math.imul(D,J)|0,n=n+Math.imul(k,Q)|0,s=(s=s+Math.imul(k,tt)|0)+Math.imul(I,Q)|0,r=r+Math.imul(I,tt)|0,n=n+Math.imul(E,it)|0,s=(s=s+Math.imul(E,nt)|0)+Math.imul(A,it)|0,r=r+Math.imul(A,nt)|0,n=n+Math.imul(M,rt)|0,s=(s=s+Math.imul(M,ot)|0)+Math.imul(T,rt)|0,r=r+Math.imul(T,ot)|0,n=n+Math.imul(w,ht)|0,s=(s=s+Math.imul(w,ct)|0)+Math.imul(y,ht)|0,r=r+Math.imul(y,ct)|0,n=n+Math.imul(v,lt)|0,s=(s=s+Math.imul(v,ft)|0)+Math.imul(g,lt)|0,r=r+Math.imul(g,ft)|0;var Et=(c+(n=n+Math.imul(p,pt)|0)|0)+((8191&(s=(s=s+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;c=((r=r+Math.imul(m,mt)|0)+(s>>>13)|0)+(Et>>>26)|0,Et&=67108863,n=Math.imul(z,q),s=(s=Math.imul(z,Y))+Math.imul(L,q)|0,r=Math.imul(L,Y),n=n+Math.imul(P,Z)|0,s=(s=s+Math.imul(P,J)|0)+Math.imul(N,Z)|0,r=r+Math.imul(N,J)|0,n=n+Math.imul(j,Q)|0,s=(s=s+Math.imul(j,tt)|0)+Math.imul(D,Q)|0,r=r+Math.imul(D,tt)|0,n=n+Math.imul(k,it)|0,s=(s=s+Math.imul(k,nt)|0)+Math.imul(I,it)|0,r=r+Math.imul(I,nt)|0,n=n+Math.imul(E,rt)|0,s=(s=s+Math.imul(E,ot)|0)+Math.imul(A,rt)|0,r=r+Math.imul(A,ot)|0,n=n+Math.imul(M,ht)|0,s=(s=s+Math.imul(M,ct)|0)+Math.imul(T,ht)|0,r=r+Math.imul(T,ct)|0,n=n+Math.imul(w,lt)|0,s=(s=s+Math.imul(w,ft)|0)+Math.imul(y,lt)|0,r=r+Math.imul(y,ft)|0;var At=(c+(n=n+Math.imul(v,pt)|0)|0)+((8191&(s=(s=s+Math.imul(v,mt)|0)+Math.imul(g,pt)|0))<<13)|0;c=((r=r+Math.imul(g,mt)|0)+(s>>>13)|0)+(At>>>26)|0,At&=67108863,n=Math.imul(z,Z),s=(s=Math.imul(z,J))+Math.imul(L,Z)|0,r=Math.imul(L,J),n=n+Math.imul(P,Q)|0,s=(s=s+Math.imul(P,tt)|0)+Math.imul(N,Q)|0,r=r+Math.imul(N,tt)|0,n=n+Math.imul(j,it)|0,s=(s=s+Math.imul(j,nt)|0)+Math.imul(D,it)|0,r=r+Math.imul(D,nt)|0,n=n+Math.imul(k,rt)|0,s=(s=s+Math.imul(k,ot)|0)+Math.imul(I,rt)|0,r=r+Math.imul(I,ot)|0,n=n+Math.imul(E,ht)|0,s=(s=s+Math.imul(E,ct)|0)+Math.imul(A,ht)|0,r=r+Math.imul(A,ct)|0,n=n+Math.imul(M,lt)|0,s=(s=s+Math.imul(M,ft)|0)+Math.imul(T,lt)|0,r=r+Math.imul(T,ft)|0;var St=(c+(n=n+Math.imul(w,pt)|0)|0)+((8191&(s=(s=s+Math.imul(w,mt)|0)+Math.imul(y,pt)|0))<<13)|0;c=((r=r+Math.imul(y,mt)|0)+(s>>>13)|0)+(St>>>26)|0,St&=67108863,n=Math.imul(z,Q),s=(s=Math.imul(z,tt))+Math.imul(L,Q)|0,r=Math.imul(L,tt),n=n+Math.imul(P,it)|0,s=(s=s+Math.imul(P,nt)|0)+Math.imul(N,it)|0,r=r+Math.imul(N,nt)|0,n=n+Math.imul(j,rt)|0,s=(s=s+Math.imul(j,ot)|0)+Math.imul(D,rt)|0,r=r+Math.imul(D,ot)|0,n=n+Math.imul(k,ht)|0,s=(s=s+Math.imul(k,ct)|0)+Math.imul(I,ht)|0,r=r+Math.imul(I,ct)|0,n=n+Math.imul(E,lt)|0,s=(s=s+Math.imul(E,ft)|0)+Math.imul(A,lt)|0,r=r+Math.imul(A,ft)|0;var kt=(c+(n=n+Math.imul(M,pt)|0)|0)+((8191&(s=(s=s+Math.imul(M,mt)|0)+Math.imul(T,pt)|0))<<13)|0;c=((r=r+Math.imul(T,mt)|0)+(s>>>13)|0)+(kt>>>26)|0,kt&=67108863,n=Math.imul(z,it),s=(s=Math.imul(z,nt))+Math.imul(L,it)|0,r=Math.imul(L,nt),n=n+Math.imul(P,rt)|0,s=(s=s+Math.imul(P,ot)|0)+Math.imul(N,rt)|0,r=r+Math.imul(N,ot)|0,n=n+Math.imul(j,ht)|0,s=(s=s+Math.imul(j,ct)|0)+Math.imul(D,ht)|0,r=r+Math.imul(D,ct)|0,n=n+Math.imul(k,lt)|0,s=(s=s+Math.imul(k,ft)|0)+Math.imul(I,lt)|0,r=r+Math.imul(I,ft)|0;var It=(c+(n=n+Math.imul(E,pt)|0)|0)+((8191&(s=(s=s+Math.imul(E,mt)|0)+Math.imul(A,pt)|0))<<13)|0;c=((r=r+Math.imul(A,mt)|0)+(s>>>13)|0)+(It>>>26)|0,It&=67108863,n=Math.imul(z,rt),s=(s=Math.imul(z,ot))+Math.imul(L,rt)|0,r=Math.imul(L,ot),n=n+Math.imul(P,ht)|0,s=(s=s+Math.imul(P,ct)|0)+Math.imul(N,ht)|0,r=r+Math.imul(N,ct)|0,n=n+Math.imul(j,lt)|0,s=(s=s+Math.imul(j,ft)|0)+Math.imul(D,lt)|0,r=r+Math.imul(D,ft)|0;var Ct=(c+(n=n+Math.imul(k,pt)|0)|0)+((8191&(s=(s=s+Math.imul(k,mt)|0)+Math.imul(I,pt)|0))<<13)|0;c=((r=r+Math.imul(I,mt)|0)+(s>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,n=Math.imul(z,ht),s=(s=Math.imul(z,ct))+Math.imul(L,ht)|0,r=Math.imul(L,ct),n=n+Math.imul(P,lt)|0,s=(s=s+Math.imul(P,ft)|0)+Math.imul(N,lt)|0,r=r+Math.imul(N,ft)|0;var jt=(c+(n=n+Math.imul(j,pt)|0)|0)+((8191&(s=(s=s+Math.imul(j,mt)|0)+Math.imul(D,pt)|0))<<13)|0;c=((r=r+Math.imul(D,mt)|0)+(s>>>13)|0)+(jt>>>26)|0,jt&=67108863,n=Math.imul(z,lt),s=(s=Math.imul(z,ft))+Math.imul(L,lt)|0,r=Math.imul(L,ft);var Dt=(c+(n=n+Math.imul(P,pt)|0)|0)+((8191&(s=(s=s+Math.imul(P,mt)|0)+Math.imul(N,pt)|0))<<13)|0;c=((r=r+Math.imul(N,mt)|0)+(s>>>13)|0)+(Dt>>>26)|0,Dt&=67108863;var Rt=(c+(n=Math.imul(z,pt))|0)+((8191&(s=(s=Math.imul(z,mt))+Math.imul(L,pt)|0))<<13)|0;return c=((r=Math.imul(L,mt))+(s>>>13)|0)+(Rt>>>26)|0,Rt&=67108863,h[0]=_t,h[1]=vt,h[2]=gt,h[3]=bt,h[4]=wt,h[5]=yt,h[6]=xt,h[7]=Mt,h[8]=Tt,h[9]=Ot,h[10]=Et,h[11]=At,h[12]=St,h[13]=kt,h[14]=It,h[15]=Ct,h[16]=jt,h[17]=Dt,h[18]=Rt,0!==c&&(h[19]=c,i.length++),i};function m(t,e,i){return(new _).mulp(t,e,i)}function _(t,e){this.x=t,this.y=e}Math.imul||(p=d),r.prototype.mulTo=function(t,e){var i=this.length+t.length;return 10===this.length&&10===t.length?p(this,t,e):i<63?d(this,t,e):i<1024?function(t,e,i){i.negative=e.negative^t.negative,i.length=t.length+e.length;for(var n=0,s=0,r=0;r<i.length-1;r++){var o=s;s=0;for(var a=67108863&n,h=Math.min(r,e.length-1),c=Math.max(0,r-t.length+1);c<=h;c++){var u=r-c,l=(0|t.words[u])*(0|e.words[c]),f=67108863&l;a=67108863&(f=f+a|0),s+=(o=(o=o+(l/67108864|0)|0)+(f>>>26)|0)>>>26,o&=67108863}i.words[r]=a,n=o,o=s}return 0!==n?i.words[r]=n:i.length--,i.strip()}(this,t,e):m(this,t,e)},_.prototype.makeRBT=function(t){for(var e=new Array(t),i=r.prototype._countBits(t)-1,n=0;n<t;n++)e[n]=this.revBin(n,i,t);return e},_.prototype.revBin=function(t,e,i){if(0===t||t===i-1)return t;for(var n=0,s=0;s<e;s++)n|=(1&t)<<e-s-1,t>>=1;return n},_.prototype.permute=function(t,e,i,n,s,r){for(var o=0;o<r;o++)n[o]=e[t[o]],s[o]=i[t[o]]},_.prototype.transform=function(t,e,i,n,s,r){this.permute(r,t,e,i,n,s);for(var o=1;o<s;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),c=Math.sin(2*Math.PI/a),u=0;u<s;u+=a)for(var l=h,f=c,d=0;d<o;d++){var p=i[u+d],m=n[u+d],_=i[u+d+o],v=n[u+d+o],g=l*_-f*v;v=l*v+f*_,_=g,i[u+d]=p+_,n[u+d]=m+v,i[u+d+o]=p-_,n[u+d+o]=m-v,d!==a&&(g=h*l-c*f,f=h*f+c*l,l=g)}},_.prototype.guessLen13b=function(t,e){var i=1|Math.max(e,t),n=1&i,s=0;for(i=i/2|0;i;i>>>=1)s++;return 1<<s+1+n},_.prototype.conjugate=function(t,e,i){if(!(i<=1))for(var n=0;n<i/2;n++){var s=t[n];t[n]=t[i-n-1],t[i-n-1]=s,s=e[n],e[n]=-e[i-n-1],e[i-n-1]=-s}},_.prototype.normalize13b=function(t,e){for(var i=0,n=0;n<e/2;n++){var s=8192*Math.round(t[2*n+1]/e)+Math.round(t[2*n]/e)+i;t[n]=67108863&s,i=s<67108864?0:s/67108864|0}return t},_.prototype.convert13b=function(t,e,i,s){for(var r=0,o=0;o<e;o++)r+=0|t[o],i[2*o]=8191&r,r>>>=13,i[2*o+1]=8191&r,r>>>=13;for(o=2*e;o<s;++o)i[o]=0;n(0===r),n(0==(-8192&r))},_.prototype.stub=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=0;return e},_.prototype.mulp=function(t,e,i){var n=2*this.guessLen13b(t.length,e.length),s=this.makeRBT(n),r=this.stub(n),o=new Array(n),a=new Array(n),h=new Array(n),c=new Array(n),u=new Array(n),l=new Array(n),f=i.words;f.length=n,this.convert13b(t.words,t.length,o,n),this.convert13b(e.words,e.length,c,n),this.transform(o,r,a,h,n,s),this.transform(c,r,u,l,n,s);for(var d=0;d<n;d++){var p=a[d]*u[d]-h[d]*l[d];h[d]=a[d]*l[d]+h[d]*u[d],a[d]=p}return this.conjugate(a,h,n),this.transform(a,h,f,r,n,s),this.conjugate(f,r,n),this.normalize13b(f,n),i.negative=t.negative^e.negative,i.length=t.length+e.length,i.strip()},r.prototype.mul=function(t){var e=new r(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},r.prototype.mulf=function(t){var e=new r(null);return e.words=new Array(this.length+t.length),m(this,t,e)},r.prototype.imul=function(t){return this.clone().mulTo(t,this)},r.prototype.imuln=function(t){n("number"==typeof t),n(t<67108864);for(var e=0,i=0;i<this.length;i++){var s=(0|this.words[i])*t,r=(67108863&s)+(67108863&e);e>>=26,e+=s/67108864|0,e+=r>>>26,this.words[i]=67108863&r}return 0!==e&&(this.words[i]=e,this.length++),this},r.prototype.muln=function(t){return this.clone().imuln(t)},r.prototype.sqr=function(){return this.mul(this)},r.prototype.isqr=function(){return this.imul(this.clone())},r.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),i=0;i<e.length;i++){var n=i/26|0,s=i%26;e[i]=(t.words[n]&1<<s)>>>s}return e}(t);if(0===e.length)return new r(1);for(var i=this,n=0;n<e.length&&0===e[n];n++,i=i.sqr());if(++n<e.length)for(var s=i.sqr();n<e.length;n++,s=s.sqr())0!==e[n]&&(i=i.mul(s));return i},r.prototype.iushln=function(t){n("number"==typeof t&&t>=0);var e,i=t%26,s=(t-i)/26,r=67108863>>>26-i<<26-i;if(0!==i){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&r,h=(0|this.words[e])-a<<i;this.words[e]=h|o,o=a>>>26-i}o&&(this.words[e]=o,this.length++)}if(0!==s){for(e=this.length-1;e>=0;e--)this.words[e+s]=this.words[e];for(e=0;e<s;e++)this.words[e]=0;this.length+=s}return this.strip()},r.prototype.ishln=function(t){return n(0===this.negative),this.iushln(t)},r.prototype.iushrn=function(t,e,i){var s;n("number"==typeof t&&t>=0),s=e?(e-e%26)/26:0;var r=t%26,o=Math.min((t-r)/26,this.length),a=67108863^67108863>>>r<<r,h=i;if(s-=o,s=Math.max(0,s),h){for(var c=0;c<o;c++)h.words[c]=this.words[c];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,c=0;c<this.length;c++)this.words[c]=this.words[c+o];else this.words[0]=0,this.length=1;var u=0;for(c=this.length-1;c>=0&&(0!==u||c>=s);c--){var l=0|this.words[c];this.words[c]=u<<26-r|l>>>r,u=l&a}return h&&0!==u&&(h.words[h.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},r.prototype.ishrn=function(t,e,i){return n(0===this.negative),this.iushrn(t,e,i)},r.prototype.shln=function(t){return this.clone().ishln(t)},r.prototype.ushln=function(t){return this.clone().iushln(t)},r.prototype.shrn=function(t){return this.clone().ishrn(t)},r.prototype.ushrn=function(t){return this.clone().iushrn(t)},r.prototype.testn=function(t){n("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26,s=1<<e;return!(this.length<=i)&&!!(this.words[i]&s)},r.prototype.imaskn=function(t){n("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==e&&i++,this.length=Math.min(i,this.length),0!==e){var s=67108863^67108863>>>e<<e;this.words[this.length-1]&=s}return this.strip()},r.prototype.maskn=function(t){return this.clone().imaskn(t)},r.prototype.iaddn=function(t){return n("number"==typeof t),n(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},r.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},r.prototype.isubn=function(t){if(n("number"==typeof t),n(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},r.prototype.addn=function(t){return this.clone().iaddn(t)},r.prototype.subn=function(t){return this.clone().isubn(t)},r.prototype.iabs=function(){return this.negative=0,this},r.prototype.abs=function(){return this.clone().iabs()},r.prototype._ishlnsubmul=function(t,e,i){var s,r,o=t.length+i;this._expand(o);var a=0;for(s=0;s<t.length;s++){r=(0|this.words[s+i])+a;var h=(0|t.words[s])*e;a=((r-=67108863&h)>>26)-(h/67108864|0),this.words[s+i]=67108863&r}for(;s<this.length-i;s++)a=(r=(0|this.words[s+i])+a)>>26,this.words[s+i]=67108863&r;if(0===a)return this.strip();for(n(-1===a),a=0,s=0;s<this.length;s++)a=(r=-(0|this.words[s])+a)>>26,this.words[s]=67108863&r;return this.negative=1,this.strip()},r.prototype._wordDiv=function(t,e){var i=t.length,n=this.clone(),s=t,o=0|s.words[s.length-1];0!==(i=26-this._countBits(o))&&(s=s.ushln(i),n.iushln(i),o=0|s.words[s.length-1]);var a,h=n.length-s.length;if("mod"!==e){(a=new r(null)).length=h+1,a.words=new Array(a.length);for(var c=0;c<a.length;c++)a.words[c]=0}var u=n.clone()._ishlnsubmul(s,1,h);0===u.negative&&(n=u,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var f=67108864*(0|n.words[s.length+l])+(0|n.words[s.length+l-1]);for(f=Math.min(f/o|0,67108863),n._ishlnsubmul(s,f,l);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(s,1,l),n.isZero()||(n.negative^=1);a&&(a.words[l]=f)}return a&&a.strip(),n.strip(),"div"!==e&&0!==i&&n.iushrn(i),{div:a||null,mod:n}},r.prototype.divmod=function(t,e,i){return n(!t.isZero()),this.isZero()?{div:new r(0),mod:new r(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(s=a.div.neg()),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.iadd(t)),{div:s,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(s=a.div.neg()),{div:s,mod:a.mod}):0!=(this.negative&t.negative)?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new r(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new r(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new r(this.modn(t.words[0]))}:this._wordDiv(t,e);var s,o,a},r.prototype.div=function(t){return this.divmod(t,"div",!1).div},r.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},r.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},r.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var i=0!==e.div.negative?e.mod.isub(t):e.mod,n=t.ushrn(1),s=t.andln(1),r=i.cmp(n);return r<0||1===s&&0===r?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},r.prototype.modn=function(t){n(t<=67108863);for(var e=(1<<26)%t,i=0,s=this.length-1;s>=0;s--)i=(e*i+(0|this.words[s]))%t;return i},r.prototype.idivn=function(t){n(t<=67108863);for(var e=0,i=this.length-1;i>=0;i--){var s=(0|this.words[i])+67108864*e;this.words[i]=s/t|0,e=s%t}return this.strip()},r.prototype.divn=function(t){return this.clone().idivn(t)},r.prototype.egcd=function(t){n(0===t.negative),n(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var s=new r(1),o=new r(0),a=new r(0),h=new r(1),c=0;e.isEven()&&i.isEven();)e.iushrn(1),i.iushrn(1),++c;for(var u=i.clone(),l=e.clone();!e.isZero();){for(var f=0,d=1;0==(e.words[0]&d)&&f<26;++f,d<<=1);if(f>0)for(e.iushrn(f);f-- >0;)(s.isOdd()||o.isOdd())&&(s.iadd(u),o.isub(l)),s.iushrn(1),o.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(u),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(i)>=0?(e.isub(i),s.isub(a),o.isub(h)):(i.isub(e),a.isub(s),h.isub(o))}return{a,b:h,gcd:i.iushln(c)}},r.prototype._invmp=function(t){n(0===t.negative),n(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var s,o=new r(1),a=new r(0),h=i.clone();e.cmpn(1)>0&&i.cmpn(1)>0;){for(var c=0,u=1;0==(e.words[0]&u)&&c<26;++c,u<<=1);if(c>0)for(e.iushrn(c);c-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,f=1;0==(i.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(i.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(i)>=0?(e.isub(i),o.isub(a)):(i.isub(e),a.isub(o))}return(s=0===e.cmpn(1)?o:a).cmpn(0)<0&&s.iadd(t),s},r.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),i=t.clone();e.negative=0,i.negative=0;for(var n=0;e.isEven()&&i.isEven();n++)e.iushrn(1),i.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;i.isEven();)i.iushrn(1);var s=e.cmp(i);if(s<0){var r=e;e=i,i=r}else if(0===s||0===i.cmpn(1))break;e.isub(i)}return i.iushln(n)},r.prototype.invm=function(t){return this.egcd(t).a.umod(t)},r.prototype.isEven=function(){return 0==(1&this.words[0])},r.prototype.isOdd=function(){return 1==(1&this.words[0])},r.prototype.andln=function(t){return this.words[0]&t},r.prototype.bincn=function(t){n("number"==typeof t);var e=t%26,i=(t-e)/26,s=1<<e;if(this.length<=i)return this._expand(i+1),this.words[i]|=s,this;for(var r=s,o=i;0!==r&&o<this.length;o++){var a=0|this.words[o];r=(a+=r)>>>26,a&=67108863,this.words[o]=a}return 0!==r&&(this.words[o]=r,this.length++),this},r.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},r.prototype.cmpn=function(t){var e,i=t<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)e=1;else{i&&(t=-t),n(t<=67108863,"Number is too big");var s=0|this.words[0];e=s===t?0:s<t?-1:1}return 0!==this.negative?0|-e:e},r.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},r.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,i=this.length-1;i>=0;i--){var n=0|this.words[i],s=0|t.words[i];if(n!==s){n<s?e=-1:n>s&&(e=1);break}}return e},r.prototype.gtn=function(t){return 1===this.cmpn(t)},r.prototype.gt=function(t){return 1===this.cmp(t)},r.prototype.gten=function(t){return this.cmpn(t)>=0},r.prototype.gte=function(t){return this.cmp(t)>=0},r.prototype.ltn=function(t){return-1===this.cmpn(t)},r.prototype.lt=function(t){return-1===this.cmp(t)},r.prototype.lten=function(t){return this.cmpn(t)<=0},r.prototype.lte=function(t){return this.cmp(t)<=0},r.prototype.eqn=function(t){return 0===this.cmpn(t)},r.prototype.eq=function(t){return 0===this.cmp(t)},r.red=function(t){return new M(t)},r.prototype.toRed=function(t){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},r.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},r.prototype._forceRed=function(t){return this.red=t,this},r.prototype.forceRed=function(t){return n(!this.red,"Already a number in reduction context"),this._forceRed(t)},r.prototype.redAdd=function(t){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},r.prototype.redIAdd=function(t){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},r.prototype.redSub=function(t){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},r.prototype.redISub=function(t){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},r.prototype.redShl=function(t){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},r.prototype.redMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},r.prototype.redIMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},r.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},r.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},r.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},r.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},r.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},r.prototype.redPow=function(t){return n(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var v={k256:null,p224:null,p192:null,p25519:null};function g(t,e){this.name=t,this.p=new r(e,16),this.n=this.p.bitLength(),this.k=new r(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){g.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){g.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function y(){g.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function x(){g.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function M(t){if("string"==typeof t){var e=r._prime(t);this.m=e.p,this.prime=e}else n(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function T(t){M.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new r(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g.prototype._tmp=function(){var t=new r(null);return t.words=new Array(Math.ceil(this.n/13)),t},g.prototype.ireduce=function(t){var e,i=t;do{this.split(i,this.tmp),e=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(e>this.n);var n=e<this.n?-1:i.ucmp(this.p);return 0===n?(i.words[0]=0,i.length=1):n>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},g.prototype.split=function(t,e){t.iushrn(this.n,0,e)},g.prototype.imulK=function(t){return t.imul(this.k)},s(b,g),b.prototype.split=function(t,e){for(var i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=4194303&s,n=10;n<t.length;n++){var r=0|t.words[n];t.words[n-10]=(4194303&r)<<4|s>>>22,s=r}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},b.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,i=0;i<t.length;i++){var n=0|t.words[i];e+=977*n,t.words[i]=67108863&e,e=64*n+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},s(w,g),s(y,g),s(x,g),x.prototype.imulK=function(t){for(var e=0,i=0;i<t.length;i++){var n=19*(0|t.words[i])+e,s=67108863&n;n>>>=26,t.words[i]=s,e=n}return 0!==e&&(t.words[t.length++]=e),t},r._prime=function(t){if(v[t])return v[t];var e;if("k256"===t)e=new b;else if("p224"===t)e=new w;else if("p192"===t)e=new y;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new x}return v[t]=e,e},M.prototype._verify1=function(t){n(0===t.negative,"red works only with positives"),n(t.red,"red works only with red numbers")},M.prototype._verify2=function(t,e){n(0==(t.negative|e.negative),"red works only with positives"),n(t.red&&t.red===e.red,"red works only with red numbers")},M.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},M.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},M.prototype.add=function(t,e){this._verify2(t,e);var i=t.add(e);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},M.prototype.iadd=function(t,e){this._verify2(t,e);var i=t.iadd(e);return i.cmp(this.m)>=0&&i.isub(this.m),i},M.prototype.sub=function(t,e){this._verify2(t,e);var i=t.sub(e);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},M.prototype.isub=function(t,e){this._verify2(t,e);var i=t.isub(e);return i.cmpn(0)<0&&i.iadd(this.m),i},M.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},M.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},M.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},M.prototype.isqr=function(t){return this.imul(t,t.clone())},M.prototype.sqr=function(t){return this.mul(t,t)},M.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(n(e%2==1),3===e){var i=this.m.add(new r(1)).iushrn(2);return this.pow(t,i)}for(var s=this.m.subn(1),o=0;!s.isZero()&&0===s.andln(1);)o++,s.iushrn(1);n(!s.isZero());var a=new r(1).toRed(this),h=a.redNeg(),c=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new r(2*u*u).toRed(this);0!==this.pow(u,c).cmp(h);)u.redIAdd(h);for(var l=this.pow(u,s),f=this.pow(t,s.addn(1).iushrn(1)),d=this.pow(t,s),p=o;0!==d.cmp(a);){for(var m=d,_=0;0!==m.cmp(a);_++)m=m.redSqr();n(_<p);var v=this.pow(l,new r(1).iushln(p-_-1));f=f.redMul(v),l=v.redSqr(),d=d.redMul(l),p=_}return f},M.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},M.prototype.pow=function(t,e){if(e.isZero())return new r(1).toRed(this);if(0===e.cmpn(1))return t.clone();var i=new Array(16);i[0]=new r(1).toRed(this),i[1]=t;for(var n=2;n<i.length;n++)i[n]=this.mul(i[n-1],t);var s=i[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),n=e.length-1;n>=0;n--){for(var c=e.words[n],u=h-1;u>=0;u--){var l=c>>u&1;s!==i[0]&&(s=this.sqr(s)),0!==l||0!==o?(o<<=1,o|=l,(4===++a||0===n&&0===u)&&(s=this.mul(s,i[o]),a=0,o=0)):a=0}h=26}return s},M.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},M.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},r.mont=function(t){return new T(t)},s(T,M),T.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},T.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},T.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var i=t.imul(e),n=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=i.isub(n).iushrn(this.shift),r=s;return s.cmp(this.m)>=0?r=s.isub(this.m):s.cmpn(0)<0&&(r=s.iadd(this.m)),r._forceRed(this)},T.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new r(0)._forceRed(this);var i=t.mul(e),n=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=i.isub(n).iushrn(this.shift),o=s;return s.cmp(this.m)>=0?o=s.isub(this.m):s.cmpn(0)<0&&(o=s.iadd(this.m)),o._forceRed(this)},T.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(void 0===e||e)},{buffer:188}],185:[function(t,e,i){i.byteLength=function(t){var e=c(t),i=e[0],n=e[1];return 3*(i+n)/4-n},i.toByteArray=function(t){var e,i,n=c(t),o=n[0],a=n[1],h=new r(function(t,e,i){return 3*(e+i)/4-i}(0,o,a)),u=0,l=a>0?o-4:o;for(i=0;i<l;i+=4)e=s[t.charCodeAt(i)]<<18|s[t.charCodeAt(i+1)]<<12|s[t.charCodeAt(i+2)]<<6|s[t.charCodeAt(i+3)],h[u++]=e>>16&255,h[u++]=e>>8&255,h[u++]=255&e;2===a&&(e=s[t.charCodeAt(i)]<<2|s[t.charCodeAt(i+1)]>>4,h[u++]=255&e);1===a&&(e=s[t.charCodeAt(i)]<<10|s[t.charCodeAt(i+1)]<<4|s[t.charCodeAt(i+2)]>>2,h[u++]=e>>8&255,h[u++]=255&e);return h},i.fromByteArray=function(t){for(var e,i=t.length,s=i%3,r=[],o=0,a=i-s;o<a;o+=16383)r.push(u(t,o,o+16383>a?a:o+16383));1===s?(e=t[i-1],r.push(n[e>>2]+n[e<<4&63]+"==")):2===s&&(e=(t[i-2]<<8)+t[i-1],r.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return r.join("")};for(var n=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,h=o.length;a<h;++a)n[a]=o[a],s[o.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function u(t,e,i){for(var s,r,o=[],a=e;a<i;a+=3)s=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(n[(r=s)>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return o.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},{}],186:[function(t,e,i){!function(e,i){function n(t,e){if(!t)throw new Error(e||"Assertion failed")}function s(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}function r(t,e,i){if(r.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(i=e,e=10),this._init(t||0,e||10,i||"be"))}var o;"object"==typeof e?e.exports=r:(void 0).BN=r,r.BN=r,r.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:t("buffer").Buffer}catch(t){}function a(t,e){var i=t.charCodeAt(e);return i>=48&&i<=57?i-48:i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:void n(!1,"Invalid character in "+t)}function h(t,e,i){var n=a(t,i);return i-1>=e&&(n|=a(t,i-1)<<4),n}function c(t,e,i,s){for(var r=0,o=0,a=Math.min(t.length,i),h=e;h<a;h++){var c=t.charCodeAt(h)-48;r*=s,o=c>=49?c-49+10:c>=17?c-17+10:c,n(c>=0&&o<s,"Invalid character"),r+=o}return r}function u(t,e){t.words=e.words,t.length=e.length,t.negative=e.negative,t.red=e.red}if(r.isBN=function(t){return t instanceof r||null!==t&&"object"==typeof t&&t.constructor.wordSize===r.wordSize&&Array.isArray(t.words)},r.max=function(t,e){return t.cmp(e)>0?t:e},r.min=function(t,e){return t.cmp(e)<0?t:e},r.prototype._init=function(t,e,i){if("number"==typeof t)return this._initNumber(t,e,i);if("object"==typeof t)return this._initArray(t,e,i);"hex"===e&&(e=16),n(e===(0|e)&&e>=2&&e<=36);var s=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(s++,this.negative=1),s<t.length&&(16===e?this._parseHex(t,s,i):(this._parseBase(t,e,s),"le"===i&&this._initArray(this.toArray(),e,i)))},r.prototype._initNumber=function(t,e,i){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(n(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),e,i)},r.prototype._initArray=function(t,e,i){if(n("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,o,a=0;if("be"===i)for(s=t.length-1,r=0;s>=0;s-=3)o=t[s]|t[s-1]<<8|t[s-2]<<16,this.words[r]|=o<<a&67108863,this.words[r+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,r++);else if("le"===i)for(s=0,r=0;s<t.length;s+=3)o=t[s]|t[s+1]<<8|t[s+2]<<16,this.words[r]|=o<<a&67108863,this.words[r+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,r++);return this._strip()},r.prototype._parseHex=function(t,e,i){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,r=0,o=0;if("be"===i)for(n=t.length-1;n>=e;n-=2)s=h(t,e,n)<<r,this.words[o]|=67108863&s,r>=18?(r-=18,o+=1,this.words[o]|=s>>>26):r+=8;else for(n=(t.length-e)%2==0?e+1:e;n<t.length;n+=2)s=h(t,e,n)<<r,this.words[o]|=67108863&s,r>=18?(r-=18,o+=1,this.words[o]|=s>>>26):r+=8;this._strip()},r.prototype._parseBase=function(t,e,i){this.words=[0],this.length=1;for(var n=0,s=1;s<=67108863;s*=e)n++;n--,s=s/e|0;for(var r=t.length-i,o=r%n,a=Math.min(r,r-o)+i,h=0,u=i;u<a;u+=n)h=c(t,u,u+n,e),this.imuln(s),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=c(t,u,t.length,e),u=0;u<o;u++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this._strip()},r.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},r.prototype._move=function(t){u(t,this)},r.prototype.clone=function(){var t=new r(null);return this.copy(t),t},r.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},r.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},r.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{r.prototype[Symbol.for("nodejs.util.inspect.custom")]=l}catch(t){r.prototype.inspect=l}else r.prototype.inspect=l;function l(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var f=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],d=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],p=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];r.prototype.toString=function(t,e){var i;if(e=0|e||1,16===(t=t||10)||"hex"===t){i="";for(var s=0,r=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<s|r)).toString(16);r=a>>>24-s&16777215,(s+=2)>=26&&(s-=26,o--),i=0!==r||o!==this.length-1?f[6-h.length]+h+i:h+i}for(0!==r&&(i=r.toString(16)+i);i.length%e!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(t===(0|t)&&t>=2&&t<=36){var c=d[t],u=p[t];i="";var l=this.clone();for(l.negative=0;!l.isZero();){var m=l.modrn(u).toString(t);i=(l=l.idivn(u)).isZero()?m+i:f[c-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%e!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}n(!1,"Base should be between 2 and 36")},r.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},r.prototype.toJSON=function(){return this.toString(16,2)},o&&(r.prototype.toBuffer=function(t,e){return this.toArrayLike(o,t,e)}),r.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)};function m(t,e,i){i.negative=e.negative^t.negative;var n=t.length+e.length|0;i.length=n,n=n-1|0;var s=0|t.words[0],r=0|e.words[0],o=s*r,a=67108863&o,h=o/67108864|0;i.words[0]=a;for(var c=1;c<n;c++){for(var u=h>>>26,l=67108863&h,f=Math.min(c,e.length-1),d=Math.max(0,c-t.length+1);d<=f;d++){var p=c-d|0;u+=(o=(s=0|t.words[p])*(r=0|e.words[d])+l)/67108864|0,l=67108863&o}i.words[c]=0|l,h=0|u}return 0!==h?i.words[c]=0|h:i.length--,i._strip()}r.prototype.toArrayLike=function(t,e,i){this._strip();var s=this.byteLength(),r=i||Math.max(1,s);n(s<=r,"byte array longer than desired length"),n(r>0,"Requested array length <= 0");var o=function(t,e){return t.allocUnsafe?t.allocUnsafe(e):new t(e)}(t,r);return this["_toArrayLike"+("le"===e?"LE":"BE")](o,s),o},r.prototype._toArrayLikeLE=function(t,e){for(var i=0,n=0,s=0,r=0;s<this.length;s++){var o=this.words[s]<<r|n;t[i++]=255&o,i<t.length&&(t[i++]=o>>8&255),i<t.length&&(t[i++]=o>>16&255),6===r?(i<t.length&&(t[i++]=o>>24&255),n=0,r=0):(n=o>>>24,r+=2)}if(i<t.length)for(t[i++]=n;i<t.length;)t[i++]=0},r.prototype._toArrayLikeBE=function(t,e){for(var i=t.length-1,n=0,s=0,r=0;s<this.length;s++){var o=this.words[s]<<r|n;t[i--]=255&o,i>=0&&(t[i--]=o>>8&255),i>=0&&(t[i--]=o>>16&255),6===r?(i>=0&&(t[i--]=o>>24&255),n=0,r=0):(n=o>>>24,r+=2)}if(i>=0)for(t[i--]=n;i>=0;)t[i--]=0},Math.clz32?r.prototype._countBits=function(t){return 32-Math.clz32(t)}:r.prototype._countBits=function(t){var e=t,i=0;return e>=4096&&(i+=13,e>>>=13),e>=64&&(i+=7,e>>>=7),e>=8&&(i+=4,e>>>=4),e>=2&&(i+=2,e>>>=2),i+e},r.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,i=0;return 0==(8191&e)&&(i+=13,e>>>=13),0==(127&e)&&(i+=7,e>>>=7),0==(15&e)&&(i+=4,e>>>=4),0==(3&e)&&(i+=2,e>>>=2),0==(1&e)&&i++,i},r.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},r.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var i=this._zeroBits(this.words[e]);if(t+=i,26!==i)break}return t},r.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},r.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},r.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},r.prototype.isNeg=function(){return 0!==this.negative},r.prototype.neg=function(){return this.clone().ineg()},r.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},r.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this._strip()},r.prototype.ior=function(t){return n(0==(this.negative|t.negative)),this.iuor(t)},r.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},r.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},r.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var i=0;i<e.length;i++)this.words[i]=this.words[i]&t.words[i];return this.length=e.length,this._strip()},r.prototype.iand=function(t){return n(0==(this.negative|t.negative)),this.iuand(t)},r.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},r.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},r.prototype.iuxor=function(t){var e,i;this.length>t.length?(e=this,i=t):(e=t,i=this);for(var n=0;n<i.length;n++)this.words[n]=e.words[n]^i.words[n];if(this!==e)for(;n<e.length;n++)this.words[n]=e.words[n];return this.length=e.length,this._strip()},r.prototype.ixor=function(t){return n(0==(this.negative|t.negative)),this.iuxor(t)},r.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},r.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},r.prototype.inotn=function(t){n("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),i=t%26;this._expand(e),i>0&&e--;for(var s=0;s<e;s++)this.words[s]=67108863&~this.words[s];return i>0&&(this.words[s]=~this.words[s]&67108863>>26-i),this._strip()},r.prototype.notn=function(t){return this.clone().inotn(t)},r.prototype.setn=function(t,e){n("number"==typeof t&&t>=0);var i=t/26|0,s=t%26;return this._expand(i+1),this.words[i]=e?this.words[i]|1<<s:this.words[i]&~(1<<s),this._strip()},r.prototype.iadd=function(t){var e,i,n;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(i=this,n=t):(i=t,n=this);for(var s=0,r=0;r<n.length;r++)e=(0|i.words[r])+(0|n.words[r])+s,this.words[r]=67108863&e,s=e>>>26;for(;0!==s&&r<i.length;r++)e=(0|i.words[r])+s,this.words[r]=67108863&e,s=e>>>26;if(this.length=i.length,0!==s)this.words[this.length]=s,this.length++;else if(i!==this)for(;r<i.length;r++)this.words[r]=i.words[r];return this},r.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},r.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var i,n,s=this.cmp(t);if(0===s)return this.negative=0,this.length=1,this.words[0]=0,this;s>0?(i=this,n=t):(i=t,n=this);for(var r=0,o=0;o<n.length;o++)r=(e=(0|i.words[o])-(0|n.words[o])+r)>>26,this.words[o]=67108863&e;for(;0!==r&&o<i.length;o++)r=(e=(0|i.words[o])+r)>>26,this.words[o]=67108863&e;if(0===r&&o<i.length&&i!==this)for(;o<i.length;o++)this.words[o]=i.words[o];return this.length=Math.max(this.length,o),i!==this&&(this.negative=1),this._strip()},r.prototype.sub=function(t){return this.clone().isub(t)};var _=function(t,e,i){var n,s,r,o=t.words,a=e.words,h=i.words,c=0,u=0|o[0],l=8191&u,f=u>>>13,d=0|o[1],p=8191&d,m=d>>>13,_=0|o[2],v=8191&_,g=_>>>13,b=0|o[3],w=8191&b,y=b>>>13,x=0|o[4],M=8191&x,T=x>>>13,O=0|o[5],E=8191&O,A=O>>>13,S=0|o[6],k=8191&S,I=S>>>13,C=0|o[7],j=8191&C,D=C>>>13,R=0|o[8],P=8191&R,N=R>>>13,F=0|o[9],z=8191&F,L=F>>>13,$=0|a[0],U=8191&$,B=$>>>13,G=0|a[1],H=8191&G,V=G>>>13,W=0|a[2],q=8191&W,Y=W>>>13,X=0|a[3],Z=8191&X,J=X>>>13,K=0|a[4],Q=8191&K,tt=K>>>13,et=0|a[5],it=8191&et,nt=et>>>13,st=0|a[6],rt=8191&st,ot=st>>>13,at=0|a[7],ht=8191&at,ct=at>>>13,ut=0|a[8],lt=8191&ut,ft=ut>>>13,dt=0|a[9],pt=8191&dt,mt=dt>>>13;i.negative=t.negative^e.negative,i.length=19;var _t=(c+(n=Math.imul(l,U))|0)+((8191&(s=(s=Math.imul(l,B))+Math.imul(f,U)|0))<<13)|0;c=((r=Math.imul(f,B))+(s>>>13)|0)+(_t>>>26)|0,_t&=67108863,n=Math.imul(p,U),s=(s=Math.imul(p,B))+Math.imul(m,U)|0,r=Math.imul(m,B);var vt=(c+(n=n+Math.imul(l,H)|0)|0)+((8191&(s=(s=s+Math.imul(l,V)|0)+Math.imul(f,H)|0))<<13)|0;c=((r=r+Math.imul(f,V)|0)+(s>>>13)|0)+(vt>>>26)|0,vt&=67108863,n=Math.imul(v,U),s=(s=Math.imul(v,B))+Math.imul(g,U)|0,r=Math.imul(g,B),n=n+Math.imul(p,H)|0,s=(s=s+Math.imul(p,V)|0)+Math.imul(m,H)|0,r=r+Math.imul(m,V)|0;var gt=(c+(n=n+Math.imul(l,q)|0)|0)+((8191&(s=(s=s+Math.imul(l,Y)|0)+Math.imul(f,q)|0))<<13)|0;c=((r=r+Math.imul(f,Y)|0)+(s>>>13)|0)+(gt>>>26)|0,gt&=67108863,n=Math.imul(w,U),s=(s=Math.imul(w,B))+Math.imul(y,U)|0,r=Math.imul(y,B),n=n+Math.imul(v,H)|0,s=(s=s+Math.imul(v,V)|0)+Math.imul(g,H)|0,r=r+Math.imul(g,V)|0,n=n+Math.imul(p,q)|0,s=(s=s+Math.imul(p,Y)|0)+Math.imul(m,q)|0,r=r+Math.imul(m,Y)|0;var bt=(c+(n=n+Math.imul(l,Z)|0)|0)+((8191&(s=(s=s+Math.imul(l,J)|0)+Math.imul(f,Z)|0))<<13)|0;c=((r=r+Math.imul(f,J)|0)+(s>>>13)|0)+(bt>>>26)|0,bt&=67108863,n=Math.imul(M,U),s=(s=Math.imul(M,B))+Math.imul(T,U)|0,r=Math.imul(T,B),n=n+Math.imul(w,H)|0,s=(s=s+Math.imul(w,V)|0)+Math.imul(y,H)|0,r=r+Math.imul(y,V)|0,n=n+Math.imul(v,q)|0,s=(s=s+Math.imul(v,Y)|0)+Math.imul(g,q)|0,r=r+Math.imul(g,Y)|0,n=n+Math.imul(p,Z)|0,s=(s=s+Math.imul(p,J)|0)+Math.imul(m,Z)|0,r=r+Math.imul(m,J)|0;var wt=(c+(n=n+Math.imul(l,Q)|0)|0)+((8191&(s=(s=s+Math.imul(l,tt)|0)+Math.imul(f,Q)|0))<<13)|0;c=((r=r+Math.imul(f,tt)|0)+(s>>>13)|0)+(wt>>>26)|0,wt&=67108863,n=Math.imul(E,U),s=(s=Math.imul(E,B))+Math.imul(A,U)|0,r=Math.imul(A,B),n=n+Math.imul(M,H)|0,s=(s=s+Math.imul(M,V)|0)+Math.imul(T,H)|0,r=r+Math.imul(T,V)|0,n=n+Math.imul(w,q)|0,s=(s=s+Math.imul(w,Y)|0)+Math.imul(y,q)|0,r=r+Math.imul(y,Y)|0,n=n+Math.imul(v,Z)|0,s=(s=s+Math.imul(v,J)|0)+Math.imul(g,Z)|0,r=r+Math.imul(g,J)|0,n=n+Math.imul(p,Q)|0,s=(s=s+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,r=r+Math.imul(m,tt)|0;var yt=(c+(n=n+Math.imul(l,it)|0)|0)+((8191&(s=(s=s+Math.imul(l,nt)|0)+Math.imul(f,it)|0))<<13)|0;c=((r=r+Math.imul(f,nt)|0)+(s>>>13)|0)+(yt>>>26)|0,yt&=67108863,n=Math.imul(k,U),s=(s=Math.imul(k,B))+Math.imul(I,U)|0,r=Math.imul(I,B),n=n+Math.imul(E,H)|0,s=(s=s+Math.imul(E,V)|0)+Math.imul(A,H)|0,r=r+Math.imul(A,V)|0,n=n+Math.imul(M,q)|0,s=(s=s+Math.imul(M,Y)|0)+Math.imul(T,q)|0,r=r+Math.imul(T,Y)|0,n=n+Math.imul(w,Z)|0,s=(s=s+Math.imul(w,J)|0)+Math.imul(y,Z)|0,r=r+Math.imul(y,J)|0,n=n+Math.imul(v,Q)|0,s=(s=s+Math.imul(v,tt)|0)+Math.imul(g,Q)|0,r=r+Math.imul(g,tt)|0,n=n+Math.imul(p,it)|0,s=(s=s+Math.imul(p,nt)|0)+Math.imul(m,it)|0,r=r+Math.imul(m,nt)|0;var xt=(c+(n=n+Math.imul(l,rt)|0)|0)+((8191&(s=(s=s+Math.imul(l,ot)|0)+Math.imul(f,rt)|0))<<13)|0;c=((r=r+Math.imul(f,ot)|0)+(s>>>13)|0)+(xt>>>26)|0,xt&=67108863,n=Math.imul(j,U),s=(s=Math.imul(j,B))+Math.imul(D,U)|0,r=Math.imul(D,B),n=n+Math.imul(k,H)|0,s=(s=s+Math.imul(k,V)|0)+Math.imul(I,H)|0,r=r+Math.imul(I,V)|0,n=n+Math.imul(E,q)|0,s=(s=s+Math.imul(E,Y)|0)+Math.imul(A,q)|0,r=r+Math.imul(A,Y)|0,n=n+Math.imul(M,Z)|0,s=(s=s+Math.imul(M,J)|0)+Math.imul(T,Z)|0,r=r+Math.imul(T,J)|0,n=n+Math.imul(w,Q)|0,s=(s=s+Math.imul(w,tt)|0)+Math.imul(y,Q)|0,r=r+Math.imul(y,tt)|0,n=n+Math.imul(v,it)|0,s=(s=s+Math.imul(v,nt)|0)+Math.imul(g,it)|0,r=r+Math.imul(g,nt)|0,n=n+Math.imul(p,rt)|0,s=(s=s+Math.imul(p,ot)|0)+Math.imul(m,rt)|0,r=r+Math.imul(m,ot)|0;var Mt=(c+(n=n+Math.imul(l,ht)|0)|0)+((8191&(s=(s=s+Math.imul(l,ct)|0)+Math.imul(f,ht)|0))<<13)|0;c=((r=r+Math.imul(f,ct)|0)+(s>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,n=Math.imul(P,U),s=(s=Math.imul(P,B))+Math.imul(N,U)|0,r=Math.imul(N,B),n=n+Math.imul(j,H)|0,s=(s=s+Math.imul(j,V)|0)+Math.imul(D,H)|0,r=r+Math.imul(D,V)|0,n=n+Math.imul(k,q)|0,s=(s=s+Math.imul(k,Y)|0)+Math.imul(I,q)|0,r=r+Math.imul(I,Y)|0,n=n+Math.imul(E,Z)|0,s=(s=s+Math.imul(E,J)|0)+Math.imul(A,Z)|0,r=r+Math.imul(A,J)|0,n=n+Math.imul(M,Q)|0,s=(s=s+Math.imul(M,tt)|0)+Math.imul(T,Q)|0,r=r+Math.imul(T,tt)|0,n=n+Math.imul(w,it)|0,s=(s=s+Math.imul(w,nt)|0)+Math.imul(y,it)|0,r=r+Math.imul(y,nt)|0,n=n+Math.imul(v,rt)|0,s=(s=s+Math.imul(v,ot)|0)+Math.imul(g,rt)|0,r=r+Math.imul(g,ot)|0,n=n+Math.imul(p,ht)|0,s=(s=s+Math.imul(p,ct)|0)+Math.imul(m,ht)|0,r=r+Math.imul(m,ct)|0;var Tt=(c+(n=n+Math.imul(l,lt)|0)|0)+((8191&(s=(s=s+Math.imul(l,ft)|0)+Math.imul(f,lt)|0))<<13)|0;c=((r=r+Math.imul(f,ft)|0)+(s>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,n=Math.imul(z,U),s=(s=Math.imul(z,B))+Math.imul(L,U)|0,r=Math.imul(L,B),n=n+Math.imul(P,H)|0,s=(s=s+Math.imul(P,V)|0)+Math.imul(N,H)|0,r=r+Math.imul(N,V)|0,n=n+Math.imul(j,q)|0,s=(s=s+Math.imul(j,Y)|0)+Math.imul(D,q)|0,r=r+Math.imul(D,Y)|0,n=n+Math.imul(k,Z)|0,s=(s=s+Math.imul(k,J)|0)+Math.imul(I,Z)|0,r=r+Math.imul(I,J)|0,n=n+Math.imul(E,Q)|0,s=(s=s+Math.imul(E,tt)|0)+Math.imul(A,Q)|0,r=r+Math.imul(A,tt)|0,n=n+Math.imul(M,it)|0,s=(s=s+Math.imul(M,nt)|0)+Math.imul(T,it)|0,r=r+Math.imul(T,nt)|0,n=n+Math.imul(w,rt)|0,s=(s=s+Math.imul(w,ot)|0)+Math.imul(y,rt)|0,r=r+Math.imul(y,ot)|0,n=n+Math.imul(v,ht)|0,s=(s=s+Math.imul(v,ct)|0)+Math.imul(g,ht)|0,r=r+Math.imul(g,ct)|0,n=n+Math.imul(p,lt)|0,s=(s=s+Math.imul(p,ft)|0)+Math.imul(m,lt)|0,r=r+Math.imul(m,ft)|0;var Ot=(c+(n=n+Math.imul(l,pt)|0)|0)+((8191&(s=(s=s+Math.imul(l,mt)|0)+Math.imul(f,pt)|0))<<13)|0;c=((r=r+Math.imul(f,mt)|0)+(s>>>13)|0)+(Ot>>>26)|0,Ot&=67108863,n=Math.imul(z,H),s=(s=Math.imul(z,V))+Math.imul(L,H)|0,r=Math.imul(L,V),n=n+Math.imul(P,q)|0,s=(s=s+Math.imul(P,Y)|0)+Math.imul(N,q)|0,r=r+Math.imul(N,Y)|0,n=n+Math.imul(j,Z)|0,s=(s=s+Math.imul(j,J)|0)+Math.imul(D,Z)|0,r=r+Math.imul(D,J)|0,n=n+Math.imul(k,Q)|0,s=(s=s+Math.imul(k,tt)|0)+Math.imul(I,Q)|0,r=r+Math.imul(I,tt)|0,n=n+Math.imul(E,it)|0,s=(s=s+Math.imul(E,nt)|0)+Math.imul(A,it)|0,r=r+Math.imul(A,nt)|0,n=n+Math.imul(M,rt)|0,s=(s=s+Math.imul(M,ot)|0)+Math.imul(T,rt)|0,r=r+Math.imul(T,ot)|0,n=n+Math.imul(w,ht)|0,s=(s=s+Math.imul(w,ct)|0)+Math.imul(y,ht)|0,r=r+Math.imul(y,ct)|0,n=n+Math.imul(v,lt)|0,s=(s=s+Math.imul(v,ft)|0)+Math.imul(g,lt)|0,r=r+Math.imul(g,ft)|0;var Et=(c+(n=n+Math.imul(p,pt)|0)|0)+((8191&(s=(s=s+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;c=((r=r+Math.imul(m,mt)|0)+(s>>>13)|0)+(Et>>>26)|0,Et&=67108863,n=Math.imul(z,q),s=(s=Math.imul(z,Y))+Math.imul(L,q)|0,r=Math.imul(L,Y),n=n+Math.imul(P,Z)|0,s=(s=s+Math.imul(P,J)|0)+Math.imul(N,Z)|0,r=r+Math.imul(N,J)|0,n=n+Math.imul(j,Q)|0,s=(s=s+Math.imul(j,tt)|0)+Math.imul(D,Q)|0,r=r+Math.imul(D,tt)|0,n=n+Math.imul(k,it)|0,s=(s=s+Math.imul(k,nt)|0)+Math.imul(I,it)|0,r=r+Math.imul(I,nt)|0,n=n+Math.imul(E,rt)|0,s=(s=s+Math.imul(E,ot)|0)+Math.imul(A,rt)|0,r=r+Math.imul(A,ot)|0,n=n+Math.imul(M,ht)|0,s=(s=s+Math.imul(M,ct)|0)+Math.imul(T,ht)|0,r=r+Math.imul(T,ct)|0,n=n+Math.imul(w,lt)|0,s=(s=s+Math.imul(w,ft)|0)+Math.imul(y,lt)|0,r=r+Math.imul(y,ft)|0;var At=(c+(n=n+Math.imul(v,pt)|0)|0)+((8191&(s=(s=s+Math.imul(v,mt)|0)+Math.imul(g,pt)|0))<<13)|0;c=((r=r+Math.imul(g,mt)|0)+(s>>>13)|0)+(At>>>26)|0,At&=67108863,n=Math.imul(z,Z),s=(s=Math.imul(z,J))+Math.imul(L,Z)|0,r=Math.imul(L,J),n=n+Math.imul(P,Q)|0,s=(s=s+Math.imul(P,tt)|0)+Math.imul(N,Q)|0,r=r+Math.imul(N,tt)|0,n=n+Math.imul(j,it)|0,s=(s=s+Math.imul(j,nt)|0)+Math.imul(D,it)|0,r=r+Math.imul(D,nt)|0,n=n+Math.imul(k,rt)|0,s=(s=s+Math.imul(k,ot)|0)+Math.imul(I,rt)|0,r=r+Math.imul(I,ot)|0,n=n+Math.imul(E,ht)|0,s=(s=s+Math.imul(E,ct)|0)+Math.imul(A,ht)|0,r=r+Math.imul(A,ct)|0,n=n+Math.imul(M,lt)|0,s=(s=s+Math.imul(M,ft)|0)+Math.imul(T,lt)|0,r=r+Math.imul(T,ft)|0;var St=(c+(n=n+Math.imul(w,pt)|0)|0)+((8191&(s=(s=s+Math.imul(w,mt)|0)+Math.imul(y,pt)|0))<<13)|0;c=((r=r+Math.imul(y,mt)|0)+(s>>>13)|0)+(St>>>26)|0,St&=67108863,n=Math.imul(z,Q),s=(s=Math.imul(z,tt))+Math.imul(L,Q)|0,r=Math.imul(L,tt),n=n+Math.imul(P,it)|0,s=(s=s+Math.imul(P,nt)|0)+Math.imul(N,it)|0,r=r+Math.imul(N,nt)|0,n=n+Math.imul(j,rt)|0,s=(s=s+Math.imul(j,ot)|0)+Math.imul(D,rt)|0,r=r+Math.imul(D,ot)|0,n=n+Math.imul(k,ht)|0,s=(s=s+Math.imul(k,ct)|0)+Math.imul(I,ht)|0,r=r+Math.imul(I,ct)|0,n=n+Math.imul(E,lt)|0,s=(s=s+Math.imul(E,ft)|0)+Math.imul(A,lt)|0,r=r+Math.imul(A,ft)|0;var kt=(c+(n=n+Math.imul(M,pt)|0)|0)+((8191&(s=(s=s+Math.imul(M,mt)|0)+Math.imul(T,pt)|0))<<13)|0;c=((r=r+Math.imul(T,mt)|0)+(s>>>13)|0)+(kt>>>26)|0,kt&=67108863,n=Math.imul(z,it),s=(s=Math.imul(z,nt))+Math.imul(L,it)|0,r=Math.imul(L,nt),n=n+Math.imul(P,rt)|0,s=(s=s+Math.imul(P,ot)|0)+Math.imul(N,rt)|0,r=r+Math.imul(N,ot)|0,n=n+Math.imul(j,ht)|0,s=(s=s+Math.imul(j,ct)|0)+Math.imul(D,ht)|0,r=r+Math.imul(D,ct)|0,n=n+Math.imul(k,lt)|0,s=(s=s+Math.imul(k,ft)|0)+Math.imul(I,lt)|0,r=r+Math.imul(I,ft)|0;var It=(c+(n=n+Math.imul(E,pt)|0)|0)+((8191&(s=(s=s+Math.imul(E,mt)|0)+Math.imul(A,pt)|0))<<13)|0;c=((r=r+Math.imul(A,mt)|0)+(s>>>13)|0)+(It>>>26)|0,It&=67108863,n=Math.imul(z,rt),s=(s=Math.imul(z,ot))+Math.imul(L,rt)|0,r=Math.imul(L,ot),n=n+Math.imul(P,ht)|0,s=(s=s+Math.imul(P,ct)|0)+Math.imul(N,ht)|0,r=r+Math.imul(N,ct)|0,n=n+Math.imul(j,lt)|0,s=(s=s+Math.imul(j,ft)|0)+Math.imul(D,lt)|0,r=r+Math.imul(D,ft)|0;var Ct=(c+(n=n+Math.imul(k,pt)|0)|0)+((8191&(s=(s=s+Math.imul(k,mt)|0)+Math.imul(I,pt)|0))<<13)|0;c=((r=r+Math.imul(I,mt)|0)+(s>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,n=Math.imul(z,ht),s=(s=Math.imul(z,ct))+Math.imul(L,ht)|0,r=Math.imul(L,ct),n=n+Math.imul(P,lt)|0,s=(s=s+Math.imul(P,ft)|0)+Math.imul(N,lt)|0,r=r+Math.imul(N,ft)|0;var jt=(c+(n=n+Math.imul(j,pt)|0)|0)+((8191&(s=(s=s+Math.imul(j,mt)|0)+Math.imul(D,pt)|0))<<13)|0;c=((r=r+Math.imul(D,mt)|0)+(s>>>13)|0)+(jt>>>26)|0,jt&=67108863,n=Math.imul(z,lt),s=(s=Math.imul(z,ft))+Math.imul(L,lt)|0,r=Math.imul(L,ft);var Dt=(c+(n=n+Math.imul(P,pt)|0)|0)+((8191&(s=(s=s+Math.imul(P,mt)|0)+Math.imul(N,pt)|0))<<13)|0;c=((r=r+Math.imul(N,mt)|0)+(s>>>13)|0)+(Dt>>>26)|0,Dt&=67108863;var Rt=(c+(n=Math.imul(z,pt))|0)+((8191&(s=(s=Math.imul(z,mt))+Math.imul(L,pt)|0))<<13)|0;return c=((r=Math.imul(L,mt))+(s>>>13)|0)+(Rt>>>26)|0,Rt&=67108863,h[0]=_t,h[1]=vt,h[2]=gt,h[3]=bt,h[4]=wt,h[5]=yt,h[6]=xt,h[7]=Mt,h[8]=Tt,h[9]=Ot,h[10]=Et,h[11]=At,h[12]=St,h[13]=kt,h[14]=It,h[15]=Ct,h[16]=jt,h[17]=Dt,h[18]=Rt,0!==c&&(h[19]=c,i.length++),i};function v(t,e,i){i.negative=e.negative^t.negative,i.length=t.length+e.length;for(var n=0,s=0,r=0;r<i.length-1;r++){var o=s;s=0;for(var a=67108863&n,h=Math.min(r,e.length-1),c=Math.max(0,r-t.length+1);c<=h;c++){var u=r-c,l=(0|t.words[u])*(0|e.words[c]),f=67108863&l;a=67108863&(f=f+a|0),s+=(o=(o=o+(l/67108864|0)|0)+(f>>>26)|0)>>>26,o&=67108863}i.words[r]=a,n=o,o=s}return 0!==n?i.words[r]=n:i.length--,i._strip()}function g(t,e,i){return v(t,e,i)}Math.imul||(_=m),r.prototype.mulTo=function(t,e){var i=this.length+t.length;return 10===this.length&&10===t.length?_(this,t,e):i<63?m(this,t,e):i<1024?v(this,t,e):g(this,t,e)},r.prototype.mul=function(t){var e=new r(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},r.prototype.mulf=function(t){var e=new r(null);return e.words=new Array(this.length+t.length),g(this,t,e)},r.prototype.imul=function(t){return this.clone().mulTo(t,this)},r.prototype.imuln=function(t){var e=t<0;e&&(t=-t),n("number"==typeof t),n(t<67108864);for(var i=0,s=0;s<this.length;s++){var r=(0|this.words[s])*t,o=(67108863&r)+(67108863&i);i>>=26,i+=r/67108864|0,i+=o>>>26,this.words[s]=67108863&o}return 0!==i&&(this.words[s]=i,this.length++),e?this.ineg():this},r.prototype.muln=function(t){return this.clone().imuln(t)},r.prototype.sqr=function(){return this.mul(this)},r.prototype.isqr=function(){return this.imul(this.clone())},r.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),i=0;i<e.length;i++){var n=i/26|0,s=i%26;e[i]=t.words[n]>>>s&1}return e}(t);if(0===e.length)return new r(1);for(var i=this,n=0;n<e.length&&0===e[n];n++,i=i.sqr());if(++n<e.length)for(var s=i.sqr();n<e.length;n++,s=s.sqr())0!==e[n]&&(i=i.mul(s));return i},r.prototype.iushln=function(t){n("number"==typeof t&&t>=0);var e,i=t%26,s=(t-i)/26,r=67108863>>>26-i<<26-i;if(0!==i){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&r,h=(0|this.words[e])-a<<i;this.words[e]=h|o,o=a>>>26-i}o&&(this.words[e]=o,this.length++)}if(0!==s){for(e=this.length-1;e>=0;e--)this.words[e+s]=this.words[e];for(e=0;e<s;e++)this.words[e]=0;this.length+=s}return this._strip()},r.prototype.ishln=function(t){return n(0===this.negative),this.iushln(t)},r.prototype.iushrn=function(t,e,i){var s;n("number"==typeof t&&t>=0),s=e?(e-e%26)/26:0;var r=t%26,o=Math.min((t-r)/26,this.length),a=67108863^67108863>>>r<<r,h=i;if(s-=o,s=Math.max(0,s),h){for(var c=0;c<o;c++)h.words[c]=this.words[c];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,c=0;c<this.length;c++)this.words[c]=this.words[c+o];else this.words[0]=0,this.length=1;var u=0;for(c=this.length-1;c>=0&&(0!==u||c>=s);c--){var l=0|this.words[c];this.words[c]=u<<26-r|l>>>r,u=l&a}return h&&0!==u&&(h.words[h.length++]=u),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},r.prototype.ishrn=function(t,e,i){return n(0===this.negative),this.iushrn(t,e,i)},r.prototype.shln=function(t){return this.clone().ishln(t)},r.prototype.ushln=function(t){return this.clone().iushln(t)},r.prototype.shrn=function(t){return this.clone().ishrn(t)},r.prototype.ushrn=function(t){return this.clone().iushrn(t)},r.prototype.testn=function(t){n("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26,s=1<<e;return!(this.length<=i)&&!!(this.words[i]&s)},r.prototype.imaskn=function(t){n("number"==typeof t&&t>=0);var e=t%26,i=(t-e)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==e&&i++,this.length=Math.min(i,this.length),0!==e){var s=67108863^67108863>>>e<<e;this.words[this.length-1]&=s}return this._strip()},r.prototype.maskn=function(t){return this.clone().imaskn(t)},r.prototype.iaddn=function(t){return n("number"==typeof t),n(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<=t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},r.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},r.prototype.isubn=function(t){if(n("number"==typeof t),n(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this._strip()},r.prototype.addn=function(t){return this.clone().iaddn(t)},r.prototype.subn=function(t){return this.clone().isubn(t)},r.prototype.iabs=function(){return this.negative=0,this},r.prototype.abs=function(){return this.clone().iabs()},r.prototype._ishlnsubmul=function(t,e,i){var s,r,o=t.length+i;this._expand(o);var a=0;for(s=0;s<t.length;s++){r=(0|this.words[s+i])+a;var h=(0|t.words[s])*e;a=((r-=67108863&h)>>26)-(h/67108864|0),this.words[s+i]=67108863&r}for(;s<this.length-i;s++)a=(r=(0|this.words[s+i])+a)>>26,this.words[s+i]=67108863&r;if(0===a)return this._strip();for(n(-1===a),a=0,s=0;s<this.length;s++)a=(r=-(0|this.words[s])+a)>>26,this.words[s]=67108863&r;return this.negative=1,this._strip()},r.prototype._wordDiv=function(t,e){var i=t.length,n=this.clone(),s=t,o=0|s.words[s.length-1];0!==(i=26-this._countBits(o))&&(s=s.ushln(i),n.iushln(i),o=0|s.words[s.length-1]);var a,h=n.length-s.length;if("mod"!==e){(a=new r(null)).length=h+1,a.words=new Array(a.length);for(var c=0;c<a.length;c++)a.words[c]=0}var u=n.clone()._ishlnsubmul(s,1,h);0===u.negative&&(n=u,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var f=67108864*(0|n.words[s.length+l])+(0|n.words[s.length+l-1]);for(f=Math.min(f/o|0,67108863),n._ishlnsubmul(s,f,l);0!==n.negative;)f--,n.negative=0,n._ishlnsubmul(s,1,l),n.isZero()||(n.negative^=1);a&&(a.words[l]=f)}return a&&a._strip(),n._strip(),"div"!==e&&0!==i&&n.iushrn(i),{div:a||null,mod:n}},r.prototype.divmod=function(t,e,i){return n(!t.isZero()),this.isZero()?{div:new r(0),mod:new r(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(s=a.div.neg()),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.iadd(t)),{div:s,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(s=a.div.neg()),{div:s,mod:a.mod}):0!=(this.negative&t.negative)?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),i&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new r(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new r(this.modrn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new r(this.modrn(t.words[0]))}:this._wordDiv(t,e);var s,o,a},r.prototype.div=function(t){return this.divmod(t,"div",!1).div},r.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},r.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},r.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var i=0!==e.div.negative?e.mod.isub(t):e.mod,n=t.ushrn(1),s=t.andln(1),r=i.cmp(n);return r<0||1===s&&0===r?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},r.prototype.modrn=function(t){var e=t<0;e&&(t=-t),n(t<=67108863);for(var i=(1<<26)%t,s=0,r=this.length-1;r>=0;r--)s=(i*s+(0|this.words[r]))%t;return e?-s:s},r.prototype.modn=function(t){return this.modrn(t)},r.prototype.idivn=function(t){var e=t<0;e&&(t=-t),n(t<=67108863);for(var i=0,s=this.length-1;s>=0;s--){var r=(0|this.words[s])+67108864*i;this.words[s]=r/t|0,i=r%t}return this._strip(),e?this.ineg():this},r.prototype.divn=function(t){return this.clone().idivn(t)},r.prototype.egcd=function(t){n(0===t.negative),n(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var s=new r(1),o=new r(0),a=new r(0),h=new r(1),c=0;e.isEven()&&i.isEven();)e.iushrn(1),i.iushrn(1),++c;for(var u=i.clone(),l=e.clone();!e.isZero();){for(var f=0,d=1;0==(e.words[0]&d)&&f<26;++f,d<<=1);if(f>0)for(e.iushrn(f);f-- >0;)(s.isOdd()||o.isOdd())&&(s.iadd(u),o.isub(l)),s.iushrn(1),o.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(u),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(i)>=0?(e.isub(i),s.isub(a),o.isub(h)):(i.isub(e),a.isub(s),h.isub(o))}return{a,b:h,gcd:i.iushln(c)}},r.prototype._invmp=function(t){n(0===t.negative),n(!t.isZero());var e=this,i=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var s,o=new r(1),a=new r(0),h=i.clone();e.cmpn(1)>0&&i.cmpn(1)>0;){for(var c=0,u=1;0==(e.words[0]&u)&&c<26;++c,u<<=1);if(c>0)for(e.iushrn(c);c-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,f=1;0==(i.words[0]&f)&&l<26;++l,f<<=1);if(l>0)for(i.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(i)>=0?(e.isub(i),o.isub(a)):(i.isub(e),a.isub(o))}return(s=0===e.cmpn(1)?o:a).cmpn(0)<0&&s.iadd(t),s},r.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),i=t.clone();e.negative=0,i.negative=0;for(var n=0;e.isEven()&&i.isEven();n++)e.iushrn(1),i.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;i.isEven();)i.iushrn(1);var s=e.cmp(i);if(s<0){var r=e;e=i,i=r}else if(0===s||0===i.cmpn(1))break;e.isub(i)}return i.iushln(n)},r.prototype.invm=function(t){return this.egcd(t).a.umod(t)},r.prototype.isEven=function(){return 0==(1&this.words[0])},r.prototype.isOdd=function(){return 1==(1&this.words[0])},r.prototype.andln=function(t){return this.words[0]&t},r.prototype.bincn=function(t){n("number"==typeof t);var e=t%26,i=(t-e)/26,s=1<<e;if(this.length<=i)return this._expand(i+1),this.words[i]|=s,this;for(var r=s,o=i;0!==r&&o<this.length;o++){var a=0|this.words[o];r=(a+=r)>>>26,a&=67108863,this.words[o]=a}return 0!==r&&(this.words[o]=r,this.length++),this},r.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},r.prototype.cmpn=function(t){var e,i=t<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this._strip(),this.length>1)e=1;else{i&&(t=-t),n(t<=67108863,"Number is too big");var s=0|this.words[0];e=s===t?0:s<t?-1:1}return 0!==this.negative?0|-e:e},r.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},r.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,i=this.length-1;i>=0;i--){var n=0|this.words[i],s=0|t.words[i];if(n!==s){n<s?e=-1:n>s&&(e=1);break}}return e},r.prototype.gtn=function(t){return 1===this.cmpn(t)},r.prototype.gt=function(t){return 1===this.cmp(t)},r.prototype.gten=function(t){return this.cmpn(t)>=0},r.prototype.gte=function(t){return this.cmp(t)>=0},r.prototype.ltn=function(t){return-1===this.cmpn(t)},r.prototype.lt=function(t){return-1===this.cmp(t)},r.prototype.lten=function(t){return this.cmpn(t)<=0},r.prototype.lte=function(t){return this.cmp(t)<=0},r.prototype.eqn=function(t){return 0===this.cmpn(t)},r.prototype.eq=function(t){return 0===this.cmp(t)},r.red=function(t){return new O(t)},r.prototype.toRed=function(t){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},r.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},r.prototype._forceRed=function(t){return this.red=t,this},r.prototype.forceRed=function(t){return n(!this.red,"Already a number in reduction context"),this._forceRed(t)},r.prototype.redAdd=function(t){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},r.prototype.redIAdd=function(t){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},r.prototype.redSub=function(t){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},r.prototype.redISub=function(t){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},r.prototype.redShl=function(t){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},r.prototype.redMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},r.prototype.redIMul=function(t){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},r.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},r.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},r.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},r.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},r.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},r.prototype.redPow=function(t){return n(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function w(t,e){this.name=t,this.p=new r(e,16),this.n=this.p.bitLength(),this.k=new r(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function y(){w.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function x(){w.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){w.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function T(){w.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function O(t){if("string"==typeof t){var e=r._prime(t);this.m=e.p,this.prime=e}else n(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){O.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new r(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}w.prototype._tmp=function(){var t=new r(null);return t.words=new Array(Math.ceil(this.n/13)),t},w.prototype.ireduce=function(t){var e,i=t;do{this.split(i,this.tmp),e=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(e>this.n);var n=e<this.n?-1:i.ucmp(this.p);return 0===n?(i.words[0]=0,i.length=1):n>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},w.prototype.split=function(t,e){t.iushrn(this.n,0,e)},w.prototype.imulK=function(t){return t.imul(this.k)},s(y,w),y.prototype.split=function(t,e){for(var i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=4194303&s,n=10;n<t.length;n++){var r=0|t.words[n];t.words[n-10]=(4194303&r)<<4|s>>>22,s=r}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},y.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,i=0;i<t.length;i++){var n=0|t.words[i];e+=977*n,t.words[i]=67108863&e,e=64*n+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},s(x,w),s(M,w),s(T,w),T.prototype.imulK=function(t){for(var e=0,i=0;i<t.length;i++){var n=19*(0|t.words[i])+e,s=67108863&n;n>>>=26,t.words[i]=s,e=n}return 0!==e&&(t.words[t.length++]=e),t},r._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new y;else if("p224"===t)e=new x;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new T}return b[t]=e,e},O.prototype._verify1=function(t){n(0===t.negative,"red works only with positives"),n(t.red,"red works only with red numbers")},O.prototype._verify2=function(t,e){n(0==(t.negative|e.negative),"red works only with positives"),n(t.red&&t.red===e.red,"red works only with red numbers")},O.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):(u(t,t.umod(this.m)._forceRed(this)),t)},O.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},O.prototype.add=function(t,e){this._verify2(t,e);var i=t.add(e);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},O.prototype.iadd=function(t,e){this._verify2(t,e);var i=t.iadd(e);return i.cmp(this.m)>=0&&i.isub(this.m),i},O.prototype.sub=function(t,e){this._verify2(t,e);var i=t.sub(e);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},O.prototype.isub=function(t,e){this._verify2(t,e);var i=t.isub(e);return i.cmpn(0)<0&&i.iadd(this.m),i},O.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},O.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},O.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},O.prototype.isqr=function(t){return this.imul(t,t.clone())},O.prototype.sqr=function(t){return this.mul(t,t)},O.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(n(e%2==1),3===e){var i=this.m.add(new r(1)).iushrn(2);return this.pow(t,i)}for(var s=this.m.subn(1),o=0;!s.isZero()&&0===s.andln(1);)o++,s.iushrn(1);n(!s.isZero());var a=new r(1).toRed(this),h=a.redNeg(),c=this.m.subn(1).iushrn(1),u=this.m.bitLength();for(u=new r(2*u*u).toRed(this);0!==this.pow(u,c).cmp(h);)u.redIAdd(h);for(var l=this.pow(u,s),f=this.pow(t,s.addn(1).iushrn(1)),d=this.pow(t,s),p=o;0!==d.cmp(a);){for(var m=d,_=0;0!==m.cmp(a);_++)m=m.redSqr();n(_<p);var v=this.pow(l,new r(1).iushln(p-_-1));f=f.redMul(v),l=v.redSqr(),d=d.redMul(l),p=_}return f},O.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},O.prototype.pow=function(t,e){if(e.isZero())return new r(1).toRed(this);if(0===e.cmpn(1))return t.clone();var i=new Array(16);i[0]=new r(1).toRed(this),i[1]=t;for(var n=2;n<i.length;n++)i[n]=this.mul(i[n-1],t);var s=i[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),n=e.length-1;n>=0;n--){for(var c=e.words[n],u=h-1;u>=0;u--){var l=c>>u&1;s!==i[0]&&(s=this.sqr(s)),0!==l||0!==o?(o<<=1,o|=l,(4===++a||0===n&&0===u)&&(s=this.mul(s,i[o]),a=0,o=0)):a=0}h=26}return s},O.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},O.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},r.mont=function(t){return new E(t)},s(E,O),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var i=t.imul(e),n=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=i.isub(n).iushrn(this.shift),r=s;return s.cmp(this.m)>=0?r=s.isub(this.m):s.cmpn(0)<0&&(r=s.iadd(this.m)),r._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new r(0)._forceRed(this);var i=t.mul(e),n=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),s=i.isub(n).iushrn(this.shift),o=s;return s.cmp(this.m)>=0?o=s.isub(this.m):s.cmpn(0)<0&&(o=s.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(void 0===e||e)},{buffer:188}],187:[function(t,e,i){var n;function s(t){this.rand=t}if(e.exports=function(t){return n||(n=new s(null)),n.generate(t)},e.exports.Rand=s,s.prototype.generate=function(t){return this._rand(t)},s.prototype._rand=function(t){if(this.rand.getBytes)return this.rand.getBytes(t);for(var e=new Uint8Array(t),i=0;i<e.length;i++)e[i]=this.rand.getByte();return e},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?s.prototype._rand=function(t){var e=new Uint8Array(t);return self.crypto.getRandomValues(e),e}:self.msCrypto&&self.msCrypto.getRandomValues?s.prototype._rand=function(t){var e=new Uint8Array(t);return self.msCrypto.getRandomValues(e),e}:"object"==typeof window&&(s.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var r=t("crypto");if("function"!=typeof r.randomBytes)throw new Error("Not supported");s.prototype._rand=function(t){return r.randomBytes(t)}}catch(t){}},{crypto:188}],188:[function(t,e,i){},{}],189:[function(t,e,i){var n=t("safe-buffer").Buffer;function s(t){n.isBuffer(t)||(t=n.from(t));for(var e=t.length/4|0,i=new Array(e),s=0;s<e;s++)i[s]=t.readUInt32BE(4*s);return i}function r(t){for(;0<t.length;t++)t[0]=0}function o(t,e,i,n,s){for(var r,o,a,h,c=i[0],u=i[1],l=i[2],f=i[3],d=t[0]^e[0],p=t[1]^e[1],m=t[2]^e[2],_=t[3]^e[3],v=4,g=1;g<s;g++)r=c[d>>>24]^u[p>>>16&255]^l[m>>>8&255]^f[255&_]^e[v++],o=c[p>>>24]^u[m>>>16&255]^l[_>>>8&255]^f[255&d]^e[v++],a=c[m>>>24]^u[_>>>16&255]^l[d>>>8&255]^f[255&p]^e[v++],h=c[_>>>24]^u[d>>>16&255]^l[p>>>8&255]^f[255&m]^e[v++],d=r,p=o,m=a,_=h;return r=(n[d>>>24]<<24|n[p>>>16&255]<<16|n[m>>>8&255]<<8|n[255&_])^e[v++],o=(n[p>>>24]<<24|n[m>>>16&255]<<16|n[_>>>8&255]<<8|n[255&d])^e[v++],a=(n[m>>>24]<<24|n[_>>>16&255]<<16|n[d>>>8&255]<<8|n[255&p])^e[v++],h=(n[_>>>24]<<24|n[d>>>16&255]<<16|n[p>>>8&255]<<8|n[255&m])^e[v++],[r>>>=0,o>>>=0,a>>>=0,h>>>=0]}var a=[0,1,2,4,8,16,32,64,128,27,54],h=function(){for(var t=new Array(256),e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;for(var i=[],n=[],s=[[],[],[],[]],r=[[],[],[],[]],o=0,a=0,h=0;h<256;++h){var c=a^a<<1^a<<2^a<<3^a<<4;c=c>>>8^255&c^99,i[o]=c,n[c]=o;var u=t[o],l=t[u],f=t[l],d=257*t[c]^16843008*c;s[0][o]=d<<24|d>>>8,s[1][o]=d<<16|d>>>16,s[2][o]=d<<8|d>>>24,s[3][o]=d,d=16843009*f^65537*l^257*u^16843008*o,r[0][c]=d<<24|d>>>8,r[1][c]=d<<16|d>>>16,r[2][c]=d<<8|d>>>24,r[3][c]=d,0===o?o=a=1:(o=u^t[t[t[f^u]]],a^=t[t[a]])}return{SBOX:i,INV_SBOX:n,SUB_MIX:s,INV_SUB_MIX:r}}();function c(t){this._key=s(t),this._reset()}c.blockSize=16,c.keySize=32,c.prototype.blockSize=c.blockSize,c.prototype.keySize=c.keySize,c.prototype._reset=function(){for(var t=this._key,e=t.length,i=e+6,n=4*(i+1),s=[],r=0;r<e;r++)s[r]=t[r];for(r=e;r<n;r++){var o=s[r-1];r%e==0?(o=o<<8|o>>>24,o=h.SBOX[o>>>24]<<24|h.SBOX[o>>>16&255]<<16|h.SBOX[o>>>8&255]<<8|h.SBOX[255&o],o^=a[r/e|0]<<24):e>6&&r%e==4&&(o=h.SBOX[o>>>24]<<24|h.SBOX[o>>>16&255]<<16|h.SBOX[o>>>8&255]<<8|h.SBOX[255&o]),s[r]=s[r-e]^o}for(var c=[],u=0;u<n;u++){var l=n-u,f=s[l-(u%4?0:4)];c[u]=u<4||l<=4?f:h.INV_SUB_MIX[0][h.SBOX[f>>>24]]^h.INV_SUB_MIX[1][h.SBOX[f>>>16&255]]^h.INV_SUB_MIX[2][h.SBOX[f>>>8&255]]^h.INV_SUB_MIX[3][h.SBOX[255&f]]}this._nRounds=i,this._keySchedule=s,this._invKeySchedule=c},c.prototype.encryptBlockRaw=function(t){return o(t=s(t),this._keySchedule,h.SUB_MIX,h.SBOX,this._nRounds)},c.prototype.encryptBlock=function(t){var e=this.encryptBlockRaw(t),i=n.allocUnsafe(16);return i.writeUInt32BE(e[0],0),i.writeUInt32BE(e[1],4),i.writeUInt32BE(e[2],8),i.writeUInt32BE(e[3],12),i},c.prototype.decryptBlock=function(t){var e=(t=s(t))[1];t[1]=t[3],t[3]=e;var i=o(t,this._invKeySchedule,h.INV_SUB_MIX,h.INV_SBOX,this._nRounds),r=n.allocUnsafe(16);return r.writeUInt32BE(i[0],0),r.writeUInt32BE(i[3],4),r.writeUInt32BE(i[2],8),r.writeUInt32BE(i[1],12),r},c.prototype.scrub=function(){r(this._keySchedule),r(this._invKeySchedule),r(this._key)},e.exports.AES=c},{"safe-buffer":494}],190:[function(t,e,i){var n=t("./aes"),s=t("safe-buffer").Buffer,r=t("cipher-base"),o=t("inherits"),a=t("./ghash"),h=t("buffer-xor"),c=t("./incr32");function u(t,e,i,o){r.call(this);var h=s.alloc(4,0);this._cipher=new n.AES(e);var u=this._cipher.encryptBlock(h);this._ghash=new a(u),i=function(t,e,i){if(12===e.length)return t._finID=s.concat([e,s.from([0,0,0,1])]),s.concat([e,s.from([0,0,0,2])]);var n=new a(i),r=e.length,o=r%16;n.update(e),o&&(o=16-o,n.update(s.alloc(o,0))),n.update(s.alloc(8,0));var h=8*r,u=s.alloc(8);u.writeUIntBE(h,0,8),n.update(u),t._finID=n.state;var l=s.from(t._finID);return c(l),l}(this,i,u),this._prev=s.from(i),this._cache=s.allocUnsafe(0),this._secCache=s.allocUnsafe(0),this._decrypt=o,this._alen=0,this._len=0,this._mode=t,this._authTag=null,this._called=!1}o(u,r),u.prototype._update=function(t){if(!this._called&&this._alen){var e=16-this._alen%16;e<16&&(e=s.alloc(e,0),this._ghash.update(e))}this._called=!0;var i=this._mode.encrypt(this,t);return this._decrypt?this._ghash.update(t):this._ghash.update(i),this._len+=t.length,i},u.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var t=h(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(t,e){var i=0;t.length!==e.length&&i++;for(var n=Math.min(t.length,e.length),s=0;s<n;++s)i+=t[s]^e[s];return i}(t,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=t,this._cipher.scrub()},u.prototype.getAuthTag=function(){if(this._decrypt||!s.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},u.prototype.setAuthTag=function(t){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=t},u.prototype.setAAD=function(t){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(t),this._alen+=t.length},e.exports=u},{"./aes":189,"./ghash":194,"./incr32":195,"buffer-xor":219,"cipher-base":221,inherits:440,"safe-buffer":494}],191:[function(t,e,i){var n=t("./encrypter"),s=t("./decrypter"),r=t("./modes/list.json");i.createCipher=i.Cipher=n.createCipher,i.createCipheriv=i.Cipheriv=n.createCipheriv,i.createDecipher=i.Decipher=s.createDecipher,i.createDecipheriv=i.Decipheriv=s.createDecipheriv,i.listCiphers=i.getCiphers=function(){return Object.keys(r)}},{"./decrypter":192,"./encrypter":193,"./modes/list.json":203}],192:[function(t,e,i){var n=t("./authCipher"),s=t("safe-buffer").Buffer,r=t("./modes"),o=t("./streamCipher"),a=t("cipher-base"),h=t("./aes"),c=t("evp_bytestokey");function u(t,e,i){a.call(this),this._cache=new l,this._last=void 0,this._cipher=new h.AES(e),this._prev=s.from(i),this._mode=t,this._autopadding=!0}function l(){this.cache=s.allocUnsafe(0)}function f(t,e,i){var a=r[t.toLowerCase()];if(!a)throw new TypeError("invalid suite type");if("string"==typeof i&&(i=s.from(i)),"GCM"!==a.mode&&i.length!==a.iv)throw new TypeError("invalid iv length "+i.length);if("string"==typeof e&&(e=s.from(e)),e.length!==a.key/8)throw new TypeError("invalid key length "+e.length);return"stream"===a.type?new o(a.module,e,i,!0):"auth"===a.type?new n(a.module,e,i,!0):new u(a.module,e,i)}t("inherits")(u,a),u.prototype._update=function(t){var e,i;this._cache.add(t);for(var n=[];e=this._cache.get(this._autopadding);)i=this._mode.decrypt(this,e),n.push(i);return s.concat(n)},u.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return function(t){var e=t[15];if(e<1||e>16)throw new Error("unable to decrypt data");var i=-1;for(;++i<e;)if(t[i+(16-e)]!==e)throw new Error("unable to decrypt data");if(16===e)return;return t.slice(0,16-e)}(this._mode.decrypt(this,t));if(t)throw new Error("data not multiple of block length")},u.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},l.prototype.add=function(t){this.cache=s.concat([this.cache,t])},l.prototype.get=function(t){var e;if(t){if(this.cache.length>16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e}else if(this.cache.length>=16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e;return null},l.prototype.flush=function(){if(this.cache.length)return this.cache},i.createDecipher=function(t,e){var i=r[t.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var n=c(e,!1,i.key,i.iv);return f(t,n.key,n.iv)},i.createDecipheriv=f},{"./aes":189,"./authCipher":190,"./modes":202,"./streamCipher":205,"cipher-base":221,evp_bytestokey:423,inherits:440,"safe-buffer":494}],193:[function(t,e,i){var n=t("./modes"),s=t("./authCipher"),r=t("safe-buffer").Buffer,o=t("./streamCipher"),a=t("cipher-base"),h=t("./aes"),c=t("evp_bytestokey");function u(t,e,i){a.call(this),this._cache=new f,this._cipher=new h.AES(e),this._prev=r.from(i),this._mode=t,this._autopadding=!0}t("inherits")(u,a),u.prototype._update=function(t){var e,i;this._cache.add(t);for(var n=[];e=this._cache.get();)i=this._mode.encrypt(this,e),n.push(i);return r.concat(n)};var l=r.alloc(16,16);function f(){this.cache=r.allocUnsafe(0)}function d(t,e,i){var a=n[t.toLowerCase()];if(!a)throw new TypeError("invalid suite type");if("string"==typeof e&&(e=r.from(e)),e.length!==a.key/8)throw new TypeError("invalid key length "+e.length);if("string"==typeof i&&(i=r.from(i)),"GCM"!==a.mode&&i.length!==a.iv)throw new TypeError("invalid iv length "+i.length);return"stream"===a.type?new o(a.module,e,i):"auth"===a.type?new s(a.module,e,i):new u(a.module,e,i)}u.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return t=this._mode.encrypt(this,t),this._cipher.scrub(),t;if(!t.equals(l))throw this._cipher.scrub(),new Error("data not multiple of block length")},u.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},f.prototype.add=function(t){this.cache=r.concat([this.cache,t])},f.prototype.get=function(){if(this.cache.length>15){var t=this.cache.slice(0,16);return this.cache=this.cache.slice(16),t}return null},f.prototype.flush=function(){for(var t=16-this.cache.length,e=r.allocUnsafe(t),i=-1;++i<t;)e.writeUInt8(t,i);return r.concat([this.cache,e])},i.createCipheriv=d,i.createCipher=function(t,e){var i=n[t.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var s=c(e,!1,i.key,i.iv);return d(t,s.key,s.iv)}},{"./aes":189,"./authCipher":190,"./modes":202,"./streamCipher":205,"cipher-base":221,evp_bytestokey:423,inherits:440,"safe-buffer":494}],194:[function(t,e,i){var n=t("safe-buffer").Buffer,s=n.alloc(16,0);function r(t){var e=n.allocUnsafe(16);return e.writeUInt32BE(t[0]>>>0,0),e.writeUInt32BE(t[1]>>>0,4),e.writeUInt32BE(t[2]>>>0,8),e.writeUInt32BE(t[3]>>>0,12),e}function o(t){this.h=t,this.state=n.alloc(16,0),this.cache=n.allocUnsafe(0)}o.prototype.ghash=function(t){for(var e=-1;++e<t.length;)this.state[e]^=t[e];this._multiply()},o.prototype._multiply=function(){for(var t,e,i,n=[(t=this.h).readUInt32BE(0),t.readUInt32BE(4),t.readUInt32BE(8),t.readUInt32BE(12)],s=[0,0,0,0],o=-1;++o<128;){for(0!=(this.state[~~(o/8)]&1<<7-o%8)&&(s[0]^=n[0],s[1]^=n[1],s[2]^=n[2],s[3]^=n[3]),i=0!=(1&n[3]),e=3;e>0;e--)n[e]=n[e]>>>1|(1&n[e-1])<<31;n[0]=n[0]>>>1,i&&(n[0]=n[0]^225<<24)}this.state=r(s)},o.prototype.update=function(t){var e;for(this.cache=n.concat([this.cache,t]);this.cache.length>=16;)e=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(e)},o.prototype.final=function(t,e){return this.cache.length&&this.ghash(n.concat([this.cache,s],16)),this.ghash(r([0,t,0,e])),this.state},e.exports=o},{"safe-buffer":494}],195:[function(t,e,i){e.exports=function(t){for(var e,i=t.length;i--;){if(255!==(e=t.readUInt8(i))){e++,t.writeUInt8(e,i);break}t.writeUInt8(0,i)}}},{}],196:[function(t,e,i){var n=t("buffer-xor");i.encrypt=function(t,e){var i=n(e,t._prev);return t._prev=t._cipher.encryptBlock(i),t._prev},i.decrypt=function(t,e){var i=t._prev;t._prev=e;var s=t._cipher.decryptBlock(e);return n(s,i)}},{"buffer-xor":219}],197:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("buffer-xor");function r(t,e,i){var r=e.length,o=s(e,t._cache);return t._cache=t._cache.slice(r),t._prev=n.concat([t._prev,i?e:o]),o}i.encrypt=function(t,e,i){for(var s,o=n.allocUnsafe(0);e.length;){if(0===t._cache.length&&(t._cache=t._cipher.encryptBlock(t._prev),t._prev=n.allocUnsafe(0)),!(t._cache.length<=e.length)){o=n.concat([o,r(t,e,i)]);break}s=t._cache.length,o=n.concat([o,r(t,e.slice(0,s),i)]),e=e.slice(s)}return o}},{"buffer-xor":219,"safe-buffer":494}],198:[function(t,e,i){var n=t("safe-buffer").Buffer;function s(t,e,i){for(var n,s,o=-1,a=0;++o<8;)n=e&1<<7-o?128:0,a+=(128&(s=t._cipher.encryptBlock(t._prev)[0]^n))>>o%8,t._prev=r(t._prev,i?n:s);return a}function r(t,e){var i=t.length,s=-1,r=n.allocUnsafe(t.length);for(t=n.concat([t,n.from([e])]);++s<i;)r[s]=t[s]<<1|t[s+1]>>7;return r}i.encrypt=function(t,e,i){for(var r=e.length,o=n.allocUnsafe(r),a=-1;++a<r;)o[a]=s(t,e[a],i);return o}},{"safe-buffer":494}],199:[function(t,e,i){var n=t("safe-buffer").Buffer;function s(t,e,i){var s=t._cipher.encryptBlock(t._prev)[0]^e;return t._prev=n.concat([t._prev.slice(1),n.from([i?e:s])]),s}i.encrypt=function(t,e,i){for(var r=e.length,o=n.allocUnsafe(r),a=-1;++a<r;)o[a]=s(t,e[a],i);return o}},{"safe-buffer":494}],200:[function(t,e,i){var n=t("buffer-xor"),s=t("safe-buffer").Buffer,r=t("../incr32");function o(t){var e=t._cipher.encryptBlockRaw(t._prev);return r(t._prev),e}i.encrypt=function(t,e){var i=Math.ceil(e.length/16),r=t._cache.length;t._cache=s.concat([t._cache,s.allocUnsafe(16*i)]);for(var a=0;a<i;a++){var h=o(t),c=r+16*a;t._cache.writeUInt32BE(h[0],c+0),t._cache.writeUInt32BE(h[1],c+4),t._cache.writeUInt32BE(h[2],c+8),t._cache.writeUInt32BE(h[3],c+12)}var u=t._cache.slice(0,e.length);return t._cache=t._cache.slice(e.length),n(e,u)}},{"../incr32":195,"buffer-xor":219,"safe-buffer":494}],201:[function(t,e,i){i.encrypt=function(t,e){return t._cipher.encryptBlock(e)},i.decrypt=function(t,e){return t._cipher.decryptBlock(e)}},{}],202:[function(t,e,i){var n={ECB:t("./ecb"),CBC:t("./cbc"),CFB:t("./cfb"),CFB8:t("./cfb8"),CFB1:t("./cfb1"),OFB:t("./ofb"),CTR:t("./ctr"),GCM:t("./ctr")},s=t("./list.json");for(var r in s)s[r].module=n[s[r].mode];e.exports=s},{"./cbc":196,"./cfb":197,"./cfb1":198,"./cfb8":199,"./ctr":200,"./ecb":201,"./list.json":203,"./ofb":204}],203:[function(t,e,i){e.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},{}],204:[function(t,e,i){(function(e){(function(){var n=t("buffer-xor");function s(t){return t._prev=t._cipher.encryptBlock(t._prev),t._prev}i.encrypt=function(t,i){for(;t._cache.length<i.length;)t._cache=e.concat([t._cache,s(t)]);var r=t._cache.slice(0,i.length);return t._cache=t._cache.slice(i.length),n(i,r)}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:220,"buffer-xor":219}],205:[function(t,e,i){var n=t("./aes"),s=t("safe-buffer").Buffer,r=t("cipher-base");function o(t,e,i,o){r.call(this),this._cipher=new n.AES(e),this._prev=s.from(i),this._cache=s.allocUnsafe(0),this._secCache=s.allocUnsafe(0),this._decrypt=o,this._mode=t}t("inherits")(o,r),o.prototype._update=function(t){return this._mode.encrypt(this,t,this._decrypt)},o.prototype._final=function(){this._cipher.scrub()},e.exports=o},{"./aes":189,"cipher-base":221,inherits:440,"safe-buffer":494}],206:[function(t,e,i){var n=t("browserify-des"),s=t("browserify-aes/browser"),r=t("browserify-aes/modes"),o=t("browserify-des/modes"),a=t("evp_bytestokey");function h(t,e,i){if(t=t.toLowerCase(),r[t])return s.createCipheriv(t,e,i);if(o[t])return new n({key:e,iv:i,mode:t});throw new TypeError("invalid suite type")}function c(t,e,i){if(t=t.toLowerCase(),r[t])return s.createDecipheriv(t,e,i);if(o[t])return new n({key:e,iv:i,mode:t,decrypt:!0});throw new TypeError("invalid suite type")}i.createCipher=i.Cipher=function(t,e){var i,n;if(t=t.toLowerCase(),r[t])i=r[t].key,n=r[t].iv;else{if(!o[t])throw new TypeError("invalid suite type");i=8*o[t].key,n=o[t].iv}var s=a(e,!1,i,n);return h(t,s.key,s.iv)},i.createCipheriv=i.Cipheriv=h,i.createDecipher=i.Decipher=function(t,e){var i,n;if(t=t.toLowerCase(),r[t])i=r[t].key,n=r[t].iv;else{if(!o[t])throw new TypeError("invalid suite type");i=8*o[t].key,n=o[t].iv}var s=a(e,!1,i,n);return c(t,s.key,s.iv)},i.createDecipheriv=i.Decipheriv=c,i.listCiphers=i.getCiphers=function(){return Object.keys(o).concat(s.getCiphers())}},{"browserify-aes/browser":191,"browserify-aes/modes":202,"browserify-des":207,"browserify-des/modes":208,evp_bytestokey:423}],207:[function(t,e,i){var n=t("cipher-base"),s=t("des.js"),r=t("inherits"),o=t("safe-buffer").Buffer,a={"des-ede3-cbc":s.CBC.instantiate(s.EDE),"des-ede3":s.EDE,"des-ede-cbc":s.CBC.instantiate(s.EDE),"des-ede":s.EDE,"des-cbc":s.CBC.instantiate(s.DES),"des-ecb":s.DES};function h(t){n.call(this);var e,i=t.mode.toLowerCase(),s=a[i];e=t.decrypt?"decrypt":"encrypt";var r=t.key;o.isBuffer(r)||(r=o.from(r)),"des-ede"!==i&&"des-ede-cbc"!==i||(r=o.concat([r,r.slice(0,8)]));var h=t.iv;o.isBuffer(h)||(h=o.from(h)),this._des=s.create({key:r,iv:h,type:e})}a.des=a["des-cbc"],a.des3=a["des-ede3-cbc"],e.exports=h,r(h,n),h.prototype._update=function(t){return o.from(this._des.update(t))},h.prototype._final=function(){return o.from(this._des.final())}},{"cipher-base":221,"des.js":394,inherits:440,"safe-buffer":494}],208:[function(t,e,i){i["des-ecb"]={key:8,iv:0},i["des-cbc"]=i.des={key:8,iv:8},i["des-ede3-cbc"]=i.des3={key:24,iv:8},i["des-ede3"]={key:24,iv:0},i["des-ede-cbc"]={key:16,iv:8},i["des-ede"]={key:16,iv:0}},{}],209:[function(t,e,i){(function(i){(function(){var n=t("bn.js"),s=t("randombytes");function r(t){var e,i=t.modulus.byteLength();do{e=new n(s(i))}while(e.cmp(t.modulus)>=0||!e.umod(t.prime1)||!e.umod(t.prime2));return e}function o(t,e){var s=function(t){var e=r(t);return{blinder:e.toRed(n.mont(t.modulus)).redPow(new n(t.publicExponent)).fromRed(),unblinder:e.invm(t.modulus)}}(e),o=e.modulus.byteLength(),a=new n(t).mul(s.blinder).umod(e.modulus),h=a.toRed(n.mont(e.prime1)),c=a.toRed(n.mont(e.prime2)),u=e.coefficient,l=e.prime1,f=e.prime2,d=h.redPow(e.exponent1).fromRed(),p=c.redPow(e.exponent2).fromRed(),m=d.isub(p).imul(u).umod(l).imul(f);return p.iadd(m).imul(s.unblinder).umod(e.modulus).toArrayLike(i,"be",o)}o.getr=r,e.exports=o}).call(this)}).call(this,t("buffer").Buffer)},{"bn.js":186,buffer:220,randombytes:475}],210:[function(t,e,i){e.exports=t("./browser/algorithms.json")},{"./browser/algorithms.json":211}],211:[function(t,e,i){e.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},{}],212:[function(t,e,i){e.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},{}],213:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("create-hash"),r=t("readable-stream"),o=t("inherits"),a=t("./sign"),h=t("./verify"),c=t("./algorithms.json");function u(t){r.Writable.call(this);var e=c[t];if(!e)throw new Error("Unknown message digest");this._hashType=e.hash,this._hash=s(e.hash),this._tag=e.id,this._signType=e.sign}function l(t){r.Writable.call(this);var e=c[t];if(!e)throw new Error("Unknown message digest");this._hash=s(e.hash),this._tag=e.id,this._signType=e.sign}function f(t){return new u(t)}function d(t){return new l(t)}Object.keys(c).forEach((function(t){c[t].id=n.from(c[t].id,"hex"),c[t.toLowerCase()]=c[t]})),o(u,r.Writable),u.prototype._write=function(t,e,i){this._hash.update(t),i()},u.prototype.update=function(t,e){return"string"==typeof t&&(t=n.from(t,e)),this._hash.update(t),this},u.prototype.sign=function(t,e){this.end();var i=this._hash.digest(),n=a(i,t,this._hashType,this._signType,this._tag);return e?n.toString(e):n},o(l,r.Writable),l.prototype._write=function(t,e,i){this._hash.update(t),i()},l.prototype.update=function(t,e){return"string"==typeof t&&(t=n.from(t,e)),this._hash.update(t),this},l.prototype.verify=function(t,e,i){"string"==typeof e&&(e=n.from(e,i)),this.end();var s=this._hash.digest();return h(e,s,t,this._signType,this._tag)},e.exports={Sign:f,Verify:d,createSign:f,createVerify:d}},{"./algorithms.json":211,"./sign":214,"./verify":215,"create-hash":386,inherits:440,"readable-stream":491,"safe-buffer":494}],214:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("create-hmac"),r=t("browserify-rsa"),o=t("elliptic").ec,a=t("bn.js"),h=t("parse-asn1"),c=t("./curves.json");function u(t,e,i,r){if((t=n.from(t.toArray())).length<e.byteLength()){var o=n.alloc(e.byteLength()-t.length);t=n.concat([o,t])}var a=i.length,h=function(t,e){t=(t=l(t,e)).mod(e);var i=n.from(t.toArray());if(i.length<e.byteLength()){var s=n.alloc(e.byteLength()-i.length);i=n.concat([s,i])}return i}(i,e),c=n.alloc(a);c.fill(1);var u=n.alloc(a);return u=s(r,u).update(c).update(n.from([0])).update(t).update(h).digest(),c=s(r,u).update(c).digest(),{k:u=s(r,u).update(c).update(n.from([1])).update(t).update(h).digest(),v:c=s(r,u).update(c).digest()}}function l(t,e){var i=new a(t),n=(t.length<<3)-e.bitLength();return n>0&&i.ishrn(n),i}function f(t,e,i){var r,o;do{for(r=n.alloc(0);8*r.length<t.bitLength();)e.v=s(i,e.k).update(e.v).digest(),r=n.concat([r,e.v]);o=l(r,t),e.k=s(i,e.k).update(e.v).update(n.from([0])).digest(),e.v=s(i,e.k).update(e.v).digest()}while(-1!==o.cmp(t));return o}function d(t,e,i,n){return t.toRed(a.mont(i)).redPow(e).fromRed().mod(n)}e.exports=function(t,e,i,s,p){var m=h(e);if(m.curve){if("ecdsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong private key type");return function(t,e){var i=c[e.curve.join(".")];if(!i)throw new Error("unknown curve "+e.curve.join("."));var s=new o(i).keyFromPrivate(e.privateKey).sign(t);return n.from(s.toDER())}(t,m)}if("dsa"===m.type){if("dsa"!==s)throw new Error("wrong private key type");return function(t,e,i){var s,r=e.params.priv_key,o=e.params.p,h=e.params.q,c=e.params.g,p=new a(0),m=l(t,h).mod(h),_=!1,v=u(r,h,t,i);for(;!1===_;)s=f(h,v,i),p=d(c,s,o,h),0===(_=s.invm(h).imul(m.add(r.mul(p))).mod(h)).cmpn(0)&&(_=!1,p=new a(0));return function(t,e){t=t.toArray(),e=e.toArray(),128&t[0]&&(t=[0].concat(t));128&e[0]&&(e=[0].concat(e));var i=[48,t.length+e.length+4,2,t.length];return i=i.concat(t,[2,e.length],e),n.from(i)}(p,_)}(t,m,i)}if("rsa"!==s&&"ecdsa/rsa"!==s)throw new Error("wrong private key type");t=n.concat([p,t]);for(var _=m.modulus.byteLength(),v=[0,1];t.length+v.length+1<_;)v.push(255);v.push(0);for(var g=-1;++g<t.length;)v.push(t[g]);return r(v,m)},e.exports.getKey=u,e.exports.makeKey=f},{"./curves.json":212,"bn.js":186,"browserify-rsa":209,"create-hmac":388,elliptic:405,"parse-asn1":459,"safe-buffer":494}],215:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("bn.js"),r=t("elliptic").ec,o=t("parse-asn1"),a=t("./curves.json");function h(t,e){if(t.cmpn(0)<=0)throw new Error("invalid sig");if(t.cmp(e)>=e)throw new Error("invalid sig")}e.exports=function(t,e,i,c,u){var l=o(i);if("ec"===l.type){if("ecdsa"!==c&&"ecdsa/rsa"!==c)throw new Error("wrong public key type");return function(t,e,i){var n=a[i.data.algorithm.curve.join(".")];if(!n)throw new Error("unknown curve "+i.data.algorithm.curve.join("."));var s=new r(n),o=i.data.subjectPrivateKey.data;return s.verify(e,t,o)}(t,e,l)}if("dsa"===l.type){if("dsa"!==c)throw new Error("wrong public key type");return function(t,e,i){var n=i.data.p,r=i.data.q,a=i.data.g,c=i.data.pub_key,u=o.signature.decode(t,"der"),l=u.s,f=u.r;h(l,r),h(f,r);var d=s.mont(n),p=l.invm(r);return 0===a.toRed(d).redPow(new s(e).mul(p).mod(r)).fromRed().mul(c.toRed(d).redPow(f.mul(p).mod(r)).fromRed()).mod(n).mod(r).cmp(f)}(t,e,l)}if("rsa"!==c&&"ecdsa/rsa"!==c)throw new Error("wrong public key type");e=n.concat([u,e]);for(var f=l.modulus.byteLength(),d=[1],p=0;e.length+d.length+2<f;)d.push(255),p++;d.push(0);for(var m=-1;++m<e.length;)d.push(e[m]);d=n.from(d);var _=s.mont(l.modulus);t=(t=new s(t).toRed(_)).redPow(new s(l.publicExponent)),t=n.from(t.fromRed().toArray());var v=p<8?1:0;for(f=Math.min(t.length,d.length),t.length!==d.length&&(v=1),m=-1;++m<f;)v|=t[m]^d[m];return 0===v}},{"./curves.json":212,"bn.js":186,elliptic:405,"parse-asn1":459,"safe-buffer":494}],216:[function(t,e,i){},{}],217:[function(t,e,i){var n=t("buffer"),s=n.Buffer;function r(t,e){for(var i in t)e[i]=t[i]}function o(t,e,i){return s(t,e,i)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=n:(r(n,i),i.Buffer=o),r(s,o),o.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return s(t,e,i)},o.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=s(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return s(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:220}],218:[function(t,e,i){var n=t("safe-buffer").Buffer,s=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function r(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===s||!s(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=h,this.end=c,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=u,this.end=l,e=3;break;default:return this.write=f,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,i=function(t,e,i){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==i?i:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function h(t,e){if((t.length-e)%2==0){var i=t.toString("utf16le",e);if(i){var n=i.charCodeAt(i.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function c(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,i)}return e}function u(t,e){var i=(t.length-e)%3;return 0===i?t.toString("base64",e):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-i))}function l(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(t){return t.toString(this.encoding)}function d(t){return t&&t.length?this.write(t):""}i.StringDecoder=r,r.prototype.write=function(t){if(0===t.length)return"";var e,i;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<t.length?e?e+this.text(t,i):this.text(t,i):e||""},r.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},r.prototype.text=function(t,e){var i=function(t,e,i){var n=e.length-1;if(n<i)return 0;var s=o(e[n]);if(s>=0)return s>0&&(t.lastNeed=s-1),s;if(--n<i||-2===s)return 0;if((s=o(e[n]))>=0)return s>0&&(t.lastNeed=s-2),s;if(--n<i||-2===s)return 0;if((s=o(e[n]))>=0)return s>0&&(2===s?s=0:t.lastNeed=s-3),s;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=i;var n=t.length-(i-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},r.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":217}],219:[function(t,e,i){(function(t){(function(){e.exports=function(e,i){for(var n=Math.min(e.length,i.length),s=new t(n),r=0;r<n;++r)s[r]=e[r]^i[r];return s}}).call(this)}).call(this,t("buffer").Buffer)},{buffer:220}],220:[function(t,e,i){(function(e){(function(){var e=t("base64-js"),n=t("ieee754");i.Buffer=r,i.SlowBuffer=function(t){+t!=t&&(t=0);return r.alloc(+t)},i.INSPECT_MAX_BYTES=50;function s(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=r.prototype,e}function r(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return h(t)}return o(t,e,i)}function o(t,e,i){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!r.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var i=0|l(t,e),n=s(i),o=n.write(t,e);o!==i&&(n=n.slice(0,o));return n}(t,e);if(ArrayBuffer.isView(t))return c(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(z(t,ArrayBuffer)||t&&z(t.buffer,ArrayBuffer))return function(t,e,i){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===e&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,e):new Uint8Array(t,e,i);return n.__proto__=r.prototype,n}(t,e,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return r.from(n,e,i);var o=function(t){if(r.isBuffer(t)){var e=0|u(t.length),i=s(e);return 0===i.length||t.copy(i,0,0,e),i}if(void 0!==t.length)return"number"!=typeof t.length||L(t.length)?s(0):c(t);if("Buffer"===t.type&&Array.isArray(t.data))return c(t.data)}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return r.from(t[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function h(t){return a(t),s(t<0?0:0|u(t))}function c(t){for(var e=t.length<0?0:0|u(t.length),i=s(e),n=0;n<e;n+=1)i[n]=255&t[n];return i}function u(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function l(t,e){if(r.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var i=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===i)return 0;for(var s=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return P(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return N(t).length;default:if(s)return n?-1:P(t).length;e=(""+e).toLowerCase(),s=!0}}function f(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return E(this,e,i);case"utf8":case"utf-8":return M(this,e,i);case"ascii":return T(this,e,i);case"latin1":case"binary":return O(this,e,i);case"base64":return x(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function d(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function p(t,e,i,n,s){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),L(i=+i)&&(i=s?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(s)return-1;i=t.length-1}else if(i<0){if(!s)return-1;i=0}if("string"==typeof e&&(e=r.from(e,n)),r.isBuffer(e))return 0===e.length?-1:m(t,e,i,n,s);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):m(t,[e],i,n,s);throw new TypeError("val must be string, number or Buffer")}function m(t,e,i,n,s){var r,o=1,a=t.length,h=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,i/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(s){var u=-1;for(r=i;r<a;r++)if(c(t,r)===c(e,-1===u?0:r-u)){if(-1===u&&(u=r),r-u+1===h)return u*o}else-1!==u&&(r-=r-u),u=-1}else for(i+h>a&&(i=a-h),r=i;r>=0;r--){for(var l=!0,f=0;f<h;f++)if(c(t,r+f)!==c(e,f)){l=!1;break}if(l)return r}return-1}function _(t,e,i,n){i=Number(i)||0;var s=t.length-i;n?(n=Number(n))>s&&(n=s):n=s;var r=e.length;n>r/2&&(n=r/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(L(a))return o;t[i+o]=a}return o}function v(t,e,i,n){return F(P(e,t.length-i),t,i,n)}function g(t,e,i,n){return F(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function b(t,e,i,n){return g(t,e,i,n)}function w(t,e,i,n){return F(N(e),t,i,n)}function y(t,e,i,n){return F(function(t,e){for(var i,n,s,r=[],o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),n=i>>8,s=i%256,r.push(s),r.push(n);return r}(e,t.length-i),t,i,n)}function x(t,i,n){return 0===i&&n===t.length?e.fromByteArray(t):e.fromByteArray(t.slice(i,n))}function M(t,e,i){i=Math.min(t.length,i);for(var n=[],s=e;s<i;){var r,o,a,h,c=t[s],u=null,l=c>239?4:c>223?3:c>191?2:1;if(s+l<=i)switch(l){case 1:c<128&&(u=c);break;case 2:128==(192&(r=t[s+1]))&&(h=(31&c)<<6|63&r)>127&&(u=h);break;case 3:r=t[s+1],o=t[s+2],128==(192&r)&&128==(192&o)&&(h=(15&c)<<12|(63&r)<<6|63&o)>2047&&(h<55296||h>57343)&&(u=h);break;case 4:r=t[s+1],o=t[s+2],a=t[s+3],128==(192&r)&&128==(192&o)&&128==(192&a)&&(h=(15&c)<<18|(63&r)<<12|(63&o)<<6|63&a)>65535&&h<1114112&&(u=h)}null===u?(u=65533,l=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),s+=l}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var i="",n=0;for(;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return i}(n)}i.kMaxLength=2147483647,r.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}(),r.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(r.prototype,"parent",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.buffer}}),Object.defineProperty(r.prototype,"offset",{enumerable:!0,get:function(){if(r.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&r[Symbol.species]===r&&Object.defineProperty(r,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),r.poolSize=8192,r.from=function(t,e,i){return o(t,e,i)},r.prototype.__proto__=Uint8Array.prototype,r.__proto__=Uint8Array,r.alloc=function(t,e,i){return function(t,e,i){return a(t),t<=0?s(t):void 0!==e?"string"==typeof i?s(t).fill(e,i):s(t).fill(e):s(t)}(t,e,i)},r.allocUnsafe=function(t){return h(t)},r.allocUnsafeSlow=function(t){return h(t)},r.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==r.prototype},r.compare=function(t,e){if(z(t,Uint8Array)&&(t=r.from(t,t.offset,t.byteLength)),z(e,Uint8Array)&&(e=r.from(e,e.offset,e.byteLength)),!r.isBuffer(t)||!r.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var i=t.length,n=e.length,s=0,o=Math.min(i,n);s<o;++s)if(t[s]!==e[s]){i=t[s],n=e[s];break}return i<n?-1:n<i?1:0},r.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},r.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return r.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=r.allocUnsafe(e),s=0;for(i=0;i<t.length;++i){var o=t[i];if(z(o,Uint8Array)&&(o=r.from(o)),!r.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,s),s+=o.length}return n},r.byteLength=l,r.prototype._isBuffer=!0,r.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},r.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},r.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},r.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?M(this,0,t):f.apply(this,arguments)},r.prototype.toLocaleString=r.prototype.toString,r.prototype.equals=function(t){if(!r.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===r.compare(this,t)},r.prototype.inspect=function(){var t="",e=i.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},r.prototype.compare=function(t,e,i,n,s){if(z(t,Uint8Array)&&(t=r.from(t,t.offset,t.byteLength)),!r.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),e<0||i>t.length||n<0||s>this.length)throw new RangeError("out of range index");if(n>=s&&e>=i)return 0;if(n>=s)return-1;if(e>=i)return 1;if(this===t)return 0;for(var o=(s>>>=0)-(n>>>=0),a=(i>>>=0)-(e>>>=0),h=Math.min(o,a),c=this.slice(n,s),u=t.slice(e,i),l=0;l<h;++l)if(c[l]!==u[l]){o=c[l],a=u[l];break}return o<a?-1:a<o?1:0},r.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},r.prototype.indexOf=function(t,e,i){return p(this,t,e,i,!0)},r.prototype.lastIndexOf=function(t,e,i){return p(this,t,e,i,!1)},r.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var s=this.length-e;if((void 0===i||i>s)&&(i=s),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var r=!1;;)switch(n){case"hex":return _(this,t,e,i);case"utf8":case"utf-8":return v(this,t,e,i);case"ascii":return g(this,t,e,i);case"latin1":case"binary":return b(this,t,e,i);case"base64":return w(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y(this,t,e,i);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),r=!0}},r.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function T(t,e,i){var n="";i=Math.min(t.length,i);for(var s=e;s<i;++s)n+=String.fromCharCode(127&t[s]);return n}function O(t,e,i){var n="";i=Math.min(t.length,i);for(var s=e;s<i;++s)n+=String.fromCharCode(t[s]);return n}function E(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var s="",r=e;r<i;++r)s+=R(t[r]);return s}function A(t,e,i){for(var n=t.slice(e,i),s="",r=0;r<n.length;r+=2)s+=String.fromCharCode(n[r]+256*n[r+1]);return s}function S(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function k(t,e,i,n,s,o){if(!r.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<o)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function I(t,e,i,n,s,r){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function C(t,e,i,s,r){return e=+e,i>>>=0,r||I(t,0,i,4),n.write(t,e,i,s,23,4),i+4}function j(t,e,i,s,r){return e=+e,i>>>=0,r||I(t,0,i,8),n.write(t,e,i,s,52,8),i+8}r.prototype.slice=function(t,e){var i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);var n=this.subarray(t,e);return n.__proto__=r.prototype,n},r.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||S(t,e,this.length);for(var n=this[t],s=1,r=0;++r<e&&(s*=256);)n+=this[t+r]*s;return n},r.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||S(t,e,this.length);for(var n=this[t+--e],s=1;e>0&&(s*=256);)n+=this[t+--e]*s;return n},r.prototype.readUInt8=function(t,e){return t>>>=0,e||S(t,1,this.length),this[t]},r.prototype.readUInt16LE=function(t,e){return t>>>=0,e||S(t,2,this.length),this[t]|this[t+1]<<8},r.prototype.readUInt16BE=function(t,e){return t>>>=0,e||S(t,2,this.length),this[t]<<8|this[t+1]},r.prototype.readUInt32LE=function(t,e){return t>>>=0,e||S(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},r.prototype.readUInt32BE=function(t,e){return t>>>=0,e||S(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},r.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||S(t,e,this.length);for(var n=this[t],s=1,r=0;++r<e&&(s*=256);)n+=this[t+r]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*e)),n},r.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||S(t,e,this.length);for(var n=e,s=1,r=this[t+--n];n>0&&(s*=256);)r+=this[t+--n]*s;return r>=(s*=128)&&(r-=Math.pow(2,8*e)),r},r.prototype.readInt8=function(t,e){return t>>>=0,e||S(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},r.prototype.readInt16LE=function(t,e){t>>>=0,e||S(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},r.prototype.readInt16BE=function(t,e){t>>>=0,e||S(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},r.prototype.readInt32LE=function(t,e){return t>>>=0,e||S(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},r.prototype.readInt32BE=function(t,e){return t>>>=0,e||S(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},r.prototype.readFloatLE=function(t,e){return t>>>=0,e||S(t,4,this.length),n.read(this,t,!0,23,4)},r.prototype.readFloatBE=function(t,e){return t>>>=0,e||S(t,4,this.length),n.read(this,t,!1,23,4)},r.prototype.readDoubleLE=function(t,e){return t>>>=0,e||S(t,8,this.length),n.read(this,t,!0,52,8)},r.prototype.readDoubleBE=function(t,e){return t>>>=0,e||S(t,8,this.length),n.read(this,t,!1,52,8)},r.prototype.writeUIntLE=function(t,e,i,n){(t=+t,e>>>=0,i>>>=0,n)||k(this,t,e,i,Math.pow(2,8*i)-1,0);var s=1,r=0;for(this[e]=255&t;++r<i&&(s*=256);)this[e+r]=t/s&255;return e+i},r.prototype.writeUIntBE=function(t,e,i,n){(t=+t,e>>>=0,i>>>=0,n)||k(this,t,e,i,Math.pow(2,8*i)-1,0);var s=i-1,r=1;for(this[e+s]=255&t;--s>=0&&(r*=256);)this[e+s]=t/r&255;return e+i},r.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,1,255,0),this[e]=255&t,e+1},r.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},r.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},r.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},r.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},r.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e>>>=0,!n){var s=Math.pow(2,8*i-1);k(this,t,e,i,s-1,-s)}var r=0,o=1,a=0;for(this[e]=255&t;++r<i&&(o*=256);)t<0&&0===a&&0!==this[e+r-1]&&(a=1),this[e+r]=(t/o>>0)-a&255;return e+i},r.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e>>>=0,!n){var s=Math.pow(2,8*i-1);k(this,t,e,i,s-1,-s)}var r=i-1,o=1,a=0;for(this[e+r]=255&t;--r>=0&&(o*=256);)t<0&&0===a&&0!==this[e+r+1]&&(a=1),this[e+r]=(t/o>>0)-a&255;return e+i},r.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},r.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},r.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},r.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},r.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},r.prototype.writeFloatLE=function(t,e,i){return C(this,t,e,!0,i)},r.prototype.writeFloatBE=function(t,e,i){return C(this,t,e,!1,i)},r.prototype.writeDoubleLE=function(t,e,i){return j(this,t,e,!0,i)},r.prototype.writeDoubleBE=function(t,e,i){return j(this,t,e,!1,i)},r.prototype.copy=function(t,e,i,n){if(!r.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var s=n-i;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,i,n);else if(this===t&&i<e&&e<n)for(var o=s-1;o>=0;--o)t[o+e]=this[o+i];else Uint8Array.prototype.set.call(t,this.subarray(i,n),e);return s},r.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!r.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var s=t.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(t=s)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var o;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(o=e;o<i;++o)this[o]=t;else{var a=r.isBuffer(t)?t:r.from(t,n),h=a.length;if(0===h)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<i-e;++o)this[o+e]=a[o%h]}return this};var D=/[^+/0-9A-Za-z-_]/g;function R(t){return t<16?"0"+t.toString(16):t.toString(16)}function P(t,e){var i;e=e||1/0;for(var n=t.length,s=null,r=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!s){if(i>56319){(e-=3)>-1&&r.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&r.push(239,191,189);continue}s=i;continue}if(i<56320){(e-=3)>-1&&r.push(239,191,189),s=i;continue}i=65536+(s-55296<<10|i-56320)}else s&&(e-=3)>-1&&r.push(239,191,189);if(s=null,i<128){if((e-=1)<0)break;r.push(i)}else if(i<2048){if((e-=2)<0)break;r.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;r.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;r.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return r}function N(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function F(t,e,i,n){for(var s=0;s<n&&!(s+i>=e.length||s>=t.length);++s)e[s+i]=t[s];return s}function z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function L(t){return t!=t}}).call(this)}).call(this,t("buffer").Buffer)},{"base64-js":185,buffer:220,ieee754:439}],221:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("stream").Transform,r=t("string_decoder").StringDecoder;function o(t){s.call(this),this.hashMode="string"==typeof t,this.hashMode?this[t]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}t("inherits")(o,s),o.prototype.update=function(t,e,i){"string"==typeof t&&(t=n.from(t,e));var s=this._update(t);return this.hashMode?this:(i&&(s=this._toString(s,i)),s)},o.prototype.setAutoPadding=function(){},o.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},o.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},o.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},o.prototype._transform=function(t,e,i){var n;try{this.hashMode?this._update(t):this.push(this._update(t))}catch(t){n=t}finally{i(n)}},o.prototype._flush=function(t){var e;try{this.push(this.__final())}catch(t){e=t}t(e)},o.prototype._finalOrDigest=function(t){var e=this.__final()||n.alloc(0);return t&&(e=this._toString(e,t,!0)),e},o.prototype._toString=function(t,e,i){if(this._decoder||(this._decoder=new r(e),this._encoding=e),this._encoding!==e)throw new Error("can't switch encodings");var n=this._decoder.write(t);return i&&(n+=this._decoder.end()),n},e.exports=o},{inherits:440,"safe-buffer":494,stream:505,string_decoder:218}],222:[function(t,e,i){var n=t("../internals/is-callable"),s=t("../internals/try-to-string"),r=TypeError;e.exports=function(t){if(n(t))return t;throw new r(s(t)+" is not a function")}},{"../internals/is-callable":285,"../internals/try-to-string":349}],223:[function(t,e,i){var n=t("../internals/is-constructor"),s=t("../internals/try-to-string"),r=TypeError;e.exports=function(t){if(n(t))return t;throw new r(s(t)+" is not a constructor")}},{"../internals/is-constructor":286,"../internals/try-to-string":349}],224:[function(t,e,i){var n=t("../internals/is-callable"),s=String,r=TypeError;e.exports=function(t){if("object"==typeof t||n(t))return t;throw new r("Can't set "+s(t)+" as a prototype")}},{"../internals/is-callable":285}],225:[function(t,e,i){var n=t("../internals/well-known-symbol"),s=t("../internals/object-create"),r=t("../internals/object-define-property").f,o=n("unscopables"),a=Array.prototype;void 0===a[o]&&r(a,o,{configurable:!0,value:s(null)}),e.exports=function(t){a[o][t]=!0}},{"../internals/object-create":306,"../internals/object-define-property":308,"../internals/well-known-symbol":357}],226:[function(t,e,i){var n=t("../internals/object-is-prototype-of"),s=TypeError;e.exports=function(t,e){if(n(e,t))return t;throw new s("Incorrect invocation")}},{"../internals/object-is-prototype-of":314}],227:[function(t,e,i){var n=t("../internals/is-object"),s=String,r=TypeError;e.exports=function(t){if(n(t))return t;throw new r(s(t)+" is not an object")}},{"../internals/is-object":289}],228:[function(t,e,i){var n=t("../internals/to-indexed-object"),s=t("../internals/to-absolute-index"),r=t("../internals/length-of-array-like"),o=function(t){return function(e,i,o){var a,h=n(e),c=r(h),u=s(o,c);if(t&&i!=i){for(;c>u;)if((a=h[u++])!=a)return!0}else for(;c>u;u++)if((t||u in h)&&h[u]===i)return t||u||0;return!t&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},{"../internals/length-of-array-like":299,"../internals/to-absolute-index":340,"../internals/to-indexed-object":341}],229:[function(t,e,i){var n=t("../internals/function-bind-context"),s=t("../internals/function-uncurry-this"),r=t("../internals/indexed-object"),o=t("../internals/to-object"),a=t("../internals/length-of-array-like"),h=t("../internals/array-species-create"),c=s([].push),u=function(t){var e=1===t,i=2===t,s=3===t,u=4===t,l=6===t,f=7===t,d=5===t||l;return function(p,m,_,v){for(var g,b,w=o(p),y=r(w),x=n(m,_),M=a(y),T=0,O=v||h,E=e?O(p,M):i||f?O(p,0):void 0;M>T;T++)if((d||T in y)&&(b=x(g=y[T],T,w),t))if(e)E[T]=b;else if(b)switch(t){case 3:return!0;case 5:return g;case 6:return T;case 2:c(E,g)}else switch(t){case 4:return!1;case 7:c(E,g)}return l?-1:s||u?u:E}};e.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterReject:u(7)}},{"../internals/array-species-create":233,"../internals/function-bind-context":262,"../internals/function-uncurry-this":268,"../internals/indexed-object":280,"../internals/length-of-array-like":299,"../internals/to-object":344}],230:[function(t,e,i){var n=t("../internals/to-absolute-index"),s=t("../internals/length-of-array-like"),r=t("../internals/create-property"),o=Array,a=Math.max;e.exports=function(t,e,i){for(var h=s(t),c=n(e,h),u=n(void 0===i?h:i,h),l=o(a(u-c,0)),f=0;c<u;c++,f++)r(l,f,t[c]);return l.length=f,l}},{"../internals/create-property":243,"../internals/length-of-array-like":299,"../internals/to-absolute-index":340}],231:[function(t,e,i){var n=t("../internals/function-uncurry-this");e.exports=n([].slice)},{"../internals/function-uncurry-this":268}],232:[function(t,e,i){var n=t("../internals/is-array"),s=t("../internals/is-constructor"),r=t("../internals/is-object"),o=t("../internals/well-known-symbol")("species"),a=Array;e.exports=function(t){var e;return n(t)&&(e=t.constructor,(s(e)&&(e===a||n(e.prototype))||r(e)&&null===(e=e[o]))&&(e=void 0)),void 0===e?a:e}},{"../internals/is-array":284,"../internals/is-constructor":286,"../internals/is-object":289,"../internals/well-known-symbol":357}],233:[function(t,e,i){var n=t("../internals/array-species-constructor");e.exports=function(t,e){return new(n(t))(0===e?0:e)}},{"../internals/array-species-constructor":232}],234:[function(t,e,i){var n=t("../internals/well-known-symbol")("iterator"),s=!1;try{var r=0,o={next:function(){return{done:!!r++}},return:function(){s=!0}};o[n]=function(){return this},Array.from(o,(function(){throw 2}))}catch(t){}e.exports=function(t,e){try{if(!e&&!s)return!1}catch(t){return!1}var i=!1;try{var r={};r[n]=function(){return{next:function(){return{done:i=!0}}}},t(r)}catch(t){}return i}},{"../internals/well-known-symbol":357}],235:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=n({}.toString),r=n("".slice);e.exports=function(t){return r(s(t),8,-1)}},{"../internals/function-uncurry-this":268}],236:[function(t,e,i){var n=t("../internals/to-string-tag-support"),s=t("../internals/is-callable"),r=t("../internals/classof-raw"),o=t("../internals/well-known-symbol")("toStringTag"),a=Object,h="Arguments"===r(function(){return arguments}());e.exports=n?r:function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=a(t),o))?i:h?r(e):"Object"===(n=r(e))&&s(e.callee)?"Arguments":n}},{"../internals/classof-raw":235,"../internals/is-callable":285,"../internals/to-string-tag-support":347,"../internals/well-known-symbol":357}],237:[function(t,e,i){var n=t("../internals/has-own-property"),s=t("../internals/own-keys"),r=t("../internals/object-get-own-property-descriptor"),o=t("../internals/object-define-property");e.exports=function(t,e,i){for(var a=s(e),h=o.f,c=r.f,u=0;u<a.length;u++){var l=a[u];n(t,l)||i&&n(i,l)||h(t,l,c(e,l))}}},{"../internals/has-own-property":275,"../internals/object-define-property":308,"../internals/object-get-own-property-descriptor":309,"../internals/own-keys":321}],238:[function(t,e,i){var n=t("../internals/well-known-symbol")("match");e.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[n]=!1,"/./"[t](e)}catch(t){}}return!1}},{"../internals/well-known-symbol":357}],239:[function(t,e,i){var n=t("../internals/fails");e.exports=!n((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},{"../internals/fails":260}],240:[function(t,e,i){e.exports=function(t,e){return{value:t,done:e}}},{}],241:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/object-define-property"),r=t("../internals/create-property-descriptor");e.exports=n?function(t,e,i){return s.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},{"../internals/create-property-descriptor":242,"../internals/descriptors":247,"../internals/object-define-property":308}],242:[function(t,e,i){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],243:[function(t,e,i){var n=t("../internals/to-property-key"),s=t("../internals/object-define-property"),r=t("../internals/create-property-descriptor");e.exports=function(t,e,i){var o=n(e);o in t?s.f(t,o,r(0,i)):t[o]=i}},{"../internals/create-property-descriptor":242,"../internals/object-define-property":308,"../internals/to-property-key":346}],244:[function(t,e,i){var n=t("../internals/make-built-in"),s=t("../internals/object-define-property");e.exports=function(t,e,i){return i.get&&n(i.get,e,{getter:!0}),i.set&&n(i.set,e,{setter:!0}),s.f(t,e,i)}},{"../internals/make-built-in":300,"../internals/object-define-property":308}],245:[function(t,e,i){var n=t("../internals/is-callable"),s=t("../internals/object-define-property"),r=t("../internals/make-built-in"),o=t("../internals/define-global-property");e.exports=function(t,e,i,a){a||(a={});var h=a.enumerable,c=void 0!==a.name?a.name:e;if(n(i)&&r(i,c,a),a.global)h?t[e]=i:o(e,i);else{try{a.unsafe?t[e]&&(h=!0):delete t[e]}catch(t){}h?t[e]=i:s.f(t,e,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},{"../internals/define-global-property":246,"../internals/is-callable":285,"../internals/make-built-in":300,"../internals/object-define-property":308}],246:[function(t,e,i){var n=t("../internals/global"),s=Object.defineProperty;e.exports=function(t,e){try{s(n,t,{value:e,configurable:!0,writable:!0})}catch(i){n[t]=e}return e}},{"../internals/global":274}],247:[function(t,e,i){var n=t("../internals/fails");e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},{"../internals/fails":260}],248:[function(t,e,i){var n="object"==typeof document&&document.all,s=void 0===n&&void 0!==n;e.exports={all:n,IS_HTMLDDA:s}},{}],249:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/is-object"),r=n.document,o=s(r)&&s(r.createElement);e.exports=function(t){return o?r.createElement(t):{}}},{"../internals/global":274,"../internals/is-object":289}],250:[function(t,e,i){var n=t("../internals/engine-is-deno"),s=t("../internals/engine-is-node");e.exports=!n&&!s&&"object"==typeof window&&"object"==typeof document},{"../internals/engine-is-deno":251,"../internals/engine-is-node":254}],251:[function(t,e,i){e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},{}],252:[function(t,e,i){var n=t("../internals/engine-user-agent");e.exports=/ipad|iphone|ipod/i.test(n)&&"undefined"!=typeof Pebble},{"../internals/engine-user-agent":256}],253:[function(t,e,i){var n=t("../internals/engine-user-agent");e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},{"../internals/engine-user-agent":256}],254:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/classof-raw");e.exports="process"===s(n.process)},{"../internals/classof-raw":235,"../internals/global":274}],255:[function(t,e,i){var n=t("../internals/engine-user-agent");e.exports=/web0s(?!.*chrome)/i.test(n)},{"../internals/engine-user-agent":256}],256:[function(t,e,i){e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},{}],257:[function(t,e,i){var n,s,r=t("../internals/global"),o=t("../internals/engine-user-agent"),a=r.process,h=r.Deno,c=a&&a.versions||h&&h.version,u=c&&c.v8;u&&(s=(n=u.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!s&&o&&(!(n=o.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/))&&(s=+n[1]),e.exports=s},{"../internals/engine-user-agent":256,"../internals/global":274}],258:[function(t,e,i){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},{}],259:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/object-get-own-property-descriptor").f,r=t("../internals/create-non-enumerable-property"),o=t("../internals/define-built-in"),a=t("../internals/define-global-property"),h=t("../internals/copy-constructor-properties"),c=t("../internals/is-forced");e.exports=function(t,e){var i,u,l,f,d,p=t.target,m=t.global,_=t.stat;if(i=m?n:_?n[p]||a(p,{}):(n[p]||{}).prototype)for(u in e){if(f=e[u],l=t.dontCallGetSet?(d=s(i,u))&&d.value:i[u],!c(m?u:p+(_?".":"#")+u,t.forced)&&void 0!==l){if(typeof f==typeof l)continue;h(f,l)}(t.sham||l&&l.sham)&&r(f,"sham",!0),o(i,u,f,t)}}},{"../internals/copy-constructor-properties":237,"../internals/create-non-enumerable-property":241,"../internals/define-built-in":245,"../internals/define-global-property":246,"../internals/global":274,"../internals/is-forced":287,"../internals/object-get-own-property-descriptor":309}],260:[function(t,e,i){e.exports=function(t){try{return!!t()}catch(t){return!0}}},{}],261:[function(t,e,i){var n=t("../internals/function-bind-native"),s=Function.prototype,r=s.apply,o=s.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?o.bind(r):function(){return o.apply(r,arguments)})},{"../internals/function-bind-native":263}],262:[function(t,e,i){var n=t("../internals/function-uncurry-this-clause"),s=t("../internals/a-callable"),r=t("../internals/function-bind-native"),o=n(n.bind);e.exports=function(t,e){return s(t),void 0===e?t:r?o(t,e):function(){return t.apply(e,arguments)}}},{"../internals/a-callable":222,"../internals/function-bind-native":263,"../internals/function-uncurry-this-clause":267}],263:[function(t,e,i){var n=t("../internals/fails");e.exports=!n((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},{"../internals/fails":260}],264:[function(t,e,i){var n=t("../internals/function-bind-native"),s=Function.prototype.call;e.exports=n?s.bind(s):function(){return s.apply(s,arguments)}},{"../internals/function-bind-native":263}],265:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/has-own-property"),r=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=s(r,"name"),h=a&&"something"===function(){}.name,c=a&&(!n||n&&o(r,"name").configurable);e.exports={EXISTS:a,PROPER:h,CONFIGURABLE:c}},{"../internals/descriptors":247,"../internals/has-own-property":275}],266:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/a-callable");e.exports=function(t,e,i){try{return n(s(Object.getOwnPropertyDescriptor(t,e)[i]))}catch(t){}}},{"../internals/a-callable":222,"../internals/function-uncurry-this":268}],267:[function(t,e,i){var n=t("../internals/classof-raw"),s=t("../internals/function-uncurry-this");e.exports=function(t){if("Function"===n(t))return s(t)}},{"../internals/classof-raw":235,"../internals/function-uncurry-this":268}],268:[function(t,e,i){var n=t("../internals/function-bind-native"),s=Function.prototype,r=s.call,o=n&&s.bind.bind(r,r);e.exports=n?o:function(t){return function(){return r.apply(t,arguments)}}},{"../internals/function-bind-native":263}],269:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/is-callable"),r=function(t){return s(t)?t:void 0};e.exports=function(t,e){return arguments.length<2?r(n[t]):n[t]&&n[t][e]}},{"../internals/global":274,"../internals/is-callable":285}],270:[function(t,e,i){var n=t("../internals/classof"),s=t("../internals/get-method"),r=t("../internals/is-null-or-undefined"),o=t("../internals/iterators"),a=t("../internals/well-known-symbol")("iterator");e.exports=function(t){if(!r(t))return s(t,a)||s(t,"@@iterator")||o[n(t)]}},{"../internals/classof":236,"../internals/get-method":273,"../internals/is-null-or-undefined":288,"../internals/iterators":298,"../internals/well-known-symbol":357}],271:[function(t,e,i){var n=t("../internals/function-call"),s=t("../internals/a-callable"),r=t("../internals/an-object"),o=t("../internals/try-to-string"),a=t("../internals/get-iterator-method"),h=TypeError;e.exports=function(t,e){var i=arguments.length<2?a(t):e;if(s(i))return r(n(i,t));throw new h(o(t)+" is not iterable")}},{"../internals/a-callable":222,"../internals/an-object":227,"../internals/function-call":264,"../internals/get-iterator-method":270,"../internals/try-to-string":349}],272:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/is-array"),r=t("../internals/is-callable"),o=t("../internals/classof-raw"),a=t("../internals/to-string"),h=n([].push);e.exports=function(t){if(r(t))return t;if(s(t)){for(var e=t.length,i=[],n=0;n<e;n++){var c=t[n];"string"==typeof c?h(i,c):"number"!=typeof c&&"Number"!==o(c)&&"String"!==o(c)||h(i,a(c))}var u=i.length,l=!0;return function(t,e){if(l)return l=!1,e;if(s(this))return e;for(var n=0;n<u;n++)if(i[n]===t)return e}}}},{"../internals/classof-raw":235,"../internals/function-uncurry-this":268,"../internals/is-array":284,"../internals/is-callable":285,"../internals/to-string":348}],273:[function(t,e,i){var n=t("../internals/a-callable"),s=t("../internals/is-null-or-undefined");e.exports=function(t,e){var i=t[e];return s(i)?void 0:n(i)}},{"../internals/a-callable":222,"../internals/is-null-or-undefined":288}],274:[function(t,e,i){(function(t){(function(){var i=function(t){return t&&t.Math===Math&&t};e.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof t&&t)||function(){return this}()||this||Function("return this")()}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],275:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/to-object"),r=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(t,e){return r(s(t),e)}},{"../internals/function-uncurry-this":268,"../internals/to-object":344}],276:[function(t,e,i){e.exports={}},{}],277:[function(t,e,i){e.exports=function(t,e){try{1===arguments.length?console.error(t):console.error(t,e)}catch(t){}}},{}],278:[function(t,e,i){var n=t("../internals/get-built-in");e.exports=n("document","documentElement")},{"../internals/get-built-in":269}],279:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/fails"),r=t("../internals/document-create-element");e.exports=!n&&!s((function(){return 7!==Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},{"../internals/descriptors":247,"../internals/document-create-element":249,"../internals/fails":260}],280:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/fails"),r=t("../internals/classof-raw"),o=Object,a=n("".split);e.exports=s((function(){return!o("z").propertyIsEnumerable(0)}))?function(t){return"String"===r(t)?a(t,""):o(t)}:o},{"../internals/classof-raw":235,"../internals/fails":260,"../internals/function-uncurry-this":268}],281:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/is-callable"),r=t("../internals/shared-store"),o=n(Function.toString);s(r.inspectSource)||(r.inspectSource=function(t){return o(t)}),e.exports=r.inspectSource},{"../internals/function-uncurry-this":268,"../internals/is-callable":285,"../internals/shared-store":333}],282:[function(t,e,i){var n,s,r,o=t("../internals/weak-map-basic-detection"),a=t("../internals/global"),h=t("../internals/is-object"),c=t("../internals/create-non-enumerable-property"),u=t("../internals/has-own-property"),l=t("../internals/shared-store"),f=t("../internals/shared-key"),d=t("../internals/hidden-keys"),p=a.TypeError,m=a.WeakMap;if(o||l.state){var _=l.state||(l.state=new m);_.get=_.get,_.has=_.has,_.set=_.set,n=function(t,e){if(_.has(t))throw new p("Object already initialized");return e.facade=t,_.set(t,e),e},s=function(t){return _.get(t)||{}},r=function(t){return _.has(t)}}else{var v=f("state");d[v]=!0,n=function(t,e){if(u(t,v))throw new p("Object already initialized");return e.facade=t,c(t,v,e),e},s=function(t){return u(t,v)?t[v]:{}},r=function(t){return u(t,v)}}e.exports={set:n,get:s,has:r,enforce:function(t){return r(t)?s(t):n(t,{})},getterFor:function(t){return function(e){var i;if(!h(e)||(i=s(e)).type!==t)throw new p("Incompatible receiver, "+t+" required");return i}}}},{"../internals/create-non-enumerable-property":241,"../internals/global":274,"../internals/has-own-property":275,"../internals/hidden-keys":276,"../internals/is-object":289,"../internals/shared-key":332,"../internals/shared-store":333,"../internals/weak-map-basic-detection":354}],283:[function(t,e,i){var n=t("../internals/well-known-symbol"),s=t("../internals/iterators"),r=n("iterator"),o=Array.prototype;e.exports=function(t){return void 0!==t&&(s.Array===t||o[r]===t)}},{"../internals/iterators":298,"../internals/well-known-symbol":357}],284:[function(t,e,i){var n=t("../internals/classof-raw");e.exports=Array.isArray||function(t){return"Array"===n(t)}},{"../internals/classof-raw":235}],285:[function(t,e,i){var n=t("../internals/document-all"),s=n.all;e.exports=n.IS_HTMLDDA?function(t){return"function"==typeof t||t===s}:function(t){return"function"==typeof t}},{"../internals/document-all":248}],286:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/fails"),r=t("../internals/is-callable"),o=t("../internals/classof"),a=t("../internals/get-built-in"),h=t("../internals/inspect-source"),c=function(){},u=[],l=a("Reflect","construct"),f=/^\s*(?:class|function)\b/,d=n(f.exec),p=!f.test(c),m=function(t){if(!r(t))return!1;try{return l(c,u,t),!0}catch(t){return!1}},_=function(t){if(!r(t))return!1;switch(o(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(f,h(t))}catch(t){return!0}};_.sham=!0,e.exports=!l||s((function(){var t;return m(m.call)||!m(Object)||!m((function(){t=!0}))||t}))?_:m},{"../internals/classof":236,"../internals/fails":260,"../internals/function-uncurry-this":268,"../internals/get-built-in":269,"../internals/inspect-source":281,"../internals/is-callable":285}],287:[function(t,e,i){var n=t("../internals/fails"),s=t("../internals/is-callable"),r=/#|\.prototype\./,o=function(t,e){var i=h[a(t)];return i===u||i!==c&&(s(e)?n(e):!!e)},a=o.normalize=function(t){return String(t).replace(r,".").toLowerCase()},h=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},{"../internals/fails":260,"../internals/is-callable":285}],288:[function(t,e,i){e.exports=function(t){return null==t}},{}],289:[function(t,e,i){var n=t("../internals/is-callable"),s=t("../internals/document-all"),r=s.all;e.exports=s.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:n(t)||t===r}:function(t){return"object"==typeof t?null!==t:n(t)}},{"../internals/document-all":248,"../internals/is-callable":285}],290:[function(t,e,i){e.exports=!1},{}],291:[function(t,e,i){var n=t("../internals/is-object"),s=t("../internals/classof-raw"),r=t("../internals/well-known-symbol")("match");e.exports=function(t){var e;return n(t)&&(void 0!==(e=t[r])?!!e:"RegExp"===s(t))}},{"../internals/classof-raw":235,"../internals/is-object":289,"../internals/well-known-symbol":357}],292:[function(t,e,i){var n=t("../internals/get-built-in"),s=t("../internals/is-callable"),r=t("../internals/object-is-prototype-of"),o=t("../internals/use-symbol-as-uid"),a=Object;e.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=n("Symbol");return s(e)&&r(e.prototype,a(t))}},{"../internals/get-built-in":269,"../internals/is-callable":285,"../internals/object-is-prototype-of":314,"../internals/use-symbol-as-uid":351}],293:[function(t,e,i){var n=t("../internals/function-bind-context"),s=t("../internals/function-call"),r=t("../internals/an-object"),o=t("../internals/try-to-string"),a=t("../internals/is-array-iterator-method"),h=t("../internals/length-of-array-like"),c=t("../internals/object-is-prototype-of"),u=t("../internals/get-iterator"),l=t("../internals/get-iterator-method"),f=t("../internals/iterator-close"),d=TypeError,p=function(t,e){this.stopped=t,this.result=e},m=p.prototype;e.exports=function(t,e,i){var _,v,g,b,w,y,x,M=i&&i.that,T=!(!i||!i.AS_ENTRIES),O=!(!i||!i.IS_RECORD),E=!(!i||!i.IS_ITERATOR),A=!(!i||!i.INTERRUPTED),S=n(e,M),k=function(t){return _&&f(_,"normal",t),new p(!0,t)},I=function(t){return T?(r(t),A?S(t[0],t[1],k):S(t[0],t[1])):A?S(t,k):S(t)};if(O)_=t.iterator;else if(E)_=t;else{if(!(v=l(t)))throw new d(o(t)+" is not iterable");if(a(v)){for(g=0,b=h(t);b>g;g++)if((w=I(t[g]))&&c(m,w))return w;return new p(!1)}_=u(t,v)}for(y=O?t.next:_.next;!(x=s(y,_)).done;){try{w=I(x.value)}catch(t){f(_,"throw",t)}if("object"==typeof w&&w&&c(m,w))return w}return new p(!1)}},{"../internals/an-object":227,"../internals/function-bind-context":262,"../internals/function-call":264,"../internals/get-iterator":271,"../internals/get-iterator-method":270,"../internals/is-array-iterator-method":283,"../internals/iterator-close":294,"../internals/length-of-array-like":299,"../internals/object-is-prototype-of":314,"../internals/try-to-string":349}],294:[function(t,e,i){var n=t("../internals/function-call"),s=t("../internals/an-object"),r=t("../internals/get-method");e.exports=function(t,e,i){var o,a;s(t);try{if(!(o=r(t,"return"))){if("throw"===e)throw i;return i}o=n(o,t)}catch(t){a=!0,o=t}if("throw"===e)throw i;if(a)throw o;return s(o),i}},{"../internals/an-object":227,"../internals/function-call":264,"../internals/get-method":273}],295:[function(t,e,i){var n=t("../internals/iterators-core").IteratorPrototype,s=t("../internals/object-create"),r=t("../internals/create-property-descriptor"),o=t("../internals/set-to-string-tag"),a=t("../internals/iterators"),h=function(){return this};e.exports=function(t,e,i,c){var u=e+" Iterator";return t.prototype=s(n,{next:r(+!c,i)}),o(t,u,!1,!0),a[u]=h,t}},{"../internals/create-property-descriptor":242,"../internals/iterators":298,"../internals/iterators-core":297,"../internals/object-create":306,"../internals/set-to-string-tag":331}],296:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/function-call"),r=t("../internals/is-pure"),o=t("../internals/function-name"),a=t("../internals/is-callable"),h=t("../internals/iterator-create-constructor"),c=t("../internals/object-get-prototype-of"),u=t("../internals/object-set-prototype-of"),l=t("../internals/set-to-string-tag"),f=t("../internals/create-non-enumerable-property"),d=t("../internals/define-built-in"),p=t("../internals/well-known-symbol"),m=t("../internals/iterators"),_=t("../internals/iterators-core"),v=o.PROPER,g=o.CONFIGURABLE,b=_.IteratorPrototype,w=_.BUGGY_SAFARI_ITERATORS,y=p("iterator"),x=function(){return this};e.exports=function(t,e,i,o,p,_,M){h(i,e,o);var T,O,E,A=function(t){if(t===p&&j)return j;if(!w&&t&&t in I)return I[t];switch(t){case"keys":case"values":case"entries":return function(){return new i(this,t)}}return function(){return new i(this)}},S=e+" Iterator",k=!1,I=t.prototype,C=I[y]||I["@@iterator"]||p&&I[p],j=!w&&C||A(p),D="Array"===e&&I.entries||C;if(D&&(T=c(D.call(new t)))!==Object.prototype&&T.next&&(r||c(T)===b||(u?u(T,b):a(T[y])||d(T,y,x)),l(T,S,!0,!0),r&&(m[S]=x)),v&&"values"===p&&C&&"values"!==C.name&&(!r&&g?f(I,"name","values"):(k=!0,j=function(){return s(C,this)})),p)if(O={values:A("values"),keys:_?j:A("keys"),entries:A("entries")},M)for(E in O)(w||k||!(E in I))&&d(I,E,O[E]);else n({target:e,proto:!0,forced:w||k},O);return r&&!M||I[y]===j||d(I,y,j,{name:p}),m[e]=j,O}},{"../internals/create-non-enumerable-property":241,"../internals/define-built-in":245,"../internals/export":259,"../internals/function-call":264,"../internals/function-name":265,"../internals/is-callable":285,"../internals/is-pure":290,"../internals/iterator-create-constructor":295,"../internals/iterators":298,"../internals/iterators-core":297,"../internals/object-get-prototype-of":313,"../internals/object-set-prototype-of":318,"../internals/set-to-string-tag":331,"../internals/well-known-symbol":357}],297:[function(t,e,i){var n,s,r,o=t("../internals/fails"),a=t("../internals/is-callable"),h=t("../internals/is-object"),c=t("../internals/object-create"),u=t("../internals/object-get-prototype-of"),l=t("../internals/define-built-in"),f=t("../internals/well-known-symbol"),d=t("../internals/is-pure"),p=f("iterator"),m=!1;[].keys&&("next"in(r=[].keys())?(s=u(u(r)))!==Object.prototype&&(n=s):m=!0),!h(n)||o((function(){var t={};return n[p].call(t)!==t}))?n={}:d&&(n=c(n)),a(n[p])||l(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:m}},{"../internals/define-built-in":245,"../internals/fails":260,"../internals/is-callable":285,"../internals/is-object":289,"../internals/is-pure":290,"../internals/object-create":306,"../internals/object-get-prototype-of":313,"../internals/well-known-symbol":357}],298:[function(t,e,i){arguments[4][276][0].apply(i,arguments)},{dup:276}],299:[function(t,e,i){var n=t("../internals/to-length");e.exports=function(t){return n(t.length)}},{"../internals/to-length":343}],300:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/fails"),r=t("../internals/is-callable"),o=t("../internals/has-own-property"),a=t("../internals/descriptors"),h=t("../internals/function-name").CONFIGURABLE,c=t("../internals/inspect-source"),u=t("../internals/internal-state"),l=u.enforce,f=u.get,d=String,p=Object.defineProperty,m=n("".slice),_=n("".replace),v=n([].join),g=a&&!s((function(){return 8!==p((function(){}),"length",{value:8}).length})),b=String(String).split("String"),w=e.exports=function(t,e,i){"Symbol("===m(d(e),0,7)&&(e="["+_(d(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(e="get "+e),i&&i.setter&&(e="set "+e),(!o(t,"name")||h&&t.name!==e)&&(a?p(t,"name",{value:e,configurable:!0}):t.name=e),g&&i&&o(i,"arity")&&t.length!==i.arity&&p(t,"length",{value:i.arity});try{i&&o(i,"constructor")&&i.constructor?a&&p(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var n=l(t);return o(n,"source")||(n.source=v(b,"string"==typeof e?e:"")),t};Function.prototype.toString=w((function(){return r(this)&&f(this).source||c(this)}),"toString")},{"../internals/descriptors":247,"../internals/fails":260,"../internals/function-name":265,"../internals/function-uncurry-this":268,"../internals/has-own-property":275,"../internals/inspect-source":281,"../internals/internal-state":282,"../internals/is-callable":285}],301:[function(t,e,i){var n=Math.ceil,s=Math.floor;e.exports=Math.trunc||function(t){var e=+t;return(e>0?s:n)(e)}},{}],302:[function(t,e,i){var n,s,r,o,a,h=t("../internals/global"),c=t("../internals/function-bind-context"),u=t("../internals/object-get-own-property-descriptor").f,l=t("../internals/task").set,f=t("../internals/queue"),d=t("../internals/engine-is-ios"),p=t("../internals/engine-is-ios-pebble"),m=t("../internals/engine-is-webos-webkit"),_=t("../internals/engine-is-node"),v=h.MutationObserver||h.WebKitMutationObserver,g=h.document,b=h.process,w=h.Promise,y=u(h,"queueMicrotask"),x=y&&y.value;if(!x){var M=new f,T=function(){var t,e;for(_&&(t=b.domain)&&t.exit();e=M.get();)try{e()}catch(t){throw M.head&&n(),t}t&&t.enter()};d||_||m||!v||!g?!p&&w&&w.resolve?((o=w.resolve(void 0)).constructor=w,a=c(o.then,o),n=function(){a(T)}):_?n=function(){b.nextTick(T)}:(l=c(l,h),n=function(){l(T)}):(s=!0,r=g.createTextNode(""),new v(T).observe(r,{characterData:!0}),n=function(){r.data=s=!s}),x=function(t){M.head||n(),M.add(t)}}e.exports=x},{"../internals/engine-is-ios":253,"../internals/engine-is-ios-pebble":252,"../internals/engine-is-node":254,"../internals/engine-is-webos-webkit":255,"../internals/function-bind-context":262,"../internals/global":274,"../internals/object-get-own-property-descriptor":309,"../internals/queue":328,"../internals/task":339}],303:[function(t,e,i){var n=t("../internals/a-callable"),s=TypeError,r=function(t){var e,i;this.promise=new t((function(t,n){if(void 0!==e||void 0!==i)throw new s("Bad Promise constructor");e=t,i=n})),this.resolve=n(e),this.reject=n(i)};e.exports.f=function(t){return new r(t)}},{"../internals/a-callable":222}],304:[function(t,e,i){var n=t("../internals/is-regexp"),s=TypeError;e.exports=function(t){if(n(t))throw new s("The method doesn't accept regular expressions");return t}},{"../internals/is-regexp":291}],305:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/function-uncurry-this"),r=t("../internals/function-call"),o=t("../internals/fails"),a=t("../internals/object-keys"),h=t("../internals/object-get-own-property-symbols"),c=t("../internals/object-property-is-enumerable"),u=t("../internals/to-object"),l=t("../internals/indexed-object"),f=Object.assign,d=Object.defineProperty,p=s([].concat);e.exports=!f||o((function(){if(n&&1!==f({b:1},f(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},i=Symbol("assign detection");return t[i]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!==f({},t)[i]||"abcdefghijklmnopqrst"!==a(f({},e)).join("")}))?function(t,e){for(var i=u(t),s=arguments.length,o=1,f=h.f,d=c.f;s>o;)for(var m,_=l(arguments[o++]),v=f?p(a(_),f(_)):a(_),g=v.length,b=0;g>b;)m=v[b++],n&&!r(d,_,m)||(i[m]=_[m]);return i}:f},{"../internals/descriptors":247,"../internals/fails":260,"../internals/function-call":264,"../internals/function-uncurry-this":268,"../internals/indexed-object":280,"../internals/object-get-own-property-symbols":312,"../internals/object-keys":316,"../internals/object-property-is-enumerable":317,"../internals/to-object":344}],306:[function(t,e,i){var n,s=t("../internals/an-object"),r=t("../internals/object-define-properties"),o=t("../internals/enum-bug-keys"),a=t("../internals/hidden-keys"),h=t("../internals/html"),c=t("../internals/document-create-element"),u=t("../internals/shared-key"),l=u("IE_PROTO"),f=function(){},d=function(t){return"<script>"+t+"<\/script>"},p=function(t){t.write(d("")),t.close();var e=t.parentWindow.Object;return t=null,e},m=function(){try{n=new ActiveXObject("htmlfile")}catch(t){}var t,e;m="undefined"!=typeof document?document.domain&&n?p(n):((e=c("iframe")).style.display="none",h.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(d("document.F=Object")),t.close(),t.F):p(n);for(var i=o.length;i--;)delete m.prototype[o[i]];return m()};a[l]=!0,e.exports=Object.create||function(t,e){var i;return null!==t?(f.prototype=s(t),i=new f,f.prototype=null,i[l]=t):i=m(),void 0===e?i:r.f(i,e)}},{"../internals/an-object":227,"../internals/document-create-element":249,"../internals/enum-bug-keys":258,"../internals/hidden-keys":276,"../internals/html":278,"../internals/object-define-properties":307,"../internals/shared-key":332}],307:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/v8-prototype-define-bug"),r=t("../internals/object-define-property"),o=t("../internals/an-object"),a=t("../internals/to-indexed-object"),h=t("../internals/object-keys");i.f=n&&!s?Object.defineProperties:function(t,e){o(t);for(var i,n=a(e),s=h(e),c=s.length,u=0;c>u;)r.f(t,i=s[u++],n[i]);return t}},{"../internals/an-object":227,"../internals/descriptors":247,"../internals/object-define-property":308,"../internals/object-keys":316,"../internals/to-indexed-object":341,"../internals/v8-prototype-define-bug":352}],308:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/ie8-dom-define"),r=t("../internals/v8-prototype-define-bug"),o=t("../internals/an-object"),a=t("../internals/to-property-key"),h=TypeError,c=Object.defineProperty,u=Object.getOwnPropertyDescriptor;i.f=n?r?function(t,e,i){if(o(t),e=a(e),o(i),"function"==typeof t&&"prototype"===e&&"value"in i&&"writable"in i&&!i.writable){var n=u(t,e);n&&n.writable&&(t[e]=i.value,i={configurable:"configurable"in i?i.configurable:n.configurable,enumerable:"enumerable"in i?i.enumerable:n.enumerable,writable:!1})}return c(t,e,i)}:c:function(t,e,i){if(o(t),e=a(e),o(i),s)try{return c(t,e,i)}catch(t){}if("get"in i||"set"in i)throw new h("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},{"../internals/an-object":227,"../internals/descriptors":247,"../internals/ie8-dom-define":279,"../internals/to-property-key":346,"../internals/v8-prototype-define-bug":352}],309:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/function-call"),r=t("../internals/object-property-is-enumerable"),o=t("../internals/create-property-descriptor"),a=t("../internals/to-indexed-object"),h=t("../internals/to-property-key"),c=t("../internals/has-own-property"),u=t("../internals/ie8-dom-define"),l=Object.getOwnPropertyDescriptor;i.f=n?l:function(t,e){if(t=a(t),e=h(e),u)try{return l(t,e)}catch(t){}if(c(t,e))return o(!s(r.f,t,e),t[e])}},{"../internals/create-property-descriptor":242,"../internals/descriptors":247,"../internals/function-call":264,"../internals/has-own-property":275,"../internals/ie8-dom-define":279,"../internals/object-property-is-enumerable":317,"../internals/to-indexed-object":341,"../internals/to-property-key":346}],310:[function(t,e,i){var n=t("../internals/classof-raw"),s=t("../internals/to-indexed-object"),r=t("../internals/object-get-own-property-names").f,o=t("../internals/array-slice-simple"),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(t){return a&&"Window"===n(t)?function(t){try{return r(t)}catch(t){return o(a)}}(t):r(s(t))}},{"../internals/array-slice-simple":230,"../internals/classof-raw":235,"../internals/object-get-own-property-names":311,"../internals/to-indexed-object":341}],311:[function(t,e,i){var n=t("../internals/object-keys-internal"),s=t("../internals/enum-bug-keys").concat("length","prototype");i.f=Object.getOwnPropertyNames||function(t){return n(t,s)}},{"../internals/enum-bug-keys":258,"../internals/object-keys-internal":315}],312:[function(t,e,i){i.f=Object.getOwnPropertySymbols},{}],313:[function(t,e,i){var n=t("../internals/has-own-property"),s=t("../internals/is-callable"),r=t("../internals/to-object"),o=t("../internals/shared-key"),a=t("../internals/correct-prototype-getter"),h=o("IE_PROTO"),c=Object,u=c.prototype;e.exports=a?c.getPrototypeOf:function(t){var e=r(t);if(n(e,h))return e[h];var i=e.constructor;return s(i)&&e instanceof i?i.prototype:e instanceof c?u:null}},{"../internals/correct-prototype-getter":239,"../internals/has-own-property":275,"../internals/is-callable":285,"../internals/shared-key":332,"../internals/to-object":344}],314:[function(t,e,i){var n=t("../internals/function-uncurry-this");e.exports=n({}.isPrototypeOf)},{"../internals/function-uncurry-this":268}],315:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=t("../internals/has-own-property"),r=t("../internals/to-indexed-object"),o=t("../internals/array-includes").indexOf,a=t("../internals/hidden-keys"),h=n([].push);e.exports=function(t,e){var i,n=r(t),c=0,u=[];for(i in n)!s(a,i)&&s(n,i)&&h(u,i);for(;e.length>c;)s(n,i=e[c++])&&(~o(u,i)||h(u,i));return u}},{"../internals/array-includes":228,"../internals/function-uncurry-this":268,"../internals/has-own-property":275,"../internals/hidden-keys":276,"../internals/to-indexed-object":341}],316:[function(t,e,i){var n=t("../internals/object-keys-internal"),s=t("../internals/enum-bug-keys");e.exports=Object.keys||function(t){return n(t,s)}},{"../internals/enum-bug-keys":258,"../internals/object-keys-internal":315}],317:[function(t,e,i){var n={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,r=s&&!n.call({1:2},1);i.f=r?function(t){var e=s(this,t);return!!e&&e.enumerable}:n},{}],318:[function(t,e,i){var n=t("../internals/function-uncurry-this-accessor"),s=t("../internals/an-object"),r=t("../internals/a-possible-prototype");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=n(Object.prototype,"__proto__","set"))(i,[]),e=i instanceof Array}catch(t){}return function(i,n){return s(i),r(n),e?t(i,n):i.__proto__=n,i}}():void 0)},{"../internals/a-possible-prototype":224,"../internals/an-object":227,"../internals/function-uncurry-this-accessor":266}],319:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/fails"),r=t("../internals/function-uncurry-this"),o=t("../internals/object-get-prototype-of"),a=t("../internals/object-keys"),h=t("../internals/to-indexed-object"),c=r(t("../internals/object-property-is-enumerable").f),u=r([].push),l=n&&s((function(){var t=Object.create(null);return t[2]=2,!c(t,2)})),f=function(t){return function(e){for(var i,s=h(e),r=a(s),f=l&&null===o(s),d=r.length,p=0,m=[];d>p;)i=r[p++],n&&!(f?i in s:c(s,i))||u(m,t?[i,s[i]]:s[i]);return m}};e.exports={entries:f(!0),values:f(!1)}},{"../internals/descriptors":247,"../internals/fails":260,"../internals/function-uncurry-this":268,"../internals/object-get-prototype-of":313,"../internals/object-keys":316,"../internals/object-property-is-enumerable":317,"../internals/to-indexed-object":341}],320:[function(t,e,i){var n=t("../internals/function-call"),s=t("../internals/is-callable"),r=t("../internals/is-object"),o=TypeError;e.exports=function(t,e){var i,a;if("string"===e&&s(i=t.toString)&&!r(a=n(i,t)))return a;if(s(i=t.valueOf)&&!r(a=n(i,t)))return a;if("string"!==e&&s(i=t.toString)&&!r(a=n(i,t)))return a;throw new o("Can't convert object to primitive value")}},{"../internals/function-call":264,"../internals/is-callable":285,"../internals/is-object":289}],321:[function(t,e,i){var n=t("../internals/get-built-in"),s=t("../internals/function-uncurry-this"),r=t("../internals/object-get-own-property-names"),o=t("../internals/object-get-own-property-symbols"),a=t("../internals/an-object"),h=s([].concat);e.exports=n("Reflect","ownKeys")||function(t){var e=r.f(a(t)),i=o.f;return i?h(e,i(t)):e}},{"../internals/an-object":227,"../internals/function-uncurry-this":268,"../internals/get-built-in":269,"../internals/object-get-own-property-names":311,"../internals/object-get-own-property-symbols":312}],322:[function(t,e,i){var n=t("../internals/global");e.exports=n},{"../internals/global":274}],323:[function(t,e,i){e.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},{}],324:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/promise-native-constructor"),r=t("../internals/is-callable"),o=t("../internals/is-forced"),a=t("../internals/inspect-source"),h=t("../internals/well-known-symbol"),c=t("../internals/engine-is-browser"),u=t("../internals/engine-is-deno"),l=t("../internals/is-pure"),f=t("../internals/engine-v8-version"),d=s&&s.prototype,p=h("species"),m=!1,_=r(n.PromiseRejectionEvent),v=o("Promise",(function(){var t=a(s),e=t!==String(s);if(!e&&66===f)return!0;if(l&&(!d.catch||!d.finally))return!0;if(!f||f<51||!/native code/.test(t)){var i=new s((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((i.constructor={})[p]=n,!(m=i.then((function(){}))instanceof n))return!0}return!e&&(c||u)&&!_}));e.exports={CONSTRUCTOR:v,REJECTION_EVENT:_,SUBCLASSING:m}},{"../internals/engine-is-browser":250,"../internals/engine-is-deno":251,"../internals/engine-v8-version":257,"../internals/global":274,"../internals/inspect-source":281,"../internals/is-callable":285,"../internals/is-forced":287,"../internals/is-pure":290,"../internals/promise-native-constructor":325,"../internals/well-known-symbol":357}],325:[function(t,e,i){var n=t("../internals/global");e.exports=n.Promise},{"../internals/global":274}],326:[function(t,e,i){var n=t("../internals/an-object"),s=t("../internals/is-object"),r=t("../internals/new-promise-capability");e.exports=function(t,e){if(n(t),s(e)&&e.constructor===t)return e;var i=r.f(t);return(0,i.resolve)(e),i.promise}},{"../internals/an-object":227,"../internals/is-object":289,"../internals/new-promise-capability":303}],327:[function(t,e,i){var n=t("../internals/promise-native-constructor"),s=t("../internals/check-correctness-of-iteration"),r=t("../internals/promise-constructor-detection").CONSTRUCTOR;e.exports=r||!s((function(t){n.all(t).then(void 0,(function(){}))}))},{"../internals/check-correctness-of-iteration":234,"../internals/promise-constructor-detection":324,"../internals/promise-native-constructor":325}],328:[function(t,e,i){var n=function(){this.head=null,this.tail=null};n.prototype={add:function(t){var e={item:t,next:null},i=this.tail;i?i.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}},e.exports=n},{}],329:[function(t,e,i){var n=t("../internals/is-null-or-undefined"),s=TypeError;e.exports=function(t){if(n(t))throw new s("Can't call method on "+t);return t}},{"../internals/is-null-or-undefined":288}],330:[function(t,e,i){var n=t("../internals/get-built-in"),s=t("../internals/define-built-in-accessor"),r=t("../internals/well-known-symbol"),o=t("../internals/descriptors"),a=r("species");e.exports=function(t){var e=n(t);o&&e&&!e[a]&&s(e,a,{configurable:!0,get:function(){return this}})}},{"../internals/define-built-in-accessor":244,"../internals/descriptors":247,"../internals/get-built-in":269,"../internals/well-known-symbol":357}],331:[function(t,e,i){var n=t("../internals/object-define-property").f,s=t("../internals/has-own-property"),r=t("../internals/well-known-symbol")("toStringTag");e.exports=function(t,e,i){t&&!i&&(t=t.prototype),t&&!s(t,r)&&n(t,r,{configurable:!0,value:e})}},{"../internals/has-own-property":275,"../internals/object-define-property":308,"../internals/well-known-symbol":357}],332:[function(t,e,i){var n=t("../internals/shared"),s=t("../internals/uid"),r=n("keys");e.exports=function(t){return r[t]||(r[t]=s(t))}},{"../internals/shared":334,"../internals/uid":350}],333:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/define-global-property"),r=n["__core-js_shared__"]||s("__core-js_shared__",{});e.exports=r},{"../internals/define-global-property":246,"../internals/global":274}],334:[function(t,e,i){var n=t("../internals/is-pure"),s=t("../internals/shared-store");(e.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.33.0",mode:n?"pure":"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.33.0/LICENSE",source:"https://github.com/zloirock/core-js"})},{"../internals/is-pure":290,"../internals/shared-store":333}],335:[function(t,e,i){var n=t("../internals/an-object"),s=t("../internals/a-constructor"),r=t("../internals/is-null-or-undefined"),o=t("../internals/well-known-symbol")("species");e.exports=function(t,e){var i,a=n(t).constructor;return void 0===a||r(i=n(a)[o])?e:s(i)}},{"../internals/a-constructor":223,"../internals/an-object":227,"../internals/is-null-or-undefined":288,"../internals/well-known-symbol":357}],336:[function(t,e,i){var n=t("../internals/engine-v8-version"),s=t("../internals/fails"),r=t("../internals/global").String;e.exports=!!Object.getOwnPropertySymbols&&!s((function(){var t=Symbol("symbol detection");return!r(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},{"../internals/engine-v8-version":257,"../internals/fails":260,"../internals/global":274}],337:[function(t,e,i){var n=t("../internals/function-call"),s=t("../internals/get-built-in"),r=t("../internals/well-known-symbol"),o=t("../internals/define-built-in");e.exports=function(){var t=s("Symbol"),e=t&&t.prototype,i=e&&e.valueOf,a=r("toPrimitive");e&&!e[a]&&o(e,a,(function(t){return n(i,this)}),{arity:1})}},{"../internals/define-built-in":245,"../internals/function-call":264,"../internals/get-built-in":269,"../internals/well-known-symbol":357}],338:[function(t,e,i){var n=t("../internals/symbol-constructor-detection");e.exports=n&&!!Symbol.for&&!!Symbol.keyFor},{"../internals/symbol-constructor-detection":336}],339:[function(t,e,i){var n,s,r,o,a=t("../internals/global"),h=t("../internals/function-apply"),c=t("../internals/function-bind-context"),u=t("../internals/is-callable"),l=t("../internals/has-own-property"),f=t("../internals/fails"),d=t("../internals/html"),p=t("../internals/array-slice"),m=t("../internals/document-create-element"),_=t("../internals/validate-arguments-length"),v=t("../internals/engine-is-ios"),g=t("../internals/engine-is-node"),b=a.setImmediate,w=a.clearImmediate,y=a.process,x=a.Dispatch,M=a.Function,T=a.MessageChannel,O=a.String,E=0,A={};f((function(){n=a.location}));var S=function(t){if(l(A,t)){var e=A[t];delete A[t],e()}},k=function(t){return function(){S(t)}},I=function(t){S(t.data)},C=function(t){a.postMessage(O(t),n.protocol+"//"+n.host)};b&&w||(b=function(t){_(arguments.length,1);var e=u(t)?t:M(t),i=p(arguments,1);return A[++E]=function(){h(e,void 0,i)},s(E),E},w=function(t){delete A[t]},g?s=function(t){y.nextTick(k(t))}:x&&x.now?s=function(t){x.now(k(t))}:T&&!v?(o=(r=new T).port2,r.port1.onmessage=I,s=c(o.postMessage,o)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!f(C)?(s=C,a.addEventListener("message",I,!1)):s="onreadystatechange"in m("script")?function(t){d.appendChild(m("script")).onreadystatechange=function(){d.removeChild(this),S(t)}}:function(t){setTimeout(k(t),0)}),e.exports={set:b,clear:w}},{"../internals/array-slice":231,"../internals/document-create-element":249,"../internals/engine-is-ios":253,"../internals/engine-is-node":254,"../internals/fails":260,"../internals/function-apply":261,"../internals/function-bind-context":262,"../internals/global":274,"../internals/has-own-property":275,"../internals/html":278,"../internals/is-callable":285,"../internals/validate-arguments-length":353}],340:[function(t,e,i){var n=t("../internals/to-integer-or-infinity"),s=Math.max,r=Math.min;e.exports=function(t,e){var i=n(t);return i<0?s(i+e,0):r(i,e)}},{"../internals/to-integer-or-infinity":342}],341:[function(t,e,i){var n=t("../internals/indexed-object"),s=t("../internals/require-object-coercible");e.exports=function(t){return n(s(t))}},{"../internals/indexed-object":280,"../internals/require-object-coercible":329}],342:[function(t,e,i){var n=t("../internals/math-trunc");e.exports=function(t){var e=+t;return e!=e||0===e?0:n(e)}},{"../internals/math-trunc":301}],343:[function(t,e,i){var n=t("../internals/to-integer-or-infinity"),s=Math.min;e.exports=function(t){return t>0?s(n(t),9007199254740991):0}},{"../internals/to-integer-or-infinity":342}],344:[function(t,e,i){var n=t("../internals/require-object-coercible"),s=Object;e.exports=function(t){return s(n(t))}},{"../internals/require-object-coercible":329}],345:[function(t,e,i){var n=t("../internals/function-call"),s=t("../internals/is-object"),r=t("../internals/is-symbol"),o=t("../internals/get-method"),a=t("../internals/ordinary-to-primitive"),h=t("../internals/well-known-symbol"),c=TypeError,u=h("toPrimitive");e.exports=function(t,e){if(!s(t)||r(t))return t;var i,h=o(t,u);if(h){if(void 0===e&&(e="default"),i=n(h,t,e),!s(i)||r(i))return i;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},{"../internals/function-call":264,"../internals/get-method":273,"../internals/is-object":289,"../internals/is-symbol":292,"../internals/ordinary-to-primitive":320,"../internals/well-known-symbol":357}],346:[function(t,e,i){var n=t("../internals/to-primitive"),s=t("../internals/is-symbol");e.exports=function(t){var e=n(t,"string");return s(e)?e:e+""}},{"../internals/is-symbol":292,"../internals/to-primitive":345}],347:[function(t,e,i){var n={};n[t("../internals/well-known-symbol")("toStringTag")]="z",e.exports="[object z]"===String(n)},{"../internals/well-known-symbol":357}],348:[function(t,e,i){var n=t("../internals/classof"),s=String;e.exports=function(t){if("Symbol"===n(t))throw new TypeError("Cannot convert a Symbol value to a string");return s(t)}},{"../internals/classof":236}],349:[function(t,e,i){var n=String;e.exports=function(t){try{return n(t)}catch(t){return"Object"}}},{}],350:[function(t,e,i){var n=t("../internals/function-uncurry-this"),s=0,r=Math.random(),o=n(1..toString);e.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++s+r,36)}},{"../internals/function-uncurry-this":268}],351:[function(t,e,i){var n=t("../internals/symbol-constructor-detection");e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},{"../internals/symbol-constructor-detection":336}],352:[function(t,e,i){var n=t("../internals/descriptors"),s=t("../internals/fails");e.exports=n&&s((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},{"../internals/descriptors":247,"../internals/fails":260}],353:[function(t,e,i){var n=TypeError;e.exports=function(t,e){if(t<e)throw new n("Not enough arguments");return t}},{}],354:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/is-callable"),r=n.WeakMap;e.exports=s(r)&&/native code/.test(String(r))},{"../internals/global":274,"../internals/is-callable":285}],355:[function(t,e,i){var n=t("../internals/path"),s=t("../internals/has-own-property"),r=t("../internals/well-known-symbol-wrapped"),o=t("../internals/object-define-property").f;e.exports=function(t){var e=n.Symbol||(n.Symbol={});s(e,t)||o(e,t,{value:r.f(t)})}},{"../internals/has-own-property":275,"../internals/object-define-property":308,"../internals/path":322,"../internals/well-known-symbol-wrapped":356}],356:[function(t,e,i){var n=t("../internals/well-known-symbol");i.f=n},{"../internals/well-known-symbol":357}],357:[function(t,e,i){var n=t("../internals/global"),s=t("../internals/shared"),r=t("../internals/has-own-property"),o=t("../internals/uid"),a=t("../internals/symbol-constructor-detection"),h=t("../internals/use-symbol-as-uid"),c=n.Symbol,u=s("wks"),l=h?c.for||c:c&&c.withoutSetter||o;e.exports=function(t){return r(u,t)||(u[t]=a&&r(c,t)?c[t]:l("Symbol."+t)),u[t]}},{"../internals/global":274,"../internals/has-own-property":275,"../internals/shared":334,"../internals/symbol-constructor-detection":336,"../internals/uid":350,"../internals/use-symbol-as-uid":351}],358:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/array-iteration").findIndex,r=t("../internals/add-to-unscopables"),o=!0;"findIndex"in[]&&Array(1).findIndex((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{findIndex:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),r("findIndex")},{"../internals/add-to-unscopables":225,"../internals/array-iteration":229,"../internals/export":259}],359:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/array-iteration").find,r=t("../internals/add-to-unscopables"),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),n({target:"Array",proto:!0,forced:o},{find:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),r("find")},{"../internals/add-to-unscopables":225,"../internals/array-iteration":229,"../internals/export":259}],360:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/array-includes").includes,r=t("../internals/fails"),o=t("../internals/add-to-unscopables");n({target:"Array",proto:!0,forced:r((function(){return!Array(1).includes()}))},{includes:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}}),o("includes")},{"../internals/add-to-unscopables":225,"../internals/array-includes":228,"../internals/export":259,"../internals/fails":260}],361:[function(t,e,i){var n=t("../internals/to-indexed-object"),s=t("../internals/add-to-unscopables"),r=t("../internals/iterators"),o=t("../internals/internal-state"),a=t("../internals/object-define-property").f,h=t("../internals/iterator-define"),c=t("../internals/create-iter-result-object"),u=t("../internals/is-pure"),l=t("../internals/descriptors"),f=o.set,d=o.getterFor("Array Iterator");e.exports=h(Array,"Array",(function(t,e){f(this,{type:"Array Iterator",target:n(t),index:0,kind:e})}),(function(){var t=d(this),e=t.target,i=t.kind,n=t.index++;if(!e||n>=e.length)return t.target=void 0,c(void 0,!0);switch(i){case"keys":return c(n,!1);case"values":return c(e[n],!1)}return c([n,e[n]],!1)}),"values");var p=r.Arguments=r.Array;if(s("keys"),s("values"),s("entries"),!u&&l&&"values"!==p.name)try{a(p,"name",{value:"values"})}catch(t){}},{"../internals/add-to-unscopables":225,"../internals/create-iter-result-object":240,"../internals/descriptors":247,"../internals/internal-state":282,"../internals/is-pure":290,"../internals/iterator-define":296,"../internals/iterators":298,"../internals/object-define-property":308,"../internals/to-indexed-object":341}],362:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/get-built-in"),r=t("../internals/function-apply"),o=t("../internals/function-call"),a=t("../internals/function-uncurry-this"),h=t("../internals/fails"),c=t("../internals/is-callable"),u=t("../internals/is-symbol"),l=t("../internals/array-slice"),f=t("../internals/get-json-replacer-function"),d=t("../internals/symbol-constructor-detection"),p=String,m=s("JSON","stringify"),_=a(/./.exec),v=a("".charAt),g=a("".charCodeAt),b=a("".replace),w=a(1..toString),y=/[\uD800-\uDFFF]/g,x=/^[\uD800-\uDBFF]$/,M=/^[\uDC00-\uDFFF]$/,T=!d||h((function(){var t=s("Symbol")("stringify detection");return"[null]"!==m([t])||"{}"!==m({a:t})||"{}"!==m(Object(t))})),O=h((function(){return'"\\udf06\\ud834"'!==m("\udf06\ud834")||'"\\udead"'!==m("\udead")})),E=function(t,e){var i=l(arguments),n=f(e);if(c(n)||void 0!==t&&!u(t))return i[1]=function(t,e){if(c(n)&&(e=o(n,this,p(t),e)),!u(e))return e},r(m,null,i)},A=function(t,e,i){var n=v(i,e-1),s=v(i,e+1);return _(x,t)&&!_(M,s)||_(M,t)&&!_(x,n)?"\\u"+w(g(t,0),16):t};m&&n({target:"JSON",stat:!0,arity:3,forced:T||O},{stringify:function(t,e,i){var n=l(arguments),s=r(T?E:m,null,n);return O&&"string"==typeof s?b(s,y,A):s}})},{"../internals/array-slice":231,"../internals/export":259,"../internals/fails":260,"../internals/function-apply":261,"../internals/function-call":264,"../internals/function-uncurry-this":268,"../internals/get-built-in":269,"../internals/get-json-replacer-function":272,"../internals/is-callable":285,"../internals/is-symbol":292,"../internals/symbol-constructor-detection":336}],363:[function(t,e,i){t("../internals/export")({target:"Number",stat:!0},{isNaN:function(t){return t!=t}})},{"../internals/export":259}],364:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/object-assign");n({target:"Object",stat:!0,arity:2,forced:Object.assign!==s},{assign:s})},{"../internals/export":259,"../internals/object-assign":305}],365:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/symbol-constructor-detection"),r=t("../internals/fails"),o=t("../internals/object-get-own-property-symbols"),a=t("../internals/to-object");n({target:"Object",stat:!0,forced:!s||r((function(){o.f(1)}))},{getOwnPropertySymbols:function(t){var e=o.f;return e?e(a(t)):[]}})},{"../internals/export":259,"../internals/fails":260,"../internals/object-get-own-property-symbols":312,"../internals/symbol-constructor-detection":336,"../internals/to-object":344}],366:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/to-object"),r=t("../internals/object-keys");n({target:"Object",stat:!0,forced:t("../internals/fails")((function(){r(1)}))},{keys:function(t){return r(s(t))}})},{"../internals/export":259,"../internals/fails":260,"../internals/object-keys":316,"../internals/to-object":344}],367:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/object-to-array").values;n({target:"Object",stat:!0},{values:function(t){return s(t)}})},{"../internals/export":259,"../internals/object-to-array":319}],368:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/function-call"),r=t("../internals/a-callable"),o=t("../internals/new-promise-capability"),a=t("../internals/perform"),h=t("../internals/iterate");n({target:"Promise",stat:!0,forced:t("../internals/promise-statics-incorrect-iteration")},{all:function(t){var e=this,i=o.f(e),n=i.resolve,c=i.reject,u=a((function(){var i=r(e.resolve),o=[],a=0,u=1;h(t,(function(t){var r=a++,h=!1;u++,s(i,e,t).then((function(t){h||(h=!0,o[r]=t,--u||n(o))}),c)})),--u||n(o)}));return u.error&&c(u.value),i.promise}})},{"../internals/a-callable":222,"../internals/export":259,"../internals/function-call":264,"../internals/iterate":293,"../internals/new-promise-capability":303,"../internals/perform":323,"../internals/promise-statics-incorrect-iteration":327}],369:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/is-pure"),r=t("../internals/promise-constructor-detection").CONSTRUCTOR,o=t("../internals/promise-native-constructor"),a=t("../internals/get-built-in"),h=t("../internals/is-callable"),c=t("../internals/define-built-in"),u=o&&o.prototype;if(n({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(t){return this.then(void 0,t)}}),!s&&h(o)){var l=a("Promise").prototype.catch;u.catch!==l&&c(u,"catch",l,{unsafe:!0})}},{"../internals/define-built-in":245,"../internals/export":259,"../internals/get-built-in":269,"../internals/is-callable":285,"../internals/is-pure":290,"../internals/promise-constructor-detection":324,"../internals/promise-native-constructor":325}],370:[function(t,e,i){var n,s,r,o=t("../internals/export"),a=t("../internals/is-pure"),h=t("../internals/engine-is-node"),c=t("../internals/global"),u=t("../internals/function-call"),l=t("../internals/define-built-in"),f=t("../internals/object-set-prototype-of"),d=t("../internals/set-to-string-tag"),p=t("../internals/set-species"),m=t("../internals/a-callable"),_=t("../internals/is-callable"),v=t("../internals/is-object"),g=t("../internals/an-instance"),b=t("../internals/species-constructor"),w=t("../internals/task").set,y=t("../internals/microtask"),x=t("../internals/host-report-errors"),M=t("../internals/perform"),T=t("../internals/queue"),O=t("../internals/internal-state"),E=t("../internals/promise-native-constructor"),A=t("../internals/promise-constructor-detection"),S=t("../internals/new-promise-capability"),k=A.CONSTRUCTOR,I=A.REJECTION_EVENT,C=A.SUBCLASSING,j=O.getterFor("Promise"),D=O.set,R=E&&E.prototype,P=E,N=R,F=c.TypeError,z=c.document,L=c.process,$=S.f,U=$,B=!!(z&&z.createEvent&&c.dispatchEvent),G=function(t){var e;return!(!v(t)||!_(e=t.then))&&e},H=function(t,e){var i,n,s,r=e.value,o=1===e.state,a=o?t.ok:t.fail,h=t.resolve,c=t.reject,l=t.domain;try{a?(o||(2===e.rejection&&X(e),e.rejection=1),!0===a?i=r:(l&&l.enter(),i=a(r),l&&(l.exit(),s=!0)),i===t.promise?c(new F("Promise-chain cycle")):(n=G(i))?u(n,i,h,c):h(i)):c(r)}catch(t){l&&!s&&l.exit(),c(t)}},V=function(t,e){t.notified||(t.notified=!0,y((function(){for(var i,n=t.reactions;i=n.get();)H(i,t);t.notified=!1,e&&!t.rejection&&q(t)})))},W=function(t,e,i){var n,s;B?((n=z.createEvent("Event")).promise=e,n.reason=i,n.initEvent(t,!1,!0),c.dispatchEvent(n)):n={promise:e,reason:i},!I&&(s=c["on"+t])?s(n):"unhandledrejection"===t&&x("Unhandled promise rejection",i)},q=function(t){u(w,c,(function(){var e,i=t.facade,n=t.value;if(Y(t)&&(e=M((function(){h?L.emit("unhandledRejection",n,i):W("unhandledrejection",i,n)})),t.rejection=h||Y(t)?2:1,e.error))throw e.value}))},Y=function(t){return 1!==t.rejection&&!t.parent},X=function(t){u(w,c,(function(){var e=t.facade;h?L.emit("rejectionHandled",e):W("rejectionhandled",e,t.value)}))},Z=function(t,e,i){return function(n){t(e,n,i)}},J=function(t,e,i){t.done||(t.done=!0,i&&(t=i),t.value=e,t.state=2,V(t,!0))},K=function(t,e,i){if(!t.done){t.done=!0,i&&(t=i);try{if(t.facade===e)throw new F("Promise can't be resolved itself");var n=G(e);n?y((function(){var i={done:!1};try{u(n,e,Z(K,i,t),Z(J,i,t))}catch(e){J(i,e,t)}})):(t.value=e,t.state=1,V(t,!1))}catch(e){J({done:!1},e,t)}}};if(k&&(N=(P=function(t){g(this,N),m(t),u(n,this);var e=j(this);try{t(Z(K,e),Z(J,e))}catch(t){J(e,t)}}).prototype,(n=function(t){D(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new T,rejection:!1,state:0,value:void 0})}).prototype=l(N,"then",(function(t,e){var i=j(this),n=$(b(this,P));return i.parent=!0,n.ok=!_(t)||t,n.fail=_(e)&&e,n.domain=h?L.domain:void 0,0===i.state?i.reactions.add(n):y((function(){H(n,i)})),n.promise})),s=function(){var t=new n,e=j(t);this.promise=t,this.resolve=Z(K,e),this.reject=Z(J,e)},S.f=$=function(t){return t===P||void 0===t?new s(t):U(t)},!a&&_(E)&&R!==Object.prototype)){r=R.then,C||l(R,"then",(function(t,e){var i=this;return new P((function(t,e){u(r,i,t,e)})).then(t,e)}),{unsafe:!0});try{delete R.constructor}catch(t){}f&&f(R,N)}o({global:!0,constructor:!0,wrap:!0,forced:k},{Promise:P}),d(P,"Promise",!1,!0),p("Promise")},{"../internals/a-callable":222,"../internals/an-instance":226,"../internals/define-built-in":245,"../internals/engine-is-node":254,"../internals/export":259,"../internals/function-call":264,"../internals/global":274,"../internals/host-report-errors":277,"../internals/internal-state":282,"../internals/is-callable":285,"../internals/is-object":289,"../internals/is-pure":290,"../internals/microtask":302,"../internals/new-promise-capability":303,"../internals/object-set-prototype-of":318,"../internals/perform":323,"../internals/promise-constructor-detection":324,"../internals/promise-native-constructor":325,"../internals/queue":328,"../internals/set-species":330,"../internals/set-to-string-tag":331,"../internals/species-constructor":335,"../internals/task":339}],371:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/is-pure"),r=t("../internals/promise-native-constructor"),o=t("../internals/fails"),a=t("../internals/get-built-in"),h=t("../internals/is-callable"),c=t("../internals/species-constructor"),u=t("../internals/promise-resolve"),l=t("../internals/define-built-in"),f=r&&r.prototype;if(n({target:"Promise",proto:!0,real:!0,forced:!!r&&o((function(){f.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=c(this,a("Promise")),i=h(t);return this.then(i?function(i){return u(e,t()).then((function(){return i}))}:t,i?function(i){return u(e,t()).then((function(){throw i}))}:t)}}),!s&&h(r)){var d=a("Promise").prototype.finally;f.finally!==d&&l(f,"finally",d,{unsafe:!0})}},{"../internals/define-built-in":245,"../internals/export":259,"../internals/fails":260,"../internals/get-built-in":269,"../internals/is-callable":285,"../internals/is-pure":290,"../internals/promise-native-constructor":325,"../internals/promise-resolve":326,"../internals/species-constructor":335}],372:[function(t,e,i){t("../modules/es.promise.constructor"),t("../modules/es.promise.all"),t("../modules/es.promise.catch"),t("../modules/es.promise.race"),t("../modules/es.promise.reject"),t("../modules/es.promise.resolve")},{"../modules/es.promise.all":368,"../modules/es.promise.catch":369,"../modules/es.promise.constructor":370,"../modules/es.promise.race":373,"../modules/es.promise.reject":374,"../modules/es.promise.resolve":375}],373:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/function-call"),r=t("../internals/a-callable"),o=t("../internals/new-promise-capability"),a=t("../internals/perform"),h=t("../internals/iterate");n({target:"Promise",stat:!0,forced:t("../internals/promise-statics-incorrect-iteration")},{race:function(t){var e=this,i=o.f(e),n=i.reject,c=a((function(){var o=r(e.resolve);h(t,(function(t){s(o,e,t).then(i.resolve,n)}))}));return c.error&&n(c.value),i.promise}})},{"../internals/a-callable":222,"../internals/export":259,"../internals/function-call":264,"../internals/iterate":293,"../internals/new-promise-capability":303,"../internals/perform":323,"../internals/promise-statics-incorrect-iteration":327}],374:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/function-call"),r=t("../internals/new-promise-capability");n({target:"Promise",stat:!0,forced:t("../internals/promise-constructor-detection").CONSTRUCTOR},{reject:function(t){var e=r.f(this);return s(e.reject,void 0,t),e.promise}})},{"../internals/export":259,"../internals/function-call":264,"../internals/new-promise-capability":303,"../internals/promise-constructor-detection":324}],375:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/get-built-in"),r=t("../internals/is-pure"),o=t("../internals/promise-native-constructor"),a=t("../internals/promise-constructor-detection").CONSTRUCTOR,h=t("../internals/promise-resolve"),c=s("Promise"),u=r&&!a;n({target:"Promise",stat:!0,forced:r||a},{resolve:function(t){return h(u&&this===c?o:this,t)}})},{"../internals/export":259,"../internals/get-built-in":269,"../internals/is-pure":290,"../internals/promise-constructor-detection":324,"../internals/promise-native-constructor":325,"../internals/promise-resolve":326}],376:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/function-uncurry-this"),r=t("../internals/to-absolute-index"),o=RangeError,a=String.fromCharCode,h=String.fromCodePoint,c=s([].join);n({target:"String",stat:!0,arity:1,forced:!!h&&1!==h.length},{fromCodePoint:function(t){for(var e,i=[],n=arguments.length,s=0;n>s;){if(e=+arguments[s++],r(e,1114111)!==e)throw new o(e+" is not a valid code point");i[s]=e<65536?a(e):a(55296+((e-=65536)>>10),e%1024+56320)}return c(i,"")}})},{"../internals/export":259,"../internals/function-uncurry-this":268,"../internals/to-absolute-index":340}],377:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/function-uncurry-this"),r=t("../internals/not-a-regexp"),o=t("../internals/require-object-coercible"),a=t("../internals/to-string"),h=t("../internals/correct-is-regexp-logic"),c=s("".indexOf);n({target:"String",proto:!0,forced:!h("includes")},{includes:function(t){return!!~c(a(o(this)),a(r(t)),arguments.length>1?arguments[1]:void 0)}})},{"../internals/correct-is-regexp-logic":238,"../internals/export":259,"../internals/function-uncurry-this":268,"../internals/not-a-regexp":304,"../internals/require-object-coercible":329,"../internals/to-string":348}],378:[function(t,e,i){t("../internals/well-known-symbol-define")("asyncIterator")},{"../internals/well-known-symbol-define":355}],379:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/global"),r=t("../internals/function-call"),o=t("../internals/function-uncurry-this"),a=t("../internals/is-pure"),h=t("../internals/descriptors"),c=t("../internals/symbol-constructor-detection"),u=t("../internals/fails"),l=t("../internals/has-own-property"),f=t("../internals/object-is-prototype-of"),d=t("../internals/an-object"),p=t("../internals/to-indexed-object"),m=t("../internals/to-property-key"),_=t("../internals/to-string"),v=t("../internals/create-property-descriptor"),g=t("../internals/object-create"),b=t("../internals/object-keys"),w=t("../internals/object-get-own-property-names"),y=t("../internals/object-get-own-property-names-external"),x=t("../internals/object-get-own-property-symbols"),M=t("../internals/object-get-own-property-descriptor"),T=t("../internals/object-define-property"),O=t("../internals/object-define-properties"),E=t("../internals/object-property-is-enumerable"),A=t("../internals/define-built-in"),S=t("../internals/define-built-in-accessor"),k=t("../internals/shared"),I=t("../internals/shared-key"),C=t("../internals/hidden-keys"),j=t("../internals/uid"),D=t("../internals/well-known-symbol"),R=t("../internals/well-known-symbol-wrapped"),P=t("../internals/well-known-symbol-define"),N=t("../internals/symbol-define-to-primitive"),F=t("../internals/set-to-string-tag"),z=t("../internals/internal-state"),L=t("../internals/array-iteration").forEach,$=I("hidden"),U=z.set,B=z.getterFor("Symbol"),G=Object.prototype,H=s.Symbol,V=H&&H.prototype,W=s.RangeError,q=s.TypeError,Y=s.QObject,X=M.f,Z=T.f,J=y.f,K=E.f,Q=o([].push),tt=k("symbols"),et=k("op-symbols"),it=k("wks"),nt=!Y||!Y.prototype||!Y.prototype.findChild,st=function(t,e,i){var n=X(G,e);n&&delete G[e],Z(t,e,i),n&&t!==G&&Z(G,e,n)},rt=h&&u((function(){return 7!==g(Z({},"a",{get:function(){return Z(this,"a",{value:7}).a}})).a}))?st:Z,ot=function(t,e){var i=tt[t]=g(V);return U(i,{type:"Symbol",tag:t,description:e}),h||(i.description=e),i},at=function(t,e,i){t===G&&at(et,e,i),d(t);var n=m(e);return d(i),l(tt,n)?(i.enumerable?(l(t,$)&&t[$][n]&&(t[$][n]=!1),i=g(i,{enumerable:v(0,!1)})):(l(t,$)||Z(t,$,v(1,{})),t[$][n]=!0),rt(t,n,i)):Z(t,n,i)},ht=function(t,e){d(t);var i=p(e),n=b(i).concat(ft(i));return L(n,(function(e){h&&!r(ct,i,e)||at(t,e,i[e])})),t},ct=function(t){var e=m(t),i=r(K,this,e);return!(this===G&&l(tt,e)&&!l(et,e))&&(!(i||!l(this,e)||!l(tt,e)||l(this,$)&&this[$][e])||i)},ut=function(t,e){var i=p(t),n=m(e);if(i!==G||!l(tt,n)||l(et,n)){var s=X(i,n);return!s||!l(tt,n)||l(i,$)&&i[$][n]||(s.enumerable=!0),s}},lt=function(t){var e=J(p(t)),i=[];return L(e,(function(t){l(tt,t)||l(C,t)||Q(i,t)})),i},ft=function(t){var e=t===G,i=J(e?et:p(t)),n=[];return L(i,(function(t){!l(tt,t)||e&&!l(G,t)||Q(n,tt[t])})),n};c||(A(V=(H=function(){if(f(V,this))throw new q("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?_(arguments[0]):void 0,e=j(t),i=function(t){this===G&&r(i,et,t),l(this,$)&&l(this[$],e)&&(this[$][e]=!1);var n=v(1,t);try{rt(this,e,n)}catch(t){if(!(t instanceof W))throw t;st(this,e,n)}};return h&&nt&&rt(G,e,{configurable:!0,set:i}),ot(e,t)}).prototype,"toString",(function(){return B(this).tag})),A(H,"withoutSetter",(function(t){return ot(j(t),t)})),E.f=ct,T.f=at,O.f=ht,M.f=ut,w.f=y.f=lt,x.f=ft,R.f=function(t){return ot(D(t),t)},h&&(S(V,"description",{configurable:!0,get:function(){return B(this).description}}),a||A(G,"propertyIsEnumerable",ct,{unsafe:!0}))),n({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:H}),L(b(it),(function(t){P(t)})),n({target:"Symbol",stat:!0,forced:!c},{useSetter:function(){nt=!0},useSimple:function(){nt=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!h},{create:function(t,e){return void 0===e?g(t):ht(g(t),e)},defineProperty:at,defineProperties:ht,getOwnPropertyDescriptor:ut}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:lt}),N(),F(H,"Symbol"),C[$]=!0},{"../internals/an-object":227,"../internals/array-iteration":229,"../internals/create-property-descriptor":242,"../internals/define-built-in":245,"../internals/define-built-in-accessor":244,"../internals/descriptors":247,"../internals/export":259,"../internals/fails":260,"../internals/function-call":264,"../internals/function-uncurry-this":268,"../internals/global":274,"../internals/has-own-property":275,"../internals/hidden-keys":276,"../internals/internal-state":282,"../internals/is-pure":290,"../internals/object-create":306,"../internals/object-define-properties":307,"../internals/object-define-property":308,"../internals/object-get-own-property-descriptor":309,"../internals/object-get-own-property-names":311,"../internals/object-get-own-property-names-external":310,"../internals/object-get-own-property-symbols":312,"../internals/object-is-prototype-of":314,"../internals/object-keys":316,"../internals/object-property-is-enumerable":317,"../internals/set-to-string-tag":331,"../internals/shared":334,"../internals/shared-key":332,"../internals/symbol-constructor-detection":336,"../internals/symbol-define-to-primitive":337,"../internals/to-indexed-object":341,"../internals/to-property-key":346,"../internals/to-string":348,"../internals/uid":350,"../internals/well-known-symbol":357,"../internals/well-known-symbol-define":355,"../internals/well-known-symbol-wrapped":356}],380:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/get-built-in"),r=t("../internals/has-own-property"),o=t("../internals/to-string"),a=t("../internals/shared"),h=t("../internals/symbol-registry-detection"),c=a("string-to-symbol-registry"),u=a("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!h},{for:function(t){var e=o(t);if(r(c,e))return c[e];var i=s("Symbol")(e);return c[e]=i,u[i]=e,i}})},{"../internals/export":259,"../internals/get-built-in":269,"../internals/has-own-property":275,"../internals/shared":334,"../internals/symbol-registry-detection":338,"../internals/to-string":348}],381:[function(t,e,i){t("../modules/es.symbol.constructor"),t("../modules/es.symbol.for"),t("../modules/es.symbol.key-for"),t("../modules/es.json.stringify"),t("../modules/es.object.get-own-property-symbols")},{"../modules/es.json.stringify":362,"../modules/es.object.get-own-property-symbols":365,"../modules/es.symbol.constructor":379,"../modules/es.symbol.for":380,"../modules/es.symbol.key-for":382}],382:[function(t,e,i){var n=t("../internals/export"),s=t("../internals/has-own-property"),r=t("../internals/is-symbol"),o=t("../internals/try-to-string"),a=t("../internals/shared"),h=t("../internals/symbol-registry-detection"),c=a("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!h},{keyFor:function(t){if(!r(t))throw new TypeError(o(t)+" is not a symbol");if(s(c,t))return c[t]}})},{"../internals/export":259,"../internals/has-own-property":275,"../internals/is-symbol":292,"../internals/shared":334,"../internals/symbol-registry-detection":338,"../internals/try-to-string":349}],383:[function(t,e,i){function n(t){return Object.prototype.toString.call(t)}i.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},i.isBoolean=function(t){return"boolean"==typeof t},i.isNull=function(t){return null===t},i.isNullOrUndefined=function(t){return null==t},i.isNumber=function(t){return"number"==typeof t},i.isString=function(t){return"string"==typeof t},i.isSymbol=function(t){return"symbol"==typeof t},i.isUndefined=function(t){return void 0===t},i.isRegExp=function(t){return"[object RegExp]"===n(t)},i.isObject=function(t){return"object"==typeof t&&null!==t},i.isDate=function(t){return"[object Date]"===n(t)},i.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},i.isFunction=function(t){return"function"==typeof t},i.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},i.isBuffer=t("buffer").Buffer.isBuffer},{buffer:220}],384:[function(t,e,i){(function(i){(function(){var n=t("elliptic"),s=t("bn.js");e.exports=function(t){return new o(t)};var r={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function o(t){this.curveType=r[t],this.curveType||(this.curveType={name:t}),this.curve=new n.ec(this.curveType.name),this.keys=void 0}function a(t,e,n){Array.isArray(t)||(t=t.toArray());var s=new i(t);if(n&&s.length<n){var r=new i(n-s.length);r.fill(0),s=i.concat([r,s])}return e?s.toString(e):s}r.p224=r.secp224r1,r.p256=r.secp256r1=r.prime256v1,r.p192=r.secp192r1=r.prime192v1,r.p384=r.secp384r1,r.p521=r.secp521r1,o.prototype.generateKeys=function(t,e){return this.keys=this.curve.genKeyPair(),this.getPublicKey(t,e)},o.prototype.computeSecret=function(t,e,n){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),a(this.curve.keyFromPublic(t).getPublic().mul(this.keys.getPrivate()).getX(),n,this.curveType.byteLength)},o.prototype.getPublicKey=function(t,e){var i=this.keys.getPublic("compressed"===e,!0);return"hybrid"===e&&(i[i.length-1]%2?i[0]=7:i[0]=6),a(i,t)},o.prototype.getPrivateKey=function(t){return a(this.keys.getPrivate(),t)},o.prototype.setPublicKey=function(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this.keys._importPublic(t),this},o.prototype.setPrivateKey=function(t,e){e=e||"utf8",i.isBuffer(t)||(t=new i(t,e));var n=new s(t);return n=n.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(n),this}}).call(this)}).call(this,t("buffer").Buffer)},{"bn.js":385,buffer:220,elliptic:405}],385:[function(t,e,i){arguments[4][184][0].apply(i,arguments)},{buffer:188,dup:184}],386:[function(t,e,i){var n=t("inherits"),s=t("md5.js"),r=t("ripemd160"),o=t("sha.js"),a=t("cipher-base");function h(t){a.call(this,"digest"),this._hash=t}n(h,a),h.prototype._update=function(t){this._hash.update(t)},h.prototype._final=function(){return this._hash.digest()},e.exports=function(t){return"md5"===(t=t.toLowerCase())?new s:"rmd160"===t||"ripemd160"===t?new r:new h(o(t))}},{"cipher-base":221,inherits:440,"md5.js":450,ripemd160:493,"sha.js":498}],387:[function(t,e,i){var n=t("md5.js");e.exports=function(t){return(new n).update(t).digest()}},{"md5.js":450}],388:[function(t,e,i){var n=t("inherits"),s=t("./legacy"),r=t("cipher-base"),o=t("safe-buffer").Buffer,a=t("create-hash/md5"),h=t("ripemd160"),c=t("sha.js"),u=o.alloc(128);function l(t,e){r.call(this,"digest"),"string"==typeof e&&(e=o.from(e));var i="sha512"===t||"sha384"===t?128:64;(this._alg=t,this._key=e,e.length>i)?e=("rmd160"===t?new h:c(t)).update(e).digest():e.length<i&&(e=o.concat([e,u],i));for(var n=this._ipad=o.allocUnsafe(i),s=this._opad=o.allocUnsafe(i),a=0;a<i;a++)n[a]=54^e[a],s[a]=92^e[a];this._hash="rmd160"===t?new h:c(t),this._hash.update(n)}n(l,r),l.prototype._update=function(t){this._hash.update(t)},l.prototype._final=function(){var t=this._hash.digest();return("rmd160"===this._alg?new h:c(this._alg)).update(this._opad).update(t).digest()},e.exports=function(t,e){return"rmd160"===(t=t.toLowerCase())||"ripemd160"===t?new l("rmd160",e):"md5"===t?new s(a,e):new l(t,e)}},{"./legacy":389,"cipher-base":221,"create-hash/md5":387,inherits:440,ripemd160:493,"safe-buffer":494,"sha.js":498}],389:[function(t,e,i){var n=t("inherits"),s=t("safe-buffer").Buffer,r=t("cipher-base"),o=s.alloc(128);function a(t,e){r.call(this,"digest"),"string"==typeof e&&(e=s.from(e)),this._alg=t,this._key=e,e.length>64?e=t(e):e.length<64&&(e=s.concat([e,o],64));for(var i=this._ipad=s.allocUnsafe(64),n=this._opad=s.allocUnsafe(64),a=0;a<64;a++)i[a]=54^e[a],n[a]=92^e[a];this._hash=[i]}n(a,r),a.prototype._update=function(t){this._hash.push(t)},a.prototype._final=function(){var t=this._alg(s.concat(this._hash));return this._alg(s.concat([this._opad,t]))},e.exports=a},{"cipher-base":221,inherits:440,"safe-buffer":494}],390:[function(t,e,i){i.randomBytes=i.rng=i.pseudoRandomBytes=i.prng=t("randombytes"),i.createHash=i.Hash=t("create-hash"),i.createHmac=i.Hmac=t("create-hmac");var n=t("browserify-sign/algos"),s=Object.keys(n),r=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(s);i.getHashes=function(){return r};var o=t("pbkdf2");i.pbkdf2=o.pbkdf2,i.pbkdf2Sync=o.pbkdf2Sync;var a=t("browserify-cipher");i.Cipher=a.Cipher,i.createCipher=a.createCipher,i.Cipheriv=a.Cipheriv,i.createCipheriv=a.createCipheriv,i.Decipher=a.Decipher,i.createDecipher=a.createDecipher,i.Decipheriv=a.Decipheriv,i.createDecipheriv=a.createDecipheriv,i.getCiphers=a.getCiphers,i.listCiphers=a.listCiphers;var h=t("diffie-hellman");i.DiffieHellmanGroup=h.DiffieHellmanGroup,i.createDiffieHellmanGroup=h.createDiffieHellmanGroup,i.getDiffieHellman=h.getDiffieHellman,i.createDiffieHellman=h.createDiffieHellman,i.DiffieHellman=h.DiffieHellman;var c=t("browserify-sign");i.createSign=c.createSign,i.Sign=c.Sign,i.createVerify=c.createVerify,i.Verify=c.Verify,i.createECDH=t("create-ecdh");var u=t("public-encrypt");i.publicEncrypt=u.publicEncrypt,i.privateEncrypt=u.privateEncrypt,i.publicDecrypt=u.publicDecrypt,i.privateDecrypt=u.privateDecrypt;var l=t("randomfill");i.randomFill=l.randomFill,i.randomFillSync=l.randomFillSync,i.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},i.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},{"browserify-cipher":206,"browserify-sign":213,"browserify-sign/algos":210,"create-ecdh":384,"create-hash":386,"create-hmac":388,"diffie-hellman":400,pbkdf2:460,"public-encrypt":468,randombytes:475,randomfill:476}],391:[function(t,e,i){!function(t,n){"object"==typeof i&&void 0!==e?e.exports=n():(t="undefined"!=typeof globalThis?globalThis:t||self).dayjs=n()}(void 0,(function(){var t=6e4,e=36e5,i="millisecond",n="second",s="minute",r="hour",o="day",a="week",h="month",c="quarter",u="year",l="date",f="Invalid Date",d=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,m={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],i=t%100;return"["+t+(e[(i-20)%10]||e[i]||e[0])+"]"}},_=function(t,e,i){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(i)+t},v={s:_,z:function(t){var e=-t.utcOffset(),i=Math.abs(e),n=Math.floor(i/60),s=i%60;return(e<=0?"+":"-")+_(n,2,"0")+":"+_(s,2,"0")},m:function t(e,i){if(e.date()<i.date())return-t(i,e);var n=12*(i.year()-e.year())+(i.month()-e.month()),s=e.clone().add(n,h),r=i-s<0,o=e.clone().add(n+(r?-1:1),h);return+(-(n+(i-s)/(r?s-o:o-s))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:h,y:u,w:a,d:o,D:l,h:r,m:s,s:n,ms:i,Q:c}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},g="en",b={};b[g]=m;var w="$isDayjsObject",y=function(t){return t instanceof O||!(!t||!t[w])},x=function t(e,i,n){var s;if(!e)return g;if("string"==typeof e){var r=e.toLowerCase();b[r]&&(s=r),i&&(b[r]=i,s=r);var o=e.split("-");if(!s&&o.length>1)return t(o[0])}else{var a=e.name;b[a]=e,s=a}return!n&&s&&(g=s),s||!n&&g},M=function(t,e){if(y(t))return t.clone();var i="object"==typeof e?e:{};return i.date=t,i.args=arguments,new O(i)},T=v;T.l=x,T.i=y,T.w=function(t,e){return M(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var O=function(){function m(t){this.$L=x(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var _=m.prototype;return _.parse=function(t){this.$d=function(t){var e=t.date,i=t.utc;if(null===e)return new Date(NaN);if(T.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(d);if(n){var s=n[2]-1||0,r=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],s,n[3]||1,n[4]||0,n[5]||0,n[6]||0,r)):new Date(n[1],s,n[3]||1,n[4]||0,n[5]||0,n[6]||0,r)}}return new Date(e)}(t),this.init()},_.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},_.$utils=function(){return T},_.isValid=function(){return!(this.$d.toString()===f)},_.isSame=function(t,e){var i=M(t);return this.startOf(e)<=i&&i<=this.endOf(e)},_.isAfter=function(t,e){return M(t)<this.startOf(e)},_.isBefore=function(t,e){return this.endOf(e)<M(t)},_.$g=function(t,e,i){return T.u(t)?this[e]:this.set(i,t)},_.unix=function(){return Math.floor(this.valueOf()/1e3)},_.valueOf=function(){return this.$d.getTime()},_.startOf=function(t,e){var i=this,c=!!T.u(e)||e,f=T.p(t),d=function(t,e){var n=T.w(i.$u?Date.UTC(i.$y,e,t):new Date(i.$y,e,t),i);return c?n:n.endOf(o)},p=function(t,e){return T.w(i.toDate()[t].apply(i.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(e)),i)},m=this.$W,_=this.$M,v=this.$D,g="set"+(this.$u?"UTC":"");switch(f){case u:return c?d(1,0):d(31,11);case h:return c?d(1,_):d(0,_+1);case a:var b=this.$locale().weekStart||0,w=(m<b?m+7:m)-b;return d(c?v-w:v+(6-w),_);case o:case l:return p(g+"Hours",0);case r:return p(g+"Minutes",1);case s:return p(g+"Seconds",2);case n:return p(g+"Milliseconds",3);default:return this.clone()}},_.endOf=function(t){return this.startOf(t,!1)},_.$set=function(t,e){var a,c=T.p(t),f="set"+(this.$u?"UTC":""),d=(a={},a[o]=f+"Date",a[l]=f+"Date",a[h]=f+"Month",a[u]=f+"FullYear",a[r]=f+"Hours",a[s]=f+"Minutes",a[n]=f+"Seconds",a[i]=f+"Milliseconds",a)[c],p=c===o?this.$D+(e-this.$W):e;if(c===h||c===u){var m=this.clone().set(l,1);m.$d[d](p),m.init(),this.$d=m.set(l,Math.min(this.$D,m.daysInMonth())).$d}else d&&this.$d[d](p);return this.init(),this},_.set=function(t,e){return this.clone().$set(t,e)},_.get=function(t){return this[T.p(t)]()},_.add=function(i,c){var l,f=this;i=Number(i);var d=T.p(c),p=function(t){var e=M(f);return T.w(e.date(e.date()+Math.round(t*i)),f)};if(d===h)return this.set(h,this.$M+i);if(d===u)return this.set(u,this.$y+i);if(d===o)return p(1);if(d===a)return p(7);var m=(l={},l[s]=t,l[r]=e,l[n]=1e3,l)[d]||1,_=this.$d.getTime()+i*m;return T.w(_,this)},_.subtract=function(t,e){return this.add(-1*t,e)},_.format=function(t){var e=this,i=this.$locale();if(!this.isValid())return i.invalidDate||f;var n=t||"YYYY-MM-DDTHH:mm:ssZ",s=T.z(this),r=this.$H,o=this.$m,a=this.$M,h=i.weekdays,c=i.months,u=i.meridiem,l=function(t,i,s,r){return t&&(t[i]||t(e,n))||s[i].slice(0,r)},d=function(t){return T.s(r%12||12,t,"0")},m=u||function(t,e,i){var n=t<12?"AM":"PM";return i?n.toLowerCase():n};return n.replace(p,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return T.s(e.$y,4,"0");case"M":return a+1;case"MM":return T.s(a+1,2,"0");case"MMM":return l(i.monthsShort,a,c,3);case"MMMM":return l(c,a);case"D":return e.$D;case"DD":return T.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return l(i.weekdaysMin,e.$W,h,2);case"ddd":return l(i.weekdaysShort,e.$W,h,3);case"dddd":return h[e.$W];case"H":return String(r);case"HH":return T.s(r,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return m(r,o,!0);case"A":return m(r,o,!1);case"m":return String(o);case"mm":return T.s(o,2,"0");case"s":return String(e.$s);case"ss":return T.s(e.$s,2,"0");case"SSS":return T.s(e.$ms,3,"0");case"Z":return s}return null}(t)||s.replace(":","")}))},_.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},_.diff=function(i,l,f){var d,p=this,m=T.p(l),_=M(i),v=(_.utcOffset()-this.utcOffset())*t,g=this-_,b=function(){return T.m(p,_)};switch(m){case u:d=b()/12;break;case h:d=b();break;case c:d=b()/3;break;case a:d=(g-v)/6048e5;break;case o:d=(g-v)/864e5;break;case r:d=g/e;break;case s:d=g/t;break;case n:d=g/1e3;break;default:d=g}return f?d:T.a(d)},_.daysInMonth=function(){return this.endOf(h).$D},_.$locale=function(){return b[this.$L]},_.locale=function(t,e){if(!t)return this.$L;var i=this.clone(),n=x(t,e,!0);return n&&(i.$L=n),i},_.clone=function(){return T.w(this.$d,this)},_.toDate=function(){return new Date(this.valueOf())},_.toJSON=function(){return this.isValid()?this.toISOString():null},_.toISOString=function(){return this.$d.toISOString()},_.toString=function(){return this.$d.toUTCString()},m}(),E=O.prototype;return M.prototype=E,[["$ms",i],["$s",n],["$m",s],["$H",r],["$W",o],["$M",h],["$y",u],["$D",l]].forEach((function(t){E[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),M.extend=function(t,e){return t.$i||(t(e,O,M),t.$i=!0),M},M.locale=x,M.isDayjs=y,M.unix=function(t){return M(1e3*t)},M.en=b[g],M.Ls=b,M.p={},M}))},{}],392:[function(t,e,i){!function(t,n){"object"==typeof i&&void 0!==e?e.exports=n():(t="undefined"!=typeof globalThis?globalThis:t||self).dayjs_plugin_customParseFormat=n()}(void 0,(function(){var t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},e=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|YYYY|YY?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,i=/\d\d/,n=/\d\d?/,s=/\d*[^-_:/,()\s\d]+/,r={},o=function(t){return(t=+t)+(t>68?1900:2e3)},a=function(t){return function(e){this[t]=+e}},h=[/[+-]\d\d:?(\d\d)?|Z/,function(t){(this.zone||(this.zone={})).offset=function(t){if(!t)return 0;if("Z"===t)return 0;var e=t.match(/([+-]|\d\d)/g),i=60*e[1]+(+e[2]||0);return 0===i?0:"+"===e[0]?-i:i}(t)}],c=function(t){var e=r[t];return e&&(e.indexOf?e:e.s.concat(e.f))},u=function(t,e){var i,n=r.meridiem;if(n){for(var s=1;s<=24;s+=1)if(t.indexOf(n(s,0,e))>-1){i=s>12;break}}else i=t===(e?"pm":"PM");return i},l={A:[s,function(t){this.afternoon=u(t,!1)}],a:[s,function(t){this.afternoon=u(t,!0)}],S:[/\d/,function(t){this.milliseconds=100*+t}],SS:[i,function(t){this.milliseconds=10*+t}],SSS:[/\d{3}/,function(t){this.milliseconds=+t}],s:[n,a("seconds")],ss:[n,a("seconds")],m:[n,a("minutes")],mm:[n,a("minutes")],H:[n,a("hours")],h:[n,a("hours")],HH:[n,a("hours")],hh:[n,a("hours")],D:[n,a("day")],DD:[i,a("day")],Do:[s,function(t){var e=r.ordinal,i=t.match(/\d+/);if(this.day=i[0],e)for(var n=1;n<=31;n+=1)e(n).replace(/\[|\]/g,"")===t&&(this.day=n)}],M:[n,a("month")],MM:[i,a("month")],MMM:[s,function(t){var e=c("months"),i=(c("monthsShort")||e.map((function(t){return t.slice(0,3)}))).indexOf(t)+1;if(i<1)throw new Error;this.month=i%12||i}],MMMM:[s,function(t){var e=c("months").indexOf(t)+1;if(e<1)throw new Error;this.month=e%12||e}],Y:[/[+-]?\d+/,a("year")],YY:[i,function(t){this.year=o(t)}],YYYY:[/\d{4}/,a("year")],Z:h,ZZ:h};function f(i){var n,s;n=i,s=r&&r.formats;for(var o=(i=n.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(e,i,n){var r=n&&n.toUpperCase();return i||s[n]||t[n]||s[r].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(t,e,i){return e||i.slice(1)}))}))).match(e),a=o.length,h=0;h<a;h+=1){var c=o[h],u=l[c],f=u&&u[0],d=u&&u[1];o[h]=d?{regex:f,parser:d}:c.replace(/^\[|\]$/g,"")}return function(t){for(var e={},i=0,n=0;i<a;i+=1){var s=o[i];if("string"==typeof s)n+=s.length;else{var r=s.regex,h=s.parser,c=t.slice(n),u=r.exec(c)[0];h.call(e,u),t=t.replace(u,"")}}return function(t){var e=t.afternoon;if(void 0!==e){var i=t.hours;e?i<12&&(t.hours+=12):12===i&&(t.hours=0),delete t.afternoon}}(e),e}}return function(t,e,i){i.p.customParseFormat=!0,t&&t.parseTwoDigitYear&&(o=t.parseTwoDigitYear);var n=e.prototype,s=n.parse;n.parse=function(t){var e=t.date,n=t.utc,o=t.args;this.$u=n;var a=o[1];if("string"==typeof a){var h=!0===o[2],c=!0===o[3],u=h||c,l=o[2];c&&(l=o[2]),r=this.$locale(),!h&&l&&(r=i.Ls[l]),this.$d=function(t,e,i){try{if(["x","X"].indexOf(e)>-1)return new Date(("X"===e?1e3:1)*t);var n=f(e)(t),s=n.year,r=n.month,o=n.day,a=n.hours,h=n.minutes,c=n.seconds,u=n.milliseconds,l=n.zone,d=new Date,p=o||(s||r?1:d.getDate()),m=s||d.getFullYear(),_=0;s&&!r||(_=r>0?r-1:d.getMonth());var v=a||0,g=h||0,b=c||0,w=u||0;return l?new Date(Date.UTC(m,_,p,v,g,b,w+60*l.offset*1e3)):i?new Date(Date.UTC(m,_,p,v,g,b,w)):new Date(m,_,p,v,g,b,w)}catch(t){return new Date("")}}(e,a,n),this.init(),l&&!0!==l&&(this.$L=this.locale(l).$L),u&&e!=this.format(a)&&(this.$d=new Date("")),r={}}else if(a instanceof Array)for(var d=a.length,p=1;p<=d;p+=1){o[1]=a[p-1];var m=i.apply(this,o);if(m.isValid()){this.$d=m.$d,this.$L=m.$L,this.init();break}p===d&&(this.$d=new Date(""))}else s.call(this,t)}}}))},{}],393:[function(t,e,i){!function(t,n){"object"==typeof i&&void 0!==e?e.exports=n():(t="undefined"!=typeof globalThis?globalThis:t||self).dayjs_plugin_utc=n()}(void 0,(function(){var t="minute",e=/[+-]\d\d(?::?\d\d)?/g,i=/([+-]|\d\d)/g;return function(n,s,r){var o=s.prototype;r.utc=function(t){var e={date:t,utc:!0,args:arguments};return new s(e)},o.utc=function(e){var i=r(this.toDate(),{locale:this.$L,utc:!0});return e?i.add(this.utcOffset(),t):i},o.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var a=o.parse;o.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),a.call(this,t)};var h=o.init;o.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else h.call(this)};var c=o.utcOffset;o.utcOffset=function(n,s){var r=this.$utils().u;if(r(n))return this.$u?0:r(this.$offset)?c.call(this):this.$offset;if("string"==typeof n&&null===(n=function(t){void 0===t&&(t="");var n=t.match(e);if(!n)return null;var s=(""+n[0]).match(i)||["-",0,0],r=s[0],o=60*+s[1]+ +s[2];return 0===o?0:"+"===r?o:-o}(n)))return this;var o=Math.abs(n)<=16?60*n:n,a=this;if(s)return a.$offset=o,a.$u=0===n,a;if(0!==n){var h=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(o+h,t)).$offset=o,a.$x.$localOffset=h}else a=this.utc();return a};var u=o.format;o.format=function(t){var e=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return u.call(this,e)},o.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},o.isUTC=function(){return!!this.$u},o.toISOString=function(){return this.toDate().toISOString()},o.toString=function(){return this.toDate().toUTCString()};var l=o.toDate;o.toDate=function(t){return"s"===t&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var f=o.diff;o.diff=function(t,e,i){if(t&&this.$u===t.$u)return f.call(this,t,e,i);var n=this.local(),s=r(t).local();return f.call(n,s,e,i)}}}))},{}],394:[function(t,e,i){i.utils=t("./des/utils"),i.Cipher=t("./des/cipher"),i.DES=t("./des/des"),i.CBC=t("./des/cbc"),i.EDE=t("./des/ede")},{"./des/cbc":395,"./des/cipher":396,"./des/des":397,"./des/ede":398,"./des/utils":399}],395:[function(t,e,i){var n=t("minimalistic-assert"),s=t("inherits"),r={};function o(t){n.equal(t.length,8,"Invalid IV length"),this.iv=new Array(8);for(var e=0;e<this.iv.length;e++)this.iv[e]=t[e]}i.instantiate=function(t){function e(e){t.call(this,e),this._cbcInit()}s(e,t);for(var i=Object.keys(r),n=0;n<i.length;n++){var o=i[n];e.prototype[o]=r[o]}return e.create=function(t){return new e(t)},e},r._cbcInit=function(){var t=new o(this.options.iv);this._cbcState=t},r._update=function(t,e,i,n){var s=this._cbcState,r=this.constructor.super_.prototype,o=s.iv;if("encrypt"===this.type){for(var a=0;a<this.blockSize;a++)o[a]^=t[e+a];r._update.call(this,o,0,i,n);for(a=0;a<this.blockSize;a++)o[a]=i[n+a]}else{r._update.call(this,t,e,i,n);for(a=0;a<this.blockSize;a++)i[n+a]^=o[a];for(a=0;a<this.blockSize;a++)o[a]=t[e+a]}}},{inherits:440,"minimalistic-assert":453}],396:[function(t,e,i){var n=t("minimalistic-assert");function s(t){this.options=t,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=!1!==t.padding}e.exports=s,s.prototype._init=function(){},s.prototype.update=function(t){return 0===t.length?[]:"decrypt"===this.type?this._updateDecrypt(t):this._updateEncrypt(t)},s.prototype._buffer=function(t,e){for(var i=Math.min(this.buffer.length-this.bufferOff,t.length-e),n=0;n<i;n++)this.buffer[this.bufferOff+n]=t[e+n];return this.bufferOff+=i,i},s.prototype._flushBuffer=function(t,e){return this._update(this.buffer,0,t,e),this.bufferOff=0,this.blockSize},s.prototype._updateEncrypt=function(t){var e=0,i=0,n=(this.bufferOff+t.length)/this.blockSize|0,s=new Array(n*this.blockSize);0!==this.bufferOff&&(e+=this._buffer(t,e),this.bufferOff===this.buffer.length&&(i+=this._flushBuffer(s,i)));for(var r=t.length-(t.length-e)%this.blockSize;e<r;e+=this.blockSize)this._update(t,e,s,i),i+=this.blockSize;for(;e<t.length;e++,this.bufferOff++)this.buffer[this.bufferOff]=t[e];return s},s.prototype._updateDecrypt=function(t){for(var e=0,i=0,n=Math.ceil((this.bufferOff+t.length)/this.blockSize)-1,s=new Array(n*this.blockSize);n>0;n--)e+=this._buffer(t,e),i+=this._flushBuffer(s,i);return e+=this._buffer(t,e),s},s.prototype.final=function(t){var e,i;return t&&(e=this.update(t)),i="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),e?e.concat(i):i},s.prototype._pad=function(t,e){if(0===e)return!1;for(;e<t.length;)t[e++]=0;return!0},s.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var t=new Array(this.blockSize);return this._update(this.buffer,0,t,0),t},s.prototype._unpad=function(t){return t},s.prototype._finalDecrypt=function(){n.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var t=new Array(this.blockSize);return this._flushBuffer(t,0),this._unpad(t)}},{"minimalistic-assert":453}],397:[function(t,e,i){var n=t("minimalistic-assert"),s=t("inherits"),r=t("./utils"),o=t("./cipher");function a(){this.tmp=new Array(2),this.keys=null}function h(t){o.call(this,t);var e=new a;this._desState=e,this.deriveKeys(e,t.key)}s(h,o),e.exports=h,h.create=function(t){return new h(t)};var c=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];h.prototype.deriveKeys=function(t,e){t.keys=new Array(32),n.equal(e.length,this.blockSize,"Invalid key length");var i=r.readUInt32BE(e,0),s=r.readUInt32BE(e,4);r.pc1(i,s,t.tmp,0),i=t.tmp[0],s=t.tmp[1];for(var o=0;o<t.keys.length;o+=2){var a=c[o>>>1];i=r.r28shl(i,a),s=r.r28shl(s,a),r.pc2(i,s,t.keys,o)}},h.prototype._update=function(t,e,i,n){var s=this._desState,o=r.readUInt32BE(t,e),a=r.readUInt32BE(t,e+4);r.ip(o,a,s.tmp,0),o=s.tmp[0],a=s.tmp[1],"encrypt"===this.type?this._encrypt(s,o,a,s.tmp,0):this._decrypt(s,o,a,s.tmp,0),o=s.tmp[0],a=s.tmp[1],r.writeUInt32BE(i,o,n),r.writeUInt32BE(i,a,n+4)},h.prototype._pad=function(t,e){if(!1===this.padding)return!1;for(var i=t.length-e,n=e;n<t.length;n++)t[n]=i;return!0},h.prototype._unpad=function(t){if(!1===this.padding)return t;for(var e=t[t.length-1],i=t.length-e;i<t.length;i++)n.equal(t[i],e);return t.slice(0,t.length-e)},h.prototype._encrypt=function(t,e,i,n,s){for(var o=e,a=i,h=0;h<t.keys.length;h+=2){var c=t.keys[h],u=t.keys[h+1];r.expand(a,t.tmp,0),c^=t.tmp[0],u^=t.tmp[1];var l=r.substitute(c,u),f=a;a=(o^r.permute(l))>>>0,o=f}r.rip(a,o,n,s)},h.prototype._decrypt=function(t,e,i,n,s){for(var o=i,a=e,h=t.keys.length-2;h>=0;h-=2){var c=t.keys[h],u=t.keys[h+1];r.expand(o,t.tmp,0),c^=t.tmp[0],u^=t.tmp[1];var l=r.substitute(c,u),f=o;o=(a^r.permute(l))>>>0,a=f}r.rip(o,a,n,s)}},{"./cipher":396,"./utils":399,inherits:440,"minimalistic-assert":453}],398:[function(t,e,i){var n=t("minimalistic-assert"),s=t("inherits"),r=t("./cipher"),o=t("./des");function a(t,e){n.equal(e.length,24,"Invalid key length");var i=e.slice(0,8),s=e.slice(8,16),r=e.slice(16,24);this.ciphers="encrypt"===t?[o.create({type:"encrypt",key:i}),o.create({type:"decrypt",key:s}),o.create({type:"encrypt",key:r})]:[o.create({type:"decrypt",key:r}),o.create({type:"encrypt",key:s}),o.create({type:"decrypt",key:i})]}function h(t){r.call(this,t);var e=new a(this.type,this.options.key);this._edeState=e}s(h,r),e.exports=h,h.create=function(t){return new h(t)},h.prototype._update=function(t,e,i,n){var s=this._edeState;s.ciphers[0]._update(t,e,i,n),s.ciphers[1]._update(i,n,i,n),s.ciphers[2]._update(i,n,i,n)},h.prototype._pad=o.prototype._pad,h.prototype._unpad=o.prototype._unpad},{"./cipher":396,"./des":397,inherits:440,"minimalistic-assert":453}],399:[function(t,e,i){i.readUInt32BE=function(t,e){return(t[0+e]<<24|t[1+e]<<16|t[2+e]<<8|t[3+e])>>>0},i.writeUInt32BE=function(t,e,i){t[0+i]=e>>>24,t[1+i]=e>>>16&255,t[2+i]=e>>>8&255,t[3+i]=255&e},i.ip=function(t,e,i,n){for(var s=0,r=0,o=6;o>=0;o-=2){for(var a=0;a<=24;a+=8)s<<=1,s|=e>>>a+o&1;for(a=0;a<=24;a+=8)s<<=1,s|=t>>>a+o&1}for(o=6;o>=0;o-=2){for(a=1;a<=25;a+=8)r<<=1,r|=e>>>a+o&1;for(a=1;a<=25;a+=8)r<<=1,r|=t>>>a+o&1}i[n+0]=s>>>0,i[n+1]=r>>>0},i.rip=function(t,e,i,n){for(var s=0,r=0,o=0;o<4;o++)for(var a=24;a>=0;a-=8)s<<=1,s|=e>>>a+o&1,s<<=1,s|=t>>>a+o&1;for(o=4;o<8;o++)for(a=24;a>=0;a-=8)r<<=1,r|=e>>>a+o&1,r<<=1,r|=t>>>a+o&1;i[n+0]=s>>>0,i[n+1]=r>>>0},i.pc1=function(t,e,i,n){for(var s=0,r=0,o=7;o>=5;o--){for(var a=0;a<=24;a+=8)s<<=1,s|=e>>a+o&1;for(a=0;a<=24;a+=8)s<<=1,s|=t>>a+o&1}for(a=0;a<=24;a+=8)s<<=1,s|=e>>a+o&1;for(o=1;o<=3;o++){for(a=0;a<=24;a+=8)r<<=1,r|=e>>a+o&1;for(a=0;a<=24;a+=8)r<<=1,r|=t>>a+o&1}for(a=0;a<=24;a+=8)r<<=1,r|=t>>a+o&1;i[n+0]=s>>>0,i[n+1]=r>>>0},i.r28shl=function(t,e){return t<<e&268435455|t>>>28-e};var n=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];i.pc2=function(t,e,i,s){for(var r=0,o=0,a=n.length>>>1,h=0;h<a;h++)r<<=1,r|=t>>>n[h]&1;for(h=a;h<n.length;h++)o<<=1,o|=e>>>n[h]&1;i[s+0]=r>>>0,i[s+1]=o>>>0},i.expand=function(t,e,i){var n=0,s=0;n=(1&t)<<5|t>>>27;for(var r=23;r>=15;r-=4)n<<=6,n|=t>>>r&63;for(r=11;r>=3;r-=4)s|=t>>>r&63,s<<=6;s|=(31&t)<<1|t>>>31,e[i+0]=n>>>0,e[i+1]=s>>>0};var s=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];i.substitute=function(t,e){for(var i=0,n=0;n<4;n++){i<<=4,i|=s[64*n+(t>>>18-6*n&63)]}for(n=0;n<4;n++){i<<=4,i|=s[256+64*n+(e>>>18-6*n&63)]}return i>>>0};var r=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];i.permute=function(t){for(var e=0,i=0;i<r.length;i++)e<<=1,e|=t>>>r[i]&1;return e>>>0},i.padSplit=function(t,e,i){for(var n=t.toString(2);n.length<e;)n="0"+n;for(var s=[],r=0;r<e;r+=i)s.push(n.slice(r,r+i));return s.join(" ")}},{}],400:[function(t,e,i){(function(e){(function(){var n=t("./lib/generatePrime"),s=t("./lib/primes.json"),r=t("./lib/dh");var o={binary:!0,hex:!0,base64:!0};i.DiffieHellmanGroup=i.createDiffieHellmanGroup=i.getDiffieHellman=function(t){var i=new e(s[t].prime,"hex"),n=new e(s[t].gen,"hex");return new r(i,n)},i.createDiffieHellman=i.DiffieHellman=function t(i,s,a,h){return e.isBuffer(s)||void 0===o[s]?t(i,"binary",s,a):(s=s||"binary",h=h||"binary",a=a||new e([2]),e.isBuffer(a)||(a=new e(a,h)),"number"==typeof i?new r(n(i,a),a,!0):(e.isBuffer(i)||(i=new e(i,s)),new r(i,a,!0)))}}).call(this)}).call(this,t("buffer").Buffer)},{"./lib/dh":401,"./lib/generatePrime":402,"./lib/primes.json":403,buffer:220}],401:[function(t,e,i){(function(i){(function(){var n=t("bn.js"),s=new(t("miller-rabin")),r=new n(24),o=new n(11),a=new n(10),h=new n(3),c=new n(7),u=t("./generatePrime"),l=t("randombytes");function f(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this._pub=new n(t),this}function d(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this._priv=new n(t),this}e.exports=m;var p={};function m(t,e,i){this.setGenerator(e),this.__prime=new n(t),this._prime=n.mont(this.__prime),this._primeLen=t.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,i?(this.setPublicKey=f,this.setPrivateKey=d):this._primeCode=8}function _(t,e){var n=new i(t.toArray());return e?n.toString(e):n}Object.defineProperty(m.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(t,e){var i=e.toString("hex"),n=[i,t.toString(16)].join("_");if(n in p)return p[n];var l,f=0;if(t.isEven()||!u.simpleSieve||!u.fermatTest(t)||!s.test(t))return f+=1,f+="02"===i||"05"===i?8:4,p[n]=f,f;switch(s.test(t.shrn(1))||(f+=2),i){case"02":t.mod(r).cmp(o)&&(f+=8);break;case"05":(l=t.mod(a)).cmp(h)&&l.cmp(c)&&(f+=8);break;default:f+=4}return p[n]=f,f}(this.__prime,this.__gen)),this._primeCode}}),m.prototype.generateKeys=function(){return this._priv||(this._priv=new n(l(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},m.prototype.computeSecret=function(t){var e=(t=(t=new n(t)).toRed(this._prime)).redPow(this._priv).fromRed(),s=new i(e.toArray()),r=this.getPrime();if(s.length<r.length){var o=new i(r.length-s.length);o.fill(0),s=i.concat([o,s])}return s},m.prototype.getPublicKey=function(t){return _(this._pub,t)},m.prototype.getPrivateKey=function(t){return _(this._priv,t)},m.prototype.getPrime=function(t){return _(this.__prime,t)},m.prototype.getGenerator=function(t){return _(this._gen,t)},m.prototype.setGenerator=function(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this.__gen=t,this._gen=new n(t),this}}).call(this)}).call(this,t("buffer").Buffer)},{"./generatePrime":402,"bn.js":404,buffer:220,"miller-rabin":451,randombytes:475}],402:[function(t,e,i){var n=t("randombytes");e.exports=g,g.simpleSieve=_,g.fermatTest=v;var s=t("bn.js"),r=new s(24),o=new(t("miller-rabin")),a=new s(1),h=new s(2),c=new s(5),u=(new s(16),new s(8),new s(10)),l=new s(3),f=(new s(7),new s(11)),d=new s(4),p=(new s(12),null);function m(){if(null!==p)return p;var t=[];t[0]=2;for(var e=1,i=3;i<1048576;i+=2){for(var n=Math.ceil(Math.sqrt(i)),s=0;s<e&&t[s]<=n&&i%t[s]!=0;s++);e!==s&&t[s]<=n||(t[e++]=i)}return p=t,t}function _(t){for(var e=m(),i=0;i<e.length;i++)if(0===t.modn(e[i]))return 0===t.cmpn(e[i]);return!0}function v(t){var e=s.mont(t);return 0===h.toRed(e).redPow(t.subn(1)).fromRed().cmpn(1)}function g(t,e){if(t<16)return new s(2===e||5===e?[140,123]:[140,39]);var i,p;for(e=new s(e);;){for(i=new s(n(Math.ceil(t/8)));i.bitLength()>t;)i.ishrn(1);if(i.isEven()&&i.iadd(a),i.testn(1)||i.iadd(h),e.cmp(h)){if(!e.cmp(c))for(;i.mod(u).cmp(l);)i.iadd(d)}else for(;i.mod(r).cmp(f);)i.iadd(d);if(_(p=i.shrn(1))&&_(i)&&v(p)&&v(i)&&o.test(p)&&o.test(i))return i}}},{"bn.js":404,"miller-rabin":451,randombytes:475}],403:[function(t,e,i){e.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},{}],404:[function(t,e,i){arguments[4][184][0].apply(i,arguments)},{buffer:188,dup:184}],405:[function(t,e,i){var n=i;n.version=t("../package.json").version,n.utils=t("./elliptic/utils"),n.rand=t("brorand"),n.curve=t("./elliptic/curve"),n.curves=t("./elliptic/curves"),n.ec=t("./elliptic/ec"),n.eddsa=t("./elliptic/eddsa")},{"../package.json":421,"./elliptic/curve":408,"./elliptic/curves":411,"./elliptic/ec":412,"./elliptic/eddsa":415,"./elliptic/utils":419,brorand:187}],406:[function(t,e,i){var n=t("bn.js"),s=t("../utils"),r=s.getNAF,o=s.getJSF,a=s.assert;function h(t,e){this.type=t,this.p=new n(e.p,16),this.red=e.prime?n.red(e.prime):n.mont(this.p),this.zero=new n(0).toRed(this.red),this.one=new n(1).toRed(this.red),this.two=new n(2).toRed(this.red),this.n=e.n&&new n(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var i=this.n&&this.p.div(this.n);!i||i.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function c(t,e){this.curve=t,this.type=e,this.precomputed=null}e.exports=h,h.prototype.point=function(){throw new Error("Not implemented")},h.prototype.validate=function(){throw new Error("Not implemented")},h.prototype._fixedNafMul=function(t,e){a(t.precomputed);var i=t._getDoubles(),n=r(e,1,this._bitLength),s=(1<<i.step+1)-(i.step%2==0?2:1);s/=3;var o,h,c=[];for(o=0;o<n.length;o+=i.step){h=0;for(var u=o+i.step-1;u>=o;u--)h=(h<<1)+n[u];c.push(h)}for(var l=this.jpoint(null,null,null),f=this.jpoint(null,null,null),d=s;d>0;d--){for(o=0;o<c.length;o++)(h=c[o])===d?f=f.mixedAdd(i.points[o]):h===-d&&(f=f.mixedAdd(i.points[o].neg()));l=l.add(f)}return l.toP()},h.prototype._wnafMul=function(t,e){var i=4,n=t._getNAFPoints(i);i=n.wnd;for(var s=n.points,o=r(e,i,this._bitLength),h=this.jpoint(null,null,null),c=o.length-1;c>=0;c--){for(var u=0;c>=0&&0===o[c];c--)u++;if(c>=0&&u++,h=h.dblp(u),c<0)break;var l=o[c];a(0!==l),h="affine"===t.type?l>0?h.mixedAdd(s[l-1>>1]):h.mixedAdd(s[-l-1>>1].neg()):l>0?h.add(s[l-1>>1]):h.add(s[-l-1>>1].neg())}return"affine"===t.type?h.toP():h},h.prototype._wnafMulAdd=function(t,e,i,n,s){var a,h,c,u=this._wnafT1,l=this._wnafT2,f=this._wnafT3,d=0;for(a=0;a<n;a++){var p=(c=e[a])._getNAFPoints(t);u[a]=p.wnd,l[a]=p.points}for(a=n-1;a>=1;a-=2){var m=a-1,_=a;if(1===u[m]&&1===u[_]){var v=[e[m],null,null,e[_]];0===e[m].y.cmp(e[_].y)?(v[1]=e[m].add(e[_]),v[2]=e[m].toJ().mixedAdd(e[_].neg())):0===e[m].y.cmp(e[_].y.redNeg())?(v[1]=e[m].toJ().mixedAdd(e[_]),v[2]=e[m].add(e[_].neg())):(v[1]=e[m].toJ().mixedAdd(e[_]),v[2]=e[m].toJ().mixedAdd(e[_].neg()));var g=[-3,-1,-5,-7,0,7,5,1,3],b=o(i[m],i[_]);for(d=Math.max(b[0].length,d),f[m]=new Array(d),f[_]=new Array(d),h=0;h<d;h++){var w=0|b[0][h],y=0|b[1][h];f[m][h]=g[3*(w+1)+(y+1)],f[_][h]=0,l[m]=v}}else f[m]=r(i[m],u[m],this._bitLength),f[_]=r(i[_],u[_],this._bitLength),d=Math.max(f[m].length,d),d=Math.max(f[_].length,d)}var x=this.jpoint(null,null,null),M=this._wnafT4;for(a=d;a>=0;a--){for(var T=0;a>=0;){var O=!0;for(h=0;h<n;h++)M[h]=0|f[h][a],0!==M[h]&&(O=!1);if(!O)break;T++,a--}if(a>=0&&T++,x=x.dblp(T),a<0)break;for(h=0;h<n;h++){var E=M[h];0!==E&&(E>0?c=l[h][E-1>>1]:E<0&&(c=l[h][-E-1>>1].neg()),x="affine"===c.type?x.mixedAdd(c):x.add(c))}}for(a=0;a<n;a++)l[a]=null;return s?x:x.toP()},h.BasePoint=c,c.prototype.eq=function(){throw new Error("Not implemented")},c.prototype.validate=function(){return this.curve.validate(this)},h.prototype.decodePoint=function(t,e){t=s.toArray(t,e);var i=this.p.byteLength();if((4===t[0]||6===t[0]||7===t[0])&&t.length-1==2*i)return 6===t[0]?a(t[t.length-1]%2==0):7===t[0]&&a(t[t.length-1]%2==1),this.point(t.slice(1,1+i),t.slice(1+i,1+2*i));if((2===t[0]||3===t[0])&&t.length-1===i)return this.pointFromX(t.slice(1,1+i),3===t[0]);throw new Error("Unknown point format")},c.prototype.encodeCompressed=function(t){return this.encode(t,!0)},c.prototype._encode=function(t){var e=this.curve.p.byteLength(),i=this.getX().toArray("be",e);return t?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",e))},c.prototype.encode=function(t,e){return s.encode(this._encode(e),t)},c.prototype.precompute=function(t){if(this.precomputed)return this;var e={doubles:null,naf:null,beta:null};return e.naf=this._getNAFPoints(8),e.doubles=this._getDoubles(4,t),e.beta=this._getBeta(),this.precomputed=e,this},c.prototype._hasDoubles=function(t){if(!this.precomputed)return!1;var e=this.precomputed.doubles;return!!e&&e.points.length>=Math.ceil((t.bitLength()+1)/e.step)},c.prototype._getDoubles=function(t,e){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],n=this,s=0;s<e;s+=t){for(var r=0;r<t;r++)n=n.dbl();i.push(n)}return{step:t,points:i}},c.prototype._getNAFPoints=function(t){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var e=[this],i=(1<<t)-1,n=1===i?null:this.dbl(),s=1;s<i;s++)e[s]=e[s-1].add(n);return{wnd:t,points:e}},c.prototype._getBeta=function(){return null},c.prototype.dblp=function(t){for(var e=this,i=0;i<t;i++)e=e.dbl();return e}},{"../utils":419,"bn.js":420}],407:[function(t,e,i){var n=t("../utils"),s=t("bn.js"),r=t("inherits"),o=t("./base"),a=n.assert;function h(t){this.twisted=1!=(0|t.a),this.mOneA=this.twisted&&-1==(0|t.a),this.extended=this.mOneA,o.call(this,"edwards",t),this.a=new s(t.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new s(t.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new s(t.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|t.c)}function c(t,e,i,n,r){o.BasePoint.call(this,t,"projective"),null===e&&null===i&&null===n?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new s(e,16),this.y=new s(i,16),this.z=n?new s(n,16):this.curve.one,this.t=r&&new s(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}r(h,o),e.exports=h,h.prototype._mulA=function(t){return this.mOneA?t.redNeg():this.a.redMul(t)},h.prototype._mulC=function(t){return this.oneC?t:this.c.redMul(t)},h.prototype.jpoint=function(t,e,i,n){return this.point(t,e,i,n)},h.prototype.pointFromX=function(t,e){(t=new s(t,16)).red||(t=t.toRed(this.red));var i=t.redSqr(),n=this.c2.redSub(this.a.redMul(i)),r=this.one.redSub(this.c2.redMul(this.d).redMul(i)),o=n.redMul(r.redInvm()),a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");var h=a.fromRed().isOdd();return(e&&!h||!e&&h)&&(a=a.redNeg()),this.point(t,a)},h.prototype.pointFromY=function(t,e){(t=new s(t,16)).red||(t=t.toRed(this.red));var i=t.redSqr(),n=i.redSub(this.c2),r=i.redMul(this.d).redMul(this.c2).redSub(this.a),o=n.redMul(r.redInvm());if(0===o.cmp(this.zero)){if(e)throw new Error("invalid point");return this.point(this.zero,t)}var a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");return a.fromRed().isOdd()!==e&&(a=a.redNeg()),this.point(a,t)},h.prototype.validate=function(t){if(t.isInfinity())return!0;t.normalize();var e=t.x.redSqr(),i=t.y.redSqr(),n=e.redMul(this.a).redAdd(i),s=this.c2.redMul(this.one.redAdd(this.d.redMul(e).redMul(i)));return 0===n.cmp(s)},r(c,o.BasePoint),h.prototype.pointFromJSON=function(t){return c.fromJSON(this,t)},h.prototype.point=function(t,e,i,n){return new c(this,t,e,i,n)},c.fromJSON=function(t,e){return new c(t,e[0],e[1],e[2])},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},c.prototype._extDbl=function(){var t=this.x.redSqr(),e=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var n=this.curve._mulA(t),s=this.x.redAdd(this.y).redSqr().redISub(t).redISub(e),r=n.redAdd(e),o=r.redSub(i),a=n.redSub(e),h=s.redMul(o),c=r.redMul(a),u=s.redMul(a),l=o.redMul(r);return this.curve.point(h,c,l,u)},c.prototype._projDbl=function(){var t,e,i,n,s,r,o=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),h=this.y.redSqr();if(this.curve.twisted){var c=(n=this.curve._mulA(a)).redAdd(h);this.zOne?(t=o.redSub(a).redSub(h).redMul(c.redSub(this.curve.two)),e=c.redMul(n.redSub(h)),i=c.redSqr().redSub(c).redSub(c)):(s=this.z.redSqr(),r=c.redSub(s).redISub(s),t=o.redSub(a).redISub(h).redMul(r),e=c.redMul(n.redSub(h)),i=c.redMul(r))}else n=a.redAdd(h),s=this.curve._mulC(this.z).redSqr(),r=n.redSub(s).redSub(s),t=this.curve._mulC(o.redISub(n)).redMul(r),e=this.curve._mulC(n).redMul(a.redISub(h)),i=n.redMul(r);return this.curve.point(t,e,i)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},c.prototype._extAdd=function(t){var e=this.y.redSub(this.x).redMul(t.y.redSub(t.x)),i=this.y.redAdd(this.x).redMul(t.y.redAdd(t.x)),n=this.t.redMul(this.curve.dd).redMul(t.t),s=this.z.redMul(t.z.redAdd(t.z)),r=i.redSub(e),o=s.redSub(n),a=s.redAdd(n),h=i.redAdd(e),c=r.redMul(o),u=a.redMul(h),l=r.redMul(h),f=o.redMul(a);return this.curve.point(c,u,f,l)},c.prototype._projAdd=function(t){var e,i,n=this.z.redMul(t.z),s=n.redSqr(),r=this.x.redMul(t.x),o=this.y.redMul(t.y),a=this.curve.d.redMul(r).redMul(o),h=s.redSub(a),c=s.redAdd(a),u=this.x.redAdd(this.y).redMul(t.x.redAdd(t.y)).redISub(r).redISub(o),l=n.redMul(h).redMul(u);return this.curve.twisted?(e=n.redMul(c).redMul(o.redSub(this.curve._mulA(r))),i=h.redMul(c)):(e=n.redMul(c).redMul(o.redSub(r)),i=this.curve._mulC(h).redMul(c)),this.curve.point(l,e,i)},c.prototype.add=function(t){return this.isInfinity()?t:t.isInfinity()?this:this.curve.extended?this._extAdd(t):this._projAdd(t)},c.prototype.mul=function(t){return this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve._wnafMul(this,t)},c.prototype.mulAdd=function(t,e,i){return this.curve._wnafMulAdd(1,[this,e],[t,i],2,!1)},c.prototype.jmulAdd=function(t,e,i){return this.curve._wnafMulAdd(1,[this,e],[t,i],2,!0)},c.prototype.normalize=function(){if(this.zOne)return this;var t=this.z.redInvm();return this.x=this.x.redMul(t),this.y=this.y.redMul(t),this.t&&(this.t=this.t.redMul(t)),this.z=this.curve.one,this.zOne=!0,this},c.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()},c.prototype.getY=function(){return this.normalize(),this.y.fromRed()},c.prototype.eq=function(t){return this===t||0===this.getX().cmp(t.getX())&&0===this.getY().cmp(t.getY())},c.prototype.eqXToP=function(t){var e=t.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(e))return!0;for(var i=t.clone(),n=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(e.redIAdd(n),0===this.x.cmp(e))return!0}},c.prototype.toP=c.prototype.normalize,c.prototype.mixedAdd=c.prototype.add},{"../utils":419,"./base":406,"bn.js":420,inherits:440}],408:[function(t,e,i){var n=i;n.base=t("./base"),n.short=t("./short"),n.mont=t("./mont"),n.edwards=t("./edwards")},{"./base":406,"./edwards":407,"./mont":409,"./short":410}],409:[function(t,e,i){var n=t("bn.js"),s=t("inherits"),r=t("./base"),o=t("../utils");function a(t){r.call(this,"mont",t),this.a=new n(t.a,16).toRed(this.red),this.b=new n(t.b,16).toRed(this.red),this.i4=new n(4).toRed(this.red).redInvm(),this.two=new n(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function h(t,e,i){r.BasePoint.call(this,t,"projective"),null===e&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new n(e,16),this.z=new n(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}s(a,r),e.exports=a,a.prototype.validate=function(t){var e=t.normalize().x,i=e.redSqr(),n=i.redMul(e).redAdd(i.redMul(this.a)).redAdd(e);return 0===n.redSqrt().redSqr().cmp(n)},s(h,r.BasePoint),a.prototype.decodePoint=function(t,e){return this.point(o.toArray(t,e),1)},a.prototype.point=function(t,e){return new h(this,t,e)},a.prototype.pointFromJSON=function(t){return h.fromJSON(this,t)},h.prototype.precompute=function(){},h.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},h.fromJSON=function(t,e){return new h(t,e[0],e[1]||t.one)},h.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},h.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},h.prototype.dbl=function(){var t=this.x.redAdd(this.z).redSqr(),e=this.x.redSub(this.z).redSqr(),i=t.redSub(e),n=t.redMul(e),s=i.redMul(e.redAdd(this.curve.a24.redMul(i)));return this.curve.point(n,s)},h.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.diffAdd=function(t,e){var i=this.x.redAdd(this.z),n=this.x.redSub(this.z),s=t.x.redAdd(t.z),r=t.x.redSub(t.z).redMul(i),o=s.redMul(n),a=e.z.redMul(r.redAdd(o).redSqr()),h=e.x.redMul(r.redISub(o).redSqr());return this.curve.point(a,h)},h.prototype.mul=function(t){for(var e=t.clone(),i=this,n=this.curve.point(null,null),s=[];0!==e.cmpn(0);e.iushrn(1))s.push(e.andln(1));for(var r=s.length-1;r>=0;r--)0===s[r]?(i=i.diffAdd(n,this),n=n.dbl()):(n=i.diffAdd(n,this),i=i.dbl());return n},h.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.eq=function(t){return 0===this.getX().cmp(t.getX())},h.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},h.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},{"../utils":419,"./base":406,"bn.js":420,inherits:440}],410:[function(t,e,i){var n=t("../utils"),s=t("bn.js"),r=t("inherits"),o=t("./base"),a=n.assert;function h(t){o.call(this,"short",t),this.a=new s(t.a,16).toRed(this.red),this.b=new s(t.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(t),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function c(t,e,i,n){o.BasePoint.call(this,t,"affine"),null===e&&null===i?(this.x=null,this.y=null,this.inf=!0):(this.x=new s(e,16),this.y=new s(i,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function u(t,e,i,n){o.BasePoint.call(this,t,"jacobian"),null===e&&null===i&&null===n?(this.x=this.curve.one,this.y=this.curve.one,this.z=new s(0)):(this.x=new s(e,16),this.y=new s(i,16),this.z=new s(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}r(h,o),e.exports=h,h.prototype._getEndomorphism=function(t){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var e,i;if(t.beta)e=new s(t.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);e=(e=n[0].cmp(n[1])<0?n[0]:n[1]).toRed(this.red)}if(t.lambda)i=new s(t.lambda,16);else{var r=this._getEndoRoots(this.n);0===this.g.mul(r[0]).x.cmp(this.g.x.redMul(e))?i=r[0]:(i=r[1],a(0===this.g.mul(i).x.cmp(this.g.x.redMul(e))))}return{beta:e,lambda:i,basis:t.basis?t.basis.map((function(t){return{a:new s(t.a,16),b:new s(t.b,16)}})):this._getEndoBasis(i)}}},h.prototype._getEndoRoots=function(t){var e=t===this.p?this.red:s.mont(t),i=new s(2).toRed(e).redInvm(),n=i.redNeg(),r=new s(3).toRed(e).redNeg().redSqrt().redMul(i);return[n.redAdd(r).fromRed(),n.redSub(r).fromRed()]},h.prototype._getEndoBasis=function(t){for(var e,i,n,r,o,a,h,c,u,l=this.n.ushrn(Math.floor(this.n.bitLength()/2)),f=t,d=this.n.clone(),p=new s(1),m=new s(0),_=new s(0),v=new s(1),g=0;0!==f.cmpn(0);){var b=d.div(f);c=d.sub(b.mul(f)),u=_.sub(b.mul(p));var w=v.sub(b.mul(m));if(!n&&c.cmp(l)<0)e=h.neg(),i=p,n=c.neg(),r=u;else if(n&&2==++g)break;h=c,d=f,f=c,_=p,p=u,v=m,m=w}o=c.neg(),a=u;var y=n.sqr().add(r.sqr());return o.sqr().add(a.sqr()).cmp(y)>=0&&(o=e,a=i),n.negative&&(n=n.neg(),r=r.neg()),o.negative&&(o=o.neg(),a=a.neg()),[{a:n,b:r},{a:o,b:a}]},h.prototype._endoSplit=function(t){var e=this.endo.basis,i=e[0],n=e[1],s=n.b.mul(t).divRound(this.n),r=i.b.neg().mul(t).divRound(this.n),o=s.mul(i.a),a=r.mul(n.a),h=s.mul(i.b),c=r.mul(n.b);return{k1:t.sub(o).sub(a),k2:h.add(c).neg()}},h.prototype.pointFromX=function(t,e){(t=new s(t,16)).red||(t=t.toRed(this.red));var i=t.redSqr().redMul(t).redIAdd(t.redMul(this.a)).redIAdd(this.b),n=i.redSqrt();if(0!==n.redSqr().redSub(i).cmp(this.zero))throw new Error("invalid point");var r=n.fromRed().isOdd();return(e&&!r||!e&&r)&&(n=n.redNeg()),this.point(t,n)},h.prototype.validate=function(t){if(t.inf)return!0;var e=t.x,i=t.y,n=this.a.redMul(e),s=e.redSqr().redMul(e).redIAdd(n).redIAdd(this.b);return 0===i.redSqr().redISub(s).cmpn(0)},h.prototype._endoWnafMulAdd=function(t,e,i){for(var n=this._endoWnafT1,s=this._endoWnafT2,r=0;r<t.length;r++){var o=this._endoSplit(e[r]),a=t[r],h=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),h=h.neg(!0)),n[2*r]=a,n[2*r+1]=h,s[2*r]=o.k1,s[2*r+1]=o.k2}for(var c=this._wnafMulAdd(1,n,s,2*r,i),u=0;u<2*r;u++)n[u]=null,s[u]=null;return c},r(c,o.BasePoint),h.prototype.point=function(t,e,i){return new c(this,t,e,i)},h.prototype.pointFromJSON=function(t,e){return c.fromJSON(this,t,e)},c.prototype._getBeta=function(){if(this.curve.endo){var t=this.precomputed;if(t&&t.beta)return t.beta;var e=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(t){var i=this.curve,n=function(t){return i.point(t.x.redMul(i.endo.beta),t.y)};t.beta=e,e.precomputed={beta:null,naf:t.naf&&{wnd:t.naf.wnd,points:t.naf.points.map(n)},doubles:t.doubles&&{step:t.doubles.step,points:t.doubles.points.map(n)}}}return e}},c.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},c.fromJSON=function(t,e,i){"string"==typeof e&&(e=JSON.parse(e));var n=t.point(e[0],e[1],i);if(!e[2])return n;function s(e){return t.point(e[0],e[1],i)}var r=e[2];return n.precomputed={beta:null,doubles:r.doubles&&{step:r.doubles.step,points:[n].concat(r.doubles.points.map(s))},naf:r.naf&&{wnd:r.naf.wnd,points:[n].concat(r.naf.points.map(s))}},n},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return this.inf},c.prototype.add=function(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t))return this.curve.point(null,null);if(0===this.x.cmp(t.x))return this.curve.point(null,null);var e=this.y.redSub(t.y);0!==e.cmpn(0)&&(e=e.redMul(this.x.redSub(t.x).redInvm()));var i=e.redSqr().redISub(this.x).redISub(t.x),n=e.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,n)},c.prototype.dbl=function(){if(this.inf)return this;var t=this.y.redAdd(this.y);if(0===t.cmpn(0))return this.curve.point(null,null);var e=this.curve.a,i=this.x.redSqr(),n=t.redInvm(),s=i.redAdd(i).redIAdd(i).redIAdd(e).redMul(n),r=s.redSqr().redISub(this.x.redAdd(this.x)),o=s.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,o)},c.prototype.getX=function(){return this.x.fromRed()},c.prototype.getY=function(){return this.y.fromRed()},c.prototype.mul=function(t){return t=new s(t,16),this.isInfinity()?this:this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve.endo?this.curve._endoWnafMulAdd([this],[t]):this.curve._wnafMul(this,t)},c.prototype.mulAdd=function(t,e,i){var n=[this,e],s=[t,i];return this.curve.endo?this.curve._endoWnafMulAdd(n,s):this.curve._wnafMulAdd(1,n,s,2)},c.prototype.jmulAdd=function(t,e,i){var n=[this,e],s=[t,i];return this.curve.endo?this.curve._endoWnafMulAdd(n,s,!0):this.curve._wnafMulAdd(1,n,s,2,!0)},c.prototype.eq=function(t){return this===t||this.inf===t.inf&&(this.inf||0===this.x.cmp(t.x)&&0===this.y.cmp(t.y))},c.prototype.neg=function(t){if(this.inf)return this;var e=this.curve.point(this.x,this.y.redNeg());if(t&&this.precomputed){var i=this.precomputed,n=function(t){return t.neg()};e.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(n)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(n)}}}return e},c.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},r(u,o.BasePoint),h.prototype.jpoint=function(t,e,i){return new u(this,t,e,i)},u.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var t=this.z.redInvm(),e=t.redSqr(),i=this.x.redMul(e),n=this.y.redMul(e).redMul(t);return this.curve.point(i,n)},u.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},u.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var e=t.z.redSqr(),i=this.z.redSqr(),n=this.x.redMul(e),s=t.x.redMul(i),r=this.y.redMul(e.redMul(t.z)),o=t.y.redMul(i.redMul(this.z)),a=n.redSub(s),h=r.redSub(o);if(0===a.cmpn(0))return 0!==h.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=a.redSqr(),u=c.redMul(a),l=n.redMul(c),f=h.redSqr().redIAdd(u).redISub(l).redISub(l),d=h.redMul(l.redISub(f)).redISub(r.redMul(u)),p=this.z.redMul(t.z).redMul(a);return this.curve.jpoint(f,d,p)},u.prototype.mixedAdd=function(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;var e=this.z.redSqr(),i=this.x,n=t.x.redMul(e),s=this.y,r=t.y.redMul(e).redMul(this.z),o=i.redSub(n),a=s.redSub(r);if(0===o.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=o.redSqr(),c=h.redMul(o),u=i.redMul(h),l=a.redSqr().redIAdd(c).redISub(u).redISub(u),f=a.redMul(u.redISub(l)).redISub(s.redMul(c)),d=this.z.redMul(o);return this.curve.jpoint(l,f,d)},u.prototype.dblp=function(t){if(0===t)return this;if(this.isInfinity())return this;if(!t)return this.dbl();var e;if(this.curve.zeroA||this.curve.threeA){var i=this;for(e=0;e<t;e++)i=i.dbl();return i}var n=this.curve.a,s=this.curve.tinv,r=this.x,o=this.y,a=this.z,h=a.redSqr().redSqr(),c=o.redAdd(o);for(e=0;e<t;e++){var u=r.redSqr(),l=c.redSqr(),f=l.redSqr(),d=u.redAdd(u).redIAdd(u).redIAdd(n.redMul(h)),p=r.redMul(l),m=d.redSqr().redISub(p.redAdd(p)),_=p.redISub(m),v=d.redMul(_);v=v.redIAdd(v).redISub(f);var g=c.redMul(a);e+1<t&&(h=h.redMul(f)),r=m,a=g,c=v}return this.curve.jpoint(r,c.redMul(s),a)},u.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},u.prototype._zeroDbl=function(){var t,e,i;if(this.zOne){var n=this.x.redSqr(),s=this.y.redSqr(),r=s.redSqr(),o=this.x.redAdd(s).redSqr().redISub(n).redISub(r);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n),h=a.redSqr().redISub(o).redISub(o),c=r.redIAdd(r);c=(c=c.redIAdd(c)).redIAdd(c),t=h,e=a.redMul(o.redISub(h)).redISub(c),i=this.y.redAdd(this.y)}else{var u=this.x.redSqr(),l=this.y.redSqr(),f=l.redSqr(),d=this.x.redAdd(l).redSqr().redISub(u).redISub(f);d=d.redIAdd(d);var p=u.redAdd(u).redIAdd(u),m=p.redSqr(),_=f.redIAdd(f);_=(_=_.redIAdd(_)).redIAdd(_),t=m.redISub(d).redISub(d),e=p.redMul(d.redISub(t)).redISub(_),i=(i=this.y.redMul(this.z)).redIAdd(i)}return this.curve.jpoint(t,e,i)},u.prototype._threeDbl=function(){var t,e,i;if(this.zOne){var n=this.x.redSqr(),s=this.y.redSqr(),r=s.redSqr(),o=this.x.redAdd(s).redSqr().redISub(n).redISub(r);o=o.redIAdd(o);var a=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),h=a.redSqr().redISub(o).redISub(o);t=h;var c=r.redIAdd(r);c=(c=c.redIAdd(c)).redIAdd(c),e=a.redMul(o.redISub(h)).redISub(c),i=this.y.redAdd(this.y)}else{var u=this.z.redSqr(),l=this.y.redSqr(),f=this.x.redMul(l),d=this.x.redSub(u).redMul(this.x.redAdd(u));d=d.redAdd(d).redIAdd(d);var p=f.redIAdd(f),m=(p=p.redIAdd(p)).redAdd(p);t=d.redSqr().redISub(m),i=this.y.redAdd(this.z).redSqr().redISub(l).redISub(u);var _=l.redSqr();_=(_=(_=_.redIAdd(_)).redIAdd(_)).redIAdd(_),e=d.redMul(p.redISub(t)).redISub(_)}return this.curve.jpoint(t,e,i)},u.prototype._dbl=function(){var t=this.curve.a,e=this.x,i=this.y,n=this.z,s=n.redSqr().redSqr(),r=e.redSqr(),o=i.redSqr(),a=r.redAdd(r).redIAdd(r).redIAdd(t.redMul(s)),h=e.redAdd(e),c=(h=h.redIAdd(h)).redMul(o),u=a.redSqr().redISub(c.redAdd(c)),l=c.redISub(u),f=o.redSqr();f=(f=(f=f.redIAdd(f)).redIAdd(f)).redIAdd(f);var d=a.redMul(l).redISub(f),p=i.redAdd(i).redMul(n);return this.curve.jpoint(u,d,p)},u.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var t=this.x.redSqr(),e=this.y.redSqr(),i=this.z.redSqr(),n=e.redSqr(),s=t.redAdd(t).redIAdd(t),r=s.redSqr(),o=this.x.redAdd(e).redSqr().redISub(t).redISub(n),a=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(r)).redSqr(),h=n.redIAdd(n);h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var c=s.redIAdd(o).redSqr().redISub(r).redISub(a).redISub(h),u=e.redMul(c);u=(u=u.redIAdd(u)).redIAdd(u);var l=this.x.redMul(a).redISub(u);l=(l=l.redIAdd(l)).redIAdd(l);var f=this.y.redMul(c.redMul(h.redISub(c)).redISub(o.redMul(a)));f=(f=(f=f.redIAdd(f)).redIAdd(f)).redIAdd(f);var d=this.z.redAdd(o).redSqr().redISub(i).redISub(a);return this.curve.jpoint(l,f,d)},u.prototype.mul=function(t,e){return t=new s(t,e),this.curve._wnafMul(this,t)},u.prototype.eq=function(t){if("affine"===t.type)return this.eq(t.toJ());if(this===t)return!0;var e=this.z.redSqr(),i=t.z.redSqr();if(0!==this.x.redMul(i).redISub(t.x.redMul(e)).cmpn(0))return!1;var n=e.redMul(this.z),s=i.redMul(t.z);return 0===this.y.redMul(s).redISub(t.y.redMul(n)).cmpn(0)},u.prototype.eqXToP=function(t){var e=this.z.redSqr(),i=t.toRed(this.curve.red).redMul(e);if(0===this.x.cmp(i))return!0;for(var n=t.clone(),s=this.curve.redN.redMul(e);;){if(n.iadd(this.curve.n),n.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(s),0===this.x.cmp(i))return!0}},u.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},{"../utils":419,"./base":406,"bn.js":420,inherits:440}],411:[function(t,e,i){var n,s=i,r=t("hash.js"),o=t("./curve"),a=t("./utils").assert;function h(t){"short"===t.type?this.curve=new o.short(t):"edwards"===t.type?this.curve=new o.edwards(t):this.curve=new o.mont(t),this.g=this.curve.g,this.n=this.curve.n,this.hash=t.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function c(t,e){Object.defineProperty(s,t,{configurable:!0,enumerable:!0,get:function(){var i=new h(e);return Object.defineProperty(s,t,{configurable:!0,enumerable:!0,value:i}),i}})}s.PresetCurve=h,c("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:r.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),c("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:r.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),c("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:r.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),c("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:r.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),c("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:r.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),c("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["9"]}),c("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:r.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{n=t("./precomputed/secp256k1")}catch(t){n=void 0}c("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:r.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",n]})},{"./curve":408,"./precomputed/secp256k1":418,"./utils":419,"hash.js":426}],412:[function(t,e,i){var n=t("bn.js"),s=t("hmac-drbg"),r=t("../utils"),o=t("../curves"),a=t("brorand"),h=r.assert,c=t("./key"),u=t("./signature");function l(t){if(!(this instanceof l))return new l(t);"string"==typeof t&&(h(Object.prototype.hasOwnProperty.call(o,t),"Unknown curve "+t),t=o[t]),t instanceof o.PresetCurve&&(t={curve:t}),this.curve=t.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=t.curve.g,this.g.precompute(t.curve.n.bitLength()+1),this.hash=t.hash||t.curve.hash}e.exports=l,l.prototype.keyPair=function(t){return new c(this,t)},l.prototype.keyFromPrivate=function(t,e){return c.fromPrivate(this,t,e)},l.prototype.keyFromPublic=function(t,e){return c.fromPublic(this,t,e)},l.prototype.genKeyPair=function(t){t||(t={});for(var e=new s({hash:this.hash,pers:t.pers,persEnc:t.persEnc||"utf8",entropy:t.entropy||a(this.hash.hmacStrength),entropyEnc:t.entropy&&t.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),r=this.n.sub(new n(2));;){var o=new n(e.generate(i));if(!(o.cmp(r)>0))return o.iaddn(1),this.keyFromPrivate(o)}},l.prototype._truncateToN=function(t,e){var i=8*t.byteLength()-this.n.bitLength();return i>0&&(t=t.ushrn(i)),!e&&t.cmp(this.n)>=0?t.sub(this.n):t},l.prototype.sign=function(t,e,i,r){"object"==typeof i&&(r=i,i=null),r||(r={}),e=this.keyFromPrivate(e,i),t=this._truncateToN(new n(t,16));for(var o=this.n.byteLength(),a=e.getPrivate().toArray("be",o),h=t.toArray("be",o),c=new s({hash:this.hash,entropy:a,nonce:h,pers:r.pers,persEnc:r.persEnc||"utf8"}),l=this.n.sub(new n(1)),f=0;;f++){var d=r.k?r.k(f):new n(c.generate(this.n.byteLength()));if(!((d=this._truncateToN(d,!0)).cmpn(1)<=0||d.cmp(l)>=0)){var p=this.g.mul(d);if(!p.isInfinity()){var m=p.getX(),_=m.umod(this.n);if(0!==_.cmpn(0)){var v=d.invm(this.n).mul(_.mul(e.getPrivate()).iadd(t));if(0!==(v=v.umod(this.n)).cmpn(0)){var g=(p.getY().isOdd()?1:0)|(0!==m.cmp(_)?2:0);return r.canonical&&v.cmp(this.nh)>0&&(v=this.n.sub(v),g^=1),new u({r:_,s:v,recoveryParam:g})}}}}}},l.prototype.verify=function(t,e,i,s){t=this._truncateToN(new n(t,16)),i=this.keyFromPublic(i,s);var r=(e=new u(e,"hex")).r,o=e.s;if(r.cmpn(1)<0||r.cmp(this.n)>=0)return!1;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a,h=o.invm(this.n),c=h.mul(t).umod(this.n),l=h.mul(r).umod(this.n);return this.curve._maxwellTrick?!(a=this.g.jmulAdd(c,i.getPublic(),l)).isInfinity()&&a.eqXToP(r):!(a=this.g.mulAdd(c,i.getPublic(),l)).isInfinity()&&0===a.getX().umod(this.n).cmp(r)},l.prototype.recoverPubKey=function(t,e,i,s){h((3&i)===i,"The recovery param is more than two bits"),e=new u(e,s);var r=this.n,o=new n(t),a=e.r,c=e.s,l=1&i,f=i>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&f)throw new Error("Unable to find sencond key candinate");a=f?this.curve.pointFromX(a.add(this.curve.n),l):this.curve.pointFromX(a,l);var d=e.r.invm(r),p=r.sub(o).mul(d).umod(r),m=c.mul(d).umod(r);return this.g.mulAdd(p,a,m)},l.prototype.getKeyRecoveryParam=function(t,e,i,n){if(null!==(e=new u(e,n)).recoveryParam)return e.recoveryParam;for(var s=0;s<4;s++){var r;try{r=this.recoverPubKey(t,e,s)}catch(t){continue}if(r.eq(i))return s}throw new Error("Unable to find valid recovery factor")}},{"../curves":411,"../utils":419,"./key":413,"./signature":414,"bn.js":420,brorand:187,"hmac-drbg":438}],413:[function(t,e,i){var n=t("bn.js"),s=t("../utils").assert;function r(t,e){this.ec=t,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}e.exports=r,r.fromPublic=function(t,e,i){return e instanceof r?e:new r(t,{pub:e,pubEnc:i})},r.fromPrivate=function(t,e,i){return e instanceof r?e:new r(t,{priv:e,privEnc:i})},r.prototype.validate=function(){var t=this.getPublic();return t.isInfinity()?{result:!1,reason:"Invalid public key"}:t.validate()?t.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},r.prototype.getPublic=function(t,e){return"string"==typeof t&&(e=t,t=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),e?this.pub.encode(e,t):this.pub},r.prototype.getPrivate=function(t){return"hex"===t?this.priv.toString(16,2):this.priv},r.prototype._importPrivate=function(t,e){this.priv=new n(t,e||16),this.priv=this.priv.umod(this.ec.curve.n)},r.prototype._importPublic=function(t,e){if(t.x||t.y)return"mont"===this.ec.curve.type?s(t.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||s(t.x&&t.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(t.x,t.y));this.pub=this.ec.curve.decodePoint(t,e)},r.prototype.derive=function(t){return t.validate()||s(t.validate(),"public point not validated"),t.mul(this.priv).getX()},r.prototype.sign=function(t,e,i){return this.ec.sign(t,this,e,i)},r.prototype.verify=function(t,e){return this.ec.verify(t,e,this)},r.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},{"../utils":419,"bn.js":420}],414:[function(t,e,i){var n=t("bn.js"),s=t("../utils"),r=s.assert;function o(t,e){if(t instanceof o)return t;this._importDER(t,e)||(r(t.r&&t.s,"Signature without r or s"),this.r=new n(t.r,16),this.s=new n(t.s,16),void 0===t.recoveryParam?this.recoveryParam=null:this.recoveryParam=t.recoveryParam)}function a(){this.place=0}function h(t,e){var i=t[e.place++];if(!(128&i))return i;var n=15&i;if(0===n||n>4)return!1;for(var s=0,r=0,o=e.place;r<n;r++,o++)s<<=8,s|=t[o],s>>>=0;return!(s<=127)&&(e.place=o,s)}function c(t){for(var e=0,i=t.length-1;!t[e]&&!(128&t[e+1])&&e<i;)e++;return 0===e?t:t.slice(e)}function u(t,e){if(e<128)t.push(e);else{var i=1+(Math.log(e)/Math.LN2>>>3);for(t.push(128|i);--i;)t.push(e>>>(i<<3)&255);t.push(e)}}e.exports=o,o.prototype._importDER=function(t,e){t=s.toArray(t,e);var i=new a;if(48!==t[i.place++])return!1;var r=h(t,i);if(!1===r)return!1;if(r+i.place!==t.length)return!1;if(2!==t[i.place++])return!1;var o=h(t,i);if(!1===o)return!1;var c=t.slice(i.place,o+i.place);if(i.place+=o,2!==t[i.place++])return!1;var u=h(t,i);if(!1===u)return!1;if(t.length!==u+i.place)return!1;var l=t.slice(i.place,u+i.place);if(0===c[0]){if(!(128&c[1]))return!1;c=c.slice(1)}if(0===l[0]){if(!(128&l[1]))return!1;l=l.slice(1)}return this.r=new n(c),this.s=new n(l),this.recoveryParam=null,!0},o.prototype.toDER=function(t){var e=this.r.toArray(),i=this.s.toArray();for(128&e[0]&&(e=[0].concat(e)),128&i[0]&&(i=[0].concat(i)),e=c(e),i=c(i);!(i[0]||128&i[1]);)i=i.slice(1);var n=[2];u(n,e.length),(n=n.concat(e)).push(2),u(n,i.length);var r=n.concat(i),o=[48];return u(o,r.length),o=o.concat(r),s.encode(o,t)}},{"../utils":419,"bn.js":420}],415:[function(t,e,i){var n=t("hash.js"),s=t("../curves"),r=t("../utils"),o=r.assert,a=r.parseBytes,h=t("./key"),c=t("./signature");function u(t){if(o("ed25519"===t,"only tested with ed25519 so far"),!(this instanceof u))return new u(t);t=s[t].curve,this.curve=t,this.g=t.g,this.g.precompute(t.n.bitLength()+1),this.pointClass=t.point().constructor,this.encodingLength=Math.ceil(t.n.bitLength()/8),this.hash=n.sha512}e.exports=u,u.prototype.sign=function(t,e){t=a(t);var i=this.keyFromSecret(e),n=this.hashInt(i.messagePrefix(),t),s=this.g.mul(n),r=this.encodePoint(s),o=this.hashInt(r,i.pubBytes(),t).mul(i.priv()),h=n.add(o).umod(this.curve.n);return this.makeSignature({R:s,S:h,Rencoded:r})},u.prototype.verify=function(t,e,i){t=a(t),e=this.makeSignature(e);var n=this.keyFromPublic(i),s=this.hashInt(e.Rencoded(),n.pubBytes(),t),r=this.g.mul(e.S());return e.R().add(n.pub().mul(s)).eq(r)},u.prototype.hashInt=function(){for(var t=this.hash(),e=0;e<arguments.length;e++)t.update(arguments[e]);return r.intFromLE(t.digest()).umod(this.curve.n)},u.prototype.keyFromPublic=function(t){return h.fromPublic(this,t)},u.prototype.keyFromSecret=function(t){return h.fromSecret(this,t)},u.prototype.makeSignature=function(t){return t instanceof c?t:new c(this,t)},u.prototype.encodePoint=function(t){var e=t.getY().toArray("le",this.encodingLength);return e[this.encodingLength-1]|=t.getX().isOdd()?128:0,e},u.prototype.decodePoint=function(t){var e=(t=r.parseBytes(t)).length-1,i=t.slice(0,e).concat(-129&t[e]),n=0!=(128&t[e]),s=r.intFromLE(i);return this.curve.pointFromY(s,n)},u.prototype.encodeInt=function(t){return t.toArray("le",this.encodingLength)},u.prototype.decodeInt=function(t){return r.intFromLE(t)},u.prototype.isPoint=function(t){return t instanceof this.pointClass}},{"../curves":411,"../utils":419,"./key":416,"./signature":417,"hash.js":426}],416:[function(t,e,i){var n=t("../utils"),s=n.assert,r=n.parseBytes,o=n.cachedProperty;function a(t,e){this.eddsa=t,this._secret=r(e.secret),t.isPoint(e.pub)?this._pub=e.pub:this._pubBytes=r(e.pub)}a.fromPublic=function(t,e){return e instanceof a?e:new a(t,{pub:e})},a.fromSecret=function(t,e){return e instanceof a?e:new a(t,{secret:e})},a.prototype.secret=function(){return this._secret},o(a,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),o(a,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),o(a,"privBytes",(function(){var t=this.eddsa,e=this.hash(),i=t.encodingLength-1,n=e.slice(0,t.encodingLength);return n[0]&=248,n[i]&=127,n[i]|=64,n})),o(a,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),o(a,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),o(a,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),a.prototype.sign=function(t){return s(this._secret,"KeyPair can only verify"),this.eddsa.sign(t,this)},a.prototype.verify=function(t,e){return this.eddsa.verify(t,e,this)},a.prototype.getSecret=function(t){return s(this._secret,"KeyPair is public only"),n.encode(this.secret(),t)},a.prototype.getPublic=function(t){return n.encode(this.pubBytes(),t)},e.exports=a},{"../utils":419}],417:[function(t,e,i){var n=t("bn.js"),s=t("../utils"),r=s.assert,o=s.cachedProperty,a=s.parseBytes;function h(t,e){this.eddsa=t,"object"!=typeof e&&(e=a(e)),Array.isArray(e)&&(e={R:e.slice(0,t.encodingLength),S:e.slice(t.encodingLength)}),r(e.R&&e.S,"Signature without R or S"),t.isPoint(e.R)&&(this._R=e.R),e.S instanceof n&&(this._S=e.S),this._Rencoded=Array.isArray(e.R)?e.R:e.Rencoded,this._Sencoded=Array.isArray(e.S)?e.S:e.Sencoded}o(h,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),o(h,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),o(h,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),o(h,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),h.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},h.prototype.toHex=function(){return s.encode(this.toBytes(),"hex").toUpperCase()},e.exports=h},{"../utils":419,"bn.js":420}],418:[function(t,e,i){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},{}],419:[function(t,e,i){var n=i,s=t("bn.js"),r=t("minimalistic-assert"),o=t("minimalistic-crypto-utils");n.assert=r,n.toArray=o.toArray,n.zero2=o.zero2,n.toHex=o.toHex,n.encode=o.encode,n.getNAF=function(t,e,i){var n=new Array(Math.max(t.bitLength(),i)+1);n.fill(0);for(var s=1<<e+1,r=t.clone(),o=0;o<n.length;o++){var a,h=r.andln(s-1);r.isOdd()?(a=h>(s>>1)-1?(s>>1)-h:h,r.isubn(a)):a=0,n[o]=a,r.iushrn(1)}return n},n.getJSF=function(t,e){var i=[[],[]];t=t.clone(),e=e.clone();for(var n,s=0,r=0;t.cmpn(-s)>0||e.cmpn(-r)>0;){var o,a,h=t.andln(3)+s&3,c=e.andln(3)+r&3;3===h&&(h=-1),3===c&&(c=-1),o=0==(1&h)?0:3!==(n=t.andln(7)+s&7)&&5!==n||2!==c?h:-h,i[0].push(o),a=0==(1&c)?0:3!==(n=e.andln(7)+r&7)&&5!==n||2!==h?c:-c,i[1].push(a),2*s===o+1&&(s=1-s),2*r===a+1&&(r=1-r),t.iushrn(1),e.iushrn(1)}return i},n.cachedProperty=function(t,e,i){var n="_"+e;t.prototype[e]=function(){return void 0!==this[n]?this[n]:this[n]=i.call(this)}},n.parseBytes=function(t){return"string"==typeof t?n.toArray(t,"hex"):t},n.intFromLE=function(t){return new s(t,"hex","le")}},{"bn.js":420,"minimalistic-assert":453,"minimalistic-crypto-utils":454}],420:[function(t,e,i){arguments[4][184][0].apply(i,arguments)},{buffer:188,dup:184}],421:[function(t,e,i){e.exports={name:"elliptic",version:"6.5.4",description:"EC cryptography",main:"lib/elliptic.js",files:["lib"],scripts:{lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},repository:{type:"git",url:"git@github.com:indutny/elliptic"},keywords:["EC","Elliptic","curve","Cryptography"],author:"Fedor Indutny <fedor@indutny.com>",license:"MIT",bugs:{url:"https://github.com/indutny/elliptic/issues"},homepage:"https://github.com/indutny/elliptic",devDependencies:{brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},dependencies:{"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"}}},{}],422:[function(t,e,i){var n=Object.create||function(t){var e=function(){};return e.prototype=t,new e},s=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return i},r=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function o(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0;var a,h=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(t){a=!1}function u(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function l(t,e,i){if(e)t.call(i);else for(var n=t.length,s=y(t,n),r=0;r<n;++r)s[r].call(i)}function f(t,e,i,n){if(e)t.call(i,n);else for(var s=t.length,r=y(t,s),o=0;o<s;++o)r[o].call(i,n)}function d(t,e,i,n,s){if(e)t.call(i,n,s);else for(var r=t.length,o=y(t,r),a=0;a<r;++a)o[a].call(i,n,s)}function p(t,e,i,n,s,r){if(e)t.call(i,n,s,r);else for(var o=t.length,a=y(t,o),h=0;h<o;++h)a[h].call(i,n,s,r)}function m(t,e,i,n){if(e)t.apply(i,n);else for(var s=t.length,r=y(t,s),o=0;o<s;++o)r[o].apply(i,n)}function _(t,e,i,s){var r,o,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),o=t._events),a=o[e]):(o=t._events=n(null),t._eventsCount=0),a){if("function"==typeof a?a=o[e]=s?[i,a]:[a,i]:s?a.unshift(i):a.push(i),!a.warned&&(r=u(t))&&r>0&&a.length>r){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",h.name,h.message)}}else a=o[e]=i,++t._eventsCount;return t}function v(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function g(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=r.call(v,n);return s.listener=i,n.wrapFn=s,s}function b(t,e,i){var n=t._events;if(!n)return[];var s=n[e];return s?"function"==typeof s?i?[s.listener||s]:[s]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(s):y(s,s.length):[]}function w(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function y(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}a?Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return h},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');h=t}}):o.defaultMaxListeners=h,o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(t){var e,i,n,s,r,o,a="error"===t;if(o=this._events)a=a&&null==o.error;else if(!a)return!1;if(a){if(arguments.length>1&&(e=arguments[1]),e instanceof Error)throw e;var h=new Error('Unhandled "error" event. ('+e+")");throw h.context=e,h}if(!(i=o[t]))return!1;var c="function"==typeof i;switch(n=arguments.length){case 1:l(i,c,this);break;case 2:f(i,c,this,arguments[1]);break;case 3:d(i,c,this,arguments[1],arguments[2]);break;case 4:p(i,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(n-1),r=1;r<n;r++)s[r-1]=arguments[r];m(i,c,this,s)}return!0},o.prototype.addListener=function(t,e){return _(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return _(this,t,e,!0)},o.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,g(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,g(this,t,e)),this},o.prototype.removeListener=function(t,e){var i,s,r,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(i=s[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=n(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(r=-1,o=i.length-1;o>=0;o--)if(i[o]===e||i[o].listener===e){a=i[o].listener,r=o;break}if(r<0)return this;0===r?i.shift():function(t,e){for(var i=e,n=i+1,s=t.length;n<s;i+=1,n+=1)t[i]=t[n];t.pop()}(i,r),1===i.length&&(s[t]=i[0]),s.removeListener&&this.emit("removeListener",t,a||e)}return this},o.prototype.removeAllListeners=function(t){var e,i,r;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=n(null):delete i[t]),this;if(0===arguments.length){var o,a=s(i);for(r=0;r<a.length;++r)"removeListener"!==(o=a[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return b(this,t,!0)},o.prototype.rawListeners=function(t){return b(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):w.call(t,e)},o.prototype.listenerCount=w,o.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],423:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("md5.js");e.exports=function(t,e,i,r){if(n.isBuffer(t)||(t=n.from(t,"binary")),e&&(n.isBuffer(e)||(e=n.from(e,"binary")),8!==e.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var o=i/8,a=n.alloc(o),h=n.alloc(r||0),c=n.alloc(0);o>0||r>0;){var u=new s;u.update(c),u.update(t),e&&u.update(e),c=u.digest();var l=0;if(o>0){var f=a.length-o;l=Math.min(o,c.length),c.copy(a,f,0,l),o-=l}if(l<c.length&&r>0){var d=h.length-r,p=Math.min(r,c.length-l);c.copy(h,d,l,l+p),r-=p}}return c.fill(0),{key:a,iv:h}}},{"md5.js":450,"safe-buffer":494}],424:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.CsvParserStream=i.ParserOptions=i.parseFile=i.parseStream=i.parseString=i.parse=i.FormatterOptions=i.CsvFormatterStream=i.writeToPath=i.writeToString=i.writeToBuffer=i.writeToStream=i.write=i.format=void 0;var n=t("@fast-csv/format");Object.defineProperty(i,"format",{enumerable:!0,get:function(){return n.format}}),Object.defineProperty(i,"write",{enumerable:!0,get:function(){return n.write}}),Object.defineProperty(i,"writeToStream",{enumerable:!0,get:function(){return n.writeToStream}}),Object.defineProperty(i,"writeToBuffer",{enumerable:!0,get:function(){return n.writeToBuffer}}),Object.defineProperty(i,"writeToString",{enumerable:!0,get:function(){return n.writeToString}}),Object.defineProperty(i,"writeToPath",{enumerable:!0,get:function(){return n.writeToPath}}),Object.defineProperty(i,"CsvFormatterStream",{enumerable:!0,get:function(){return n.CsvFormatterStream}}),Object.defineProperty(i,"FormatterOptions",{enumerable:!0,get:function(){return n.FormatterOptions}});var s=t("@fast-csv/parse");Object.defineProperty(i,"parse",{enumerable:!0,get:function(){return s.parse}}),Object.defineProperty(i,"parseString",{enumerable:!0,get:function(){return s.parseString}}),Object.defineProperty(i,"parseStream",{enumerable:!0,get:function(){return s.parseStream}}),Object.defineProperty(i,"parseFile",{enumerable:!0,get:function(){return s.parseFile}}),Object.defineProperty(i,"ParserOptions",{enumerable:!0,get:function(){return s.ParserOptions}}),Object.defineProperty(i,"CsvParserStream",{enumerable:!0,get:function(){return s.CsvParserStream}})},{"@fast-csv/format":151,"@fast-csv/parse":155}],425:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("readable-stream").Transform;function r(t){s.call(this),this._block=n.allocUnsafe(t),this._blockSize=t,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}t("inherits")(r,s),r.prototype._transform=function(t,e,i){var n=null;try{this.update(t,e)}catch(t){n=t}i(n)},r.prototype._flush=function(t){var e=null;try{this.push(this.digest())}catch(t){e=t}t(e)},r.prototype.update=function(t,e){if(function(t,e){if(!n.isBuffer(t)&&"string"!=typeof t)throw new TypeError(e+" must be a string or a buffer")}(t,"Data"),this._finalized)throw new Error("Digest already called");n.isBuffer(t)||(t=n.from(t,e));for(var i=this._block,s=0;this._blockOffset+t.length-s>=this._blockSize;){for(var r=this._blockOffset;r<this._blockSize;)i[r++]=t[s++];this._update(),this._blockOffset=0}for(;s<t.length;)i[this._blockOffset++]=t[s++];for(var o=0,a=8*t.length;a>0;++o)this._length[o]+=a,(a=this._length[o]/4294967296|0)>0&&(this._length[o]-=4294967296*a);return this},r.prototype._update=function(){throw new Error("_update is not implemented")},r.prototype.digest=function(t){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var e=this._digest();void 0!==t&&(e=e.toString(t)),this._block.fill(0),this._blockOffset=0;for(var i=0;i<4;++i)this._length[i]=0;return e},r.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=r},{inherits:440,"readable-stream":491,"safe-buffer":494}],426:[function(t,e,i){var n=i;n.utils=t("./hash/utils"),n.common=t("./hash/common"),n.sha=t("./hash/sha"),n.ripemd=t("./hash/ripemd"),n.hmac=t("./hash/hmac"),n.sha1=n.sha.sha1,n.sha256=n.sha.sha256,n.sha224=n.sha.sha224,n.sha384=n.sha.sha384,n.sha512=n.sha.sha512,n.ripemd160=n.ripemd.ripemd160},{"./hash/common":427,"./hash/hmac":428,"./hash/ripemd":429,"./hash/sha":430,"./hash/utils":437}],427:[function(t,e,i){var n=t("./utils"),s=t("minimalistic-assert");function r(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}i.BlockHash=r,r.prototype.update=function(t,e){if(t=n.toArray(t,e),this.pending?this.pending=this.pending.concat(t):this.pending=t,this.pendingTotal+=t.length,this.pending.length>=this._delta8){var i=(t=this.pending).length%this._delta8;this.pending=t.slice(t.length-i,t.length),0===this.pending.length&&(this.pending=null),t=n.join32(t,0,t.length-i,this.endian);for(var s=0;s<t.length;s+=this._delta32)this._update(t,s,s+this._delta32)}return this},r.prototype.digest=function(t){return this.update(this._pad()),s(null===this.pending),this._digest(t)},r.prototype._pad=function(){var t=this.pendingTotal,e=this._delta8,i=e-(t+this.padLength)%e,n=new Array(i+this.padLength);n[0]=128;for(var s=1;s<i;s++)n[s]=0;if(t<<=3,"big"===this.endian){for(var r=8;r<this.padLength;r++)n[s++]=0;n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=t>>>24&255,n[s++]=t>>>16&255,n[s++]=t>>>8&255,n[s++]=255&t}else for(n[s++]=255&t,n[s++]=t>>>8&255,n[s++]=t>>>16&255,n[s++]=t>>>24&255,n[s++]=0,n[s++]=0,n[s++]=0,n[s++]=0,r=8;r<this.padLength;r++)n[s++]=0;return n}},{"./utils":437,"minimalistic-assert":453}],428:[function(t,e,i){var n=t("./utils"),s=t("minimalistic-assert");function r(t,e,i){if(!(this instanceof r))return new r(t,e,i);this.Hash=t,this.blockSize=t.blockSize/8,this.outSize=t.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(e,i))}e.exports=r,r.prototype._init=function(t){t.length>this.blockSize&&(t=(new this.Hash).update(t).digest()),s(t.length<=this.blockSize);for(var e=t.length;e<this.blockSize;e++)t.push(0);for(e=0;e<t.length;e++)t[e]^=54;for(this.inner=(new this.Hash).update(t),e=0;e<t.length;e++)t[e]^=106;this.outer=(new this.Hash).update(t)},r.prototype.update=function(t,e){return this.inner.update(t,e),this},r.prototype.digest=function(t){return this.outer.update(this.inner.digest()),this.outer.digest(t)}},{"./utils":437,"minimalistic-assert":453}],429:[function(t,e,i){var n=t("./utils"),s=t("./common"),r=n.rotl32,o=n.sum32,a=n.sum32_3,h=n.sum32_4,c=s.BlockHash;function u(){if(!(this instanceof u))return new u;c.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function l(t,e,i,n){return t<=15?e^i^n:t<=31?e&i|~e&n:t<=47?(e|~i)^n:t<=63?e&n|i&~n:e^(i|~n)}function f(t){return t<=15?0:t<=31?1518500249:t<=47?1859775393:t<=63?2400959708:2840853838}function d(t){return t<=15?1352829926:t<=31?1548603684:t<=47?1836072691:t<=63?2053994217:0}n.inherits(u,c),i.ripemd160=u,u.blockSize=512,u.outSize=160,u.hmacStrength=192,u.padLength=64,u.prototype._update=function(t,e){for(var i=this.h[0],n=this.h[1],s=this.h[2],c=this.h[3],u=this.h[4],g=i,b=n,w=s,y=c,x=u,M=0;M<80;M++){var T=o(r(h(i,l(M,n,s,c),t[p[M]+e],f(M)),_[M]),u);i=u,u=c,c=r(s,10),s=n,n=T,T=o(r(h(g,l(79-M,b,w,y),t[m[M]+e],d(M)),v[M]),x),g=x,x=y,y=r(w,10),w=b,b=T}T=a(this.h[1],s,y),this.h[1]=a(this.h[2],c,x),this.h[2]=a(this.h[3],u,g),this.h[3]=a(this.h[4],i,b),this.h[4]=a(this.h[0],n,w),this.h[0]=T},u.prototype._digest=function(t){return"hex"===t?n.toHex32(this.h,"little"):n.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],m=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],_=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],v=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},{"./common":427,"./utils":437}],430:[function(t,e,i){i.sha1=t("./sha/1"),i.sha224=t("./sha/224"),i.sha256=t("./sha/256"),i.sha384=t("./sha/384"),i.sha512=t("./sha/512")},{"./sha/1":431,"./sha/224":432,"./sha/256":433,"./sha/384":434,"./sha/512":435}],431:[function(t,e,i){var n=t("../utils"),s=t("../common"),r=t("./common"),o=n.rotl32,a=n.sum32,h=n.sum32_5,c=r.ft_1,u=s.BlockHash,l=[1518500249,1859775393,2400959708,3395469782];function f(){if(!(this instanceof f))return new f;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}n.inherits(f,u),e.exports=f,f.blockSize=512,f.outSize=160,f.hmacStrength=80,f.padLength=64,f.prototype._update=function(t,e){for(var i=this.W,n=0;n<16;n++)i[n]=t[e+n];for(;n<i.length;n++)i[n]=o(i[n-3]^i[n-8]^i[n-14]^i[n-16],1);var s=this.h[0],r=this.h[1],u=this.h[2],f=this.h[3],d=this.h[4];for(n=0;n<i.length;n++){var p=~~(n/20),m=h(o(s,5),c(p,r,u,f),d,i[n],l[p]);d=f,f=u,u=o(r,30),r=s,s=m}this.h[0]=a(this.h[0],s),this.h[1]=a(this.h[1],r),this.h[2]=a(this.h[2],u),this.h[3]=a(this.h[3],f),this.h[4]=a(this.h[4],d)},f.prototype._digest=function(t){return"hex"===t?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},{"../common":427,"../utils":437,"./common":436}],432:[function(t,e,i){var n=t("../utils"),s=t("./256");function r(){if(!(this instanceof r))return new r;s.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}n.inherits(r,s),e.exports=r,r.blockSize=512,r.outSize=224,r.hmacStrength=192,r.padLength=64,r.prototype._digest=function(t){return"hex"===t?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},{"../utils":437,"./256":433}],433:[function(t,e,i){var n=t("../utils"),s=t("../common"),r=t("./common"),o=t("minimalistic-assert"),a=n.sum32,h=n.sum32_4,c=n.sum32_5,u=r.ch32,l=r.maj32,f=r.s0_256,d=r.s1_256,p=r.g0_256,m=r.g1_256,_=s.BlockHash,v=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function g(){if(!(this instanceof g))return new g;_.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=v,this.W=new Array(64)}n.inherits(g,_),e.exports=g,g.blockSize=512,g.outSize=256,g.hmacStrength=192,g.padLength=64,g.prototype._update=function(t,e){for(var i=this.W,n=0;n<16;n++)i[n]=t[e+n];for(;n<i.length;n++)i[n]=h(m(i[n-2]),i[n-7],p(i[n-15]),i[n-16]);var s=this.h[0],r=this.h[1],_=this.h[2],v=this.h[3],g=this.h[4],b=this.h[5],w=this.h[6],y=this.h[7];for(o(this.k.length===i.length),n=0;n<i.length;n++){var x=c(y,d(g),u(g,b,w),this.k[n],i[n]),M=a(f(s),l(s,r,_));y=w,w=b,b=g,g=a(v,x),v=_,_=r,r=s,s=a(x,M)}this.h[0]=a(this.h[0],s),this.h[1]=a(this.h[1],r),this.h[2]=a(this.h[2],_),this.h[3]=a(this.h[3],v),this.h[4]=a(this.h[4],g),this.h[5]=a(this.h[5],b),this.h[6]=a(this.h[6],w),this.h[7]=a(this.h[7],y)},g.prototype._digest=function(t){return"hex"===t?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},{"../common":427,"../utils":437,"./common":436,"minimalistic-assert":453}],434:[function(t,e,i){var n=t("../utils"),s=t("./512");function r(){if(!(this instanceof r))return new r;s.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}n.inherits(r,s),e.exports=r,r.blockSize=1024,r.outSize=384,r.hmacStrength=192,r.padLength=128,r.prototype._digest=function(t){return"hex"===t?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},{"../utils":437,"./512":435}],435:[function(t,e,i){var n=t("../utils"),s=t("../common"),r=t("minimalistic-assert"),o=n.rotr64_hi,a=n.rotr64_lo,h=n.shr64_hi,c=n.shr64_lo,u=n.sum64,l=n.sum64_hi,f=n.sum64_lo,d=n.sum64_4_hi,p=n.sum64_4_lo,m=n.sum64_5_hi,_=n.sum64_5_lo,v=s.BlockHash,g=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function b(){if(!(this instanceof b))return new b;v.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=g,this.W=new Array(160)}function w(t,e,i,n,s){var r=t&i^~t&s;return r<0&&(r+=4294967296),r}function y(t,e,i,n,s,r){var o=e&n^~e&r;return o<0&&(o+=4294967296),o}function x(t,e,i,n,s){var r=t&i^t&s^i&s;return r<0&&(r+=4294967296),r}function M(t,e,i,n,s,r){var o=e&n^e&r^n&r;return o<0&&(o+=4294967296),o}function T(t,e){var i=o(t,e,28)^o(e,t,2)^o(e,t,7);return i<0&&(i+=4294967296),i}function O(t,e){var i=a(t,e,28)^a(e,t,2)^a(e,t,7);return i<0&&(i+=4294967296),i}function E(t,e){var i=o(t,e,14)^o(t,e,18)^o(e,t,9);return i<0&&(i+=4294967296),i}function A(t,e){var i=a(t,e,14)^a(t,e,18)^a(e,t,9);return i<0&&(i+=4294967296),i}function S(t,e){var i=o(t,e,1)^o(t,e,8)^h(t,e,7);return i<0&&(i+=4294967296),i}function k(t,e){var i=a(t,e,1)^a(t,e,8)^c(t,e,7);return i<0&&(i+=4294967296),i}function I(t,e){var i=o(t,e,19)^o(e,t,29)^h(t,e,6);return i<0&&(i+=4294967296),i}function C(t,e){var i=a(t,e,19)^a(e,t,29)^c(t,e,6);return i<0&&(i+=4294967296),i}n.inherits(b,v),e.exports=b,b.blockSize=1024,b.outSize=512,b.hmacStrength=192,b.padLength=128,b.prototype._prepareBlock=function(t,e){for(var i=this.W,n=0;n<32;n++)i[n]=t[e+n];for(;n<i.length;n+=2){var s=I(i[n-4],i[n-3]),r=C(i[n-4],i[n-3]),o=i[n-14],a=i[n-13],h=S(i[n-30],i[n-29]),c=k(i[n-30],i[n-29]),u=i[n-32],l=i[n-31];i[n]=d(s,r,o,a,h,c,u,l),i[n+1]=p(s,r,o,a,h,c,u,l)}},b.prototype._update=function(t,e){this._prepareBlock(t,e);var i=this.W,n=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],h=this.h[4],c=this.h[5],d=this.h[6],p=this.h[7],v=this.h[8],g=this.h[9],b=this.h[10],S=this.h[11],k=this.h[12],I=this.h[13],C=this.h[14],j=this.h[15];r(this.k.length===i.length);for(var D=0;D<i.length;D+=2){var R=C,P=j,N=E(v,g),F=A(v,g),z=w(v,g,b,S,k),L=y(v,g,b,S,k,I),$=this.k[D],U=this.k[D+1],B=i[D],G=i[D+1],H=m(R,P,N,F,z,L,$,U,B,G),V=_(R,P,N,F,z,L,$,U,B,G);R=T(n,s),P=O(n,s),N=x(n,s,o,a,h),F=M(n,s,o,a,h,c);var W=l(R,P,N,F),q=f(R,P,N,F);C=k,j=I,k=b,I=S,b=v,S=g,v=l(d,p,H,V),g=f(p,p,H,V),d=h,p=c,h=o,c=a,o=n,a=s,n=l(H,V,W,q),s=f(H,V,W,q)}u(this.h,0,n,s),u(this.h,2,o,a),u(this.h,4,h,c),u(this.h,6,d,p),u(this.h,8,v,g),u(this.h,10,b,S),u(this.h,12,k,I),u(this.h,14,C,j)},b.prototype._digest=function(t){return"hex"===t?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},{"../common":427,"../utils":437,"minimalistic-assert":453}],436:[function(t,e,i){var n=t("../utils").rotr32;function s(t,e,i){return t&e^~t&i}function r(t,e,i){return t&e^t&i^e&i}function o(t,e,i){return t^e^i}i.ft_1=function(t,e,i,n){return 0===t?s(e,i,n):1===t||3===t?o(e,i,n):2===t?r(e,i,n):void 0},i.ch32=s,i.maj32=r,i.p32=o,i.s0_256=function(t){return n(t,2)^n(t,13)^n(t,22)},i.s1_256=function(t){return n(t,6)^n(t,11)^n(t,25)},i.g0_256=function(t){return n(t,7)^n(t,18)^t>>>3},i.g1_256=function(t){return n(t,17)^n(t,19)^t>>>10}},{"../utils":437}],437:[function(t,e,i){var n=t("minimalistic-assert"),s=t("inherits");function r(t,e){return 55296==(64512&t.charCodeAt(e))&&(!(e<0||e+1>=t.length)&&56320==(64512&t.charCodeAt(e+1)))}function o(t){return(t>>>24|t>>>8&65280|t<<8&16711680|(255&t)<<24)>>>0}function a(t){return 1===t.length?"0"+t:t}function h(t){return 7===t.length?"0"+t:6===t.length?"00"+t:5===t.length?"000"+t:4===t.length?"0000"+t:3===t.length?"00000"+t:2===t.length?"000000"+t:1===t.length?"0000000"+t:t}i.inherits=s,i.toArray=function(t,e){if(Array.isArray(t))return t.slice();if(!t)return[];var i=[];if("string"==typeof t)if(e){if("hex"===e)for((t=t.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(t="0"+t),s=0;s<t.length;s+=2)i.push(parseInt(t[s]+t[s+1],16))}else for(var n=0,s=0;s<t.length;s++){var o=t.charCodeAt(s);o<128?i[n++]=o:o<2048?(i[n++]=o>>6|192,i[n++]=63&o|128):r(t,s)?(o=65536+((1023&o)<<10)+(1023&t.charCodeAt(++s)),i[n++]=o>>18|240,i[n++]=o>>12&63|128,i[n++]=o>>6&63|128,i[n++]=63&o|128):(i[n++]=o>>12|224,i[n++]=o>>6&63|128,i[n++]=63&o|128)}else for(s=0;s<t.length;s++)i[s]=0|t[s];return i},i.toHex=function(t){for(var e="",i=0;i<t.length;i++)e+=a(t[i].toString(16));return e},i.htonl=o,i.toHex32=function(t,e){for(var i="",n=0;n<t.length;n++){var s=t[n];"little"===e&&(s=o(s)),i+=h(s.toString(16))}return i},i.zero2=a,i.zero8=h,i.join32=function(t,e,i,s){var r=i-e;n(r%4==0);for(var o=new Array(r/4),a=0,h=e;a<o.length;a++,h+=4){var c;c="big"===s?t[h]<<24|t[h+1]<<16|t[h+2]<<8|t[h+3]:t[h+3]<<24|t[h+2]<<16|t[h+1]<<8|t[h],o[a]=c>>>0}return o},i.split32=function(t,e){for(var i=new Array(4*t.length),n=0,s=0;n<t.length;n++,s+=4){var r=t[n];"big"===e?(i[s]=r>>>24,i[s+1]=r>>>16&255,i[s+2]=r>>>8&255,i[s+3]=255&r):(i[s+3]=r>>>24,i[s+2]=r>>>16&255,i[s+1]=r>>>8&255,i[s]=255&r)}return i},i.rotr32=function(t,e){return t>>>e|t<<32-e},i.rotl32=function(t,e){return t<<e|t>>>32-e},i.sum32=function(t,e){return t+e>>>0},i.sum32_3=function(t,e,i){return t+e+i>>>0},i.sum32_4=function(t,e,i,n){return t+e+i+n>>>0},i.sum32_5=function(t,e,i,n,s){return t+e+i+n+s>>>0},i.sum64=function(t,e,i,n){var s=t[e],r=n+t[e+1]>>>0,o=(r<n?1:0)+i+s;t[e]=o>>>0,t[e+1]=r},i.sum64_hi=function(t,e,i,n){return(e+n>>>0<e?1:0)+t+i>>>0},i.sum64_lo=function(t,e,i,n){return e+n>>>0},i.sum64_4_hi=function(t,e,i,n,s,r,o,a){var h=0,c=e;return h+=(c=c+n>>>0)<e?1:0,h+=(c=c+r>>>0)<r?1:0,t+i+s+o+(h+=(c=c+a>>>0)<a?1:0)>>>0},i.sum64_4_lo=function(t,e,i,n,s,r,o,a){return e+n+r+a>>>0},i.sum64_5_hi=function(t,e,i,n,s,r,o,a,h,c){var u=0,l=e;return u+=(l=l+n>>>0)<e?1:0,u+=(l=l+r>>>0)<r?1:0,u+=(l=l+a>>>0)<a?1:0,t+i+s+o+h+(u+=(l=l+c>>>0)<c?1:0)>>>0},i.sum64_5_lo=function(t,e,i,n,s,r,o,a,h,c){return e+n+r+a+c>>>0},i.rotr64_hi=function(t,e,i){return(e<<32-i|t>>>i)>>>0},i.rotr64_lo=function(t,e,i){return(t<<32-i|e>>>i)>>>0},i.shr64_hi=function(t,e,i){return t>>>i},i.shr64_lo=function(t,e,i){return(t<<32-i|e>>>i)>>>0}},{inherits:440,"minimalistic-assert":453}],438:[function(t,e,i){var n=t("hash.js"),s=t("minimalistic-crypto-utils"),r=t("minimalistic-assert");function o(t){if(!(this instanceof o))return new o(t);this.hash=t.hash,this.predResist=!!t.predResist,this.outLen=this.hash.outSize,this.minEntropy=t.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=s.toArray(t.entropy,t.entropyEnc||"hex"),i=s.toArray(t.nonce,t.nonceEnc||"hex"),n=s.toArray(t.pers,t.persEnc||"hex");r(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,i,n)}e.exports=o,o.prototype._init=function(t,e,i){var n=t.concat(e).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var s=0;s<this.V.length;s++)this.K[s]=0,this.V[s]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},o.prototype._hmac=function(){return new n.hmac(this.hash,this.K)},o.prototype._update=function(t){var e=this._hmac().update(this.V).update([0]);t&&(e=e.update(t)),this.K=e.digest(),this.V=this._hmac().update(this.V).digest(),t&&(this.K=this._hmac().update(this.V).update([1]).update(t).digest(),this.V=this._hmac().update(this.V).digest())},o.prototype.reseed=function(t,e,i,n){"string"!=typeof e&&(n=i,i=e,e=null),t=s.toArray(t,e),i=s.toArray(i,n),r(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(t.concat(i||[])),this._reseed=1},o.prototype.generate=function(t,e,i,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof e&&(n=i,i=e,e=null),i&&(i=s.toArray(i,n||"hex"),this._update(i));for(var r=[];r.length<t;)this.V=this._hmac().update(this.V).digest(),r=r.concat(this.V);var o=r.slice(0,t);return this._update(i),this._reseed++,s.encode(o,e)}},{"hash.js":426,"minimalistic-assert":453,"minimalistic-crypto-utils":454}],439:[function(t,e,i){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i.read=function(t,e,i,n,s){var r,o,a=8*s-n-1,h=(1<<a)-1,c=h>>1,u=-7,l=i?s-1:0,f=i?-1:1,d=t[e+l];for(l+=f,r=d&(1<<-u)-1,d>>=-u,u+=a;u>0;r=256*r+t[e+l],l+=f,u-=8);for(o=r&(1<<-u)-1,r>>=-u,u+=n;u>0;o=256*o+t[e+l],l+=f,u-=8);if(0===r)r=1-c;else{if(r===h)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),r-=c}return(d?-1:1)*o*Math.pow(2,r-n)},i.write=function(t,e,i,n,s,r){var o,a,h,c=8*r-s-1,u=(1<<c)-1,l=u>>1,f=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:r-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+l>=1?f/h:f*Math.pow(2,1-l))*h>=2&&(o++,h/=2),o+l>=u?(a=0,o=u):o+l>=1?(a=(e*h-1)*Math.pow(2,s),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,s),o=0));s>=8;t[i+d]=255&a,d+=p,a/=256,s-=8);for(o=o<<s|a,c+=s;c>0;t[i+d]=255&o,d+=p,o/=256,c-=8);t[i+d-p]|=128*m}},{}],440:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}},{}],441:[function(t,e,i){(function(n,s,r,o,a,h,c,u){(function(){
/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/
!function(t){"object"==typeof i&&void 0!==e?e.exports=t():("undefined"!=typeof window?window:void 0!==s?s:"undefined"!=typeof self?self:this).JSZip=t()}((function(){return function e(i,n,s){function r(a,h){if(!n[a]){if(!i[a]){var c="function"==typeof t&&t;if(!h&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};i[a][0].call(l.exports,(function(t){return r(i[a][1][t]||t)}),l,l.exports,e,i,n,s)}return n[a].exports}for(var o="function"==typeof t&&t,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(t,e,i){var n=t("./utils"),s=t("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,s,o,a,h,c,u=[],l=0,f=t.length,d=f,p="string"!==n.getTypeOf(t);l<t.length;)d=f-l,s=p?(e=t[l++],i=l<f?t[l++]:0,l<f?t[l++]:0):(e=t.charCodeAt(l++),i=l<f?t.charCodeAt(l++):0,l<f?t.charCodeAt(l++):0),o=e>>2,a=(3&e)<<4|i>>4,h=1<d?(15&i)<<2|s>>6:64,c=2<d?63&s:64,u.push(r.charAt(o)+r.charAt(a)+r.charAt(h)+r.charAt(c));return u.join("")},i.decode=function(t){var e,i,n,o,a,h,c=0,u=0,l="data:";if(t.substr(0,l.length)===l)throw new Error("Invalid base64 input, it looks like a data url.");var f,d=3*(t=t.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(t.charAt(t.length-1)===r.charAt(64)&&d--,t.charAt(t.length-2)===r.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(f=s.uint8array?new Uint8Array(0|d):new Array(0|d);c<t.length;)e=r.indexOf(t.charAt(c++))<<2|(o=r.indexOf(t.charAt(c++)))>>4,i=(15&o)<<4|(a=r.indexOf(t.charAt(c++)))>>2,n=(3&a)<<6|(h=r.indexOf(t.charAt(c++))),f[u++]=e,64!==a&&(f[u++]=i),64!==h&&(f[u++]=n);return f}},{"./support":30,"./utils":32}],2:[function(t,e,i){var n=t("./external"),s=t("./stream/DataWorker"),r=t("./stream/Crc32Probe"),o=t("./stream/DataLengthProbe");function a(t,e,i,n,s){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=n,this.compressedContent=s}a.prototype={getContentWorker:function(){var t=new s(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new s(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(t,e,i){return t.pipe(new r).pipe(new o("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new o("compressedSize")).withStreamInfo("compression",e)},e.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){var n=t("./utils"),s=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function(t,e,i,n){var r=s,o=0+i;t^=-1;for(var a=0;a<o;a++)t=t>>>8^r[255&(t^e[a])];return-1^t}(0|e,t,t.length):function(t,e,i,n){var r=s,o=0+i;t^=-1;for(var a=0;a<o;a++)t=t>>>8^r[255&(t^e.charCodeAt(a))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){var n;n="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:n}},{lie:37}],7:[function(t,e,i){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,s=t("pako"),r=t("./utils"),o=t("./stream/GenericWorker"),a=n?"uint8array":"array";function h(t,e){o.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",r.inherits(h,o),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(r.transformTo(a,t.data),!1)},h.prototype.flush=function(){o.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new h("Deflate",t)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,i){function n(t,e){var i,n="";for(i=0;i<e;i++)n+=String.fromCharCode(255&t),t>>>=8;return n}function s(t,e,i,s,o,u){var l,f,d=t.file,p=t.compression,m=u!==a.utf8encode,_=r.transformTo("string",u(d.name)),v=r.transformTo("string",a.utf8encode(d.name)),g=d.comment,b=r.transformTo("string",u(g)),w=r.transformTo("string",a.utf8encode(g)),y=v.length!==d.name.length,x=w.length!==g.length,M="",T="",O="",E=d.dir,A=d.date,S={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(S.crc32=t.crc32,S.compressedSize=t.compressedSize,S.uncompressedSize=t.uncompressedSize);var k=0;e&&(k|=8),m||!y&&!x||(k|=2048);var I=0,C=0;E&&(I|=16),"UNIX"===o?(C=798,I|=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16}(d.unixPermissions,E)):(C=20,I|=function(t){return 63&(t||0)}(d.dosPermissions)),l=A.getUTCHours(),l<<=6,l|=A.getUTCMinutes(),l<<=5,l|=A.getUTCSeconds()/2,f=A.getUTCFullYear()-1980,f<<=4,f|=A.getUTCMonth()+1,f<<=5,f|=A.getUTCDate(),y&&(T=n(1,1)+n(h(_),4)+v,M+="up"+n(T.length,2)+T),x&&(O=n(1,1)+n(h(b),4)+w,M+="uc"+n(O.length,2)+O);var j="";return j+="\n\0",j+=n(k,2),j+=p.magic,j+=n(l,2),j+=n(f,2),j+=n(S.crc32,4),j+=n(S.compressedSize,4),j+=n(S.uncompressedSize,4),j+=n(_.length,2),j+=n(M.length,2),{fileRecord:c.LOCAL_FILE_HEADER+j+_+M,dirRecord:c.CENTRAL_FILE_HEADER+n(C,2)+j+n(b.length,2)+"\0\0\0\0"+n(I,4)+n(s,4)+_+M+b}}var r=t("../utils"),o=t("../stream/GenericWorker"),a=t("../utf8"),h=t("../crc32"),c=t("../signature");function u(t,e,i,n){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(u,o),u.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,o.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-n-1))/i:100}}))},u.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=s(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=s(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:function(t){return c.DATA_DESCRIPTOR+n(t.crc32,4)+n(t.compressedSize,4)+n(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,s=function(t,e,i,s,o){var a=r.transformTo("string",o(s));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(t,2)+n(t,2)+n(e,4)+n(i,4)+n(a.length,2)+a}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:s,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},u.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(t){var e=this._sources;if(!o.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},u.prototype.lock=function(){o.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){var n=t("../compressions"),s=t("./ZipFileWorker");i.generateWorker=function(t,e,i){var r=new s(e.streamFiles,i,e.platform,e.encodeFileName),o=0;try{t.forEach((function(t,i){o++;var s=function(t,e){var i=t||e,s=n[i];if(!s)throw new Error(i+" is not a valid compression method !");return s}(i.options.compression,e.compression),a=i.options.compressionOptions||e.compressionOptions||{},h=i.dir,c=i.date;i._compressWorker(s,a).withStreamInfo("file",{name:t,dir:h,date:c,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(r)})),r.entriesCount=o}catch(t){r.error(t)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new n;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){var n=t("./utils"),s=t("./external"),r=t("./utf8"),o=t("./zipEntries"),a=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function c(t){return new s.Promise((function(e,i){var n=t.decompressed.getContentWorker().pipe(new a);n.on("error",(function(t){i(t)})).on("end",(function(){n.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var i=this;return e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),h.isNode&&h.isStream(t)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var i=new o(e);return i.load(t),i})).then((function(t){var i=[s.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var r=0;r<n.length;r++)i.push(c(n[r]));return s.Promise.all(i)})).then((function(t){for(var s=t.shift(),r=s.files,o=0;o<r.length;o++){var a=r[o],h=a.fileNameStr,c=n.resolve(a.fileNameStr);i.file(c,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders}),a.dir||(i.file(c).unsafeOriginalName=h)}return s.zipComment.length&&(i.comment=s.zipComment),i}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){var n=t("../utils"),s=t("../stream/GenericWorker");function r(t,e){s.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(r,s),r.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},r.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){var n=t("readable-stream").Readable;function s(t,e,i){n.call(this,e),this._helper=t;var s=this;t.on("data",(function(t,e){s.push(t)||s._helper.pause(),i&&i(e)})).on("error",(function(t){s.emit("error",t)})).on("end",(function(){s.push(null)}))}t("../utils").inherits(s,n),s.prototype._read=function(){this._helper.resume()},e.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){e.exports={isNode:void 0!==r,newBufferFrom:function(t,e){if(r.from&&r.from!==Uint8Array.from)return r.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new r(t,e)},allocBuffer:function(t){if(r.alloc)return r.alloc(t);var e=new r(t);return e.fill(0),e},isBuffer:function(t){return r.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){function n(t,e,i){var n,s=r.getTypeOf(e),a=r.extend(i||{},h);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(t=m(t)),a.createFolders&&(n=p(t))&&_.call(this,n,!0);var l="string"===s&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!l),(e instanceof c&&0===e.uncompressedSize||a.dir||!e||0===e.length)&&(a.base64=!1,a.binary=!0,e="",a.compression="STORE",s="string");var v;v=e instanceof c||e instanceof o?e:f.isNode&&f.isStream(e)?new d(t,e):r.prepareContent(t,e,a.binary,a.optimizedBinaryString,a.base64);var g=new u(t,v,a);this.files[t]=g}var s=t("./utf8"),r=t("./utils"),o=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),h=t("./defaults"),c=t("./compressedObject"),u=t("./zipObject"),l=t("./generate"),f=t("./nodejsUtils"),d=t("./nodejs/NodejsStreamInputAdapter"),p=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},_=function(t,e){return e=void 0!==e?e:h.createFolders,t=m(t),this.files[t]||n.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function v(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var g={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,n;for(e in this.files)n=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,n)},filter:function(t){var e=[];return this.forEach((function(i,n){t(i,n)&&e.push(n)})),e},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,n.call(this,t,e,i),this;if(v(t)){var s=t;return this.filter((function(t,e){return!e.dir&&s.test(t)}))}var r=this.files[this.root+t];return r&&!r.dir?r:null},folder:function(t){if(!t)return this;if(v(t))return this.filter((function(e,i){return i.dir&&t.test(e)}));var e=this.root+t,i=_.call(this,e),n=this.clone();return n.root=i.name,n},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter((function(e,i){return i.name.slice(0,t.length)===t})),n=0;n<i.length;n++)delete this.files[i[n].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=r.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");r.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var n=i.comment||this.comment||"";e=l.generateWorker(this,i,n)}catch(t){(e=new o("error")).error(t)}return new a(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=g},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){var n=t("./DataReader");function s(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data[this.zero+t]},s.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),s=t.charCodeAt(3),r=this.length-4;0<=r;--r)if(this.data[r]===e&&this.data[r+1]===i&&this.data[r+2]===n&&this.data[r+3]===s)return r-this.zero;return-1},s.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),n=t.charCodeAt(2),s=t.charCodeAt(3),r=this.readData(4);return e===r[0]&&i===r[1]&&n===r[2]&&s===r[3]},s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){var n=t("../utils");function s(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=s},{"../utils":32}],19:[function(t,e,i){var n=t("./Uint8ArrayReader");function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){var n=t("./DataReader");function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},s.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},s.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){var n=t("./ArrayReader");function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){var n=t("../utils"),s=t("../support"),r=t("./ArrayReader"),o=t("./StringReader"),a=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||s.uint8array?"nodebuffer"===e?new a(t):s.uint8array?new h(n.transformTo("uint8array",t)):new r(n.transformTo("array",t)):new o(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){var n=t("./GenericWorker"),s=t("../utils");function r(t){n.call(this,"ConvertWorker to "+t),this.destType=t}s.inherits(r,n),r.prototype.processChunk=function(t){this.push({data:s.transformTo(this.destType,t.data),meta:t.meta})},e.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){var n=t("./GenericWorker"),s=t("../crc32");function r(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(r,n),r.prototype.processChunk=function(t){this.streamInfo.crc32=s(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){var n=t("../utils"),s=t("./GenericWorker");function r(t){s.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(r,s),r.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}s.prototype.processChunk.call(this,t)},e.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){var n=t("../utils"),s=t("./GenericWorker");function r(t){s.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}n.inherits(r,s),r.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,i){var n=t("../utils"),s=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),h=t("../support"),c=t("../external"),u=null;if(h.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function l(t,e,i){var r=e;switch(e){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=e,this._mimeType=i,n.checkSupport(r),this._worker=t.pipe(new s(r)),t.lock()}catch(t){this._worker=new o("error"),this._worker.error(t)}}l.prototype={accumulate:function(t){return function(t,e){return new c.Promise((function(i,s){var o=[],h=t._internalType,c=t._outputType,u=t._mimeType;t.on("data",(function(t,i){o.push(t),e&&e(i)})).on("error",(function(t){o=[],s(t)})).on("end",(function(){try{var t=function(t,e,i){switch(t){case"blob":return n.newBlob(n.transformTo("arraybuffer",e),i);case"base64":return a.encode(e);default:return n.transformTo(t,e)}}(c,function(t,e){var i,n=0,s=null,o=0;for(i=0;i<e.length;i++)o+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(s=new Uint8Array(o),i=0;i<e.length;i++)s.set(e[i],n),n+=e[i].length;return s;case"nodebuffer":return r.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(h,o),u);i(t)}catch(t){s(t)}o=[]})).resume()}))}(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,(function(t){e.call(i,t.data,t.meta)})):this._worker.on(t,(function(){n.delay(e,arguments,i)})),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==r,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(n),i.blob=0===s.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){for(var n=t("./utils"),s=t("./support"),r=t("./nodejsUtils"),o=t("./stream/GenericWorker"),a=new Array(256),h=0;h<256;h++)a[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function c(){o.call(this,"utf-8 decode"),this.leftOver=null}function u(){o.call(this,"utf-8 encode")}a[254]=a[254]=1,i.utf8encode=function(t){return s.nodebuffer?r.newBufferFrom(t,"utf-8"):function(t){var e,i,n,r,o,a=t.length,h=0;for(r=0;r<a;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=s.uint8array?new Uint8Array(h):new Array(h),r=o=0;o<h;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(n=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(n-56320),r++),i<128?e[o++]=i:(i<2048?e[o++]=192|i>>>6:(i<65536?e[o++]=224|i>>>12:(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63),e[o++]=128|i>>>6&63),e[o++]=128|63&i);return e}(t)},i.utf8decode=function(t){return s.nodebuffer?n.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,s,r,o=t.length,h=new Array(2*o);for(e=i=0;e<o;)if((s=t[e++])<128)h[i++]=s;else if(4<(r=a[s]))h[i++]=65533,e+=r-1;else{for(s&=2===r?31:3===r?15:7;1<r&&e<o;)s=s<<6|63&t[e++],r--;1<r?h[i++]=65533:s<65536?h[i++]=s:(s-=65536,h[i++]=55296|s>>10&1023,h[i++]=56320|1023&s)}return h.length!==i&&(h.subarray?h=h.subarray(0,i):h.length=i),n.applyFromCharCode(h)}(t=n.transformTo(s.uint8array?"uint8array":"array",t))},n.inherits(c,o),c.prototype.processChunk=function(t){var e=n.transformTo(s.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var r=e;(e=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),e.set(r,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var o=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+a[t[i]]>e?i:e}(e),h=e;o!==e.length&&(s.uint8array?(h=e.subarray(0,o),this.leftOver=e.subarray(o,e.length)):(h=e.slice(0,o),this.leftOver=e.slice(o,e.length))),this.push({data:i.utf8decode(h),meta:t.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=c,n.inherits(u,o),u.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){var n=t("./support"),s=t("./base64"),r=t("./nodejsUtils"),o=t("./external");function a(t){return t}function h(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}t("setimmediate"),i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,i){var n=[],s=0,r=t.length;if(r<=i)return String.fromCharCode.apply(null,t);for(;s<r;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(s,Math.min(s+i,r)))):n.push(String.fromCharCode.apply(null,t.subarray(s,Math.min(s+i,r)))),s+=i;return n.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(t){return!1}}()}};function l(t){var e=65536,n=i.getTypeOf(t),s=!0;if("uint8array"===n?s=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(s=c.applyCanBeUsed.nodebuffer),s)for(;1<e;)try{return c.stringifyByChunk(t,n,e)}catch(t){e=Math.floor(e/2)}return c.stringifyByChar(t)}function f(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}i.applyFromCharCode=l;var d={};d.string={string:a,array:function(t){return h(t,new Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return h(t,new Uint8Array(t.length))},nodebuffer:function(t){return h(t,r.allocBuffer(t.length))}},d.array={string:l,array:a,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(t)}},d.arraybuffer={string:function(t){return l(new Uint8Array(t))},array:function(t){return f(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:a,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(new Uint8Array(t))}},d.uint8array={string:l,array:function(t){return f(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:a,nodebuffer:function(t){return r.newBufferFrom(t)}},d.nodebuffer={string:l,array:function(t){return f(t,new Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return f(t,new Uint8Array(t.length))},nodebuffer:a},i.transformTo=function(t,e){if(e=e||"",!t)return e;i.checkSupport(t);var n=i.getTypeOf(e);return d[n][t](e)},i.resolve=function(t){for(var e=t.split("/"),i=[],n=0;n<e.length;n++){var s=e[n];"."===s||""===s&&0!==n&&n!==e.length-1||(".."===s?i.pop():i.push(s))}return i.join("/")},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":n.nodebuffer&&r.isBuffer(t)?"nodebuffer":n.uint8array&&t instanceof Uint8Array?"uint8array":n.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!n[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,n="";for(i=0;i<(t||"").length;i++)n+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return n},i.delay=function(t,e,i){u((function(){t.apply(i||null,e||[])}))},i.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,r,a,c){return o.Promise.resolve(e).then((function(t){return n.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new o.Promise((function(e,i){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){i(t.target.error)},n.readAsArrayBuffer(t)})):t})).then((function(e){var u=i.getTypeOf(e);return u?("arraybuffer"===u?e=i.transformTo("uint8array",e):"string"===u&&(c?e=s.decode(e):r&&!0!==a&&(e=function(t){return h(t,n.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):o.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,e,i){var n=t("./reader/readerFor"),s=t("./utils"),r=t("./signature"),o=t("./zipEntry"),a=t("./support");function h(t){this.files=[],this.loadOptions=t}h.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(e)+", expected "+s.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;return this.reader.setIndex(i),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=a.uint8array?"uint8array":"array",i=s.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(t=new o({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var n=e-i;if(0<n)this.isSignature(e,r.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){var n=t("./reader/readerFor"),s=t("./utils"),r=t("./compressedObject"),o=t("./crc32"),a=t("./utf8"),h=t("./compressions"),c=t("./support");function u(t,e){this.options=t,this.loadOptions=e}u.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in h)if(Object.prototype.hasOwnProperty.call(h,e)&&h[e].magic===t)return h[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=n(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(t){var e,i,n,s=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<s;)e=t.readInt(2),i=t.readInt(2),n=t.readData(i),this.extraFields[e]={id:e,length:i,value:n};t.setIndex(s)},handleUTF8:function(){var t=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=s.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var r=s.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)||o(this.fileName)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)||o(this.fileComment)!==e.readInt(4)?null:a.utf8decode(e.readData(t.length-5))}return null}},e.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){function n(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var s=t("./stream/StreamHelper"),r=t("./stream/DataWorker"),o=t("./utf8"),a=t("./compressedObject"),h=t("./stream/GenericWorker");n.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var n="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var r=!this._dataBinary;r&&!n&&(e=e.pipe(new o.Utf8EncodeWorker)),!r&&n&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){(e=new h("error")).error(t)}return new s(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof h?this._data:new r(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<c.length;l++)n.prototype[c[l]]=u;e.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,i){(function(t){var i,n,s=t.MutationObserver||t.WebKitMutationObserver;if(s){var r=0,o=new s(u),a=t.document.createTextNode("");o.observe(a,{characterData:!0}),i=function(){a.data=r=++r%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var h=new t.MessageChannel;h.port1.onmessage=u,i=function(){h.port2.postMessage(0)}}var c=[];function u(){var t,e;n=!0;for(var i=c.length;i;){for(e=c,c=[],t=-1;++t<i;)e[t]();i=c.length}n=!1}e.exports=function(t){1!==c.push(t)||n||i()}}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,i){var n=t("immediate");function s(){}var r={},o=["REJECTED"],a=["FULFILLED"],h=["PENDING"];function c(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,t!==s&&d(this,t)}function u(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function l(t,e,i){n((function(){var n;try{n=e(i)}catch(n){return r.reject(t,n)}n===t?r.reject(t,new TypeError("Cannot resolve promise with itself")):r.resolve(t,n)}))}function f(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function d(t,e){var i=!1;function n(e){i||(i=!0,r.reject(t,e))}function s(e){i||(i=!0,r.resolve(t,e))}var o=p((function(){e(s,n)}));"error"===o.status&&n(o.value)}function p(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=c).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(i){return e.resolve(t()).then((function(){return i}))}),(function(i){return e.resolve(t()).then((function(){throw i}))}))},c.prototype.catch=function(t){return this.then(null,t)},c.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var i=new this.constructor(s);return this.state!==h?l(i,this.state===a?t:e,this.outcome):this.queue.push(new u(i,t,e)),i},u.prototype.callFulfilled=function(t){r.resolve(this.promise,t)},u.prototype.otherCallFulfilled=function(t){l(this.promise,this.onFulfilled,t)},u.prototype.callRejected=function(t){r.reject(this.promise,t)},u.prototype.otherCallRejected=function(t){l(this.promise,this.onRejected,t)},r.resolve=function(t,e){var i=p(f,e);if("error"===i.status)return r.reject(t,i.value);var n=i.value;if(n)d(t,n);else{t.state=a,t.outcome=e;for(var s=-1,o=t.queue.length;++s<o;)t.queue[s].callFulfilled(e)}return t},r.reject=function(t,e){t.state=o,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},c.resolve=function(t){return t instanceof this?t:r.resolve(new this(s),t)},c.reject=function(t){var e=new this(s);return r.reject(e,t)},c.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var o=new Array(i),a=0,h=-1,c=new this(s);++h<i;)u(t[h],h);return c;function u(t,s){e.resolve(t).then((function(t){o[s]=t,++a!==i||n||(n=!0,r.resolve(c,o))}),(function(t){n||(n=!0,r.reject(c,t))}))}},c.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);for(var n,o=-1,a=new this(s);++o<e;)n=t[o],this.resolve(n).then((function(t){i||(i=!0,r.resolve(a,t))}),(function(t){i||(i=!0,r.reject(a,t))}));return a}},{immediate:36}],38:[function(t,e,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,i){var n=t("./zlib/deflate"),s=t("./utils/common"),r=t("./utils/strings"),o=t("./zlib/messages"),a=t("./zlib/zstream"),h=Object.prototype.toString;function c(t){if(!(this instanceof c))return new c(t);this.options=s.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==i)throw new Error(o[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var u;if(u="string"==typeof e.dictionary?r.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(i=n.deflateSetDictionary(this.strm,u)))throw new Error(o[i]);this._dict_set=!0}}function u(t,e){var i=new c(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}c.prototype.push=function(t,e){var i,o,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;o=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=r.string2buf(t):"[object ArrayBuffer]"===h.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new s.Buf8(c),a.next_out=0,a.avail_out=c),1!==(i=n.deflate(a,o))&&0!==i)return this.onEnd(i),!(this.ended=!0);0!==a.avail_out&&(0!==a.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(r.buf2binstring(s.shrinkBuf(a.output,a.next_out))):this.onData(s.shrinkBuf(a.output,a.next_out)))}while((0<a.avail_in||0===a.avail_out)&&1!==i);return 4===o?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==o||(this.onEnd(0),!(a.avail_out=0))},c.prototype.onData=function(t){this.chunks.push(t)},c.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=c,i.deflate=u,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,u(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,i){var n=t("./zlib/inflate"),s=t("./utils/common"),r=t("./utils/strings"),o=t("./zlib/constants"),a=t("./zlib/messages"),h=t("./zlib/zstream"),c=t("./zlib/gzheader"),u=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,e.windowBits);if(i!==o.Z_OK)throw new Error(a[i]);this.header=new c,n.inflateGetHeader(this.strm,this.header)}function f(t,e){var i=new l(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}l.prototype.push=function(t,e){var i,a,h,c,l,f,d=this.strm,p=this.options.chunkSize,m=this.options.dictionary,_=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?o.Z_FINISH:o.Z_NO_FLUSH,"string"==typeof t?d.input=r.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new s.Buf8(p),d.next_out=0,d.avail_out=p),(i=n.inflate(d,o.Z_NO_FLUSH))===o.Z_NEED_DICT&&m&&(f="string"==typeof m?r.string2buf(m):"[object ArrayBuffer]"===u.call(m)?new Uint8Array(m):m,i=n.inflateSetDictionary(this.strm,f)),i===o.Z_BUF_ERROR&&!0===_&&(i=o.Z_OK,_=!1),i!==o.Z_STREAM_END&&i!==o.Z_OK)return this.onEnd(i),!(this.ended=!0);d.next_out&&(0!==d.avail_out&&i!==o.Z_STREAM_END&&(0!==d.avail_in||a!==o.Z_FINISH&&a!==o.Z_SYNC_FLUSH)||("string"===this.options.to?(h=r.utf8border(d.output,d.next_out),c=d.next_out-h,l=r.buf2string(d.output,h),d.next_out=c,d.avail_out=p-c,c&&s.arraySet(d.output,d.output,h,c,0),this.onData(l)):this.onData(s.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(_=!0)}while((0<d.avail_in||0===d.avail_out)&&i!==o.Z_STREAM_END);return i===o.Z_STREAM_END&&(a=o.Z_FINISH),a===o.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===o.Z_OK):a!==o.Z_SYNC_FLUSH||(this.onEnd(o.Z_OK),!(d.avail_out=0))},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){t===o.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=l,i.inflate=f,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,f(t,e)},i.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,i){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,i,n,s){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+n),s);else for(var r=0;r<n;r++)t[s+r]=e[i+r]},flattenChunks:function(t){var e,i,n,s,r,o;for(e=n=0,i=t.length;e<i;e++)n+=t[e].length;for(o=new Uint8Array(n),e=s=0,i=t.length;e<i;e++)r=t[e],o.set(r,s),s+=r.length;return o}},r={arraySet:function(t,e,i,n,s){for(var r=0;r<n;r++)t[s+r]=e[i+r]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,s)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(n)},{}],42:[function(t,e,i){var n=t("./common"),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch(t){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){r=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function h(t,e){if(e<65537&&(t.subarray&&r||!t.subarray&&s))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var i="",o=0;o<e;o++)i+=String.fromCharCode(t[o]);return i}o[254]=o[254]=1,i.string2buf=function(t){var e,i,s,r,o,a=t.length,h=0;for(r=0;r<a;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(s=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(s-56320),r++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=new n.Buf8(h),r=o=0;o<h;r++)55296==(64512&(i=t.charCodeAt(r)))&&r+1<a&&56320==(64512&(s=t.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(s-56320),r++),i<128?e[o++]=i:(i<2048?e[o++]=192|i>>>6:(i<65536?e[o++]=224|i>>>12:(e[o++]=240|i>>>18,e[o++]=128|i>>>12&63),e[o++]=128|i>>>6&63),e[o++]=128|63&i);return e},i.buf2binstring=function(t){return h(t,t.length)},i.binstring2buf=function(t){for(var e=new n.Buf8(t.length),i=0,s=e.length;i<s;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,n,s,r,a=e||t.length,c=new Array(2*a);for(i=n=0;i<a;)if((s=t[i++])<128)c[n++]=s;else if(4<(r=o[s]))c[n++]=65533,i+=r-1;else{for(s&=2===r?31:3===r?15:7;1<r&&i<a;)s=s<<6|63&t[i++],r--;1<r?c[n++]=65533:s<65536?c[n++]=s:(s-=65536,c[n++]=55296|s>>10&1023,c[n++]=56320|1023&s)}return h(c,n)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+o[t[i]]>e?i:e}},{"./common":41}],43:[function(t,e,i){e.exports=function(t,e,i,n){for(var s=65535&t|0,r=t>>>16&65535|0,o=0;0!==i;){for(i-=o=2e3<i?2e3:i;r=r+(s=s+e[n++]|0)|0,--o;);s%=65521,r%=65521}return s|r<<16|0}},{}],44:[function(t,e,i){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,i){var n=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,s){var r=n,o=s+i;t^=-1;for(var a=s;a<o;a++)t=t>>>8^r[255&(t^e[a])];return-1^t}},{}],46:[function(t,e,i){var n,s=t("../utils/common"),r=t("./trees"),o=t("./adler32"),a=t("./crc32"),h=t("./messages"),c=-2,u=258,l=262,f=113;function d(t,e){return t.msg=h[e],e}function p(t){return(t<<1)-(4<t?9:0)}function m(t){for(var e=t.length;0<=--e;)t[e]=0}function _(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(s.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function v(t,e){r._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,_(t.strm)}function g(t,e){t.pending_buf[t.pending++]=e}function b(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function w(t,e){var i,n,s=t.max_chain_length,r=t.strstart,o=t.prev_length,a=t.nice_match,h=t.strstart>t.w_size-l?t.strstart-(t.w_size-l):0,c=t.window,f=t.w_mask,d=t.prev,p=t.strstart+u,m=c[r+o-1],_=c[r+o];t.prev_length>=t.good_match&&(s>>=2),a>t.lookahead&&(a=t.lookahead);do{if(c[(i=e)+o]===_&&c[i+o-1]===m&&c[i]===c[r]&&c[++i]===c[r+1]){r+=2,i++;do{}while(c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&c[++r]===c[++i]&&r<p);if(n=u-(p-r),r=p-u,o<n){if(t.match_start=e,a<=(o=n))break;m=c[r+o-1],_=c[r+o]}}}while((e=d[e&f])>h&&0!=--s);return o<=t.lookahead?o:t.lookahead}function y(t){var e,i,n,r,h,c,u,f,d,p,m=t.w_size;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-l)){for(s.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,e=i=t.hash_size;n=t.head[--e],t.head[e]=m<=n?n-m:0,--i;);for(e=i=m;n=t.prev[--e],t.prev[e]=m<=n?n-m:0,--i;);r+=m}if(0===t.strm.avail_in)break;if(c=t.strm,u=t.window,f=t.strstart+t.lookahead,p=void 0,(d=r)<(p=c.avail_in)&&(p=d),i=0===p?0:(c.avail_in-=p,s.arraySet(u,c.input,c.next_in,p,f),1===c.state.wrap?c.adler=o(c.adler,u,p,f):2===c.state.wrap&&(c.adler=a(c.adler,u,p,f)),c.next_in+=p,c.total_in+=p,p),t.lookahead+=i,t.lookahead+t.insert>=3)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+3-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<l&&0!==t.strm.avail_in)}function x(t,e){for(var i,n;;){if(t.lookahead<l){if(y(t),t.lookahead<l&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-l&&(t.match_length=w(t,i)),t.match_length>=3)if(n=r._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function M(t,e){for(var i,n,s;;){if(t.lookahead<l){if(y(t),t.lookahead<l&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-l&&(t.match_length=w(t,i),t.match_length<=5&&(1===t.strategy||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){for(s=t.strstart+t.lookahead-3,n=r._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=s&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(v(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((n=r._tr_tally(t,0,t.window[t.strstart-1]))&&v(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=r._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function T(t,e,i,n,s){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=s}function O(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(1146),this.dyn_dtree=new s.Buf16(122),this.bl_tree=new s.Buf16(78),m(this.dyn_ltree),m(this.dyn_dtree),m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(16),this.heap=new s.Buf16(573),m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(573),m(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function E(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:f,t.adler=2===e.wrap?0:1,e.last_flush=0,r._tr_init(e),0):d(t,c)}function A(t){var e=E(t);return 0===e&&function(t){t.window_size=2*t.w_size,m(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0}(t.state),e}function S(t,e,i,n,r,o){if(!t)return c;var a=1;if(-1===e&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),r<1||9<r||8!==i||n<8||15<n||e<0||9<e||o<0||4<o)return d(t,c);8===n&&(n=9);var h=new O;return(t.state=h).strm=t,h.wrap=a,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=r+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new s.Buf8(2*h.w_size),h.head=new s.Buf16(h.hash_size),h.prev=new s.Buf16(h.w_size),h.lit_bufsize=1<<r+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new s.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=o,h.method=i,A(t)}n=[new T(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(y(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,v(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-l&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(v(t,!1),t.strm.avail_out),1)})),new T(4,4,8,4,x),new T(4,5,16,8,x),new T(4,6,32,32,x),new T(4,4,16,16,M),new T(8,16,32,32,M),new T(8,16,128,128,M),new T(8,32,128,256,M),new T(32,128,258,1024,M),new T(32,258,258,4096,M)],i.deflateInit=function(t,e){return S(t,e,8,15,8,0)},i.deflateInit2=S,i.deflateReset=A,i.deflateResetKeep=E,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?c:(t.state.gzhead=e,0):c},i.deflate=function(t,e){var i,s,o,h;if(!t||!t.state||5<e||e<0)return t?d(t,c):c;if(s=t.state,!t.output||!t.input&&0!==t.avail_in||666===s.status&&4!==e)return d(t,0===t.avail_out?-5:c);if(s.strm=t,i=s.last_flush,s.last_flush=e,42===s.status)if(2===s.wrap)t.adler=0,g(s,31),g(s,139),g(s,8),s.gzhead?(g(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),g(s,255&s.gzhead.time),g(s,s.gzhead.time>>8&255),g(s,s.gzhead.time>>16&255),g(s,s.gzhead.time>>24&255),g(s,9===s.level?2:2<=s.strategy||s.level<2?4:0),g(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(g(s,255&s.gzhead.extra.length),g(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=a(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(g(s,0),g(s,0),g(s,0),g(s,0),g(s,0),g(s,9===s.level?2:2<=s.strategy||s.level<2?4:0),g(s,3),s.status=f);else{var l=8+(s.w_bits-8<<4)<<8;l|=(2<=s.strategy||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(l|=32),l+=31-l%31,s.status=f,b(s,l),0!==s.strstart&&(b(s,t.adler>>>16),b(s,65535&t.adler)),t.adler=1}if(69===s.status)if(s.gzhead.extra){for(o=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>o&&(t.adler=a(t.adler,s.pending_buf,s.pending-o,o)),_(t),o=s.pending,s.pending!==s.pending_buf_size));)g(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>o&&(t.adler=a(t.adler,s.pending_buf,s.pending-o,o)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){o=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>o&&(t.adler=a(t.adler,s.pending_buf,s.pending-o,o)),_(t),o=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,g(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>o&&(t.adler=a(t.adler,s.pending_buf,s.pending-o,o)),0===h&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){o=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>o&&(t.adler=a(t.adler,s.pending_buf,s.pending-o,o)),_(t),o=s.pending,s.pending===s.pending_buf_size)){h=1;break}h=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,g(s,h)}while(0!==h);s.gzhead.hcrc&&s.pending>o&&(t.adler=a(t.adler,s.pending_buf,s.pending-o,o)),0===h&&(s.status=103)}else s.status=103;if(103===s.status&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&_(t),s.pending+2<=s.pending_buf_size&&(g(s,255&t.adler),g(s,t.adler>>8&255),t.adler=0,s.status=f)):s.status=f),0!==s.pending){if(_(t),0===t.avail_out)return s.last_flush=-1,0}else if(0===t.avail_in&&p(e)<=p(i)&&4!==e)return d(t,-5);if(666===s.status&&0!==t.avail_in)return d(t,-5);if(0!==t.avail_in||0!==s.lookahead||0!==e&&666!==s.status){var w=2===s.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(y(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,i=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(s,e):3===s.strategy?function(t,e){for(var i,n,s,o,a=t.window;;){if(t.lookahead<=u){if(y(t),t.lookahead<=u&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&0<t.strstart&&(n=a[s=t.strstart-1])===a[++s]&&n===a[++s]&&n===a[++s]){o=t.strstart+u;do{}while(n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&s<o);t.match_length=u-(o-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=r._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(s,e):n[s.level].func(s,e);if(3!==w&&4!==w||(s.status=666),1===w||3===w)return 0===t.avail_out&&(s.last_flush=-1),0;if(2===w&&(1===e?r._tr_align(s):5!==e&&(r._tr_stored_block(s,0,0,!1),3===e&&(m(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),_(t),0===t.avail_out))return s.last_flush=-1,0}return 4!==e?0:s.wrap<=0?1:(2===s.wrap?(g(s,255&t.adler),g(s,t.adler>>8&255),g(s,t.adler>>16&255),g(s,t.adler>>24&255),g(s,255&t.total_in),g(s,t.total_in>>8&255),g(s,t.total_in>>16&255),g(s,t.total_in>>24&255)):(b(s,t.adler>>>16),b(s,65535&t.adler)),_(t),0<s.wrap&&(s.wrap=-s.wrap),0!==s.pending?0:1)},i.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&e!==f&&666!==e?d(t,c):(t.state=null,e===f?d(t,-3):0):c},i.deflateSetDictionary=function(t,e){var i,n,r,a,h,u,l,f,d=e.length;if(!t||!t.state)return c;if(2===(a=(i=t.state).wrap)||1===a&&42!==i.status||i.lookahead)return c;for(1===a&&(t.adler=o(t.adler,e,d,0)),i.wrap=0,d>=i.w_size&&(0===a&&(m(i.head),i.strstart=0,i.block_start=0,i.insert=0),f=new s.Buf8(i.w_size),s.arraySet(f,e,d-i.w_size,i.w_size,0),e=f,d=i.w_size),h=t.avail_in,u=t.next_in,l=t.input,t.avail_in=d,t.next_in=0,t.input=e,y(i);i.lookahead>=3;){for(n=i.strstart,r=i.lookahead-2;i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+3-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++,--r;);i.strstart=n,i.lookahead=2,y(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=u,t.input=l,t.avail_in=h,i.wrap=a,0},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,i){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,i){e.exports=function(t,e){var i,n,s,r,o,a,h,c,u,l,f,d,p,m,_,v,g,b,w,y,x,M,T,O,E;i=t.state,n=t.next_in,O=t.input,s=n+(t.avail_in-5),r=t.next_out,E=t.output,o=r-(e-t.avail_out),a=r+(t.avail_out-257),h=i.dmax,c=i.wsize,u=i.whave,l=i.wnext,f=i.window,d=i.hold,p=i.bits,m=i.lencode,_=i.distcode,v=(1<<i.lenbits)-1,g=(1<<i.distbits)-1;t:do{p<15&&(d+=O[n++]<<p,p+=8,d+=O[n++]<<p,p+=8),b=m[d&v];e:for(;;){if(d>>>=w=b>>>24,p-=w,0==(w=b>>>16&255))E[r++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=m[(65535&b)+(d&(1<<w)-1)];continue e}if(32&w){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}y=65535&b,(w&=15)&&(p<w&&(d+=O[n++]<<p,p+=8),y+=d&(1<<w)-1,d>>>=w,p-=w),p<15&&(d+=O[n++]<<p,p+=8,d+=O[n++]<<p,p+=8),b=_[d&g];i:for(;;){if(d>>>=w=b>>>24,p-=w,!(16&(w=b>>>16&255))){if(0==(64&w)){b=_[(65535&b)+(d&(1<<w)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(x=65535&b,p<(w&=15)&&(d+=O[n++]<<p,(p+=8)<w&&(d+=O[n++]<<p,p+=8)),h<(x+=d&(1<<w)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(d>>>=w,p-=w,(w=r-o)<x){if(u<(w=x-w)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(T=f,(M=0)===l){if(M+=c-w,w<y){for(y-=w;E[r++]=f[M++],--w;);M=r-x,T=E}}else if(l<w){if(M+=c+l-w,(w-=l)<y){for(y-=w;E[r++]=f[M++],--w;);if(M=0,l<y){for(y-=w=l;E[r++]=f[M++],--w;);M=r-x,T=E}}}else if(M+=l-w,w<y){for(y-=w;E[r++]=f[M++],--w;);M=r-x,T=E}for(;2<y;)E[r++]=T[M++],E[r++]=T[M++],E[r++]=T[M++],y-=3;y&&(E[r++]=T[M++],1<y&&(E[r++]=T[M++]))}else{for(M=r-x;E[r++]=E[M++],E[r++]=E[M++],E[r++]=E[M++],2<(y-=3););y&&(E[r++]=E[M++],1<y&&(E[r++]=E[M++]))}break}}break}}while(n<s&&r<a);n-=y=p>>3,d&=(1<<(p-=y<<3))-1,t.next_in=n,t.next_out=r,t.avail_in=n<s?s-n+5:5-(n-s),t.avail_out=r<a?a-r+257:257-(r-a),i.hold=d,i.bits=p}},{}],49:[function(t,e,i){var n=t("../utils/common"),s=t("./adler32"),r=t("./crc32"),o=t("./inffast"),a=t("./inftrees"),h=-2;function c(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function l(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(852),e.distcode=e.distdyn=new n.Buf32(592),e.sane=1,e.back=-1,0):h}function f(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,l(t)):h}function d(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?h:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,f(t))):h}function p(t,e){var i,n;return t?(n=new u,(t.state=n).window=null,0!==(i=d(t,e))&&(t.state=null),i):h}var m,_,v=!0;function g(t){if(v){var e;for(m=new n.Buf32(512),_=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(1,t.lens,0,288,m,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(2,t.lens,0,32,_,0,t.work,{bits:5}),v=!1}t.lencode=m,t.lenbits=9,t.distcode=_,t.distbits=5}function b(t,e,i,s){var r,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new n.Buf8(o.wsize)),s>=o.wsize?(n.arraySet(o.window,e,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(s<(r=o.wsize-o.wnext)&&(r=s),n.arraySet(o.window,e,i-s,r,o.wnext),(s-=r)?(n.arraySet(o.window,e,i-s,s,0),o.wnext=s,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}i.inflateReset=f,i.inflateReset2=d,i.inflateResetKeep=l,i.inflateInit=function(t){return p(t,15)},i.inflateInit2=p,i.inflate=function(t,e){var i,u,l,f,d,p,m,_,v,w,y,x,M,T,O,E,A,S,k,I,C,j,D,R,P=0,N=new n.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return h;12===(i=t.state).mode&&(i.mode=13),d=t.next_out,l=t.output,m=t.avail_out,f=t.next_in,u=t.input,p=t.avail_in,_=i.hold,v=i.bits,w=p,y=m,j=0;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;v<16;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(2&i.wrap&&35615===_){N[i.check=0]=255&_,N[1]=_>>>8&255,i.check=r(i.check,N,2,0),v=_=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&_)){t.msg="unknown compression method",i.mode=30;break}if(v-=4,C=8+(15&(_>>>=4)),0===i.wbits)i.wbits=C;else if(C>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<C,t.adler=i.check=1,i.mode=512&_?10:12,v=_=0;break;case 2:for(;v<16;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(i.flags=_,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=_>>8&1),512&i.flags&&(N[0]=255&_,N[1]=_>>>8&255,i.check=r(i.check,N,2,0)),v=_=0,i.mode=3;case 3:for(;v<32;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}i.head&&(i.head.time=_),512&i.flags&&(N[0]=255&_,N[1]=_>>>8&255,N[2]=_>>>16&255,N[3]=_>>>24&255,i.check=r(i.check,N,4,0)),v=_=0,i.mode=4;case 4:for(;v<16;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&i.flags&&(N[0]=255&_,N[1]=_>>>8&255,i.check=r(i.check,N,2,0)),v=_=0,i.mode=5;case 5:if(1024&i.flags){for(;v<16;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}i.length=_,i.head&&(i.head.extra_len=_),512&i.flags&&(N[0]=255&_,N[1]=_>>>8&255,i.check=r(i.check,N,2,0)),v=_=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(p<(x=i.length)&&(x=p),x&&(i.head&&(C=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,u,f,x,C)),512&i.flags&&(i.check=r(i.check,u,x,f)),p-=x,f+=x,i.length-=x),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===p)break t;for(x=0;C=u[f+x++],i.head&&C&&i.length<65536&&(i.head.name+=String.fromCharCode(C)),C&&x<p;);if(512&i.flags&&(i.check=r(i.check,u,x,f)),p-=x,f+=x,C)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===p)break t;for(x=0;C=u[f+x++],i.head&&C&&i.length<65536&&(i.head.comment+=String.fromCharCode(C)),C&&x<p;);if(512&i.flags&&(i.check=r(i.check,u,x,f)),p-=x,f+=x,C)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;v<16;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(_!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}v=_=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;v<32;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}t.adler=i.check=c(_),v=_=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=d,t.avail_out=m,t.next_in=f,t.avail_in=p,i.hold=_,i.bits=v,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){_>>>=7&v,v-=7&v,i.mode=27;break}for(;v<3;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}switch(i.last=1&_,v-=1,3&(_>>>=1)){case 0:i.mode=14;break;case 1:if(g(i),i.mode=20,6!==e)break;_>>>=2,v-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}_>>>=2,v-=2;break;case 14:for(_>>>=7&v,v-=7&v;v<32;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if((65535&_)!=(_>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&_,v=_=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(x=i.length){if(p<x&&(x=p),m<x&&(x=m),0===x)break t;n.arraySet(l,u,f,x,d),p-=x,f+=x,m-=x,d+=x,i.length-=x;break}i.mode=12;break;case 17:for(;v<14;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(i.nlen=257+(31&_),_>>>=5,v-=5,i.ndist=1+(31&_),_>>>=5,v-=5,i.ncode=4+(15&_),_>>>=4,v-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;v<3;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}i.lens[F[i.have++]]=7&_,_>>>=3,v-=3}for(;i.have<19;)i.lens[F[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,D={bits:i.lenbits},j=a(0,i.lens,0,19,i.lencode,0,i.work,D),i.lenbits=D.bits,j){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;E=(P=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,A=65535&P,!((O=P>>>24)<=v);){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(A<16)_>>>=O,v-=O,i.lens[i.have++]=A;else{if(16===A){for(R=O+2;v<R;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(_>>>=O,v-=O,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}C=i.lens[i.have-1],x=3+(3&_),_>>>=2,v-=2}else if(17===A){for(R=O+3;v<R;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}v-=O,C=0,x=3+(7&(_>>>=O)),_>>>=3,v-=3}else{for(R=O+7;v<R;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}v-=O,C=0,x=11+(127&(_>>>=O)),_>>>=7,v-=7}if(i.have+x>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;x--;)i.lens[i.have++]=C}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,D={bits:i.lenbits},j=a(1,i.lens,0,i.nlen,i.lencode,0,i.work,D),i.lenbits=D.bits,j){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,D={bits:i.distbits},j=a(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,D),i.distbits=D.bits,j){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=p&&258<=m){t.next_out=d,t.avail_out=m,t.next_in=f,t.avail_in=p,i.hold=_,i.bits=v,o(t,y),d=t.next_out,l=t.output,m=t.avail_out,f=t.next_in,u=t.input,p=t.avail_in,_=i.hold,v=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;E=(P=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,A=65535&P,!((O=P>>>24)<=v);){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(E&&0==(240&E)){for(S=O,k=E,I=A;E=(P=i.lencode[I+((_&(1<<S+k)-1)>>S)])>>>16&255,A=65535&P,!(S+(O=P>>>24)<=v);){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}_>>>=S,v-=S,i.back+=S}if(_>>>=O,v-=O,i.back+=O,i.length=A,0===E){i.mode=26;break}if(32&E){i.back=-1,i.mode=12;break}if(64&E){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&E,i.mode=22;case 22:if(i.extra){for(R=i.extra;v<R;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,v-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;E=(P=i.distcode[_&(1<<i.distbits)-1])>>>16&255,A=65535&P,!((O=P>>>24)<=v);){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(0==(240&E)){for(S=O,k=E,I=A;E=(P=i.distcode[I+((_&(1<<S+k)-1)>>S)])>>>16&255,A=65535&P,!(S+(O=P>>>24)<=v);){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}_>>>=S,v-=S,i.back+=S}if(_>>>=O,v-=O,i.back+=O,64&E){t.msg="invalid distance code",i.mode=30;break}i.offset=A,i.extra=15&E,i.mode=24;case 24:if(i.extra){for(R=i.extra;v<R;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,v-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===m)break t;if(x=y-m,i.offset>x){if((x=i.offset-x)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}M=x>i.wnext?(x-=i.wnext,i.wsize-x):i.wnext-x,x>i.length&&(x=i.length),T=i.window}else T=l,M=d-i.offset,x=i.length;for(m<x&&(x=m),m-=x,i.length-=x;l[d++]=T[M++],--x;);0===i.length&&(i.mode=21);break;case 26:if(0===m)break t;l[d++]=i.length,m--,i.mode=21;break;case 27:if(i.wrap){for(;v<32;){if(0===p)break t;p--,_|=u[f++]<<v,v+=8}if(y-=m,t.total_out+=y,i.total+=y,y&&(t.adler=i.check=i.flags?r(i.check,l,y,d-y):s(i.check,l,y,d-y)),y=m,(i.flags?_:c(_))!==i.check){t.msg="incorrect data check",i.mode=30;break}v=_=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;v<32;){if(0===p)break t;p--,_+=u[f++]<<v,v+=8}if(_!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}v=_=0}i.mode=29;case 29:j=1;break t;case 30:j=-3;break t;case 31:return-4;case 32:default:return h}return t.next_out=d,t.avail_out=m,t.next_in=f,t.avail_in=p,i.hold=_,i.bits=v,(i.wsize||y!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&b(t,t.output,t.next_out,y-t.avail_out)?(i.mode=31,-4):(w-=t.avail_in,y-=t.avail_out,t.total_in+=w,t.total_out+=y,i.total+=y,i.wrap&&y&&(t.adler=i.check=i.flags?r(i.check,l,y,t.next_out-y):s(i.check,l,y,t.next_out-y)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==w&&0===y||4===e)&&0===j&&(j=-5),j)},i.inflateEnd=function(t){if(!t||!t.state)return h;var e=t.state;return e.window&&(e.window=null),t.state=null,0},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?h:((i.head=e).done=!1,0):h},i.inflateSetDictionary=function(t,e){var i,n=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?h:11===i.mode&&s(1,e,n,0)!==i.check?-3:b(t,e,n,n)?(i.mode=31,-4):(i.havedict=1,0):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,i){var n=t("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,h,c,u,l,f){var d,p,m,_,v,g,b,w,y,x=f.bits,M=0,T=0,O=0,E=0,A=0,S=0,k=0,I=0,C=0,j=0,D=null,R=0,P=new n.Buf16(16),N=new n.Buf16(16),F=null,z=0;for(M=0;M<=15;M++)P[M]=0;for(T=0;T<h;T++)P[e[i+T]]++;for(A=x,E=15;1<=E&&0===P[E];E--);if(E<A&&(A=E),0===E)return c[u++]=20971520,c[u++]=20971520,f.bits=1,0;for(O=1;O<E&&0===P[O];O++);for(A<O&&(A=O),M=I=1;M<=15;M++)if(I<<=1,(I-=P[M])<0)return-1;if(0<I&&(0===t||1!==E))return-1;for(N[1]=0,M=1;M<15;M++)N[M+1]=N[M]+P[M];for(T=0;T<h;T++)0!==e[i+T]&&(l[N[e[i+T]]++]=T);if(g=0===t?(D=F=l,19):1===t?(D=s,R-=257,F=r,z-=257,256):(D=o,F=a,-1),M=O,v=u,k=T=j=0,m=-1,_=(C=1<<(S=A))-1,1===t&&852<C||2===t&&592<C)return 1;for(;;){for(b=M-k,y=l[T]<g?(w=0,l[T]):l[T]>g?(w=F[z+l[T]],D[R+l[T]]):(w=96,0),d=1<<M-k,O=p=1<<S;c[v+(j>>k)+(p-=d)]=b<<24|w<<16|y|0,0!==p;);for(d=1<<M-1;j&d;)d>>=1;if(0!==d?(j&=d-1,j+=d):j=0,T++,0==--P[M]){if(M===E)break;M=e[i+l[T]]}if(A<M&&(j&_)!==m){for(0===k&&(k=A),v+=O,I=1<<(S=M-k);S+k<E&&!((I-=P[S+k])<=0);)S++,I<<=1;if(C+=1<<S,1===t&&852<C||2===t&&592<C)return 1;c[m=j&_]=A<<24|S<<16|v-u|0}}return 0!==j&&(c[v+j]=M-k<<24|64<<16|0),f.bits=A,0}},{"../utils/common":41}],51:[function(t,e,i){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,i){var n=t("../utils/common");function s(t){for(var e=t.length;0<=--e;)t[e]=0}var r=256,o=286,a=30,h=15,c=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=new Array(576);s(d);var p=new Array(60);s(p);var m=new Array(512);s(m);var _=new Array(256);s(_);var v=new Array(29);s(v);var g,b,w,y=new Array(a);function x(t,e,i,n,s){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=s,this.has_stree=t&&t.length}function M(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function T(t){return t<256?m[t]:m[256+(t>>>7)]}function O(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function E(t,e,i){t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,O(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function A(t,e,i){E(t,i[2*e],i[2*e+1])}function S(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function k(t,e,i){var n,s,r=new Array(16),o=0;for(n=1;n<=h;n++)r[n]=o=o+i[n-1]<<1;for(s=0;s<=e;s++){var a=t[2*s+1];0!==a&&(t[2*s]=S(r[a]++,a))}}function I(t){var e;for(e=0;e<o;e++)t.dyn_ltree[2*e]=0;for(e=0;e<a;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function C(t){8<t.bi_valid?O(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function j(t,e,i,n){var s=2*e,r=2*i;return t[s]<t[r]||t[s]===t[r]&&n[e]<=n[i]}function D(t,e,i){for(var n=t.heap[i],s=i<<1;s<=t.heap_len&&(s<t.heap_len&&j(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!j(e,n,t.heap[s],t.depth));)t.heap[i]=t.heap[s],i=s,s<<=1;t.heap[i]=n}function R(t,e,i){var n,s,o,a,h=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],s=t.pending_buf[t.l_buf+h],h++,0===n?A(t,s,e):(A(t,(o=_[s])+r+1,e),0!==(a=c[o])&&E(t,s-=v[o],a),A(t,o=T(--n),i),0!==(a=u[o])&&E(t,n-=y[o],a)),h<t.last_lit;);A(t,256,e)}function P(t,e){var i,n,s,r=e.dyn_tree,o=e.stat_desc.static_tree,a=e.stat_desc.has_stree,c=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<c;i++)0!==r[2*i]?(t.heap[++t.heap_len]=u=i,t.depth[i]=0):r[2*i+1]=0;for(;t.heap_len<2;)r[2*(s=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[s]=0,t.opt_len--,a&&(t.static_len-=o[2*s+1]);for(e.max_code=u,i=t.heap_len>>1;1<=i;i--)D(t,r,i);for(s=c;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],D(t,r,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,r[2*s]=r[2*i]+r[2*n],t.depth[s]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,r[2*i+1]=r[2*n+1]=s,t.heap[1]=s++,D(t,r,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,n,s,r,o,a,c=e.dyn_tree,u=e.max_code,l=e.stat_desc.static_tree,f=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,p=e.stat_desc.extra_base,m=e.stat_desc.max_length,_=0;for(r=0;r<=h;r++)t.bl_count[r]=0;for(c[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)m<(r=c[2*c[2*(n=t.heap[i])+1]+1]+1)&&(r=m,_++),c[2*n+1]=r,u<n||(t.bl_count[r]++,o=0,p<=n&&(o=d[n-p]),a=c[2*n],t.opt_len+=a*(r+o),f&&(t.static_len+=a*(l[2*n+1]+o)));if(0!==_){do{for(r=m-1;0===t.bl_count[r];)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[m]--,_-=2}while(0<_);for(r=m;0!==r;r--)for(n=t.bl_count[r];0!==n;)u<(s=t.heap[--i])||(c[2*s+1]!==r&&(t.opt_len+=(r-c[2*s+1])*c[2*s],c[2*s+1]=r),n--)}}(t,e),k(r,u,t.bl_count)}function N(t,e,i){var n,s,r=-1,o=e[1],a=0,h=7,c=4;for(0===o&&(h=138,c=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)s=o,o=e[2*(n+1)+1],++a<h&&s===o||(a<c?t.bl_tree[2*s]+=a:0!==s?(s!==r&&t.bl_tree[2*s]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,r=s,c=(a=0)===o?(h=138,3):s===o?(h=6,3):(h=7,4))}function F(t,e,i){var n,s,r=-1,o=e[1],a=0,h=7,c=4;for(0===o&&(h=138,c=3),n=0;n<=i;n++)if(s=o,o=e[2*(n+1)+1],!(++a<h&&s===o)){if(a<c)for(;A(t,s,t.bl_tree),0!=--a;);else 0!==s?(s!==r&&(A(t,s,t.bl_tree),a--),A(t,16,t.bl_tree),E(t,a-3,2)):a<=10?(A(t,17,t.bl_tree),E(t,a-3,3)):(A(t,18,t.bl_tree),E(t,a-11,7));r=s,c=(a=0)===o?(h=138,3):s===o?(h=6,3):(h=7,4)}}s(y);var z=!1;function L(t,e,i,s){E(t,0+(s?1:0),3),function(t,e,i,s){C(t),O(t,i),O(t,~i),n.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}i._tr_init=function(t){z||(function(){var t,e,i,n,s,r=new Array(16);for(n=i=0;n<28;n++)for(v[n]=i,t=0;t<1<<c[n];t++)_[i++]=n;for(_[i-1]=n,n=s=0;n<16;n++)for(y[n]=s,t=0;t<1<<u[n];t++)m[s++]=n;for(s>>=7;n<a;n++)for(y[n]=s<<7,t=0;t<1<<u[n]-7;t++)m[256+s++]=n;for(e=0;e<=h;e++)r[e]=0;for(t=0;t<=143;)d[2*t+1]=8,t++,r[8]++;for(;t<=255;)d[2*t+1]=9,t++,r[9]++;for(;t<=279;)d[2*t+1]=7,t++,r[7]++;for(;t<=287;)d[2*t+1]=8,t++,r[8]++;for(k(d,287,r),t=0;t<a;t++)p[2*t+1]=5,p[2*t]=S(t,5);g=new x(d,c,257,o,h),b=new x(p,u,0,a,h),w=new x(new Array(0),l,0,19,7)}(),z=!0),t.l_desc=new M(t.dyn_ltree,g),t.d_desc=new M(t.dyn_dtree,b),t.bl_desc=new M(t.bl_tree,w),t.bi_buf=0,t.bi_valid=0,I(t)},i._tr_stored_block=L,i._tr_flush_block=function(t,e,i,n){var s,o,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<r;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),P(t,t.l_desc),P(t,t.d_desc),a=function(t){var e;for(N(t,t.dyn_ltree,t.l_desc.max_code),N(t,t.dyn_dtree,t.d_desc.max_code),P(t,t.bl_desc),e=18;3<=e&&0===t.bl_tree[2*f[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),s=t.opt_len+3+7>>>3,(o=t.static_len+3+7>>>3)<=s&&(s=o)):s=o=i+5,i+4<=s&&-1!==e?L(t,e,i,n):4===t.strategy||o===s?(E(t,2+(n?1:0),3),R(t,d,p)):(E(t,4+(n?1:0),3),function(t,e,i,n){var s;for(E(t,e-257,5),E(t,i-1,5),E(t,n-4,4),s=0;s<n;s++)E(t,t.bl_tree[2*f[s]+1],3);F(t,t.dyn_ltree,e-1),F(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),R(t,t.dyn_ltree,t.dyn_dtree)),I(t),n&&C(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(_[i]+r+1)]++,t.dyn_dtree[2*T(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){E(t,2,3),A(t,256,d),function(t){16===t.bi_valid?(O(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,i){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,i){(function(t){!function(t,e){if(!t.setImmediate){var i,s,r,o,a=1,h={},c=!1,u=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,i="[object process]"==={}.toString.call(t.process)?function(t){n.nextTick((function(){d(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(o="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",p,!1):t.attachEvent("onmessage",p),function(e){t.postMessage(o+e,"*")}):t.MessageChannel?((r=new MessageChannel).port1.onmessage=function(t){d(t.data)},function(t){r.port2.postMessage(t)}):u&&"onreadystatechange"in u.createElement("script")?(s=u.documentElement,function(t){var e=u.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,s.removeChild(e),e=null},s.appendChild(e)}):function(t){setTimeout(d,0,t)},l.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var s={callback:t,args:e};return h[a]=s,i(a),a++},l.clearImmediate=f}function f(t){delete h[t]}function d(t){if(c)setTimeout(d,0,t);else{var e=h[t];if(e){c=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(void 0,i)}}(e)}finally{f(t),c=!1}}}}function p(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(o)&&d(+e.data.slice(o.length))}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)}))}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],t("timers").setImmediate)},{_process:467,buffer:220,timers:523}],442:[function(t,e,i){(function(t){(function(){var i=/[\\^$.*+?()[\]{}|]/g,n=RegExp(i.source),s="object"==typeof t&&t&&t.Object===Object&&t,r="object"==typeof self&&self&&self.Object===Object&&self,o=s||r||Function("return this")(),a=Object.prototype.toString,h=o.Symbol,c=h?h.prototype:void 0,u=c?c.toString:void 0;function l(t){if("string"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==a.call(t)}(t))return u?u.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}e.exports=function(t){var e;return(t=null==(e=t)?"":l(e))&&n.test(t)?t.replace(i,"\\$&"):t}}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],443:[function(t,e,i){(function(t){(function(){var n="[object Arguments]",s="[object Map]",r="[object Object]",o="[object Set]",a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,h=/^\w*$/,c=/^\./,u=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g,f=/^\[object .+?Constructor\]$/,d=/^(?:0|[1-9]\d*)$/,p={};p["[object Float32Array]"]=p["[object Float64Array]"]=p["[object Int8Array]"]=p["[object Int16Array]"]=p["[object Int32Array]"]=p["[object Uint8Array]"]=p["[object Uint8ClampedArray]"]=p["[object Uint16Array]"]=p["[object Uint32Array]"]=!0,p[n]=p["[object Array]"]=p["[object ArrayBuffer]"]=p["[object Boolean]"]=p["[object DataView]"]=p["[object Date]"]=p["[object Error]"]=p["[object Function]"]=p[s]=p["[object Number]"]=p[r]=p["[object RegExp]"]=p[o]=p["[object String]"]=p["[object WeakMap]"]=!1;var m="object"==typeof t&&t&&t.Object===Object&&t,_="object"==typeof self&&self&&self.Object===Object&&self,v=m||_||Function("return this")(),g="object"==typeof i&&i&&!i.nodeType&&i,b=g&&"object"==typeof e&&e&&!e.nodeType&&e,w=b&&b.exports===g&&m.process,y=function(){try{return w&&w.binding("util")}catch(t){}}(),x=y&&y.isTypedArray;function M(t,e,i,n){for(var s=-1,r=t?t.length:0;++s<r;){var o=t[s];e(n,o,i(o),t)}return n}function T(t,e){for(var i=-1,n=t?t.length:0;++i<n;)if(e(t[i],i,t))return!0;return!1}function O(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function E(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function A(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var S,k,I,C=Array.prototype,j=Function.prototype,D=Object.prototype,R=v["__core-js_shared__"],P=(S=/[^.]+$/.exec(R&&R.keys&&R.keys.IE_PROTO||""))?"Symbol(src)_1."+S:"",N=j.toString,F=D.hasOwnProperty,z=D.toString,L=RegExp("^"+N.call(F).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$=v.Symbol,U=v.Uint8Array,B=D.propertyIsEnumerable,G=C.splice,H=(k=Object.keys,I=Object,function(t){return k(I(t))}),V=Ot(v,"DataView"),W=Ot(v,"Map"),q=Ot(v,"Promise"),Y=Ot(v,"Set"),X=Ot(v,"WeakMap"),Z=Ot(Object,"create"),J=Dt(V),K=Dt(W),Q=Dt(q),tt=Dt(Y),et=Dt(X),it=$?$.prototype:void 0,nt=it?it.valueOf:void 0,st=it?it.toString:void 0;function rt(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function ot(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function at(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function ht(t){var e=-1,i=t?t.length:0;for(this.__data__=new at;++e<i;)this.add(t[e])}function ct(t){this.__data__=new ot(t)}function ut(t,e){var i=Lt(t)||zt(t)?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],n=i.length,s=!!n;for(var r in t)!e&&!F.call(t,r)||s&&("length"==r||At(r,n))||i.push(r);return i}function lt(t,e){for(var i=t.length;i--;)if(Ft(t[i][0],e))return i;return-1}function ft(t,e,i,n){return pt(t,(function(t,s,r){e(n,t,i(t),r)})),n}rt.prototype.clear=function(){this.__data__=Z?Z(null):{}},rt.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},rt.prototype.get=function(t){var e=this.__data__;if(Z){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return F.call(e,t)?e[t]:void 0},rt.prototype.has=function(t){var e=this.__data__;return Z?void 0!==e[t]:F.call(e,t)},rt.prototype.set=function(t,e){return this.__data__[t]=Z&&void 0===e?"__lodash_hash_undefined__":e,this},ot.prototype.clear=function(){this.__data__=[]},ot.prototype.delete=function(t){var e=this.__data__,i=lt(e,t);return!(i<0)&&(i==e.length-1?e.pop():G.call(e,i,1),!0)},ot.prototype.get=function(t){var e=this.__data__,i=lt(e,t);return i<0?void 0:e[i][1]},ot.prototype.has=function(t){return lt(this.__data__,t)>-1},ot.prototype.set=function(t,e){var i=this.__data__,n=lt(i,t);return n<0?i.push([t,e]):i[n][1]=e,this},at.prototype.clear=function(){this.__data__={hash:new rt,map:new(W||ot),string:new rt}},at.prototype.delete=function(t){return Tt(this,t).delete(t)},at.prototype.get=function(t){return Tt(this,t).get(t)},at.prototype.has=function(t){return Tt(this,t).has(t)},at.prototype.set=function(t,e){return Tt(this,t).set(t,e),this},ht.prototype.add=ht.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},ht.prototype.has=function(t){return this.__data__.has(t)},ct.prototype.clear=function(){this.__data__=new ot},ct.prototype.delete=function(t){return this.__data__.delete(t)},ct.prototype.get=function(t){return this.__data__.get(t)},ct.prototype.has=function(t){return this.__data__.has(t)},ct.prototype.set=function(t,e){var i=this.__data__;if(i instanceof ot){var n=i.__data__;if(!W||n.length<199)return n.push([t,e]),this;i=this.__data__=new at(n)}return i.set(t,e),this};var dt,pt=(dt=function(t,e){return t&&mt(t,e,qt)},function(t,e){if(null==t)return t;if(!$t(t))return dt(t,e);for(var i=t.length,n=-1,s=Object(t);++n<i&&!1!==e(s[n],n,s););return t}),mt=function(t){return function(e,i,n){for(var s=-1,r=Object(e),o=n(e),a=o.length;a--;){var h=o[t?a:++s];if(!1===i(r[h],h,r))break}return e}}();function _t(t,e){for(var i=0,n=(e=St(e,t)?[e]:xt(e)).length;null!=t&&i<n;)t=t[jt(e[i++])];return i&&i==n?t:void 0}function vt(t,e){return null!=t&&e in Object(t)}function gt(t,e,i,a,h){return t===e||(null==t||null==e||!Gt(t)&&!Ht(e)?t!=t&&e!=e:function(t,e,i,a,h,c){var u=Lt(t),l=Lt(e),f="[object Array]",d="[object Array]";u||(f=(f=Et(t))==n?r:f);l||(d=(d=Et(e))==n?r:d);var p=f==r&&!O(t),m=d==r&&!O(e),_=f==d;if(_&&!p)return c||(c=new ct),u||Wt(t)?Mt(t,e,i,a,h,c):function(t,e,i,n,r,a,h){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!n(new U(t),new U(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ft(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case s:var c=E;case o:var u=2&a;if(c||(c=A),t.size!=e.size&&!u)return!1;var l=h.get(t);if(l)return l==e;a|=1,h.set(t,e);var f=Mt(c(t),c(e),n,r,a,h);return h.delete(t),f;case"[object Symbol]":if(nt)return nt.call(t)==nt.call(e)}return!1}(t,e,f,i,a,h,c);if(!(2&h)){var v=p&&F.call(t,"__wrapped__"),g=m&&F.call(e,"__wrapped__");if(v||g){var b=v?t.value():t,w=g?e.value():e;return c||(c=new ct),i(b,w,a,h,c)}}if(!_)return!1;return c||(c=new ct),function(t,e,i,n,s,r){var o=2&s,a=qt(t),h=a.length,c=qt(e).length;if(h!=c&&!o)return!1;var u=h;for(;u--;){var l=a[u];if(!(o?l in e:F.call(e,l)))return!1}var f=r.get(t);if(f&&r.get(e))return f==e;var d=!0;r.set(t,e),r.set(e,t);var p=o;for(;++u<h;){l=a[u];var m=t[l],_=e[l];if(n)var v=o?n(_,m,l,e,t,r):n(m,_,l,t,e,r);if(!(void 0===v?m===_||i(m,_,n,s,r):v)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var g=t.constructor,b=e.constructor;g==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(d=!1)}return r.delete(t),r.delete(e),d}(t,e,i,a,h,c)}(t,e,gt,i,a,h))}function bt(t){return!(!Gt(t)||function(t){return!!P&&P in t}(t))&&(Ut(t)||O(t)?L:f).test(Dt(t))}function wt(t){return"function"==typeof t?t:null==t?Yt:"object"==typeof t?Lt(t)?function(t,e){if(St(t)&&kt(e))return It(jt(t),e);return function(i){var n=function(t,e,i){var n=null==t?void 0:_t(t,e);return void 0===n?i:n}(i,t);return void 0===n&&n===e?function(t,e){return null!=t&&function(t,e,i){e=St(e,t)?[e]:xt(e);var n,s=-1,r=e.length;for(;++s<r;){var o=jt(e[s]);if(!(n=null!=t&&i(t,o)))break;t=t[o]}if(n)return n;return!!(r=t?t.length:0)&&Bt(r)&&At(o,r)&&(Lt(t)||zt(t))}(t,e,vt)}(i,t):gt(e,n,void 0,3)}}(t[0],t[1]):function(t){var e=function(t){var e=qt(t),i=e.length;for(;i--;){var n=e[i],s=t[n];e[i]=[n,s,kt(s)]}return e}(t);if(1==e.length&&e[0][2])return It(e[0][0],e[0][1]);return function(i){return i===t||function(t,e,i,n){var s=i.length,r=s,o=!n;if(null==t)return!r;for(t=Object(t);s--;){var a=i[s];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<r;){var h=(a=i[s])[0],c=t[h],u=a[1];if(o&&a[2]){if(void 0===c&&!(h in t))return!1}else{var l=new ct;if(n)var f=n(c,u,h,t,e,l);if(!(void 0===f?gt(u,c,n,3,l):f))return!1}}return!0}(i,t,e)}}(t):St(e=t)?(i=jt(e),function(t){return null==t?void 0:t[i]}):function(t){return function(e){return _t(e,t)}}(e);var e,i}function yt(t){if(i=(e=t)&&e.constructor,n="function"==typeof i&&i.prototype||D,e!==n)return H(t);var e,i,n,s=[];for(var r in Object(t))F.call(t,r)&&"constructor"!=r&&s.push(r);return s}function xt(t){return Lt(t)?t:Ct(t)}function Mt(t,e,i,n,s,r){var o=2&s,a=t.length,h=e.length;if(a!=h&&!(o&&h>a))return!1;var c=r.get(t);if(c&&r.get(e))return c==e;var u=-1,l=!0,f=1&s?new ht:void 0;for(r.set(t,e),r.set(e,t);++u<a;){var d=t[u],p=e[u];if(n)var m=o?n(p,d,u,e,t,r):n(d,p,u,t,e,r);if(void 0!==m){if(m)continue;l=!1;break}if(f){if(!T(e,(function(t,e){if(!f.has(e)&&(d===t||i(d,t,n,s,r)))return f.add(e)}))){l=!1;break}}else if(d!==p&&!i(d,p,n,s,r)){l=!1;break}}return r.delete(t),r.delete(e),l}function Tt(t,e){var i,n,s=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?s["string"==typeof e?"string":"hash"]:s.map}function Ot(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return bt(i)?i:void 0}var Et=function(t){return z.call(t)};function At(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||d.test(t))&&t>-1&&t%1==0&&t<e}function St(t,e){if(Lt(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!Vt(t))||(h.test(t)||!a.test(t)||null!=e&&t in Object(e))}function kt(t){return t==t&&!Gt(t)}function It(t,e){return function(i){return null!=i&&(i[t]===e&&(void 0!==e||t in Object(i)))}}(V&&"[object DataView]"!=Et(new V(new ArrayBuffer(1)))||W&&Et(new W)!=s||q&&"[object Promise]"!=Et(q.resolve())||Y&&Et(new Y)!=o||X&&"[object WeakMap]"!=Et(new X))&&(Et=function(t){var e=z.call(t),i=e==r?t.constructor:void 0,n=i?Dt(i):void 0;if(n)switch(n){case J:return"[object DataView]";case K:return s;case Q:return"[object Promise]";case tt:return o;case et:return"[object WeakMap]"}return e});var Ct=Nt((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(Vt(t))return st?st.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var i=[];return c.test(t)&&i.push(""),t.replace(u,(function(t,e,n,s){i.push(n?s.replace(l,"$1"):e||t)})),i}));function jt(t){if("string"==typeof t||Vt(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Dt(t){if(null!=t){try{return N.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var Rt,Pt=(Rt=function(t,e,i){F.call(t,i)?t[i].push(e):t[i]=[e]},function(t,e){var i=Lt(t)?M:ft,n={};return i(t,Rt,wt(e),n)});function Nt(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var n=arguments,s=e?e.apply(this,n):n[0],r=i.cache;if(r.has(s))return r.get(s);var o=t.apply(this,n);return i.cache=r.set(s,o),o};return i.cache=new(Nt.Cache||at),i}function Ft(t,e){return t===e||t!=t&&e!=e}function zt(t){return function(t){return Ht(t)&&$t(t)}(t)&&F.call(t,"callee")&&(!B.call(t,"callee")||z.call(t)==n)}Nt.Cache=at;var Lt=Array.isArray;function $t(t){return null!=t&&Bt(t.length)&&!Ut(t)}function Ut(t){var e=Gt(t)?z.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}function Bt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function Gt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Ht(t){return!!t&&"object"==typeof t}function Vt(t){return"symbol"==typeof t||Ht(t)&&"[object Symbol]"==z.call(t)}var Wt=x?function(t){return function(e){return t(e)}}(x):function(t){return Ht(t)&&Bt(t.length)&&!!p[z.call(t)]};function qt(t){return $t(t)?ut(t):yt(t)}function Yt(t){return t}e.exports=Pt}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],444:[function(t,e,i){var n=Object.prototype.toString;e.exports=function(t){return!0===t||!1===t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Boolean]"==n.call(t)}},{}],445:[function(t,e,i){(function(t){(function(){var n="[object Arguments]",s="[object Map]",r="[object Object]",o="[object Set]",a=/^\[object .+?Constructor\]$/,h=/^(?:0|[1-9]\d*)$/,c={};c["[object Float32Array]"]=c["[object Float64Array]"]=c["[object Int8Array]"]=c["[object Int16Array]"]=c["[object Int32Array]"]=c["[object Uint8Array]"]=c["[object Uint8ClampedArray]"]=c["[object Uint16Array]"]=c["[object Uint32Array]"]=!0,c[n]=c["[object Array]"]=c["[object ArrayBuffer]"]=c["[object Boolean]"]=c["[object DataView]"]=c["[object Date]"]=c["[object Error]"]=c["[object Function]"]=c[s]=c["[object Number]"]=c[r]=c["[object RegExp]"]=c[o]=c["[object String]"]=c["[object WeakMap]"]=!1;var u="object"==typeof t&&t&&t.Object===Object&&t,l="object"==typeof self&&self&&self.Object===Object&&self,f=u||l||Function("return this")(),d="object"==typeof i&&i&&!i.nodeType&&i,p=d&&"object"==typeof e&&e&&!e.nodeType&&e,m=p&&p.exports===d,_=m&&u.process,v=function(){try{return _&&_.binding&&_.binding("util")}catch(t){}}(),g=v&&v.isTypedArray;function b(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function w(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}function y(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var x,M,T,O=Array.prototype,E=Function.prototype,A=Object.prototype,S=f["__core-js_shared__"],k=E.toString,I=A.hasOwnProperty,C=(x=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+x:"",j=A.toString,D=RegExp("^"+k.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),R=m?f.Buffer:void 0,P=f.Symbol,N=f.Uint8Array,F=A.propertyIsEnumerable,z=O.splice,L=P?P.toStringTag:void 0,$=Object.getOwnPropertySymbols,U=R?R.isBuffer:void 0,B=(M=Object.keys,T=Object,function(t){return M(T(t))}),G=vt(f,"DataView"),H=vt(f,"Map"),V=vt(f,"Promise"),W=vt(f,"Set"),q=vt(f,"WeakMap"),Y=vt(Object,"create"),X=yt(G),Z=yt(H),J=yt(V),K=yt(W),Q=yt(q),tt=P?P.prototype:void 0,et=tt?tt.valueOf:void 0;function it(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function nt(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function st(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function rt(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new st;++e<i;)this.add(t[e])}function ot(t){var e=this.__data__=new nt(t);this.size=e.size}function at(t,e){var i=Tt(t),n=!i&&Mt(t),s=!i&&!n&&Ot(t),r=!i&&!n&&!s&&It(t),o=i||n||s||r,a=o?function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}(t.length,String):[],h=a.length;for(var c in t)!e&&!I.call(t,c)||o&&("length"==c||s&&("offset"==c||"parent"==c)||r&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||wt(c,h))||a.push(c);return a}function ht(t,e){for(var i=t.length;i--;)if(xt(t[i][0],e))return i;return-1}function ct(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":L&&L in Object(t)?function(t){var e=I.call(t,L),i=t[L];try{t[L]=void 0;var n=!0}catch(t){}var s=j.call(t);n&&(e?t[L]=i:delete t[L]);return s}(t):function(t){return j.call(t)}(t)}function ut(t){return kt(t)&&ct(t)==n}function lt(t,e,i,a,h){return t===e||(null==t||null==e||!kt(t)&&!kt(e)?t!=t&&e!=e:function(t,e,i,a,h,c){var u=Tt(t),l=Tt(e),f=u?"[object Array]":bt(t),d=l?"[object Array]":bt(e),p=(f=f==n?r:f)==r,m=(d=d==n?r:d)==r,_=f==d;if(_&&Ot(t)){if(!Ot(e))return!1;u=!0,p=!1}if(_&&!p)return c||(c=new ot),u||It(t)?pt(t,e,i,a,h,c):function(t,e,i,n,r,a,h){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!a(new N(t),new N(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return xt(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case s:var c=w;case o:var u=1&n;if(c||(c=y),t.size!=e.size&&!u)return!1;var l=h.get(t);if(l)return l==e;n|=2,h.set(t,e);var f=pt(c(t),c(e),n,r,a,h);return h.delete(t),f;case"[object Symbol]":if(et)return et.call(t)==et.call(e)}return!1}(t,e,f,i,a,h,c);if(!(1&i)){var v=p&&I.call(t,"__wrapped__"),g=m&&I.call(e,"__wrapped__");if(v||g){var b=v?t.value():t,x=g?e.value():e;return c||(c=new ot),h(b,x,i,a,c)}}if(!_)return!1;return c||(c=new ot),function(t,e,i,n,s,r){var o=1&i,a=mt(t),h=a.length,c=mt(e).length;if(h!=c&&!o)return!1;var u=h;for(;u--;){var l=a[u];if(!(o?l in e:I.call(e,l)))return!1}var f=r.get(t);if(f&&r.get(e))return f==e;var d=!0;r.set(t,e),r.set(e,t);var p=o;for(;++u<h;){l=a[u];var m=t[l],_=e[l];if(n)var v=o?n(_,m,l,e,t,r):n(m,_,l,t,e,r);if(!(void 0===v?m===_||s(m,_,i,n,r):v)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var g=t.constructor,b=e.constructor;g==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b||(d=!1)}return r.delete(t),r.delete(e),d}(t,e,i,a,h,c)}(t,e,i,a,lt,h))}function ft(t){return!(!St(t)||function(t){return!!C&&C in t}(t))&&(Et(t)?D:a).test(yt(t))}function dt(t){if(i=(e=t)&&e.constructor,n="function"==typeof i&&i.prototype||A,e!==n)return B(t);var e,i,n,s=[];for(var r in Object(t))I.call(t,r)&&"constructor"!=r&&s.push(r);return s}function pt(t,e,i,n,s,r){var o=1&i,a=t.length,h=e.length;if(a!=h&&!(o&&h>a))return!1;var c=r.get(t);if(c&&r.get(e))return c==e;var u=-1,l=!0,f=2&i?new rt:void 0;for(r.set(t,e),r.set(e,t);++u<a;){var d=t[u],p=e[u];if(n)var m=o?n(p,d,u,e,t,r):n(d,p,u,t,e,r);if(void 0!==m){if(m)continue;l=!1;break}if(f){if(!b(e,(function(t,e){if(o=e,!f.has(o)&&(d===t||s(d,t,i,n,r)))return f.push(e);var o}))){l=!1;break}}else if(d!==p&&!s(d,p,i,n,r)){l=!1;break}}return r.delete(t),r.delete(e),l}function mt(t){return function(t,e,i){var n=e(t);return Tt(t)?n:function(t,e){for(var i=-1,n=e.length,s=t.length;++i<n;)t[s+i]=e[i];return t}(n,i(t))}(t,Ct,gt)}function _t(t,e){var i,n,s=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?s["string"==typeof e?"string":"hash"]:s.map}function vt(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return ft(i)?i:void 0}it.prototype.clear=function(){this.__data__=Y?Y(null):{},this.size=0},it.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},it.prototype.get=function(t){var e=this.__data__;if(Y){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return I.call(e,t)?e[t]:void 0},it.prototype.has=function(t){var e=this.__data__;return Y?void 0!==e[t]:I.call(e,t)},it.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Y&&void 0===e?"__lodash_hash_undefined__":e,this},nt.prototype.clear=function(){this.__data__=[],this.size=0},nt.prototype.delete=function(t){var e=this.__data__,i=ht(e,t);return!(i<0)&&(i==e.length-1?e.pop():z.call(e,i,1),--this.size,!0)},nt.prototype.get=function(t){var e=this.__data__,i=ht(e,t);return i<0?void 0:e[i][1]},nt.prototype.has=function(t){return ht(this.__data__,t)>-1},nt.prototype.set=function(t,e){var i=this.__data__,n=ht(i,t);return n<0?(++this.size,i.push([t,e])):i[n][1]=e,this},st.prototype.clear=function(){this.size=0,this.__data__={hash:new it,map:new(H||nt),string:new it}},st.prototype.delete=function(t){var e=_t(this,t).delete(t);return this.size-=e?1:0,e},st.prototype.get=function(t){return _t(this,t).get(t)},st.prototype.has=function(t){return _t(this,t).has(t)},st.prototype.set=function(t,e){var i=_t(this,t),n=i.size;return i.set(t,e),this.size+=i.size==n?0:1,this},rt.prototype.add=rt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},rt.prototype.has=function(t){return this.__data__.has(t)},ot.prototype.clear=function(){this.__data__=new nt,this.size=0},ot.prototype.delete=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i},ot.prototype.get=function(t){return this.__data__.get(t)},ot.prototype.has=function(t){return this.__data__.has(t)},ot.prototype.set=function(t,e){var i=this.__data__;if(i instanceof nt){var n=i.__data__;if(!H||n.length<199)return n.push([t,e]),this.size=++i.size,this;i=this.__data__=new st(n)}return i.set(t,e),this.size=i.size,this};var gt=$?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var i=-1,n=null==t?0:t.length,s=0,r=[];++i<n;){var o=t[i];e(o,i,t)&&(r[s++]=o)}return r}($(t),(function(e){return F.call(t,e)})))}:function(){return[]},bt=ct;function wt(t,e){return!!(e=null==e?9007199254740991:e)&&("number"==typeof t||h.test(t))&&t>-1&&t%1==0&&t<e}function yt(t){if(null!=t){try{return k.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function xt(t,e){return t===e||t!=t&&e!=e}(G&&"[object DataView]"!=bt(new G(new ArrayBuffer(1)))||H&&bt(new H)!=s||V&&"[object Promise]"!=bt(V.resolve())||W&&bt(new W)!=o||q&&"[object WeakMap]"!=bt(new q))&&(bt=function(t){var e=ct(t),i=e==r?t.constructor:void 0,n=i?yt(i):"";if(n)switch(n){case X:return"[object DataView]";case Z:return s;case J:return"[object Promise]";case K:return o;case Q:return"[object WeakMap]"}return e});var Mt=ut(function(){return arguments}())?ut:function(t){return kt(t)&&I.call(t,"callee")&&!F.call(t,"callee")},Tt=Array.isArray;var Ot=U||function(){return!1};function Et(t){if(!St(t))return!1;var e=ct(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function At(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function St(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function kt(t){return null!=t&&"object"==typeof t}var It=g?function(t){return function(e){return t(e)}}(g):function(t){return kt(t)&&At(t.length)&&!!c[ct(t)]};function Ct(t){return null!=(e=t)&&At(e.length)&&!Et(e)?at(t):dt(t);var e}e.exports=function(t,e){return lt(t,e)}}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],446:[function(t,e,i){(function(t){(function(){var i="object"==typeof t&&t&&t.Object===Object&&t,n="object"==typeof self&&self&&self.Object===Object&&self,s=i||n||Function("return this")(),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,h=s.Symbol,c=h?h.toStringTag:void 0;function u(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":c&&c in Object(t)?function(t){var e=o.call(t,c),i=t[c];try{t[c]=void 0;var n=!0}catch(t){}var s=a.call(t);n&&(e?t[c]=i:delete t[c]);return s}(t):function(t){return a.call(t)}(t)}e.exports=function(t){if(!function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}(t))return!1;var e=u(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],447:[function(t,e,i){e.exports=function(t){return null==t}},{}],448:[function(t,e,i){e.exports=function(t){return void 0===t}},{}],449:[function(t,e,i){(function(t){(function(){var i=/^\[object .+?Constructor\]$/,n="object"==typeof t&&t&&t.Object===Object&&t,s="object"==typeof self&&self&&self.Object===Object&&self,r=n||s||Function("return this")();function o(t,e){return!!(t?t.length:0)&&function(t,e,i){if(e!=e)return function(t,e,i,n){var s=t.length,r=i+(n?1:-1);for(;n?r--:++r<s;)if(e(t[r],r,t))return r;return-1}(t,h,i);var n=i-1,s=t.length;for(;++n<s;)if(t[n]===e)return n;return-1}(t,e,0)>-1}function a(t,e,i){for(var n=-1,s=t?t.length:0;++n<s;)if(i(e,t[n]))return!0;return!1}function h(t){return t!=t}function c(t,e){return t.has(e)}function u(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}var l,f=Array.prototype,d=Function.prototype,p=Object.prototype,m=r["__core-js_shared__"],_=(l=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"",v=d.toString,g=p.hasOwnProperty,b=p.toString,w=RegExp("^"+v.call(g).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),y=f.splice,x=D(r,"Map"),M=D(r,"Set"),T=D(Object,"create");function O(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function E(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function A(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}function S(t){var e=-1,i=t?t.length:0;for(this.__data__=new A;++e<i;)this.add(t[e])}function k(t,e){for(var i,n,s=t.length;s--;)if((i=t[s][0])===(n=e)||i!=i&&n!=n)return s;return-1}function I(t){return!(!R(t)||(e=t,_&&_ in e))&&(function(t){var e=R(t)?b.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?w:i).test(function(t){if(null!=t){try{return v.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}O.prototype.clear=function(){this.__data__=T?T(null):{}},O.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},O.prototype.get=function(t){var e=this.__data__;if(T){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return g.call(e,t)?e[t]:void 0},O.prototype.has=function(t){var e=this.__data__;return T?void 0!==e[t]:g.call(e,t)},O.prototype.set=function(t,e){return this.__data__[t]=T&&void 0===e?"__lodash_hash_undefined__":e,this},E.prototype.clear=function(){this.__data__=[]},E.prototype.delete=function(t){var e=this.__data__,i=k(e,t);return!(i<0)&&(i==e.length-1?e.pop():y.call(e,i,1),!0)},E.prototype.get=function(t){var e=this.__data__,i=k(e,t);return i<0?void 0:e[i][1]},E.prototype.has=function(t){return k(this.__data__,t)>-1},E.prototype.set=function(t,e){var i=this.__data__,n=k(i,t);return n<0?i.push([t,e]):i[n][1]=e,this},A.prototype.clear=function(){this.__data__={hash:new O,map:new(x||E),string:new O}},A.prototype.delete=function(t){return j(this,t).delete(t)},A.prototype.get=function(t){return j(this,t).get(t)},A.prototype.has=function(t){return j(this,t).has(t)},A.prototype.set=function(t,e){return j(this,t).set(t,e),this},S.prototype.add=S.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},S.prototype.has=function(t){return this.__data__.has(t)};var C=M&&1/u(new M([,-0]))[1]==1/0?function(t){return new M(t)}:function(){};function j(t,e){var i,n,s=t.__data__;return("string"==(n=typeof(i=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?s["string"==typeof e?"string":"hash"]:s.map}function D(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return I(i)?i:void 0}function R(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=function(t){return t&&t.length?function(t,e,i){var n=-1,s=o,r=t.length,h=!0,l=[],f=l;if(i)h=!1,s=a;else if(r>=200){var d=e?null:C(t);if(d)return u(d);h=!1,s=c,f=new S}else f=e?[]:l;t:for(;++n<r;){var p=t[n],m=e?e(p):p;if(p=i||0!==p?p:0,h&&m==m){for(var _=f.length;_--;)if(f[_]===m)continue t;e&&f.push(m),l.push(p)}else s(f,m,i)||(f!==l&&f.push(m),l.push(p))}return l}(t):[]}}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],450:[function(t,e,i){var n=t("inherits"),s=t("hash-base"),r=t("safe-buffer").Buffer,o=new Array(16);function a(){s.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function h(t,e){return t<<e|t>>>32-e}function c(t,e,i,n,s,r,o){return h(t+(e&i|~e&n)+s+r|0,o)+e|0}function u(t,e,i,n,s,r,o){return h(t+(e&n|i&~n)+s+r|0,o)+e|0}function l(t,e,i,n,s,r,o){return h(t+(e^i^n)+s+r|0,o)+e|0}function f(t,e,i,n,s,r,o){return h(t+(i^(e|~n))+s+r|0,o)+e|0}n(a,s),a.prototype._update=function(){for(var t=o,e=0;e<16;++e)t[e]=this._block.readInt32LE(4*e);var i=this._a,n=this._b,s=this._c,r=this._d;i=c(i,n,s,r,t[0],3614090360,7),r=c(r,i,n,s,t[1],3905402710,12),s=c(s,r,i,n,t[2],606105819,17),n=c(n,s,r,i,t[3],3250441966,22),i=c(i,n,s,r,t[4],4118548399,7),r=c(r,i,n,s,t[5],1200080426,12),s=c(s,r,i,n,t[6],2821735955,17),n=c(n,s,r,i,t[7],4249261313,22),i=c(i,n,s,r,t[8],1770035416,7),r=c(r,i,n,s,t[9],2336552879,12),s=c(s,r,i,n,t[10],4294925233,17),n=c(n,s,r,i,t[11],2304563134,22),i=c(i,n,s,r,t[12],1804603682,7),r=c(r,i,n,s,t[13],4254626195,12),s=c(s,r,i,n,t[14],2792965006,17),i=u(i,n=c(n,s,r,i,t[15],1236535329,22),s,r,t[1],4129170786,5),r=u(r,i,n,s,t[6],3225465664,9),s=u(s,r,i,n,t[11],643717713,14),n=u(n,s,r,i,t[0],3921069994,20),i=u(i,n,s,r,t[5],3593408605,5),r=u(r,i,n,s,t[10],38016083,9),s=u(s,r,i,n,t[15],3634488961,14),n=u(n,s,r,i,t[4],3889429448,20),i=u(i,n,s,r,t[9],568446438,5),r=u(r,i,n,s,t[14],3275163606,9),s=u(s,r,i,n,t[3],4107603335,14),n=u(n,s,r,i,t[8],1163531501,20),i=u(i,n,s,r,t[13],2850285829,5),r=u(r,i,n,s,t[2],4243563512,9),s=u(s,r,i,n,t[7],1735328473,14),i=l(i,n=u(n,s,r,i,t[12],2368359562,20),s,r,t[5],4294588738,4),r=l(r,i,n,s,t[8],2272392833,11),s=l(s,r,i,n,t[11],1839030562,16),n=l(n,s,r,i,t[14],4259657740,23),i=l(i,n,s,r,t[1],2763975236,4),r=l(r,i,n,s,t[4],1272893353,11),s=l(s,r,i,n,t[7],4139469664,16),n=l(n,s,r,i,t[10],3200236656,23),i=l(i,n,s,r,t[13],681279174,4),r=l(r,i,n,s,t[0],3936430074,11),s=l(s,r,i,n,t[3],3572445317,16),n=l(n,s,r,i,t[6],76029189,23),i=l(i,n,s,r,t[9],3654602809,4),r=l(r,i,n,s,t[12],3873151461,11),s=l(s,r,i,n,t[15],530742520,16),i=f(i,n=l(n,s,r,i,t[2],3299628645,23),s,r,t[0],4096336452,6),r=f(r,i,n,s,t[7],1126891415,10),s=f(s,r,i,n,t[14],2878612391,15),n=f(n,s,r,i,t[5],4237533241,21),i=f(i,n,s,r,t[12],1700485571,6),r=f(r,i,n,s,t[3],2399980690,10),s=f(s,r,i,n,t[10],4293915773,15),n=f(n,s,r,i,t[1],2240044497,21),i=f(i,n,s,r,t[8],1873313359,6),r=f(r,i,n,s,t[15],4264355552,10),s=f(s,r,i,n,t[6],2734768916,15),n=f(n,s,r,i,t[13],1309151649,21),i=f(i,n,s,r,t[4],4149444226,6),r=f(r,i,n,s,t[11],3174756917,10),s=f(s,r,i,n,t[2],718787259,15),n=f(n,s,r,i,t[9],3951481745,21),this._a=this._a+i|0,this._b=this._b+n|0,this._c=this._c+s|0,this._d=this._d+r|0},a.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var t=r.allocUnsafe(16);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t},e.exports=a},{"hash-base":425,inherits:440,"safe-buffer":494}],451:[function(t,e,i){var n=t("bn.js"),s=t("brorand");function r(t){this.rand=t||new s.Rand}e.exports=r,r.create=function(t){return new r(t)},r.prototype._randbelow=function(t){var e=t.bitLength(),i=Math.ceil(e/8);do{var s=new n(this.rand.generate(i))}while(s.cmp(t)>=0);return s},r.prototype._randrange=function(t,e){var i=e.sub(t);return t.add(this._randbelow(i))},r.prototype.test=function(t,e,i){var s=t.bitLength(),r=n.mont(t),o=new n(1).toRed(r);e||(e=Math.max(1,s/48|0));for(var a=t.subn(1),h=0;!a.testn(h);h++);for(var c=t.shrn(h),u=a.toRed(r);e>0;e--){var l=this._randrange(new n(2),a);i&&i(l);var f=l.toRed(r).redPow(c);if(0!==f.cmp(o)&&0!==f.cmp(u)){for(var d=1;d<h;d++){if(0===(f=f.redSqr()).cmp(o))return!1;if(0===f.cmp(u))break}if(d===h)return!1}}return!0},r.prototype.getDivisor=function(t,e){var i=t.bitLength(),s=n.mont(t),r=new n(1).toRed(s);e||(e=Math.max(1,i/48|0));for(var o=t.subn(1),a=0;!o.testn(a);a++);for(var h=t.shrn(a),c=o.toRed(s);e>0;e--){var u=this._randrange(new n(2),o),l=t.gcd(u);if(0!==l.cmpn(1))return l;var f=u.toRed(s).redPow(h);if(0!==f.cmp(r)&&0!==f.cmp(c)){for(var d=1;d<a;d++){if(0===(f=f.redSqr()).cmp(r))return f.fromRed().subn(1).gcd(t);if(0===f.cmp(c))break}if(d===a)return(f=f.redSqr()).fromRed().subn(1).gcd(t)}}return!1}},{"bn.js":452,brorand:187}],452:[function(t,e,i){arguments[4][184][0].apply(i,arguments)},{buffer:188,dup:184}],453:[function(t,e,i){function n(t,e){if(!t)throw new Error(e||"Assertion failed")}e.exports=n,n.equal=function(t,e,i){if(t!=e)throw new Error(i||"Assertion failed: "+t+" != "+e)}},{}],454:[function(t,e,i){var n=i;function s(t){return 1===t.length?"0"+t:t}function r(t){for(var e="",i=0;i<t.length;i++)e+=s(t[i].toString(16));return e}n.toArray=function(t,e){if(Array.isArray(t))return t.slice();if(!t)return[];var i=[];if("string"!=typeof t){for(var n=0;n<t.length;n++)i[n]=0|t[n];return i}if("hex"===e){(t=t.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(t="0"+t);for(n=0;n<t.length;n+=2)i.push(parseInt(t[n]+t[n+1],16))}else for(n=0;n<t.length;n++){var s=t.charCodeAt(n),r=s>>8,o=255&s;r?i.push(r,o):i.push(o)}return i},n.zero2=s,n.toHex=r,n.encode=function(t,e){return"hex"===e?r(t):t}},{}],455:[function(t,e,i){e.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},{}],456:[function(t,e,i){var n=t("asn1.js");i.certificate=t("./certificate");var s=n.define("RSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}));i.RSAPrivateKey=s;var r=n.define("RSAPublicKey",(function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}));i.RSAPublicKey=r;var o=n.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(a),this.key("subjectPublicKey").bitstr())}));i.PublicKey=o;var a=n.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())})),h=n.define("PrivateKeyInfo",(function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(a),this.key("subjectPrivateKey").octstr())}));i.PrivateKey=h;var c=n.define("EncryptedPrivateKeyInfo",(function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}));i.EncryptedPrivateKey=c;var u=n.define("DSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}));i.DSAPrivateKey=u,i.DSAparam=n.define("DSAparam",(function(){this.int()}));var l=n.define("ECPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(f),this.key("publicKey").optional().explicit(1).bitstr())}));i.ECPrivateKey=l;var f=n.define("ECParameters",(function(){this.choice({namedCurve:this.objid()})}));i.signature=n.define("signature",(function(){this.seq().obj(this.key("r").int(),this.key("s").int())}))},{"./certificate":457,"asn1.js":170}],457:[function(t,e,i){var n=t("asn1.js"),s=n.define("Time",(function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})),r=n.define("AttributeTypeValue",(function(){this.seq().obj(this.key("type").objid(),this.key("value").any())})),o=n.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())})),a=n.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())})),h=n.define("RelativeDistinguishedName",(function(){this.setof(r)})),c=n.define("RDNSequence",(function(){this.seqof(h)})),u=n.define("Name",(function(){this.choice({rdnSequence:this.use(c)})})),l=n.define("Validity",(function(){this.seq().obj(this.key("notBefore").use(s),this.key("notAfter").use(s))})),f=n.define("Extension",(function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())})),d=n.define("TBSCertificate",(function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(o),this.key("issuer").use(u),this.key("validity").use(l),this.key("subject").use(u),this.key("subjectPublicKeyInfo").use(a),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(f).optional())})),p=n.define("X509Certificate",(function(){this.seq().obj(this.key("tbsCertificate").use(d),this.key("signatureAlgorithm").use(o),this.key("signatureValue").bitstr())}));e.exports=p},{"asn1.js":170}],458:[function(t,e,i){var n=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,s=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,r=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,o=t("evp_bytestokey"),a=t("browserify-aes"),h=t("safe-buffer").Buffer;e.exports=function(t,e){var i,c=t.toString(),u=c.match(n);if(u){var l="aes"+u[1],f=h.from(u[2],"hex"),d=h.from(u[3].replace(/[\r\n]/g,""),"base64"),p=o(e,f.slice(0,8),parseInt(u[1],10)).key,m=[],_=a.createDecipheriv(l,p,f);m.push(_.update(d)),m.push(_.final()),i=h.concat(m)}else{var v=c.match(r);i=h.from(v[2].replace(/[\r\n]/g,""),"base64")}return{tag:c.match(s)[1],data:i}}},{"browserify-aes":191,evp_bytestokey:423,"safe-buffer":494}],459:[function(t,e,i){var n=t("./asn1"),s=t("./aesid.json"),r=t("./fixProc"),o=t("browserify-aes"),a=t("pbkdf2"),h=t("safe-buffer").Buffer;function c(t){var e;"object"!=typeof t||h.isBuffer(t)||(e=t.passphrase,t=t.key),"string"==typeof t&&(t=h.from(t));var i,c,u=r(t,e),l=u.tag,f=u.data;switch(l){case"CERTIFICATE":c=n.certificate.decode(f,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(c||(c=n.PublicKey.decode(f,"der")),i=c.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return n.RSAPublicKey.decode(c.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return c.subjectPrivateKey=c.subjectPublicKey,{type:"ec",data:c};case"1.2.840.10040.4.1":return c.algorithm.params.pub_key=n.DSAparam.decode(c.subjectPublicKey.data,"der"),{type:"dsa",data:c.algorithm.params};default:throw new Error("unknown key id "+i)}case"ENCRYPTED PRIVATE KEY":f=function(t,e){var i=t.algorithm.decrypt.kde.kdeparams.salt,n=parseInt(t.algorithm.decrypt.kde.kdeparams.iters.toString(),10),r=s[t.algorithm.decrypt.cipher.algo.join(".")],c=t.algorithm.decrypt.cipher.iv,u=t.subjectPrivateKey,l=parseInt(r.split("-")[1],10)/8,f=a.pbkdf2Sync(e,i,n,l,"sha1"),d=o.createDecipheriv(r,f,c),p=[];return p.push(d.update(u)),p.push(d.final()),h.concat(p)}(f=n.EncryptedPrivateKey.decode(f,"der"),e);case"PRIVATE KEY":switch(i=(c=n.PrivateKey.decode(f,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return n.RSAPrivateKey.decode(c.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:c.algorithm.curve,privateKey:n.ECPrivateKey.decode(c.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return c.algorithm.params.priv_key=n.DSAparam.decode(c.subjectPrivateKey,"der"),{type:"dsa",params:c.algorithm.params};default:throw new Error("unknown key id "+i)}case"RSA PUBLIC KEY":return n.RSAPublicKey.decode(f,"der");case"RSA PRIVATE KEY":return n.RSAPrivateKey.decode(f,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:n.DSAPrivateKey.decode(f,"der")};case"EC PRIVATE KEY":return{curve:(f=n.ECPrivateKey.decode(f,"der")).parameters.value,privateKey:f.privateKey};default:throw new Error("unknown key type "+l)}}e.exports=c,c.signature=n.signature},{"./aesid.json":455,"./asn1":456,"./fixProc":458,"browserify-aes":191,pbkdf2:460,"safe-buffer":494}],460:[function(t,e,i){i.pbkdf2=t("./lib/async"),i.pbkdf2Sync=t("./lib/sync")},{"./lib/async":461,"./lib/sync":464}],461:[function(t,e,i){(function(i){(function(){var n,s,r=t("safe-buffer").Buffer,o=t("./precondition"),a=t("./default-encoding"),h=t("./sync"),c=t("./to-buffer"),u=i.crypto&&i.crypto.subtle,l={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},f=[];function d(){return s||(s=i.process&&i.process.nextTick?i.process.nextTick:i.queueMicrotask?i.queueMicrotask:i.setImmediate?i.setImmediate:i.setTimeout)}function p(t,e,i,n,s){return u.importKey("raw",t,{name:"PBKDF2"},!1,["deriveBits"]).then((function(t){return u.deriveBits({name:"PBKDF2",salt:e,iterations:i,hash:{name:s}},t,n<<3)})).then((function(t){return r.from(t)}))}e.exports=function(t,e,s,m,_,v){"function"==typeof _&&(v=_,_=void 0);var g=l[(_=_||"sha1").toLowerCase()];if(g&&"function"==typeof i.Promise){if(o(s,m),t=c(t,a,"Password"),e=c(e,a,"Salt"),"function"!=typeof v)throw new Error("No callback provided to pbkdf2");!function(t,e){t.then((function(t){d()((function(){e(null,t)}))}),(function(t){d()((function(){e(t)}))}))}(function(t){if(i.process&&!i.process.browser)return Promise.resolve(!1);if(!u||!u.importKey||!u.deriveBits)return Promise.resolve(!1);if(void 0!==f[t])return f[t];var e=p(n=n||r.alloc(8),n,10,128,t).then((function(){return!0})).catch((function(){return!1}));return f[t]=e,e}(g).then((function(i){return i?p(t,e,s,m,g):h(t,e,s,m,_)})),v)}else d()((function(){var i;try{i=h(t,e,s,m,_)}catch(t){return v(t)}v(null,i)}))}}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./default-encoding":462,"./precondition":463,"./sync":464,"./to-buffer":465,"safe-buffer":494}],462:[function(t,e,i){(function(t,i){(function(){var n;if(i.process&&i.process.browser)n="utf-8";else if(i.process&&i.process.version){n=parseInt(t.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary"}else n="utf-8";e.exports=n}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:467}],463:[function(t,e,i){var n=Math.pow(2,30)-1;e.exports=function(t,e){if("number"!=typeof t)throw new TypeError("Iterations not a number");if(t<0)throw new TypeError("Bad iterations");if("number"!=typeof e)throw new TypeError("Key length not a number");if(e<0||e>n||e!=e)throw new TypeError("Bad key length")}},{}],464:[function(t,e,i){var n=t("create-hash/md5"),s=t("ripemd160"),r=t("sha.js"),o=t("safe-buffer").Buffer,a=t("./precondition"),h=t("./default-encoding"),c=t("./to-buffer"),u=o.alloc(128),l={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function f(t,e,i){var a=function(t){function e(e){return r(t).update(e).digest()}return"rmd160"===t||"ripemd160"===t?function(t){return(new s).update(t).digest()}:"md5"===t?n:e}(t),h="sha512"===t||"sha384"===t?128:64;e.length>h?e=a(e):e.length<h&&(e=o.concat([e,u],h));for(var c=o.allocUnsafe(h+l[t]),f=o.allocUnsafe(h+l[t]),d=0;d<h;d++)c[d]=54^e[d],f[d]=92^e[d];var p=o.allocUnsafe(h+i+4);c.copy(p,0,0,h),this.ipad1=p,this.ipad2=c,this.opad=f,this.alg=t,this.blocksize=h,this.hash=a,this.size=l[t]}f.prototype.run=function(t,e){return t.copy(e,this.blocksize),this.hash(e).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(t,e,i,n,s){a(i,n);var r=new f(s=s||"sha1",t=c(t,h,"Password"),(e=c(e,h,"Salt")).length),u=o.allocUnsafe(n),d=o.allocUnsafe(e.length+4);e.copy(d,0,0,e.length);for(var p=0,m=l[s],_=Math.ceil(n/m),v=1;v<=_;v++){d.writeUInt32BE(v,e.length);for(var g=r.run(d,r.ipad1),b=g,w=1;w<i;w++){b=r.run(b,r.ipad2);for(var y=0;y<m;y++)g[y]^=b[y]}g.copy(u,p),p+=m}return u}},{"./default-encoding":462,"./precondition":463,"./to-buffer":465,"create-hash/md5":387,ripemd160:493,"safe-buffer":494,"sha.js":498}],465:[function(t,e,i){var n=t("safe-buffer").Buffer;e.exports=function(t,e,i){if(n.isBuffer(t))return t;if("string"==typeof t)return n.from(t,e);if(ArrayBuffer.isView(t))return n.from(t.buffer);throw new TypeError(i+" must be a string, a Buffer, a typed array or a DataView")}},{"safe-buffer":494}],466:[function(t,e,i){(function(t){(function(){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,i,n,s){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var r,o,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,i)}));case 3:return t.nextTick((function(){e.call(null,i,n)}));case 4:return t.nextTick((function(){e.call(null,i,n,s)}));default:for(r=new Array(a-1),o=0;o<r.length;)r[o++]=arguments[o];return t.nextTick((function(){e.apply(null,r)}))}}}:e.exports=t}).call(this)}).call(this,t("_process"))},{_process:467}],467:[function(t,e,i){var n,s,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function h(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{s="function"==typeof clearTimeout?clearTimeout:a}catch(t){s=a}}();var c,u=[],l=!1,f=-1;function d(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&p())}function p(){if(!l){var t=h(d);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function _(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new m(t,e)),1!==u.length||l||h(p)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=_,r.addListener=_,r.once=_,r.off=_,r.removeListener=_,r.removeAllListeners=_,r.emit=_,r.prependListener=_,r.prependOnceListener=_,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],468:[function(t,e,i){i.publicEncrypt=t("./publicEncrypt"),i.privateDecrypt=t("./privateDecrypt"),i.privateEncrypt=function(t,e){return i.publicEncrypt(t,e,!0)},i.publicDecrypt=function(t,e){return i.privateDecrypt(t,e,!0)}},{"./privateDecrypt":471,"./publicEncrypt":472}],469:[function(t,e,i){var n=t("create-hash"),s=t("safe-buffer").Buffer;function r(t){var e=s.allocUnsafe(4);return e.writeUInt32BE(t,0),e}e.exports=function(t,e){for(var i,o=s.alloc(0),a=0;o.length<e;)i=r(a++),o=s.concat([o,n("sha1").update(t).update(i).digest()]);return o.slice(0,e)}},{"create-hash":386,"safe-buffer":494}],470:[function(t,e,i){arguments[4][184][0].apply(i,arguments)},{buffer:188,dup:184}],471:[function(t,e,i){var n=t("parse-asn1"),s=t("./mgf"),r=t("./xor"),o=t("bn.js"),a=t("browserify-rsa"),h=t("create-hash"),c=t("./withPublic"),u=t("safe-buffer").Buffer;e.exports=function(t,e,i){var l;l=t.padding?t.padding:i?1:4;var f,d=n(t),p=d.modulus.byteLength();if(e.length>p||new o(e).cmp(d.modulus)>=0)throw new Error("decryption error");f=i?c(new o(e),d):a(e,d);var m=u.alloc(p-f.length);if(f=u.concat([m,f],p),4===l)return function(t,e){var i=t.modulus.byteLength(),n=h("sha1").update(u.alloc(0)).digest(),o=n.length;if(0!==e[0])throw new Error("decryption error");var a=e.slice(1,o+1),c=e.slice(o+1),l=r(a,s(c,o)),f=r(c,s(l,i-o-1));if(function(t,e){t=u.from(t),e=u.from(e);var i=0,n=t.length;t.length!==e.length&&(i++,n=Math.min(t.length,e.length));var s=-1;for(;++s<n;)i+=t[s]^e[s];return i}(n,f.slice(0,o)))throw new Error("decryption error");var d=o;for(;0===f[d];)d++;if(1!==f[d++])throw new Error("decryption error");return f.slice(d)}(d,f);if(1===l)return function(t,e,i){var n=e.slice(0,2),s=2,r=0;for(;0!==e[s++];)if(s>=e.length){r++;break}var o=e.slice(2,s-1);("0002"!==n.toString("hex")&&!i||"0001"!==n.toString("hex")&&i)&&r++;o.length<8&&r++;if(r)throw new Error("decryption error");return e.slice(s)}(0,f,i);if(3===l)return f;throw new Error("unknown padding")}},{"./mgf":469,"./withPublic":473,"./xor":474,"bn.js":470,"browserify-rsa":209,"create-hash":386,"parse-asn1":459,"safe-buffer":494}],472:[function(t,e,i){var n=t("parse-asn1"),s=t("randombytes"),r=t("create-hash"),o=t("./mgf"),a=t("./xor"),h=t("bn.js"),c=t("./withPublic"),u=t("browserify-rsa"),l=t("safe-buffer").Buffer;e.exports=function(t,e,i){var f;f=t.padding?t.padding:i?1:4;var d,p=n(t);if(4===f)d=function(t,e){var i=t.modulus.byteLength(),n=e.length,c=r("sha1").update(l.alloc(0)).digest(),u=c.length,f=2*u;if(n>i-f-2)throw new Error("message too long");var d=l.alloc(i-n-f-2),p=i-u-1,m=s(u),_=a(l.concat([c,d,l.alloc(1,1),e],p),o(m,p)),v=a(m,o(_,u));return new h(l.concat([l.alloc(1),v,_],i))}(p,e);else if(1===f)d=function(t,e,i){var n,r=e.length,o=t.modulus.byteLength();if(r>o-11)throw new Error("message too long");n=i?l.alloc(o-r-3,255):function(t){var e,i=l.allocUnsafe(t),n=0,r=s(2*t),o=0;for(;n<t;)o===r.length&&(r=s(2*t),o=0),(e=r[o++])&&(i[n++]=e);return i}(o-r-3);return new h(l.concat([l.from([0,i?1:2]),n,l.alloc(1),e],o))}(p,e,i);else{if(3!==f)throw new Error("unknown padding");if((d=new h(e)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return i?u(d,p):c(d,p)}},{"./mgf":469,"./withPublic":473,"./xor":474,"bn.js":470,"browserify-rsa":209,"create-hash":386,"parse-asn1":459,randombytes:475,"safe-buffer":494}],473:[function(t,e,i){var n=t("bn.js"),s=t("safe-buffer").Buffer;e.exports=function(t,e){return s.from(t.toRed(n.mont(e.modulus)).redPow(new n(e.publicExponent)).fromRed().toArray())}},{"bn.js":470,"safe-buffer":494}],474:[function(t,e,i){e.exports=function(t,e){for(var i=t.length,n=-1;++n<i;)t[n]^=e[n];return t}},{}],475:[function(t,e,i){(function(i,n){(function(){var s=t("safe-buffer").Buffer,r=n.crypto||n.msCrypto;r&&r.getRandomValues?e.exports=function(t,e){if(t>4294967295)throw new RangeError("requested too many random bytes");var n=s.allocUnsafe(t);if(t>0)if(t>65536)for(var o=0;o<t;o+=65536)r.getRandomValues(n.slice(o,o+65536));else r.getRandomValues(n);if("function"==typeof e)return i.nextTick((function(){e(null,n)}));return n}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:467,"safe-buffer":494}],476:[function(t,e,i){(function(e,n){(function(){function s(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var r=t("safe-buffer"),o=t("randombytes"),a=r.Buffer,h=r.kMaxLength,c=n.crypto||n.msCrypto,u=Math.pow(2,32)-1;function l(t,e){if("number"!=typeof t||t!=t)throw new TypeError("offset must be a number");if(t>u||t<0)throw new TypeError("offset must be a uint32");if(t>h||t>e)throw new RangeError("offset out of range")}function f(t,e,i){if("number"!=typeof t||t!=t)throw new TypeError("size must be a number");if(t>u||t<0)throw new TypeError("size must be a uint32");if(t+e>i||t>h)throw new RangeError("buffer too small")}function d(t,i,n,s){if(e.browser){var r=t.buffer,a=new Uint8Array(r,i,n);return c.getRandomValues(a),s?void e.nextTick((function(){s(null,t)})):t}if(!s)return o(n).copy(t,i),t;o(n,(function(e,n){if(e)return s(e);n.copy(t,i),s(null,t)}))}c&&c.getRandomValues||!e.browser?(i.randomFill=function(t,e,i,s){if(!(a.isBuffer(t)||t instanceof n.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof e)s=e,e=0,i=t.length;else if("function"==typeof i)s=i,i=t.length-e;else if("function"!=typeof s)throw new TypeError('"cb" argument must be a function');return l(e,t.length),f(i,e,t.length),d(t,e,i,s)},i.randomFillSync=function(t,e,i){void 0===e&&(e=0);if(!(a.isBuffer(t)||t instanceof n.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');l(e,t.length),void 0===i&&(i=t.length-e);return f(i,e,t.length),d(t,e,i)}):(i.randomFill=s,i.randomFillSync=s)}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:467,randombytes:475,"safe-buffer":494}],477:[function(t,e,i){var n={};function s(t,e,i){i||(i=Error);var s=function(t){var i,n;function s(i,n,s){return t.call(this,function(t,i,n){return"string"==typeof e?e:e(t,i,n)}(i,n,s))||this}return n=t,(i=s).prototype=Object.create(n.prototype),i.prototype.constructor=i,i.__proto__=n,s}(i);s.prototype.name=i.name,s.prototype.code=t,n[t]=s}function r(t,e){if(Array.isArray(t)){var i=t.length;return t=t.map((function(t){return String(t)})),i>2?"one of ".concat(e," ").concat(t.slice(0,i-1).join(", "),", or ")+t[i-1]:2===i?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}return"of ".concat(e," ").concat(String(t))}s("ERR_INVALID_OPT_VALUE",(function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'}),TypeError),s("ERR_INVALID_ARG_TYPE",(function(t,e,i){var n,s,o;if("string"==typeof e&&(s="not ",e.substr(0,s.length)===s)?(n="must not be",e=e.replace(/^not /,"")):n="must be",function(t,e,i){return(void 0===i||i>t.length)&&(i=t.length),t.substring(i-e.length,i)===e}(t," argument"))o="The ".concat(t," ").concat(n," ").concat(r(e,"type"));else{var a=function(t,e,i){return"number"!=typeof i&&(i=0),!(i+e.length>t.length)&&-1!==t.indexOf(e,i)}(t,".")?"property":"argument";o='The "'.concat(t,'" ').concat(a," ").concat(n," ").concat(r(e,"type"))}return o+=". Received type ".concat(typeof i)}),TypeError),s("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),s("ERR_METHOD_NOT_IMPLEMENTED",(function(t){return"The "+t+" method is not implemented"})),s("ERR_STREAM_PREMATURE_CLOSE","Premature close"),s("ERR_STREAM_DESTROYED",(function(t){return"Cannot call "+t+" after a stream was destroyed"})),s("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),s("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),s("ERR_STREAM_WRITE_AFTER_END","write after end"),s("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),s("ERR_UNKNOWN_ENCODING",(function(t){return"Unknown encoding: "+t}),TypeError),s("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=n},{}],478:[function(t,e,i){(function(i){(function(){var n=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};e.exports=c;var s=t("./_stream_readable"),r=t("./_stream_writable");t("inherits")(c,s);for(var o=n(r.prototype),a=0;a<o.length;a++){var h=o[a];c.prototype[h]||(c.prototype[h]=r.prototype[h])}function c(t){if(!(this instanceof c))return new c(t);s.call(this,t),r.call(this,t),this.allowHalfOpen=!0,t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||i.nextTick(l,this)}function l(t){t.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}})}).call(this)}).call(this,t("_process"))},{"./_stream_readable":480,"./_stream_writable":482,_process:467,inherits:440}],479:[function(t,e,i){e.exports=s;var n=t("./_stream_transform");function s(t){if(!(this instanceof s))return new s(t);n.call(this,t)}t("inherits")(s,n),s.prototype._transform=function(t,e,i){i(null,t)}},{"./_stream_transform":481,inherits:440}],480:[function(t,e,i){(function(i,n){(function(){var s;e.exports=O,O.ReadableState=T;t("events").EventEmitter;var r=function(t,e){return t.listeners(e).length},o=t("./internal/streams/stream"),a=t("buffer").Buffer,h=(void 0!==n?n:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var c,u=t("util");c=u&&u.debuglog?u.debuglog("stream"):function(){};var l,f,d,p=t("./internal/streams/buffer_list"),m=t("./internal/streams/destroy"),_=t("./internal/streams/state").getHighWaterMark,v=t("../errors").codes,g=v.ERR_INVALID_ARG_TYPE,b=v.ERR_STREAM_PUSH_AFTER_EOF,w=v.ERR_METHOD_NOT_IMPLEMENTED,y=v.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;t("inherits")(O,o);var x=m.errorOrDestroy,M=["error","close","destroy","pause","resume"];function T(e,i,n){s=s||t("./_stream_duplex"),e=e||{},"boolean"!=typeof n&&(n=i instanceof s),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=_(this,e,"readableHighWaterMark",n),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(l||(l=t("string_decoder/").StringDecoder),this.decoder=new l(e.encoding),this.encoding=e.encoding)}function O(e){if(s=s||t("./_stream_duplex"),!(this instanceof O))return new O(e);var i=this instanceof s;this._readableState=new T(e,this,i),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function E(t,e,i,n,s){c("readableAddChunk",e);var r,o=t._readableState;if(null===e)o.reading=!1,function(t,e){if(c("onEofChunk"),e.ended)return;if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,e.sync?k(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,I(t)))}(t,o);else if(s||(r=function(t,e){var i;n=e,a.isBuffer(n)||n instanceof h||"string"==typeof e||void 0===e||t.objectMode||(i=new g("chunk",["string","Buffer","Uint8Array"],e));var n;return i}(o,e)),r)x(t,r);else if(o.objectMode||e&&e.length>0)if("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===a.prototype||(e=function(t){return a.from(t)}(e)),n)o.endEmitted?x(t,new y):A(t,o,e,!0);else if(o.ended)x(t,new b);else{if(o.destroyed)return!1;o.reading=!1,o.decoder&&!i?(e=o.decoder.write(e),o.objectMode||0!==e.length?A(t,o,e,!1):C(t,o)):A(t,o,e,!1)}else n||(o.reading=!1,C(t,o));return!o.ended&&(o.length<o.highWaterMark||0===o.length)}function A(t,e,i,n){e.flowing&&0===e.length&&!e.sync?(e.awaitDrain=0,t.emit("data",i)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&k(t)),C(t,e)}Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),O.prototype.destroy=m.destroy,O.prototype._undestroy=m.undestroy,O.prototype._destroy=function(t,e){e(t)},O.prototype.push=function(t,e){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=a.from(t,e),e=""),i=!0),E(this,t,e,!1,i)},O.prototype.unshift=function(t){return E(this,t,null,!0,!1)},O.prototype.isPaused=function(){return!1===this._readableState.flowing},O.prototype.setEncoding=function(e){l||(l=t("string_decoder/").StringDecoder);var i=new l(e);this._readableState.decoder=i,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,s="";null!==n;)s+=i.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==s&&this._readableState.buffer.push(s),this._readableState.length=s.length,this};function S(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=1073741824?t=1073741824:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function k(t){var e=t._readableState;c("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(c("emitReadable",e.flowing),e.emittedReadable=!0,i.nextTick(I,t))}function I(t){var e=t._readableState;c("emitReadable_",e.destroyed,e.length,e.ended),e.destroyed||!e.length&&!e.ended||(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,N(t)}function C(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(j,t,e))}function j(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&0===e.length);){var i=e.length;if(c("maybeReadMore read 0"),t.read(0),i===e.length)break}e.readingMore=!1}function D(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function R(t){c("readable nexttick read 0"),t.read(0)}function P(t,e){c("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),N(t),e.flowing&&!e.reading&&t.read(0)}function N(t){var e=t._readableState;for(c("flow",e.flowing);e.flowing&&null!==t.read(););}function F(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):i=e.buffer.consume(t,e.decoder),i);var i}function z(t){var e=t._readableState;c("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,i.nextTick(L,e,t))}function L(t,e){if(c("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var i=e._writableState;(!i||i.autoDestroy&&i.finished)&&e.destroy()}}function $(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}O.prototype.read=function(t){c("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&((0!==e.highWaterMark?e.length>=e.highWaterMark:e.length>0)||e.ended))return c("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?z(this):k(this),null;if(0===(t=S(t,e))&&e.ended)return 0===e.length&&z(this),null;var n,s=e.needReadable;return c("need readable",s),(0===e.length||e.length-t<e.highWaterMark)&&c("length less than watermark",s=!0),e.ended||e.reading?c("reading or ended",s=!1):s&&(c("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=S(i,e))),null===(n=t>0?F(t,e):null)?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&z(this)),null!==n&&this.emit("data",n),n},O.prototype._read=function(t){x(this,new w("_read()"))},O.prototype.pipe=function(t,e){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,c("pipe count=%d opts=%j",s.pipesCount,e);var o=(!e||!1!==e.end)&&t!==i.stdout&&t!==i.stderr?h:_;function a(e,i){c("onunpipe"),e===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,c("cleanup"),t.removeListener("close",p),t.removeListener("finish",m),t.removeListener("drain",u),t.removeListener("error",d),t.removeListener("unpipe",a),n.removeListener("end",h),n.removeListener("end",_),n.removeListener("data",f),l=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||u())}function h(){c("onend"),t.end()}s.endEmitted?i.nextTick(o):n.once("end",o),t.on("unpipe",a);var u=function(t){return function(){var e=t._readableState;c("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&r(t,"data")&&(e.flowing=!0,N(t))}}(n);t.on("drain",u);var l=!1;function f(e){c("ondata");var i=t.write(e);c("dest.write",i),!1===i&&((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==$(s.pipes,t))&&!l&&(c("false write response, pause",s.awaitDrain),s.awaitDrain++),n.pause())}function d(e){c("onerror",e),_(),t.removeListener("error",d),0===r(t,"error")&&x(t,e)}function p(){t.removeListener("finish",m),_()}function m(){c("onfinish"),t.removeListener("close",p),_()}function _(){c("unpipe"),n.unpipe(t)}return n.on("data",f),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",d),t.once("close",p),t.once("finish",m),t.emit("pipe",n),s.flowing||(c("pipe resume"),n.resume()),t},O.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var n=e.pipes,s=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var r=0;r<s;r++)n[r].emit("unpipe",this,{hasUnpiped:!1});return this}var o=$(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i)),this},O.prototype.on=function(t,e){var n=o.prototype.on.call(this,t,e),s=this._readableState;return"data"===t?(s.readableListening=this.listenerCount("readable")>0,!1!==s.flowing&&this.resume()):"readable"===t&&(s.endEmitted||s.readableListening||(s.readableListening=s.needReadable=!0,s.flowing=!1,s.emittedReadable=!1,c("on readable",s.length,s.reading),s.length?k(this):s.reading||i.nextTick(R,this))),n},O.prototype.addListener=O.prototype.on,O.prototype.removeListener=function(t,e){var n=o.prototype.removeListener.call(this,t,e);return"readable"===t&&i.nextTick(D,this),n},O.prototype.removeAllListeners=function(t){var e=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||i.nextTick(D,this),e},O.prototype.resume=function(){var t=this._readableState;return t.flowing||(c("resume"),t.flowing=!t.readableListening,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(P,t,e))}(this,t)),t.paused=!1,this},O.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},O.prototype.wrap=function(t){var e=this,i=this._readableState,n=!1;for(var s in t.on("end",(function(){if(c("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(s){(c("wrapped data"),i.decoder&&(s=i.decoder.write(s)),i.objectMode&&null==s)||(i.objectMode||s&&s.length)&&(e.push(s)||(n=!0,t.pause()))})),t)void 0===this[s]&&"function"==typeof t[s]&&(this[s]=function(e){return function(){return t[e].apply(t,arguments)}}(s));for(var r=0;r<M.length;r++)t.on(M[r],this.emit.bind(this,M[r]));return this._read=function(e){c("wrapped _read",e),n&&(n=!1,t.resume())},this},"function"==typeof Symbol&&(O.prototype[Symbol.asyncIterator]=function(){return void 0===f&&(f=t("./internal/streams/async_iterator")),f(this)}),Object.defineProperty(O.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(O.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(O.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),O._fromList=F,Object.defineProperty(O.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(O.from=function(e,i){return void 0===d&&(d=t("./internal/streams/from")),d(O,e,i)})}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":477,"./_stream_duplex":478,"./internal/streams/async_iterator":483,"./internal/streams/buffer_list":484,"./internal/streams/destroy":485,"./internal/streams/from":487,"./internal/streams/state":489,"./internal/streams/stream":490,_process:467,buffer:220,events:422,inherits:440,"string_decoder/":522,util:188}],481:[function(t,e,i){e.exports=u;var n=t("../errors").codes,s=n.ERR_METHOD_NOT_IMPLEMENTED,r=n.ERR_MULTIPLE_CALLBACK,o=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0,h=t("./_stream_duplex");function c(t,e){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(null===n)return this.emit("error",new r);i.writechunk=null,i.writecb=null,null!=e&&this.push(e),n(t);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function u(t){if(!(this instanceof u))return new u(t);h.call(this,t),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",l)}function l(){var t=this;"function"!=typeof this._flush||this._readableState.destroyed?f(this,null,null):this._flush((function(e,i){f(t,e,i)}))}function f(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new a;if(t._transformState.transforming)throw new o;return t.push(null)}t("inherits")(u,h),u.prototype.push=function(t,e){return this._transformState.needTransform=!1,h.prototype.push.call(this,t,e)},u.prototype._transform=function(t,e,i){i(new s("_transform()"))},u.prototype._write=function(t,e,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=e,!n.transforming){var s=this._readableState;(n.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},u.prototype._read=function(t){var e=this._transformState;null===e.writechunk||e.transforming?e.needTransform=!0:(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform))},u.prototype._destroy=function(t,e){h.prototype._destroy.call(this,t,(function(t){e(t)}))}},{"../errors":477,"./_stream_duplex":478,inherits:440}],482:[function(t,e,i){(function(i,n){(function(){function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var n=t.entry;t.entry=null;for(;n;){var s=n.callback;e.pendingcb--,s(i),n=n.next}e.corkedRequestsFree.next=t}(e,t)}}var r;e.exports=O,O.WritableState=T;var o={deprecate:t("util-deprecate")},a=t("./internal/streams/stream"),h=t("buffer").Buffer,c=(void 0!==n?n:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var u,l=t("./internal/streams/destroy"),f=t("./internal/streams/state").getHighWaterMark,d=t("../errors").codes,p=d.ERR_INVALID_ARG_TYPE,m=d.ERR_METHOD_NOT_IMPLEMENTED,_=d.ERR_MULTIPLE_CALLBACK,v=d.ERR_STREAM_CANNOT_PIPE,g=d.ERR_STREAM_DESTROYED,b=d.ERR_STREAM_NULL_VALUES,w=d.ERR_STREAM_WRITE_AFTER_END,y=d.ERR_UNKNOWN_ENCODING,x=l.errorOrDestroy;function M(){}function T(e,n,o){r=r||t("./_stream_duplex"),e=e||{},"boolean"!=typeof o&&(o=n instanceof r),this.objectMode=!!e.objectMode,o&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=f(this,e,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,s=n.sync,r=n.writecb;if("function"!=typeof r)throw new _;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,s,r){--e.pendingcb,n?(i.nextTick(r,s),i.nextTick(C,t,e),t._writableState.errorEmitted=!0,x(t,s)):(r(s),t._writableState.errorEmitted=!0,x(t,s),C(t,e))}(t,n,s,e,r);else{var o=k(n)||t.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||S(t,n),s?i.nextTick(A,t,n,o,r):A(t,n,o,r)}}(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function O(e){var i=this instanceof(r=r||t("./_stream_duplex"));if(!i&&!u.call(O,this))return new O(e);this._writableState=new T(e,this,i),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),a.call(this)}function E(t,e,i,n,s,r,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new g("write")):i?t._writev(s,e.onwrite):t._write(s,r,e.onwrite),e.sync=!1}function A(t,e,i,n){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),C(t,e)}function S(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var n=e.bufferedRequestCount,r=new Array(n),o=e.corkedRequestsFree;o.entry=i;for(var a=0,h=!0;i;)r[a]=i,i.isBuf||(h=!1),i=i.next,a+=1;r.allBuffers=h,E(t,e,!0,e.length,r,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,u=i.encoding,l=i.callback;if(E(t,e,!1,e.objectMode?1:c.length,c,u,l),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function k(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function I(t,e){t._final((function(i){e.pendingcb--,i&&x(t,i),e.prefinished=!0,t.emit("prefinish"),C(t,e)}))}function C(t,e){var n=k(e);if(n&&(function(t,e){e.prefinished||e.finalCalled||("function"!=typeof t._final||e.destroyed?(e.prefinished=!0,t.emit("prefinish")):(e.pendingcb++,e.finalCalled=!0,i.nextTick(I,t,e)))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var s=t._readableState;(!s||s.autoDestroy&&s.endEmitted)&&t.destroy()}return n}t("inherits")(O,a),T.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(T.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(O,Symbol.hasInstance,{value:function(t){return!!u.call(this,t)||this===O&&(t&&t._writableState instanceof T)}})):u=function(t){return t instanceof this},O.prototype.pipe=function(){x(this,new v)},O.prototype.write=function(t,e,n){var s,r=this._writableState,o=!1,a=!r.objectMode&&(s=t,h.isBuffer(s)||s instanceof c);return a&&!h.isBuffer(t)&&(t=function(t){return h.from(t)}(t)),"function"==typeof e&&(n=e,e=null),a?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=M),r.ending?function(t,e){var n=new w;x(t,n),i.nextTick(e,n)}(this,n):(a||function(t,e,n,s){var r;return null===n?r=new b:"string"==typeof n||e.objectMode||(r=new p("chunk",["string","Buffer"],n)),!r||(x(t,r),i.nextTick(s,r),!1)}(this,r,t,n))&&(r.pendingcb++,o=function(t,e,i,n,s,r){if(!i){var o=function(t,e,i){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=h.from(e,i));return e}(e,n,s);n!==o&&(i=!0,s="buffer",n=o)}var a=e.objectMode?1:n.length;e.length+=a;var c=e.length<e.highWaterMark;c||(e.needDrain=!0);if(e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:s,isBuf:i,callback:r,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else E(t,e,!1,a,n,s,r);return c}(this,r,a,t,e,n)),o},O.prototype.cork=function(){this._writableState.corked++},O.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||S(this,t))},O.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new y(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(O.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(O.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),O.prototype._write=function(t,e,i){i(new m("_write()"))},O.prototype._writev=null,O.prototype.end=function(t,e,n){var s=this._writableState;return"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),s.corked&&(s.corked=1,this.uncork()),s.ending||function(t,e,n){e.ending=!0,C(t,e),n&&(e.finished?i.nextTick(n):t.once("finish",n));e.ended=!0,t.writable=!1}(this,s,n),this},Object.defineProperty(O.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),O.prototype.destroy=l.destroy,O.prototype._undestroy=l.undestroy,O.prototype._destroy=function(t,e){e(t)}}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../errors":477,"./_stream_duplex":478,"./internal/streams/destroy":485,"./internal/streams/state":489,"./internal/streams/stream":490,_process:467,buffer:220,inherits:440,"util-deprecate":524}],483:[function(t,e,i){(function(i){(function(){var n;function s(t,e,i){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var r=t("./end-of-stream"),o=Symbol("lastResolve"),a=Symbol("lastReject"),h=Symbol("error"),c=Symbol("ended"),u=Symbol("lastPromise"),l=Symbol("handlePromise"),f=Symbol("stream");function d(t,e){return{value:t,done:e}}function p(t){var e=t[o];if(null!==e){var i=t[f].read();null!==i&&(t[u]=null,t[o]=null,t[a]=null,e(d(i,!1)))}}function m(t){i.nextTick(p,t)}var _=Object.getPrototypeOf((function(){})),v=Object.setPrototypeOf((s(n={get stream(){return this[f]},next:function(){var t=this,e=this[h];if(null!==e)return Promise.reject(e);if(this[c])return Promise.resolve(d(void 0,!0));if(this[f].destroyed)return new Promise((function(e,n){i.nextTick((function(){t[h]?n(t[h]):e(d(void 0,!0))}))}));var n,s=this[u];if(s)n=new Promise(function(t,e){return function(i,n){t.then((function(){e[c]?i(d(void 0,!0)):e[l](i,n)}),n)}}(s,this));else{var r=this[f].read();if(null!==r)return Promise.resolve(d(r,!1));n=new Promise(this[l])}return this[u]=n,n}},Symbol.asyncIterator,(function(){return this})),s(n,"return",(function(){var t=this;return new Promise((function(e,i){t[f].destroy(null,(function(t){t?i(t):e(d(void 0,!0))}))}))})),n),_);e.exports=function(t){var e,i=Object.create(v,(s(e={},f,{value:t,writable:!0}),s(e,o,{value:null,writable:!0}),s(e,a,{value:null,writable:!0}),s(e,h,{value:null,writable:!0}),s(e,c,{value:t._readableState.endEmitted,writable:!0}),s(e,l,{value:function(t,e){var n=i[f].read();n?(i[u]=null,i[o]=null,i[a]=null,t(d(n,!1))):(i[o]=t,i[a]=e)},writable:!0}),e));return i[u]=null,r(t,(function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var e=i[a];return null!==e&&(i[u]=null,i[o]=null,i[a]=null,e(t)),void(i[h]=t)}var n=i[o];null!==n&&(i[u]=null,i[o]=null,i[a]=null,n(d(void 0,!0))),i[c]=!0})),t.on("readable",m.bind(null,i)),i}}).call(this)}).call(this,t("_process"))},{"./end-of-stream":486,_process:467}],484:[function(t,e,i){function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function s(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(t,e,i){return(e=a(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var h=t("buffer").Buffer,c=t("util").inspect,u=c&&c.custom||"inspect";e.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}var e,i;return e=t,(i=[{key:"push",value:function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length}},{key:"unshift",value:function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}},{key:"shift",value:function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i}},{key:"concat",value:function(t){if(0===this.length)return h.alloc(0);for(var e,i,n,s=h.allocUnsafe(t>>>0),r=this.head,o=0;r;)e=r.data,i=s,n=o,h.prototype.copy.call(e,i,n),o+=r.data.length,r=r.next;return s}},{key:"consume",value:function(t,e){var i;return t<this.head.data.length?(i=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):i=t===this.head.data.length?this.shift():e?this._getString(t):this._getBuffer(t),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var e=this.head,i=1,n=e.data;for(t-=n.length;e=e.next;){var s=e.data,r=t>s.length?s.length:t;if(r===s.length?n+=s:n+=s.slice(0,t),0==(t-=r)){r===s.length?(++i,e.next?this.head=e.next:this.head=this.tail=null):(this.head=e,e.data=s.slice(r));break}++i}return this.length-=i,n}},{key:"_getBuffer",value:function(t){var e=h.allocUnsafe(t),i=this.head,n=1;for(i.data.copy(e),t-=i.data.length;i=i.next;){var s=i.data,r=t>s.length?s.length:t;if(s.copy(e,e.length-t,0,r),0==(t-=r)){r===s.length?(++n,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=s.slice(r));break}++n}return this.length-=n,e}},{key:u,value:function(t,e){return c(this,s(s({},e),{},{depth:0,customInspect:!1}))}}])&&o(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()},{buffer:220,util:188}],485:[function(t,e,i){(function(t){(function(){function i(t,e){s(t,e),n(t)}function n(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function s(t,e){t.emit("error",e)}e.exports={destroy:function(e,r){var o=this,a=this._readableState&&this._readableState.destroyed,h=this._writableState&&this._writableState.destroyed;return a||h?(r?r(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,t.nextTick(s,this,e)):t.nextTick(s,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!r&&e?o._writableState?o._writableState.errorEmitted?t.nextTick(n,o):(o._writableState.errorEmitted=!0,t.nextTick(i,o,e)):t.nextTick(i,o,e):r?(t.nextTick(n,o),r(e)):t.nextTick(n,o)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(t,e){var i=t._readableState,n=t._writableState;i&&i.autoDestroy||n&&n.autoDestroy?t.destroy(e):t.emit("error",e)}}}).call(this)}).call(this,t("_process"))},{_process:467}],486:[function(t,e,i){var n=t("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function s(){}e.exports=function t(e,i,r){if("function"==typeof i)return t(e,null,i);i||(i={}),r=function(t){var e=!1;return function(){if(!e){e=!0;for(var i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];t.apply(this,n)}}}(r||s);var o=i.readable||!1!==i.readable&&e.readable,a=i.writable||!1!==i.writable&&e.writable,h=function(){e.writable||u()},c=e._writableState&&e._writableState.finished,u=function(){a=!1,c=!0,o||r.call(e)},l=e._readableState&&e._readableState.endEmitted,f=function(){o=!1,l=!0,a||r.call(e)},d=function(t){r.call(e,t)},p=function(){var t;return o&&!l?(e._readableState&&e._readableState.ended||(t=new n),r.call(e,t)):a&&!c?(e._writableState&&e._writableState.ended||(t=new n),r.call(e,t)):void 0},m=function(){e.req.on("finish",u)};return!function(t){return t.setHeader&&"function"==typeof t.abort}(e)?a&&!e._writableState&&(e.on("end",h),e.on("close",h)):(e.on("complete",u),e.on("abort",p),e.req?m():e.on("request",m)),e.on("end",f),e.on("finish",u),!1!==i.error&&e.on("error",d),e.on("close",p),function(){e.removeListener("complete",u),e.removeListener("abort",p),e.removeListener("request",m),e.req&&e.req.removeListener("finish",u),e.removeListener("end",h),e.removeListener("close",h),e.removeListener("finish",u),e.removeListener("end",f),e.removeListener("error",d),e.removeListener("close",p)}}},{"../../../errors":477}],487:[function(t,e,i){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],488:[function(t,e,i){var n;var s=t("../../../errors").codes,r=s.ERR_MISSING_ARGS,o=s.ERR_STREAM_DESTROYED;function a(t){if(t)throw t}function h(e,i,s,r){r=function(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}(r);var a=!1;e.on("close",(function(){a=!0})),void 0===n&&(n=t("./end-of-stream")),n(e,{readable:i,writable:s},(function(t){if(t)return r(t);a=!0,r()}));var h=!1;return function(t){if(!a&&!h)return h=!0,function(t){return t.setHeader&&"function"==typeof t.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void r(t||new o("pipe"))}}function c(t){t()}function u(t,e){return t.pipe(e)}function l(t){return t.length?"function"!=typeof t[t.length-1]?a:t.pop():a}e.exports=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n,s=l(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new r("streams");var o=e.map((function(t,i){var r=i<e.length-1;return h(t,r,i>0,(function(t){n||(n=t),t&&o.forEach(c),r||(o.forEach(c),s(n))}))}));return e.reduce(u)}},{"../../../errors":477,"./end-of-stream":486}],489:[function(t,e,i){var n=t("../../../errors").codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(t,e,i,s){var r=function(t,e,i){return null!=t.highWaterMark?t.highWaterMark:e?t[i]:null}(e,s,i);if(null!=r){if(!isFinite(r)||Math.floor(r)!==r||r<0)throw new n(s?i:"highWaterMark",r);return Math.floor(r)}return t.objectMode?16:16384}}},{"../../../errors":477}],490:[function(t,e,i){e.exports=t("events").EventEmitter},{events:422}],491:[function(t,e,i){(i=e.exports=t("./lib/_stream_readable.js")).Stream=i,i.Readable=i,i.Writable=t("./lib/_stream_writable.js"),i.Duplex=t("./lib/_stream_duplex.js"),i.Transform=t("./lib/_stream_transform.js"),i.PassThrough=t("./lib/_stream_passthrough.js"),i.finished=t("./lib/internal/streams/end-of-stream.js"),i.pipeline=t("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":478,"./lib/_stream_passthrough.js":479,"./lib/_stream_readable.js":480,"./lib/_stream_transform.js":481,"./lib/_stream_writable.js":482,"./lib/internal/streams/end-of-stream.js":486,"./lib/internal/streams/pipeline.js":488}],492:[function(t,e,i){var n=function(t){var e=Object.prototype,i=e.hasOwnProperty,n=Object.defineProperty||function(t,e,i){t[e]=i.value},s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",o=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function h(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,i){return t[e]=i}}function c(t,e,i,s){var r=e&&e.prototype instanceof f?e:f,o=Object.create(r.prototype),a=new O(s||[]);return n(o,"_invoke",{value:y(t,i,a)}),o}function u(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function f(){}function d(){}function p(){}var m={};h(m,r,(function(){return this}));var _=Object.getPrototypeOf,v=_&&_(_(E([])));v&&v!==e&&i.call(v,r)&&(m=v);var g=p.prototype=f.prototype=Object.create(m);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var s;n(this,"_invoke",{value:function(n,r){function o(){return new e((function(s,o){!function n(s,r,o,a){var h=u(t[s],t,r);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(l).then((function(t){c.value=t,o(c)}),(function(t){return n("throw",t,o,a)}))}a(h.arg)}(n,r,s,o)}))}return s=s?s.then(o,o):o()}})}function y(t,e,i){var n="suspendedStart";return function(s,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw r;return A()}for(i.method=s,i.arg=r;;){var o=i.delegate;if(o){var a=x(o,i);if(a){if(a===l)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var h=u(t,e,i);if("normal"===h.type){if(n=i.done?"completed":"suspendedYield",h.arg===l)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(n="completed",i.method="throw",i.arg=h.arg)}}}function x(t,e){var i=e.method,n=t.iterator[i];if(void 0===n)return e.delegate=null,"throw"===i&&t.iterator.return&&(e.method="return",e.arg=void 0,x(t,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+i+"' method")),l;var s=u(n,t.iterator,e.arg);if("throw"===s.type)return e.method="throw",e.arg=s.arg,e.delegate=null,l;var r=s.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function M(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(M,this),this.reset(!0)}function E(t){if(t){var e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,s=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return s.next=s}}return{next:A}}function A(){return{value:void 0,done:!0}}return d.prototype=p,n(g,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:d,configurable:!0}),d.displayName=h(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,h(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(w.prototype),h(w.prototype,o,(function(){return this})),t.AsyncIterator=w,t.async=function(e,i,n,s,r){void 0===r&&(r=Promise);var o=new w(c(e,i,n,s),r);return t.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(g),h(g,a,"Generator"),h(g,r,(function(){return this})),h(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),i=[];for(var n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=E,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(i,n){return o.type="throw",o.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s],o=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var a=i.call(r,"catchLoc"),h=i.call(r,"finallyLoc");if(a&&h){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var r=s;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),T(i),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var s=n.arg;T(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:E(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),l}},t}("object"==typeof e?e.exports:{});try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},{}],493:[function(t,e,i){var n=t("buffer").Buffer,s=t("inherits"),r=t("hash-base"),o=new Array(16),a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],h=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],c=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],u=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],l=[0,1518500249,1859775393,2400959708,2840853838],f=[1352829926,1548603684,1836072691,2053994217,0];function d(){r.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(t,e){return t<<e|t>>>32-e}function m(t,e,i,n,s,r,o,a){return p(t+(e^i^n)+r+o|0,a)+s|0}function _(t,e,i,n,s,r,o,a){return p(t+(e&i|~e&n)+r+o|0,a)+s|0}function v(t,e,i,n,s,r,o,a){return p(t+((e|~i)^n)+r+o|0,a)+s|0}function g(t,e,i,n,s,r,o,a){return p(t+(e&n|i&~n)+r+o|0,a)+s|0}function b(t,e,i,n,s,r,o,a){return p(t+(e^(i|~n))+r+o|0,a)+s|0}s(d,r),d.prototype._update=function(){for(var t=o,e=0;e<16;++e)t[e]=this._block.readInt32LE(4*e);for(var i=0|this._a,n=0|this._b,s=0|this._c,r=0|this._d,d=0|this._e,w=0|this._a,y=0|this._b,x=0|this._c,M=0|this._d,T=0|this._e,O=0;O<80;O+=1){var E,A;O<16?(E=m(i,n,s,r,d,t[a[O]],l[0],c[O]),A=b(w,y,x,M,T,t[h[O]],f[0],u[O])):O<32?(E=_(i,n,s,r,d,t[a[O]],l[1],c[O]),A=g(w,y,x,M,T,t[h[O]],f[1],u[O])):O<48?(E=v(i,n,s,r,d,t[a[O]],l[2],c[O]),A=v(w,y,x,M,T,t[h[O]],f[2],u[O])):O<64?(E=g(i,n,s,r,d,t[a[O]],l[3],c[O]),A=_(w,y,x,M,T,t[h[O]],f[3],u[O])):(E=b(i,n,s,r,d,t[a[O]],l[4],c[O]),A=m(w,y,x,M,T,t[h[O]],f[4],u[O])),i=d,d=r,r=p(s,10),s=n,n=E,w=T,T=M,M=p(x,10),x=y,y=A}var S=this._b+s+M|0;this._b=this._c+r+T|0,this._c=this._d+d+w|0,this._d=this._e+i+y|0,this._e=this._a+n+x|0,this._a=S},d.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var t=n.alloc?n.alloc(20):new n(20);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t.writeInt32LE(this._e,16),t},e.exports=d},{buffer:220,"hash-base":425,inherits:440}],494:[function(t,e,i){/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var n=t("buffer"),s=n.Buffer;function r(t,e){for(var i in t)e[i]=t[i]}function o(t,e,i){return s(t,e,i)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=n:(r(n,i),i.Buffer=o),o.prototype=Object.create(s.prototype),r(s,o),o.from=function(t,e,i){if("number"==typeof t)throw new TypeError("Argument must not be a number");return s(t,e,i)},o.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=s(t);return void 0!==e?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return s(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:220}],495:[function(t,e,i){(function(i){(function(){var n,s=t("buffer"),r=s.Buffer,o={};for(n in s)s.hasOwnProperty(n)&&"SlowBuffer"!==n&&"Buffer"!==n&&(o[n]=s[n]);var a=o.Buffer={};for(n in r)r.hasOwnProperty(n)&&"allocUnsafe"!==n&&"allocUnsafeSlow"!==n&&(a[n]=r[n]);if(o.Buffer.prototype=r.prototype,a.from&&a.from!==Uint8Array.from||(a.from=function(t,e,i){if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof t);if(t&&void 0===t.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);return r(t,e,i)}),a.alloc||(a.alloc=function(t,e,i){if("number"!=typeof t)throw new TypeError('The "size" argument must be of type number. Received type '+typeof t);if(t<0||t>=2*(1<<30))throw new RangeError('The value "'+t+'" is invalid for option "size"');var n=r(t);return e&&0!==e.length?"string"==typeof i?n.fill(e,i):n.fill(e):n.fill(0),n}),!o.kStringMaxLength)try{o.kStringMaxLength=i.binding("buffer").kStringMaxLength}catch(t){}o.constants||(o.constants={MAX_LENGTH:o.kMaxLength},o.kStringMaxLength&&(o.constants.MAX_STRING_LENGTH=o.kStringMaxLength)),e.exports=o}).call(this)}).call(this,t("_process"))},{_process:467,buffer:220}],496:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0});const n=t("xmlchars/xml/1.0/ed5"),s=t("xmlchars/xml/1.1/ed2"),r=t("xmlchars/xmlns/1.0/ed3");var o=n.isS,a=n.isChar,h=n.isNameStartChar,c=n.isNameChar,u=n.S_LIST,l=n.NAME_RE,f=s.isChar,d=r.isNCNameStartChar,p=r.isNCNameChar,m=r.NC_NAME_RE;const _="http://www.w3.org/XML/1998/namespace",v="http://www.w3.org/2000/xmlns/",g={__proto__:null,xml:_,xmlns:v},b={__proto__:null,amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},w=t=>34===t||39===t,y=[34,39],x=[...y,91,62],M=[...y,60,93],T=[61,63,...u],O=[...u,62,38,60];function E(t,e,i){switch(e){case"xml":i!==_&&t.fail(`xml prefix must be bound to ${_}.`);break;case"xmlns":i!==v&&t.fail(`xmlns prefix must be bound to ${v}.`)}switch(i){case v:t.fail(""===e?`the default namespace may not be set to ${i}.`:`may not assign a prefix (even "xmlns") to the URI ${v}.`);break;case _:switch(e){case"xml":break;case"":t.fail(`the default namespace may not be set to ${i}.`);break;default:t.fail("may not assign the xml namespace to another prefix.")}}}const A=t=>m.test(t),S=t=>l.test(t);i.EVENTS=["xmldecl","text","processinginstruction","doctype","comment","opentagstart","attribute","opentag","closetag","cdata","error","end","ready"];const k={xmldecl:"xmldeclHandler",text:"textHandler",processinginstruction:"piHandler",doctype:"doctypeHandler",comment:"commentHandler",opentagstart:"openTagStartHandler",attribute:"attributeHandler",opentag:"openTagHandler",closetag:"closeTagHandler",cdata:"cdataHandler",error:"errorHandler",end:"endHandler",ready:"readyHandler"};i.SaxesParser=class{constructor(t){this.opt=null!=t?t:{},this.fragmentOpt=!!this.opt.fragment;const e=this.xmlnsOpt=!!this.opt.xmlns;if(this.trackPosition=!1!==this.opt.position,this.fileName=this.opt.fileName,e){this.nameStartCheck=d,this.nameCheck=p,this.isName=A,this.processAttribs=this.processAttribsNS,this.pushAttrib=this.pushAttribNS,this.ns=Object.assign({__proto__:null},g);const t=this.opt.additionalNamespaces;null!=t&&(!function(t,e){for(const i of Object.keys(e))E(t,i,e[i])}(this,t),Object.assign(this.ns,t))}else this.nameStartCheck=h,this.nameCheck=c,this.isName=S,this.processAttribs=this.processAttribsPlain,this.pushAttrib=this.pushAttribPlain;this.stateTable=[this.sBegin,this.sBeginWhitespace,this.sDoctype,this.sDoctypeQuote,this.sDTD,this.sDTDQuoted,this.sDTDOpenWaka,this.sDTDOpenWakaBang,this.sDTDComment,this.sDTDCommentEnding,this.sDTDCommentEnded,this.sDTDPI,this.sDTDPIEnding,this.sText,this.sEntity,this.sOpenWaka,this.sOpenWakaBang,this.sComment,this.sCommentEnding,this.sCommentEnded,this.sCData,this.sCDataEnding,this.sCDataEnding2,this.sPIFirstChar,this.sPIRest,this.sPIBody,this.sPIEnding,this.sXMLDeclNameStart,this.sXMLDeclName,this.sXMLDeclEq,this.sXMLDeclValueStart,this.sXMLDeclValue,this.sXMLDeclSeparator,this.sXMLDeclEnding,this.sOpenTag,this.sOpenTagSlash,this.sAttrib,this.sAttribName,this.sAttribNameSawWhite,this.sAttribValue,this.sAttribValueQuoted,this.sAttribValueClosed,this.sAttribValueUnquoted,this.sCloseTag,this.sCloseTagSawWhite],this._init()}get closed(){return this._closed}_init(){var t;this.openWakaBang="",this.text="",this.name="",this.piTarget="",this.entity="",this.q=null,this.tags=[],this.tag=null,this.topNS=null,this.chunk="",this.chunkPosition=0,this.i=0,this.prevI=0,this.carriedFromPrevious=void 0,this.forbiddenState=0,this.attribList=[];const{fragmentOpt:e}=this;this.state=e?13:0,this.reportedTextBeforeRoot=this.reportedTextAfterRoot=this.closedRoot=this.sawRoot=e,this.xmlDeclPossible=!e,this.xmlDeclExpects=["version"],this.entityReturnState=void 0;let{defaultXMLVersion:i}=this.opt;if(void 0===i){if(!0===this.opt.forceXMLVersion)throw new Error("forceXMLVersion set but defaultXMLVersion is not set");i="1.0"}this.setXMLVersion(i),this.positionAtNewLine=0,this.doctype=!1,this._closed=!1,this.xmlDecl={version:void 0,encoding:void 0,standalone:void 0},this.line=1,this.column=0,this.ENTITIES=Object.create(b),null===(t=this.readyHandler)||void 0===t||t.call(this)}get position(){return this.chunkPosition+this.i}get columnIndex(){return this.position-this.positionAtNewLine}on(t,e){this[k[t]]=e}off(t){this[k[t]]=void 0}makeError(t){var e;let i=null!==(e=this.fileName)&&void 0!==e?e:"";return this.trackPosition&&(i.length>0&&(i+=":"),i+=`${this.line}:${this.column}`),i.length>0&&(i+=": "),new Error(i+t)}fail(t){const e=this.makeError(t),i=this.errorHandler;if(void 0===i)throw e;return i(e),this}write(t){if(this.closed)return this.fail("cannot write after close; assign an onready handler.");let e=!1;null===t?(e=!0,t=""):"object"==typeof t&&(t=t.toString()),void 0!==this.carriedFromPrevious&&(t=`${this.carriedFromPrevious}${t}`,this.carriedFromPrevious=void 0);let i=t.length;const n=t.charCodeAt(i-1);!e&&(13===n||n>=55296&&n<=56319)&&(this.carriedFromPrevious=t[i-1],i--,t=t.slice(0,i));const{stateTable:s}=this;for(this.chunk=t,this.i=0;this.i<i;)s[this.state].call(this);return this.chunkPosition+=i,e?this.end():this}close(){return this.write(null)}getCode10(){const{chunk:t,i:e}=this;if(this.prevI=e,this.i=e+1,e>=t.length)return-1;const i=t.charCodeAt(e);if(this.column++,i<55296){if(i>=32||9===i)return i;switch(i){case 10:return this.line++,this.column=0,this.positionAtNewLine=this.position,10;case 13:return 10===t.charCodeAt(e+1)&&(this.i=e+2),this.line++,this.column=0,this.positionAtNewLine=this.position,-2;default:return this.fail("disallowed character."),i}}if(i>56319)return i>=57344&&i<=65533||this.fail("disallowed character."),i;const n=65536+1024*(i-55296)+(t.charCodeAt(e+1)-56320);return this.i=e+2,n>1114111&&this.fail("disallowed character."),n}getCode11(){const{chunk:t,i:e}=this;if(this.prevI=e,this.i=e+1,e>=t.length)return-1;const i=t.charCodeAt(e);if(this.column++,i<55296){if(i>31&&i<127||i>159&&8232!==i||9===i)return i;switch(i){case 10:return this.line++,this.column=0,this.positionAtNewLine=this.position,10;case 13:{const i=t.charCodeAt(e+1);10!==i&&133!==i||(this.i=e+2)}case 133:case 8232:return this.line++,this.column=0,this.positionAtNewLine=this.position,-2;default:return this.fail("disallowed character."),i}}if(i>56319)return i>=57344&&i<=65533||this.fail("disallowed character."),i;const n=65536+1024*(i-55296)+(t.charCodeAt(e+1)-56320);return this.i=e+2,n>1114111&&this.fail("disallowed character."),n}getCodeNorm(){const t=this.getCode();return-2===t?10:t}unget(){this.i=this.prevI,this.column--}captureTo(t){let{i:e}=this;const{chunk:i}=this;for(;;){const n=this.getCode(),s=-2===n,r=s?10:n;if(-1===r||t.includes(r))return this.text+=i.slice(e,this.prevI),r;s&&(this.text+=i.slice(e,this.prevI)+"\n",e=this.i)}}captureToChar(t){let{i:e}=this;const{chunk:i}=this;for(;;){let n=this.getCode();switch(n){case-2:this.text+=i.slice(e,this.prevI)+"\n",e=this.i,n=10;break;case-1:return this.text+=i.slice(e),!1}if(n===t)return this.text+=i.slice(e,this.prevI),!0}}captureNameChars(){const{chunk:t,i:e}=this;for(;;){const i=this.getCode();if(-1===i)return this.name+=t.slice(e),-1;if(!c(i))return this.name+=t.slice(e,this.prevI),-2===i?10:i}}skipSpaces(){for(;;){const t=this.getCodeNorm();if(-1===t||!o(t))return t}}setXMLVersion(t){this.currentXMLVersion=t,"1.0"===t?(this.isChar=a,this.getCode=this.getCode10):(this.isChar=f,this.getCode=this.getCode11)}sBegin(){65279===this.chunk.charCodeAt(0)&&(this.i++,this.column++),this.state=1}sBeginWhitespace(){const t=this.i,e=this.skipSpaces();switch(this.prevI!==t&&(this.xmlDeclPossible=!1),e){case 60:if(this.state=15,0!==this.text.length)throw new Error("no-empty text at start");break;case-1:break;default:this.unget(),this.state=13,this.xmlDeclPossible=!1}}sDoctype(){var t;const e=this.captureTo(x);switch(e){case 62:null===(t=this.doctypeHandler)||void 0===t||t.call(this,this.text),this.text="",this.state=13,this.doctype=!0;break;case-1:break;default:this.text+=String.fromCodePoint(e),91===e?this.state=4:w(e)&&(this.state=3,this.q=e)}}sDoctypeQuote(){const t=this.q;this.captureToChar(t)&&(this.text+=String.fromCodePoint(t),this.q=null,this.state=2)}sDTD(){const t=this.captureTo(M);-1!==t&&(this.text+=String.fromCodePoint(t),93===t?this.state=2:60===t?this.state=6:w(t)&&(this.state=5,this.q=t))}sDTDQuoted(){const t=this.q;this.captureToChar(t)&&(this.text+=String.fromCodePoint(t),this.state=4,this.q=null)}sDTDOpenWaka(){const t=this.getCodeNorm();switch(this.text+=String.fromCodePoint(t),t){case 33:this.state=7,this.openWakaBang="";break;case 63:this.state=11;break;default:this.state=4}}sDTDOpenWakaBang(){const t=String.fromCodePoint(this.getCodeNorm()),e=this.openWakaBang+=t;this.text+=t,"-"!==e&&(this.state="--"===e?8:4,this.openWakaBang="")}sDTDComment(){this.captureToChar(45)&&(this.text+="-",this.state=9)}sDTDCommentEnding(){const t=this.getCodeNorm();this.text+=String.fromCodePoint(t),this.state=45===t?10:8}sDTDCommentEnded(){const t=this.getCodeNorm();this.text+=String.fromCodePoint(t),62===t?this.state=4:(this.fail("malformed comment."),this.state=8)}sDTDPI(){this.captureToChar(63)&&(this.text+="?",this.state=12)}sDTDPIEnding(){const t=this.getCodeNorm();this.text+=String.fromCodePoint(t),62===t&&(this.state=4)}sText(){0!==this.tags.length?this.handleTextInRoot():this.handleTextOutsideRoot()}sEntity(){let{i:t}=this;const{chunk:e}=this;t:for(;;)switch(this.getCode()){case-2:this.entity+=e.slice(t,this.prevI)+"\n",t=this.i;break;case 59:{const{entityReturnState:i}=this,n=this.entity+e.slice(t,this.prevI);let s;this.state=i,""===n?(this.fail("empty entity name."),s="&;"):(s=this.parseEntity(n),this.entity=""),13===i&&void 0===this.textHandler||(this.text+=s);break t}case-1:this.entity+=e.slice(t);break t}}sOpenWaka(){const t=this.getCode();if(h(t))this.state=34,this.unget(),this.xmlDeclPossible=!1;else switch(t){case 47:this.state=43,this.xmlDeclPossible=!1;break;case 33:this.state=16,this.openWakaBang="",this.xmlDeclPossible=!1;break;case 63:this.state=23;break;default:this.fail("disallowed character in tag name"),this.state=13,this.xmlDeclPossible=!1}}sOpenWakaBang(){switch(this.openWakaBang+=String.fromCodePoint(this.getCodeNorm()),this.openWakaBang){case"[CDATA[":this.sawRoot||this.reportedTextBeforeRoot||(this.fail("text data outside of root node."),this.reportedTextBeforeRoot=!0),this.closedRoot&&!this.reportedTextAfterRoot&&(this.fail("text data outside of root node."),this.reportedTextAfterRoot=!0),this.state=20,this.openWakaBang="";break;case"--":this.state=17,this.openWakaBang="";break;case"DOCTYPE":this.state=2,(this.doctype||this.sawRoot)&&this.fail("inappropriately located doctype declaration."),this.openWakaBang="";break;default:this.openWakaBang.length>=7&&this.fail("incorrect syntax.")}}sComment(){this.captureToChar(45)&&(this.state=18)}sCommentEnding(){var t;const e=this.getCodeNorm();45===e?(this.state=19,null===(t=this.commentHandler)||void 0===t||t.call(this,this.text),this.text=""):(this.text+="-"+String.fromCodePoint(e),this.state=17)}sCommentEnded(){const t=this.getCodeNorm();62!==t?(this.fail("malformed comment."),this.text+="--"+String.fromCodePoint(t),this.state=17):this.state=13}sCData(){this.captureToChar(93)&&(this.state=21)}sCDataEnding(){const t=this.getCodeNorm();93===t?this.state=22:(this.text+="]"+String.fromCodePoint(t),this.state=20)}sCDataEnding2(){var t;const e=this.getCodeNorm();switch(e){case 62:null===(t=this.cdataHandler)||void 0===t||t.call(this,this.text),this.text="",this.state=13;break;case 93:this.text+="]";break;default:this.text+="]]"+String.fromCodePoint(e),this.state=20}}sPIFirstChar(){const t=this.getCodeNorm();this.nameStartCheck(t)?(this.piTarget+=String.fromCodePoint(t),this.state=24):63===t||o(t)?(this.fail("processing instruction without a target."),this.state=63===t?26:25):(this.fail("disallowed character in processing instruction name."),this.piTarget+=String.fromCodePoint(t),this.state=24)}sPIRest(){const{chunk:t,i:e}=this;for(;;){const i=this.getCodeNorm();if(-1===i)return void(this.piTarget+=t.slice(e));if(!this.nameCheck(i)){this.piTarget+=t.slice(e,this.prevI);const n=63===i;n||o(i)?"xml"===this.piTarget?(this.xmlDeclPossible||this.fail("an XML declaration must be at the start of the document."),this.state=n?33:27):this.state=n?26:25:(this.fail("disallowed character in processing instruction name."),this.piTarget+=String.fromCodePoint(i));break}}}sPIBody(){if(0===this.text.length){const t=this.getCodeNorm();63===t?this.state=26:o(t)||(this.text=String.fromCodePoint(t))}else this.captureToChar(63)&&(this.state=26)}sPIEnding(){var t;const e=this.getCodeNorm();if(62===e){const{piTarget:e}=this;"xml"===e.toLowerCase()&&this.fail("the XML declaration must appear at the start of the document."),null===(t=this.piHandler)||void 0===t||t.call(this,{target:e,body:this.text}),this.piTarget=this.text="",this.state=13}else 63===e?this.text+="?":(this.text+="?"+String.fromCodePoint(e),this.state=25);this.xmlDeclPossible=!1}sXMLDeclNameStart(){const t=this.skipSpaces();63!==t?-1!==t&&(this.state=28,this.name=String.fromCodePoint(t)):this.state=33}sXMLDeclName(){const t=this.captureTo(T);if(63===t)return this.state=33,this.name+=this.text,this.text="",void this.fail("XML declaration is incomplete.");if(o(t)||61===t){if(this.name+=this.text,this.text="",!this.xmlDeclExpects.includes(this.name))switch(this.name.length){case 0:this.fail("did not expect any more name/value pairs.");break;case 1:this.fail(`expected the name ${this.xmlDeclExpects[0]}.`);break;default:this.fail("expected one of "+this.xmlDeclExpects.join(", "))}this.state=61===t?30:29}}sXMLDeclEq(){const t=this.getCodeNorm();if(63===t)return this.state=33,void this.fail("XML declaration is incomplete.");o(t)||(61!==t&&this.fail("value required."),this.state=30)}sXMLDeclValueStart(){const t=this.getCodeNorm();if(63===t)return this.state=33,void this.fail("XML declaration is incomplete.");o(t)||(w(t)?this.q=t:(this.fail("value must be quoted."),this.q=32),this.state=31)}sXMLDeclValue(){const t=this.captureTo([this.q,63]);if(63===t)return this.state=33,this.text="",void this.fail("XML declaration is incomplete.");if(-1===t)return;const e=this.text;switch(this.text="",this.name){case"version":{this.xmlDeclExpects=["encoding","standalone"];const t=e;this.xmlDecl.version=t,/^1\.[0-9]+$/.test(t)?this.opt.forceXMLVersion||this.setXMLVersion(t):this.fail("version number must match /^1\\.[0-9]+$/.");break}case"encoding":/^[A-Za-z][A-Za-z0-9._-]*$/.test(e)||this.fail("encoding value must match /^[A-Za-z0-9][A-Za-z0-9._-]*$/."),this.xmlDeclExpects=["standalone"],this.xmlDecl.encoding=e;break;case"standalone":"yes"!==e&&"no"!==e&&this.fail('standalone value must match "yes" or "no".'),this.xmlDeclExpects=[],this.xmlDecl.standalone=e}this.name="",this.state=32}sXMLDeclSeparator(){const t=this.getCodeNorm();63!==t?(o(t)||(this.fail("whitespace required."),this.unget()),this.state=27):this.state=33}sXMLDeclEnding(){var t;62===this.getCodeNorm()?("xml"!==this.piTarget?this.fail("processing instructions are not allowed before root."):"version"!==this.name&&this.xmlDeclExpects.includes("version")&&this.fail("XML declaration must contain a version."),null===(t=this.xmldeclHandler)||void 0===t||t.call(this,this.xmlDecl),this.name="",this.piTarget=this.text="",this.state=13):this.fail("The character ? is disallowed anywhere in XML declarations."),this.xmlDeclPossible=!1}sOpenTag(){var t;const e=this.captureNameChars();if(-1===e)return;const i=this.tag={name:this.name,attributes:Object.create(null)};switch(this.name="",this.xmlnsOpt&&(this.topNS=i.ns=Object.create(null)),null===(t=this.openTagStartHandler)||void 0===t||t.call(this,i),this.sawRoot=!0,!this.fragmentOpt&&this.closedRoot&&this.fail("documents may contain only one root."),e){case 62:this.openTag();break;case 47:this.state=35;break;default:o(e)||this.fail("disallowed character in tag name."),this.state=36}}sOpenTagSlash(){62===this.getCode()?this.openSelfClosingTag():(this.fail("forward-slash in opening tag not followed by >."),this.state=36)}sAttrib(){const t=this.skipSpaces();-1!==t&&(h(t)?(this.unget(),this.state=37):62===t?this.openTag():47===t?this.state=35:this.fail("disallowed character in attribute name."))}sAttribName(){const t=this.captureNameChars();61===t?this.state=39:o(t)?this.state=38:62===t?(this.fail("attribute without value."),this.pushAttrib(this.name,this.name),this.name=this.text="",this.openTag()):-1!==t&&this.fail("disallowed character in attribute name.")}sAttribNameSawWhite(){const t=this.skipSpaces();switch(t){case-1:return;case 61:this.state=39;break;default:this.fail("attribute without value."),this.text="",this.name="",62===t?this.openTag():h(t)?(this.unget(),this.state=37):(this.fail("disallowed character in attribute name."),this.state=36)}}sAttribValue(){const t=this.getCodeNorm();w(t)?(this.q=t,this.state=40):o(t)||(this.fail("unquoted attribute value."),this.state=42,this.unget())}sAttribValueQuoted(){const{q:t,chunk:e}=this;let{i}=this;for(;;)switch(this.getCode()){case t:return this.pushAttrib(this.name,this.text+e.slice(i,this.prevI)),this.name=this.text="",this.q=null,void(this.state=41);case 38:return this.text+=e.slice(i,this.prevI),this.state=14,void(this.entityReturnState=40);case 10:case-2:case 9:this.text+=e.slice(i,this.prevI)+" ",i=this.i;break;case 60:return this.text+=e.slice(i,this.prevI),void this.fail("disallowed character.");case-1:return void(this.text+=e.slice(i))}}sAttribValueClosed(){const t=this.getCodeNorm();o(t)?this.state=36:62===t?this.openTag():47===t?this.state=35:h(t)?(this.fail("no whitespace between attributes."),this.unget(),this.state=37):this.fail("disallowed character in attribute name.")}sAttribValueUnquoted(){const t=this.captureTo(O);switch(t){case 38:this.state=14,this.entityReturnState=42;break;case 60:this.fail("disallowed character.");break;case-1:break;default:this.text.includes("]]>")&&this.fail('the string "]]>" is disallowed in char data.'),this.pushAttrib(this.name,this.text),this.name=this.text="",62===t?this.openTag():this.state=36}}sCloseTag(){const t=this.captureNameChars();62===t?this.closeTag():o(t)?this.state=44:-1!==t&&this.fail("disallowed character in closing tag.")}sCloseTagSawWhite(){switch(this.skipSpaces()){case 62:this.closeTag();break;case-1:break;default:this.fail("disallowed character in closing tag.")}}handleTextInRoot(){let{i:t,forbiddenState:e}=this;const{chunk:i,textHandler:n}=this;t:for(;;)switch(this.getCode()){case 60:if(this.state=15,void 0!==n){const{text:e}=this,s=i.slice(t,this.prevI);0!==e.length?(n(e+s),this.text=""):0!==s.length&&n(s)}e=0;break t;case 38:this.state=14,this.entityReturnState=13,void 0!==n&&(this.text+=i.slice(t,this.prevI)),e=0;break t;case 93:switch(e){case 0:e=1;break;case 1:e=2;break;case 2:break;default:throw new Error("impossible state")}break;case 62:2===e&&this.fail('the string "]]>" is disallowed in char data.'),e=0;break;case-2:void 0!==n&&(this.text+=i.slice(t,this.prevI)+"\n"),t=this.i,e=0;break;case-1:void 0!==n&&(this.text+=i.slice(t));break t;default:e=0}this.forbiddenState=e}handleTextOutsideRoot(){let{i:t}=this;const{chunk:e,textHandler:i}=this;let n=!1;t:for(;;){const s=this.getCode();switch(s){case 60:if(this.state=15,void 0!==i){const{text:n}=this,s=e.slice(t,this.prevI);0!==n.length?(i(n+s),this.text=""):0!==s.length&&i(s)}break t;case 38:this.state=14,this.entityReturnState=13,void 0!==i&&(this.text+=e.slice(t,this.prevI)),n=!0;break t;case-2:void 0!==i&&(this.text+=e.slice(t,this.prevI)+"\n"),t=this.i;break;case-1:void 0!==i&&(this.text+=e.slice(t));break t;default:o(s)||(n=!0)}}n&&(this.sawRoot||this.reportedTextBeforeRoot||(this.fail("text data outside of root node."),this.reportedTextBeforeRoot=!0),this.closedRoot&&!this.reportedTextAfterRoot&&(this.fail("text data outside of root node."),this.reportedTextAfterRoot=!0))}pushAttribNS(t,e){var i;const{prefix:n,local:s}=this.qname(t),r={name:t,prefix:n,local:s,value:e};if(this.attribList.push(r),null===(i=this.attributeHandler)||void 0===i||i.call(this,r),"xmlns"===n){const t=e.trim();"1.0"===this.currentXMLVersion&&""===t&&this.fail("invalid attempt to undefine prefix in XML 1.0"),this.topNS[s]=t,E(this,s,t)}else if("xmlns"===t){const t=e.trim();this.topNS[""]=t,E(this,"",t)}}pushAttribPlain(t,e){var i;const n={name:t,value:e};this.attribList.push(n),null===(i=this.attributeHandler)||void 0===i||i.call(this,n)}end(){var t,e;this.sawRoot||this.fail("document must contain a root element.");const{tags:i}=this;for(;i.length>0;){const t=i.pop();this.fail("unclosed tag: "+t.name)}0!==this.state&&13!==this.state&&this.fail("unexpected end.");const{text:n}=this;return 0!==n.length&&(null===(t=this.textHandler)||void 0===t||t.call(this,n),this.text=""),this._closed=!0,null===(e=this.endHandler)||void 0===e||e.call(this),this._init(),this}resolve(t){var e,i;let n=this.topNS[t];if(void 0!==n)return n;const{tags:s}=this;for(let e=s.length-1;e>=0;e--)if(n=s[e].ns[t],void 0!==n)return n;return n=this.ns[t],void 0!==n?n:null===(i=(e=this.opt).resolvePrefix)||void 0===i?void 0:i.call(e,t)}qname(t){const e=t.indexOf(":");if(-1===e)return{prefix:"",local:t};const i=t.slice(e+1),n=t.slice(0,e);return(""===n||""===i||i.includes(":"))&&this.fail(`malformed name: ${t}.`),{prefix:n,local:i}}processAttribsNS(){var t;const{attribList:e}=this,i=this.tag;{const{prefix:e,local:n}=this.qname(i.name);i.prefix=e,i.local=n;const s=i.uri=null!==(t=this.resolve(e))&&void 0!==t?t:"";""!==e&&("xmlns"===e&&this.fail('tags may not have "xmlns" as prefix.'),""===s&&(this.fail(`unbound namespace prefix: ${JSON.stringify(e)}.`),i.uri=e))}if(0===e.length)return;const{attributes:n}=i,s=new Set;for(const t of e){const{name:e,prefix:i,local:r}=t;let o,a;""===i?(o="xmlns"===e?v:"",a=e):(o=this.resolve(i),void 0===o&&(this.fail(`unbound namespace prefix: ${JSON.stringify(i)}.`),o=i),a=`{${o}}${r}`),s.has(a)&&this.fail(`duplicate attribute: ${a}.`),s.add(a),t.uri=o,n[e]=t}this.attribList=[]}processAttribsPlain(){const{attribList:t}=this,e=this.tag.attributes;for(const{name:i,value:n}of t)void 0!==e[i]&&this.fail(`duplicate attribute: ${i}.`),e[i]=n;this.attribList=[]}openTag(){var t;this.processAttribs();const{tags:e}=this,i=this.tag;i.isSelfClosing=!1,null===(t=this.openTagHandler)||void 0===t||t.call(this,i),e.push(i),this.state=13,this.name=""}openSelfClosingTag(){var t,e,i;this.processAttribs();const{tags:n}=this,s=this.tag;s.isSelfClosing=!0,null===(t=this.openTagHandler)||void 0===t||t.call(this,s),null===(e=this.closeTagHandler)||void 0===e||e.call(this,s);null===(this.tag=null!==(i=n[n.length-1])&&void 0!==i?i:null)&&(this.closedRoot=!0),this.state=13,this.name=""}closeTag(){const{tags:t,name:e}=this;if(this.state=13,this.name="",""===e)return this.fail("weird empty close tag."),void(this.text+="</>");const i=this.closeTagHandler;let n=t.length;for(;n-- >0;){const n=this.tag=t.pop();if(this.topNS=n.ns,null==i||i(n),n.name===e)break;this.fail("unexpected close tag.")}0===n?this.closedRoot=!0:n<0&&(this.fail(`unmatched closing tag: ${e}.`),this.text+=`</${e}>`)}parseEntity(t){if("#"!==t[0]){const e=this.ENTITIES[t];return void 0!==e?e:(this.fail(this.isName(t)?"undefined entity.":"disallowed character in entity name."),`&${t};`)}let e=NaN;return"x"===t[1]&&/^#x[0-9a-f]+$/i.test(t)?e=parseInt(t.slice(2),16):/^#[0-9]+$/.test(t)&&(e=parseInt(t.slice(1),10)),this.isChar(e)?String.fromCodePoint(e):(this.fail("malformed character entity."),`&${t};`)}}},{"xmlchars/xml/1.0/ed5":543,"xmlchars/xml/1.1/ed2":544,"xmlchars/xmlns/1.0/ed3":545}],497:[function(t,e,i){var n=t("safe-buffer").Buffer;function s(t,e){this._block=n.alloc(t),this._finalSize=e,this._blockSize=t,this._len=0}s.prototype.update=function(t,e){"string"==typeof t&&(e=e||"utf8",t=n.from(t,e));for(var i=this._block,s=this._blockSize,r=t.length,o=this._len,a=0;a<r;){for(var h=o%s,c=Math.min(r-a,s-h),u=0;u<c;u++)i[h+u]=t[a+u];a+=c,(o+=c)%s==0&&this._update(i)}return this._len+=r,this},s.prototype.digest=function(t){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var i=8*this._len;if(i<=4294967295)this._block.writeUInt32BE(i,this._blockSize-4);else{var n=(4294967295&i)>>>0,s=(i-n)/4294967296;this._block.writeUInt32BE(s,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)}this._update(this._block);var r=this._hash();return t?r.toString(t):r},s.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=s},{"safe-buffer":494}],498:[function(t,e,i){var n=e.exports=function(t){t=t.toLowerCase();var e=n[t];if(!e)throw new Error(t+" is not supported (we accept pull requests)");return new e};n.sha=t("./sha"),n.sha1=t("./sha1"),n.sha224=t("./sha224"),n.sha256=t("./sha256"),n.sha384=t("./sha384"),n.sha512=t("./sha512")},{"./sha":499,"./sha1":500,"./sha224":501,"./sha256":502,"./sha384":503,"./sha512":504}],499:[function(t,e,i){var n=t("inherits"),s=t("./hash"),r=t("safe-buffer").Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function h(){this.init(),this._w=a,s.call(this,64,56)}function c(t){return t<<30|t>>>2}function u(t,e,i,n){return 0===t?e&i|~e&n:2===t?e&i|e&n|i&n:e^i^n}n(h,s),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(t){for(var e,i=this._w,n=0|this._a,s=0|this._b,r=0|this._c,a=0|this._d,h=0|this._e,l=0;l<16;++l)i[l]=t.readInt32BE(4*l);for(;l<80;++l)i[l]=i[l-3]^i[l-8]^i[l-14]^i[l-16];for(var f=0;f<80;++f){var d=~~(f/20),p=0|((e=n)<<5|e>>>27)+u(d,s,r,a)+h+i[f]+o[d];h=a,a=r,r=c(s),s=n,n=p}this._a=n+this._a|0,this._b=s+this._b|0,this._c=r+this._c|0,this._d=a+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var t=r.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t},e.exports=h},{"./hash":497,inherits:440,"safe-buffer":494}],500:[function(t,e,i){var n=t("inherits"),s=t("./hash"),r=t("safe-buffer").Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function h(){this.init(),this._w=a,s.call(this,64,56)}function c(t){return t<<5|t>>>27}function u(t){return t<<30|t>>>2}function l(t,e,i,n){return 0===t?e&i|~e&n:2===t?e&i|e&n|i&n:e^i^n}n(h,s),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(t){for(var e,i=this._w,n=0|this._a,s=0|this._b,r=0|this._c,a=0|this._d,h=0|this._e,f=0;f<16;++f)i[f]=t.readInt32BE(4*f);for(;f<80;++f)i[f]=(e=i[f-3]^i[f-8]^i[f-14]^i[f-16])<<1|e>>>31;for(var d=0;d<80;++d){var p=~~(d/20),m=c(n)+l(p,s,r,a)+h+i[d]+o[p]|0;h=a,a=r,r=u(s),s=n,n=m}this._a=n+this._a|0,this._b=s+this._b|0,this._c=r+this._c|0,this._d=a+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var t=r.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t},e.exports=h},{"./hash":497,inherits:440,"safe-buffer":494}],501:[function(t,e,i){var n=t("inherits"),s=t("./sha256"),r=t("./hash"),o=t("safe-buffer").Buffer,a=new Array(64);function h(){this.init(),this._w=a,r.call(this,64,56)}n(h,s),h.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},h.prototype._hash=function(){var t=o.allocUnsafe(28);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t},e.exports=h},{"./hash":497,"./sha256":502,inherits:440,"safe-buffer":494}],502:[function(t,e,i){var n=t("inherits"),s=t("./hash"),r=t("safe-buffer").Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function h(){this.init(),this._w=a,s.call(this,64,56)}function c(t,e,i){return i^t&(e^i)}function u(t,e,i){return t&e|i&(t|e)}function l(t){return(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10)}function f(t){return(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7)}function d(t){return(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3}n(h,s),h.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},h.prototype._update=function(t){for(var e,i=this._w,n=0|this._a,s=0|this._b,r=0|this._c,a=0|this._d,h=0|this._e,p=0|this._f,m=0|this._g,_=0|this._h,v=0;v<16;++v)i[v]=t.readInt32BE(4*v);for(;v<64;++v)i[v]=0|(((e=i[v-2])>>>17|e<<15)^(e>>>19|e<<13)^e>>>10)+i[v-7]+d(i[v-15])+i[v-16];for(var g=0;g<64;++g){var b=_+f(h)+c(h,p,m)+o[g]+i[g]|0,w=l(n)+u(n,s,r)|0;_=m,m=p,p=h,h=a+b|0,a=r,r=s,s=n,n=b+w|0}this._a=n+this._a|0,this._b=s+this._b|0,this._c=r+this._c|0,this._d=a+this._d|0,this._e=h+this._e|0,this._f=p+this._f|0,this._g=m+this._g|0,this._h=_+this._h|0},h.prototype._hash=function(){var t=r.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t},e.exports=h},{"./hash":497,inherits:440,"safe-buffer":494}],503:[function(t,e,i){var n=t("inherits"),s=t("./sha512"),r=t("./hash"),o=t("safe-buffer").Buffer,a=new Array(160);function h(){this.init(),this._w=a,r.call(this,128,112)}n(h,s),h.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},h.prototype._hash=function(){var t=o.allocUnsafe(48);function e(e,i,n){t.writeInt32BE(e,n),t.writeInt32BE(i,n+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),t},e.exports=h},{"./hash":497,"./sha512":504,inherits:440,"safe-buffer":494}],504:[function(t,e,i){var n=t("inherits"),s=t("./hash"),r=t("safe-buffer").Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function h(){this.init(),this._w=a,s.call(this,128,112)}function c(t,e,i){return i^t&(e^i)}function u(t,e,i){return t&e|i&(t|e)}function l(t,e){return(t>>>28|e<<4)^(e>>>2|t<<30)^(e>>>7|t<<25)}function f(t,e){return(t>>>14|e<<18)^(t>>>18|e<<14)^(e>>>9|t<<23)}function d(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^t>>>7}function p(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^(t>>>7|e<<25)}function m(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^t>>>6}function _(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^(t>>>6|e<<26)}function v(t,e){return t>>>0<e>>>0?1:0}n(h,s),h.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},h.prototype._update=function(t){for(var e=this._w,i=0|this._ah,n=0|this._bh,s=0|this._ch,r=0|this._dh,a=0|this._eh,h=0|this._fh,g=0|this._gh,b=0|this._hh,w=0|this._al,y=0|this._bl,x=0|this._cl,M=0|this._dl,T=0|this._el,O=0|this._fl,E=0|this._gl,A=0|this._hl,S=0;S<32;S+=2)e[S]=t.readInt32BE(4*S),e[S+1]=t.readInt32BE(4*S+4);for(;S<160;S+=2){var k=e[S-30],I=e[S-30+1],C=d(k,I),j=p(I,k),D=m(k=e[S-4],I=e[S-4+1]),R=_(I,k),P=e[S-14],N=e[S-14+1],F=e[S-32],z=e[S-32+1],L=j+N|0,$=C+P+v(L,j)|0;$=($=$+D+v(L=L+R|0,R)|0)+F+v(L=L+z|0,z)|0,e[S]=$,e[S+1]=L}for(var U=0;U<160;U+=2){$=e[U],L=e[U+1];var B=u(i,n,s),G=u(w,y,x),H=l(i,w),V=l(w,i),W=f(a,T),q=f(T,a),Y=o[U],X=o[U+1],Z=c(a,h,g),J=c(T,O,E),K=A+q|0,Q=b+W+v(K,A)|0;Q=(Q=(Q=Q+Z+v(K=K+J|0,J)|0)+Y+v(K=K+X|0,X)|0)+$+v(K=K+L|0,L)|0;var tt=V+G|0,et=H+B+v(tt,V)|0;b=g,A=E,g=h,E=O,h=a,O=T,a=r+Q+v(T=M+K|0,M)|0,r=s,M=x,s=n,x=y,n=i,y=w,i=Q+et+v(w=K+tt|0,K)|0}this._al=this._al+w|0,this._bl=this._bl+y|0,this._cl=this._cl+x|0,this._dl=this._dl+M|0,this._el=this._el+T|0,this._fl=this._fl+O|0,this._gl=this._gl+E|0,this._hl=this._hl+A|0,this._ah=this._ah+i+v(this._al,w)|0,this._bh=this._bh+n+v(this._bl,y)|0,this._ch=this._ch+s+v(this._cl,x)|0,this._dh=this._dh+r+v(this._dl,M)|0,this._eh=this._eh+a+v(this._el,T)|0,this._fh=this._fh+h+v(this._fl,O)|0,this._gh=this._gh+g+v(this._gl,E)|0,this._hh=this._hh+b+v(this._hl,A)|0},h.prototype._hash=function(){var t=r.allocUnsafe(64);function e(e,i,n){t.writeInt32BE(e,n),t.writeInt32BE(i,n+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),t},e.exports=h},{"./hash":497,inherits:440,"safe-buffer":494}],505:[function(t,e,i){e.exports=s;var n=t("events").EventEmitter;function s(){n.call(this)}t("inherits")(s,n),s.Readable=t("readable-stream/readable.js"),s.Writable=t("readable-stream/writable.js"),s.Duplex=t("readable-stream/duplex.js"),s.Transform=t("readable-stream/transform.js"),s.PassThrough=t("readable-stream/passthrough.js"),s.Stream=s,s.prototype.pipe=function(t,e){var i=this;function s(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function r(){i.readable&&i.resume&&i.resume()}i.on("data",s),t.on("drain",r),t._isStdio||e&&!1===e.end||(i.on("end",a),i.on("close",h));var o=!1;function a(){o||(o=!0,t.end())}function h(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function c(t){if(u(),0===n.listenerCount(this,"error"))throw t}function u(){i.removeListener("data",s),t.removeListener("drain",r),i.removeListener("end",a),i.removeListener("close",h),i.removeListener("error",c),t.removeListener("error",c),i.removeListener("end",u),i.removeListener("close",u),t.removeListener("close",u)}return i.on("error",c),t.on("error",c),i.on("end",u),i.on("close",u),t.on("close",u),t.emit("pipe",i),t}},{events:422,inherits:440,"readable-stream/duplex.js":507,"readable-stream/passthrough.js":516,"readable-stream/readable.js":517,"readable-stream/transform.js":518,"readable-stream/writable.js":519}],506:[function(t,e,i){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],507:[function(t,e,i){e.exports=t("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":508}],508:[function(t,e,i){var n=t("process-nextick-args"),s=Object.keys||function(t){var e=[];for(var i in t)e.push(i);return e};e.exports=l;var r=Object.create(t("core-util-is"));r.inherits=t("inherits");var o=t("./_stream_readable"),a=t("./_stream_writable");r.inherits(l,o);for(var h=s(a.prototype),c=0;c<h.length;c++){var u=h[c];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(t){if(!(this instanceof l))return new l(t);o.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||n.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),l.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},{"./_stream_readable":510,"./_stream_writable":512,"core-util-is":383,inherits:440,"process-nextick-args":466}],509:[function(t,e,i){e.exports=r;var n=t("./_stream_transform"),s=Object.create(t("core-util-is"));function r(t){if(!(this instanceof r))return new r(t);n.call(this,t)}s.inherits=t("inherits"),s.inherits(r,n),r.prototype._transform=function(t,e,i){i(null,t)}},{"./_stream_transform":511,"core-util-is":383,inherits:440}],510:[function(t,e,i){(function(i,n){(function(){var s=t("process-nextick-args");e.exports=b;var r,o=t("isarray");b.ReadableState=g;t("events").EventEmitter;var a=function(t,e){return t.listeners(e).length},h=t("./internal/streams/stream"),c=t("safe-buffer").Buffer,u=(void 0!==n?n:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var l=Object.create(t("core-util-is"));l.inherits=t("inherits");var f=t("util"),d=void 0;d=f&&f.debuglog?f.debuglog("stream"):function(){};var p,m=t("./internal/streams/BufferList"),_=t("./internal/streams/destroy");l.inherits(b,h);var v=["error","close","destroy","pause","resume"];function g(e,i){e=e||{};var n=i instanceof(r=r||t("./_stream_duplex"));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var s=e.highWaterMark,o=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:n&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=t("string_decoder/").StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function b(e){if(r=r||t("./_stream_duplex"),!(this instanceof b))return new b(e);this._readableState=new g(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),h.call(this)}function w(t,e,i,n,s){var r,o=t._readableState;null===e?(o.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var i=e.decoder.end();i&&i.length&&(e.buffer.push(i),e.length+=e.objectMode?1:i.length)}e.ended=!0,M(t)}(t,o)):(s||(r=function(t,e){var i;n=e,c.isBuffer(n)||n instanceof u||"string"==typeof e||void 0===e||t.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));var n;return i}(o,e)),r?t.emit("error",r):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=function(t){return c.from(t)}(e)),n?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):y(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!i?(e=o.decoder.write(e),o.objectMode||0!==e.length?y(t,o,e,!1):O(t,o)):y(t,o,e,!1))):n||(o.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(o)}function y(t,e,i,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",i),t.read(0)):(e.length+=e.objectMode?1:i.length,n?e.buffer.unshift(i):e.buffer.push(i),e.needReadable&&M(t)),O(t,e)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),b.prototype.destroy=_.destroy,b.prototype._undestroy=_.undestroy,b.prototype._destroy=function(t,e){this.push(null),e(t)},b.prototype.push=function(t,e){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=c.from(t,e),e=""),i=!0),w(this,t,e,!1,i)},b.prototype.unshift=function(t){return w(this,t,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=t("string_decoder/").StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};function x(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=8388608?t=8388608:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function M(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(d("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?s.nextTick(T,t):T(t))}function T(t){d("emit readable"),t.emit("readable"),k(t)}function O(t,e){e.readingMore||(e.readingMore=!0,s.nextTick(E,t,e))}function E(t,e){for(var i=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(d("maybeReadMore read 0"),t.read(0),i!==e.length);)i=e.length;e.readingMore=!1}function A(t){d("readable nexttick read 0"),t.read(0)}function S(t,e){e.reading||(d("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),k(t),e.flowing&&!e.reading&&t.read(0)}function k(t){var e=t._readableState;for(d("flow",e.flowing);e.flowing&&null!==t.read(););}function I(t,e){return 0===e.length?null:(e.objectMode?i=e.buffer.shift():!t||t>=e.length?(i=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):i=function(t,e,i){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():i?function(t,e){var i=e.head,n=1,s=i.data;t-=s.length;for(;i=i.next;){var r=i.data,o=t>r.length?r.length:t;if(o===r.length?s+=r:s+=r.slice(0,t),0===(t-=o)){o===r.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=r.slice(o));break}++n}return e.length-=n,s}(t,e):function(t,e){var i=c.allocUnsafe(t),n=e.head,s=1;n.data.copy(i),t-=n.data.length;for(;n=n.next;){var r=n.data,o=t>r.length?r.length:t;if(r.copy(i,i.length-t,0,o),0===(t-=o)){o===r.length?(++s,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=r.slice(o));break}++s}return e.length-=s,i}(t,e);return n}(t,e.buffer,e.decoder),i);var i}function C(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,s.nextTick(j,e,t))}function j(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function D(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1}b.prototype.read=function(t){d("read",t),t=parseInt(t,10);var e=this._readableState,i=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return d("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?C(this):M(this),null;if(0===(t=x(t,e))&&e.ended)return 0===e.length&&C(this),null;var n,s=e.needReadable;return d("need readable",s),(0===e.length||e.length-t<e.highWaterMark)&&d("length less than watermark",s=!0),e.ended||e.reading?d("reading or ended",s=!1):s&&(d("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=x(i,e))),null===(n=t>0?I(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),i!==t&&e.ended&&C(this)),null!==n&&this.emit("data",n),n},b.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,d("pipe count=%d opts=%j",r.pipesCount,e);var h=(!e||!1!==e.end)&&t!==i.stdout&&t!==i.stderr?u:b;function c(e,i){d("onunpipe"),e===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,d("cleanup"),t.removeListener("close",v),t.removeListener("finish",g),t.removeListener("drain",l),t.removeListener("error",_),t.removeListener("unpipe",c),n.removeListener("end",u),n.removeListener("end",b),n.removeListener("data",m),f=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||l())}function u(){d("onend"),t.end()}r.endEmitted?s.nextTick(h):n.once("end",h),t.on("unpipe",c);var l=function(t){return function(){var e=t._readableState;d("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,k(t))}}(n);t.on("drain",l);var f=!1;var p=!1;function m(e){d("ondata"),p=!1,!1!==t.write(e)||p||((1===r.pipesCount&&r.pipes===t||r.pipesCount>1&&-1!==D(r.pipes,t))&&!f&&(d("false write response, pause",r.awaitDrain),r.awaitDrain++,p=!0),n.pause())}function _(e){d("onerror",e),b(),t.removeListener("error",_),0===a(t,"error")&&t.emit("error",e)}function v(){t.removeListener("finish",g),b()}function g(){d("onfinish"),t.removeListener("close",v),b()}function b(){d("unpipe"),n.unpipe(t)}return n.on("data",m),function(t,e,i){if("function"==typeof t.prependListener)return t.prependListener(e,i);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(i):t._events[e]=[i,t._events[e]]:t.on(e,i)}(t,"error",_),t.once("close",v),t.once("finish",g),t.emit("pipe",n),r.flowing||(d("pipe resume"),n.resume()),t},b.prototype.unpipe=function(t){var e=this._readableState,i={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,i)),this;if(!t){var n=e.pipes,s=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var r=0;r<s;r++)n[r].emit("unpipe",this,{hasUnpiped:!1});return this}var o=D(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,i)),this},b.prototype.on=function(t,e){var i=h.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&M(this):s.nextTick(A,this))}return i},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,s.nextTick(S,t,e))}(this,t)),this},b.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(t){var e=this,i=this._readableState,n=!1;for(var s in t.on("end",(function(){if(d("wrapped end"),i.decoder&&!i.ended){var t=i.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(s){(d("wrapped data"),i.decoder&&(s=i.decoder.write(s)),i.objectMode&&null==s)||(i.objectMode||s&&s.length)&&(e.push(s)||(n=!0,t.pause()))})),t)void 0===this[s]&&"function"==typeof t[s]&&(this[s]=function(e){return function(){return t[e].apply(t,arguments)}}(s));for(var r=0;r<v.length;r++)t.on(v[r],this.emit.bind(this,v[r]));return this._read=function(e){d("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=I}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":508,"./internal/streams/BufferList":513,"./internal/streams/destroy":514,"./internal/streams/stream":515,_process:467,"core-util-is":383,events:422,inherits:440,isarray:506,"process-nextick-args":466,"safe-buffer":520,"string_decoder/":521,util:188}],511:[function(t,e,i){e.exports=o;var n=t("./_stream_duplex"),s=Object.create(t("core-util-is"));function r(t,e){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=e&&this.push(e),n(t);var s=this._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}function o(t){if(!(this instanceof o))return new o(t);n.call(this,t),this._transformState={afterTransform:r.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush((function(e,i){h(t,e,i)})):h(this,null,null)}function h(t,e,i){if(e)return t.emit("error",e);if(null!=i&&t.push(i),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}s.inherits=t("inherits"),s.inherits(o,n),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,i){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,i){var n=this._transformState;if(n.writecb=i,n.writechunk=t,n.writeencoding=e,!n.transforming){var s=this._readableState;(n.needTransform||s.needReadable||s.length<s.highWaterMark)&&this._read(s.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var i=this;n.prototype._destroy.call(this,t,(function(t){e(t),i.emit("close")}))}},{"./_stream_duplex":508,"core-util-is":383,inherits:440}],512:[function(t,e,i){(function(i,n,s){(function(){var r=t("process-nextick-args");function o(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,i){var n=t.entry;t.entry=null;for(;n;){var s=n.callback;e.pendingcb--,s(i),n=n.next}e.corkedRequestsFree.next=t}(e,t)}}e.exports=g;var a,h=!i.browser&&["v0.10","v0.9."].indexOf(i.version.slice(0,5))>-1?s:r.nextTick;g.WritableState=v;var c=Object.create(t("core-util-is"));c.inherits=t("inherits");var u={deprecate:t("util-deprecate")},l=t("./internal/streams/stream"),f=t("safe-buffer").Buffer,d=(void 0!==n?n:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){};var p,m=t("./internal/streams/destroy");function _(){}function v(e,i){a=a||t("./_stream_duplex"),e=e||{};var n=i instanceof a;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var s=e.highWaterMark,c=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=s||0===s?s:n&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var i=t._writableState,n=i.sync,s=i.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(i),e)!function(t,e,i,n,s){--e.pendingcb,i?(r.nextTick(s,n),r.nextTick(T,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(s(n),t._writableState.errorEmitted=!0,t.emit("error",n),T(t,e))}(t,i,n,e,s);else{var o=x(i);o||i.corked||i.bufferProcessing||!i.bufferedRequest||y(t,i),n?h(w,t,i,o,s):w(t,i,o,s)}}(i,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function g(e){if(a=a||t("./_stream_duplex"),!(p.call(g,this)||this instanceof a))return new g(e);this._writableState=new v(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),l.call(this)}function b(t,e,i,n,s,r,o){e.writelen=n,e.writecb=o,e.writing=!0,e.sync=!0,i?t._writev(s,e.onwrite):t._write(s,r,e.onwrite),e.sync=!1}function w(t,e,i,n){i||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),T(t,e)}function y(t,e){e.bufferProcessing=!0;var i=e.bufferedRequest;if(t._writev&&i&&i.next){var n=e.bufferedRequestCount,s=new Array(n),r=e.corkedRequestsFree;r.entry=i;for(var a=0,h=!0;i;)s[a]=i,i.isBuf||(h=!1),i=i.next,a+=1;s.allBuffers=h,b(t,e,!0,e.length,s,"",r.finish),e.pendingcb++,e.lastBufferedRequest=null,r.next?(e.corkedRequestsFree=r.next,r.next=null):e.corkedRequestsFree=new o(e),e.bufferedRequestCount=0}else{for(;i;){var c=i.chunk,u=i.encoding,l=i.callback;if(b(t,e,!1,e.objectMode?1:c.length,c,u,l),i=i.next,e.bufferedRequestCount--,e.writing)break}null===i&&(e.lastBufferedRequest=null)}e.bufferedRequest=i,e.bufferProcessing=!1}function x(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function M(t,e){t._final((function(i){e.pendingcb--,i&&t.emit("error",i),e.prefinished=!0,t.emit("prefinish"),T(t,e)}))}function T(t,e){var i=x(e);return i&&(!function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,r.nextTick(M,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}c.inherits(g,l),v.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(v.prototype,"buffer",{get:u.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(t){return!!p.call(this,t)||this===g&&(t&&t._writableState instanceof v)}})):p=function(t){return t instanceof this},g.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},g.prototype.write=function(t,e,i){var n,s=this._writableState,o=!1,a=!s.objectMode&&(n=t,f.isBuffer(n)||n instanceof d);return a&&!f.isBuffer(t)&&(t=function(t){return f.from(t)}(t)),"function"==typeof e&&(i=e,e=null),a?e="buffer":e||(e=s.defaultEncoding),"function"!=typeof i&&(i=_),s.ended?function(t,e){var i=new Error("write after end");t.emit("error",i),r.nextTick(e,i)}(this,i):(a||function(t,e,i,n){var s=!0,o=!1;return null===i?o=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),r.nextTick(n,o),s=!1),s}(this,s,t,i))&&(s.pendingcb++,o=function(t,e,i,n,s,r){if(!i){var o=function(t,e,i){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=f.from(e,i));return e}(e,n,s);n!==o&&(i=!0,s="buffer",n=o)}var a=e.objectMode?1:n.length;e.length+=a;var h=e.length<e.highWaterMark;h||(e.needDrain=!0);if(e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:s,isBuf:i,callback:r,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else b(t,e,!1,a,n,s,r);return h}(this,s,a,t,e,i)),o},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||y(this,t))},g.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(t,e,i){i(new Error("_write() is not implemented"))},g.prototype._writev=null,g.prototype.end=function(t,e,i){var n=this._writableState;"function"==typeof t?(i=t,t=null,e=null):"function"==typeof e&&(i=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||function(t,e,i){e.ending=!0,T(t,e),i&&(e.finished?r.nextTick(i):t.once("finish",i));e.ended=!0,t.writable=!1}(this,n,i)},Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),g.prototype.destroy=m.destroy,g.prototype._undestroy=m.undestroy,g.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("timers").setImmediate)},{"./_stream_duplex":508,"./internal/streams/destroy":514,"./internal/streams/stream":515,_process:467,"core-util-is":383,inherits:440,"process-nextick-args":466,"safe-buffer":520,timers:523,"util-deprecate":524}],513:[function(t,e,i){var n=t("safe-buffer").Buffer,s=t("util");e.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,i=""+e.data;e=e.next;)i+=t+e.data;return i},t.prototype.concat=function(t){if(0===this.length)return n.alloc(0);for(var e,i,s,r=n.allocUnsafe(t>>>0),o=this.head,a=0;o;)e=o.data,i=r,s=a,e.copy(i,s),a+=o.data.length,o=o.next;return r},t}(),s&&s.inspect&&s.inspect.custom&&(e.exports.prototype[s.inspect.custom]=function(){var t=s.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":520,util:188}],514:[function(t,e,i){var n=t("process-nextick-args");function s(t,e){t.emit("error",e)}e.exports={destroy:function(t,e){var i=this,r=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return r||o?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,n.nextTick(s,this,t)):n.nextTick(s,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?i._writableState?i._writableState.errorEmitted||(i._writableState.errorEmitted=!0,n.nextTick(s,i,t)):n.nextTick(s,i,t):e&&e(t)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":466}],515:[function(t,e,i){arguments[4][490][0].apply(i,arguments)},{dup:490,events:422}],516:[function(t,e,i){e.exports=t("./readable").PassThrough},{"./readable":517}],517:[function(t,e,i){(i=e.exports=t("./lib/_stream_readable.js")).Stream=i,i.Readable=i,i.Writable=t("./lib/_stream_writable.js"),i.Duplex=t("./lib/_stream_duplex.js"),i.Transform=t("./lib/_stream_transform.js"),i.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":508,"./lib/_stream_passthrough.js":509,"./lib/_stream_readable.js":510,"./lib/_stream_transform.js":511,"./lib/_stream_writable.js":512}],518:[function(t,e,i){e.exports=t("./readable").Transform},{"./readable":517}],519:[function(t,e,i){e.exports=t("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":512}],520:[function(t,e,i){arguments[4][217][0].apply(i,arguments)},{buffer:220,dup:217}],521:[function(t,e,i){arguments[4][218][0].apply(i,arguments)},{dup:218,"safe-buffer":520}],522:[function(t,e,i){arguments[4][218][0].apply(i,arguments)},{dup:218,"safe-buffer":494}],523:[function(t,e,i){(function(e,n){(function(){var s=t("process/browser.js").nextTick,r=Function.prototype.apply,o=Array.prototype.slice,a={},h=0;function c(t,e){this._id=t,this._clearFn=e}i.setTimeout=function(){return new c(r.call(setTimeout,window,arguments),clearTimeout)},i.setInterval=function(){return new c(r.call(setInterval,window,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(t){t.close()},c.prototype.unref=c.prototype.ref=function(){},c.prototype.close=function(){this._clearFn.call(window,this._id)},i.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},i.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},i._unrefActive=i.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout((function(){t._onTimeout&&t._onTimeout()}),e))},i.setImmediate="function"==typeof e?e:function(t){var e=h++,n=!(arguments.length<2)&&o.call(arguments,1);return a[e]=!0,s((function(){a[e]&&(n?t.apply(null,n):t.call(null),i.clearImmediate(e))})),e},i.clearImmediate="function"==typeof n?n:function(t){delete a[t]}}).call(this)}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":467,timers:523}],524:[function(t,e,i){(function(t){(function(){function i(e){try{if(!t.localStorage)return!1}catch(t){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=function(t,e){if(i("noDeprecation"))return t;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(this)}).call(this,"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],525:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],526:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],527:[function(t,e,i){(function(e,n){(function(){var s=/%[sdj%]/g;i.format=function(t){if(!v(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var n=arguments,r=n.length,o=String(t).replace(s,(function(t){if("%%"===t)return"%";if(i>=r)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}})),h=n[i];i<r;h=n[++i])m(h)||!w(h)?o+=" "+h:o+=" "+a(h);return o},i.deprecate=function(t,s){if(g(n.process))return function(){return i.deprecate(t,s).apply(this,arguments)};if(!0===e.noDeprecation)return t;var r=!1;return function(){if(!r){if(e.throwDeprecation)throw new Error(s);e.traceDeprecation?console.trace(s):console.error(s),r=!0}return t.apply(this,arguments)}};var r,o={};function a(t,e){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),p(e)?n.showHidden=e:e&&i._extend(n,e),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=h),u(n,t,n.depth)}function h(t,e){var i=a.styles[e];return i?"["+a.colors[i][0]+"m"+t+"["+a.colors[i][1]+"m":t}function c(t,e){return t}function u(t,e,n){if(t.customInspect&&e&&M(e.inspect)&&e.inspect!==i.inspect&&(!e.constructor||e.constructor.prototype!==e)){var s=e.inspect(n,t);return v(s)||(s=u(t,s,n)),s}var r=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(v(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}if(_(e))return t.stylize(""+e,"number");if(p(e))return t.stylize(""+e,"boolean");if(m(e))return t.stylize("null","null")}(t,e);if(r)return r;var o=Object.keys(e),a=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(e)),x(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return l(e);if(0===o.length){if(M(e)){var h=e.name?": "+e.name:"";return t.stylize("[Function"+h+"]","special")}if(b(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(y(e))return t.stylize(Date.prototype.toString.call(e),"date");if(x(e))return l(e)}var c,w="",T=!1,O=["{","}"];(d(e)&&(T=!0,O=["[","]"]),M(e))&&(w=" [Function"+(e.name?": "+e.name:"")+"]");return b(e)&&(w=" "+RegExp.prototype.toString.call(e)),y(e)&&(w=" "+Date.prototype.toUTCString.call(e)),x(e)&&(w=" "+l(e)),0!==o.length||T&&0!=e.length?n<0?b(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),c=T?function(t,e,i,n,s){for(var r=[],o=0,a=e.length;o<a;++o)S(e,String(o))?r.push(f(t,e,i,n,String(o),!0)):r.push("");return s.forEach((function(s){s.match(/^\d+$/)||r.push(f(t,e,i,n,s,!0))})),r}(t,e,n,a,o):o.map((function(i){return f(t,e,n,a,i,T)})),t.seen.pop(),function(t,e,i){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1];return i[0]+e+" "+t.join(", ")+" "+i[1]}(c,w,O)):O[0]+w+O[1]}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,i,n,s,r){var o,a,h;if((h=Object.getOwnPropertyDescriptor(e,s)||{value:e[s]}).get?a=h.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):h.set&&(a=t.stylize("[Setter]","special")),S(n,s)||(o="["+s+"]"),a||(t.seen.indexOf(h.value)<0?(a=m(i)?u(t,h.value,null):u(t,h.value,i-1)).indexOf("\n")>-1&&(a=r?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),g(o)){if(r&&s.match(/^\d+$/))return a;(o=JSON.stringify(""+s)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function d(t){return Array.isArray(t)}function p(t){return"boolean"==typeof t}function m(t){return null===t}function _(t){return"number"==typeof t}function v(t){return"string"==typeof t}function g(t){return void 0===t}function b(t){return w(t)&&"[object RegExp]"===T(t)}function w(t){return"object"==typeof t&&null!==t}function y(t){return w(t)&&"[object Date]"===T(t)}function x(t){return w(t)&&("[object Error]"===T(t)||t instanceof Error)}function M(t){return"function"==typeof t}function T(t){return Object.prototype.toString.call(t)}function O(t){return t<10?"0"+t.toString(10):t.toString(10)}i.debuglog=function(t){if(g(r)&&(r=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(r)){var n=e.pid;o[t]=function(){var e=i.format.apply(i,arguments);console.error("%s %d: %s",t,n,e)}}else o[t]=function(){};return o[t]},i.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},i.isArray=d,i.isBoolean=p,i.isNull=m,i.isNullOrUndefined=function(t){return null==t},i.isNumber=_,i.isString=v,i.isSymbol=function(t){return"symbol"==typeof t},i.isUndefined=g,i.isRegExp=b,i.isObject=w,i.isDate=y,i.isError=x,i.isFunction=M,i.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},i.isBuffer=t("./support/isBuffer");var E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function A(){var t=new Date,e=[O(t.getHours()),O(t.getMinutes()),O(t.getSeconds())].join(":");return[t.getDate(),E[t.getMonth()],e].join(" ")}function S(t,e){return Object.prototype.hasOwnProperty.call(t,e)}i.log=function(){console.log("%s - %s",A(),i.format.apply(i,arguments))},i.inherits=t("inherits"),i._extend=function(t,e){if(!e||!w(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(this)}).call(this,t("_process"),"undefined"!=typeof yt?yt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":526,_process:467,inherits:525}],528:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"v1",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(i,"v3",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(i,"v4",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(i,"v5",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(i,"NIL",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(i,"version",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(i,"validate",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(i,"stringify",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(i,"parse",{enumerable:!0,get:function(){return l.default}});var n=f(t("./v1.js")),s=f(t("./v3.js")),r=f(t("./v4.js")),o=f(t("./v5.js")),a=f(t("./nil.js")),h=f(t("./version.js")),c=f(t("./validate.js")),u=f(t("./stringify.js")),l=f(t("./parse.js"));function f(t){return t&&t.__esModule?t:{default:t}}},{"./nil.js":530,"./parse.js":531,"./stringify.js":535,"./v1.js":536,"./v3.js":537,"./v4.js":539,"./v5.js":540,"./validate.js":541,"./version.js":542}],529:[function(t,e,i){function n(t){return 14+(t+64>>>9<<4)+1}function s(t,e){const i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function r(t,e,i,n,r,o){return s((a=s(s(e,t),s(n,o)))<<(h=r)|a>>>32-h,i);var a,h}function o(t,e,i,n,s,o,a){return r(e&i|~e&n,t,e,s,o,a)}function a(t,e,i,n,s,o,a){return r(e&n|i&~n,t,e,s,o,a)}function h(t,e,i,n,s,o,a){return r(e^i^n,t,e,s,o,a)}function c(t,e,i,n,s,o,a){return r(i^(e|~n),t,e,s,o,a)}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var u=function(t){if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let i=0;i<e.length;++i)t[i]=e.charCodeAt(i)}return function(t){const e=[],i=32*t.length;for(let n=0;n<i;n+=8){const i=t[n>>5]>>>n%32&255,s=parseInt("0123456789abcdef".charAt(i>>>4&15)+"0123456789abcdef".charAt(15&i),16);e.push(s)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[n(e)-1]=e;let i=1732584193,r=-271733879,u=-1732584194,l=271733878;for(let e=0;e<t.length;e+=16){const n=i,f=r,d=u,p=l;i=o(i,r,u,l,t[e],7,-680876936),l=o(l,i,r,u,t[e+1],12,-389564586),u=o(u,l,i,r,t[e+2],17,606105819),r=o(r,u,l,i,t[e+3],22,-1044525330),i=o(i,r,u,l,t[e+4],7,-176418897),l=o(l,i,r,u,t[e+5],12,1200080426),u=o(u,l,i,r,t[e+6],17,-1473231341),r=o(r,u,l,i,t[e+7],22,-45705983),i=o(i,r,u,l,t[e+8],7,1770035416),l=o(l,i,r,u,t[e+9],12,-1958414417),u=o(u,l,i,r,t[e+10],17,-42063),r=o(r,u,l,i,t[e+11],22,-1990404162),i=o(i,r,u,l,t[e+12],7,1804603682),l=o(l,i,r,u,t[e+13],12,-40341101),u=o(u,l,i,r,t[e+14],17,-1502002290),r=o(r,u,l,i,t[e+15],22,1236535329),i=a(i,r,u,l,t[e+1],5,-165796510),l=a(l,i,r,u,t[e+6],9,-1069501632),u=a(u,l,i,r,t[e+11],14,643717713),r=a(r,u,l,i,t[e],20,-373897302),i=a(i,r,u,l,t[e+5],5,-701558691),l=a(l,i,r,u,t[e+10],9,38016083),u=a(u,l,i,r,t[e+15],14,-660478335),r=a(r,u,l,i,t[e+4],20,-405537848),i=a(i,r,u,l,t[e+9],5,568446438),l=a(l,i,r,u,t[e+14],9,-1019803690),u=a(u,l,i,r,t[e+3],14,-187363961),r=a(r,u,l,i,t[e+8],20,1163531501),i=a(i,r,u,l,t[e+13],5,-1444681467),l=a(l,i,r,u,t[e+2],9,-51403784),u=a(u,l,i,r,t[e+7],14,1735328473),r=a(r,u,l,i,t[e+12],20,-1926607734),i=h(i,r,u,l,t[e+5],4,-378558),l=h(l,i,r,u,t[e+8],11,-2022574463),u=h(u,l,i,r,t[e+11],16,1839030562),r=h(r,u,l,i,t[e+14],23,-35309556),i=h(i,r,u,l,t[e+1],4,-1530992060),l=h(l,i,r,u,t[e+4],11,1272893353),u=h(u,l,i,r,t[e+7],16,-155497632),r=h(r,u,l,i,t[e+10],23,-1094730640),i=h(i,r,u,l,t[e+13],4,681279174),l=h(l,i,r,u,t[e],11,-358537222),u=h(u,l,i,r,t[e+3],16,-722521979),r=h(r,u,l,i,t[e+6],23,76029189),i=h(i,r,u,l,t[e+9],4,-640364487),l=h(l,i,r,u,t[e+12],11,-421815835),u=h(u,l,i,r,t[e+15],16,530742520),r=h(r,u,l,i,t[e+2],23,-995338651),i=c(i,r,u,l,t[e],6,-198630844),l=c(l,i,r,u,t[e+7],10,1126891415),u=c(u,l,i,r,t[e+14],15,-1416354905),r=c(r,u,l,i,t[e+5],21,-57434055),i=c(i,r,u,l,t[e+12],6,1700485571),l=c(l,i,r,u,t[e+3],10,-1894986606),u=c(u,l,i,r,t[e+10],15,-1051523),r=c(r,u,l,i,t[e+1],21,-2054922799),i=c(i,r,u,l,t[e+8],6,1873313359),l=c(l,i,r,u,t[e+15],10,-30611744),u=c(u,l,i,r,t[e+6],15,-1560198380),r=c(r,u,l,i,t[e+13],21,1309151649),i=c(i,r,u,l,t[e+4],6,-145523070),l=c(l,i,r,u,t[e+11],10,-1120210379),u=c(u,l,i,r,t[e+2],15,718787259),r=c(r,u,l,i,t[e+9],21,-343485551),i=s(i,n),r=s(r,f),u=s(u,d),l=s(l,p)}return[i,r,u,l]}(function(t){if(0===t.length)return[];const e=8*t.length,i=new Uint32Array(n(e));for(let n=0;n<e;n+=8)i[n>>5]|=(255&t[n/8])<<n%32;return i}(t),8*t.length))};i.default=u},{}],530:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;i.default="00000000-0000-0000-0000-000000000000"},{}],531:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,s=(n=t("./validate.js"))&&n.__esModule?n:{default:n};var r=function(t){if(!(0,s.default)(t))throw TypeError("Invalid UUID");let e;const i=new Uint8Array(16);return i[0]=(e=parseInt(t.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=255&e,i[4]=(e=parseInt(t.slice(9,13),16))>>>8,i[5]=255&e,i[6]=(e=parseInt(t.slice(14,18),16))>>>8,i[7]=255&e,i[8]=(e=parseInt(t.slice(19,23),16))>>>8,i[9]=255&e,i[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=255&e,i};i.default=r},{"./validate.js":541}],532:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;i.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},{}],533:[function(t,e,i){let n;Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(s)};const s=new Uint8Array(16)},{}],534:[function(t,e,i){function n(t,e,i,n){switch(t){case 0:return e&i^~e&n;case 1:return e^i^n;case 2:return e&i^e&n^i&n;case 3:return e^i^n}}function s(t,e){return t<<e|t>>>32-e}Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=function(t){const e=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let i=0;i<e.length;++i)t.push(e.charCodeAt(i))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const r=t.length/4+2,o=Math.ceil(r/16),a=new Array(o);for(let e=0;e<o;++e){const i=new Uint32Array(16);for(let n=0;n<16;++n)i[n]=t[64*e+4*n]<<24|t[64*e+4*n+1]<<16|t[64*e+4*n+2]<<8|t[64*e+4*n+3];a[e]=i}a[o-1][14]=8*(t.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<o;++t){const r=new Uint32Array(80);for(let e=0;e<16;++e)r[e]=a[t][e];for(let t=16;t<80;++t)r[t]=s(r[t-3]^r[t-8]^r[t-14]^r[t-16],1);let o=i[0],h=i[1],c=i[2],u=i[3],l=i[4];for(let t=0;t<80;++t){const i=Math.floor(t/20),a=s(o,5)+n(i,h,c,u)+l+e[i]+r[t]>>>0;l=u,u=c,c=s(h,30)>>>0,h=o,o=a}i[0]=i[0]+o>>>0,i[1]=i[1]+h>>>0,i[2]=i[2]+c>>>0,i[3]=i[3]+u>>>0,i[4]=i[4]+l>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]};i.default=r},{}],535:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,s=(n=t("./validate.js"))&&n.__esModule?n:{default:n};const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).substr(1));var o=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase();if(!(0,s.default)(i))throw TypeError("Stringified UUID is invalid");return i};i.default=o},{"./validate.js":541}],536:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=r(t("./rng.js")),s=r(t("./stringify.js"));function r(t){return t&&t.__esModule?t:{default:t}}let o,a,h=0,c=0;var u=function(t,e,i){let r=e&&i||0;const u=e||new Array(16);let l=(t=t||{}).node||o,f=void 0!==t.clockseq?t.clockseq:a;if(null==l||null==f){const e=t.random||(t.rng||n.default)();null==l&&(l=o=[1|e[0],e[1],e[2],e[3],e[4],e[5]]),null==f&&(f=a=16383&(e[6]<<8|e[7]))}let d=void 0!==t.msecs?t.msecs:Date.now(),p=void 0!==t.nsecs?t.nsecs:c+1;const m=d-h+(p-c)/1e4;if(m<0&&void 0===t.clockseq&&(f=f+1&16383),(m<0||d>h)&&void 0===t.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=d,c=p,a=f,d+=122192928e5;const _=(1e4*(268435455&d)+p)%4294967296;u[r++]=_>>>24&255,u[r++]=_>>>16&255,u[r++]=_>>>8&255,u[r++]=255&_;const v=d/4294967296*1e4&268435455;u[r++]=v>>>8&255,u[r++]=255&v,u[r++]=v>>>24&15|16,u[r++]=v>>>16&255,u[r++]=f>>>8|128,u[r++]=255&f;for(let t=0;t<6;++t)u[r+t]=l[t];return e||(0,s.default)(u)};i.default=u},{"./rng.js":533,"./stringify.js":535}],537:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=r(t("./v35.js")),s=r(t("./md5.js"));function r(t){return t&&t.__esModule?t:{default:t}}var o=(0,n.default)("v3",48,s.default);i.default=o},{"./md5.js":529,"./v35.js":538}],538:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t,e,i){function r(t,r,o,a){if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let i=0;i<t.length;++i)e.push(t.charCodeAt(i));return e}(t)),"string"==typeof r&&(r=(0,s.default)(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let h=new Uint8Array(16+t.length);if(h.set(r),h.set(t,r.length),h=i(h),h[6]=15&h[6]|e,h[8]=63&h[8]|128,o){a=a||0;for(let t=0;t<16;++t)o[a+t]=h[t];return o}return(0,n.default)(h)}try{r.name=t}catch(t){}return r.DNS=o,r.URL=a,r},i.URL=i.DNS=void 0;var n=r(t("./stringify.js")),s=r(t("./parse.js"));function r(t){return t&&t.__esModule?t:{default:t}}const o="6ba7b810-9dad-11d1-80b4-00c04fd430c8";i.DNS=o;const a="6ba7b811-9dad-11d1-80b4-00c04fd430c8";i.URL=a},{"./parse.js":531,"./stringify.js":535}],539:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=r(t("./rng.js")),s=r(t("./stringify.js"));function r(t){return t&&t.__esModule?t:{default:t}}var o=function(t,e,i){const r=(t=t||{}).random||(t.rng||n.default)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){i=i||0;for(let t=0;t<16;++t)e[i+t]=r[t];return e}return(0,s.default)(r)};i.default=o},{"./rng.js":533,"./stringify.js":535}],540:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=r(t("./v35.js")),s=r(t("./sha1.js"));function r(t){return t&&t.__esModule?t:{default:t}}var o=(0,n.default)("v5",80,s.default);i.default=o},{"./sha1.js":534,"./v35.js":538}],541:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,s=(n=t("./regex.js"))&&n.__esModule?n:{default:n};var r=function(t){return"string"==typeof t&&s.default.test(t)};i.default=r},{"./regex.js":532}],542:[function(t,e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n,s=(n=t("./validate.js"))&&n.__esModule?n:{default:n};var r=function(t){if(!(0,s.default)(t))throw TypeError("Invalid UUID");return parseInt(t.substr(14,1),16)};i.default=r},{"./validate.js":541}],543:[function(t,e,i){
/**
 * Character classes and associated utilities for the 5th edition of XML 1.0.
 *
 * @author Louis-Dominique Dubeau
 * @license MIT
 * @copyright Louis-Dominique Dubeau
 */
Object.defineProperty(i,"__esModule",{value:!0}),i.CHAR="\t\n\r ---",i.S=" \t\r\n",i.NAME_START_CHAR=":A-Z_a-z-----------",i.NAME_CHAR="-"+i.NAME_START_CHAR+".0-9--",i.CHAR_RE=new RegExp("^["+i.CHAR+"]$","u"),i.S_RE=new RegExp("^["+i.S+"]+$","u"),i.NAME_START_CHAR_RE=new RegExp("^["+i.NAME_START_CHAR+"]$","u"),i.NAME_CHAR_RE=new RegExp("^["+i.NAME_CHAR+"]$","u"),i.NAME_RE=new RegExp("^["+i.NAME_START_CHAR+"]["+i.NAME_CHAR+"]*$","u"),i.NMTOKEN_RE=new RegExp("^["+i.NAME_CHAR+"]+$","u");function n(t){return t>=65&&t<=90||t>=97&&t<=122||58===t||95===t||8204===t||8205===t||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}i.S_LIST=[32,10,13,9],i.isChar=function(t){return t>=32&&t<=55295||10===t||13===t||9===t||t>=57344&&t<=65533||t>=65536&&t<=1114111},i.isS=function(t){return 32===t||10===t||13===t||9===t},i.isNameStartChar=n,i.isNameChar=function(t){return n(t)||t>=48&&t<=57||45===t||46===t||183===t||t>=768&&t<=879||t>=8255&&t<=8256}},{}],544:[function(t,e,i){
/**
 * Character classes and associated utilities for the 2nd edition of XML 1.1.
 *
 * @author Louis-Dominique Dubeau
 * @license MIT
 * @copyright Louis-Dominique Dubeau
 */
Object.defineProperty(i,"__esModule",{value:!0}),i.CHAR="---",i.RESTRICTED_CHAR="-\b\v\f---",i.S=" \t\r\n",i.NAME_START_CHAR=":A-Z_a-z-----------",i.NAME_CHAR="-"+i.NAME_START_CHAR+".0-9--",i.CHAR_RE=new RegExp("^["+i.CHAR+"]$","u"),i.RESTRICTED_CHAR_RE=new RegExp("^["+i.RESTRICTED_CHAR+"]$","u"),i.S_RE=new RegExp("^["+i.S+"]+$","u"),i.NAME_START_CHAR_RE=new RegExp("^["+i.NAME_START_CHAR+"]$","u"),i.NAME_CHAR_RE=new RegExp("^["+i.NAME_CHAR+"]$","u"),i.NAME_RE=new RegExp("^["+i.NAME_START_CHAR+"]["+i.NAME_CHAR+"]*$","u"),i.NMTOKEN_RE=new RegExp("^["+i.NAME_CHAR+"]+$","u");function n(t){return t>=65&&t<=90||t>=97&&t<=122||58===t||95===t||8204===t||8205===t||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}i.S_LIST=[32,10,13,9],i.isChar=function(t){return t>=1&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111},i.isRestrictedChar=function(t){return t>=1&&t<=8||11===t||12===t||t>=14&&t<=31||t>=127&&t<=132||t>=134&&t<=159},i.isCharAndNotRestricted=function(t){return 9===t||10===t||13===t||t>31&&t<127||133===t||t>159&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111},i.isS=function(t){return 32===t||10===t||13===t||9===t},i.isNameStartChar=n,i.isNameChar=function(t){return n(t)||t>=48&&t<=57||45===t||46===t||183===t||t>=768&&t<=879||t>=8255&&t<=8256}},{}],545:[function(t,e,i){
/**
 * Character class utilities for XML NS 1.0 edition 3.
 *
 * @author Louis-Dominique Dubeau
 * @license MIT
 * @copyright Louis-Dominique Dubeau
 */
function n(t){return t>=65&&t<=90||95===t||t>=97&&t<=122||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039}Object.defineProperty(i,"__esModule",{value:!0}),i.NC_NAME_START_CHAR="A-Z_a-z------------",i.NC_NAME_CHAR="-"+i.NC_NAME_START_CHAR+".0-9--",i.NC_NAME_START_CHAR_RE=new RegExp("^["+i.NC_NAME_START_CHAR+"]$","u"),i.NC_NAME_CHAR_RE=new RegExp("^["+i.NC_NAME_CHAR+"]$","u"),i.NC_NAME_RE=new RegExp("^["+i.NC_NAME_START_CHAR+"]["+i.NC_NAME_CHAR+"]*$","u"),i.isNCNameStartChar=n,i.isNCNameChar=function(t){return n(t)||45===t||46===t||t>=48&&t<=57||183===t||t>=768&&t<=879||t>=8255&&t<=8256}},{}]},{},[15])(15)}))})(vF);var gF={exports:{}};(function(t,e){(function(t,e){e()})(yt,(function(){function e(t,e){return"undefined"==typeof e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}function i(t,e,i){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="blob",n.onload=function(){a(n.response,e,i)},n.onerror=function(){console.error("could not download file")},n.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function s(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(i){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof yt&&yt.global===yt?yt:void 0,o=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(t,e,o){var a=r.URL||r.webkitURL,h=document.createElement("a");e=e||t.name||"download",h.download=e,h.rel="noopener","string"==typeof t?(h.href=t,h.origin===location.origin?s(h):n(h.href)?i(t,e,o):s(h,h.target="_blank")):(h.href=a.createObjectURL(t),setTimeout((function(){a.revokeObjectURL(h.href)}),4e4),setTimeout((function(){s(h)}),0))}:"msSaveOrOpenBlob"in navigator?function(t,r,o){if(r=r||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(e(t,o),r);else if(n(t))i(t,r,o);else{var a=document.createElement("a");a.href=t,a.target="_blank",setTimeout((function(){s(a)}))}}:function(t,e,n,s){if(s=s||open("","_blank"),s&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return i(t,e,n);var a="application/octet-stream"===t.type,h=/constructor/i.test(r.HTMLElement)||r.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||a&&h||o)&&"undefined"!=typeof FileReader){var u=new FileReader;u.onloadend=function(){var t=u.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},u.readAsDataURL(t)}else{var l=r.URL||r.webkitURL,f=l.createObjectURL(t);s?s.location=f:location.href=f,s=null,setTimeout((function(){l.revokeObjectURL(f)}),4e4)}});r.saveAs=a.saveAs=a,t.exports=a}))})(gF);var bF;(function(t){t["Documents"]="DOCUMENTS";t["Data"]="DATA";t["Library"]="LIBRARY";t["Cache"]="CACHE";t["External"]="EXTERNAL";t["ExternalStorage"]="EXTERNAL_STORAGE"})(bF||(bF={}));var wF;(function(t){t["UTF8"]="utf8";t["ASCII"]="ascii";t["UTF16"]="utf16"})(wF||(wF={}));const yF=ft("Filesystem",{web:()=>import("./p-c2d20607.js").then((t=>new t.FilesystemWeb))});const xF=bF.Cache;const MF=zR(ht.getAppTitle()+"_images");class TF{async writeFile(t,e,i,n=wF.UTF8){return await yF.writeFile({path:e,data:i,directory:t,encoding:n})}async readFile(t,e,i=wF.UTF8){return await yF.readFile({path:e,directory:t,encoding:i})}async deleteFile(t,e){return await yF.deleteFile({path:e,directory:t})}async makeDir(t,e,i=true){return await yF.mkdir({path:e,directory:t,recursive:i})}async removeDir(t,e,i=true){return await yF.rmdir({path:e,directory:t,recursive:i})}async readDir(t,e){return await yF.readdir({path:e,directory:t})}convertBlobToBase64(t){return new Promise(((e,i)=>{const n=new FileReader;n.onerror=i;n.onload=()=>{e(n.result)};n.readAsDataURL(t)}))}async storeAndLoadImage(t,e=false){return new Promise((async(i,n)=>{let s={ext:"jpeg",src:t};try{await this.readDir(xF,MF)}catch(t){await this.makeDir(xF,MF)}const r=t.split("/").pop().split("?")[0];if(r.includes("%2Fimage%2F")){const t=r.split("%2F");const e=t.lastIndexOf("image");s.ext=t[e+1]}else{const t=r.split(".");if(t.length>1){s.ext=t.pop()}}const o=`${MF}/${r}`;if(e){try{await this.deleteFile(xF,o)}catch(t){ht.log("file does not exist",t)}}try{s.src=await this.readImage(o);i(s)}catch(e){try{await this.storeImage(t,o);try{s.src=await this.readImage(o);i(s)}catch(t){ht.log("This should not happen: ",[t]);n(t)}}catch(t){ht.log("loading image online",[t]);i(s)}}}))}async readImage(t){const e=await this.readFile(xF,t);return e.data}async storeImage(t,e){return new Promise((async(i,n)=>{const s=await fetch(t,{headers:new Headers({Referer:ht.getSiteUrl()}),mode:"cors"});if(s.ok){const t=await s.blob();const r=await this.convertBlobToBase64(t);if(r.search("data:image/")!==-1){const t=await this.writeFile(xF,e,r);i(t.uri)}else{n("ERROR-no image file")}}else{n("ERROR-fetch error")}}))}}const OF=new TF;class EF{constructor(t){this.field=t&&t.field?t.field:null;this.fieldName=t&&t.fieldName?t.fieldName:null;this.valueName=t&&t.valueName?t.valueName:null;this.comparisonField=t&&t.comparisonField?t.comparisonField:null;this.operator=t&&t.operator?t.operator:"=";this.value=t&&t.value?t.value:null}}class AF{constructor(t){this.datasheetMajorFamilies=t&&t.datasheetMajorFamilies?t.datasheetMajorFamilies:[];this.datasheetFamilies=t&&t.datasheetFamilies?t.datasheetFamilies:[];this.datasheetCategories=t&&t.datasheetCategories?t.datasheetCategories:[];this.datasheetPropertyTypes=t&&t.datasheetPropertyTypes?t.datasheetPropertyTypes:[];this.datasheetPropertyTypes=t&&t.datasheetPropertyTypes?t.datasheetPropertyTypes:[];this.datasheetPropertyNames=t&&t.datasheetPropertyNames?t.datasheetPropertyNames:[];this.datasheetQualityColorCodes=t&&t.datasheetQualityColorCodes?t.datasheetQualityColorCodes:[]}}class SF{constructor(t){this.majorFamilyId=t&&t.majorFamilyId?t.majorFamilyId:null;this.majorFamilyName=t&&t.majorFamilyName?t.majorFamilyName:null}}class kF{constructor(t){this.familyId=t&&t.familyId?t.familyId:null;this.familyName=t&&t.familyName?t.familyName:null}}class IF{constructor(t){this.categoriesId=t&&t.categoriesId?t.categoriesId:null;this.categoriesName=t&&t.categoriesName?t.categoriesName:null}}class CF{constructor(t){this.position=t&&t.position?t.position:0;this.typeId=t&&t.typeId?t.typeId:null;this.typeName=t&&t.typeName?t.typeName:null;this.typeLeft=t&&t.typeLeft?tP(t.typeLeft):{en:null};this.typeRight=t&&t.typeRight?tP(t.typeRight):{en:null};this.typeLimit=t&&t.typeLimit?tP(t.typeLimit):{en:null}}}class jF{constructor(t){this.nameId=t&&t.nameId?t.nameId:null;this.nameName=t&&t.nameName?t.nameName:null;this.nameType=t&&t.nameType?t.nameType:null;this.nameDescLeft=t&&t.nameDescLeft?tP(t.nameDescLeft):{en:null};this.nameDescRight=t&&t.nameDescRight?tP(t.nameDescRight):{en:null};this.comments=t&&t.comments?tP(t.comments):{en:null};this.dimension=t&&t.dimension?tP(t.dimension):{en:null};this.decimals=t&&t.decimals?dt.exports.toNumber(t.decimals):2;this.position=t&&t.position?dt.exports.toNumber(t.position):1}}class DF{constructor(t){this.qualityColorCodeId=t&&t.qualityColorCodeId?t.qualityColorCodeId:null;this.qualityColorCodePicture=t&&t.qualityColorCodePicture?t.qualityColorCodePicture:null}}class RF{constructor(t){this.show=true;this.position=t&&dt.exports.isNumber(dt.exports.toNumber(t.position))?dt.exports.toNumber(t.position):0;this.type=t&&t.type?t.type:null;this.name=t&&t.name?t.name:null;this.typical=t&&dt.exports.isNumber(dt.exports.toNumber(t.typical))&&dt.exports.toNumber(t.typical)>0?dt.exports.toNumber(t.typical):null;this.prefix=t&&t.prefix?t.prefix:null;this.lower=t&&dt.exports.isNumber(dt.exports.toNumber(t.lower))&&dt.exports.toNumber(t.lower)>=0?dt.exports.toNumber(t.lower):null;this.higher=t&&dt.exports.isNumber(dt.exports.toNumber(t.higher))&&dt.exports.toNumber(t.higher)>0?dt.exports.toNumber(t.higher):null;this.show=t&&t.show==true?true:t&&t.show==false?false:true}}class PF{constructor(t){this.majorFamilyId=t&&t.majorFamilyId?t.majorFamilyId:null;this.familyId=t&&t.familyId?t.familyId:null;this.categoriesId=t&&t.categoriesId?t.categoriesId:null;this.sequentialId=t&&t.sequentialId?t.sequentialId:null;this.techNo=t&&t.techNo?t.techNo:null;this.qualityPrefix=t&&t.qualityPrefix?t.qualityPrefix:null;this.productName=t&&t.productName?t.productName:null;this.qualityColorCodeId=t&&t.qualityColorCodeId?t.qualityColorCodeId:null;this.classification=t&&t.classification?tP(t.classification):{en:null};t&&t.Value_Type_Left?this.classification=tP(t.Value_Type_Left):undefined;this.application=t&&t.application?tP(t.application):{en:null};t&&t.Value_Type_Right?this.application=tP(t.Value_Type_Right):undefined;let e=[];if(t&&t.properties){t.properties.forEach((t=>{e.push(new RF(t))}))}this.orderProperties(e);this.producerName=t&&t.producerName?t.producerName:null;this.producerReferenceQuality=t&&t.producerReferenceQuality?t.producerReferenceQuality:null;this.competitorReferenceQuality=t&&t.competitorReferenceQuality?t.competitorReferenceQuality:null;this.comments=t&&t.comments?t.comments:null;this.performanceComments=t&&t.performanceComments?t.performanceComments:null;this.revisionNo=t&&t.revisionNo?dt.exports.toNumber(t.revisionNo):0;this.issuedOnDate=t&&t.issuedOnDate?t.issuedOnDate:(new Date).toISOString();this.oldProduct=t&&t.oldProduct?t.oldProduct:false;this.files=t&&t.files?t.files:[];this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}orderProperties(t){this.properties=dt.exports.orderBy(t,["type","position","name"],"asc")}orderPropertiesForExport(){const t=[];dt.exports.cloneDeep(this.properties).forEach((e=>{const i=$F.getDatasheetPropertyNames("id",e.name)[0];const n=i?i.decimals:2;if(e.typical){e.typical=QR(e.typical,n)}if(e.higher){e.higher=QR(e.higher,n)}if(e.lower){e.lower=QR(e.lower,n)}const s=new RegExp(`${dt.exports.escapeRegExp("-")}(.*?)${dt.exports.escapeRegExp("c")}`);const r=e.name.match(s);const o=$F.getDatasheetPropertyNames("id",e.name)[0];const a=HL.getValueForLanguage(o.comments,"en");e["comment"]=a;const h=r&&r[1]&&!isNaN(dt.exports.toNumber(r[1]))?dt.exports.toNumber(r[1]):0;e["temp"]=h;let c=[e.lower,e.typical,e.higher].filter((t=>t>0));e["minValue"]=Math.min(...c);e.position=o.position;t.push(e)}));const e=["position","name","comment","minValue"];const i=["position","minValue"];const n=dt.exports.orderBy(t.filter((t=>t.type=="chemical")),i,["asc","desc"]);const s=dt.exports.orderBy(t.filter((t=>t.type=="chemical-raw")),i,["asc","desc"]);const r=t.filter((t=>t.type=="physical"));let o=[];const a=r.find((t=>dt.exports.startsWith(t.name,"bd-")));const h=r.find((t=>t.name=="ap"));const c=r.find((t=>dt.exports.startsWith(t.name,"ccs-")));if(a)o.push(a);if(h)o.push(h);if(c)o.push(c);let u=[];r.forEach((t=>{if(!dt.exports.startsWith(t.name,"bd-")&&t.name!=="ap"&&!dt.exports.startsWith(t.name,"ccs-")){u.push(t)}}));u=dt.exports.orderBy(u,e,["asc","asc","asc","desc"]);o=o.concat(u);const l=t.filter((t=>t.type=="physical-raw"));const f=dt.exports.orderBy(t.filter((t=>t.type!="chemical"&&t.type!="chemical-raw"&&t.type!="physical"&&t.type!="physical-raw")),e,["asc","asc","asc","desc"]);const d=dt.exports.union(s,n,o,l,f);return d}getDensity(){const t=this.properties.find((t=>t.name.includes("bd")));if(t){if(t.typical){return t.typical}if(t.lower){return t.lower}if(t.higher){return t.higher}return 0}}}class NF{constructor(t){this.oldProduct=false;this.majorFamilyId=t&&t.majorFamilyId?t.majorFamilyId:null;this.familyId=t&&t.familyId?t.familyId:null;this.oldProduct=t&&t.oldProduct?true:false;const e=[];if(t&&t.properties){t.properties.forEach((t=>{e.push(new EF(t))}))}this.properties=e}isActive(){return this.familyId!=null||this.majorFamilyId!=null||this.oldProduct==true||this.properties.length>0}}class FF{constructor(t){this.oldProduct=false;if(t){Object.keys(t).forEach((e=>{if(e=="oldProduct"){this.oldProduct=t.oldProduct?true:false}else if(e=="revisionNo"){this[e]=dt.exports.toNumber(t[e])}else this[e]=t[e]}))}}}const zF="datasheets";class LF{constructor(){this.datasheetsList=[];this.datasheetMajorFamilies=[];this.datasheetFamilies=[];this.datasheetCategories=[];this.datasheetPropertyTypes=[];this.datasheetPropertyNames=[];this.datasheetQualityColorCodes=[];this.datasheetsList$=new L([]);this.serviceInit=true}init(){if(this.serviceInit){this.serviceInit=false;nz.mapDataSub$.subscribe((()=>{const t=nz.getCollectionArray(zF);if(t&&t.length>0){this.datasheetsList=t;this.datasheetsList.forEach((t=>{if(t.oldProduct){!t.productName.includes("rev")?t.productName=t.productName+" (rev."+t.revisionNo+")":undefined}}));this.datasheetsList$.next(this.datasheetsList)}else{this.datasheetsList$.next([])}}));this.downloadDatasheetSettings()}}getMapData(t){const e={};if(t&&Object.keys(t)){Object.keys(t).forEach((i=>{e[i]=new FF(t[i])}))}return e}async presentDatasheetUpdate(t){return await pP.openModal("modal-datasheet-update",{datasheetId:t})}async duplicateDatasheet(t,e){const i=await this.getDatasheet(t);return await pP.openModal("modal-datasheet-update",{duplicateDatasheet:{id:t,datasheet:i},revision:e})}async presentDatasheetDetails(t){pP.push("/"+zF+"/"+t,"forward")}async getDatasheet(t){const e=await $L.getDocument(zF,t);const i=new PF(e);return i}getDatasheetName(t){return this.datasheetsList.find((e=>e.id==t))?this.datasheetsList.find((e=>e.id==t)).productName:t+" missing!"}async updateDatasheet(t,e,i){const n=[];e.properties.forEach((t=>{if(t.type&&t.name){n.push(t)}}));e.properties=n;return $L.saveItem(t,e,i,zF)}async deleteDatasheet(t,e=true){return new Promise((async(i,n)=>{const s=await pt.create({header:aP.getTransl("delete-datasheet-header","Delete Datasheet?"),message:aP.getTransl("delete-datasheet-message","This datasheet will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{n()}},{text:aP.getTransl("ok","OK"),handler:async()=>{$L.deleteItem(zF,t);if(e)pP.goBack();i(null)}}]});s.present()}))}getDatasheetsDetails(t){if(this.datasheetsList.length>0){return this.datasheetsList.find((e=>e.familyId==t))}else{return null}}getDatasheetsById(t){if(this.datasheetsList.length>0){return this.datasheetsList.find((e=>e.id==t))}else{return null}}exportDatasheets(t){const e=new oF;e.projectLocalId="export";t.forEach((t=>{const i=new aF;i.datasheetId=t["datasheetId"];e.projectAreaQuality.push(i)}));qF.exportDatasheets(e)}async checkMapData(){$L.checkMapData(zF,this.datasheetsList,((t,e)=>this.createMapData(t,e)))}createMapData(t,e){return new FF({id:t,familyId:e.familyId,techNo:e.techNo,revisionNo:e.revisionNo,oldProduct:e.oldProduct,productName:e.productName})}async openSelectDataSheet(t){return new Promise((async e=>{const i=await pP.openModal("modal-search-list",{list:this.datasheetsList.filter((t=>t.oldProduct==false)),searchTitle:{tag:"datasheet",text:"Datasheet"},item:t,showField:"productName",filterBy:["productName","familyId","techNo","majorFamilyId"],orderBy:["productName"],placeholder:"Search by product, family or tech#",filterObject:new NF,filterPopup:this.openDatasheetFilter,filterFunction:this.filterDatasheets});i.onDidDismiss().then((async t=>{if(t){e(t.data)}}));i.present()}))}getMaxDatasheetTechNo(){const t=[];this.datasheetsList.forEach((e=>{const i=e.techNo;if(dt.exports.isNumber(dt.exports.toNumber(i))){t.push(dt.exports.toNumber(i))}}));const e=dt.exports.max(t)+1;return e?dt.exports.toString(e):null}async openDatasheetFilter(t){return new Promise((async(e,i)=>{const n=await _t.create({component:"popover-datasheets-filter",componentProps:{filter:t},event:null,translucent:true});n.onDidDismiss().then((async t=>{if(t&&t.data){e(t.data)}else{i()}}));n.present()}))}async filterDatasheets(t){const e=[];const i=[];const n=[];Object.keys(t).map((s=>{if(s!="oldProduct"&&s!="properties"&&(t[s]!=null||t[s]>0)){e.push(s);i.push("=");n.push(t[s])}}));if(t.properties.length==0){if(e.length>0){const t=await $L.queryCollection(zF,e,i,n);const s=[];t.forEach((t=>{const e=new PF(t);s.push($F.createMapData(t.id,e))}));return s}else{return null}}else{const e=dt.exports.cloneDeep(t.properties);if(t.majorFamilyId){e.push(new EF({field:"majorFamilyId",operator:"=",value:t.majorFamilyId}))}if(t.familyId){e.push(new EF({field:"familyId",operator:"=",value:t.familyId}))}const i=await $L.filterDocumentsOnConditions(zF,e);const n=[];if(i&&i.length>0){i.forEach((t=>{n.push(new FF(t))}))}return dt.exports.orderBy(n,"productName")}}async downloadDatasheetSettings(){let t=new AF;if(mz.isLoggedin()){try{t=await $L.getDocument(zF,NL)}catch(t){}}const e=[];if(t.datasheetMajorFamilies)t.datasheetMajorFamilies.forEach((t=>{e.push(new SF(t))}));this.datasheetMajorFamilies=dt.exports.orderBy(e,["majorFamilyName"]);const i=[];if(t.datasheetFamilies)t.datasheetFamilies.forEach((t=>{i.push(new kF(t))}));this.datasheetFamilies=dt.exports.orderBy(i,["familyName"]);const n=[];if(t.datasheetCategories)t.datasheetCategories.forEach((t=>{n.push(new IF(t))}));this.datasheetCategories=dt.exports.orderBy(n,["categoriesName"]);const s=[];if(t.datasheetPropertyTypes)t.datasheetPropertyTypes.forEach((t=>{s.push(new CF(t))}));this.datasheetPropertyTypes=dt.exports.orderBy(s,["typeName"]);const r=[];if(t.datasheetPropertyNames)t.datasheetPropertyNames.forEach((t=>{r.push(new jF(t))}));this.datasheetPropertyNames=dt.exports.orderBy(r,["position","nameName"]);const o=[];if(t.datasheetQualityColorCodes)t.datasheetQualityColorCodes.forEach((t=>{o.push(new DF(t))}));this.datasheetQualityColorCodes=dt.exports.orderBy(o,["qualityColorCodeName"]);return t}getDatasheetMajorFamilies(t){if(t){const e=this.datasheetMajorFamilies.find((e=>e.majorFamilyId==t));return e?[e]:null}else{return dt.exports.orderBy(this.datasheetMajorFamilies,["majorFamilyName"],"asc")}}getDatasheetFamilies(t){if(this.datasheetFamilies)if(t){const e=this.datasheetFamilies.find((e=>e.familyId==t));return e?[e]:null}else{return dt.exports.orderBy(this.datasheetFamilies,["familyName"],"asc")}}getDatasheetCategories(t){if(t){const e=this.datasheetCategories.find((e=>e.categoriesId==t));return e?[e]:null}else{return dt.exports.orderBy(this.datasheetCategories,["categoriesName"],"asc")}}getDatasheetPropertyTypes(t){if(t){const e=this.datasheetPropertyTypes.find((e=>e.typeId==t));return e?[e]:null}else{return dt.exports.orderBy(this.datasheetPropertyTypes,["typeName"],"asc")}}getDatasheetPropertyNames(t,e){if(t&&t=="type"){return this.datasheetPropertyNames.filter((t=>t.nameType==e))}else if(t&&t=="id"){const t=this.datasheetPropertyNames.find((t=>t.nameId==e));return t?[t]:null}else{return dt.exports.orderBy(this.datasheetPropertyNames,["nameName"],"asc")}}getDatasheetQualityColorCodes(t){if(t){return[this.datasheetQualityColorCodes.find((e=>e.qualityColorCodeId==t))]}else{return dt.exports.orderBy(this.datasheetQualityColorCodes,["qualityColorCodeName"],"asc")}}async editDatasheetSettings(t){let e=null;switch(t){case"majorfamily":e="modal-datasheet-majorfamily";break;case"family":e="modal-datasheet-family";break;case"category":e="modal-datasheet-category";break;case"propertyType":e="modal-datasheet-propertytype";break;case"propertyName":e="modal-datasheet-propertyname";break;case"qualityColorCode":e="modal-datasheet-qualitycolorcode";break}return await pP.openModal(e)}async uploadDatasheetSettings(t,e){if(t){switch(t){case"majorfamily":this.datasheetMajorFamilies=e;break;case"family":this.datasheetFamilies=e;break;case"category":this.datasheetCategories=e;break;case"propertyType":this.datasheetPropertyTypes=e;break;case"propertyName":this.datasheetPropertyNames=e;break;case"qualityColorCode":this.datasheetQualityColorCodes=e;break}}const i=new AF;i.datasheetMajorFamilies=this.datasheetMajorFamilies;i.datasheetFamilies=this.datasheetFamilies;i.datasheetCategories=this.datasheetCategories;i.datasheetPropertyTypes=this.datasheetPropertyTypes;i.datasheetPropertyNames=this.datasheetPropertyNames;i.datasheetMajorFamilies=this.datasheetMajorFamilies;i.datasheetQualityColorCodes=this.datasheetQualityColorCodes;await $L.updateDocument(zF,NL,i)}}const $F=new LF;const UF="projects";class BF{constructor(){this.projectsList=[];this.projectsList$=new L([]);this.bricksAllocationArea=[];this.applicationUnits=[];this.quantityUnits=[];this.serviceInit=true}init(){if(this.serviceInit){this.serviceInit=false;nz.mapDataSub$.subscribe((()=>{const t=nz.getCollectionArray(UF);if(t&&t.length>0){this.projectsList=t;this.projectsList$.next(this.projectsList)}else{this.projectsList$.next([])}}))}}getMapData(t){const e={};if(t&&Object.keys(t)){Object.keys(t).forEach((i=>{e[i]=new mF(t[i])}))}return e}async presentProjectUpdate(t){return await pP.openModal("modal-project-update",{projectId:t})}async duplicateProject(t){const e=await this.getProject(t);return await pP.openModal("modal-project-update",{duplicateProject:e})}async presentProjectDetails(t){pP.push("/"+UF+"/"+t,"forward")}async getProject(t){const e=new oF(await $L.getDocument(UF,t));return await this.checkMissingCalculations(e)}async updateProject(t,e,i){return $L.saveItem(t,e,i,UF)}async deleteProject(t,e=true){return new Promise((async(i,n)=>{const s=await pt.create({header:aP.getTransl("delete-project-header","Delete Project?"),message:aP.getTransl("delete-project-message","This project will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{n()}},{text:aP.getTransl("ok","OK"),handler:async()=>{$L.deleteItem(UF,t);if(e)pP.goBack();i(null)}}]});s.present()}))}getProjectsDetails(t){if(this.projectsList.length>0){return this.projectsList.find((e=>e.id==t))}else{return null}}createMapData(t,e){return new mF({id:t,projectLocalId:e.projectLocalId,projectDescription:e.projectDescription,customerId:e.customerId})}async loadShapesForApplication(t){return new Promise((async e=>{const i=[];for(let e=0;e<t.projectAreaQuality.length;e++){const n=t.projectAreaQuality[e];i.push(new sF({areaIndex:e,shapes:[]}));for(let t=0;t<n.shapes.length;t++){const s=n.shapes[t];const r=await ZF.getShape(s.shapeId);r["shapeId"]=s.shapeId;i[e].shapes.push(r)}}e(i)}))}async checkBricksAllocationAreasForProject(t){let e=GF.getBricksAllocationAreas();for(let i=0;i<t.projectAreaQuality.length;i++){const n=t.projectAreaQuality[i];const s=GF.getBricksAllocationAreas(n.bricksAllocationAreaId);if(!s){const t=new uF({bricksAllocationAreaId:n.bricksAllocationAreaId,bricksAllocationAreaName:{en:dt.exports.capitalize(n.bricksAllocationAreaId.replace(/-+/g," ").replace(/_+/g," "))}});e.push(t);await this.uploadProjectSettings("bricksAllocationArea",e)}}}createProjectSummary(t,e,i,n,s,r,o="position"){const a=2;const h=0;let c=[];let u=0;let l=0;t.projectAreaQuality.forEach(((t,r)=>{t.shapes.forEach(((o,f)=>{const d=e[r].shapes[f];let p=0;let m=0;t.courses.forEach((e=>{e.quantityShapes.forEach((i=>{if(i.shapeId==o.shapeId){p+=n&&!t.onlyForRepair?i.quantity*(100+(t.includeSafety?t.includeSafety:0))/100:0;m+=s?(t.onlyForRepair?1:e.repairSets?e.repairSets:0)*i.quantity*(100+(t.includeSafety?t.includeSafety:0))/100:0}}))}));p=QR(p,h);m=QR(m,h);u+=p;let _=0;if(o.specialShapeVolume>0){_=d.getWeightForVolume(o.specialShapeVolume,t.density)}else{_=d.getWeight(t.density)}const v=QR(p*_/1e3,a);const g=QR(m*_/1e3,a);l+=v;c.push({areaIndex:r,areaId:t.bricksAllocationAreaId,area:t.bricksAllocationAreaId?GF.getBricksAllocationAreas(t.bricksAllocationAreaId)[0].bricksAllocationAreaName.en:"",position:o.position,quality:t.datasheetId?$F.datasheetsList.find((e=>e.id==t.datasheetId)).productName:null,techNo:t.datasheetId?$F.datasheetsList.find((e=>e.id==t.datasheetId)).techNo:null,shape:o.shapeId?d.shapeName:null,includeSafety:t.includeSafety,weightPerPiece:FR(_),qtyPerSetPcs:FR(p),qtyPerSetMT:FR(v),weightPerPiece_num:_,qtyPerSetPcs_num:p,qtyPerSetMT_num:v,qtyTotPcs:FR(p*i),qtyTotMT:FR(v*i),mass:false,onlyForRepair:t.onlyForRepair});if(m>0){c.push({areaIndex:r,areaId:t.bricksAllocationAreaId+"_*repair*_",area:(t.bricksAllocationAreaId?GF.getBricksAllocationAreas(t.bricksAllocationAreaId)[0].bricksAllocationAreaName.en:"")+" ("+aP.getTransl("repair","Repair")+")",position:o.position,quality:t.datasheetId?$F.datasheetsList.find((e=>e.id==t.datasheetId)).productName:null,techNo:t.datasheetId?$F.datasheetsList.find((e=>e.id==t.datasheetId)).techNo:null,shape:o.shapeId?d.shapeName:null,includeSafety:t.includeSafety,weightPerPiece:FR(_),qtyPerSetPcs:FR(m),qtyPerSetMT:FR(g),weightPerPiece_num:_,qtyPerSetPcs_num:m,qtyPerSetMT_num:g,qtyTotPcs:FR(m*i),qtyTotMT:FR(g*i),mass:false,onlyForRepair:true})}}))}));if(r){t.projectMass.forEach(((t,e)=>{const n=t.weightPerUnitKg;u+=n;const s=QR(t.quantity*t.weightPerUnitKg/1e3,a);l+=s;c.push({areaIndex:e,areaId:t.bricksAllocationAreaId,area:t.bricksAllocationAreaId?GF.getBricksAllocationAreas(t.bricksAllocationAreaId)[0].bricksAllocationAreaName.en:null,position:t.position,quality:t.datasheetId?$F.datasheetsList.find((e=>e.id==t.datasheetId))?$F.datasheetsList.find((e=>e.id==t.datasheetId)).productName:null:null,shape:t.quantityUnit?GF.getQuantityUnits(t.quantityUnit)[0].quantityUnitName.en:aP.getTransl("mass","Mass"),weightPerPiece:FR(t.weightPerUnitKg),qtyPerSetPcs:FR(QR(n,h)),qtyPerSetMT:FR(QR(s,a)),weightPerPiece_num:t.weightPerUnitKg,qtyPerSetPcs_num:QR(n,h),qtyPerSetMT_num:QR(s,a),qtyTotPcs:FR(n*i),qtyTotMT:FR(QR(s*i,a)),mass:true})}))}const f={};let d=[];if(o=="position"){d=["areaId","position","quality","shape"]}else if(o=="brickQuality"){d=["quality","shape"]}c.forEach((t=>{let e="";d.forEach((i=>{e+=t[i]+"-"}));if(!f[e]){f[e]=dt.exports.cloneDeep(t)}else{f[e].qtyPerSetMT_num=QR(f[e].qtyPerSetMT_num+t.qtyPerSetMT_num,a);f[e].qtyPerSetMT=FR(f[e].qtyPerSetMT_num);f[e].qtyPerSetPcs_num=QR(f[e].qtyPerSetPcs_num+t.qtyPerSetPcs_num,h);f[e].qtyPerSetPcs=FR(f[e].qtyPerSetPcs_num);f[e].qtyTotMT=FR(QR(f[e].qtyPerSetMT_num*i,a));f[e].qtyTotPcs=FR(f[e].qtyPerSetPcs_num*i)}}));c=dt.exports.orderBy(Object.values(f),"position");return{projectSummary:c,totals:{qtyPerSetPcs:FR(u),qtyPerSetMT:FR(QR(l,a)),qtyPcs:FR(u*t.setsAmount),qtyMT:FR(QR(l*t.setsAmount,a))}}}async checkMapData(){$L.checkMapData(UF,this.projectsList,((t,e)=>this.createMapData(t,e)))}async downloadProjectSettings(){return new Promise((async t=>{let e=new cF;if(mz.isLoggedin()){try{e=await $L.getDocument(UF,NL)}catch(t){}}const i=[];if(e.bricksAllocationArea)e.bricksAllocationArea.forEach((t=>{i.push(new uF(t))}));this.bricksAllocationArea=dt.exports.orderBy(i,["bricksAllocationAreaName.en"]);const n=[];if(e.applicationUnits)e.applicationUnits.forEach((t=>{n.push(new lF(t))}));this.applicationUnits=dt.exports.orderBy(n,["applicationName.en"]);const s=[];if(e.quantityUnits)e.quantityUnits.forEach((t=>{s.push(new fF(t))}));this.quantityUnits=dt.exports.orderBy(s,["quantityUnitName.en"]);t(e)}))}getBricksAllocationAreas(t){if(t){const e=this.bricksAllocationArea.find((e=>e.bricksAllocationAreaId==t));return e?[e]:[new uF({bricksAllocationAreaName:{en:t},bricksAllocationAreaId:t})]}else{return dt.exports.orderBy(this.bricksAllocationArea,["bricksAllocationAreaName.en"],"asc")}}getApplicationUnits(t){if(t){const e=this.applicationUnits.find((e=>e.applicationId==t));return e?[e]:[new lF({applicationName:{en:t},applicationId:t})]}else{return dt.exports.orderBy(this.applicationUnits,["applicationName.en"],"asc")}}getQuantityUnits(t){if(t){const e=this.quantityUnits.find((e=>e.quantityUnitId==t));return e?[e]:[new fF({quantityUnitName:{en:t},quantityUnitId:t})]}else{return dt.exports.orderBy(this.quantityUnits,["quantityUnitName.en"],"asc")}}async editProjectSettings(t){let e=null;switch(t){case"bricksAllocationArea":e="modal-project-bricksallocationarea";break;case"applicationUnit":e="modal-project-applicationunit";break;case"quantityUnit":e="modal-project-quantityunit";break}return await pP.openModal(e)}async uploadProjectSettings(t,e){await this.downloadProjectSettings();if(t){switch(t){case"bricksAllocationArea":this.bricksAllocationArea=e;break;case"applicationUnit":this.applicationUnits=e;break;case"quantityUnit":this.quantityUnits=e;break}}const i=new cF;i.bricksAllocationArea=this.bricksAllocationArea;i.applicationUnits=this.applicationUnits;i.quantityUnits=this.quantityUnits;await $L.updateDocument(UF,NL,i)}countTotalQuantity(t){let e=0;t.quantityShapes.forEach((t=>{e+=t.quantity}));return e}getAreaCourseWeightForShape(t,e,i,n,s){const r=t.projectAreaQuality[i].courses[n];let o=0;if(t.projectAreaQuality[i].shapes[s].specialShapeVolume>0){o=e[i].shapes[s].getWeightForVolume(t.projectAreaQuality[i].shapes[s].specialShapeVolume,t.projectAreaQuality[i].density)}else{o=e[i].shapes[s].getWeight(t.projectAreaQuality[i].density)}const a=o*(r.repairSets?r.repairSets+1:1)*(r.quantityShapes[s]&&r.quantityShapes[s].quantity?r.quantityShapes[s].quantity:0);return QR(a,1)}getTotalWeightForCourse(t,e,i,n){let s=0;for(let r=0;r<t.projectAreaQuality[i].courses[n].quantityShapes.length;r++){s+=this.getAreaCourseWeightForShape(t,e,i,n,r)}return QR(s,1)}calculateBricks(t,e,i=360){if(t[0].shapeTypeId=="su-brick"){if(e>0&&e>=t[0].radius&&e<=t[0].radius_max){const i=Math.round(2*3.14*(e+t[0].H)/t[0].A);const n=Math.round(2*3.14*(e+t[0].H)/t[0].A);const s=i>n?i:n;return[QR(s,0),0]}else{return[-1,0]}}else{const n=t[0];if(t[1]){const s=t[1];if(n.A>0&&n.B>0&&n.H>0&&n.L>0&&s.A>0&&s.B>0&&s.H>0&&s.L>0){const t=n.A==n.B||s.A==s.B;const r=i*6.28/360*n.H/(n.A-n.B);const o=n.radius>0?n.radius:n.getInternalRadius();const a=i*6.28/360*s.H/(s.A-s.B);const h=s.radius>0?s.radius:s.getInternalRadius();let c=0;let u=0;if(t){c=4*3.14*(e-h)/(n.A+n.B)*i/360;u=i*6.28/360*s.H/(s.A-s.B)}else{c=r*(h-e)/(h-o);u=a*(e-o)/(h-o)}return[Math.round(c),Math.round(u)]}else{return[0,0]}}else{const t=3.14*e*e;const i=n.A*n.B;const s=t/i;return[Math.ceil(s),0]}}}async checkMissingCalculations(t){return new Promise((async e=>{let i=[];t.projectAreaQuality.forEach((async(t,e)=>{let n=0;for(const e of t.courses){e.quantityShapes.forEach((t=>{n+=t.quantity}))}if(n==0)i.push(e)}));if(i.length>0){const e=await this.loadShapesForApplication(t);i.forEach((i=>{this.recalculateExistingCourses(t,e,i)}))}e(t)}))}recalculateExistingCourses(t,e,i,n=0,s){if(!s){s=t.projectAreaQuality[i].courses.length-1}for(let r=n;r<=s;r++){const n=t.projectAreaQuality[i].courses[r];const s=new _F({fromCourse:r,toCourse:r,courseNumbers:[n.courseNumber],step:1,layer:n.layer?n.layer:0,startAngle:n.startAngle?n.startAngle:0,endAngle:n.endAngle?n.endAngle:360,startHeight:n.height?n.height:0,startRadius:n.innerRadius});this.calculateAutofill(t,e,i,s,false)}}calculateAutofill(t,e,i,n,s=true){if(s)t.projectAreaQuality[i].autoFillCourses=n;let r=0;n.quantityShape.forEach((t=>{r+=t}));const o=t.projectAreaQuality[i];const a=e[i].shapes[0];if(s)o.courses=[];if(r>0){if(n.step<1)n.step=1;for(let e=0;e<=n.toCourse-n.fromCourse;e=e+n.step){const s=n.courseNumbers&&n.courseNumbers.length>0?n.courseNumbers[e]:n.fromCourse+e;const r=n.startRadius+QR(n.radiusStep*e,2);const h=new dF;h.courseNumber=s;h.repairSets=n.repairSets;h.startAngle=n.startAngle;h.endAngle=n.endAngle;h.widthAngle=n.endAngle-n.startAngle;h.height=n.startHeight+QR(a.H*e,1);h.innerRadius=r;h.layer=n.layer;const c=[];for(let e=0;e<t.projectAreaQuality[i].shapes.length;e++){c.push({shapeId:t.projectAreaQuality[i].shapes[e].shapeId,quantity:n.quantityShape[e]})}h.quantityShapes=c;o.courses.push(h)}}else{if(t.projectAreaQuality[i].bricksAllocationAreaId==="bottom"){const e=n.courseNumbers&&n.courseNumbers.length>0?n.courseNumbers[0]:0;let r=GF.calculateBricks([a,null],n.startRadius);const h=new dF;h.courseNumber=e;h.repairSets=n.repairSets;h.startAngle=n.startAngle;h.endAngle=n.endAngle;h.widthAngle=n.endAngle-n.startAngle;h.height=0;h.innerRadius=n.startRadius;h.layer=n.layer;h.quantityShapes=[{shapeId:t.projectAreaQuality[i].shapes[0].shapeId,quantity:r[0]}];if(t.projectAreaQuality[i].shapes.length>1){for(let e=1;e<=t.projectAreaQuality[i].shapes.length-1;e++){h.quantityShapes.push({shapeId:t.projectAreaQuality[i].shapes[e].shapeId,quantity:0})}}if(s){o.courses.push(h)}else{o.courses[n.fromCourse]=h}}else{const r=e[i].shapes[1];let h=false;if(r){if(a.A-a.B>r.A-r.B){h=true}}if(n.step<1)n.step=1;for(let e=0;e<=n.toCourse-n.fromCourse;e=e+n.step){const c=n.courseNumbers&&n.courseNumbers.length>0?n.courseNumbers[e]:n.fromCourse+e;const u=n.startRadius+QR(n.radiusStep*e,2);const l=GF.calculateBricks(h?[r,a]:[a,r],u,Math.abs(n.endAngle-n.startAngle));const f=new dF;f.courseNumber=c;f.repairSets=n.repairSets;f.startAngle=n.startAngle;f.endAngle=n.endAngle;f.widthAngle=n.endAngle-n.startAngle;f.height=n.startHeight+QR(a.H*e,1);f.innerRadius=u;f.layer=n.layer;if(r){f.quantityShapes=[{shapeId:t.projectAreaQuality[i].shapes[0].shapeId,quantity:h?l[1]:l[0]},{shapeId:t.projectAreaQuality[i].shapes[1].shapeId,quantity:h?l[0]:l[1]}]}else{f.quantityShapes=[{shapeId:t.projectAreaQuality[i].shapes[0].shapeId,quantity:l[0]}]}if(t.projectAreaQuality[i].shapes.length>2){for(let e=2;e<=t.projectAreaQuality[i].shapes.length-1;e++){f.quantityShapes.push({shapeId:t.projectAreaQuality[i].shapes[e].shapeId,quantity:0})}}if(s){o.courses.push(f)}else{o.courses[n.fromCourse]=f}}}}}}const GF=new BF;const HF="#,##0";const VF="#,##0.0";class WF{constructor(){this.mergedCellsErrors=[]}async selectLanguage(){return new Promise((async t=>{const e=[];HL.getLanguages().forEach((i=>{e.push({text:i.label,handler:()=>{t(i.value)}})}));const i=await gt.create({header:aP.getTransl("language","Language"),buttons:e});i.present()}))}async exportSummary(t,e,i,n,s,r){const o="FFCC00";const a=new vF.exports.Workbook;if(!r){r=await this.selectLanguage()}const h=await this.exportQuantity(t,e,i,n,s,r);this.cloneWorksheet(a,h,"Summary",{properties:{tabColor:{argb:o}}});this.saveWorkbook(a,"summary-"+zR(t.projectLocalId)+".xlsx")}async exportQuantityAssembly(t,e,i){if(!i){i=await this.selectLanguage()}const n="FFCC00";const s=new vF.exports.Workbook;const r=await this.exportQuantity(t,e,true,true,true,i);this.cloneWorksheet(s,r,"QT",{properties:{tabColor:{argb:n}}});const o=await this.exportAssembly(t,e,i);this.cloneWorksheet(s,o,"AT",{properties:{tabColor:{argb:n}}});this.saveWorkbook(s,"qty-assembly-"+zR(t.projectLocalId)+".xlsx")}async exportQuantity(t,e,i=true,n=true,s=true,r){if(!r){r=await this.selectLanguage()}const o=await this.selectCurrency();const a=o=="USD"?'"$"#,##0.00;[Red]-"$"#,##0.00':'""#,##0.00;[Red]-""#,##0.00';const h=GF.createProjectSummary(t,e,t.setsAmount&&t.setsAmount>0?t.setsAmount:1,i,n,s).projectSummary;await HL.presentLoading("please-wait",true);const c=await this.importTemplate();const u=c.getWorksheet("quantity");const l=dt.exports.cloneDeep(u);const f=["B3","B4","B7","D7","E7","F7","G7","H7","K7","N7","D34","D37","D38","H38"];f.map((t=>{const e=l.getCell(t).value;const i=aP.getTransl(zR(e),e.toString(),null,r);l.getCell(t).value=dt.exports.upperFirst(i)}));const d=["B10","B20","B18","B28","B31"];d.map((t=>{const e=l.getCell(t).value;const i=aP.getTransl(zR(e),e.toString(),null,r);l.getCell(t).value=dt.exports.upperCase(i)}));l.getCell("B4").value=aP.getTransl("drawing","Drawing",null,r)+" "+t.projectLocalId+" "+aP.getTransl("dated","dated",null,r)+" "+new Date(t.drawingDate).toLocaleDateString();l.getCell("N1").value=t.setsAmount;l.getCell("N2").value=o;let p=12;let m=1e3;let _=p;let v=18;let g=28;const b={};h.forEach((t=>{const e=t.areaId;if(!b[e]){b[e]=[]}if(!t.mass)b[e].push(t)}));const w=[];Object.keys(b).forEach((t=>{if(b[t].length>0)w.push(b[t])}));w.map(((t,e)=>{let i=p+1;let n=p+3;t.map(((s,o)=>{if(o==0&&e>0){p=p+5;m=m+5;n=n+5;i=i+5;l.insertRows(p,[[],[],[],[],[]])}if(o==0){l.getRow(p).height=19;l.getRow(p+1).height=19;l.getRow(p+2).height=5;l.getRow(p+3).height=19;l.getRow(p+4).height=5;this.cloneRows(l,5,17,m,p);const t=dt.exports.replace(s.areaId,"_*repair*_","");l.getCell(p,2).value=HL.getValueForLanguage(GF.getBricksAllocationAreas(t)[0].bricksAllocationAreaName,r)+(s.onlyForRepair?" ("+aP.getTransl("repair","Repair",null,r)+")":"")}const a=l.getRow(p+1);a.getCell(2).value=s.position;a.getCell(4).value=s.quality;a.getCell(5).value=s.shape;a.getCell(6).value=s.weightPerPiece_num;a.getCell(7).value=s.includeSafety/100;a.getCell(7).numFmt="0%";a.getCell(8).value=s.qtyPerSetPcs_num;a.getCell(9).value=s.qtyPerSetMT_num;a.getCell(11).value={formula:"$N$1*H"+(p+1)};a.getCell(12).value={formula:"$N$1*I"+(p+1)};a.getCell(14).value=1e3;a.getCell(15).value={formula:"P"+(p+1)+"/K"+(p+1)};a.getCell(16).value={formula:"N"+(p+1)+"*L"+(p+1)};if(o<t.length-1){l.insertRow(p+2,[],"i");l.getRow(p+2).height=19;p++;m++;n++}else{let t=l.getCell(m+3,2).formula;do{t=t.replace("B1000","B"+i).replace("B1002","B"+(n-1))}while(t.indexOf("B1000")>=0);let e=l.getCell(m+3,8).formula;do{e=e.replace("H1000","H"+i).replace("H1002","H"+(n-1))}while(e.indexOf("H1000")>=0);let s=l.getCell(m+3,9).formula;do{s=s.replace("I1000","I"+i).replace("I1002","I"+(n-1))}while(s.indexOf("I1000")>=0);let r=l.getCell(m+3,11).formula;do{r=r.replace("K1000","K"+i).replace("K1002","K"+(n-1))}while(r.indexOf("K1000")>=0);let o=l.getCell(m+3,12).formula;do{o=o.replace("L1000","L"+i).replace("L1002","L"+(n-1))}while(o.indexOf("L1000")>=0);let a=l.getCell(m+3,16).formula;do{a=a.replace("P1000","P"+i).replace("P1002","P"+(n-1))}while(a.indexOf("P1000")>=0);const h=l.getRow(n);h.getCell(2).value={formula:t};h.getCell(8).value={formula:e};h.getCell(9).value={formula:s};h.getCell(11).value={formula:r};h.getCell(12).value={formula:o};h.getCell(16).value={formula:a};v=n+3;const c=l.getRow(v);const u=l.getRow(m+5);let f=u.getCell(8).formula;f=f.replace("$F$17","$F$"+(n+2)).replace("H17","H"+(n+2));let d=u.getCell(9).formula;d=d.replace("$F$17","$F$"+(n+2)).replace("I17","I"+(n+2));let p=u.getCell(11).formula;p=p.replace("$F$17","$F$"+(n+2)).replace("K17","K"+(n+2));let _=u.getCell(12).formula;_=_.replace("$F$17","$F$"+(n+2)).replace("L17","L"+(n+2));let g=u.getCell(16).formula;g=g.replace("$F$17","$F$"+(n+2)).replace("P17","P"+(n+2));c.getCell(8).value={formula:f};c.getCell(9).value={formula:d};c.getCell(11).value={formula:p};c.getCell(12).value={formula:_};c.getCell(16).value={formula:g}}}))}));if(t.projectAreaQuality.length==0){l.spliceRows(10,10);m=m-10}else{_=p+10}if(s){let e={};for(let i=0;i<t.projectMass.length;i++){const n=t.projectMass[i];if(!e[n.bricksAllocationAreaId])e[n.bricksAllocationAreaId]=[];e[n.bricksAllocationAreaId].push(n)}const i=_-1;for(let t=0;t<Object.keys(e).length;t++){const n=e[Object.keys(e)[t]];if(t>0){_=_+5;m=m+5;l.insertRows(_,[[],[],[],[],[]])}l.getRow(_).height=19;l.getRow(_+1).height=19;l.getRow(_+2).height=5;l.getRow(_+3).height=19;l.getRow(_+4).height=5;this.cloneRows(l,5,17,m,_);l.getCell(_,2).value=HL.getValueForLanguage(GF.getBricksAllocationAreas(n[0].bricksAllocationAreaId)[0].bricksAllocationAreaName,r);const s=_;let o=_+3;for(let t=0;t<n.length;t++){const e=h.find((e=>e.position==n[t].position));if(e.mass){const i=l.getRow(_+1);i.getCell(2).value=e.position;i.getCell(4).value=e.quality;i.getCell(5).value=e.shape;i.getCell(6).value=e.weightPerPiece_num;i.getCell(8).value=e.qtyPerSetPcs_num;i.getCell(9).value=e.qtyPerSetMT_num;i.getCell(11).value={formula:"$N$1*H"+(_+1)};i.getCell(12).value={formula:"$N$1*I"+(_+1)};i.getCell(14).value=1e3;i.getCell(15).value={formula:"P"+(p+1)+"/K"+(_+1)};i.getCell(16).value={formula:"N"+ +(_+1)+"*L"+(_+1)};if(t<n.length-1){l.insertRow(_+2,[],"i");l.getRow(_+2).height=19;_++;m++;o++}}}let a=l.getCell(m+3,2).formula;do{a=a.replace("B1000","B"+s).replace("B1002","B"+(o-1))}while(a.indexOf("B1000")>=0);let c=l.getCell(m+3,8).formula;do{c=c.replace("H1000","H"+s).replace("H1002","H"+(o-1))}while(c.indexOf("H1000")>=0);let u=l.getCell(m+3,9).formula;do{u=u.replace("I1000","I"+s).replace("I1002","I"+(o-1))}while(u.indexOf("I1000")>=0);let f=l.getCell(m+3,11).formula;do{f=f.replace("K1000","K"+s).replace("K1002","K"+(o-1))}while(f.indexOf("K1000")>=0);let d=l.getCell(m+3,12).formula;do{d=d.replace("L1000","L"+s).replace("L1002","L"+(o-1))}while(d.indexOf("L1000")>=0);let v=l.getCell(m+3,16).formula;do{v=v.replace("P1000","P"+s).replace("P1002","P"+(o-1))}while(v.indexOf("P1000")>=0);const b=l.getRow(o);b.getCell(2).value={formula:a};b.getCell(8).value={formula:c};b.getCell(9).value={formula:u};b.getCell(11).value={formula:f};b.getCell(12).value={formula:d};b.getCell(16).value={formula:v};g=o+3;const w=l.getRow(g);const y=l.getRow(m+5);let x=y.getCell(8).formula;x=x.replace("$F$10","$F$"+i).replace("$F$17","$F$"+(o+2)).replace("H10","H"+i).replace("H17","H"+(o+2));let M=y.getCell(9).formula;M=M.replace("$F$10","$F$"+i).replace("$F$17","$F$"+(o+2)).replace("I10","I"+i).replace("I17","I"+(o+2));let T=y.getCell(11).formula;T=T.replace("$F$10","$F$"+i).replace("$F$17","$F$"+(o+2)).replace("K10","K"+i).replace("K17","K"+(o+2));let O=y.getCell(12).formula;O=O.replace("$F$10","$F$"+i).replace("$F$17","$F$"+(o+2)).replace("L10","L"+i).replace("L17","L"+(o+2));let E=y.getCell(16).formula;E=E.replace("$F$10","$F$"+i).replace("$F$17","$F$"+(o+2)).replace("P10","P"+i).replace("P17","P"+(o+2));w.getCell(8).value={formula:x};w.getCell(9).value={formula:M};w.getCell(11).value={formula:T};w.getCell(12).value={formula:O};w.getCell(16).value={formula:E}}if(t.projectMass.length==0){l.spliceRows(v+1,10);g=0}}else{l.spliceRows(v+1,10);g=0}let y=(g>v?g:v)+3;if(t.projectAreaQuality.length>0&&t.projectMass.length>0&&s){const t=l.getRow(y);t.getCell(8).value={formula:"H"+v+"+H"+g};t.getCell(9).value={formula:"I"+v+"+I"+g};t.getCell(12).value={formula:"L"+v+"+L"+g};t.getCell(16).value={formula:"P"+v+"+P"+g}}else{l.spliceRows(y-1,3);y=y-3}l.spliceRows(m,5);l.getColumn(14).numFmt=a;l.getColumn(15).numFmt=a;l.getColumn(16).numFmt=a;l.getColumn(6).numFmt=VF;l.getColumn(8).numFmt=HF;l.getColumn(9).numFmt=VF;l.getColumn(11).numFmt=HF;l.getColumn(12).numFmt=VF;l.getCell(1,14).numFmt="0";const x={};h.forEach((t=>{if(!x[t.quality]){x[t.quality]={pcs:0,mt:0}}x[t.quality].pcs+=t.qtyPerSetPcs_num;x[t.quality].mt+=t.qtyPerSetMT_num}));let M=y+8;let T=M;Object.keys(x).forEach((t=>{const e=l.getRow(T);const i=l.getRow(M);for(let t=1;t<9;t++){e.getCell(t).style=dt.exports.cloneDeep(i.getCell(t).style)}e.getCell(8).value=1e3;e.getCell(8).numFmt=a;e.getCell(4).value=t;e.getCell(5).value=x[t].pcs;e.getCell(5).numFmt=HF;e.getCell(6).value=x[t].mt;e.getCell(6).numFmt=VF;for(let e=12;e<y;e++){const i=l.getRow(e);if(i.getCell(4).value==t){i.getCell(14).value={formula:"$H$"+T}}}T++}));const O=l.getRow(M);const E=l.getRow(T);for(let t=1;t<9;t++){E.getCell(t).style=dt.exports.cloneDeep(O.getCell(t).style)}E.getCell(4).value=aP.getTransl("total","Total",null,r).toUpperCase();E.getCell(5).value={formula:"SUM(E"+M+":E"+(T-1)+")"};E.getCell(5).numFmt=HF;E.getCell(6).value={formula:"SUM(F"+M+":F"+(T-1)+")"};E.getCell(6).numFmt=VF;HL.dismissLoading();return l}async exportAssembly(t,e,i){if(!i){i=await this.selectLanguage()}await HL.presentLoading("please-wait",true);const n=await this.importTemplate();const s="_*repair*_";const r=n.getWorksheet("assembly");const o=dt.exports.cloneDeep(r);const a=["B7","B10","B11","B12","B13","B18","B20","B26","B27"];a.map((t=>{const e=o.getCell(t).value;const n=aP.getTransl(zR(e),e.toString(),null,i);o.getCell(t).value=dt.exports.upperFirst(n)}));const h=5;const c=[7,9,11,12,13,15,16,17,18,19,25,26];let u=h;const l={};console.log("project",t);t.projectAreaQuality.forEach(((t,i)=>{t.shapes.forEach(((n,r)=>{const o=t.bricksAllocationAreaId+"-"+t.datasheetId;if(!l[o]){l[o]=dt.exports.cloneDeep(t);l[o].courses=[];l[o].shapes=[]}let a=l[o].shapes.find((t=>t.shapeId==n.shapeId));if(!a){n["shape"]=e[i].shapes[r];l[o].shapes.push(n)}t.courses.forEach((t=>{let e=false;for(let i of l[o].courses){if(t.courseNumber==i.courseNumber){e=true;let s=i.quantityShapes.find((t=>t.shapeId==n.shapeId));const r=t.quantityShapes.find((t=>t.shapeId==n.shapeId));if(!s){s=dt.exports.cloneDeep(r);i.quantityShapes.push(s)}else{s.quantity+=r.quantity}break}}if(!e){const e=dt.exports.cloneDeep(t);const i=e.quantityShapes.find((t=>t.shapeId==n.shapeId));const r=dt.exports.cloneDeep(i);e.quantityShapes=[];e.quantityShapes.push(r);if(t.repairSets>0){if(!l[o+s]){l[o+s]=dt.exports.cloneDeep(l[o])}l[o+s].courses.push(e)}l[o].courses.push(e)}}))}))}));for(let t=0;t<Object.keys(l).length;t++){const e=Object.keys(l)[t];let n=false;if(e.includes(s))n=true;const r=l[e];r.shapes=dt.exports.orderBy(r.shapes,"position");const a=u;let f=u+1;for(let t=0;t<r.shapes.length;t++){const e=r.shapes[t];c.forEach((t=>{this.mergeCells(o,t,u,t,f)}));this.copyCellsStylesandValues(o,1,u,27,f,false,h);o.getCell(7,u).value=HL.getValueForLanguage(GF.getBricksAllocationAreas(r.bricksAllocationAreaId)[0].bricksAllocationAreaName,i)+(r.onlyForRepair||n?" ("+aP.getTransl("repair","Repair",null,i)+")":"");o.getCell(8,u).value=e.position;this.mergeCells(o,8,u,8,f);o.getCell(10,u).value=$F.getDatasheetsById(r.datasheetId).productName;o.getCell(10,f).value=e["shape"].getDimensions();o.getCell(11,u).value=e["shape"].shapeName;let s=0;if(e.specialShapeVolume>0){s=e["shape"].getWeightForVolume(e.specialShapeVolume,r.density)}else{s=e["shape"].getWeight(r.density)}o.getCell(12,u).value=s;o.getCell(13,u).value="Pc";u=u+2;f=f+2}this.mergeCells(o,7,a,7,f-2)}this.copyCellsStylesandValues(o,1,u,27,u+1,false,h-3);c.forEach((t=>{this.mergeCells(o,t,u,t,u+1)}));this.setBorder(o,"medium",false,true,false,false,7,u+2,20,u+2);this.setBorder(o,"medium",false,true,false,false,26,u+2,27,u+2);this.mergeCells(o,7,u,8,u+1);this.mergeCells(o,3,2,3,u+1);this.mergeCells(o,4,2,4,u+1);o.getCell("B3").value=aP.getTransl("assembly_table","Assembly Table",null,i);o.getCell("B4").value=aP.getTransl("drawing","Drawing",null,i)+" "+t.projectLocalId+" "+aP.getTransl("dated","dated",null,i)+" "+new Date(t.drawingDate).toLocaleDateString();const f=o.getCell(7,u);f.value=aP.getTransl("total","Total",null,i);f.alignment={vertical:"middle",horizontal:"center"};const d=o.getCell(13,u);d.value="Pc";d.alignment={vertical:"middle",horizontal:"center"};const p=[];Object.keys(l).forEach((t=>{const e=l[t];e.courses.forEach((t=>{p.push(t.courseNumber)}))}));const m=dt.exports.min(p);const _=dt.exports.max(p);let v=15;let g=v;for(let t=_;t>=m;t--){if(t<_){o.insertRow(g,[],"i")}const e=o.getRow(g);this.copyCellsStylesandValues(o,g,1,g,u+2,false,null,15);e.height=18;e.hidden=false;e.getCell("B").value=t;let i=null;for(let e=5;e<u+2;e=e+2){this.mergeCells(o,g,e,g,e+1);if(t==m){this.mergeCells(o,g+2,e,g+2,e+1);this.mergeCells(o,g+3,e,g+3,e+1);this.mergeCells(o,g+4,e,g+4,e+1);this.mergeCells(o,g+5,e,g+5,e+1);this.mergeCells(o,g+11,e,g+11,e+1);this.mergeCells(o,g+12,e,g+12,e+1);const t=o.getRow(g+2);const n=t.getCell(e);const s=t.getCell("E");const r=n.address.replace((g+2).toString(),"");let a=s.formula;a=LR(a,"E14",r+"14");a=LR(a,"E15",r+g.toString());a=LR(a,"E"+g.toString(),r+g.toString());n.value={formula:a};const h=o.getRow(g+4);const c=h.getCell(e);const l=h.getCell("E");let f=l.formula;f=LR(f,"E17",r+(g+2).toString());f=LR(f,"E18",r+(g+3).toString());f=LR(f,"E"+(g+2).toString(),r+(g+2).toString());f=LR(f,"E"+(g+3).toString(),r+(g+3).toString());c.value={formula:f};const d=o.getRow(g+5);const p=d.getCell(e);const m=d.getCell("E");let _=m.formula;_=LR(_,"E12",r+"12");_=LR(_,"E19",r+(g+4).toString());_=LR(_,"E"+(g+4).toString(),r+(g+4).toString());p.value={formula:_};const v=o.getRow(g+11);const b=v.getCell(e);const w=v.getCell("E");let y=w.formula;y=LR(y,"E14",r+"14");y=LR(y,"E15",r+g.toString());y=LR(y,"E"+g.toString(),r+g.toString());b.value={formula:y};const x=o.getRow(g+12);const M=x.getCell(e);M.value={formula:r+(g+2)+"/"+r+(g+11)};if(e>=u){let t=o.getCell(r+(g+2)).formula;t=t.replace(r+"14","E"+(g+4));t=t.replace(r+g,i+(g+4));o.getCell(r+(g+4)).value={formula:t};o.getCell(r+(g+4)).numFmt="0";t=t.replace((g+4).toString(),(g+5).toString());t=t.replace((g+4).toString(),(g+5).toString());o.getCell(r+(g+5)).value={formula:t};o.getCell(r+(g+5)).alignment={vertical:"middle",horizontal:"center"};o.getCell(r+(g+11)).value="";o.getCell(r+(g+12)).value=""}else{i=r}}}this.mergeCells(o,g,2,g,3);if(t==m){this.mergeCells(o,g+2,2,g+2,3);this.mergeCells(o,g+3,2,g+3,3);this.mergeCells(o,g+4,2,g+4,3);this.mergeCells(o,g+5,2,g+5,3);this.mergeCells(o,g+11,2,g+11,3);this.mergeCells(o,g+12,2,g+12,3)}o.getCell(g,2).border={top:{style:"thin"},left:{style:"medium"},bottom:{style:"thin"},right:{style:"medium"}};const n=o.getCell(g,u);const s=o.getCell(g,u-1).address.replace(g.toString(),"");let r=o.getCell(g+2,5).formula;r=r.replace("E14","E"+g);r=r.replace(t==m?"E"+g:"E15",s+g);n.value={formula:r};n.alignment={vertical:"middle",horizontal:"center"};n.numFmt="0";g++}o.getRow(g).hidden=true;u=h;for(let t=0;t<Object.keys(l).length;t++){const e=Object.keys(l)[t];let i=false;if(e.includes(s))i=true;const n=l[e];for(let t=0;t<n.shapes.length;t++){const e=n.shapes[t];for(let t=0;t<n.courses.length;t++){const s=n.courses[t];const r=s.courseNumber;const a=v+_-r;const h=s.quantityShapes.find((t=>t.shapeId==e.shapeId));let c=h?h.quantity*(i?s.repairSets:1):null;if(o.getCell(a,u).value){c+=dt.exports.toNumber(o.getCell(a,u).value)}o.getCell(a,u).value=c>0?c:""}o.getCell(g+2,u).value=n.includeSafety/100;u=u+2}}o.getRow(g+4).numFmt=VF;o.getRow(g+10).numFmt=HF;o.getRow(g+11).numFmt=HF;HL.dismissLoading();return o}async exportShapes(t,e,i){await HL.presentLoading("please-wait",true);const n="FF99CC";const s=new vF.exports.Workbook;const r=await this.importTemplate();const o=r.getWorksheet("shape");const a={};e.forEach((e=>{e.shapes.forEach((i=>{const n=i.dwg&&i.dwg.id?i.dwg.id:null;if(n){if(!a[n])a[n]={};const s=t.projectAreaQuality[e.areaIndex];const r=s.datasheetId;if(!a[n][r])a[n][r]=[];const o=s.shapes.find((t=>t.shapeId==i["shapeId"]));const h=o.position;const c=o.specialShapeVolume;if(c>0){i["specialShapeVolume"]=c}const u=a[n][r];if(!dt.exports.find(u,{position:h,shape:i})){a[n][r].push({shape:i,density:s.density,position:h})}a[n][r]=dt.exports.orderBy(a[n][r],"position")}}))}));for(let e=0;e<Object.keys(a).length;e++){let r=17;let h=19;let c=19;let u=20;let l=20;let f=42;let d=0;const p=Object.keys(a)[e];const m=a[p];const _=dt.exports.cloneDeep(o);const v=["E17","G17","BA17","BF17","AT44","C47","BA47","BG47","AT48","AT49","AT50","C51","E51","AH51","AN51","BA51","BG51"];v.map((t=>{const e=_.getCell(t).value;const n=aP.getTransl(zR(e),e.toString(),null,i);_.getCell(t).value=dt.exports.upperFirst(n)}));let g=null;for(let t=0;t<Object.keys(m).length;t++){const e=Object.keys(m)[t];if(t>0){const t=_.getRow(h);c++;l++;const e=_.getRow(c);for(let i=5;i<63;i++){e.getCell(i).style=dt.exports.cloneDeep(t.getCell(i).style)}this.mergeCells(_,c,5,c,17,"thin");this.mergeCells(_,c,18,c,22,"thin");this.mergeCells(_,c,23,c,52,"thin");this.setBorder(_,"thin",false,false,false,false,c,18,c,22)}const i=m[e];for(let t=0;t<i.length;t++){if(l>=f){d++;_.insertRow(l,[],"i");this.copyCellsStylesandValues(_,l,1,l,70,false,null,t==0?h:u)}const n=i[t];const s=n.shape;const o=_.getRow(l);const a=n.density;const p=n.position;if(t==0){const t=_.getRow(c);this.mergeCells(_,c,5,c,17);this.setBorder(_,"thin",true,true,true,false,c,5,c,17);this.mergeCells(_,c,18,c,22);this.setBorder(_,"thin",true,false,true,false,c,18,c,22);this.mergeCells(_,c,23,c,62);this.setBorder(_,"thin",true,false,true,true,c,23,c,62);if(e){const i=await $F.getDatasheet(e);t.getCell(5).value=i.productName;t.getCell(18).value=a;t.getCell(23).value="g/cm"}}const m=38;const v=_.getRow(r);const g=_.getRow(r+1);const b={H:null,H1:null,H2:null,A:null,A1:null,B:null,B1:null,L:null,L1:null,La:null,Lb:null,ANG:null,ANG1:null,D:null,Di:null,De:null,D1:null,D2:null,D3:null,D4:null,N:null,specialShapeVolume:null};let w=0;for(let t=0;t<Object.keys(b).length;t++){const e=Object.keys(b)[t];if(s[e]>0){b[e]=s[e];w++}}const y=Math.ceil(m/w);const x=m-y*(w-1);let M=15;let T=1;for(let e=0;e<Object.keys(b).length;e++){const i=Object.keys(b)[e];if(b[i]>0){const e=T==w?x:y;if(t==0){this.mergeCells(_,r,M,r,M+e-1,"thin");this.mergeCells(_,r+1,M,r+1,M+e-1,"thin");v.getCell(M).value=i;g.getCell(M).value=i=="ANG"||i=="ANG1"?"":"mm"}this.mergeCells(_,l,M,l,M+e-1,"thin");this.mergeCells(_,l,5,l,6,"thin");this.mergeCells(_,l,7,l,14,"thin");this.mergeCells(_,l,53,l,57,"thin");this.mergeCells(_,l,58,l,62,"thin");o.getCell(M).value=i!="specialShapeVolume"?b[i]:"-";o.getCell("E").value=p;o.getCell("G").value=s.shapeName;let n=0;let h=0;if(s["specialShapeVolume"]){h=s["specialShapeVolume"];n=s.getWeightForVolume(s["specialShapeVolume"],a)}else{h=s.volume;n=s.getWeight(a)}o.getCell("BA").value=h;o.getCell("BF").value=n;M+=e;T++}}const O=_.getRow(u);for(let t=5;t<63;t++){o.getCell(t).style=dt.exports.cloneDeep(O.getCell(t).style)}l++;c++}if(t==0){g=i[0].shape.dwg}}const b=KN.getCustomersDetails(t.customerId);_.getCell("C"+(48+d)).value=b?b.fullName:null;_.getCell("C"+(49+d)).value=t.docsCaption;_.getCell("AT"+(45+d)).value=t.projectLocalId;_.getCell("BA"+(48+d)).value=mz.userProfile.displayName;_.getCell("BA"+(49+d)).value=mz.userProfile.displayName;_.getCell("BA"+(50+d)).value=mz.userProfile.displayName;_.getCell("BG"+(48+d)).value=new Date(t.drawingDate).toLocaleDateString();_.getCell("BG"+(49+d)).value=new Date(t.drawingDate).toLocaleDateString();_.getCell("BG"+(50+d)).value=new Date(t.drawingDate).toLocaleDateString();this.mergeCells(_,44+d,3,46+d,23,"thick");this.mergeCells(_,44+d,24,46+d,45,"thick");this.mergeCells(_,44+d,46,44+d,64,"thick");this.mergeCells(_,45+d,46,46+d,64,"thick");this.mergeCells(_,47+d,3,47+d,45,"thick");this.mergeCells(_,48+d,3,48+d,45);this.setBorder(_,"thick",true,true,false,true,48+d,3,48+d,45);this.mergeCells(_,49+d,3,50+d,45);this.setBorder(_,"thick",false,true,true,true,49+d,3,50+d,45);for(let t=47;t<=51;t++){this.mergeCells(_,t+d,46,t+d,52,"thick");this.mergeCells(_,t+d,53,t+d,58,"thick");this.mergeCells(_,t+d,59,t+d,64,"thick")}this.mergeCells(_,52+d,46,53+d,52,"thick");this.mergeCells(_,52+d,53,53+d,58,"thick");this.mergeCells(_,52+d,59,53+d,64,"thick");this.mergeCells(_,54+d,46,55+d,64,"thick");for(let t=51;t<=55;t++){this.mergeCells(_,t+d,3,t+d,4,"thick");this.mergeCells(_,t+d,5,t+d,10,"thick");this.mergeCells(_,t+d,11,t+d,33,"thick");this.mergeCells(_,t+d,34,t+d,39,"thick");this.mergeCells(_,t+d,40,t+d,45,"thick")}this.setBorder(_,"thin",true,false,false,false,l,5,l,62);this.setBorder(_,"thick",false,false,true,false,f+d+1,5,f+d+1,62);for(let t=l+1;t<=f+d;t++){this.setBorder(_,"thin",false,false,false,false,t,5,t,62)}const w=this.cloneWorksheet(s,_,p,{properties:{tabColor:{argb:n}},pageSetup:{fitToPage:true,fitToHeight:1,fitToWidth:1}});w.pageSetup.printArea="B2:BM"+(56+d);await this.addRefraLogo(s,w,3,43.2+d,255,53+d);if(g){const t=await OF.storeAndLoadImage(g.url,true);const e=s.addImage({base64:t.src,extension:t.ext=="png"?"png":t.ext=="gif"?"gif":"jpeg"});w.addImage(e,"D4:BK15")}}this.saveWorkbook(s,"shapes-"+zR(t.projectLocalId)+".xlsx");HL.dismissLoading()}async exportDatasheets(t,e){if(!e){e=await this.selectLanguage()}await HL.presentLoading("please-wait",true);const i="993300";await $F.downloadDatasheetSettings();const n=new vF.exports.Workbook;const s=await this.importTemplate();const r=s.getWorksheet("datasheet");const o={};t.projectAreaQuality.forEach((t=>{o[t.datasheetId]=null}));t.projectMass.forEach((t=>{o[t.datasheetId]=null}));let a=16;for(let t=0;t<Object.keys(o).length;t++){let s=450;let h=16;let c=19;const u=Object.keys(o)[t];const l=await $F.getDatasheet(u);const f=dt.exports.cloneDeep(r);const d=["C5","C7","C11","C13","C22","H22","M22","C28"];d.map((t=>{const i=f.getCell(t).value;const n=aP.getTransl(zR(i),i.toString(),null,e);f.getCell(t).value=n.toUpperCase()}));f.getCell("J7").value=l.productName;f.getCell("I11").value=HL.getValueForLanguage(l.classification,e);f.getCell("I13").value=HL.getValueForLanguage(l.application,e);f.getCell("C24").value=l.revisionNo;f.getCell("H24").value=new Date(l.issuedOnDate).toLocaleDateString();f.getCell("M24").value=l.techNo;const p={};const m=l.orderPropertiesForExport();m.forEach((t=>{if(!p[t.type])p[t.type]=[];if(t.show){p[t.type].push(t)}}));for(let t=0;t<Object.keys(p).length;t++){const i=Object.keys(p)[t];for(let n=0;n<p[i].length;n++){const r=p[i][n];if(n==0){if(t>0){f.insertRows(h,[[],[],[],[],[]],"n");f.getRow(h).height=15;f.getRow(h+1).height=15;f.getRow(h+2).height=15;f.getRow(h+3).height=15;s=s-15*4;h++}const n=f.getRow(a);const o=f.getRow(h);for(let t=3;t<16;t++){o.getCell(t).style=dt.exports.cloneDeep(n.getCell(t).style)}o.height=17;const u=f.getRow(a+1);const l=f.getRow(h+1);for(let t=3;t<16;t++){l.getCell(t).style=dt.exports.cloneDeep(u.getCell(t).style)}l.height=1;this.mergeCells(f,h,3,h,6);this.mergeCells(f,h,14,h,15);let d=$F.getDatasheetPropertyTypes(r.type)[0].typeName.toUpperCase();const m=d.includes("RAW");if(m){d=d.replace("RAW","")}d=d.trim().toLowerCase();d=aP.getTransl(zR(d+"_analysis"),d+" Analysis",null,e).toUpperCase();o.getCell("C").value=d;o.getCell("J").value=m?aP.getTransl("typical_raw","Typical for the raw material",null,e):aP.getTransl("typical_prod","Typical for the product",null,e);let _=false;p[i].map((t=>{_=_||dt.exports.isNumber(t.typical)}));o.getCell("N").value=_?aP.getTransl("limit_values","Limit Values",null,e):"";if(t>0){c=h+3}}if(n>0){f.insertRows(c,[[],[]],"n");s=s-18}const o=f.getRow(c);o.height=17;o.alignment={vertical:"top",horizontal:"right"};this.mergeCells(f,c,10,c,12);this.mergeCells(f,c,13,c,14);f.getRow(c+1).height=1;const u=$F.getDatasheetPropertyNames("id",r.name)[0];const l=HL.getValueForLanguage(u.nameDescLeft,e);const d=HL.getValueForLanguage(u.nameDescRight,e);const m=HL.getValueForLanguage(u.comments,e);const _=HL.getValueForLanguage(u.dimension,e);const v=dt.exports.toNumber(u.decimals);o.getCell("C").value=l;o.getCell("C").alignment={vertical:"top",horizontal:"left"};o.getCell("H").value=d?d:"";o.getCell("H").alignment={vertical:"top",horizontal:"left"};if(m){o.getCell("I").value=m;o.getCell("I").alignment={vertical:"top",horizontal:"left"};this.mergeCells(f,c,"I",c,"J")}o.getCell("O").value=_;o.getCell("O").alignment={horizontal:"left",vertical:"top"};let g;switch(v){case 1:g="0.0";break;case 2:g="0.00";break;case 3:g="0.000";break;default:g="0";break}o.getCell("N").value=(r.prefix?r.prefix+" ":"")+(r.lower>=0&&r.higher>0?QR(r.lower,v)+" - "+QR(r.higher,v):r.lower>=0?QR(r.lower,v):r.higher>0?QR(r.higher,v):null);o.getCell("N").numFmt=g;if(r.typical>0){o.getCell("J").value=QR(r.typical,v);o.getCell("J").numFmt=g}["C","D","E","F","G","H","I","J","K","L","M","N","O"].forEach((t=>{o.getCell(t).border={bottom:{style:"hair",color:{argb:"FF000000"}}}}));c=c+2;h=c}if(Object.keys(p).length>1){f.insertRows(c,[[]],"n");f.getRow(c).height=15;s=s-15}}f.getRow(c).height=s>0?s:1;c++;this.mergeCells(f,c+1,3,c+1,6);this.mergeCells(f,c+1,8,c+1,11);this.mergeCells(f,c+1,13,c+1,15);this.mergeCells(f,c+3,3,c+3,6);this.mergeCells(f,c+3,8,c+3,11);this.mergeCells(f,c+3,13,c+3,15);this.mergeCells(f,c+7,3,c+7,15);f.getCell(c+7,3).border={top:{},left:{style:"thin"},bottom:{},right:{style:"thin"}};const _=this.cloneWorksheet(n,f,l.productName,{pageSetup:{fitToPage:true,fitToHeight:1,fitToWidth:1},properties:{tabColor:{argb:i}}});_.pageSetup.printArea="A1:Q"+(c+10);await this.addRefraLogo(n,_,2,2,290,60)}this.saveWorkbook(n,"datasheets-"+zR(t.projectLocalId)+".xlsx");await HL.dismissLoading()}async exportBudget(t,e){const i=GF.createProjectSummary(t,e,t.setsAmount&&t.setsAmount>0?t.setsAmount:1,true,true,true,"brickQuality").projectSummary;await HL.presentLoading("please-wait",true);const n=await this.importTemplate();const s="B7DEE8";const r=new vF.exports.Workbook;const o=n.getWorksheet("budget");const a=dt.exports.cloneDeep(o);const h=["'Master Codes'!C3:C30"];a.getCell("G12").dataValidation={type:"list",formulae:h,showErrorMessage:true,showInputMessage:true};a.getCell("G17").dataValidation={type:"list",formulae:h,showErrorMessage:true,showInputMessage:true};const c=["'Master Codes'!F3:F100"];a.getCell("G13").dataValidation={type:"list",formulae:c,showErrorMessage:true,showInputMessage:true};a.getCell("G25").dataValidation={type:"list",formulae:c,showErrorMessage:true,showInputMessage:true};const u=["'Master Codes'!P3:P16"];a.getCell("G14").dataValidation={type:"list",formulae:u,showErrorMessage:true,showInputMessage:true};const l=["'Master Codes'!S3:S16"];a.getCell("H25").dataValidation={type:"list",formulae:l,showErrorMessage:true,showInputMessage:true};a.getCell("G4").value=(new Date).toLocaleDateString();a.getCell("G6").value=mz.userProfile.displayName;a.getCell("G7").value=t.projectLocalId;a.getCell("G11").value=KN.getCustomersDetails(t.customerId).fullName;a.getCell("G19").value=t.setsAmount;let f=null;try{f=await $R()}catch(t){f={rates:{USD:1,CHF:1}};ht.log("convertCurrency err",t)}if(f&&f["rates"]){a.getCell("AI15").value=f["rates"]["USD"];a.getCell("AI16").value=f["rates"]["CHF"]}const d=26;let p=26;for(let e=0;e<i.length;e++){const n=i[e];if(e>0){a.insertRow(p,[],"i")}this.copyCellsStylesandValues(a,p,3,p,56,false,null,d);for(let t=15;t<=55;t++){const e=a.getCell(d,t).formula;const i=a.getCell(d,t).value;const n=a.getCell(p,t);if(e){const t=LR(e,d,p);n.value={formula:t}}else{n.value=i}}const s=a.getRow(p);s.getCell("I").value=n.position+" - "+n.area;s.getCell("J").value=t.projectAreaQuality[n.areaIndex].datasheetId?$F.getDatasheetsById(t.projectAreaQuality[n.areaIndex].datasheetId).techNo:null;s.getCell("K").value=n.shape;s.getCell("L").value=n.quality;s.getCell("M").value=n.qtyPerSetPcs_num;const r=s.getCell("N");if(n.weightPerPiece_num>0){r.value={formula:"M"+p+"*"+n.weightPerPiece_num/1e3}}else{r.value=n.qtyPerSetMT_num}const o=['"MT,Pc.,Day"'];s.getCell("Q").dataValidation={type:"list",formulae:o,allowBlank:false,showErrorMessage:true,showInputMessage:true};s.getCell("AJ").dataValidation={type:"list",formulae:o,allowBlank:false,showErrorMessage:true,showInputMessage:true};if(n.qtyPerSetMT_num>0){s.getCell("Q").value="MT";s.getCell("AJ").value="MT"}else{s.getCell("Q").value="Pc.";s.getCell("AJ").value="Pc."}p++}for(let t=d;t<=p;t++){let e=["W","X","Z","AA"];e.forEach((e=>{const i=a.getCell(e+t);const n=i.formula;if(n){let t=LR(n,"30",p+3);i.value={formula:t}}}))}let m=["Y12","AA12","W19","X19","Y19","Z19","AA19"];m.forEach((t=>{const e=a.getCell(t);const i=e.formula;if(i){let t=LR(i,"30",p+3);e.value={formula:t}}}));const _=a.getCell("AC19");const v=_.formula;if(v){let t=LR(v,"28",p+1);_.value={formula:t}}for(let t=p+1;t<=p+3;t++){const e=["M","N","P","S","V","W","X","Y","Z","AA","AC","AD","AE","AF","AG","AI","AN","AO","AP","AQ","AR","AT","AV","AW","BB"];e.forEach((e=>{const i=a.getCell(e+t);let n;try{n=i.formula}catch(i){console.log("error",i,e+t)}if(n){let t=LR(n,"27",p);t=LR(t,"29",p+2);i.value={formula:t}}}));this.mergeCells(a,t,"P",t,"Q");this.mergeCells(a,t,"AT",t,"AU");this.mergeCells(a,t,"AW",t,"AX");this.mergeCells(a,t,"BB",t,"BC")}const g=["AE","AI","AP","AT","AV","AW","BB"];g.forEach((t=>{const e=a.getCell(t+(p+5));const i=e.formula;if(i){let t=LR(i,"30",p+3);e.value={formula:t}}}));let b=["M6","M7","M9","M15","M16"];b.forEach((t=>{const e=a.getCell(t);const i=e.formula;if(i){let t=LR(i,"30",p+3);e.value={formula:t}}}));b=["M8"];b.forEach((t=>{const e=a.getCell(t);const i=e.formula;if(i){let t=LR(i,"34",p+7);e.value={formula:t}}}));b=["M14"];b.forEach((t=>{const e=a.getCell(t);const i=e.formula;if(i){let t=LR(i,"32",p+5);e.value={formula:t}}}));const w=a.getCell("S"+(p+5));const y=w.formula;let x=LR(y,"30",p+3);w.value={formula:x};const M=a.getCell("S"+(p+6));const T=M.formula;let O=LR(T,"30",p+3);O=LR(O,"32",p+5);M.value={formula:O};const E=a.getCell("S"+(p+7));const A=E.formula;let S=LR(A,"30",p+3);S=LR(S,"33",p+6);E.value={formula:S};this.mergeCells(a,p+5,"S",p+5,"W");this.mergeCells(a,p+6,"S",p+6,"Z");this.mergeCells(a,p+7,"S",p+7,"AC");this.mergeCells(a,p+5,"AE",p+7,"AG");this.mergeCells(a,p+5,"AN",p+7,"AO");this.mergeCells(a,p+5,"AP",p+7,"AS");this.mergeCells(a,p+5,"AT",p+7,"AU");this.mergeCells(a,p+5,"AV",p+7,"AV");this.mergeCells(a,p+5,"AW",p+7,"AX");this.mergeCells(a,p+5,"BB",p+7,"BC");this.cloneWorksheet(r,a,"Budget",{properties:{tabColor:{argb:s}}});const k=dt.exports.cloneDeep(n.getWorksheet("Master Codes"));this.cloneWorksheet(r,k,"Master Codes",{properties:{tabColor:{argb:s}}});this.saveWorkbook(r,"budget-"+zR(t.projectLocalId)+".xlsx");HL.dismissLoading()}async exportPO(t,e,i="en"){await HL.presentLoading("please-wait",true);const n=await this.importTemplate();const s="FF6600";const r=new vF.exports.Workbook;const o=n.getWorksheet("po");const a=dt.exports.cloneDeep(o);a.getCell("L7").value=(new Date).toLocaleDateString();a.getCell("F10").value=KN.getCustomersDetails(t.customerId).fullName;a.getCell("F12").value=t.projectLocalId;a.getCell("E29").value=mz.user.displayName;const h=17;let c=17;for(let n=0;n<t.projectAreaQuality.length;n++){const s=t.projectAreaQuality[n];for(let r=0;r<s.shapes.length;r++){if(c>h){a.insertRow(c,[],"i")}this.copyCellsStylesandValues(a,c,3,c,17,false,null,h);const o=a.getRow(c);const u=e[n].shapes[r];const l=u.getWeight(s.density);let f=0;s.courses.forEach((t=>{f+=t.quantityShapes[r]?t.quantityShapes[r].quantity:0}));o.getCell("D").value=s.datasheetId?$F.getDatasheetsById(s.datasheetId).productName:null;o.getCell("E").value=u.shapeName;o.getCell("F").value=s.bricksAllocationAreaId?GF.getBricksAllocationAreas(s.bricksAllocationAreaId)[0].bricksAllocationAreaName[i]:null;o.getCell("G").value=l;o.getCell("H").value=f;o.getCell("I").value=t.setsAmount;const d=a.getCell("J"+h).formula;o.getCell("J").value={formula:LR(d,h,c)};const p=a.getCell("K"+h).formula;o.getCell("K").value={formula:LR(p,h,c)};o.height=21;c++}const r=a.getCell("J"+(c+1)).formula;a.getCell("J"+(c+1)).value={formula:LR(r,18,c)};const o=a.getCell("K"+(c+1)).formula;a.getCell("K"+(c+1)).value={formula:LR(o,18,c)};for(let t=c+4;t<=c+8;t++){this.mergeCells(a,t,"E",t,"H")}this.setBorder(a,"thin",false,false,false,true,c+4,8,c+8,8);this.mergeCells(a,c+18,"D",c+18,"H");for(let t=c+19;t<=c+30;t++){this.mergeCells(a,t,"G",t,"H")}this.setBorder(a,"thin",true,true,true,true,c+18,8,c+30,8)}this.cloneWorksheet(r,a,"PO",{properties:{tabColor:{argb:s}}});this.saveWorkbook(r,"po-"+zR(t.projectLocalId)+".xlsx");HL.dismissLoading()}async selectCurrency(){return new Promise((async t=>{const e=await pt.create({header:aP.getTransl("currency","Currency"),buttons:[{text:"USD",handler:async()=>{t("USD")}},{text:"EUR",handler:async()=>{t("EUR")}}]});e.present()}))}checkSharedFormula(t,e,i){for(let n=1;n<=i;n++){for(let i=1;i<=e;i++){const e=t.getCell(n,i);if(e.value&&e.value["sharedFormula"]){console.log("sharedFormula",e.address)}if(e.value&&e.value["shareType"]){console.log("shareType",e.address)}}}}cloneRows(t,e,i,n,s){for(let r=0;r<e;r++){const e=t.getRow(n+r);const o=t.getRow(s+r);for(let t=1;t<i;t++){o.getCell(t).style=dt.exports.cloneDeep(e.getCell(t).style);o.getCell(t).value=dt.exports.cloneDeep(e.getCell(t).value)}}}columnToNumber(t){if(typeof t==="number"){return t}let e=0,i=t.length;for(let n=0;n<i;n++){e+=(t.charCodeAt(n)-64)*Math.pow(26,i-n-1)}return e}numberToColumn(t){let e="";while(t>0){let i=(t-1)%26;e=String.fromCharCode(65+i)+e;t=Math.floor((t-1)/26)}return e}isRangeMerged(t,e,i,n,s){for(let r=e;r<=n;r++){for(let e=i;e<=s;e++){const i=t.getCell(r,e);if(i.isMerged){return true}}}return false}unmergeCellsInRange(t,e,i,n,s){for(let r=e;r<=n;r++){for(let e=i;e<=s;e++){const i=t.getCell(r,e);t.unMergeCells(i.master.address)}}}copyCellStyles(t,e){e.style={font:t.font,alignment:t.alignment,border:t.border,fill:t.fill,numFmt:t.numFmt}}copyRowWithStyles(t,e,i,n=false){const s=t.getRow(e);const r=t.insertRow(i,[]);s.eachCell({includeEmpty:true},((t,e)=>{const i=r.getCell(e);if(n)i.value=t.value;this.copyCellStyles(t,i)}));r.height=s.height}mergeCells(t,e,i,n,s,r){this.unmergeCellsInRange(t,e,this.columnToNumber(i),n,this.columnToNumber(s));try{t.mergeCells(e,this.columnToNumber(i),n,this.columnToNumber(s));if(r)this.setBorder(t,r,true,true,true,true,e,i,n,s)}catch(o){this.mergedCellsErrors.push({worksheet:t,row1:e,col1:i,row2:n,col2:s,border:r});ht.log("mergeCells error",[t,this.numberToColumn(this.columnToNumber(i))+e+":"+this.numberToColumn(this.columnToNumber(s))+n,this.isRangeMerged(t,e,this.columnToNumber(i),n,this.columnToNumber(s)),o])}}mergeAllErrors(){const t=dt.exports.cloneDeep(this.mergedCellsErrors);this.mergedCellsErrors=[];t.forEach((t=>{this.mergeCells(t.worksheet,t.row1,t.col1,t.row2,t.col2,t.border)}))}copyCellsStylesandValues(t,e,i,n,s,r,o,a){for(let h=e;h<=n;h++){let e=o;for(let n=i;n<=s;n++){if(o){t.getCell(h,n).style=dt.exports.cloneDeep(t.getCell(h,e).style);if(r){t.getCell(h,n).value=dt.exports.cloneDeep(t.getCell(h,e).value)}e++}else if(a){t.getCell(h,n).style=dt.exports.cloneDeep(t.getCell(a,n).style);if(r){t.getCell(h,n).value=dt.exports.cloneDeep(t.getCell(a,n).value)}}}}}setBorder(t,e,i,n,s,r,o,a,h,c,u="000000"){for(let l=o;l<=h;l++){for(let o=a;o<=c;o++){const a={top:i?{style:e,color:{argb:u}}:null,left:n?{style:e,color:{argb:u}}:null,bottom:s?{style:e,color:{argb:u}}:null,right:r?{style:e,color:{argb:u}}:null};t.getCell(l,o).border=a}}}cloneWorksheet(t,e,i,n){const s=t.addWorksheet(i,n);const r=["_columns","_keys","_merges","_rows","autoFilter","conditionalFormattings","dataValidations","headerFooter","pageSetup","rowBreaks","sheetProtection","tables","views"];const o=dt.exports.cloneDeep(e);r.forEach((t=>{s[t]=dt.exports.cloneDeep(o[t])}));return s}async addRefraLogo(t,e,i,n,s,r){return new Promise((async(o,a)=>{try{const a=await uP.getUrl("system/LOGO_Refractory_Solutions.jpg");const h=await OF.storeAndLoadImage(a);const c=t.addImage({base64:h.src,extension:"jpeg"});e.addImage(c,{tl:{col:i+.1,row:n+.1},ext:{width:s,height:r}});o(null)}catch(t){ht.log("addRefraLogo error",t);a(t)}}))}async importTemplate(){const t=new vF.exports.Workbook;const e=await(await fetch("assets/trasteel/template.xlsx")).arrayBuffer();await t.xlsx.load(e);return t}saveWorkbook(t,e){t.xlsx.writeBuffer().then((t=>{let i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});gF.exports.saveAs(i,e)}))}}const qF=new WF;const YF="shapes";class XF{constructor(){this.shapesList=[];this.shapeTypes=[];this.shapesList$=new L([]);this.serviceInit=true}init(){if(this.serviceInit){this.serviceInit=false;this.downloadShapeSettings();nz.mapDataSub$.subscribe((()=>{const t=nz.getCollectionArray(YF);if(t&&t.length>0){this.shapesList=t;this.shapesList$.next(this.shapesList)}else{this.shapesList$.next([])}}))}}getMapData(t){const e={};if(t&&Object.keys(t)){Object.keys(t).forEach((i=>{const n=new rF(t[i]);e[i]=n}))}return e}async presentShapeUpdate(t){return await pP.openModal("modal-shape-update",{shapeId:t})}async duplicateShape(t){const e=await this.getShape(t);return await pP.openModal("modal-shape-update",{duplicateShape:{id:t,shape:e}})}async presentShapeDetails(t){pP.push("/"+YF+"/"+t,"forward")}async getShape(t){const e=new eF(await $L.getDocument(YF,t));if(!e.dwg){this.setDwgForShape(e)}return e}getShapeName(t){return this.shapesList.find((e=>e.id==t))?this.shapesList.find((e=>e.id==t)).shapeName:t+" missing!"}async updateShape(t,e,i){return $L.saveItem(t,e,i,YF)}async deleteShape(t,e=true){return new Promise((async(i,n)=>{const s=await pt.create({header:aP.getTransl("delete-shape-header","Delete Shape?"),message:aP.getTransl("delete-shape-message","This shape will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{n()}},{text:aP.getTransl("ok","OK"),handler:async()=>{try{$L.deleteItem(YF,t);if(e)pP.goBack();i(null)}catch(t){n(t)}}}]});s.present()}))}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(YF,t,e,i)}getShapeById(t){if(this.shapesList.length>0){return this.shapesList.find((e=>e.id==t))}else{return null}}getShapesDetails(t,e){if(this.shapesList.length>0){return this.shapesList.find((i=>i.shapeTypeId==t&&i.shapeName==e))}else{return null}}async checkMapData(){$L.checkMapData(YF,this.shapesList,((t,e)=>this.createMapData(t,e)))}createMapData(t,e){return new rF({id:t,shapeTypeId:e.shapeTypeId,shapeName:e.shapeName})}async openSelectShape(t){return new Promise((async e=>{const i=await pP.openModal("modal-search-list",{list:this.shapesList,item:t,showField:"shapeName",filterBy:["shapeName","shapeTypeId"],orderBy:["shapeName"],searchTitle:{tag:"shapes",text:"Shapes"},placeholder:"Search by shape name or type",filterObject:new tF,filterPopup:this.openShapeFilter,filterFunction:this.filterShapes});i.onDidDismiss().then((async t=>{if(t){e(t.data)}}));i.present()}))}async openShapeFilter(t){return new Promise((async(e,i)=>{const n=await _t.create({component:"popover-shapes-filter",componentProps:{filter:t},cssClass:"popover-shapes-filter",event:null,translucent:true});n.onDidDismiss().then((async t=>{if(t&&t.data){e(t.data)}else{i()}}));n.present()}))}async filterShapes(t){const e=[];Object.keys(t).map((i=>{if(!i.includes("operator")&&t[i]!=null||t[i]>0){e.push(new EF({field:i,operator:t[i+"_operator"],value:t[i]}))}}));const i=await $L.filterDocumentsOnConditions(YF,e,"and");const n=[];i.forEach((t=>{const e=new eF(t);n.push(ZF.createMapData(t.id,e))}));return n}async setDwgForShape(t){const e=await ZF.getShapeTypes(t.shapeTypeId);if(e&&e.length>0){t.dwg=e[0].dwg;t.decimals=t.decimals>=0?t.decimals:e[0].decimals}}async exportShapes(t,e){const i=new oF;i.projectLocalId="export";const n=[];for(let e=0;e<t.length;e++){const s=new aF;const r=t[e];const o=await ZF.getShape(r.shape.id);o["shapeId"]=r.shape.id;const a=await $F.getDatasheet(r.datasheet.id);const h=a.getDensity();const c=new hF;c.position=0;c.shapeId=o["shapeId"];s.shapes.push(c);s.datasheetId=r.datasheet.id;s.density=h;const u=new sF;u.areaIndex=e;u.shapes.push(o);n.push(u);i.projectAreaQuality.push(s)}qF.exportShapes(i,n,e)}getShapeTypes(t){return new Promise((async e=>{if(this.shapeTypes&&this.shapeTypes.length==0){await this.downloadShapeSettings()}if(t){const i=this.shapeTypes.find((e=>e.typeId==t));e(i?[i]:null)}else{e(dt.exports.orderBy(this.shapeTypes,["typeName.en"],"asc"))}}))}getShapeTypeName(t){const e=this.shapeTypes.find((e=>e.typeId==t));return e?e.typeName:{en:t}}async editShapeTypes(){return await pP.openModal("modal-shape-type")}async downloadShapeSettings(){let t=new iF;if(mz.isLoggedin()){try{t=await $L.getDocument(YF,NL)}catch(t){}}const e=[];t.shapeTypes.forEach((t=>{e.push(new nF(t))}));this.shapeTypes=dt.exports.orderBy(e,["typeName.en"]);return t}async uploadShapeSettings(){await $L.updateDocument(YF,NL,{shapeTypes:this.shapeTypes})}async uploadShapeTypes(t){this.shapeTypes=t;await this.uploadShapeSettings()}}const ZF=new XF;class JF{constructor(t){this.firstName=t&&t.firstName?t.firstName:null;this.lastName=t&&t.lastName?t.lastName:null;this.customerId=t&&t.customerId?t.customerId:null;this.photoURL=t&&t.photoURL?t.photoURL:null;this.coverURL=t&&t.coverURL?t.coverURL:null;this.workPosition=t&&t.workPosition?t.workPosition:null;this.customerLocationId=t&&t.customerLocationId?t.customerLocationId:null;this.officePhone=t&&t.officePhone?t.officePhone:null;this.mobilePhone=t&&t.mobilePhone?t.mobilePhone:null;this.email=t&&t.email?t.email:null;this.refractories=t&&t.refractories?true:false;this.electrodes=t&&t.electrodes?true:false;this.rawmaterials=t&&t.rawmaterials?true:false;this.engineering=t&&t.engineering?true:false;this.users={};if(t&&t.users){Object.keys(t.users).forEach((e=>{this.users[e]=t.users[e]}))}}}class KF{constructor(t){if(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))}}}const QF="contacts";class tz{constructor(){this.contactsList=[];this.contactsList$=new L([]);this.serviceInit=true}init(){if(this.serviceInit){this.serviceInit=false;nz.mapDataSub$.subscribe((()=>{const t=nz.getCollectionArray(QF);if(t&&t.length>0){this.contactsList=t;this.contactsList$.next(this.contactsList)}else{this.contactsList$.next([])}}))}}createMapData(t,e){return new KF({id:t,firstName:e.firstName,lastName:e.lastName,customerId:e.customerId,photoURL:e.photoURL,coverURL:e.coverURL})}getMapData(t){const e={};if(t&&Object.keys(t)){Object.keys(t).forEach((i=>{e[i]=new KF(t[i])}))}return e}async presentContactUpdate(t){return await pP.openModal("modal-contact-update",{contactId:t})}async presentContactDetails(t){pP.push("/"+QF+"/"+t,"forward")}async getContact(t){const e=new JF(await $L.getDocument(QF,t));return e}async updateContact(t,e,i){return $L.saveItem(t,e,i,QF)}async deleteContact(t){return new Promise((async(e,i)=>{const n=await pt.create({header:aP.getTransl("delete-contact-header","Delete Contact?"),message:aP.getTransl("delete-contact-message","This contact will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{i()}},{text:aP.getTransl("ok","OK"),handler:async()=>{$L.deleteItem(QF,t);pP.goBack();e(null)}}]});n.present()}))}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(QF,t,e,i)}getContactsDetails(t){if(this.contactsList.length>0){return this.contactsList.find((e=>e.id==t))}else{return null}}}const ez=new tz;class iz{constructor(){this.searchFilters=[]}async init(){await aP.init();this.mapData=this.getMapDocs();this.mapDataSub$=new L(this.mapData);this.downloadMapData()}getMapDocs(t){let e={[ZN]:{name:aP.getTransl("customers","Customers"),icon:{type:"ionicon",name:"business-outline",color:"trasteel"},collection:undefined,collectionSub$:new L([]),createMapData:KN.createMapData,filteredCollection:{},fieldsToQuery:["fullName"],orderBy:["fullName"],query:true},[QF]:{name:aP.getTransl("contacts","Contacts"),icon:{type:"ionicon",name:"person-outline",color:"trasteel"},collection:undefined,collectionSub$:new L([]),createMapData:ez.createMapData,filteredCollection:{},fieldsToQuery:["lastName"],orderBy:["lastName","firstName"],query:true},[YF]:{name:aP.getTransl("shapes","Shapes"),icon:{type:"ionicon",name:"extension-puzzle-outline",color:"trasteel"},collection:undefined,collectionSub$:new L([]),createMapData:ZF.createMapData,filteredCollection:{},fieldsToQuery:["shapeName"],orderBy:["shapeName"],query:true},[zF]:{name:aP.getTransl("datasheets","Datasheets"),icon:{type:"ionicon",name:"library-outline",color:"trasteel"},collection:undefined,collectionSub$:new L([]),createMapData:$F.createMapData,filteredCollection:{},fieldsToQuery:["productName"],orderBy:["productName"],query:true},[UF]:{name:aP.getTransl("projects","Projects"),icon:{type:"ionicon",name:"settings-outline",color:"trasteel"},collection:undefined,collectionSub$:new L([]),createMapData:GF.createMapData,filteredCollection:{},fieldsToQuery:["docsCaption","projectDescription"],orderBy:["projectDescription"],query:true},[rz]:{name:aP.getTransl("userprofiles","User Profiles"),icon:{type:"ionicon",name:"person-outline",color:"trasteel"},collection:undefined,collectionSub$:new L([]),createMapData:mz.createUserPublicMapData,filteredCollection:{},fieldsToQuery:["displayName","email"],orderBy:["displayName"],query:true}};if(t){return e[t]}else{return e}}sendMapData(){this.mapDataSub$?this.mapDataSub$.next(this.mapData):undefined}downloadMapData(t=true){if(this.mapData&&mz.isLoggedin()){Object.keys(this.mapData).map((e=>{$L.getDocument(FL,e,t).then((t=>{switch(e){case ZN:t=KN.getMapData(t);break;case QF:t=ez.getMapData(t);break;case YF:t=ZF.getMapData(t);ZF.downloadShapeSettings();break;case zF:t=$F.getMapData(t);$F.downloadDatasheetSettings();break;case UF:t=GF.getMapData(t);GF.downloadProjectSettings();break}this.refreshFilterDocuments(e,t)}),(()=>{this.refreshFilterDocuments(e,{})}))}))}}filterDocuments(t=[]){this.resetDocumentsQuery(t.find((t=>t.type=="filter"))==undefined);this.searchFilters=[];if(t){t.forEach((t=>{if(t.type=="filter"){this.mapData[t.name].query=true}else{this.searchFilters.push(t.name)}}));Object.keys(this.mapData).map((async t=>{this.refreshFilterDocuments(t)}))}}async refreshFilterDocuments(t,e){const i=this.mapData[t];if(e){i.collection=await $L.checkCollectionWithOfflineData(t,e)}if(i.query){if(this.searchFilters.length>0){i.filteredCollection={};i.fieldsToQuery.forEach((t=>{dt.exports.each(i.collection,((e,n)=>{this.searchFilters.forEach((s=>{if(t=="fullName"){if(e[t]&&e[t].toLowerCase().search(s.toLowerCase())!=-1){i.filteredCollection[n]=e}}}))}))}))}else{i.filteredCollection=i.collection}}else{i.filteredCollection={}}this.sendMapData()}getCollectionArray(t){if(this.mapData&&this.mapData[t]&&this.mapData[t].collection){let e=[];Object.keys(this.mapData[t].collection).forEach((i=>{let n=this.mapData[t].collection[i];n.id=i;e.push(n)}));e=dt.exports.orderBy(e,this.getMapDocs(t).orderBy);return e}else{return[]}}resetDocumentsQuery(t){this.mapData=dt.exports.each(this.mapData,(e=>{e.query=t}))}async filterCollection(){}}const nz=new iz;const sz="userProfiles";const rz="userPublicProfiles";const oz="userRoles";const az="userSettings";const hz="userCards";const cz="userDivePlans";const uz="diveTrips";const lz="divingClasses";const fz="chats";const dz="preferred";class pz{constructor(){this.userProfile$=new L({});this.userSettings$=new L({});this.userRoles$=new L({});this.userDivePlans$=new L({});this.userDiveTrips$=new L({});this.userDivingClasses$=new L({});this.userCards$=new L({});this.userChats$=new L({});this.userPreferred$=new L({});this.newUser=false;this.isAlertOpen=false;this.userServicesStarted=false;this.numberOfTries=0;this.userPublicProfilesList=[];this.userPublicProfilesList$=new L([])}async start(){this.initLocalUser();this.numberOfTries=0;let t=null;if(ht.isUdive()||ht.isDecoplanner()){t=xN}else if(ht.isTrasteel()){t=nz}if(t)t.mapDataSub$.subscribe((()=>{const e=t.getCollectionArray(rz);if(e&&e.length>0){this.userPublicProfilesList=e;this.triggerUsers()}}));this.userServicesStarted=true}triggerUsers(){this.userPublicProfilesList$.next(this.userPublicProfilesList)}getMapData(t){const e={};if(t&&Object.keys(t))Object.keys(t).forEach((i=>{const n=t[i];n.position=null;e[i]=new PN(n)}));return e}createUserPublicMapData(t,e){return new PN({uid:t,email:e.email?e.email:null,displayName:e.displayName?e.displayName:null})}checkUsersMapData(){$L.checkMapData(rz,this.userPublicProfilesList,((t,e)=>this.createUserPublicMapData(t,e)))}async initLocalUser(){const t=await $L.getLocalDocument(sz);const e=await $L.getLocalDocument(oz);const i=await $L.getLocalDocument(fz);const n=await $L.getLocalDocument(az);if(t){this.userProfile=new IN(t);this.userRoles=new DN(e);this.userChats=i;this.userSettings=new CN(n);this.userProfile$.next(this.userProfile);this.userRoles$.next(this.userRoles);this.userChats$.next(this.userChats);this.userSettings$.next(this.userSettings);this.setLanguage(n)}else{this.newUser=true;this.userRoles=new DN({uid:false,email:"",licences:{}});this.userRoles$.next(this.userRoles);this.userProfile$.next(null)}if(ht.isUdive()||ht.isDecoplanner()){const e=await $L.getLocalDocument(cz);const i=await $L.getLocalDocument(uz);const n=await $L.getLocalDocument(lz);const s=await $L.getLocalDocument(hz);if(t){this.userDivePlans=new RN(e);this.userDiveTrips=i;this.userDivingClasses=n;this.userCards=new wt(s);this.userDivePlans$.next(this.userDivePlans);this.userDiveTrips$.next(this.userDiveTrips);this.userDivingClasses$.next(this.userDivingClasses);this.userCards$.next(this.userCards)}else{this.newUser=true}}if(t){this.getUserInfo(t)}}async getUserInfo(t){if(t&&t.uid){UN.presentLoader();try{await $L.getFirebaseDocument(sz,t.uid)}catch(e){this.numberOfTries=this.numberOfTries+1;if(this.numberOfTries<=10){setTimeout((()=>{this.getUserInfo(t)}),500*this.numberOfTries)}else{HL.presentAlertError("Something went worng during registration. Please try again later.");UN.dismissLoading();this.userProfile$.next(null)}return}this.user=$l.currentUser;if(!this.user.emailVerified){UN.sendEmailVerification()}$L.getDocumentObservable(sz,t.uid).then((t=>{this.userProfileSub=t.subscribe((t=>{if(t){this.userProfile=new IN(t);$L.saveLocalDocument(sz,this.userProfile);UN.dismissLoading();this.userProfile$.next(this.userProfile);kN.resetChatUser()}else{UN.dismissLoading();this.userProfile$.next(null)}}))}),(()=>{UN.dismissLoading();this.userProfile$.next(null)}));this.userSettingsSub=U(B(Ul,sz,t.uid,NL,NL),(e=>{this.userSettings=new CN(e.data());this.userSettings.uid=t.uid;this.setLanguage(this.userSettings);if(!this.userSettings.localPlans){this.updateUserSettings(this.userSettings)}$L.saveLocalDocument(az,this.userSettings);this.userSettings$.next(this.userSettings)}));this.userRolesSub=U(B(Ul,oz,t.uid),(t=>{this.userRoles=new DN(t.data());$L.saveLocalDocument(oz,this.userRoles);this.userRoles$.next(this.userRoles)}));this.userRolesSub=U(B(Ul,sz,t.uid,fz,fz),(t=>{this.userChats=t.data();$L.saveLocalDocument(fz,this.userChats);this.userChats$.next(this.userChats)}));this.userPreferredSub=U(B(Ul,sz,t.uid,dz,dz),(t=>{this.userPreferred=t.data();$L.saveLocalDocument(dz,this.userPreferred);this.userPreferred$.next(this.userPreferred)}));if(ht.isUdive()||ht.isDecoplanner()){this.userDivingClassesSub=U(B(Ul,sz,t.uid,NL,lz),(t=>{this.userDivingClasses=t;$L.saveLocalDocument(lz,this.userDivingClasses);this.userDivingClasses$.next(this.userDivingClasses)}));this.userDiveTripsSub=U(B(Ul,sz,t.uid,NL,uz),(t=>{this.userDiveTrips=t.data();$L.saveLocalDocument(uz,this.userDiveTrips);this.userDiveTrips$.next(this.userDiveTrips)}));this.userDivePlansSub=U(B(Ul,cz,t.uid),(async t=>{const e=await $L.checkCollectionWithOfflineData(cz,t.data(),false);this.userDivePlans=new RN(e);$L.saveLocalDocument(cz,this.userDivePlans);this.userDivePlans$.next(this.userDivePlans)}));this.userCardsSub=U(B(Ul,hz,t.uid),(t=>{this.userCards=new wt(t.data());$L.saveLocalDocument(hz,this.userCards);this.userCards$.next(this.userCards)}))}}else{this.logoutUser()}}updateOfflineUserRolesEditorOf(t,e){this.userRoles.editorOf[e]=t;this.userRoles$.next(this.userRoles)}async setLanguage(t){if(t&&t.settings){const e=t.settings.language?t.settings.language:"en";aP.setLanguage(e);await customElements.whenDefined("app-menu");await setTimeout((()=>aP.setLanguage(e)),200)}else{aP.setLanguage("en")}}logoutUser(){this.userProfile=null;this.userSettings=null;this.userRoles=null;this.userDivePlans=null;this.userDiveTrips=null;this.userDivingClasses=null;this.userChats=null;this.userCards=null;this.userPreferred=null;this.userProfile$.next(null);this.userSettings$.next(null);this.userRoles$.next(null);this.userDivePlans$.next(null);this.userDiveTrips$.next(null);this.userDivingClasses$.next(null);this.userChats$.next(null);this.userCards$.next(null);this.userPreferred$.next(null);this.userProfileSub?this.userProfileSub.unsubscribe():undefined;this.userRolesSub?this.userRolesSub():undefined;this.userDivePlansSub?this.userDivePlansSub():undefined;this.userDiveTripsSub?this.userDiveTripsSub():undefined;this.userDivingClassesSub?this.userDivingClassesSub():undefined;this.userChatsSub?this.userChatsSub():undefined;this.userSettingsSub?this.userSettingsSub():undefined;this.userCardsSub?this.userCardsSub():undefined;this.userPreferredSub?this.userPreferredSub():undefined}async notRegisteredUser(){const t=await pt.create({header:aP.getTransl("not-registered-user-header","Registration required"),message:aP.getTransl("not-registered-user-message","This feature requires user registration. Do you want to register?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{pP.push("/login","root")}}]});t.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(sz,t,e,i)}updateUserProfile(t){this.userProfile=new IN(t);$L.saveLocalDocument(sz,this.userProfile);$L.updateDocument(sz,this.userProfile.uid,this.userProfile);this.userProfile$.next(this.userProfile)}updateUserCards(t){this.userCards=t;$L.saveLocalDocument(hz,this.userCards);$L.updateDocument(hz,this.userCards.uid,this.userCards);this.userCards$.next(this.userCards)}updateUserSettings(t){this.userSettings=new CN(t);$L.saveLocalDocument(az,this.userSettings);$L.updateUserSettingsDocument(this.userSettings.uid,NL,this.userSettings);this.userSettings$.next(this.userSettings)}updateUserLocalPlans(t){this.userSettings.localPlans=t;this.updateUserSettings(this.userSettings)}updateUserConfigurations(t){this.userSettings.userConfigurations=t;this.updateUserSettings(this.userSettings)}updateUserTanks(t){this.userSettings.userTanks=t;this.updateUserSettings(this.userSettings)}addPreferredItem(t,e){if(!this.userPreferred||Object.keys(this.userPreferred).length==0){this.userPreferred={uid:this.userPreferred.uid,preferred:{}}}this.userPreferred.preferred[e]={collectionId:t,id:e};this.updateUserPreferred(this.userPreferred)}removePreferredItem(t){delete this.userPreferred.preferred[t];this.updateUserPreferred(this.userPreferred)}updateUserPreferred(t){this.userPreferred=t;$L.saveLocalDocument(dz,this.userPreferred);$L.updateDocumentCollection(sz,this.userProfile.uid,dz,dz,this.userPreferred)}presentUserUpdate(){let t="modal-user-update";pP.openModal(t)}presentUserDetails(t){let e="modal-user-details";pP.openModal(e,{userId:t})}async checkLicence(t,e=false){if(this.userRoles){const i=this.userRoles.check(t);if(!i.hasLicence&&!this.isAlertOpen&&e){this.isAlertOpen=true;let t=await pt.create({header:aP.getTransl("licence-missing-alert","Missing licence!"),message:i.message+"<br>"+aP.getTransl("licence-purchase","Do you want to check purchase options?"),buttons:[{text:aP.getTransl("ok","OK"),handler:()=>{this.isAlertOpen=false}},{text:aP.getTransl("cancel","Cancel"),handler:()=>{this.isAlertOpen=false}}]});t.present()}return i.hasLicence}else if(!this.isAlertOpen&&e){this.isAlertOpen=true;let t=await pt.create({header:aP.getTransl("login","Login"),message:aP.getTransl("login-alert","You must login to access this feature."),buttons:[{text:aP.getTransl("ok","OK"),handler:()=>{this.isAlertOpen=false}}]});t.present()}return false}getMapDataUserDetails(t){return this.getPublicProfileUserDetails(t)}editUserRoles(t){let e="modal-edit-user-roles";pP.openModal(e,{uid:t})}async getPublicProfileUserDetails(t){return new NN(await $L.getDocument(rz,t))}async searchUserByEmail(t){const e=W(Y(Ul,rz),q("email","==",t));const i=await X(e);const n=[];if(!i.empty){i.forEach((t=>{const e=t.data();n.push(e)}));return n[0]}return i.empty}async getOrganiser(t,e){var i=null;if(e){switch(e.collectionId){case sz:i=this.getPublicProfileUserDetails(e.id);break;case iN:i=sN.divingCentersList.find((t=>t.id===e.id));break;case _N:i=bN.diveCommunitiesList.find((t=>t.id===e.id));break;case ON:i=AN.divingSchoolsList.find((t=>t.id===e.id));break;case lN:i=dN.serviceCentersList.find((t=>t.id===e.id));break}if(t==="name"){return i?i.displayName:null}else{return i}}return null}async getUserGeoposition(t=false){return new Promise(((e,i)=>{if(t||!this.userGeoposition){lP.getCurrentPosition().then((t=>{if(t&&t.coords){this.userGeoposition=t;e(t)}else{i()}}))}else{e(this.userGeoposition)}}))}isLoggedin(){if(this.userProfile&&this.userProfile.uid){return true}else{return false}}}const mz=new pz;const _z="divePlans";class vz{constructor(){this.stdConfigurations=[];this.creatingNewDivePlan$=new L(false);this.creatingNewDivePlan=false;this.editingDivePlanId$=new L("")}resetSkeletons(){this.setCreatingNewDivePlan(false)}setCreatingNewDivePlan(t){this.creatingNewDivePlan=t;this.creatingNewDivePlan$.next(this.creatingNewDivePlan)}init(t,e,i){if(t){this.userProfile=t;this.userRoles=e;if(i&&i.userConfigurations)this.stdConfigurations=dt.exports.cloneDeep(i.userConfigurations)}}async createNewDivePlanWithConfiguration(t){if(this.userRoles&&this.userRoles.isRegistered()){this.setCreatingNewDivePlan(true);let e=[];if(mz.userProfile&&mz.userProfile){e.push({type:"radio",label:"New Configuration",value:-1,checked:false})}dt.exports.forEach(this.stdConfigurations,((t,i)=>{e.push({type:"radio",label:t.stdName,value:i,checked:i==0?true:false})}));const i=await pt.create({header:aP.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:aP.getTransl("ok","OK"),handler:async e=>{if(e>-1){this.openNewDiveModal(this.stdConfigurations[e],t)}else{let e=await mz.checkLicence("configs",true);if(e){const e=mz.userSettings.userConfigurations[0];const i=new GP(e);i.stdName="";i.configuration.bottom=[];i.maxDepth=0;i.maxTime=0;const n=new LP;n.setConfiguration(i);const s=await pP.openModal("modal-dive-configuration",{diveDataToShare:{divePlan:n,showConfigurations:true}});s.onDidDismiss().then((e=>{e=e.data;if(e){const i=new GP(e);const n=[i].concat(mz.userSettings.userConfigurations);mz.userSettings.userConfigurations=n;mz.updateUserConfigurations(mz.userSettings.userConfigurations);this.stdConfigurations=dt.exports.cloneDeep(mz.userSettings.userConfigurations);this.openNewDiveModal(i,t)}}))}}}},{text:aP.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});i.present()}else{mz.notRegisteredUser()}}async openNewDiveModal(t,e){const i=await pP.openModal("modal-dive-planner",{selectedConfiguration:t,diveTripData:e?e.dives[0]:null,stdConfigurations:this.stdConfigurations,index:0,user:this.userProfile,showDiveSite:true,showPositionTab:true});i.onDidDismiss().then((t=>{const e=t.data;if(e){this.updateDivePlan(null,e,this.userProfile.uid)}}))}async createNewDivePlan(t){if(this.userRoles&&this.userRoles.isRegistered()){const e=await pP.openModal("modal-dive-planner",{addDive:false,divePlanModel:t,stdConfigurations:this.stdConfigurations,index:0,user:this.userProfile,showDiveSite:true,showPositionTab:true,setDate:true});e.onDidDismiss().then((t=>{const e=t.data;if(e){this.updateDivePlan(null,e,this.userProfile.uid);pP.push("/logbook","root")}}))}else{mz.notRegisteredUser()}}async addDiveToPlan(t,e){const i=await this.getDivePlan(t);if(i){const n=await pP.openModal("modal-dive-planner",{addDive:true,divePlanModel:i,stdConfigurations:this.stdConfigurations,index:e+1,user:this.userProfile,showPositionTab:true});n.onDidDismiss().then((e=>{const i=e.data;if(i){this.updateDivePlan(t,i,this.userProfile.uid)}}))}}async deleteDiveFromPlan(t,e){const i=await this.getDivePlan(t);if(i){const n=await pt.create({header:aP.getTransl("delete-dive-header","Delete dive?"),message:aP.getTransl("delete-dive-message","This dive will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:()=>{i.dives.splice(e,1);this.updateDivePlan(t,i,this.userProfile.uid)}}]});n.present()}}async presentDivePlanUpdate(t,e){const i=await this.getDivePlan(t);if(i){const n=await pP.openModal("modal-dive-planner",{addDive:false,divePlanModel:i,stdConfigurations:this.stdConfigurations,index:e,user:this.userProfile,diveSiteId:i.dives[e].diveSiteId,showPositionTab:true});n.onDidDismiss().then((e=>{const i=e.data;if(i){this.updateDivePlan(t,i,this.userProfile.uid)}else{this.resetSkeletons()}}))}else{pP.goBack()}}async presentDivePlanDetails(t,e){pP.push("/diveplan/"+t+"/dive/"+e,"forward")}async presentDiveTemplateUpdate(t,e=0,i=false){return new Promise((async(n,s)=>{const r=await pP.openModal("modal-dive-template",{addDive:false,divePlanModel:t,stdConfigurations:this.stdConfigurations,dive:e,user:this.userProfile,showDiveSite:i,showPositionTab:i});r.onDidDismiss().then((t=>{const e=t.data;if(e){n(e)}else{s()}}))}))}async getDivePlan(t){const e=await $L.getDocument(_z,t);if(e)return new HP(e);else return false}async updateDivePlan(t,e,i){await HL.presentLoading("updating");let n=null;if(!t){e.users[i]=["owner"];n=$L.addDocument(_z,e)}else{n=$L.updateDocument(_z,t,e)}await HL.dismissLoading();setTimeout((()=>{HL.presentLoading("saved",false)}),100);if(n.id){$L.updateCollectionOffline(_z,mz.userDivePlans,mz.userDivePlans$,n.id,this.createOfflineUserDivePlan(e))}return true}createOfflineUserDivePlan(t){const e={configuration:t.configuration.stdName,dives:[]};t.dives.forEach((t=>{const i={diveSiteId:t.diveSiteId,date:t.date,profilePoints:t.profilePoints};e.dives.push(i)}));return e}async deleteDivePlan(t){const e=await pt.create({header:aP.getTransl("delete-dive-plan-header","Delete Dive Plan?"),message:aP.getTransl("delete-dive-plan-message","This dive plan will be deleted! Are you sure?"),buttons:[{text:aP.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:aP.getTransl("ok","OK"),handler:async()=>{$L.deleteDocument(_z,t);$L.updateCollectionOffline(_z,mz.userDivePlans,mz.userDivePlans$,t)}}]});e.present()}async updatePhotoURL(t,e,i){return uP.updatePhotoURL(_z,t,e,i)}}const gz=new vz;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bz="/firebase-messaging-sw.js";const wz="/firebase-cloud-messaging-push-scope";const yz="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4";const xz="https://fcmregistrations.googleapis.com/v1";const Mz="google.c.a.c_id";const Tz="google.c.a.c_l";const Oz="google.c.a.ts";const Ez="google.c.a.e";var Az;(function(t){t[t["DATA_MESSAGE"]=1]="DATA_MESSAGE";t[t["DISPLAY_NOTIFICATION"]=3]="DISPLAY_NOTIFICATION"})(Az||(Az={}));
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var Sz;(function(t){t["PUSH_RECEIVED"]="push-received";t["NOTIFICATION_CLICKED"]="notification-clicked"})(Sz||(Sz={}));
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kz(t){const e=new Uint8Array(t);const i=btoa(String.fromCharCode(...e));return i.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Iz(t){const e="=".repeat((4-t.length%4)%4);const i=(t+e).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(i);const s=new Uint8Array(n.length);for(let t=0;t<n.length;++t){s[t]=n.charCodeAt(t)}return s}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cz="fcm_token_details_db";const jz=5;const Dz="fcm_token_object_Store";async function Rz(t){if("databases"in indexedDB){const t=await indexedDB.databases();const e=t.map((t=>t.name));if(!e.includes(Cz)){return null}}let e=null;const i=await S(Cz,jz,{upgrade:async(i,n,s,r)=>{var o;if(n<2){return}if(!i.objectStoreNames.contains(Dz)){return}const a=r.objectStore(Dz);const h=await a.index("fcmSenderId").get(t);await a.clear();if(!h){return}if(n===2){const t=h;if(!t.auth||!t.p256dh||!t.endpoint){return}e={token:t.fcmToken,createTime:(o=t.createTime)!==null&&o!==void 0?o:Date.now(),subscriptionOptions:{auth:t.auth,p256dh:t.p256dh,endpoint:t.endpoint,swScope:t.swScope,vapidKey:typeof t.vapidKey==="string"?t.vapidKey:kz(t.vapidKey)}}}else if(n===3){const t=h;e={token:t.fcmToken,createTime:t.createTime,subscriptionOptions:{auth:kz(t.auth),p256dh:kz(t.p256dh),endpoint:t.endpoint,swScope:t.swScope,vapidKey:kz(t.vapidKey)}}}else if(n===4){const t=h;e={token:t.fcmToken,createTime:t.createTime,subscriptionOptions:{auth:kz(t.auth),p256dh:kz(t.p256dh),endpoint:t.endpoint,swScope:t.swScope,vapidKey:kz(t.vapidKey)}}}}});i.close();await Z(Cz);await Z("fcm_vapid_details_db");await Z("undefined");return Pz(e)?e:null}function Pz(t){if(!t||!t.subscriptionOptions){return false}const{subscriptionOptions:e}=t;return typeof t.createTime==="number"&&t.createTime>0&&typeof t.token==="string"&&t.token.length>0&&typeof e.auth==="string"&&e.auth.length>0&&typeof e.p256dh==="string"&&e.p256dh.length>0&&typeof e.endpoint==="string"&&e.endpoint.length>0&&typeof e.swScope==="string"&&e.swScope.length>0&&typeof e.vapidKey==="string"&&e.vapidKey.length>0}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz="firebase-messaging-database";const Fz=1;const zz="firebase-messaging-store";let Lz=null;function $z(){if(!Lz){Lz=S(Nz,Fz,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(zz)}}})}return Lz}async function Uz(t){const e=Gz(t);const i=await $z();const n=await i.transaction(zz).objectStore(zz).get(e);if(n){return n}else{const e=await Rz(t.appConfig.senderId);if(e){await Bz(t,e);return e}}}async function Bz(t,e){const i=Gz(t);const n=await $z();const s=n.transaction(zz,"readwrite");await s.objectStore(zz).put(e,i);await s.done;return e}function Gz({appConfig:t}){return t.appId}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hz={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the "+"user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be "+"called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be "+"called before calling getToken() to ensure your VAPID key is used."};const Vz=new _("messaging","Messaging",Hz);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wz(t,e){const i=await Zz(t);const n=Jz(e);const s={method:"POST",headers:i,body:JSON.stringify(n)};let r;try{const e=await fetch(Xz(t.appConfig),s);r=await e.json()}catch(t){throw Vz.create("token-subscribe-failed",{errorInfo:t===null||t===void 0?void 0:t.toString()})}if(r.error){const t=r.error.message;throw Vz.create("token-subscribe-failed",{errorInfo:t})}if(!r.token){throw Vz.create("token-subscribe-no-token")}return r.token}async function qz(t,e){const i=await Zz(t);const n=Jz(e.subscriptionOptions);const s={method:"PATCH",headers:i,body:JSON.stringify(n)};let r;try{const i=await fetch(`${Xz(t.appConfig)}/${e.token}`,s);r=await i.json()}catch(t){throw Vz.create("token-update-failed",{errorInfo:t===null||t===void 0?void 0:t.toString()})}if(r.error){const t=r.error.message;throw Vz.create("token-update-failed",{errorInfo:t})}if(!r.token){throw Vz.create("token-update-no-token")}return r.token}async function Yz(t,e){const i=await Zz(t);const n={method:"DELETE",headers:i};try{const i=await fetch(`${Xz(t.appConfig)}/${e}`,n);const s=await i.json();if(s.error){const t=s.error.message;throw Vz.create("token-unsubscribe-failed",{errorInfo:t})}}catch(t){throw Vz.create("token-unsubscribe-failed",{errorInfo:t===null||t===void 0?void 0:t.toString()})}}function Xz({projectId:t}){return`${xz}/projects/${t}/registrations`}async function Zz({appConfig:t,installations:e}){const i=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":`FIS ${i}`})}function Jz({p256dh:t,auth:e,endpoint:i,vapidKey:n}){const s={web:{endpoint:i,auth:e,p256dh:t}};if(n!==yz){s.web.applicationPubKey=n}return s}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kz=7*24*60*60*1e3;async function Qz(t){const e=await iL(t.swRegistration,t.vapidKey);const i={vapidKey:t.vapidKey,swScope:t.swRegistration.scope,endpoint:e.endpoint,auth:kz(e.getKey("auth")),p256dh:kz(e.getKey("p256dh"))};const n=await Uz(t.firebaseDependencies);if(!n){return eL(t.firebaseDependencies,i)}else if(!nL(n.subscriptionOptions,i)){try{await Yz(t.firebaseDependencies,n.token)}catch(t){console.warn(t)}return eL(t.firebaseDependencies,i)}else if(Date.now()>=n.createTime+Kz){return tL(t,{token:n.token,createTime:Date.now(),subscriptionOptions:i})}else{return n.token}}async function tL(t,e){try{const i=await qz(t.firebaseDependencies,e);const n=Object.assign(Object.assign({},e),{token:i,createTime:Date.now()});await Bz(t.firebaseDependencies,n);return i}catch(t){throw t}}async function eL(t,e){const i=await Wz(t,e);const n={token:i,createTime:Date.now(),subscriptionOptions:e};await Bz(t,n);return n.token}async function iL(t,e){const i=await t.pushManager.getSubscription();if(i){return i}return t.pushManager.subscribe({userVisibleOnly:true,applicationServerKey:Iz(e)})}function nL(t,e){const i=e.vapidKey===t.vapidKey;const n=e.endpoint===t.endpoint;const s=e.auth===t.auth;const r=e.p256dh===t.p256dh;return i&&n&&s&&r}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sL(t){const e={from:t.from,collapseKey:t.collapse_key,messageId:t.fcmMessageId};rL(e,t);oL(e,t);aL(e,t);return e}function rL(t,e){if(!e.notification){return}t.notification={};const i=e.notification.title;if(!!i){t.notification.title=i}const n=e.notification.body;if(!!n){t.notification.body=n}const s=e.notification.image;if(!!s){t.notification.image=s}const r=e.notification.icon;if(!!r){t.notification.icon=r}}function oL(t,e){if(!e.data){return}t.data=e.data}function aL(t,e){var i,n,s,r,o;if(!e.fcmOptions&&!((i=e.notification)===null||i===void 0?void 0:i.click_action)){return}t.fcmOptions={};const a=(s=(n=e.fcmOptions)===null||n===void 0?void 0:n.link)!==null&&s!==void 0?s:(r=e.notification)===null||r===void 0?void 0:r.click_action;if(!!a){t.fcmOptions.link=a}const h=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;if(!!h){t.fcmOptions.analyticsLabel=h}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hL(t){return typeof t==="object"&&!!t&&Mz in t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */cL("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");cL("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function cL(t,e){const i=[];for(let n=0;n<t.length;n++){i.push(t.charAt(n));if(n<e.length){i.push(e.charAt(n))}}return i.join("")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uL(t){if(!t||!t.options){throw lL("App Configuration Object")}if(!t.name){throw lL("App Name")}const e=["projectId","apiKey","appId","messagingSenderId"];const{options:i}=t;for(const t of e){if(!i[t]){throw lL(t)}}return{appName:t.name,projectId:i.projectId,apiKey:i.apiKey,appId:i.appId,senderId:i.messagingSenderId}}function lL(t){return Vz.create("missing-app-config-values",{valueName:t})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fL{constructor(t,e,i){this.deliveryMetricsExportedToBigQueryEnabled=false;this.onBackgroundMessageHandler=null;this.onMessageHandler=null;this.logEvents=[];this.isLogServiceStarted=false;const n=uL(t);this.firebaseDependencies={app:t,appConfig:n,installations:e,analyticsProvider:i}}_delete(){return Promise.resolve()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dL(t){try{t.swRegistration=await navigator.serviceWorker.register(bz,{scope:wz});t.swRegistration.update().catch((()=>{}))}catch(t){throw Vz.create("failed-service-worker-registration",{browserErrorMessage:t===null||t===void 0?void 0:t.message})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pL(t,e){if(!e&&!t.swRegistration){await dL(t)}if(!e&&!!t.swRegistration){return}if(!(e instanceof ServiceWorkerRegistration)){throw Vz.create("invalid-sw-registration")}t.swRegistration=e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mL(t,e){if(!!e){t.vapidKey=e}else if(!t.vapidKey){t.vapidKey=yz}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _L(t,e){if(!navigator){throw Vz.create("only-available-in-window")}if(Notification.permission==="default"){await Notification.requestPermission()}if(Notification.permission!=="granted"){throw Vz.create("permission-blocked")}await mL(t,e===null||e===void 0?void 0:e.vapidKey);await pL(t,e===null||e===void 0?void 0:e.serviceWorkerRegistration);return Qz(t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vL(t,e,i){const n=gL(e);const s=await t.firebaseDependencies.analyticsProvider.get();s.logEvent(n,{message_id:i[Mz],message_name:i[Tz],message_time:i[Oz],message_device_time:Math.floor(Date.now()/1e3)})}function gL(t){switch(t){case Sz.NOTIFICATION_CLICKED:return"notification_open";case Sz.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bL(t,e){const i=e.data;if(!i.isFirebaseMessaging){return}if(t.onMessageHandler&&i.messageType===Sz.PUSH_RECEIVED){if(typeof t.onMessageHandler==="function"){t.onMessageHandler(sL(i))}else{t.onMessageHandler.next(sL(i))}}const n=i.data;if(hL(n)&&n[Ez]==="1"){await vL(t,i.messageType,n)}}const wL="@firebase/messaging";const yL="0.12.10";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xL=t=>{const e=new fL(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),t.getProvider("analytics-internal"));navigator.serviceWorker.addEventListener("message",(t=>bL(e,t)));return e};const ML=t=>{const e=t.getProvider("messaging").getImmediate();const i={getToken:t=>_L(e,t)};return i};function TL(){r(new o("messaging",xL,"PUBLIC"));r(new o("messaging-internal",ML,"PRIVATE"));t(wL,yL);t(wL,yL,"esm2017")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OL(){try{await I()}catch(t){return false}return typeof window!=="undefined"&&k()&&C()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EL(t,e){if(!navigator){throw Vz.create("only-available-in-window")}t.onMessageHandler=e;return()=>{t.onMessageHandler=null}}async function AL(t,e){t=i(t);return _L(t,e)}function SL(t,e){t=i(t);return EL(t,e)}TL();const kL=ft("Device",{web:()=>import("./p-fc0d71f9.js").then((t=>new t.DeviceWeb))});const IL="notifications";const CL="tokens";class jL{constructor(){this.initStarted=false}async init(){if(!this.initStarted&&(Tt("pwa")||Tt("desktop")||Tt("mobileweb"))){this.initStarted=true;this.initServiceWorker()}}initServiceWorker(){if("serviceWorker"in navigator){navigator.serviceWorker.getRegistration().then((t=>{if(t===null||t===void 0?void 0:t.active){navigator.serviceWorker.addEventListener("controllerchange",(()=>window.location.reload()))}}))}}async onServiceWorkerUpdate(){const t=await navigator.serviceWorker.getRegistration();if(!(t===null||t===void 0?void 0:t.waiting)){return}const e=await bt.create({message:"New version available!",buttons:[{text:"Reload",role:"reload"}],duration:0});await e.present();const{role:i}=await e.onWillDismiss();if(i==="reload"){t.waiting.postMessage("skipWaiting");window.location.reload()}}initPWA(){return new Promise(((t,e)=>{navigator.serviceWorker.ready.then((()=>{if(!OL()){e("not supported");return}SL(Hl,(t=>{console.log("messaging.onMessage",t);this.showToast(t)}));t()}),(t=>{e(t)}))}))}requestPermission(){return new Promise((async t=>{try{const t=await AL(Hl);this.saveNotificationToken(t)}catch(t){}t()}))}async getLocalNotificationToken(){return await $L.getLocalDocument("localNotificationToken")}async saveNotificationToken(t){const e=await this.getLocalNotificationToken();if(!e||e!==t){let i=await this.getUserTokensDoc();if(!i)i={};let n={info:null,topics:{}};if(e){n=i[e];delete i[e]}else{if(Object.keys(i).length>0){n=i[Object.keys(i)[0]]}}for(let e in n.topics){if(n.topics[e]){await this.subscribeToTopic(e,[t])}}const s=await kL.getInfo();n.info=s;i[t]=n;const r=await this.saveUserTokensDoc(i);if(r.id){await $L.saveLocalDocument("localNotificationToken",t)}}}async subscribeUserToTopic(t){return new Promise((async(e,i)=>{const n=await this.getUserTokensDoc();const s=[];for(let e of Object.keys(n)){const i=n[e];const r=await this.subscribeToTopic(t,[e]);if(r&&r.data&&r.data.errors.length==0){i.topics[t]=true}else{s.concat(r.data.errors)}}await this.saveUserTokensDoc(n);if(s.length==0){e(n)}else{i(s)}}))}async subscribeUserDeviceToTopic(t,e){return new Promise((async(i,n)=>{const s=await this.subscribeToTopic(t,[e]);if(s&&s.data&&s.data.errors.length==0){let n=await this.getUserTokensDoc();n[e].topics[t]=true;await this.saveUserTokensDoc(n);i(n)}else{n(s.data.errors)}}))}async subscribeToTopic(t,e){t=t;const i=await Mc(Gl,"subscribeToTopic")({tokens:e,topic:t});return i}async unsubscribeUserFromTopic(t){return new Promise((async(e,i)=>{const n=await this.getUserTokensDoc();const s=[];for(let e of Object.keys(n)){const i=n[e];const r=await this.unsubscribeFromTopic(t,[e]);if(r&&r.data&&r.data.errors.length==0){i.topics[t]=false}else{s.concat(r.data.errors)}}await this.saveUserTokensDoc(n);if(s.length==0){e(n)}else{i(s)}}))}async deleteUserFromTopic(t){return new Promise((async(e,i)=>{const n=await pt.create({header:aP.getTransl("delete-topic","Delete this Notification Topic"),message:aP.getTransl("delete-topic-message","You will not receive notifications from this topic and you cannot subscribe again. Are you sure?"),buttons:[{text:aP.getTransl("ok","OK"),handler:async()=>{HL.presentLoading("updating");const n=await this.getUserTokensDoc();const s=[];for(let e of Object.keys(n)){const i=n[e];const r=await this.unsubscribeFromTopic(t,[e]);if(r&&r.data&&r.data.errors.length==0){delete i.topics[t]}else{s.concat(r.data.errors)}}await this.saveUserTokensDoc(n);HL.dismissLoading();if(s.length==0){e(n)}else{i(s)}}},{text:aP.getTransl("cancel","Cancel"),handler:async()=>{i()}}]});n.present()}))}async unsubscribeUserDeviceFromTopic(t,e){return new Promise((async(i,n)=>{const s=await this.unsubscribeFromTopic(t,[e]);if(s&&s.data&&s.data.errors.length==0){let n=await this.getUserTokensDoc();n[e].topics[t]=false;await this.saveUserTokensDoc(n);i(n)}else{n(s.data.errors)}}))}unsubscribeFromTopic(t,e){t=t;return Mc(Gl,"unsubscribeFromTopic")({tokens:e,topic:t})}async saveUserTokensDoc(t){return $L.updateDocumentCollection(sz,mz.userProfile.uid,IL,CL,t)}async getUserTokensDoc(){const t=await $L.getDocumentCollection(sz,mz.userProfile.uid,IL,CL);return t}async getUserTokensList(){const t=await this.getUserTokensDoc();return Object.keys(t)}async getTopicsForActualDevice(){const t=await this.getUserTokensDoc();const e=await this.getLocalNotificationToken();if(t&&t[e]){return t[e].topics}else{return null}}sendNotificationToTopic(t,e,i,n){return Mc(Gl,"sendNotificationToTopic")({topic:t,title:e,body:i,data:n})}sendNotificationToTokens(t,e,i,n){return Mc(Gl,"sendNotificationToTokens")({tokens:t,title:e,body:i,data:n})}async onSWUpdate(){const t=await navigator.serviceWorker.getRegistration();if(!t||!t.waiting){return}const e=await bt.create({message:"New version available",buttons:[{side:"end",icon:"star",text:"Reload",handler:()=>{console.log("Reload clicked")}}]});await e.present();await e.onWillDismiss();t.waiting.postMessage("skipWaiting");window.location.reload()}async showToast(t){if(pP.pageTo.join("/")!=t.data.link){const e=await bt.create({header:t.data.title,message:t.data.body,position:"top",duration:5e3,color:ht.appName,buttons:[{side:"end",icon:"arrow-redo",text:aP.getTransl("show","Show"),handler:()=>{pP.push(t.data.link,"forward")}},{icon:"close",role:"cancel"}]});e.present()}}}const DL=new jL;class RL{async updateTranslations(){await HL.presentLoading("updating");let t=null;try{const e=Mc(Gl,"updateTranslationsDoc");t=await e()}catch(e){t={error:e}}HL.dismissLoading();if(t&&t.error){HL.presentAlertError(t.error);return false}else{return true}}async splitAndStoreDoc(t,e,i,n,s,r){await HL.presentLoading("updating");let o=null;try{const a=Mc(Gl,"splitAndStoreDocument");const h={collection:t,documentId:e,subcollection:i,subdocumentId:n,document:s,returnPromises:r};console.log("data",h);o=await a(h);ht.log("splitAndStoreDoc",[t,e,i,n,s,o])}catch(t){console.log("error1",t);o={error:t}}HL.dismissLoading();if(o&&o.error){HL.presentAlertError(o.error);return false}else{return o}}async retrieveAndMergeDoc(t,e,i,n){if(t!==FL)await HL.presentLoading("loading");let s=null;try{const r=Mc(Gl,"retrieveAndMergeDocument");s=await r({collection:t,documentId:e,subcollection:i,subdocumentId:n});ht.log("retrieveAndMergeDocument",[t,e,i,n,s])}catch(t){ht.log("res error",[t]);s={error:t}}if(t!==FL)HL.dismissLoading();if(s&&s.error){HL.presentAlertError(s.error);return false}else{return s.data}}async updateSystemsDoc(t){let e;try{const i=Mc(Gl,"updateSystemsDoc");e=await i({collectionId:t});ht.log("updateSystemsDoc",[t,e])}catch(t){ht.log("res error",[t]);e={error:t}}}}const PL=new RL;const NL="settings";const FL="mapData";const zL=ht.isDev();class LL{constructor(){this.servicesStarted=false;this.mapDataOfflineDocName="mapDataOffline";this.collectionOfflineDocName="collectionOffline"}initServices(){if(!this.userRoles||!dt.exports.isEqual(this.userRoles,mz.userRoles)){if(mz.userProfile&&mz.userProfile.uid){this.userProfile=new IN(mz.userProfile)}else{this.userProfile=null}if(mz.userRoles&&mz.userRoles.uid){this.userRoles=new DN(mz.userRoles)}else{this.userRoles=null}if(mz.userSettings&&mz.userSettings.uid){this.userSettings=new CN(mz.userSettings)}else{this.userSettings=null}if(this.userProfile&&this.userRoles&&this.userSettings&&this.servicesStarted){DL.init();if(ht.isUdive()||ht.isDecoplanner()){gz.init(this.userProfile,this.userRoles,this.userSettings);if(ht.isDecoplanner()&&this.userRoles.isUserAdmin()){xN.initUser(this.userProfile)}else{xN.initUser(this.userProfile)}}else if(ht.isTrasteel());if(ht.isUdive()){sN.init();bN.init();XP.init();AN.init();dN.init();hN.init()}else if(ht.isDecoplanner());else if(ht.isTrasteel()){KN.init();ez.init();ZF.init();$F.init();GF.init()}}}}async forceRefreshMapData(){this.refreshMapData()}refreshMapData(t=true){if(ht.isUdive()){xN.downloadMapData(t)}else if(ht.isTrasteel()){nz.downloadMapData(t)}else;}async checkMapData(t,e,i){HL.presentLoading("please-wait");const n=await $L.getCollectionDocuments(t);let s={};n.forEach((t=>{if(t.id!="settings"){const e=t.data();s[t.id]=i(t.id,e);delete s[t.id].id}}));const r={};e.map((t=>{const e=t.id;delete t.id;t.productName=t.productName?t.productName.replace(/\s?\(rev[^)]*\)/g,"").trim():null;r[e]=t}));const o=await PL.retrieveAndMergeDoc(FL,t);const a=eP(s,r);const h=eP(r,o);console.log("checkMapData differences real vs local",Object.keys(s).length-e.length,Object.keys(a).length,a);console.log("checkMapData differences local vs server",Object.keys(e).length-Object.keys(o).length,Object.keys(h).length,h);const c=await pt.create({header:"MapData "+t,message:Object.keys(s).length!==e.length?"List: "+e.length+" -> new MapData: "+Object.keys(s).length+" - Update?":"Same Length! Force Update?",buttons:[{text:"yes",handler:async()=>{this.updateMapData(t,s)}},{text:"no"}]});HL.dismissLoading();c.present()}async updateMapData(t,e){let i=null;try{i=PL.splitAndStoreDoc(FL,t,null,null,e,false)}catch(t){HL.presentAlertError(t)}try{PL.updateSystemsDoc(t)}catch(t){HL.presentAlertError(t)}if(i){HL.presentLoading("saved",false)}else{HL.presentLoading("error",false)}}async updateMapDataOffline(t,e,i){if(this.getMapData()[t]){const n=this.getMapData()[t].collection;if(i){const s=this.getMapDocs(t).createMapData(e,i);n[e]=s}else{delete n[e]}let s=await this.getLocalDocument(this.mapDataOfflineDocName);s=s?s:{};s[this.getItemLocalName(t,e)]={collectionId:t,docId:e,status:i?"updated":"deleted",item:i?n[e]:null};this.saveLocalDocument(this.mapDataOfflineDocName,s);this.saveLocalDocument(this.getItemLocalName(FL,t),n);this.refreshFilterDocuments(t,n)}}getMapDocs(t){if(ht.isTrasteel()){return nz.getMapDocs(t)}else{return xN.getMapDocs(t)}}getMapData(){if(ht.isTrasteel()){return nz.mapData}else{return xN.mapData}}updateCollectionOffline(t,e,i,n,s){console.log("updateCollectionOffline",n,s);if(s){e[n]=s}else{delete e[n]}$L.saveLocalDocument(t,e);i.next(e)}async checkCollectionWithOfflineData(t,e,i=true){return new Promise((async n=>{let s=await this.getLocalDocument(i?this.mapDataOfflineDocName:this.collectionOfflineDocName);s=s?s:{};if(s["recentUpdate"]&&s["recentUpdate"][t]){for(const i of Object.keys(s)){const n=s[i];if(n.collectionId&&t==n.collectionId){const t=n.docId;const r=n.status;const o=n.item;if(e[t]&&r=="updated"){e[t].id=t;const n=Object.assign({},e[t]);if(n&&dt.exports.isEqual(o,n)){ht.log("updated equal");delete s[i]}else{ht.log("updated replace");e[t]=o}}else{if(e[t]){ht.log("deleted replace");delete e[t]}else{ht.log("deleted equal");delete s[i]}}}s["recentUpdate"][t]=false}await this.saveLocalDocument(i?this.mapDataOfflineDocName:this.collectionOfflineDocName,s)}n(e)}))}refreshFilterDocuments(t,e){if(ht.isTrasteel()){return nz.refreshFilterDocuments(t,e)}else{return xN.refreshFilterDocuments(t,e)}}async getCollectionDocuments(t,e,i,n){let s=Y(Ul,t);let r=W(s,i?K(i,n):null,J?J(e):null);try{return await X(r)}catch(e){if(zL)console.log("reading collection error",t,e)}}async getDocumentObservable(t,e){return new Promise((async(i,n)=>{const s=B(Ul,t,e);try{const r=await Q(s);if(r.exists()){let n=new L(r.data());U(s,(t=>{if(t.data()&&Object.keys(t.data()).length>0){n.next(t.data())}}));if(zL)console.log("reading observable from firebase",t,e,r.data());i(n)}else{if(zL)console.log("document does not exist",t,e);n("document does not exist :"+t+"-"+e)}}catch(i){if(zL)console.log("reading observable from firebase error",t,e,i);n(i)}}))}async getDocument(t,e,i=false){try{if(HL.systemPreferences){if(HL.systemPreferences&&HL.systemPreferences.collectionsUpdate&&HL.systemPreferences.collectionsUpdate[e]){const n=this.getItemLocalName(t,e);const s=n+"_updated";let r=await this.getLocalDocument(s);let o=await this.getLocalDocument(n);if(r&&RR(r,HL.systemPreferences.collectionsUpdate[e])<0||i){let i;if(t==FL){i=await PL.retrieveAndMergeDoc(FL,e);let t=await this.getLocalDocument(this.mapDataOfflineDocName);t=t?t:{};t["recentUpdate"]=t["recentUpdate"]?t["recentUpdate"]:{};t["recentUpdate"][e]=true;await this.saveLocalDocument(this.mapDataOfflineDocName,t)}else{i=await this.getFirebaseDocument(t,e)}ht.log("check last update date",[t,e,i]);if(i){this.saveLocalDocument(n,i);this.saveLocalDocument(s,new Date)}return i}else{ht.log("no change - return local doc",[t,e,B]);if(!o){const i=await this.getFirebaseDocument(t,e);if(i){this.saveLocalDocument(n,i);this.saveLocalDocument(s,new Date)}return i}else{return o}}}else{if(zL)console.log("no collection update date",t,e);return await this.getFirebaseDocument(t,e)}}else{return false}}catch(t){HL.dismissLoading();HL.presentAlertError(t);return false}}getItemLocalName(t,e){return t+"_"+e}async getFirebaseDocument(t,e){function i(t,e){const i=new Promise(((t,i)=>setTimeout((()=>i(new Error("Request timed out"))),e)));return Promise.race([t,i])}function n(t){return new Promise((async(e,n)=>{const s=await HL.getNetwork();let r=5e3;if(!s)r=0;try{const s=await i(Q(t),r);if(s.exists()){e(s.data())}else{n({message:"No such document exists online.",error:null})}}catch(i){if(i.message==="Request timed out"){ht.log("Fetching document timed out. Attempting to fetch from cache...");try{const i=await tt(t);if(i.exists()){e(i.data())}else{n({message:"No such document in cache.",error:null})}}catch(t){n({message:"Error fetching document from cache:",error:t})}}}}))}return new Promise((async(i,s)=>{if(zL)console.log("reading document from firebase",t,e);try{n(B(Ul,t,e)).then((t=>{i(t)}),(i=>{if(zL)console.log("document reading error1",t,e,i);if(i.error.name==="FirebaseError"&&i.error.code==="unavailable"){s("You are offline and the document isn't cached locally.")}else{s(i)}}))}catch(i){if(zL)console.log("reading document error2",t,e,i);s(i)}}))}async getDocumentsInArea(t,e,i,n){const s=[e,i];const r=n*1e3;const o=et.exports.geohashQueryBounds(s,r);const a=[];for(const e of o){const i=W(Y(Ul,t),K("position.geohash"),nt(e[0]),it(e[1]));a.push(X(i))}const h=await Promise.all(a);const c=[];for(const t of h){for(const e of t.docs){const t=e.get("lat");const i=e.get("lng");const n=et.exports.distanceBetween([t,i],s);const o=n*1e3;if(o<=r){c.push(e)}}}return c}addDocument(t,e){try{const i=B(Y(Ul,t));st(i,this.convertPayload(e));return i}catch(t){HL.presentAlertError(t)}}convertPayload(t){let e=null;if(t.position&&t.position.geopoint){e=t.position}t=JSON.parse(JSON.stringify(t));if(e){t.position=e}return t}updateDocument(t,e,i){const n=B(Y(Ul,t),e);i=this.convertPayload(i);try{st(n,this.convertPayload(i));return n}catch(t){console.log("error",t);HL.presentAlertError(t)}}async updateUserSettingsDocument(t,e,i){const n=await B(Ul,sz,t,NL,e);i=JSON.parse(JSON.stringify(i));try{await rt(n,i)}catch(t){try{await st(n,i)}catch(t){ht.log("updateUserSettingsDocument error",t);HL.presentAlertError(t)}}return n}async mergeWithDocument(t,e,i){const n=await B(Ul,t,e);const s=this.convertPayload(i);try{await rt(n,s)}catch(r){try{await st(n,s)}catch(n){if(zL)console.log("mergeWithDocument error",t,e,i,r,n)}}return n}async getDocumentCollection(t,e,i,n){if(zL)console.log("reading document subcollection from firebase",t,e,i,n);try{const s=await Q(B(Ul,t,e,i,n));return s.data()}catch(i){if(zL)console.log("reading document error",t,e,i);return false}}async getDocumentCollectionObservable(t,e,i,n){return new Promise((async(s,r)=>{const o=B(Ul,t,e,i,n);try{const i=await Q(o);if(i.exists()){let n=new L(i.data());U(o,(t=>{if(t.data()&&Object.keys(t.data()).length>0){n.next(t.data())}}));if(zL)console.log("reading collection observable from firebase",t,e,i.data());s(n)}else{if(zL)console.log("document does not exist",t,e);r("document does not exist :"+t+"-"+e)}}catch(i){if(zL)console.log("reading observable from firebase error",t,e,i);r(i)}}))}async updateDocumentCollection(t,e,i,n,s){let r=null;s=this.convertPayload(s);if(zL)console.log("updateDocumentCollection",t,e,i,n,s);if(n){r=await B(Ul,t,e,i,n);try{await rt(r,s)}catch(i){console.log("updateDocumentCollection error",t,e)}}else{r=await ot(r,s)}return r}async deleteDocumentCollection(t,e,i,n){const s=await B(Ul,t,e,i,n);try{await at(s);this.deleteLocalDocument(e)}catch(i){console.log("deleteDocumentCollection error",t,e)}return s}async deleteDocument(t,e,i=true){return new Promise((async(n,s)=>{if(i)await HL.presentLoading("deleting",true);const r=B(Ul,t,e);ht.log("deleteDocument",[t,e]);try{at(r);this.deleteLocalDocument(e);uP.deletePhotoURLs(t,e);await HL.dismissLoading();n()}catch(i){ht.log("deleteDocument error",[t,e]);s(i);await HL.dismissLoading()}}))}async saveItem(t,e,i,n){await HL.presentLoading("updating");let s=null;if(!t){e.users[i]=["owner"];s=this.addDocument(n,e)}else{s=this.updateDocument(n,t,e)}if(s.id){this.updateMapDataOffline(n,s.id,e)}await HL.dismissLoading();setTimeout((()=>{HL.presentLoading("saved",false)}),100);return s}async deleteItem(t,e){await $L.deleteDocument(t,e);this.updateMapDataOffline(t,e)}async saveLocalDocument(t,e){return localStorage.setItem(t,JSON.stringify(e))}async getLocalDocument(t){const e=await localStorage.getItem(t);try{const t=JSON.parse(e);return t}catch(t){return undefined}}async deleteLocalDocument(t){await localStorage.removeItem(t)}async clearLocalDocuments(){await localStorage.clear()}async queryCollection(t,e,i,n,s="or"){const r=i.map((t=>{switch(t){case"=":return"==";case">":return">";case">=":return">=";case"<=":return"<=";case"<":return"<";case"!=":return"!=";default:throw new Error(`Unsupported operator: ${t}`)}}));const o=Y(Ul,t);if(s==="and"){let t=o;for(let i=0;i<e.length;i++){t=W(t,q(e[i],r[i],n[i]))}const i=await X(t);const s=i.docs.map((t=>Object.assign({id:t.id},t.data())));return s}else if(s==="or"){const t=e.map(((t,e)=>{const i=W(o,q(t,r[e],n[e]));return X(i)}));const i=await Promise.all(t);const s=new Map;i.forEach((t=>{t.forEach((t=>{s.set(t.id,Object.assign({id:t.id},t.data()))}))}));return Array.from(s.values())}else{throw new Error(`Unsupported logic operator: ${s}`)}}async filterDocumentsOnConditions(t,e,i="and"){try{const n=Y(Ul,t);const s=W(n);const r=await X(s);let o=[];r.forEach((t=>{const n=t.data();const s=e.map((t=>{if(!t.fieldName&&!t.valueName){const e=n[t.field];return this.compare(e,t.operator,t.value)}else{const e=n[t.field];if(Array.isArray(e)){const i=e.find((e=>e[t.fieldName]===t.valueName));if(i){const e=i[t.comparisonField];return this.compare(e,t.operator,t.value)}}return false}}));const r=i==="and"?s.every(Boolean):s.some(Boolean);if(r){n.id=t.id;o.push(n)}}));return o}catch(t){console.error("Error filtering documents:",t)}}compare(t,e,i){if(dt.exports.isNumber(i)){t=dt.exports.toNumber(t)}switch(e){case"<":return t<i;case"<=":return t<=i;case">":return t>i;case">=":return t>=i;case"=":return t===i;default:return false}}}const $L=new LL;const UL=ft("Network",{web:()=>import("./p-aa4ba506.js").then((t=>new t.NetworkWeb))});const BL="system";class GL{constructor(){this.systemPreferences$=new L({})}async init(){return new Promise((async(t,e)=>{const i=await $L.getDocumentObservable(BL,"preferences");i.subscribe((i=>{if(i&&Object.keys(i).length>0){this.systemPreferences=i;$L.saveLocalDocument("systemPreferences",this.systemPreferences);ht.log("system updated",[this.systemPreferences]);this.systemPreferences$.next(this.systemPreferences);t(i)}else{e(null)}}));const n=await $L.getLocalDocument("systemPreferences");if(n){this.systemPreferences=n;this.systemPreferences$.next(this.systemPreferences)}this.getDeviceInfo()}))}async getSubscriptions(){return $L.getDocument("system","subscriptions")}async updateSubscription(t,e){let i=await this.getSubscriptions();if(!i){i={}}i[t]=new Date(e);return $L.updateDocument("system","subscriptions",i)}async getSystemPreferences(){const t=await $L.getLocalDocument("systemPreferences");if(t){return t}else{return await this.init()}}async getDivingAgencies(){const t=await this.getSystemPreferences();return t.divingAgencies}async getDivingCoursesForSchool(t){let e=[];const i=await this.getDivingAgencies();const n=dt.exports.orderBy(Object.keys(i));n.forEach((n=>{const s=[];if(t){t.divingCourses.forEach((t=>{if(t.agencyId==n){const e=i[t.agencyId].certifications[t.certificationId];e.agencyId=n;s.push(e)}}))}else{Object.keys(i[n].certifications).forEach((t=>{const e=i[n].certifications[t];e.agencyId=n;s.push(e)}))}e=e.concat(dt.exports.orderBy(s,"order"));e=e.map((t=>{if(t.activities)t.activities=t.activities.map((t=>{if(t.divePlan)t.divePlan=new HP(t.divePlan);return t}));return t}))}));return e}async presentAlertError(t){return new Promise((async(e,i)=>{let n=aP.getTransl("general-error-header","Error");let s=aP.getTransl("general-error-message","There was an error. Please try again later.");const r=await pt.create({header:n,message:s+"->"+t,buttons:[{text:aP.getTransl("ok","OK"),handler:async()=>{e(true)}},{text:aP.getTransl("cancel","Cancel"),handler:async()=>{i()}}]});r.present()}))}async presentAlert(t,e){const i=await pt.create({header:t,message:e,buttons:[{text:aP.getTransl("ok","OK"),handler:async()=>{}}]});i.present()}async presentLoading(t,e=true){let i="";switch(t){case"loading":i=aP.getTransl("loading","Loading")+"...";break;case"updating":i=aP.getTransl("updating","Updating")+"...";break;case"calculating":i=aP.getTransl("calculating","Calculating")+"...";break;case"please-wait":i=aP.getTransl("please-wait","Please Wait")+"...";break;case"searching":i=aP.getTransl("searching","Searching")+"...";break;case"deleting":i=aP.getTransl("deleting","Deleting")+"...";break;case"deleted":i=aP.getTransl("deleted","Deleted");break;case"saved":i=aP.getTransl("saved","Saved");break;case"error":i=aP.getTransl("error","Error");break}this.loading=await vt.create({mode:"ios",message:i,showBackdrop:e,translucent:true,duration:t=="saved"||t=="error"?1500:null,spinner:t=="saved"||t=="error"?null:"crescent"});await this.loading.present()}async dismissLoading(){let t=await vt.getTop();if(t){await vt.dismiss();setTimeout((()=>this.dismissLoading()),100)}}async checkSubscription(t){const e=await this.getSubscriptions();const i=e[t];const n=new Date(i).getTime()-(new Date).getTime()>0;if(n){return true}else{const t=await pt.create({header:aP.getTransl("subscription","Subscription"),message:aP.getTransl("subscription-expired","Your subscription has expired on xxx. Please contact the administrators to re-activate it.",{xxx:new Date(i).toLocaleDateString(undefined,{weekday:undefined,year:"numeric",month:"numeric",day:"numeric"})}),buttons:[{text:aP.getTransl("ok","OK"),handler:async()=>{pP.goBack()}}]});t.present();return false}}getLanguages(){if(ht.isUdive()||ht.isDecoplanner()){return[{label:"English",value:"en",countryCode:"gb"},{label:"Italiano",value:"it",countryCode:"it"},{label:"Franais",value:"fr",countryCode:"fr"},{label:"Espaol",value:"es",countryCode:"es"},{label:"Deutsch",value:"de",countryCode:"de"},{label:"Portugus",value:"pt",countryCode:"pt"},{label:"Svenska",value:"sv",countryCode:"se"},{label:"",value:"ru",countryCode:"ru"},{label:"",value:"ko",countryCode:"kr"},{label:"",value:"zh",countryCode:"cn"}]}else{return[{label:"English",value:"en",countryCode:"en"},{label:"Italiano",value:"it",countryCode:"it"},{label:"Franais",value:"fr",countryCode:"fr"},{label:"Espaol",value:"es",countryCode:"es"},{label:"Deutsch",value:"de",countryCode:"de"},{label:"",value:"ru",countryCode:"ru"}]}}getValueForLanguage(t,e){if(t[e]){return t[e]}else{return t["en"]}}async getDeviceInfo(){const t=await kL.getInfo();this.deviceInfo=t;return t}async getNetworkStatus(){return new Promise((t=>{UL.removeAllListeners();UL.getStatus().then((e=>{const i=new L(e.connected);UL.addListener("networkStatusChange",(t=>{i.next(t.connected)}));t(i)}))}))}async getNetwork(){if(ct.isNativePlatform()){try{const t=await UL.getStatus();return t.connected}catch(t){console.error("Error getting network status from Capacitor:",t);return false}}else{const t=navigator.onLine;return t}}}const HL=new GL;export{PF as $,fP as A,qP as B,ZN as C,_N as D,VP as E,KN as F,rz as G,Mc as H,Gl as I,ez as J,JF as K,HN as L,mP as M,DL as N,VN as O,UF as P,$F as Q,pP as R,HL as S,aP as T,mz as U,IF as V,kF as W,SF as X,jF as Y,CF as Z,DF as _,bN as a,GN as a$,RF as a0,HP as a1,mN as a2,VR as a3,UP as a4,gP as a5,OP as a6,LP as a7,WR as a8,WP as a9,rP as aA,kN as aB,QP as aC,NF as aD,gz as aE,GP as aF,JR as aG,wP as aH,TP as aI,Er as aJ,Cr as aK,Ir as aL,tF as aM,UL as aN,EF as aO,zR as aP,yP as aQ,iP as aR,AP as aS,PR as aT,az as aU,EP as aV,xP as aW,gF as aX,qF as aY,NR as aZ,OF as a_,eN as aa,ZP as ab,_P as ac,hN as ad,rN as ae,TN as af,oz as ag,GF as ah,lF as ai,uF as aj,fF as ak,oF as al,ZF as am,aF as an,hF as ao,eF as ap,dF as aq,_F as ar,pF as as,QR as at,uN as au,nF as av,QN as aw,KP as ax,YR as ay,PL as az,iN as b,lP as b0,Yh as b1,to as b2,eo as b3,Qr as b4,ko as b5,ao as b6,Ka as b7,kr as b8,so as b9,Fa as bA,Za as bB,za as bC,qr as bD,_r as bE,xo as bF,ds as bG,wF as bH,zN as ba,jr as bb,Ta as bc,Sa as bd,Dr as be,is as bf,So as bg,ho as bh,Kr as bi,no as bj,FN as bk,Mo as bl,ca as bm,zo as bn,No as bo,Fr as bp,Xr as bq,io as br,ro as bs,Aa as bt,Ur as bu,lo as bv,fo as bw,uo as bx,Zs as by,Ya as bz,sN as c,ON as d,AN as e,lN as f,dN as g,xN as h,nz as i,zF as j,YF as k,QF as l,$L as m,IN as n,UN as o,DN as p,CN as q,$l as r,GR as s,BL as t,KR as u,uP as v,Vl as w,sz as x,Ul as y,XP as z};