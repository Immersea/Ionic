import{r as t,h as i,H as s,f as e}from"./p-cbe60c68.js";import{U as n,c as o,e as a,g as h,T as r}from"./p-736235c6.js";import"./p-c7ee7cfe.js";import{n as l}from"./p-5d4a8e1f.js";import{E as c}from"./p-46038295.js";import{g as d}from"./p-fa5855bb.js";import{l as f}from"./p-1af05547.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";import"./p-694b8ade.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const p="popover-chat-participants{}";const m=p;const u=class{constructor(i){t(this,i);this.usersList=[];this.participantsList=[];this.addedParticipantsList=[];this.removedParticipantsList=[];this.userNotFound=false;this.modifiedParticipants=false;this.chat=undefined;this.editable=true;this.showList=[];this.updateView=false}async componentWillLoad(){const t=Object.keys(this.chat.participants);this.usersList=[];for(let i of t){const t=this.chat.participants[i];if(t.collectionId=="userProfiles"){const i=await n.getPublicProfileUserDetails(t.id);if(i&&i.uid){this.usersList.push(i)}}}if(c.isUdive()){this.usersList=this.usersList.concat(o.divingCentersList);this.usersList=this.usersList.concat(a.divingSchoolsList);this.usersList=this.usersList.concat(h.serviceCentersList)}this.participantsList=f.exports.orderBy(this.usersList.filter((i=>t.includes(i.id)||t.includes(i.uid))),"displayName");const i=Object.keys(this.chat.users);this.ownersIds=i.filter((t=>this.chat.users[t].includes("owner")));if(c.isUdive()){this.editable=this.ownersIds.includes(n.userProfile.uid)||this.ownersIds.includes(h.selectedServiceCenterId)||this.ownersIds.includes(o.selectedDivingCenterId)||this.ownersIds.includes(a.selectedDivingSchoolId)}}async searchUsers(t){this.searchFilter=t.target.value.toLowerCase();this.showList=[];if(d().validate(this.searchFilter)){const t=await n.searchUserByEmail(this.searchFilter);if(t&&t.uid){this.showList.push(t);this.userNotFound=false}else{this.showList=[];this.userNotFound=true}this.updateView=!this.updateView}}resetShowList(){this.userNotFound=false;this.showList=[]}addUser(t){if(this.participantsList.findIndex((i=>t.uid===i.id))==-1){this.participantsList.push(t);this.addedParticipantsList.push(t)}this.searchFilter="";this.resetShowList();this.modifiedParticipants=true}removeUser(t){this.participantsList.splice(this.participantsList.findIndex((i=>i.uid===t.uid||i.id===t.id)),1);this.addedParticipantsList.splice(this.addedParticipantsList.findIndex((i=>i.uid===t.uid||i.id===t.id)),1);this.removedParticipantsList.push(t);this.searchFilter="";this.resetShowList();this.modifiedParticipants=true}changeName(t){this.chat.name=t.target.value}close(){l.dismiss()}save(){l.dismiss({chatName:this.chat.name,added:this.addedParticipantsList,removed:this.removedParticipantsList})}render(){return i(s,{key:"eac1e4d8375a1699fe353d09dfc7b03c7aa29ed3"},i("ion-content",{key:"db30ab768c8f8def8b75a226f09f56f3433909b4"},i("ion-list",{key:"6d6a7d7aa89140ed273f86ef6e0af465af005208"},this.editable&&Object.keys(this.chat.participants).length>2?i("ion-item",{color:"chat"},i("ion-input",{mode:"ios",placeholder:r.getTransl("chat-name","Insert Chat Name"),value:this.chat.name,onIonInput:t=>this.changeName(t)})):undefined,this.editable?[i("ion-header",{translucent:true},i("ion-toolbar",null,i("ion-title",null,i("my-transl",{tag:"edit-chat-participants",text:"Edit Chat Participants"}))))]:undefined,this.participantsList.map((t=>i("ion-item",null,t.photoURL?i("ion-avatar",{slot:"start"},i("ion-img",{src:t.photoURL})):undefined,i("ion-label",null,t.displayName),this.editable&&!this.ownersIds.includes(t.uid)&&!this.ownersIds.includes(t.id)?i("ion-button",{slot:"end","icon-only":true,fill:"clear",color:"danger",onClick:()=>this.removeUser(t)},i("ion-icon",{name:"person-remove-outline"})):undefined)))),this.editable?[i("ion-header",{translucent:true},i("ion-toolbar",null,i("ion-title",null,i("my-transl",{tag:"add-chat-participants",text:"Add Chat Participants"})))),i("ion-header",{translucent:true},i("ion-toolbar",null,i("ion-searchbar",{value:this.searchFilter,placeholder:"Email",inputmode:"email",type:"email",enterkeyhint:"search",clearIcon:"close-circle",autocomplete:"email",onIonInput:()=>this.resetShowList(),onIonClear:()=>this.resetShowList(),onIonCancel:()=>this.resetShowList(),onIonChange:t=>this.searchUsers(t)})))]:undefined,i("ion-list",{key:"9209c0c3ef90d5b1001f0076e1c64b9f415b47ff"},this.showList.map((t=>i("ion-item",null,t.photoURL?i("ion-avatar",{slot:"start"},i("ion-img",{src:t.photoURL})):undefined,i("ion-label",null,t.displayName),i("ion-button",{slot:"end","icon-only":true,fill:"clear",color:"success",onClick:()=>this.addUser(t)},i("ion-icon",{name:"person-add-outline"}))))),this.userNotFound?i("ion-item",null,i("ion-label",null,i("my-transl",{tag:"user-not-found",text:"User Not Found"}))):undefined)),i("app-modal-footer",{key:"c49d800443d63aead50e55c400f2d90fc6342d34",onCancelEmit:()=>this.close(),disableSave:!this.modifiedParticipants,onSaveEmit:()=>this.save()}))}get el(){return e(this)}};u.style=m;export{u as popover_chat_participants};