{"version":3,"names":["pageLostpswCss","PageLostpswStyle0","PageLostpsw","name","valid","value","componentWillLoad","this","email","emailpsw","showAlert","message","header","TranslationService","getTransl","newuser","google","facebook","pswreset","pswreseterror","show_message","alert","alertController","create","buttons","text","handler","async","RouterService","push","AuthService","dismissLoading","present","inputHandler","event","detail","checkEmail","SystemService","presentLoading","methods","fetchSignInMethodsForEmail","length","presentAlertError","indexOf","EmailAuthProvider","EMAIL_PASSWORD_SIGN_IN_METHOD","sendResetPsw","GoogleAuthProvider","GOOGLE_SIGN_IN_METHOD","FacebookAuthProvider","FACEBOOK_SIGN_IN_METHOD","passwordReset","then","catch","render","h","key","color","Environment","getAppColor","tag","scrollEvents","onIonScroll","ev","scrollTop","isUdive","isDecoplanner","scrollTopValue","heightPx","link","undefined","onFormItemChanged","validator","expand","disabled","onClick"],"sources":["src/components/common/pages/user/page-lostpsw/page-lostpsw.scss?tag=page-lostpsw","src/components/common/pages/user/page-lostpsw/page-lostpsw.tsx"],"sourcesContent":["page-lostpsw {\n  .validation-error {\n    padding-left: 18px;\n    font-size: 0.7rem;\n    color: red;\n  }\n}\n","import { Component, h, Prop, State } from \"@stencil/core\";\nimport { AuthService } from \"../../../../../services/common/auth\";\nimport { TranslationService } from \"../../../../../services/common/translations\";\nimport { alertController } from \"@ionic/core\";\nimport { InputValidator } from \"../../../../../interfaces/interfaces\";\nimport { RouterService } from \"../../../../../services/common/router\";\nimport { Environment } from \"../../../../../global/env\";\nimport { SystemService } from \"../../../../../services/common/system\";\nimport {\n  EmailAuthProvider,\n  GoogleAuthProvider,\n  FacebookAuthProvider,\n} from \"firebase/auth\";\n@Component({\n  tag: \"page-lostpsw\",\n  styleUrl: \"page-lostpsw.scss\",\n})\nexport class PageLostpsw {\n  @Prop() email: string = \"\";\n  @State() emailpsw: InputValidator = {\n    name: \"emailpsw\",\n    valid: false,\n    value: \"\",\n  };\n  @State() scrollTop = 0;\n\n  componentWillLoad() {\n    if (this.email) {\n      this.emailpsw = {\n        name: \"emailpsw\",\n        valid: true,\n        value: this.email,\n      };\n    }\n  }\n\n  async showAlert(message) {\n    let header = TranslationService.getTransl(\"login\", \"Login\");\n    let newuser = TranslationService.getTransl(\n      \"new-user\",\n      \"Your email is not registered in our systems. Please register to proceed.\"\n    );\n    let google = TranslationService.getTransl(\n      \"google-registration\",\n      \"You have previously logged-in through Google registration process. Please click on the related button in the login page to proceed.\"\n    );\n    let facebook = TranslationService.getTransl(\n      \"facebook-registration\",\n      \"You have previously logged-in through Facebook registration process. Please click on the related button in the login page to proceed.\"\n    );\n    let pswreset = TranslationService.getTransl(\n      \"pswreset\",\n      \"You will receive shortly an email to reset your password. Please follow the instructions and then come back to the login page.\"\n    );\n    let pswreseterror = TranslationService.getTransl(\n      \"pswreseterror\",\n      \"There was an error in the reset process. Please try again later.\"\n    );\n    let show_message = \"\";\n    switch (message) {\n      case \"newuser\":\n        show_message = newuser;\n        break;\n      case \"google\":\n        show_message = google;\n        break;\n      case \"facebook\":\n        show_message = facebook;\n        break;\n      case \"pswreset\":\n        show_message = pswreset;\n        break;\n      case \"pswreseterror\":\n        show_message = pswreseterror;\n        break;\n    }\n\n    const alert = await alertController.create({\n      header: header,\n      message: show_message,\n      buttons: [\n        {\n          text: TranslationService.getTransl(\"ok\", \"OK\"),\n          handler: async () => {\n            RouterService.push(\"/login\", \"root\");\n          },\n        },\n      ],\n    });\n    AuthService.dismissLoading();\n    alert.present();\n  }\n\n  inputHandler(event) {\n    this[event.detail.name] = event.detail;\n  }\n\n  async checkEmail() {\n    SystemService.presentLoading(\"please-wait\");\n    const methods = await AuthService.fetchSignInMethodsForEmail(\n      this.emailpsw.value\n    );\n    SystemService.dismissLoading();\n    if (methods.length == 0) {\n      //new user\n      SystemService.presentAlertError(\"newuser\");\n    } else {\n      //existing user\n      if (\n        methods.indexOf(EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD) != -1\n      ) {\n        this.sendResetPsw();\n      } else if (\n        methods.indexOf(GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD) != -1\n      ) {\n        this.showAlert(\"google\");\n      } else if (\n        methods.indexOf(FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD) != -1\n      ) {\n        this.showAlert(\"facebook\");\n      }\n    }\n  }\n\n  sendResetPsw() {\n    SystemService.presentLoading(\"please-wait\");\n    AuthService.passwordReset(this.emailpsw.value)\n      .then(() => {\n        SystemService.dismissLoading();\n        this.showAlert(\"pswreset\");\n      })\n      .catch(() => {\n        SystemService.dismissLoading();\n        this.showAlert(\"pswreseterror\");\n      });\n  }\n\n  render() {\n    return [\n      <app-navbar\n        color={Environment.getAppColor()}\n        tag='forgot-psw'\n        text='Forgot Password'\n        back-button={true}\n      ></app-navbar>,\n      <ion-content\n        scrollEvents\n        onIonScroll={(ev) => (this.scrollTop = ev.detail.scrollTop)}\n      >\n        {Environment.isUdive() || Environment.isDecoplanner() ? (\n          <app-banner\n            scrollTopValue={this.scrollTop}\n            heightPx={250}\n            link='assets/images/friendship2SM.jpg'\n          ></app-banner>\n        ) : undefined}\n        <ion-grid>\n          <ion-row>\n            <ion-col>\n              <app-form-item\n                label-tag='email'\n                label-text='Email'\n                name='emailpsw'\n                input-type='email'\n                onFormItemChanged={(ev) => this.inputHandler(ev)}\n                validator={[\"required\", \"email\"]}\n              ></app-form-item>\n              <ion-button\n                margin-top\n                expand='block'\n                disabled={!this.emailpsw.valid}\n                onClick={() => this.checkEmail()}\n              >\n                <my-transl\n                  tag='login-resetpsw'\n                  text='Reset my password'\n                ></my-transl>\n              </ion-button>\n            </ion-col>\n          </ion-row>\n        </ion-grid>\n      </ion-content>,\n    ];\n  }\n}\n"],"mappings":"+XAAA,MAAMA,EAAiB,+EACvB,MAAAC,EAAeD,E,MCgBFE,EAAW,M,oCACE,G,cACY,CAClCC,KAAM,WACNC,MAAO,MACPC,MAAO,I,eAEY,C,CAErB,iBAAAC,GACE,GAAIC,KAAKC,MAAO,CACdD,KAAKE,SAAW,CACdN,KAAM,WACNC,MAAO,KACPC,MAAOE,KAAKC,M,EAKlB,eAAME,CAAUC,GACd,IAAIC,EAASC,EAAmBC,UAAU,QAAS,SACnD,IAAIC,EAAUF,EAAmBC,UAC/B,WACA,4EAEF,IAAIE,EAASH,EAAmBC,UAC9B,sBACA,uIAEF,IAAIG,EAAWJ,EAAmBC,UAChC,wBACA,yIAEF,IAAII,EAAWL,EAAmBC,UAChC,WACA,kIAEF,IAAIK,EAAgBN,EAAmBC,UACrC,gBACA,oEAEF,IAAIM,EAAe,GACnB,OAAQT,GACN,IAAK,UACHS,EAAeL,EACf,MACF,IAAK,SACHK,EAAeJ,EACf,MACF,IAAK,WACHI,EAAeH,EACf,MACF,IAAK,WACHG,EAAeF,EACf,MACF,IAAK,gBACHE,EAAeD,EACf,MAGJ,MAAME,QAAcC,EAAgBC,OAAO,CACzCX,OAAQA,EACRD,QAASS,EACTI,QAAS,CACP,CACEC,KAAMZ,EAAmBC,UAAU,KAAM,MACzCY,QAASC,UACPC,EAAcC,KAAK,SAAU,OAAO,MAK5CC,EAAYC,iBACZV,EAAMW,S,CAGR,YAAAC,CAAaC,GACX3B,KAAK2B,EAAMC,OAAOhC,MAAQ+B,EAAMC,M,CAGlC,gBAAMC,GACJC,EAAcC,eAAe,eAC7B,MAAMC,QAAgBT,EAAYU,2BAChCjC,KAAKE,SAASJ,OAEhBgC,EAAcN,iBACd,GAAIQ,EAAQE,QAAU,EAAG,CAEvBJ,EAAcK,kBAAkB,U,KAC3B,CAEL,GACEH,EAAQI,QAAQC,EAAkBC,iCAAmC,EACrE,CACAtC,KAAKuC,c,MACA,GACLP,EAAQI,QAAQI,EAAmBC,yBAA2B,EAC9D,CACAzC,KAAKG,UAAU,S,MACV,GACL6B,EAAQI,QAAQM,EAAqBC,2BAA6B,EAClE,CACA3C,KAAKG,UAAU,W,GAKrB,YAAAoC,GACET,EAAcC,eAAe,eAC7BR,EAAYqB,cAAc5C,KAAKE,SAASJ,OACrC+C,MAAK,KACJf,EAAcN,iBACdxB,KAAKG,UAAU,WAAW,IAE3B2C,OAAM,KACLhB,EAAcN,iBACdxB,KAAKG,UAAU,gBAAgB,G,CAIrC,MAAA4C,GACE,MAAO,CACLC,EAAA,cAAAC,IAAA,2CACEC,MAAOC,EAAYC,cACnBC,IAAI,aACJnC,KAAK,kBAAiB,cACT,OAEf8B,EAAA,eAAAC,IAAA,2CACEK,aAAY,KACZC,YAAcC,GAAQxD,KAAKyD,UAAYD,EAAG5B,OAAO6B,WAEhDN,EAAYO,WAAaP,EAAYQ,gBACpCX,EAAA,cACEY,eAAgB5D,KAAKyD,UACrBI,SAAU,IACVC,KAAK,oCAELC,UACJf,EAAA,YAAAC,IAAA,4CACED,EAAA,WAAAC,IAAA,4CACED,EAAA,WAAAC,IAAA,4CACED,EAAA,iBAAAC,IAAA,uDACY,QAAO,aACN,QACXrD,KAAK,WAAU,aACJ,QACXoE,kBAAoBR,GAAOxD,KAAK0B,aAAa8B,GAC7CS,UAAW,CAAC,WAAY,WAE1BjB,EAAA,cAAAC,IAAA,6DAEEiB,OAAO,QACPC,UAAWnE,KAAKE,SAASL,MACzBuE,QAAS,IAAMpE,KAAK6B,cAEpBmB,EAAA,aAAAC,IAAA,2CACEI,IAAI,iBACJnC,KAAK,2B","ignoreList":[]}