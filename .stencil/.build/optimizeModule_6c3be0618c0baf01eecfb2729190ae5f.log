import{r as e,h as t}from"./p-cbe60c68.js";import{U as i,S as a,R as s,aO as o,v as n,aP as c}from"./p-f42b650b.js";import{l as r}from"./p-1af05547.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-c2915cc5.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const f="page-admin-agencies .cover{height:var(--coverHeight)}";const d=f;const l=class{constructor(t){e(this,t);this.selectedAgency=undefined;this.selectedAgencyCertifications=[];this.isUpdated=false;this.updateView=true}componentWillLoad(){this.userRoles=i.userRoles;this.systemSub=a.systemPreferences$.subscribe((e=>{this.agencies=[];Object.keys(e.divingAgencies).forEach((t=>{if(this.userRoles.isSuperAdmin()||this.userRoles.roles.includes(t.toLowerCase()+"-admin")){const i=e.divingAgencies[t];i.id=t;this.agencies.push(i)}}));if(!this.selectedAgency)this.selectedAgency=r.exports.cloneDeep(this.agencies[0]);this.createCertificationsArray()}))}createCertificationsArray(){this.selectedAgencyCertifications=[];const e=[];Object.keys(this.selectedAgency.certifications).map((t=>{let i=this.selectedAgency.certifications[t];i.id=t;e.push(i)}));this.selectedAgencyCertifications=r.exports.orderBy(e,"order")}disconnectedCallback(){this.systemSub.unsubscribe()}updateAgency(e){this.isUpdated=false;this.selectedAgency=r.exports.cloneDeep(this.agencies.find((t=>t.id==e)));this.createCertificationsArray()}handleChange(e){this.isUpdated=true;this.selectedAgency[e.detail.name]=e.detail.value}async reorderCertifications(e){this.isUpdated=true;const t=r.exports.cloneDeep(this.selectedAgencyCertifications);const i=t.splice(e.detail.from,1)[0];t.splice(e.detail.to,0,i);t.forEach(((e,t)=>{e.order=t}));e.detail.complete(t);this.selectedAgencyCertifications=r.exports.orderBy(t,"order")}async editCertification(e){this.isUpdated=true;let t=null;if(e===undefined){t={id:null,maxDepth:20,name:"",order:this.selectedAgencyCertifications?this.selectedAgencyCertifications.length:0,group:""}}else{t=r.exports.cloneDeep(this.selectedAgencyCertifications[e])}const i=await s.openModal("modal-dive-certification-update",{agencyId:this.selectedAgency.id,diveCertification:t});i.onDidDismiss().then((t=>{const i=t.data;if(i){if(e===undefined){this.selectedAgencyCertifications.push(i)}else{this.selectedAgencyCertifications[e]=i}this.updateView=!this.updateView}}))}updateImageUrls(e){this.isUpdated=true;const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.selectedAgency.photoURL=i}else{this.selectedAgency.coverURL=i}}async save(){this.selectedAgency.certifications={};this.selectedAgencyCertifications.map((e=>{this.selectedAgency.certifications[e.id]=e}));const e=await o.updateDivingAgency(this.selectedAgency.id,this.selectedAgency);if(e){this.isUpdated=false}}cancel(){this.isUpdated=false;this.updateAgency(this.selectedAgency.id)}render(){return[t("ion-header",{key:"48c2113c48f1f9bd2b062af8b9ef9ee142ffbf67",class:"cover"},t("app-upload-cover",{key:"b3c40f01c80076e762445fc60c5f4eabe62d8898",item:{collection:n,id:this.selectedAgency.id,photoURL:this.selectedAgency.photoURL,coverURL:this.selectedAgency.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-content",{key:"50be217ad2c9264584da1348a14171a81ddf2f88"},t("ion-fab",{key:"18969c900452bf8f00ea3525625a5213314aaa28",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:c(0)}},t("ion-menu-button",{key:"8baf1c05e0e9750c9056aefb265c0152df18c985",class:"fab-icon"})),t("ion-list",{key:"57ba1cdaeb7cf3fb629efa2f4d3f6ac9c1a57381"},this.agencies.length>0?t("ion-item",null,t("ion-label",null,"Select Diving Agency"),t("ion-select",{value:this.selectedAgency.id,onIonChange:e=>this.updateAgency(e.detail.value),interface:"popover"},this.agencies.map((e=>t("ion-select-option",{value:e.id},e.name))))):undefined,t("app-form-item",{key:"926330f3e7b144cf4695cf19eacbbd1c912f70a0","label-tag":"name","label-text":"Name",value:this.selectedAgency.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"c408b450deb35272a8bff8141fbb46c08739d803","label-tag":"website","label-text":"Website",value:this.selectedAgency.website,name:"website","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]})),t("ion-list",{key:"b110da1125206579a0e32602f44b7756cfe462fd"},t("ion-list-header",{key:"d1d5a1c8fa33091a14a5566ca1c5698749d40ef4"},t("ion-label",{key:"ea24db6b0e080453a44fbcae3d34d59b5ed068a4"},t("my-transl",{key:"b6fe0c8a3f7703d4c0c40854c771f68b4d33af51",tag:"certifications",text:"Certifications"})),t("ion-button",{key:"ea6e8554fd7503b7670e5db4755917db69122c9f","icon-only":true,onClick:()=>this.editCertification()},t("ion-icon",{key:"af814b5b1448b21bbd90867576eaf445813dac68",name:"add-circle-outline"}))),t("ion-reorder-group",{key:"0f14e8b1f35a2135e4522a38dcc00cc3f4fef824",disabled:false,onIonItemReorder:e=>this.reorderCertifications(e)},this.selectedAgencyCertifications.map(((e,i)=>t("ion-item",null,e.photoURL?t("ion-avatar",{slot:"start"},t("img",{src:e.photoURL})):undefined,t("ion-reorder",{slot:"end"}),t("ion-label",null,e.order+1,". ",e.name),t("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.editCertification(i)},t("ion-icon",{name:"create-outline"})))))))),this.isUpdated?t("app-modal-footer",{onSaveEmit:()=>this.save(),onCancelEmit:()=>this.cancel()}):undefined]}};l.style=d;export{l as page_admin_agencies};