import{r as t,h as i,H as s,f as e}from"./p-cbe60c68.js";import{U as n,E as o,c as a,e as h,g as r,T as l}from"./p-a7a717b1.js";import"./p-c7ee7cfe.js";import{n as c}from"./p-5d4a8e1f.js";import{g as d}from"./p-fa5855bb.js";import{l as p}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const f="popover-chat-participants{}";const u=f;const m=class{constructor(i){t(this,i);this.usersList=[];this.participantsList=[];this.addedParticipantsList=[];this.removedParticipantsList=[];this.userNotFound=false;this.modifiedParticipants=false;this.chat=undefined;this.editable=true;this.showList=[];this.updateView=false}async componentWillLoad(){const t=Object.keys(this.chat.participants);this.usersList=[];for(let i of t){const t=this.chat.participants[i];if(t.collectionId=="userProfiles"){const i=await n.getPublicProfileUserDetails(t.id);if(i&&i.uid){this.usersList.push(i)}}}if(o.isUdive()){this.usersList=this.usersList.concat(a.divingCentersList);this.usersList=this.usersList.concat(h.divingSchoolsList);this.usersList=this.usersList.concat(r.serviceCentersList)}this.participantsList=p.exports.orderBy(this.usersList.filter((i=>t.includes(i.id)||t.includes(i.uid))),"displayName");const i=Object.keys(this.chat.users);this.ownersIds=i.filter((t=>this.chat.users[t].includes("owner")));if(o.isUdive()){this.editable=this.ownersIds.includes(n.userProfile.uid)||this.ownersIds.includes(r.selectedServiceCenterId)||this.ownersIds.includes(a.selectedDivingCenterId)||this.ownersIds.includes(h.selectedDivingSchoolId)}}async searchUsers(t){this.searchFilter=t.target.value.toLowerCase();this.showList=[];if(d().validate(this.searchFilter)){const t=await n.searchUserByEmail(this.searchFilter);if(t&&t.uid){this.showList.push(t);this.userNotFound=false}else{this.showList=[];this.userNotFound=true}this.updateView=!this.updateView}}resetShowList(){this.userNotFound=false;this.showList=[]}addUser(t){if(this.participantsList.findIndex((i=>t.uid===i.id))==-1){this.participantsList.push(t);this.addedParticipantsList.push(t)}this.searchFilter="";this.resetShowList();this.modifiedParticipants=true}removeUser(t){this.participantsList.splice(this.participantsList.findIndex((i=>i.uid===t.uid||i.id===t.id)),1);this.addedParticipantsList.splice(this.addedParticipantsList.findIndex((i=>i.uid===t.uid||i.id===t.id)),1);this.removedParticipantsList.push(t);this.searchFilter="";this.resetShowList();this.modifiedParticipants=true}changeName(t){this.chat.name=t.target.value}close(){c.dismiss()}save(){c.dismiss({chatName:this.chat.name,added:this.addedParticipantsList,removed:this.removedParticipantsList})}render(){return i(s,{key:"bb9fe351b7486f52b04276bc3dc25942e6116064"},i("ion-content",{key:"884fbda40924c337ea23c8eb5667231d5e03b3ff"},i("ion-list",{key:"ec0869e661512503206bb1fea14d07a2b4c868a8"},this.editable&&Object.keys(this.chat.participants).length>2?i("ion-item",{color:"chat"},i("ion-input",{mode:"ios",placeholder:l.getTransl("chat-name","Insert Chat Name"),value:this.chat.name,onIonInput:t=>this.changeName(t)})):undefined,this.editable?[i("ion-header",{translucent:true},i("ion-toolbar",null,i("ion-title",null,i("my-transl",{tag:"edit-chat-participants",text:"Edit Chat Participants"}))))]:undefined,this.participantsList.map((t=>i("ion-item",null,t.photoURL?i("ion-avatar",{slot:"start"},i("ion-img",{src:t.photoURL})):undefined,i("ion-label",null,t.displayName),this.editable&&!this.ownersIds.includes(t.uid)&&!this.ownersIds.includes(t.id)?i("ion-button",{slot:"end","icon-only":true,fill:"clear",color:"danger",onClick:()=>this.removeUser(t)},i("ion-icon",{name:"person-remove-outline"})):undefined)))),this.editable?[i("ion-header",{translucent:true},i("ion-toolbar",null,i("ion-title",null,i("my-transl",{tag:"add-chat-participants",text:"Add Chat Participants"})))),i("ion-header",{translucent:true},i("ion-toolbar",null,i("ion-searchbar",{value:this.searchFilter,placeholder:"Email",inputmode:"email",type:"email",enterkeyhint:"search",clearIcon:"close-circle",autocomplete:"email",onIonInput:()=>this.resetShowList(),onIonClear:()=>this.resetShowList(),onIonCancel:()=>this.resetShowList(),onIonChange:t=>this.searchUsers(t)})))]:undefined,i("ion-list",{key:"d03b4b6f51c4f7421f60781dfd0375953c58ec4d"},this.showList.map((t=>i("ion-item",null,t.photoURL?i("ion-avatar",{slot:"start"},i("ion-img",{src:t.photoURL})):undefined,i("ion-label",null,t.displayName),i("ion-button",{slot:"end","icon-only":true,fill:"clear",color:"success",onClick:()=>this.addUser(t)},i("ion-icon",{name:"person-add-outline"}))))),this.userNotFound?i("ion-item",null,i("ion-label",null,i("my-transl",{tag:"user-not-found",text:"User Not Found"}))):undefined)),i("app-modal-footer",{key:"60a4200070ad5f568cdca934be63fc8cd912a9a6",onCancelEmit:()=>this.close(),disableSave:!this.modifiedParticipants,onSaveEmit:()=>this.save()}))}get el(){return e(this)}};m.style=u;export{m as popover_chat_participants};