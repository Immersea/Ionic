import{r as e,h as t,H as s,f as i}from"./p-cbe60c68.js";import{T as a,e as c,d,S as o,ad as n,ae as l,U as h}from"./p-736235c6.js";import"./p-c7ee7cfe.js";import{b as f,o as r}from"./p-5d4a8e1f.js";import{l as b}from"./p-1af05547.js";import{S as p}from"./p-a75993af.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const u="modal-diving-class-update ion-list{width:100%}modal-diving-class-update app-diving-class-schedule{width:100%}modal-diving-class-update ion-segment-button{--color-checked:var(--ion-color-divingclass-contrast)}";const m=u;const v=class{constructor(t){e(this,t);this.divingClassId=undefined;this.collectionId=undefined;this.organiserId=undefined;this.divingClass=undefined;this.updateView=true;this.validClass=false;this.selectedCourse=undefined;this.addressText=undefined;this.titles=[{tag:"details"},{tag:"schedule"},{tag:"team"},{tag:"students"}];this.slider=undefined;this.selectGotFocus=false}async componentWillLoad(){await this.loadDivingClass();this.statusTitles={active:a.getTransl("active","Active"),closed:a.getTransl("closed","Closed"),cancelled:a.getTransl("cancelled","Cancelled")};this.placeholder=a.getTransl("insert-title","Insert title");if(this.organiserId==c.selectedDivingSchoolId){this.divingSchool=c.selectedDivingSchool}else if(this.collectionId==d){this.divingSchool=await c.getDivingSchool(this.organiserId)}this.divingAgencies=o.systemPreferences.divingAgencies;this.divingCourses=await o.getDivingCoursesForSchool(this.divingSchool);if(this.divingClass&&this.divingClass.course){this.selectedCourse=this.divingCourses.find((e=>e.agencyId===this.divingClass.course.agencyId&&e.id===this.divingClass.course.certificationId))}}async loadDivingClass(){if(this.divingClassId){this.divingClass=await n.getDivingClass(this.divingClassId);this.collectionId=this.divingClass.organiser.collectionId;this.organiserId=this.divingClass.organiser.id}else{this.divingClass=new l;this.divingClass.organiser={collectionId:this.collectionId,id:this.organiserId};this.divingClass.users={[h.userRoles.uid]:["owner","instructor"]}}this.addressText=this.divingClass.location&&this.divingClass.location.display_name?this.divingClass.location.display_name:null}async componentDidLoad(){this.slider=new p(".slider-dive-class",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.appBookings=this.el.getElementsByTagName("app-dive-class-bookings")[0];this.appSchedule=this.el.getElementsByTagName("app-diving-class-schedule")[0];this.createCourseSelectOptions();this.validateClass()}createCourseSelectOptions(){this.selectCourseElement=this.el.querySelector("#dive-course-select");const e={header:a.getTransl("diving-course","Diving Course")};const t=Array.from(this.selectCourseElement.getElementsByTagName("ion-select-option"));t.map((e=>{this.selectCourseElement.removeChild(e)}));this.selectCourseElement.interfaceOptions=e;b.exports.each(this.divingCourses,(e=>{const t=document.createElement("ion-select-option");t.value=e;t.textContent=this.divingAgencies[e.agencyId].name+" - "+e.name;this.selectCourseElement.appendChild(t)}))}async changeCourse(e){if(this.selectGotFocus&&this.divingClass&&this.divingClass.activities&&this.divingClass.activities.length>0){const t=await f.create({header:a.getTransl("diving-course","Diving Course"),message:a.getTransl("update-class-activities","This will update all class activities! Are you sure?"),buttons:[{text:a.getTransl("ok","OK"),handler:()=>{this.selectGotFocus=false;this.updateCourseDetails(e)}},{text:a.getTransl("cancel","Cancel"),handler:()=>{this.selectGotFocus=false;this.createCourseSelectOptions();this.selectedCourse=Object.assign({},this.selectedCourse)},role:"cancel",cssClass:"secondary"}]});t.present()}else{this.updateCourseDetails(e)}}updateCourseDetails(e){this.selectedCourse=e;this.divingClass.name=this.divingAgencies[this.selectedCourse.agencyId].name+" - "+this.selectedCourse.name;this.divingClass.activities=b.exports.cloneDeep(e.activities);this.divingClass.numberOfStudents=e.numberOfStudents;this.divingClass.course={certificationId:e.id,agencyId:e.agencyId};this.appBookings.updateStudentsList();this.appSchedule.updateClassSchedule();this.validateClass()}selectLocation(e){this.divingClass.location=e;this.addressText=e.display_name;this.validateClass()}updateStudents(e){this.divingClass.numberOfStudents=b.exports.toNumber(e);this.appBookings.updateStudentsList();this.validateClass()}updateStatus(e){this.divingClass.status=e;this.validateClass()}handleChange(e){this.divingClass[e.detail.name]=e.detail.value;this.validateClass()}validateClass(){this.validClass=b.exports.isString(this.divingClass.name)&&this.divingClass.numberOfStudents>0&&this.divingClass.location&&b.exports.isString(this.divingClass.location.display_name)&&b.exports.isString(this.divingClass.status)&&Object.keys(this.divingClass.schedule).length>0;this.updateView=!this.updateView}async save(){await n.updateDivingClass(this.divingClassId,this.divingClass);return r.dismiss(false)}async cancel(){return r.dismiss(true)}render(){return t(s,{key:"e220cc65286adea5601478750e48e30d0617588f"},this.selectedCourse&&this.selectedCourse.photoURL?t("ion-header",null,t("app-item-cover",{item:this.selectedCourse})):undefined,this.selectedCourse?t("ion-header",null,t("ion-toolbar",{color:"divingclass"},t("ion-title",null,this.divingClass.name))):undefined,t("app-header-segment-toolbar",{key:"bcc06722c579501b66c88e3083c419a667420f6f",color:"divingclass",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"2ef481fa6fc00e1cc701b61d090f7629b06a071c",class:"slides"},t("swiper-container",{key:"b359c77ebe9bd8e1c0fb5593441d04d0ef1ffa6d",class:"slider-dive-class swiper"},t("swiper-wrapper",{key:"ce5a4301b110614e8005768b27655c5a8c289fd7",class:"swiper-wrapper"},t("swiper-slide",{key:"aaee9d5fb2a9e90e787bb19da2e238e8a7822752",class:"swiper-slide"},t("ion-list",{key:"ef43ecd8d89ac1d4ab9eecfbef5537a388195e84"},t("ion-item",{key:"e636135432b804b556a46491bf69566d7937194a"},t("ion-label",{key:"7ff4c14137bda8f96cef3fcb0511eb50c2451a8b"},t("my-transl",{key:"3a49218c62d90cf2bea7b152d14bb8e63522ed2c",tag:"diving-course",text:"Diving Course"})),t("ion-select",{key:"d7b8938ede545abd4d79e8bece031971d553ed52",id:"dive-course-select",interface:"action-sheet",onIonChange:e=>this.changeCourse(e.detail.value),onIonFocus:()=>this.selectGotFocus=true,placeholder:a.getTransl("select","Select"),value:this.selectedCourse})),t("app-form-item",{key:"29394e7d547461d4e4e779148ce9d838a7434330","label-tag":"name","label-text":"Name",value:this.divingClass.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-item",{key:"b0f7ad542fabeb0d627eae8a46368a0794b933ca"},t("ion-label",{key:"3147877ca88e0152656bc4894112eb80cbc6e418"},t("my-transl",{key:"3a47c121201f922c86cee1cae71f2390e290ed1b",tag:"number-of-students",text:"Number of Students"})),t("ion-select",{key:"405a4832430eecd00d3c1c25b501b6f227cc4d91",value:this.divingClass.numberOfStudents,onIonChange:e=>this.updateStudents(e.detail.value),interface:"popover"},t("ion-select-option",{key:"e11bcc0ad9596f6d198e61b8ca10f7865e919773",value:1},"1"),t("ion-select-option",{key:"5f9966e62e43214dd6ba4c09b2603f6b82f8157d",value:2},"2"),t("ion-select-option",{key:"993363e58dd8b5fd2061fcbe713b34eeb4466905",value:3},"3"),t("ion-select-option",{key:"dc139c7a43e95fd6e7cd97fb637d4a79db3c0959",value:4},"4"),t("ion-select-option",{key:"ccf6e0041e14a27101dadc6071c98cecd1a92e41",value:5},"5"),t("ion-select-option",{key:"9134ea6350026cc2d2915c81f420afdb4e7c7d59",value:6},"6"),t("ion-select-option",{key:"0ae37c00d5dc353065e20e79b8101eb4ee1da7f2",value:7},"7"),t("ion-select-option",{key:"b6611c0c70dfb7d2bd53c50891f5c7667a700f4b",value:8},"8"),t("ion-select-option",{key:"2f026b88356cbcf2a958f81f9b5518a5865a039d",value:9},"9"),t("ion-select-option",{key:"c22bad44af2d391e1cd2e5d506d95d0769656155",value:10},"10"),t("ion-select-option",{key:"122bf50a02ac73ef226a7e4ab59b1e8ee7bcc21f",value:11},"11"),t("ion-select-option",{key:"38cae8499f1e2ff488f53742dfd0d3a396625015",value:12},"12"),t("ion-select-option",{key:"6e30e19a71320a7de83a0589897cc407cb8695a7",value:13},"13"),t("ion-select-option",{key:"f983e01e96e61b87262339ef57ec0a5f3428e99c",value:14},"14"),t("ion-select-option",{key:"78bf168e2b00746da05bdca60ce95b33021c7457",value:15},"15"))),t("app-form-item",{key:"f0f1586d87089d1c489e12e6b021f37bf929c8c2","label-tag":"location","label-text":"Location",value:this.addressText,name:"location","input-type":"text",onFormItemChanged:e=>this.addressText=e.detail.value,onFormLocationSelected:e=>this.selectLocation(e.detail),validator:["address"]}),t("ion-item",{key:"a4ca05db54c31ffa5c7e108e30a201a3844e8ea9"},t("ion-label",{key:"4f94a0a4151349803fc87fdf5cd70273b5fcf8c0"},t("my-transl",{key:"4f5170c931d97dd7abfbec00a8f56a5ee1594e93",tag:"status",text:"Status"})),t("ion-select",{key:"f271ad033a96e1b1d82812519197a8bf21f4a178",value:this.divingClass.status,onIonChange:e=>this.updateStatus(e.detail.value),interface:"popover"},t("ion-select-option",{key:"53d8af916aef16e770a1a38661a489cf168e3679",value:"active"},this.statusTitles.active),t("ion-select-option",{key:"84327b70c6d5f9dfd966e05772649f3a634f3845",value:"closed"},this.statusTitles.closed),t("ion-select-option",{key:"707d1eaf92eede28b1a9f191e2abffa642b1d32f",value:"cancelled"},this.statusTitles.cancelled))),t("app-form-item",{key:"4871a3865899dd3a011fa0f325c6d6dda4595a07","label-tag":"comments","label-text":"Comments",value:this.divingClass.comments,name:"comments","input-type":"text",textRows:4,onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"208f75397ed927d7a5e1ca02310a7df4e53c8217",class:"swiper-slide"},t("app-diving-class-schedule",{key:"f4cd9a7ac38d9d8f4343f1fbf79d6b7142d0467d",divingClass:this.divingClass,editable:true,onScheduleEmit:()=>this.validateClass()})),t("swiper-slide",{key:"5f968bdce951f59ab78131db1b164fb392349842",class:"swiper-slide"},t("app-users-list",{key:"6792f75377dc4497f5c10fe2b2a28ea4f78e8fcd",item:this.divingClass,editable:true,show:["owner","divemaster","instructor"]})),t("swiper-slide",{key:"05ea125dc529c3d46fe72b7837a620ba7e7b8df2",class:"swiper-slide"},t("app-dive-class-bookings",{key:"f7a0aac1a6b12a82dd49cbe80fdf695ab5cc42ac",divingClass:this.divingClass,divingClassId:this.divingClassId,editable:true}))))),t("app-modal-footer",{key:"ab0740259f9710ddd6c9ee98086248a3a6ca0ff5",disableSave:!this.validClass,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=m;export{v as modal_diving_class_update};