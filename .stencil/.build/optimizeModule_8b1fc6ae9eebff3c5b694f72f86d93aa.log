import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as s}from"./p-c2915cc5.js";import{l as o}from"./p-1af05547.js";import{S as l}from"./p-a75993af.js";import{U as d,p as n,a6 as r,ad as c,ae as p,T as h,S as f,E as b}from"./p-c24c8a77.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const m="modal-datasheet-update #properties-grid .showbool{--ion-grid-column-padding:1px}modal-datasheet-update #properties-grid ion-grid{--ion-grid-column-padding:2px;border-collapse:collapse;border-style:hidden}modal-datasheet-update #properties-grid ion-grid ion-row:first-child{background-color:var(--ion-color-trasteel);font-weight:bold;color:var(--ion-color-trasteel-contrast)}modal-datasheet-update #properties-grid ion-grid ion-col{border:1px solid black;border-bottom:0;border-right:0}modal-datasheet-update #properties-grid ion-grid ion-col:last-child{border-right:1px solid black}modal-datasheet-update #properties-grid ion-grid ion-row:last-child{border-bottom:1px solid black}modal-datasheet-update #properties-grid ion-grid .remove-background{padding:0}modal-datasheet-update #properties-grid ion-grid .remove-background ion-col,modal-datasheet-update #properties-grid ion-grid .remove-background ion-row{border:0px solid black;background-color:white;padding:0}";const u=m;const y=class{constructor(t){e(this,t);this.validDatasheet=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"properties",text:"Properties",disabled:false},{tag:"reference",text:"Reference",disabled:false},{tag:"comments",text:"Comments",disabled:false},{tag:"files",text:"Files",disabled:true}];this.datasheetId=undefined;this.duplicateDatasheet=undefined;this.revision=undefined;this.datasheet=undefined;this.updateView=true;this.scrollTop=0;this.propertyNames={};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=d.userProfile$.subscribe((e=>{this.userProfile=new n(e)}));await this.loadDatasheet()}async loadDatasheet(){if(this.datasheetId){const e=await r.getDatasheet(this.datasheetId);this.datasheet=e}else{const e=new c(this.duplicateDatasheet?this.duplicateDatasheet.datasheet:null);if(this.duplicateDatasheet&&this.revision){e.revisionNo=e.revisionNo+1}else{e.techNo=r.getMaxDatasheetTechNo();e.revisionNo=0}e.users={[d.userRoles.uid]:["owner"]};this.datasheet=e}this.validateDatasheet()}async componentDidLoad(){this.slider=new l(".slider-edit-datasheet",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});if(this.datasheet.productName){setTimeout((()=>{Object.keys(this.datasheet.properties).forEach((e=>{this.selectPropertyNameForIndex(e)}));this.validateDatasheet()}))}}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.datasheet[e.detail.name]=e.detail.value;this.validateDatasheet()}handlePropertyChange(e,t){const a=t.detail.name;let i=t.detail.value;this.datasheet.properties[e][a]=i;this.validateDatasheet()}deleteProperty(e){this.datasheet.properties.splice(e,1);this.validateDatasheet()}validateDatasheet(){this.validDatasheet=o.exports.isString(this.datasheet.productName)&&o.exports.isString(this.datasheet.familyId)&&o.exports.isString(this.datasheet.majorFamilyId)&&o.exports.isString(this.datasheet.techNo)&&this.datasheet.classification&&o.exports.isString(this.datasheet.categoriesId)&&this.checkParameters();this.updateSlider()}checkParameters(){let e=true;this.datasheet.properties.forEach((t=>{e=e&&r.getDatasheetPropertyNames("id",t.name)&&(t.typical>0||t.higher>0||t.lower>=0)}));return e}selectMajorFamily(e){this.datasheet.majorFamilyId=e.detail.value;this.validateDatasheet()}selectFamily(e){this.datasheet.familyId=e.detail.value;this.validateDatasheet()}selectCategory(e){this.datasheet.categoriesId=e.detail.value;this.validateDatasheet()}addProperty(){this.datasheet.properties.push(new p);setTimeout((()=>{this.setPropertyTypeSelect(this.datasheet.properties.length-1)}),100)}async setPropertyTypeSelect(e){const t=this.el.querySelector("#selectPropertyType"+e);if(t){const e={header:h.getTransl("type","Type")};t.interfaceOptions=e;const a=Array.from(t.getElementsByTagName("ion-select-option"));a.map((e=>{t.removeChild(e)}));t.placeholder=h.getTransl("select","Select");r.getDatasheetPropertyTypes().map((e=>{const a=document.createElement("ion-select-option");a.value=e.typeId;a.textContent=h.getTransl(e.typeId,e.typeName);t.appendChild(a)}))}this.validateDatasheet()}selectPropertyType(e,t){this.datasheet.properties[e].type=t.detail.value;this.selectPropertyNameForIndex(e);this.validateDatasheet()}selectPropertyNameForIndex(e){let t=r.getDatasheetPropertyNames();if(t.length==0)t=r.getDatasheetPropertyNames();this.propertyNames[e]=t;this.validateDatasheet()}selectPropertyName(e,t){this.datasheet.properties[e].name=t.detail.value;const a=r.getDatasheetPropertyNames("id",t.detail.value)[0];this.datasheet.properties[e].position=a.position;this.validateDatasheet()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteDatasheet(){try{await r.deleteDatasheet(this.datasheetId);s.dismiss()}catch(e){if(e)f.presentAlertError(e)}}async save(e=true){const t=[];this.datasheet.properties.map((e=>{if(e.type&&e.name){t.push(e)}}));this.datasheet.properties=t;const a=await r.updateDatasheet(this.datasheetId,this.datasheet,this.userProfile.uid);if(!this.datasheetId){this.datasheetId=a.id;if(this.duplicateDatasheet&&this.revision){this.duplicateDatasheet.datasheet.oldProduct=true;await r.updateDatasheet(this.duplicateDatasheet.id,this.duplicateDatasheet.datasheet,this.userProfile.uid)}}e?s.dismiss():this.updateSlider()}async cancel(){return s.dismiss()}render(){return t(a,{key:"ea708aa1d10e9e155e25330f0c91e59a5422c941"},t("app-header-segment-toolbar",{key:"7e16544556d27074e9d51d9a4539db11f4ffc50c",color:b.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"73e9d4117e5f4e59908ad472316e5f4c732fee1f",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},t("swiper-container",{key:"3bc81be823a3f51eaae1e22ac6ef4f529d6b3dd3",class:"slider-edit-datasheet swiper"},t("swiper-wrapper",{key:"58c8e07866fa46c97ee06264077f4867c5fea60c",class:"swiper-wrapper"},t("swiper-slide",{key:"dfaaa20f315d406ba260f15a34a590e745460d8c",class:"swiper-slide"},t("ion-list",{key:"b14111528f4d6097bc0791cf5d335f921b959990",class:"ion-no-padding"},t("app-select-search",{key:"1543d8e9db9311ee8aa6d4005135c78356ea2b89",color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.datasheet&&this.datasheet.majorFamilyId?this.datasheet.majorFamilyId:null,lines:"inset",selectFn:e=>this.selectMajorFamily(e),selectOptions:r.getDatasheetMajorFamilies(),selectValueId:"majorFamilyId",selectValueText:["majorFamilyName"]}),t("app-select-search",{key:"01d74a43b3d46b68d1996cb30de8500424445463",color:"trasteel",label:{tag:"product",text:"Product"},labelAddText:"*",value:this.datasheet&&this.datasheet.familyId?this.datasheet.familyId:null,lines:"inset",selectFn:e=>this.selectFamily(e),selectOptions:r.getDatasheetFamilies(),selectValueId:"familyId",selectValueText:["familyName"]}),t("app-select-search",{key:"51ef1cf81c8a4c9ab82f3b6fac3f354b9bbe3846",color:"trasteel",label:{tag:"category",text:"Category"},labelAddText:"*",value:this.datasheet&&this.datasheet.categoriesId?this.datasheet.categoriesId:null,lines:"inset",selectFn:e=>this.selectCategory(e),selectOptions:r.getDatasheetCategories(),selectValueId:"categoriesId",selectValueText:["categoriesName"]}),t("app-form-item",{key:"87af6e07d5174ee87c0ef9424816e9779965dd94",lines:"inset","label-tag":"tech-no","label-text":"Tech. #",value:this.datasheet.techNo,name:"techNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"c2056412af8d6281c2fdaff75cacaaa6c1e7b6cc",lines:"inset","label-tag":"revision-no","label-text":"Revision #",value:this.datasheet.revisionNo,name:"revisionNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"79942886261c8729e8cf337b0e8d6890a5a5c0e0",lines:"inset","label-tag":"old","label-text":"Old",value:this.datasheet.oldProduct,name:"oldProduct","input-type":"boolean",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"b8ed86c60c2c495edfca9fb5bde33fe3f2ea03f0",lines:"inset","label-tag":"issued-on-date","label-text":"Issued on Date",value:this.datasheet.issuedOnDate,name:"issuedOnDate","input-type":"date","date-presentation":"date","prefer-wheel":false,onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"0e34e33b2bda83683236c699b0f8e4e191e8f843",lines:"inset","label-tag":"product-name","label-text":"Product Name",value:this.datasheet.productName,name:"productName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"3502c60b6d6b847bb18d9910876de756da009a18",lines:"inset","label-tag":"classification","label-text":"Classification",value:this.datasheet.classification,name:"classification","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]}),t("app-form-item",{key:"b19a99d8c1770fba19f3a5f5ab3bf5cb8d87bcd5",lines:"inset","label-tag":"application","label-text":"Application",value:this.datasheet.application,name:"application","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]})),this.datasheetId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteDatasheet()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"822b9ffe424051220ac668b6bb0d924add44f555",class:"swiper-slide"},t("div",{key:"5173063ce8dc62763c79352c9fe358f210e57a15",id:"properties-grid"},t("ion-grid",{key:"7c1ad330035d94aba9436733883756f8c66bc866"},t("ion-row",{key:"47e1fb84350c4b3ecf7e303997846ba61377abbd"},t("ion-col",{key:"9f330f0d233db31b5d109a92452eaf6482f17f13",class:"centered"},t("small",{key:"a8ded280b3441d603964b618033f70fefdff2093"},h.getTransl("type","Type"))),t("ion-col",{key:"56bfdb15214a1bb3a2e7cfa94e06c888f3a38c3c",class:"centered"},t("small",{key:"87ee8c25664af1e708a63804dc9c4798af5ef5b5"},h.getTransl("name","Name"))),t("ion-col",{key:"6b6317a147c754c20415a19af17ee4e9b3f66bbd",class:"centered"},t("small",{key:"27158bafe190ee50948a0cac365016a6610b7331"},h.getTransl("typical","Typical"))),t("ion-col",{key:"85c6b974b4eaa2281dfab97be3ec1849bfb007f7",class:"centered"},t("small",{key:"08936dc7d570b566eabdbdcbb4a824b890d8d330"},h.getTransl("prefix","Prefix"))),t("ion-col",{key:"23e1dbf3ebe5080637340505ec684717f26fe393",class:"centered"},t("small",{key:"e55a798ea3e3a67dc62a158c23fbae17617d4230"},h.getTransl("from","From"))),t("ion-col",{key:"e852345bfc7fb5b52e692d3c72395cb42ba72df6",class:"centered"},t("small",{key:"a0f801f212f5c633535e66b0345e651a5bbda6e6"},h.getTransl("to","To"))),t("ion-col",{key:"f41f13d1637fbd8aa2475b258208dd6058ac51a6",size:"1",class:"centered"},t("small",{key:"bce1245d94b663198e5230125125694728658e8b"},h.getTransl("show","Show")+"/"+h.getTransl("delete","Delete")))),this.datasheet.properties.map(((e,a)=>t("ion-row",null,t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.type?e.type:null,lines:"none",selectFn:e=>this.selectPropertyType(a,e),selectOptions:r.getDatasheetPropertyTypes(),selectValueId:"typeId",selectValueText:["typeName"]})),t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.name?e.name:null,lines:"none",disabled:!this.propertyNames[a],selectFn:e=>this.selectPropertyName(a,e),selectOptions:this.propertyNames[a],selectValueId:"nameId",selectValueText:["nameName"]})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.typical,name:"typical","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.prefix,name:"prefix","input-type":"text",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.lower,name:"lower","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.higher,name:"higher","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{size:"1",class:"centered "},t("ion-grid",{class:"remove-background"},t("ion-row",null,t("ion-col",{class:"centered"},t("app-form-item",{class:"ion-no-padding",value:e.show,name:"show","input-type":"boolean",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("ion-button",{class:"ion-no-padding","icon-only":true,color:"danger",fill:"clear",onClick:()=>this.deleteProperty(a)},t("ion-icon",{name:"trash"}))))))))))),t("io-item",{key:"79f6da1631bc36bcda2f692a9f57fff60e9fb02d"},t("ion-button",{key:"20b68c2880e7419bd62bba1fd17923448cef0fde",expand:"full",shape:"round",color:"trasteel",size:"small",onClick:()=>this.addProperty()},"+"))),t("swiper-slide",{key:"d2d62a5c9b2357b12fbb907c9914697a91b550c7",class:"swiper-slide"},t("ion-list",{key:"a7428523aa197ef3e3542dfdc840fe27523087be"},t("app-form-item",{key:"1bc56de1795fcd04ad28c77f3abeea87ebdfea1c",lines:"inset","label-tag":"producer","label-text":"Producer",value:this.datasheet.producerName,name:"producerName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"0237e76657d4594f6a16c24fc8ac8fc233507fc5",lines:"inset","label-tag":"producer-ref-quality","label-text":"Producer Reference Quality",value:this.datasheet.producerReferenceQuality,name:"producerReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"1439b96f07238cbf5de44b988c37cd643fa66a50",lines:"inset","label-tag":"competitor-ref-quality","label-text":"Competitor Reference Quality",value:this.datasheet.competitorReferenceQuality,name:"competitorReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"e45c71d7b4b9d50ef048124e0d6984adc21a760b",class:"swiper-slide"},t("ion-list",{key:"94a7b325b1f0f2e0ef8c6596c6d42f07aefb2a05"},t("app-form-item",{key:"0860321964357106a3062c81dc88026aab794eca",lines:"inset","label-tag":"comments","label-text":"Comments",value:this.datasheet.comments,name:"comments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"c31f500aca3cef0557a4dd8d828677cc10a9ed29",lines:"inset","label-tag":"performance-comments","label-text":"Performance Comments",value:this.datasheet.performanceComments,name:"performanceComments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"768463184c67fb6da96bb72212f21de3c700bad3",class:"swiper-slide"},"FILES - TO BE DONE")))),t("app-modal-footer",{key:"354b34944fe255a462c7b0d5b8f97c9c26b214e5",color:b.getAppColor(),disableSave:!this.validDatasheet,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=u;export{y as modal_datasheet_update};