import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as n,n as l}from"./p-c2915cc5.js";import{U as s,W as o,T as d,E as r}from"./p-773bd3de.js";import{U as c,a as h,P as f,b as u}from"./p-d2a582b5.js";import{U as p}from"./p-43ef96c1.js";import{l as m}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const b="modal-user-plans-update ion-list{width:100%}";const y=b;const g=class{constructor(t){e(this,t);this.uid=undefined;this.userPlans=new c;this.planIndex=undefined;this.userPlan=new h;this.validPlan=false;this.selectedCustomer=undefined;this.updateView=false}async componentWillLoad(){if(!this.uid)this.uid=s.userProfile.uid;if(this.planIndex>=0){this.userPlan=m.exports.cloneDeep(this.userPlans.userPlans[this.planIndex]);this.selectedCustomer=o.getCustomersDetails(this.userPlan.customerId)}else{this.userPlan=new h}}async componentDidLoad(){this.validatePlan()}async openSelectCustomer(){const e=await o.openSelectCustomer(this.selectedCustomer);if(e){this.userPlan.customerId=e.id;this.selectedCustomer=e}}addAction(){this.userPlan.planOfActions.push(new f);this.validatePlan()}handleOtherChange(e){this.userPlan.otherName=e.detail.value;this.validatePlan()}handleChange(e,t){e[t.detail.name]=t.detail.value;e.updated=(new Date).toISOString();this.validatePlan()}removePlan(e){this.userPlan.planOfActions.splice(e,1);this.validatePlan()}async deletePlan(){const e=await n.create({header:d.getTransl("delete-plan","Delete Plan"),message:d.getTransl("delete-plan-message","This plan will be deleted! Are you sure?"),buttons:[{text:d.getTransl("ok","OK"),handler:async()=>{this.save(true)}},{text:d.getTransl("cancel","Cancel"),handler:async()=>{}}]});e.present()}validatePlan(){this.validPlan=true;this.validPlan=this.validPlan&&(this.userPlan.customerId!=null||this.userPlan.otherName!=null);let e=this.userPlan.planOfActions.length>0;this.userPlan.planOfActions.forEach((t=>{e=e&&t.dueDate!=null;e=e&&t.updated!=null;e=e&&t.product!=null;e=e&&t.plan!=null;e=e&&t.situation!=null}));this.validPlan=this.validPlan&&e;this.updateView=!this.updateView}async save(e=false){if(!this.userPlans.users){this.userPlans.users={};this.userPlans.users[this.uid]=["owner"]}if(this.planIndex>=0&&this.userPlan.planOfActions.length==0){e=true}if(this.planIndex>=0&&!e){this.userPlans.userPlans[this.planIndex]=this.userPlan}else if(e){this.userPlans.userPlans.splice(this.planIndex)}else{this.userPlans.userPlans.push(this.userPlan)}await p.updateUserPlan(this.uid,this.userPlans);l.dismiss()}async cancel(){return l.dismiss()}render(){return t(i,{key:"ff22afa00a5d0108deccfe471afe7731c2f48721"},t("ion-header",{key:"8bfddb082c1727fdbdd5175528a54663939d02a5"},t("ion-toolbar",{key:"8f2dfa6f34278aea2fb0e7df68202b285d14c153",color:"trasteel"},t("ion-title",{key:"9601985338aa918c22371810e201821d3b4e57cb"},t("my-transl",{key:"c5756b5b5d28bb4987f7554d4651c5419fcde2b8",tag:"plan-of-actions",text:"Plan of Actions"})))),t("ion-content",{key:"b257544af054cb215d1cfd92bc80dce128a268f1"},t("ion-list",{key:"1c7a19d9515e4324aafff97acd7169dcb790fbd5"},this.userPlan.otherName==null?t("ion-item",{button:true,lines:"inset",onClick:()=>this.openSelectCustomer()},t("ion-label",null,t("p",{class:"small"},t("my-transl",{tag:"customer",text:"Customer"}),"*"),t("h2",null,this.selectedCustomer?this.selectedCustomer.fullName:null))):undefined,this.userPlan.customerId==null&&this.userPlan.otherName==null?t("ion-item-divider",null,t("ion-label",null,"- or -")):undefined,this.userPlan.customerId==null?t("app-form-item",{lines:"inset","label-tag":"other","label-text":"Other",value:this.userPlan.otherName,name:"otherName","input-type":"string",onFormItemChanged:e=>this.handleOtherChange(e)}):undefined,t("ion-button",{key:"65982f6106dd63ca79e1572f1fa4e0947a2ed046",color:"trasteel",fill:"outline",expand:"full",disabled:this.userPlan.customerId==null&&this.userPlan.otherName==null,onClick:()=>{this.addAction()}},t("ion-icon",{key:"3d79452b146be81c0829f995dab46e908cae375e",name:"add",slot:"start"}),t("ion-label",{key:"bca655809d8163b4e46dedb632a0f30da7152704"},t("my-transl",{key:"d1b4a36525840f8e941a0c6eb503ff3ccf63cb8d",tag:"add-action",text:"Add Action"}))),t("ion-grid",{key:"b49b138188c922b214989c05bd398fdafafe279f"},this.userPlan.planOfActions.map(((e,i)=>[t("ion-row",null,t("ion-col",null,t("ion-select",{color:"trasteel",id:"application",interface:"action-sheet",label:d.getTransl("product","Product"),"label-placement":"floating",onIonChange:t=>{e.product=t.detail.value;this.validatePlan()},value:e.product},Object.keys(u).map((e=>t("ion-select-option",{value:e},u[e]))))),t("ion-col",{size:"3"},t("app-form-item",{lines:"inset","label-tag":"due-date","label-text":"Due Date",value:e.dueDate,name:"dueDate","input-type":"date","date-presentation":"date",onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",{size:"1"},t("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.removePlan(i)},t("ion-icon",{name:"trash",color:"danger"})))),t("ion-row",null,t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"actual-situation","label-text":"Actual Situation",value:e.situation,name:"situation","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"plan","label-text":"Plan",value:e.plan,name:"plan","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]}))),t("ion-row",null,t("ion-item-divider",null))]))),this.userPlan.planOfActions.length>0?t("ion-button",{color:"danger",fill:"outline",expand:"full",onClick:()=>{this.deletePlan()}},t("ion-icon",{name:"trash",slot:"start"}),t("ion-label",null,t("my-transl",{tag:"delete",text:"Delete"}))):undefined)),t("app-modal-footer",{key:"98adac1681f7aae9031bafd45ed75ddf69a2d134",color:r.getAppColor(),disableSave:!this.validPlan,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};g.style=y;export{g as modal_user_plans_update};