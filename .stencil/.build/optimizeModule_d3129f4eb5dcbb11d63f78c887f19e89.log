import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o}from"./p-5d4a8e1f.js";import{S as s}from"./p-a75993af.js";import{U as n,n as c,T as l,J as d,K as r,F as h,S as f,l as m}from"./p-0287979e.js";import{E as b}from"./p-714ce41b.js";import{l as p}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-084d415b.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const u="modal-contact-update ion-list{width:100%}";const y=u;const k=class{constructor(t){e(this,t);this.contactId=undefined;this.contact=undefined;this.customerLocations=[];this.segment="information";this.updateView=true;this.validContact=false;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=n.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.segmentTitles={information:l.getTransl("information","Information")};await this.loadContact()}async loadContact(){if(this.contactId){const e=await d.getContact(this.contactId);this.contact=e}else{this.contact=new r;this.contact.users={[n.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-contact",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.validateContact()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.contact[e.detail.name]=e.detail.value;this.validateContact()}handleInformationChange(){this.validateContact()}selectCustomer(e){this.contact.customerId=e.detail.value;h.getCustomer(e.detail.value).then((e=>{this.customer=e;this.customerLocations=e.locations;this.setLocationsSelect()}));this.validateContact()}selectCustomerLocation(e){this.contact.customerLocationId=e.detail.value;this.validateContact()}setLocationsSelect(){const e=this.el.querySelector("#selectLocation");const t={header:l.getTransl("location","Locations")};e.interfaceOptions=t;const a=Array.from(e.getElementsByTagName("ion-select-option"));a.map((t=>{e.removeChild(t)}));e.placeholder=l.getTransl("select","Select");this.customerLocations.map((t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=l.getTransl(t.type,h.getLocationsTypes(t.type)[0].locationName);e.appendChild(a)}));this.updateSlider()}updateParam(){this.validateContact()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break}}}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.contact.photoURL=a}else{this.contact.coverURL=a}this.save(false)}validateContact(){this.validContact=p.exports.isString(this.contact.firstName)&&p.exports.isString(this.contact.lastName)&&p.exports.isString(this.contact.customerId)}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteContact(){try{await d.deleteContact(this.contactId);o.dismiss()}catch(e){f.presentAlertError(e)}}async save(e=true){const t=await d.updateContact(this.contactId,this.contact,this.userProfile.uid);if(this.contactId){return e?o.dismiss():true}else{this.contactId=t.id;return true}}async cancel(){o.dismiss()}render(){return t(a,{key:"6f6956f65cc2991f8578ff4e9482b0ded558d995"},t("ion-header",{key:"3c6911cdb4e831e2262c3fa983b03f0545fb1409"},t("app-upload-cover",{key:"c2d70938f4ccf1384d3685b9238541a0f9e567d8",item:{collection:m,id:this.contactId,photoURL:this.contact.photoURL,coverURL:this.contact.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-header",{key:"b6d7ce0c8f5c3c1952b55463981ab343d1ef1045"},t("ion-toolbar",{key:"083982c3c46c55b79c6c954e53c157d03cbb7b6d"},t("ion-segment",{key:"de2bb032feffb3313600bd93ade95b29b8d15022",mode:"md",color:b.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},t("ion-segment-button",{key:"b592104b3349ea959e5a38b609d37592a725a44b",value:"information",layout:"icon-start"},t("ion-label",{key:"52a40ce961282e5c50fa29c7f60a388220880d19"},this.segmentTitles.information))))),t("ion-content",{key:"bccdb58b05efd5f53d6cce8a674e49836e0ddc4a",class:"slides"},t("swiper-container",{key:"20195d076230892de3bbf62cefaa0411576825b2",class:"slider-edit-contact swiper"},t("swiper-wrapper",{key:"36196c13d4b5bd9af1f6ee07e1bd0077527b20df",class:"swiper-wrapper"},t("swiper-slide",{key:"c868aba07738b94a6361284f3fe63ad74cecfe74",class:"swiper-slide"},t("ion-list",{key:"93a64ad58ce41260907ca1bb4f9b570c74c64e52",class:"ion-no-padding"},t("ion-list-header",{key:"f84e28a49c896ddff1deeb548b8df3eb0378372d"},t("my-transl",{key:"4fdf7f92502f3bc5bdf472f44672d9f53f0e7492",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"8d184654811f073e7e05365e52d1d4878302df08",lines:"none"},t("ion-select",{key:"3f235eea885f365711135b3c01864c356ed5c91d",color:"trasteel",id:"selectCustomer",interface:"action-sheet",label:l.getTransl("customer","Customer"),"label-placement":"floating",onIonChange:e=>this.selectCustomer(e),value:this.contact&&this.contact.customerId?this.contact.customerId:null},h.customersList.map((e=>t("ion-select-option",{value:e.id},e.fullName))))),t("ion-item",{key:"18e124766d47fcb8d24c728b094f4909e23b7d4b",lines:"none"},t("ion-select",{key:"89c0152d58058407aae37543609a5285aa4a130b",color:"trasteel",id:"selectLocation",interface:"action-sheet",label:l.getTransl("location","Location"),"label-placement":"floating",onIonChange:e=>this.selectCustomerLocation(e),value:this.contact&&this.contact.customerLocationId?this.contact.customerLocationId:null})),t("app-form-item",{key:"b4e9b2a8c2d56b31382146e0d5d4acc34f8ea03f","label-tag":"name","label-text":"Name",value:this.contact.firstName,name:"firstName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"9a1409793ad6d19b14987ef24dbacdc8deee4bcb","label-tag":"surname","label-text":"Surname",value:this.contact.lastName,name:"lastName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"b5388b7fda005272a8d0178b6b9004d408a2f0f1","label-tag":"work-position","label-text":"Work Position",value:this.contact.workPosition,name:"workPosition","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"f9ca371210aea0bdc1704f5ec297dbe845a619e7","label-tag":"office-phone","label-text":"Office Phone",value:this.contact.officePhone,name:"officePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"3c28789bd9e69d1ddad52b6fc1aad9d59676c5e2","label-tag":"mobile-phone","label-text":"Mobile Phone",value:this.contact.mobilePhone,name:"mobilePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"151c80657c33c1765d017fa494964e998ad02b73","label-tag":"email","label-text":"Email",value:this.contact.email,name:"email","input-type":"email","input-form-mode":"email",onFormItemChanged:e=>this.handleChange(e)})),this.contactId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteContact()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined)))),t("app-modal-footer",{key:"f5a766eab5091a14749ccf0ac23202df8b5f78ec",color:b.getAppColor(),disableSave:!this.validContact,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};k.style=y;export{k as modal_contact_update};