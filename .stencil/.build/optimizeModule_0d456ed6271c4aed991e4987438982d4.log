import{r as e,h as t,f as i}from"./p-cbe60c68.js";import{S as a,F as s,R as n,a3 as l,ay as o}from"./p-736235c6.js";import{S as d}from"./p-a75993af.js";import{T as c}from"./p-9a446c6a.js";import{E as r}from"./p-46038295.js";import"./p-1819cfda.js";import"./p-1af05547.js";import"./p-e9c4f463.js";import"./p-c7ee7cfe.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const p="page-customer-details{}";const b=p;const f=class{constructor(t){e(this,t);this.markers=[];this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"locations",text:"Locations",disabled:false},{tag:"operating-conditions",text:"Operating Conditions",disabled:false},{tag:"map",text:"Map",disabled:false}];this.itemId=undefined;this.customer=undefined;this.locationTypeSegment=0;this.slider=undefined}async componentWillLoad(){await this.loadCustomer()}async loadCustomer(){await a.presentLoading("loading");try{this.customer=await s.getCustomer(this.itemId);a.dismissLoading();this.markers=[];if(this.customer.locations.length>0){this.customer.locations.forEach((e=>{if(e.position&&e.position.geopoint){const t={latitude:e.position.geopoint.latitude,longitude:e.position.geopoint.longitude,icon:{type:"ionicon",name:"location",color:"secondary",size:"large"}};this.markers.push(t)}}));if(this.markers.length>0)this.loadMap();this.titles[1].disabled=this.customer.locations.length==0;this.titles[2].disabled=!(this.customer.conditions.EAF.length>0||this.customer.conditions.LF.length>0||this.customer.conditions.CCM.length>0);this.titles[3].disabled=this.customer.locations.length==0||this.markers.length==0}}catch(e){a.dismissLoading();n.goBack();a.presentAlertError(e)}}async componentDidLoad(){this.slider=new d(".slider-customer",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(this.markers.length>0)this.loadMap()}async loadMap(){await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");if(this.mapElement){const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+(l(this.customer)+20)+"px");setTimeout((()=>{this.mapElement.triggerMapResize();this.mapElement.fitToBounds(this.markers)}))}this.updateSlider()}async editCustomer(){const e=await s.presentCustomerUpdate(this.itemId);e.onDidDismiss().then((()=>this.loadCustomer()))}locationTypeSegmentChanged(e){this.locationTypeSegment=e.detail.value;this.updateSlider()}async openOperatingCondition(e,t){await n.openModal("modal-operating-conditions-questionnaire",{condition:e,conditionData:t,editable:false})}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}render(){return[this.customer.coverURL||this.customer.photoURL?t("ion-header",null,t("app-item-cover",{item:this.customer})):undefined,t("ion-header",{key:"ed5c1d4650cce0c47ca266ca11699389faf2612e"},t("app-navbar",{key:"1e425d0bc9fe41cbb56ecc4590485e28bd66d9da",text:this.customer.fullName,color:"trasteel",backButton:this.customer&&!this.customer.coverURL&&!this.customer.photoURL,rightButtonText:c.isCustomerDBAdmin()?{icon:"create",fill:"outline",tag:"edit",text:"Edit"}:null,rightButtonFc:()=>this.editCustomer()})),t("app-header-segment-toolbar",{key:"4d7baccd6bdc306663fa3942f86d012772f03b52",color:r.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"be2ee4ac7878306f74810dea53e4d37dbfec664a",class:"slides"},t("ion-fab",{key:"9cfa04240534101daddf01528ed61b05a447465d",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:o(2)}},t("ion-fab-button",{key:"346ec0bdc0e02047d26b5bb549fc8bd74e212c94",onClick:()=>n.goBack(),class:"fab-icon"},t("ion-icon",{key:"d25fea9a2b485450229a34248ed818e0601958d2",name:"arrow-back-circle-outline"}))),t("swiper-container",{key:"dd824f990a300d9ea1b52a28927f5d5ec5963ed5",class:"slider-customer swiper"},t("swiper-wrapper",{key:"a842e16ef4c08f12056bee1877b4094769704f3c",class:"swiper-wrapper"},t("swiper-slide",{key:"284eceb60a083a431a239e43815c3cfe11c871dd",class:"swiper-slide"},t("ion-list",{key:"4492d2108511f2d912af85b32d202d979d393792",class:"ion-no-padding"},t("app-item-detail",{key:"b422a32b4f7d44c65a87359d4ffecb19d4ee3b65",lines:"none",labelTag:"plant_type",labelText:"Plant Type",detailText:s.getCustomerTypes(this.customer.typeId)[0].typeName}),t("app-item-detail",{key:"7f8036a9b072f1dce8e9f4cba1a28fc47e5b5373",lines:"none",labelTag:"name",labelText:"Name",detailText:this.customer.fullName}),t("app-item-detail",{key:"5e2711bfbc62f5d598956e650c17b8e7f1e92769",lines:"none",labelTag:"local_name",labelText:"Local Name",detailText:this.customer.fullNameOther}),t("app-item-detail",{key:"0410fa00e0487aeacf41f5378e415ea8ec06bb07",lines:"none",labelTag:"other_name",labelText:"Other Name",detailText:this.customer.otherPlantName}),t("app-item-detail",{key:"992cc1026884ddf7517799c71c28145c95597940",lines:"none",labelTag:"other_name",labelText:"Other Local Name",detailText:this.customer.otherPlantNameOther}),t("app-item-detail",{key:"4987811cde544690eb0335b77f95df5185e7de1e",lines:"none",labelTag:"short_name",labelText:"Short Name",detailText:this.customer.shortName}),this.customer.group.map(((e,i)=>t("app-item-detail",{lines:"none",labelTag:i==0?"group":null,labelText:i==0?"Group":null,detailText:e.groupName+" ["+e.groupOwnershipPerc+"%]"}))),t("app-item-detail",{key:"b8bd6ead5b0676148f0a0cf6fb92baca4d180037",lines:"none",labelTag:"owner",labelText:"Owner",detailText:this.customer.owner.groupName}),t("app-customer-plant-production",{key:"d32acad4ad5c6b7dad8bba5d9d397e8812b331d9",customer:this.customer}))),t("swiper-slide",{key:"8c6407a3a02804e963cc11090998f3e87937b01a",class:"swiper-slide"},t("div",{key:"cea4a6efe3408f8788e1f2353e84a565cbe3f154"},this.customer.locations.length>0?[t("ion-toolbar",null,t("ion-segment",{mode:"ios",scrollable:true,onIonChange:e=>this.locationTypeSegmentChanged(e),value:this.locationTypeSegment},this.customer.locations.map(((e,i)=>t("ion-segment-button",{value:i,layout:"icon-start"},t("ion-label",null,s.getLocationsTypes(e.type)[0].locationName)))))),this.customer.locations.map(((e,i)=>t("div",null,this.locationTypeSegment==i?t("div",null,t("app-location",{locations:s.getLocationsTypes(),location:e,slider:this.slider,editable:false})):undefined)))]:undefined)),t("swiper-slide",{key:"7df241b30749a1e5546bf78fc2b18ce511dc3a5c",class:"swiper-slide"},t("ion-list",{key:"4ac6d11ca76280f417c621808c26a7f5cc4c5f2b"},t("ion-item-divider",{key:"d54277914fd7e8b770296a23ff0433f8599127d2"},"EAF"),this.customer.conditions.EAF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"6bb2cd65640966410ea02a337904a4f1bdd30fbe"},"LF"),this.customer.conditions.LF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"688f82c79d082b6c4b70a0c2ad39e314a2e153f3"},"CCM"),this.customer.conditions.CCM.map((e=>t("ion-item",null,t("ion-label",null,new Date(e.date).toLocaleDateString())))))),t("swiper-slide",{key:"77af77b44bebdfcbb0b97e9894fb5902b80665f5",class:"swiper-slide"},this.customer.locations.length>0&&this.markers.length>0?t("div",{id:"map-container"},t("app-map",{id:"map",pageId:"customer-details",center:this.customer.locations[0],markers:this.markers})):t("div",null,t("ion-item",null,"NO MAP AVAILABLE"))))))]}get el(){return i(this)}};f.style=b;export{f as page_customer_details};