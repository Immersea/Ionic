import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as n,o as l}from"./p-5d4a8e1f.js";import{E as s}from"./p-46038295.js";import{U as o,a as d,P as r,b as c}from"./p-d2a582b5.js";import{U as h}from"./p-aabe122a.js";import{U as f,F as u,T as p}from"./p-736235c6.js";import{l as m}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const b="modal-user-plans-update ion-list{width:100%}";const y=b;const g=class{constructor(t){e(this,t);this.uid=undefined;this.userPlans=new o;this.planIndex=undefined;this.userPlan=new d;this.validPlan=false;this.selectedCustomer=undefined;this.updateView=false}async componentWillLoad(){if(!this.uid)this.uid=f.userProfile.uid;if(this.planIndex>=0){this.userPlan=m.exports.cloneDeep(this.userPlans.userPlans[this.planIndex]);this.selectedCustomer=u.getCustomersDetails(this.userPlan.customerId)}else{this.userPlan=new d}}async componentDidLoad(){this.validatePlan()}async openSelectCustomer(){const e=await u.openSelectCustomer(this.selectedCustomer);if(e){this.userPlan.customerId=e.id;this.selectedCustomer=e}}addAction(){this.userPlan.planOfActions.push(new r);this.validatePlan()}handleOtherChange(e){this.userPlan.otherName=e.detail.value;this.validatePlan()}handleChange(e,t){e[t.detail.name]=t.detail.value;e.updated=(new Date).toISOString();this.validatePlan()}removePlan(e){this.userPlan.planOfActions.splice(e,1);this.validatePlan()}async deletePlan(){const e=await n.create({header:p.getTransl("delete-plan","Delete Plan"),message:p.getTransl("delete-plan-message","This plan will be deleted! Are you sure?"),buttons:[{text:p.getTransl("ok","OK"),handler:async()=>{this.save(true)}},{text:p.getTransl("cancel","Cancel"),handler:async()=>{}}]});e.present()}validatePlan(){this.validPlan=true;this.validPlan=this.validPlan&&(this.userPlan.customerId!=null||this.userPlan.otherName!=null);let e=this.userPlan.planOfActions.length>0;this.userPlan.planOfActions.forEach((t=>{e=e&&t.dueDate!=null;e=e&&t.updated!=null;e=e&&t.product!=null;e=e&&t.plan!=null;e=e&&t.situation!=null}));this.validPlan=this.validPlan&&e;this.updateView=!this.updateView}async save(e=false){if(!this.userPlans.users){this.userPlans.users={};this.userPlans.users[this.uid]=["owner"]}if(this.planIndex>=0&&this.userPlan.planOfActions.length==0){e=true}if(this.planIndex>=0&&!e){this.userPlans.userPlans[this.planIndex]=this.userPlan}else if(e){this.userPlans.userPlans.splice(this.planIndex)}else{this.userPlans.userPlans.push(this.userPlan)}await h.updateUserPlan(this.uid,this.userPlans);l.dismiss()}async cancel(){return l.dismiss()}render(){return t(i,{key:"aecb3da9ed110b7451089b825454a7945aa7a667"},t("ion-header",{key:"46c902f181b10ce3b9f8ecd5e5d3806d130d51ea"},t("ion-toolbar",{key:"f5e3e2dd2294103d74006de4c2696622323d143e",color:"trasteel"},t("ion-title",{key:"bc938a0839aa5e6868628c2e517b82276ca7877e"},t("my-transl",{key:"1fbd4bb568524ba28e33dc9027f418e8c4dd9f75",tag:"plan-of-actions",text:"Plan of Actions"})))),t("ion-content",{key:"5ecca3ab4f89e69cf20da8ecac232c018020485a"},t("ion-list",{key:"0a216745ecf772010ed02ff5c7faac40b51f0a1e"},this.userPlan.otherName==null?t("ion-item",{button:true,lines:"inset",onClick:()=>this.openSelectCustomer()},t("ion-label",null,t("p",{class:"small"},t("my-transl",{tag:"customer",text:"Customer"}),"*"),t("h2",null,this.selectedCustomer?this.selectedCustomer.fullName:null))):undefined,this.userPlan.customerId==null&&this.userPlan.otherName==null?t("ion-item-divider",null,t("ion-label",null,"- or -")):undefined,this.userPlan.customerId==null?t("app-form-item",{lines:"inset","label-tag":"other","label-text":"Other",value:this.userPlan.otherName,name:"otherName","input-type":"string",onFormItemChanged:e=>this.handleOtherChange(e)}):undefined,t("ion-button",{key:"dcbba58f7c7bae772fb65d3c1db98613daf0cafe",color:"trasteel",fill:"outline",expand:"full",disabled:this.userPlan.customerId==null&&this.userPlan.otherName==null,onClick:()=>{this.addAction()}},t("ion-icon",{key:"f4881551436a84459c7f827eed7cfd54dfa9c9d1",name:"add",slot:"start"}),t("ion-label",{key:"2b423c8ded6758a3578335218da709c0bd848005"},t("my-transl",{key:"aa4d9a553bfd5977f0bae867af99240bb822b86a",tag:"add-action",text:"Add Action"}))),t("ion-grid",{key:"8505d9da2101fc41af219ef65ffa31325a19fa3b"},this.userPlan.planOfActions.map(((e,i)=>[t("ion-row",null,t("ion-col",null,t("ion-select",{color:"trasteel",id:"application",interface:"action-sheet",label:p.getTransl("product","Product"),"label-placement":"floating",onIonChange:t=>{e.product=t.detail.value;this.validatePlan()},value:e.product},Object.keys(c).map((e=>t("ion-select-option",{value:e},c[e]))))),t("ion-col",{size:"3"},t("app-form-item",{lines:"inset","label-tag":"due-date","label-text":"Due Date",value:e.dueDate,name:"dueDate","input-type":"date","date-presentation":"date",onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",{size:"1"},t("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.removePlan(i)},t("ion-icon",{name:"trash",color:"danger"})))),t("ion-row",null,t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"actual-situation","label-text":"Actual Situation",value:e.situation,name:"situation","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"plan","label-text":"Plan",value:e.plan,name:"plan","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]}))),t("ion-row",null,t("ion-item-divider",null))]))),this.userPlan.planOfActions.length>0?t("ion-button",{color:"danger",fill:"outline",expand:"full",onClick:()=>{this.deletePlan()}},t("ion-icon",{name:"trash",slot:"start"}),t("ion-label",null,t("my-transl",{tag:"delete",text:"Delete"}))):undefined)),t("app-modal-footer",{key:"2840beb6ffc40df5de8cf065208cd67f7173b5b0",color:s.getAppColor(),disableSave:!this.validPlan,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};g.style=y;export{g as modal_user_plans_update};