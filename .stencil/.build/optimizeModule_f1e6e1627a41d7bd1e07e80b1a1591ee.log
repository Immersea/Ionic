import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import{U as s,n as d,q as c,z as n,a9 as o,a3 as r,T as f,R as b,B as l}from"./p-0287979e.js";import"./p-c7ee7cfe.js";import{b as p,o as h}from"./p-5d4a8e1f.js";import{l as m}from"./p-1af05547.js";import{S as y}from"./p-a75993af.js";import{M as u}from"./p-084d415b.js";import{E as k}from"./p-714ce41b.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";import"./p-694b8ade.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-dive-site-update ion-list{width:100%}";const v=g;const w=class{constructor(t){e(this,t);this.stdConfigurations=[];this.diveSiteId=undefined;this.diveSite=undefined;this.segment="map";this.updateView=true;this.validSite=false;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"dive-profiles",text:"Dive Profiles"},{tag:"team"}];this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new c(e);this.stdConfigurations=m.exports.cloneDeep(this.userSettings.userConfigurations)}));await this.loadDiveSite()}async loadDiveSite(){if(this.diveSiteId){this.diveSite=await n.getDiveSite(this.diveSiteId);this.draggableMarkerPosition={lat:this.diveSite.position.geopoint.latitude,lon:this.diveSite.position.geopoint.longitude}}else{this.diveSite=new o;this.diveSite.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}async componentDidLoad(){this.slider=new y(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+r(this.diveSite,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateSite()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#dive-type-select");const t={header:f.getTransl("site-type","Site Type")};e.interfaceOptions=t;e.placeholder=f.getTransl("select","Select");m.exports.each(n.getSiteTypes(),(t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=t.name;e.appendChild(a)}));const a=this.el.querySelector("#entry-type-select");const i={header:f.getTransl("entry-type","Entry Type")};a.interfaceOptions=i;a.placeholder=f.getTransl("select","Select");m.exports.each(n.getEntryTypes(),(e=>{const t=document.createElement("ion-select-option");t.value=e.type;t.textContent=e.name;a.appendChild(t)}));const s=this.el.querySelector("#seabed-comp-select");const d={header:f.getTransl("seabed-comp","Seabed Composition")};s.interfaceOptions=d;s.placeholder=f.getTransl("select","Select");m.exports.each(n.getSeabedCompositions(),(e=>{const t=document.createElement("ion-select-option");t.value=e.type;t.textContent=e.name;s.appendChild(t)}));const c=this.el.querySelector("#seabed-cover-select");const o={header:f.getTransl("seabed-cover","Seabed Cover")};c.interfaceOptions=o;c.placeholder=f.getTransl("select","Select");m.exports.each(n.getSeabedCovers(),(e=>{const t=document.createElement("ion-select-option");t.value=e.type;t.textContent=e.name;c.appendChild(t)}))}updateLocation(e){this.draggableMarkerPosition={lat:m.exports.toNumber(e.detail.lat),lon:m.exports.toNumber(e.detail.lon)};this.diveSite.position=u.getPosition(e.detail.lat,e.detail.lon);this.validateSite()}updateAddress(e){this.diveSite.setAddress(e.detail)}handleChange(e){this.diveSite[e.detail.name]=e.detail.value;this.validateSite()}handleInformationChange(e){switch(e.detail.name){case"minDepth":this.diveSite.information.minDepth=m.exports.toNumber(e.detail.value);break;case"maxDepth":this.diveSite.information.maxDepth=m.exports.toNumber(e.detail.value);break;case"waterTemp.spring":this.diveSite.information.waterTemp.spring=e.detail.value;break;case"waterTemp.summer":this.diveSite.information.waterTemp.summer=e.detail.value;break;case"waterTemp.autumn":this.diveSite.information.waterTemp.autumn=e.detail.value;break;case"waterTemp.winter":this.diveSite.information.waterTemp.winter=e.detail.value;break;default:this.diveSite.information[e.detail.name]=e.detail.value}this.validateSite()}updateParam(e,t){let a=t.detail.value;switch(e){case"type":this.diveSite.type=a;break;case"entryType":this.diveSite.information.entryType=a;break;case"seabedComposition":this.diveSite.information.seabedComposition=a;break;case"seabedCover":this.diveSite.information.seabedCover=a;break}this.validateSite()}async addDivePlan(){let e=[];m.exports.forEach(this.stdConfigurations,((t,a)=>{e.push({type:"radio",label:t.stdName,value:a,checked:a==0?true:false})}));const t=await p.create({header:f.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:f.getTransl("ok","OK"),handler:e=>{this.addDivePlanWithConf(this.stdConfigurations[e])}},{text:f.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});t.present()}async addDivePlanWithConf(e){const t=await b.openModal("modal-dive-template",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,dive:0,user:this.userProfile});t.onDidDismiss().then((e=>{const t=e.data;if(t){t.dives[0].diveSiteId=this.diveSiteId;this.diveSite.divePlans.push(t);this.updateView=!this.updateView}}))}async viewDivePlan(e,t){this.diveSite.divePlans[t]=e.detail;this.updateView=!this.updateView}async removeDivePlan(e){this.diveSite.divePlans.splice(e,1);this.updateView=!this.updateView}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.diveSite.photoURL=a}else{this.diveSite.coverURL=a}}validateSite(){this.validSite=m.exports.isNumber(this.diveSite.position.geopoint.latitude)&&m.exports.isNumber(this.diveSite.position.geopoint.longitude)&&m.exports.isString(this.diveSite.type)&&m.exports.isString(this.diveSite.information.entryType)&&m.exports.isString(this.diveSite.description)&&this.diveSite.information.minDepth>0&&this.diveSite.information.maxDepth>0}async save(){await n.updateDiveSite(this.diveSiteId,this.diveSite,this.userProfile.uid);return h.dismiss()}async cancel(){return h.dismiss()}render(){return t(a,{key:"86eba1f32d5e9c515ee7bfee6289982d9df48257"},t("ion-header",{key:"0f14a524a2b5f815e8ce2177e6f31954972086f8"},t("app-upload-cover",{key:"1a1f5593587801f55baca2277b71ebf68329fd97",item:{collection:l,id:this.diveSiteId,photoURL:this.diveSite.photoURL,coverURL:this.diveSite.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("app-header-segment-toolbar",{key:"4009ed8050419c97d17734ce70979191b39c5d1e",color:k.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"0ea5d8e7e004b2725b5d33e063a783d6321929b2",class:"slides"},t("swiper-container",{key:"3a7824302bcc6afe50bed05bdfb3be78b2970eae",class:"slider-dive-site swiper"},t("swiper-wrapper",{key:"89ec2df3d0cbf3d18a10d673f746959cc0bf12a1",class:"swiper-wrapper"},t("swiper-slide",{key:"d7da23aa4836b1b5bdd25a443760b8b91ad0021e",class:"swiper-slide"},t("div",{key:"b50e0b3807a4de0fb54af626a6b74f25122c2a87",id:"map-container"},t("app-map",{key:"1b59ee1277fefde0bc9cd94011c10fcbc418dd08",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),t("swiper-slide",{key:"8f66a02870a9fac656ee894e079390ffac771eca",class:"swiper-slide"},t("app-coordinates",{key:"d6cfe6f1946437882b806999de92790691e7d54d",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),t("swiper-slide",{key:"7070b094d1aca50eaf918d9412a8faace0adad22",class:"swiper-slide"},t("ion-list",{key:"8d79e61f476c521dab50a84ebfa994bd82538820",class:"ion-no-padding"},t("ion-list-header",{key:"21ce8dfb9286d46ca67ada7f65c8296fd23f26b5"},t("my-transl",{key:"c7e96165ea52896ec029d97eca025f1e789bdf34",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"d1bddc8fed3d293ad6cf36529ca56d307dcbe479"},t("ion-label",{key:"23d969ad2646993c99fc29320af036911ad4dbfd"},t("my-transl",{key:"5717c66be7194df1987cbc107e3f6b208a186ac5",tag:"site-type",text:"Site Type"})),t("ion-select",{key:"64fd5dd2f0ba6c70008963d77cbc0964497ffd50",id:"dive-type-select",onIonChange:e=>this.updateParam("type",e),value:this.diveSite.type})),t("ion-item",{key:"ed959ea4265667128f9e5d3e1b7479659aeaa918"},t("ion-label",{key:"15e33d53057a46229b354b099680a65d5a639bab"},t("my-transl",{key:"02642691d5de4472788e8032d6b339b728be57f4",tag:"entry-type",text:"Entry Type"})),t("ion-select",{key:"223adf1d8308b819a943d21843a928ddc4c9ab45",id:"entry-type-select",onIonChange:e=>this.updateParam("entryType",e),value:this.diveSite.information.entryType})),t("app-form-item",{key:"2e290fc3af4df89b8bc6ae10516324d4b3372f2e","label-tag":"name","label-text":"Name",value:this.diveSite.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"df172bc2841cbbf827c9fe28aa5a07360fe60ae2","label-tag":"description","label-text":"Description",value:this.diveSite.description,name:"description",textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-list-header",{key:"0363369784a674ac71f398283c547325bc680c98"},t("ion-label",{key:"427740fca44df2d89f19b689e93e78fcb903b139"},t("my-transl",{key:"c5a707f2ec25d7339bdeacff5d7ed1a5c6539a10",tag:"site-details",text:"Site Details"}))),t("ion-grid",{key:"c92f681fa34fbc6d93fb786a2cec1cd27889963a",class:"ion-no-padding"},t("ion-row",{key:"c007fd20127d1ee9fb1e76d95b0a6fe52333d55c"},t("ion-col",{key:"86d23e87ae33194a3fc40b37b6b55452555b6dbd"},t("app-form-item",{key:"0616dae2309b39fce1aede0f86ed4b0abfec04e6","label-tag":"min-depth","label-text":"Min. Depth","append-text":" (m)",value:m.exports.toString(this.diveSite.information.minDepth),name:"minDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})),t("ion-col",{key:"e2e0a29e0f5bff4cf3aaecf9a8a8e2f702c070ce"},t("app-form-item",{key:"8e27f696170ff6deb175ed3a105965908cd124c2","label-tag":"max-depth","label-text":"Max. Depth","append-text":" (m)",value:m.exports.toString(this.diveSite.information.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})))),t("app-form-item",{key:"a075c3d80c8eaef414f464105c630a91f824f5d5","label-tag":"avg-vis","label-text":"Average Visibility","append-text":" (m)",value:m.exports.toString(this.diveSite.information.avgViz),name:"avgViz","input-type":"text",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}),t("ion-list-header",{key:"4ee9ee0660dd50adae891f39f385efc745cff64e"},t("my-transl",{key:"c1f7dcb4fc6ae2ce4bf85306ecbd8d7f150318f7",tag:"water-temp",text:"Water Temperature","append-text":" (°C)",isLabel:true})),t("ion-grid",{key:"df4b502c17b4ba934989cdccfdedfa916712951b",class:"ion-no-padding"},t("ion-row",{key:"4c0872a42ec57f757c4d871d0e2a4bb325fa15bd"},t("ion-col",{key:"de791ede9b1b88bc30731d269655bff2555d1433"},t("app-form-item",{key:"219489b0e4c68b31ca3dc27003c396820e110d24","label-tag":"spring","label-text":"Spring",value:m.exports.toString(this.diveSite.information.waterTemp.spring),name:"waterTemp.spring","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),t("ion-col",{key:"3528da32aa23e6f926b773a689b2cb016f7dc87d"},t("app-form-item",{key:"47ae2e9c1dbd1f6b598234ac51d7768a37c96ae2","label-tag":"summer","label-text":"Summer",value:m.exports.toString(this.diveSite.information.waterTemp.summer),name:"waterTemp.summer","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}))),t("ion-row",{key:"b746e1fc2051f8664060c0d0eed60004a0e02bdc"},t("ion-col",{key:"7007bfb26baf904894886ee840d03e6f1576f2b8"},t("app-form-item",{key:"057523e71eb5394fc38574e3dec84161f9ed909e","label-tag":"autumn","label-text":"Autumn",value:m.exports.toString(this.diveSite.information.waterTemp.autumn),name:"waterTemp.autumn","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),t("ion-col",{key:"805544bbe1f945f035b4ff3fd93c2f58bc0eb691"},t("app-form-item",{key:"0457360fe89676cdcf76c0631075de8fbbfac327","label-tag":"winter","label-text":"Winter",value:m.exports.toString(this.diveSite.information.waterTemp.winter),name:"waterTemp.winter","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})))),t("ion-item",{key:"771cbc166eed8ca9754b05267ec6bc270effe36c"},t("ion-label",{key:"4b1280d9f0456cc23b1fe1c76bb7b4f0fe7f4bd6"},t("my-transl",{key:"eb854a56ff21647956cd638226ddeaba7ef90299",tag:"seabed-comp",text:"Seabed Composition"})),t("ion-select",{key:"ad5f5fc3a923e17d605bd5edd5620046cccc2223",id:"seabed-comp-select",multiple:true,onIonChange:e=>this.updateParam("seabedComposition",e),value:this.diveSite.information.seabedComposition})),t("ion-item",{key:"2e0630e9ad64e1f537de1bbd121109d74ae9faf6"},t("ion-label",{key:"40ec2833bbef06386656c0768c2c0463e3fcfe92"},t("my-transl",{key:"3bcb1242f3ca789ce4fd26eec3f8506ed4e6f3fe",tag:"seabed-cover",text:"Seabed Cover"})),t("ion-select",{key:"c236aa0b0ca5b78a8b565224f83f9bce8606606e",id:"seabed-cover-select",multiple:true,onIonChange:e=>this.updateParam("seabedCover",e),value:this.diveSite.information.seabedCover})))),t("swiper-slide",{key:"9defd75a2169f1807b450a96d1317bf1c83f5eb3",class:"swiper-slide"},t("ion-grid",{key:"9ed52355d06c09c6b84bc35206986c577e0364d2"},t("ion-row",{key:"843533880920be8f55813eeaf46d8ead551992f8",class:"ion-text-start"},this.diveSite.divePlans.map(((e,a)=>t("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},t("app-dive-plan-card",{divePlan:e,edit:true,onViewEmit:e=>this.viewDivePlan(e,a),onRemoveEmit:()=>this.removeDivePlan(a)})))),t("ion-col",{key:"2af93dd4fe9cd963cfe7062d17775c88b16d18ed","size-sm":"12","size-md":"6","size-lg":"4"},t("ion-card",{key:"82eba782162493166570b953ca27420adf738337",onClick:()=>this.addDivePlan()},t("ion-card-content",{key:"6d7b246878ed737d004091f9a0fc1d246982463a",class:"ion-text-center"},t("ion-icon",{key:"eb3b5c8fc72f034b77b0ada40cc3ddea38f72013",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),t("swiper-slide",{key:"f86443c6c3a5e8f5a3f13ab5cf08e454acc74a32",class:"swiper-slide"},t("app-users-list",{key:"e5d664de1944a24307b4cb02cdb0d29e5cc4ad62",item:this.diveSite,editable:true,show:["owner","editor"]}))))),t("app-modal-footer",{key:"e455f02f9c7041a5357224550feb824bcf0f86d8",disableSave:!this.validSite,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};w.style=v;export{w as modal_dive_site_update};