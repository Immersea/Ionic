import{r as e,h as i}from"./p-cbe60c68.js";import{S as t}from"./p-a75993af.js";import{U as a}from"./p-8ad57864.js";import{U as s,a as n,b as l}from"./p-d2a582b5.js";import{U as o,F as d}from"./p-30358c9d.js";import{T as c}from"./p-87afedc7.js";import{l as r}from"./p-1af05547.js";import{E as p}from"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const f="page-user-plans{}";const h=f;const u=class{constructor(i){e(this,i);this.titles=[{tag:"personal",text:"Personal",disabled:false},{tag:"team",text:"Team",disabled:false}];this.usersList=[];this.uid=undefined;this.userPlans=undefined;this.slider=undefined;this.usersTeams=undefined;this.selectedUser=undefined;this.updateView=false}async componentWillLoad(){await this.loadUserPlans()}async loadUserPlans(){if(this.uid){let e=new s(await a.getPlansOfUser(this.uid));this.userPlans=new s;this.userPlans.users=e.users;e.userPlans.map((e=>{const i=new n;i.customerId=e.customerId;i.otherName=e.otherName;i.planOfActions=[];e.planOfActions.map((e=>{if(e.product=="refractories"&&c.isRefraTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="electrodes"&&c.isElecTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="engineering"&&c.isEngTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="rawmaterials"&&c.isRawTeamAdmin()){i.planOfActions.push(e)}}));if(i.planOfActions.length>0){this.userPlans.userPlans.push(i)}}));this.selectedUser=await o.getPublicProfileUserDetails(this.uid);this.updateSlider()}else{this.userPlansSub=a.userPlans$.subscribe((e=>{this.userPlans=e;this.updateSlider()}));c.isTeamAdmin()?this.usersListSub=o.userPublicProfilesList$.subscribe((e=>{this.usersList=e;this.updateSlider()})):undefined}}disconnectedCallback(){if(this.uid);else{c.isTeamAdmin()?this.usersListSub.unsubscribe():undefined;this.userPlansSub.unsubscribe()}}async componentDidLoad(){this.slider=new t(".slider-plans"+this.uid,{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(!this.uid&&c.isTeamAdmin()){this.usersTeams=await c.getUsersTeams()}}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editPlan(e){const i=await a.presentUserPlansUpdate(this.uid,this.userPlans,e);i.onDidDismiss().then((()=>{if(this.uid)this.loadUserPlans()}))}renderTeam(){if(this.usersTeams&&this.usersTeams.usersTeams&&this.usersTeams.usersTeams.length>0){const e={};this.usersTeams.usersTeams.map((i=>{if(i.uid!==o.userProfile.uid){e[i.uid]=true}}));let t=[];Object.keys(e).map((e=>{t.push(this.usersList.find((i=>i.uid==e)))}));t=r.exports.orderBy(t,"displayName");return t.length>0?[t.map((e=>[i("ion-item",{button:true,onClick:()=>a.openUsersPlans(e.uid)},e.displayName+" - "+e.email)]))]:null}else return null}render(){return[i("ion-header",{key:"727042beaff5cfec2f5e5ab774a577ffbb3f12c7"},i("app-navbar",{key:"d1d93816f4009b6a36c98858313e7bc492dc56de",tag:this.uid==null?"plan-of-actions":null,text:this.uid==null?"Plan of Actions":"Plan of Actions - "+this.selectedUser.displayName,color:p.getAppColor(),backButton:this.uid!=null})),!this.uid&&c.isTeamAdmin()?i("app-header-segment-toolbar",{color:p.getAppColor(),swiper:this.slider,titles:this.titles}):undefined,i("ion-content",{key:"2edbee6338f722abaa2b18c04b0ac40a12d46f1b",class:"slides"},i("ion-fab",{key:"d282f5061d3033758d5a3114e98ea0381f8ed7cf",vertical:"top",horizontal:"end",slot:"fixed",edge:true},i("ion-fab-button",{key:"0fc263f393fd56e7dd308a58ea6b0a3676bf18d9",size:"small",onClick:()=>this.editPlan(),color:p.getAppColor()},i("ion-icon",{key:"4a12f6760aaaf7b6321c940ace2623fcf8d21b46",name:"add"}))),i("swiper-container",{key:"86c9b56ca37b482c41fc07ed1467cdcaa2292af4",class:"slider-plans"+this.uid+" swiper"},i("swiper-wrapper",{key:"ed82aeb2fc6c4028b923b714175b7078aecc4356",class:"swiper-wrapper"},i("swiper-slide",{key:"732988133830101435eeaa88a1428d1c60732186",class:"swiper-slide"},i("div",{key:"57079610df8b3f26dcfc5b20936d9512e655aa8b",class:"ion-padding-top"}),this.userPlans&&this.userPlans.userPlans&&this.userPlans.userPlans.length>0?this.userPlans.userPlans.map(((e,t)=>[i("ion-item",{button:true,onClick:()=>this.editPlan(t)},i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("ion-item-divider",{color:"trasteel"},e.customerId!=null?d.getCustomersDetails(e.customerId).fullName:e.otherName))),e.planOfActions.map((e=>[i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"product","label-text":"Product",detailText:l[e.product]})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"updated","label-text":"Updated",detailText:new Date(e.updated).toLocaleDateString()})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"due-date","label-text":"Due Date",detailText:new Date(e.dueDate).toLocaleDateString()}))),i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"actual-situation","label-text":"Actual Situation",detailText:e.situation})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"plan","label-text":"Plan",detailText:e.plan}))),i("ion-row",{class:"ion-no-padding"},i("ion-item-divider",null))]))))])):i("ion-item",null,i("ion-label",null,"Insert a new plan of actions"))),!this.uid&&c.isTeamAdmin()?i("swiper-slide",{class:"swiper-slide"},i("ion-list",null,this.renderTeam())):undefined)))]}};u.style=h;export{u as page_user_plans};