import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as n,o as l}from"./p-5d4a8e1f.js";import{E as s}from"./p-46038295.js";import{U as o,a as d,P as r,b as h}from"./p-d2a582b5.js";import{U as c}from"./p-772b22eb.js";import{U as f,F as u,T as p}from"./p-83f44900.js";import{l as m}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const b="modal-user-plans-update ion-list{width:100%}";const y=b;const g=class{constructor(t){e(this,t);this.uid=undefined;this.userPlans=new o;this.planIndex=undefined;this.userPlan=new d;this.validPlan=false;this.selectedCustomer=undefined;this.updateView=false}async componentWillLoad(){if(!this.uid)this.uid=f.userProfile.uid;if(this.planIndex>=0){this.userPlan=m.exports.cloneDeep(this.userPlans.userPlans[this.planIndex]);this.selectedCustomer=u.getCustomersDetails(this.userPlan.customerId)}else{this.userPlan=new d}}async componentDidLoad(){this.validatePlan()}async openSelectCustomer(){const e=await u.openSelectCustomer(this.selectedCustomer);if(e){this.userPlan.customerId=e.id;this.selectedCustomer=e}}addAction(){this.userPlan.planOfActions.push(new r);this.validatePlan()}handleOtherChange(e){this.userPlan.otherName=e.detail.value;this.validatePlan()}handleChange(e,t){e[t.detail.name]=t.detail.value;e.updated=(new Date).toISOString();this.validatePlan()}removePlan(e){this.userPlan.planOfActions.splice(e,1);this.validatePlan()}async deletePlan(){const e=await n.create({header:p.getTransl("delete-plan","Delete Plan"),message:p.getTransl("delete-plan-message","This plan will be deleted! Are you sure?"),buttons:[{text:p.getTransl("ok","OK"),handler:async()=>{this.save(true)}},{text:p.getTransl("cancel","Cancel"),handler:async()=>{}}]});e.present()}validatePlan(){this.validPlan=true;this.validPlan=this.validPlan&&(this.userPlan.customerId!=null||this.userPlan.otherName!=null);let e=this.userPlan.planOfActions.length>0;this.userPlan.planOfActions.forEach((t=>{e=e&&t.dueDate!=null;e=e&&t.updated!=null;e=e&&t.product!=null;e=e&&t.plan!=null;e=e&&t.situation!=null}));this.validPlan=this.validPlan&&e;this.updateView=!this.updateView}async save(e=false){if(!this.userPlans.users){this.userPlans.users={};this.userPlans.users[this.uid]=["owner"]}if(this.planIndex>=0&&this.userPlan.planOfActions.length==0){e=true}if(this.planIndex>=0&&!e){this.userPlans.userPlans[this.planIndex]=this.userPlan}else if(e){this.userPlans.userPlans.splice(this.planIndex)}else{this.userPlans.userPlans.push(this.userPlan)}await c.updateUserPlan(this.uid,this.userPlans);l.dismiss()}async cancel(){return l.dismiss()}render(){return t(i,{key:"4cd1f08a50ba50d676ba736821cfb95ad976d6e3"},t("ion-header",{key:"24974f52994e212032727d86b78687470b0e4ab9"},t("ion-toolbar",{key:"286b372a238d09faaa2fbc668f3f9635ed62e5f6",color:"trasteel"},t("ion-title",{key:"992cd49623402ef2a60e9dbcaa92e6f89265797d"},t("my-transl",{key:"0f81ef455c998f84b81e896519ff658c7edd2fa5",tag:"plan-of-actions",text:"Plan of Actions"})))),t("ion-content",{key:"33ea8d4acb88f7025a1696e39299148c593931ab"},t("ion-list",{key:"0f6ada81455e784c123c3a142a6172824f951970"},this.userPlan.otherName==null?t("ion-item",{button:true,lines:"inset",onClick:()=>this.openSelectCustomer()},t("ion-label",null,t("p",{class:"small"},t("my-transl",{tag:"customer",text:"Customer"}),"*"),t("h2",null,this.selectedCustomer?this.selectedCustomer.fullName:null))):undefined,this.userPlan.customerId==null&&this.userPlan.otherName==null?t("ion-item-divider",null,t("ion-label",null,"- or -")):undefined,this.userPlan.customerId==null?t("app-form-item",{lines:"inset","label-tag":"other","label-text":"Other",value:this.userPlan.otherName,name:"otherName","input-type":"string",onFormItemChanged:e=>this.handleOtherChange(e)}):undefined,t("ion-button",{key:"260f6c6d4a5f14bb2ed316758a81806497f6496d",color:"trasteel",fill:"outline",expand:"full",disabled:this.userPlan.customerId==null&&this.userPlan.otherName==null,onClick:()=>{this.addAction()}},t("ion-icon",{key:"2e2b43b88516680f4249e179cf73ceda3cc78231",name:"add",slot:"start"}),t("ion-label",{key:"532fb07911822ee33554d66da9299440b3d91e86"},t("my-transl",{key:"e6a4e95835cb97dcac3a640927a96016f545acd2",tag:"add-action",text:"Add Action"}))),t("ion-grid",{key:"1b5a1af7b9fc38333d91021c6d0c1f4fc65baefe"},this.userPlan.planOfActions.map(((e,i)=>[t("ion-row",null,t("ion-col",null,t("ion-select",{color:"trasteel",id:"application",interface:"action-sheet",label:p.getTransl("product","Product"),"label-placement":"floating",onIonChange:t=>{e.product=t.detail.value;this.validatePlan()},value:e.product},Object.keys(h).map((e=>t("ion-select-option",{value:e},h[e]))))),t("ion-col",{size:"3"},t("app-form-item",{lines:"inset","label-tag":"due-date","label-text":"Due Date",value:e.dueDate,name:"dueDate","input-type":"date","date-presentation":"date",onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",{size:"1"},t("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.removePlan(i)},t("ion-icon",{name:"trash",color:"danger"})))),t("ion-row",null,t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"actual-situation","label-text":"Actual Situation",value:e.situation,name:"situation","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"plan","label-text":"Plan",value:e.plan,name:"plan","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]}))),t("ion-row",null,t("ion-item-divider",null))]))),this.userPlan.planOfActions.length>0?t("ion-button",{color:"danger",fill:"outline",expand:"full",onClick:()=>{this.deletePlan()}},t("ion-icon",{name:"trash",slot:"start"}),t("ion-label",null,t("my-transl",{tag:"delete",text:"Delete"}))):undefined)),t("app-modal-footer",{key:"83bd8d9851644de6b14ef226643857f05e40ad2f",color:s.getAppColor(),disableSave:!this.validPlan,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};g.style=y;export{g as modal_user_plans_update};