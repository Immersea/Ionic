import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as o,o as n}from"./p-5d4a8e1f.js";import{S as s}from"./p-a75993af.js";import{U as d,n as c,F as l,L as r,T as f,O as b,R as h,S as m,C as u}from"./p-30358c9d.js";import{P as p,a9 as y,aa as k,ab as C}from"./p-2578d979.js";import{E as w}from"./p-a9f4af61.js";import{l as g}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";const v="modal-customer-update ion-list{width:100%}";const x=v;const L=class{constructor(t){e(this,t);this.saveNewOwner=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"locations",text:"Locations",disabled:false},{tag:"operating-conditions",text:"Operating Conditions",disabled:false}];this.customerId=undefined;this.customer=undefined;this.updateView=true;this.validCustomer=false;this.locationTypeSegment="add";this.slider=undefined}async componentWillLoad(){this.userProfileSub$=d.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));await this.loadCustomer()}async loadCustomer(){if(this.customerId){const e=await l.getCustomer(this.customerId);this.customer=e;if(this.customer.locations.length>0)this.locationTypeSegment=0}else{this.customer=new r;this.customer.users={[d.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-customer",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setTypesSelect();this.validateCustomer()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.customer[e.detail.name]=e.detail.value;this.validateCustomer()}handleInformationChange(){this.validateCustomer()}updateParam(){this.validateCustomer()}updateImageUrls(e){const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.customer.photoURL=i}else{this.customer.coverURL=i}this.save(false)}validateCustomer(){let e=true;this.customer.locations.forEach((t=>{if(t&&t.position)e=e&&g.exports.isNumber(t.position.geopoint.latitude)&&g.exports.isNumber(t.position.geopoint.longitude)}));this.validCustomer=e&&g.exports.isString(this.customer.fullName)&&this.customer.typeId!=null}addLocation(){this.customer.locations.push(new p);this.locationTypeSegment=this.customer.locations.length-1;this.updateSlider()}updateLocation(){this.updateSlider()}deleteLocation(e){this.customer.locations.splice(e,1);this.updateSlider()}setTypesSelect(){const e=this.el.querySelector("#selectType");const t={header:f.getTransl("customer_type","Customer Type")};e.interfaceOptions=t;const i=Array.from(e.getElementsByTagName("ion-select-option"));i.map((t=>{e.removeChild(t)}));e.placeholder=f.getTransl("select","Select");l.getCustomerTypes().map((t=>{const i=document.createElement("ion-select-option");i.value=t.typeId;i.textContent=f.getTransl(t.typeId,t.typeName);e.appendChild(i)}))}selectType(e){this.customer.typeId=e.detail.value;this.validateCustomer()}locationTypeSegmentChanged(e){if(e.detail.value!=="add"){this.locationTypeSegment=e.detail.value;this.updateView=!this.updateView;this.updateSlider()}}selectOwner(e){this.customer.owner=e.detail.value;this.validateCustomer()}selectGroupOwner(e,t){this.customer.group[t]=e.detail.value;this.validateCustomer()}async editOwner(e,t,i){let a=new b;if(e){if(t>=0){a=this.customer.group[t];if(i){this.customer.group.splice(t,1)}}}else{a=this.customer.owner}if(!i){const i=await o.create({component:"popover-edit-customer-owner",translucent:true,componentProps:{owner:a,group:e}});i.onDidDismiss().then((async i=>{const a=i.data;if(a){if(e){if(t>=0){this.customer.group[t]=a.owner}else{this.customer.group.push(a.owner)}}else{this.customer.owner=a.owner}this.saveNewOwner=a.new;this.updateSlider()}}));i.present()}this.updateSlider()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editOperatingCondition(e,t){const i=await h.openModal("modal-operating-conditions-questionnaire",{condition:e,conditionData:g.exports.cloneDeep(t),editable:true});i.onDidDismiss().then((i=>{i=i.data;if(i&&t){if(e=="EAF")t=new y(i);else if(e=="LF")t=new k(i);else if(e=="CCM")t=new C(i);this.updateSlider()}else if(i){if(e=="EAF")this.customer.conditions.EAF.push(new y(i));else if(e=="LF")this.customer.conditions.LF.push(new k(i));else if(e=="CCM")this.customer.conditions.CCM.push(new C(i));this.updateSlider()}}))}async deleteCustomer(){try{await l.deleteCustomer(this.customerId);n.dismiss()}catch(e){if(e)m.presentAlertError(e)}}async save(e=true){const t=await l.updateCustomer(this.customerId,this.customer,this.userProfile.uid);if(this.customerId){return e?n.dismiss():true}else{this.customerId=t.id;return true}}async cancel(){n.dismiss()}render(){return t(i,{key:"29b1266b45d816e0de7853e5a70217142f086412"},t("ion-header",{key:"9b8b116c18b097b604634a47ba2d7bde2bf2b986"},t("app-upload-cover",{key:"665d3aad1a92a6e06331da8b60ed32bc60bd486e",item:{collection:u,id:this.customerId,photoURL:this.customer.photoURL,coverURL:this.customer.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("app-header-segment-toolbar",{key:"fd3275627d13f1d31537a72d1d1becf142d5038d",color:w.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"ead450eec3d6bfe9a4da40d701a40910882c344f",class:"slides"},t("swiper-container",{key:"79a7004a9af683dccd4ee9beb2fb39cc71bd7f68",class:"slider-edit-customer swiper"},t("swiper-wrapper",{key:"96402975215312d61b7f7f4e4f79fb0343df92f3",class:"swiper-wrapper"},t("swiper-slide",{key:"c7b822c614ee81d5c8cc6a3840227488d8873bfd",class:"swiper-slide"},t("ion-list",{key:"f564571f4e1a3dd637d49b47edbaa1d46a8d6161",class:"ion-no-padding"},t("ion-item",{key:"9d5c1af86c7071cac86dd8b29302c4cbf00d9a6a",lines:"none"},t("ion-select",{key:"6d2f4fc6cbcf6b607b9cb83ca79ebf4e5705c367",color:"trasteel",id:"selectType",interface:"action-sheet",label:f.getTransl("customer_type","Customer Type"),"label-placement":"floating",onIonChange:e=>this.selectType(e),value:this.customer&&this.customer.typeId?this.customer.typeId:null})),t("app-form-item",{key:"fedee110a21bb185345eb09a56fff057c02f4bcb","label-tag":"name","label-text":"Name",value:this.customer.fullName,name:"fullName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"aafd0047f9c6eb51c30846a74f30cd843a99a4bc","label-tag":"local_name","label-text":"Local Name",value:this.customer.fullNameOther,name:"fullNameOther","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"d3d0619a82c61538c3fd66166fbedefd84cdfeb2",labelTag:"other_name",labelText:"Other Name",value:this.customer.otherPlantName,name:"otherPlantName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"47c7ae12f10a11238d30285e557a789c894691b6",labelTag:"other_name",labelText:"Other Local Name",value:this.customer.otherPlantNameOther,name:"otherPlantNameOther","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"fb1b5702506faf78ef6adb6cadf298901b5b857a",labelTag:"short_name",labelText:"Short Name",value:this.customer.shortName,name:"shortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),this.customer.group.length==0?t("ion-item",{lines:"none"},t("ion-label",null,t("h2",null,t("my-transl",{tag:"add_customer_group",text:"Add Customer Group"}))),t("ion-button",{onClick:()=>this.editOwner(true),slot:"end"},"+")):undefined,this.customer.group.map(((e,i)=>t("ion-item",{lines:"none"},t("ion-label",null,i==0?t("ion-note",null,t("my-transl",{tag:"customer_group",text:"Customer Group"})):undefined,t("h2",null,e.groupName+" ["+e.groupOwnershipPerc+"%]")),i==this.customer.group.length-1?t("ion-button",{onClick:()=>this.editOwner(true),slot:"end"},"+"):undefined,t("ion-button",{slot:"end","icon-only":true,color:"danger",fill:"clear",onClick:()=>{this.editOwner(true,i,true)}},t("ion-icon",{name:"trash"})),t("ion-button",{slot:"end","icon-only":true,fill:"clear",onClick:()=>{this.editOwner(true,i)}},t("ion-icon",{name:"create"}))))),t("ion-item",{key:"9d75a166c00863fd71aba5c9d2d93d459a7ea98e",lines:"none"},t("ion-label",{key:"0e01233374f43bd9b9e3acbf917bd5d42a14a447"},t("ion-note",{key:"aa6947c2cfaa56e4d5aa57db7ed7a93f47bca923"},t("my-transl",{key:"1b116fdf06438dc31c930f918e2744696a33d461",tag:"customer_owner",text:"Customer Owner"})),t("h2",{key:"9b2e66c7c3167f3e10dde305258e1033b1a00502"},this.customer.owner.groupName)),t("ion-button",{key:"0141b6b6a895ef83da316bac7a4222844967c7e1",slot:"end","icon-only":true,fill:"clear",onClick:()=>{this.editOwner(false)}},t("ion-icon",{key:"1cb6dc9ba6729aeb324d575acd62cd9921919514",name:"create"}))),t("app-customer-plant-production",{key:"9d3ce994029904ee60dd1962939d8327c88add23",customer:this.customer,editable:true})),this.customerId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteCustomer()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"a0712b1ef8ff57cee746366f0407432ce7de0b21",class:"swiper-slide"},t("div",{key:"dd124a8957d9bff62b6e7f638cf4729a5d2eea1e"},t("ion-toolbar",{key:"55bd0e5492bf852dc31e2b6e5d8a932a18718eff"},t("ion-segment",{key:"332683cddf5b97f4bde9fe79e8448ba28cfd29de",mode:"ios",scrollable:true,onIonChange:e=>this.locationTypeSegmentChanged(e),value:this.locationTypeSegment},this.customer.locations.map(((e,i)=>t("ion-segment-button",{value:i,layout:"icon-start"},t("ion-label",null,l.getLocationsTypes(e.type)[0].locationName)))),t("ion-segment-button",{key:"7d4c9a7197bcabc0614d7dc1496d64e4d8b6acba",value:"add",onClick:()=>this.addLocation(),layout:"icon-start"},t("ion-label",{key:"84bbd653b1ccba4c883740994e3562c11e26656a"},"+")))),this.customer.locations.map(((e,i)=>t("div",null,this.locationTypeSegment==i?t("div",null,t("app-location",{locations:l.getLocationsTypes(),location:e,slider:this.slider,onLocationSelected:()=>this.updateLocation(),onLocationDeleted:()=>this.deleteLocation(i)})):undefined))))),t("swiper-slide",{key:"3eec43f28f6fef0c1c88c5dc71a2cd821e4688c0",class:"swiper-slide"},t("ion-grid",{key:"2fd2db0781281be6cbce6bdc0054060a3880cc0b"},t("ion-row",{key:"6642ca0bd042d0a4d5b7ef74249c286837392858"},t("ion-col",{key:"c865f93dfe7128c41a36ed0fecebafc9f5131b7e"},t("ion-button",{key:"c4cf0b5bf97094b433907febe32388a0714b78f5",color:w.getAppColor(),onClick:()=>this.editOperatingCondition("EAF"),expand:"block"},t("ion-icon",{key:"a8dfc32d87a2b17f1952797597021bc01fd59d02",name:"add"}),t("ion-label",{key:"760c6708b99c8641f2e5f61a44ff1f08e4140d77"},"EAF"))),t("ion-col",{key:"1922d69323e9f739f253f42674a9cd77c2d06896"},t("ion-button",{key:"f9ef73970391be283d356e710601287930e07e48",color:w.getAppColor(),onClick:()=>this.editOperatingCondition("LF"),expand:"block"},t("ion-icon",{key:"4201b1d546d120aa2794eb91bff1b8c731e6a7d6",name:"add"}),t("ion-label",{key:"a8d622f3ab7d5193fec135a8a419b24490e37925"},"LF"))),t("ion-col",{key:"b2e4eca0dc914567921bcb1d634061ad1b7e6d10"},t("ion-button",{key:"8b9a1baff0d188acd4cee3809ddf07fb3781039e",color:w.getAppColor(),onClick:()=>this.editOperatingCondition("CCM"),expand:"block"},t("ion-icon",{key:"17a417f868e40d81bfd788d35d94eadba426c0f0",name:"add"}),t("ion-label",{key:"95bb02cc469e361fe1d48d19635cc9427675c767"},"CCM"))))),t("ion-list",{key:"42acfb44d7f9cb27629b094d023e34d5551c4cba"},t("ion-item-divider",{key:"c613719f7d0b33ae7e31f72b3e574f969f65c45b"},"EAF"),this.customer.conditions.EAF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.editOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"9629349f8794cb7b74c12183ed780718fa71ce77"},"LF"),this.customer.conditions.LF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.editOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"7d0811a15a6bf1b1e759966102190b4743bfe7f0"},"CCM"),this.customer.conditions.CCM.map((e=>t("ion-item",null,t("ion-label",null,new Date(e.date).toLocaleDateString()))))))))),t("app-modal-footer",{key:"28d71ad3c6e1e967d5d75f50c9f9576d128264ff",color:w.getAppColor(),disableSave:!this.validCustomer,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};L.style=x;export{L as modal_customer_update};