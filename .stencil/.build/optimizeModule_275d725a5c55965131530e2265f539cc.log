import{r as t,h as e,f as i}from"./p-cbe60c68.js";import{aV as s,o as a,a6 as o,S as n,i as l,j as r,T as c}from"./p-6934ed3c.js";import{T as d}from"./p-8f5c3082.js";import{l as h}from"./p-1af05547.js";import{S as f}from"./p-a75993af.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-c2915cc5.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const p="page-datasheets{}";const u=p;const b=class{constructor(e){t(this,e);this.datasheetsList=[];this.nonFilteredDatasheetsList=[];this.localDocName="datasheetBasket";this.filteredDatasheetsList=[];this.loading=true;this.filter=new s;this.slider=undefined;this.updateView=true;this.showDownload=true;this.basket=[]}async componentWillLoad(){const t=await a.getLocalDocument("datasheetsFilter");this.filter=new s(t);o.datasheetsList$.subscribe((async t=>{this.updateList(t);this.nonFilteredDatasheetsList=t;this.loading=false;this.filterLists()}));const e=await a.getLocalDocument(this.localDocName);if(e)this.basket=e}componentDidLoad(){this.searchToolbar=this.el.querySelector("#searchToolbar");this.slider=new f(".slider-show-datasheet",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.downloadDatasheets()}updateList(t){this.datasheetsList=t;this.searchToolbar?this.searchToolbar.forceFilter(t):undefined;this.updateView=!this.updateView}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}filterDatasheets(t){if(this.filter.oldProduct===true){this.filteredDatasheetsList=h.exports.cloneDeep(t)}else{this.filteredDatasheetsList=t.filter((t=>t.oldProduct==false))}}addDatasheet(){o.presentDatasheetUpdate()}getOptions(){if(d.isRefraDBAdmin()){return[{tag:"delete",text:"Delete",icon:"trash",color:"danger",func:t=>o.deleteDatasheet(t,false)},{tag:"revision",text:"Revision",icon:"duplicate",color:"secondary",func:t=>o.duplicateDatasheet(t,true)},{tag:"copy",text:"Copy",icon:"copy",color:"tertiary",func:t=>o.duplicateDatasheet(t,false)},{tag:"edit",text:"Edit",icon:"create",color:"primary",func:t=>o.presentDatasheetUpdate(t)}]}else return null}async openDatasheetFilter(){a.deleteLocalDocument("filteredDatasheetList");this.filter=await o.openDatasheetFilter(this.filter);this.filterLists()}clearDatasheetFilter(){this.filter=new s;this.datasheetsList=h.exports.cloneDeep(this.nonFilteredDatasheetsList);a.deleteLocalDocument("filteredDatasheetList");this.filterLists()}async filterLists(){a.saveLocalDocument("datasheetsFilter",this.filter);if(this.filter.isActive()){const t=await a.getLocalDocument("filteredDatasheetList");if(!t){await n.presentLoading("searching");const t=await o.filterDatasheets(this.filter);n.dismissLoading();if(t){this.datasheetsList=t;a.saveLocalDocument("filteredDatasheetList",this.datasheetsList)}else{this.filterDatasheets(this.nonFilteredDatasheetsList)}}else{this.datasheetsList=t}this.filterDatasheets(this.datasheetsList)}else{this.filterDatasheets(this.nonFilteredDatasheetsList)}this.searchToolbar?this.searchToolbar.forceFilter(this.datasheetsList):undefined;this.slider?this.updateSlider():undefined}makeBreadCrumb(t){if(t=="familyId"){const t=o.getDatasheetFamilies(this.filter.familyId);if(t&&t.length>0)return t[0].familyName;else return this.filter.familyId}else if(t=="majorFamilyId"){const t=o.getDatasheetMajorFamilies(this.filter.majorFamilyId);if(t&&t.length>0)return t[0].majorFamilyName;else return this.filter.majorFamilyId}else if(t=="oldProduct"){return this.filter.oldProduct?"All revs.":"Last Rev."}else if(t=="properties"){if(this.filter.properties.length>0){let t="( ";this.filter.properties.forEach(((e,i)=>{const s=o.getDatasheetPropertyNames("id",e.valueName);t+=(s&&s.length>0?s[0].nameName:e.valueName)+e.operator+e.value+(i<this.filter.properties.length-1?" / ":" )")}));return t}else return""}return null}downloadDatasheets(){this.showDownload=!this.showDownload;this.slider.params.slidesPerView=this.showDownload?2:1;this.updateSlider()}openDatasheet(t){if(this.showDownload){const e=o.getDatasheetsById(t);if(!h.exports.includes(this.basket,e))this.basket.push(e);this.saveBasket();this.updateSlider()}else{o.presentDatasheetDetails(t)}}async downloadDatasheetsList(){const t=[];for(const e of this.basket){e["datasheetId"]=e.id;t.push(e)}o.exportDatasheets(t);this.downloadDatasheets()}emptyBasket(){this.basket=[];this.saveBasket()}removeItemFromBasket(t){this.basket.splice(t,1);this.saveBasket()}saveBasket(){this.updateView=!this.updateView;a.saveLocalDocument(this.localDocName,this.basket)}render(){return[e("ion-header",{key:"43dc6ed393c602068b2d1bf15263855441257a16"},e("app-navbar",{key:"8fe97133cdb254ae554ed0bb1d4c989982227855",tag:"datasheets",text:"Data Sheets",color:"trasteel"}),e("ion-grid",{key:"b967be9014d9fd0e0fc17e6006b3c1ed51b0a4f7",class:"ion-no-padding"},e("ion-row",{key:"28244a1db2b97bee43589cfbf15bad80abc79604",class:"ion-no-padding"},e("ion-col",{key:"d5fcdab1dd00a9ddadd2df680aecad075cddaa74",size:"1",class:"ion-no-padding"},e("ion-toolbar",{key:"4b89d2abc15ac45893b33ff7ab7653f4fff24dce",color:"trasteel"},e("ion-button",{key:"442cb2839fa1bd36ef7328e5a5cdee025e690086",fill:"clear",expand:"full","icon-only":true,onClick:()=>this.openDatasheetFilter()},e("ion-icon",{key:"b38a71b13bf74d6a1f3aa39a32c7958c01415113",name:"filter",color:"light"})))),e("ion-col",{key:"5f07ff903dd5a4ae0b22c2363624d0c22d3a5d98",size:"11",class:"ion-no-padding"},e("app-search-toolbar",{key:"7ac288ad8ae205a4bc196d7cad81f031d600f25c",id:"searchToolbar",searchTitle:"datasheets",list:this.datasheetsList,orderFields:["productName"],color:"trasteel",placeholder:"Search by product, family or tech#",filterBy:["productName","familyId","techNo"],onFilteredList:t=>this.filterDatasheets(t.detail)}))))),e("ion-content",{key:"160d85571f7c2aedfbf727fe2e0fbc465c0badca",class:"slides"},d.isRefraDBAdmin()?!this.showDownload?e("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},e("ion-fab-button",{size:"small",color:"trasteel"},e("ion-icon",{name:"chevron-down"})),e("ion-fab-list",{side:"bottom"},e("ion-fab-button",{onClick:()=>this.addDatasheet(),color:"trasteel"},e("ion-icon",{name:"add"})),e("ion-fab-button",{onClick:()=>this.downloadDatasheets(),color:"trasteel"},e("ion-icon",{name:"download"})))):e("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},e("ion-fab-button",{onClick:()=>this.downloadDatasheets(),size:"small",color:"trasteel"},e("ion-icon",{name:"close"}))):undefined,e("swiper-container",{key:"6b2b6572332216dd47d5830d239b194b56e70837",class:"slider-show-datasheet swiper"},e("swiper-wrapper",{key:"03f6b43676d7dd698fc5c72ce97a43543c0c1ffb",class:"swiper-wrapper"},e("swiper-slide",{key:"f45a015b3a54a1fd8e3a72293ca5f10e0ccfcdd2",class:"swiper-slide"},this.filter.isActive()?[e("ion-breadcrumbs",null,e("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.clearDatasheetFilter()},e("ion-icon",{color:"danger",name:"trash"})),e("ion-breadcrumb",null,"#",this.filteredDatasheetsList.length),Object.keys(this.filter).map((t=>(h.exports.isArray(this.filter[t])?this.filter[t].length>0:this.filter[t]!==null)?e("ion-breadcrumb",null,this.makeBreadCrumb(t)):undefined)),e("ion-breadcrumb",null))]:undefined,e("app-infinite-scroll",{key:"02668f55262c5635be5c42551fc86708f7054048",list:this.filteredDatasheetsList,loading:this.loading,showFields:["productName"],options:this.getOptions(),returnField:"id",icon:l.getMapDocs(r).icon.name,onItemClicked:t=>this.openDatasheet(t.detail),onListChanged:()=>{this.updateSlider()}})),this.showDownload?e("swiper-slide",{class:"swiper-slide"},e("ion-list",null,this.basket.length==0?e("ion-item",null,"Click on the datasheets on the left to add to basket"):e("ion-grid",null,e("ion-row",null,e("ion-col",null,e("ion-button",{onClick:()=>this.downloadDatasheetsList(),expand:"block",fill:"outline",color:"trasteel"},e("ion-icon",{name:"download",slot:"start"}),e("ion-label",null,c.getTransl("download","Download")),e("ion-badge",{slot:"end",color:"trasteel"},this.basket.length))),e("ion-col",{size:"1"},e("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.emptyBasket()},e("ion-icon",{name:"trash",color:"danger"}))))),this.basket.map(((t,i)=>e("ion-item",{color:"light"},e("ion-label",null,t.productName),e("ion-button",{slot:"end",fill:"clear","icon-only":true,onClick:()=>this.removeItemFromBasket(i)},e("ion-icon",{name:"trash",color:"danger"}))))))):undefined)))]}get el(){return i(this)}};b.style=u;export{b as page_datasheets};