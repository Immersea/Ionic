import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as n,o as l}from"./p-5d4a8e1f.js";import{E as s}from"./p-a9f4af61.js";import{U as o,a as c,P as d,b as r}from"./p-d2a582b5.js";import{U as h}from"./p-8ad57864.js";import{U as f,F as u,T as p}from"./p-30358c9d.js";import{l as m}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const b="modal-user-plans-update ion-list{width:100%}";const y=b;const g=class{constructor(t){e(this,t);this.uid=undefined;this.userPlans=new o;this.planIndex=undefined;this.userPlan=new c;this.validPlan=false;this.selectedCustomer=undefined;this.updateView=false}async componentWillLoad(){if(!this.uid)this.uid=f.userProfile.uid;if(this.planIndex>=0){this.userPlan=m.exports.cloneDeep(this.userPlans.userPlans[this.planIndex]);this.selectedCustomer=u.getCustomersDetails(this.userPlan.customerId)}else{this.userPlan=new c}}async componentDidLoad(){this.validatePlan()}async openSelectCustomer(){const e=await u.openSelectCustomer(this.selectedCustomer);if(e){this.userPlan.customerId=e.id;this.selectedCustomer=e}}addAction(){this.userPlan.planOfActions.push(new d);this.validatePlan()}handleOtherChange(e){this.userPlan.otherName=e.detail.value;this.validatePlan()}handleChange(e,t){e[t.detail.name]=t.detail.value;e.updated=(new Date).toISOString();this.validatePlan()}removePlan(e){this.userPlan.planOfActions.splice(e,1);this.validatePlan()}async deletePlan(){const e=await n.create({header:p.getTransl("delete-plan","Delete Plan"),message:p.getTransl("delete-plan-message","This plan will be deleted! Are you sure?"),buttons:[{text:p.getTransl("ok","OK"),handler:async()=>{this.save(true)}},{text:p.getTransl("cancel","Cancel"),handler:async()=>{}}]});e.present()}validatePlan(){this.validPlan=true;this.validPlan=this.validPlan&&(this.userPlan.customerId!=null||this.userPlan.otherName!=null);let e=this.userPlan.planOfActions.length>0;this.userPlan.planOfActions.forEach((t=>{e=e&&t.dueDate!=null;e=e&&t.updated!=null;e=e&&t.product!=null;e=e&&t.plan!=null;e=e&&t.situation!=null}));this.validPlan=this.validPlan&&e;this.updateView=!this.updateView}async save(e=false){if(!this.userPlans.users){this.userPlans.users={};this.userPlans.users[this.uid]=["owner"]}if(this.planIndex>=0&&this.userPlan.planOfActions.length==0){e=true}if(this.planIndex>=0&&!e){this.userPlans.userPlans[this.planIndex]=this.userPlan}else if(e){this.userPlans.userPlans.splice(this.planIndex)}else{this.userPlans.userPlans.push(this.userPlan)}await h.updateUserPlan(this.uid,this.userPlans);l.dismiss()}async cancel(){return l.dismiss()}render(){return t(i,{key:"67381f64cbf145db0b58b05fd48870783e10b0d3"},t("ion-header",{key:"52c18de802539c7a58472dde2775bb9ece878e7f"},t("ion-toolbar",{key:"44f6340444ae7797cbefa36dacdf9cc96a353707",color:"trasteel"},t("ion-title",{key:"19aa00db57f0c2c8f049092f43fd8269f86bc9d3"},t("my-transl",{key:"f416bc168e0b5a7f2c2f100f5199d028f3535cc6",tag:"plan-of-actions",text:"Plan of Actions"})))),t("ion-content",{key:"7b907ff3a43dba4ccb7c4a76b77ef3d0587ea5af"},t("ion-list",{key:"4cd5d3761a5b9a377c91493962bfeb92cdcc20e8"},this.userPlan.otherName==null?t("ion-item",{button:true,lines:"inset",onClick:()=>this.openSelectCustomer()},t("ion-label",null,t("p",{class:"small"},t("my-transl",{tag:"customer",text:"Customer"}),"*"),t("h2",null,this.selectedCustomer?this.selectedCustomer.fullName:null))):undefined,this.userPlan.customerId==null&&this.userPlan.otherName==null?t("ion-item-divider",null,t("ion-label",null,"- or -")):undefined,this.userPlan.customerId==null?t("app-form-item",{lines:"inset","label-tag":"other","label-text":"Other",value:this.userPlan.otherName,name:"otherName","input-type":"string",onFormItemChanged:e=>this.handleOtherChange(e)}):undefined,t("ion-button",{key:"fe2a8c7147088e51a29adcb36150da04f0c17c8c",color:"trasteel",fill:"outline",expand:"full",disabled:this.userPlan.customerId==null&&this.userPlan.otherName==null,onClick:()=>{this.addAction()}},t("ion-icon",{key:"127fe4c69a82530e834c1ca0673b3f03d4332206",name:"add",slot:"start"}),t("ion-label",{key:"e18597ccd38d9991207f9548f7ba8e9386b4e65c"},t("my-transl",{key:"bf5ec2b78e1cab5fd578e3390bf267e535789777",tag:"add-action",text:"Add Action"}))),t("ion-grid",{key:"1b6860d3bc4ea060e7f3d0b8f62401c70a032631"},this.userPlan.planOfActions.map(((e,i)=>[t("ion-row",null,t("ion-col",null,t("ion-select",{color:"trasteel",id:"application",interface:"action-sheet",label:p.getTransl("product","Product"),"label-placement":"floating",onIonChange:t=>{e.product=t.detail.value;this.validatePlan()},value:e.product},Object.keys(r).map((e=>t("ion-select-option",{value:e},r[e]))))),t("ion-col",{size:"3"},t("app-form-item",{lines:"inset","label-tag":"due-date","label-text":"Due Date",value:e.dueDate,name:"dueDate","input-type":"date","date-presentation":"date",onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",{size:"1"},t("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.removePlan(i)},t("ion-icon",{name:"trash",color:"danger"})))),t("ion-row",null,t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"actual-situation","label-text":"Actual Situation",value:e.situation,name:"situation","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"plan","label-text":"Plan",value:e.plan,name:"plan","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]}))),t("ion-row",null,t("ion-item-divider",null))]))),this.userPlan.planOfActions.length>0?t("ion-button",{color:"danger",fill:"outline",expand:"full",onClick:()=>{this.deletePlan()}},t("ion-icon",{name:"trash",slot:"start"}),t("ion-label",null,t("my-transl",{tag:"delete",text:"Delete"}))):undefined)),t("app-modal-footer",{key:"f0d5033bb47091eff64611fa23c83b416da030e6",color:s.getAppColor(),disableSave:!this.validPlan,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};g.style=y;export{g as modal_user_plans_update};