import{r as i,h as e,f as s}from"./p-cbe60c68.js";import{aM as t,m as o,am as a,S as n,Q as l,i as h,k as c,T as r}from"./p-736235c6.js";import{T as d}from"./p-9a446c6a.js";import{l as p}from"./p-1af05547.js";import{S as f}from"./p-a75993af.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const b="page-shapes{}";const u=b;const m=class{constructor(e){i(this,e);this.shapesList=[];this.nonFilteredShapesList=[];this.localDocName="shapeBasket";this.filteredShapesList=[];this.loading=true;this.filter=new t;this.slider=undefined;this.updateView=true;this.showDownload=true;this.activateDownload=false;this.basket=[]}async componentWillLoad(){const i=await o.getLocalDocument("shapesFilter");this.filter=new t(i);a.shapesList$.subscribe((async i=>{this.updateList(i);this.nonFilteredShapesList=i;this.loading=false;this.filterLists()}));const e=await o.getLocalDocument(this.localDocName);if(e){this.basket=e;this.basket.forEach((i=>{if(i.datasheet){this.activateDownload=true}else{this.activateDownload=false}}))}}componentDidLoad(){this.searchToolbar=this.el.querySelector("#searchToolbar");this.slider=new f(".slider-show-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.downloadShapes()}updateList(i){this.shapesList=i;this.searchToolbar?this.searchToolbar.forceFilter(i):undefined;this.updateSlider()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}addShape(){a.presentShapeUpdate()}getOptions(){if(d.isRefraDBAdmin()){return[{tag:"delete",text:"Delete",icon:"trash",color:"danger",func:i=>a.deleteShape(i,false)},{tag:"duplicate",text:"Duplicate",icon:"duplicate",color:"secondary",func:i=>a.duplicateShape(i)},{tag:"edit",text:"Edit",icon:"create",color:"primary",func:i=>a.presentShapeUpdate(i)}]}else return null}async openShapeFilter(){o.deleteLocalDocument("filteredShapesList");this.filter=await a.openShapeFilter(this.filter);this.filterLists()}clearShapeFilter(){this.filter=new t;this.shapesList=p.exports.cloneDeep(this.nonFilteredShapesList);o.deleteLocalDocument("filteredShapesList");this.filterLists()}async filterLists(){o.saveLocalDocument("shapesFilter",this.filter);if(this.filter.isActive()){const i=await o.getLocalDocument("filteredShapesList");if(!i){this.loading=true;n.presentLoading("searching");this.shapesList=await a.filterShapes(this.filter);n.dismissLoading();this.filteredShapesList=p.exports.cloneDeep(this.shapesList);o.saveLocalDocument("filteredShapesList",this.filteredShapesList);this.loading=false}else{this.filteredShapesList=i}}else{this.filteredShapesList=p.exports.cloneDeep(this.nonFilteredShapesList)}this.searchToolbar?this.searchToolbar.forceFilter(this.shapesList):undefined;this.slider?this.updateSlider():undefined}downloadShapes(){this.showDownload=!this.showDownload;this.slider.params.slidesPerView=this.showDownload?2:1;this.updateSlider()}openShape(i){if(this.showDownload){const e=a.getShapeById(i);if(!p.exports.find(this.basket,{shape:e}))this.basket.push({shape:e,datasheet:null});this.basket=p.exports.orderBy(this.basket,"shape.shapeName");this.saveBasket()}else{a.presentShapeDetails(i)}}async openDataSheet(i){const e=await l.openSelectDataSheet();if(e){this.basket[i].datasheet=e;this.basket.forEach((i=>{if(!i.datasheet)i.datasheet=e}));this.activateDownload=true;this.saveBasket()}}async downloadShapesList(){a.exportShapes(this.basket,"en");this.downloadShapes()}emptyBasket(){this.basket=[];this.activateDownload=false;this.saveBasket()}removeItemFromBasket(i){if(this.basket.length==1){this.emptyBasket()}else{this.basket.splice(i,1);this.saveBasket()}}saveBasket(){this.updateSlider();o.saveLocalDocument(this.localDocName,this.basket)}render(){return[e("ion-header",{key:"f728e9d3e5b855056e9dd2489eb64be6ab6058c2"},e("app-navbar",{key:"9329279525579f104ff690aa0a59f549edc98468",tag:"shapes",text:"Shapes",color:"trasteel"}),e("ion-grid",{key:"3c82f2f96c80b8dc799948883dc9abda9ba84702",class:"ion-no-padding"},e("ion-row",{key:"657875256ea5f2498c97fb0aece43dc99a7b9e53",class:"ion-no-padding"},e("ion-col",{key:"a9e833f9ca870008b90c291fed736e13c7ec7793",size:"1",class:"ion-no-padding"},e("ion-toolbar",{key:"fddfbcdcb5c37390e7cdf6779564b59b8a783f69",color:"trasteel"},e("ion-button",{key:"3516127edaebbace1f328e02764acea9507b56f4",fill:"clear",expand:"full","icon-only":true,onClick:()=>this.openShapeFilter()},e("ion-icon",{key:"b86a5c37944fa11a5f547f89d77862d49b9ff8d5",name:"filter",color:"light"})))),e("ion-col",{key:"ca6a55645e55c9360253bc846a024d8d572ee2e2",size:"11",class:"ion-no-padding"},e("app-search-toolbar",{key:"104d7e0f48653a26b45c0b86318f668ec1d60f0f",id:"searchToolbar",searchTitle:"shapes",list:this.shapesList,orderFields:["shapeName"],color:"trasteel",placeholder:"Search by shape name",filterBy:["shapeName","shapeTypeId"],onFilteredList:i=>this.filteredShapesList=i.detail}))))),e("ion-content",{key:"441fc627dabc86d329858df7252a3044dac0c224",class:"slides"},d.isRefraDBAdmin()?!this.showDownload?e("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},e("ion-fab-button",{size:"small",color:"trasteel"},e("ion-icon",{name:"chevron-down"})),e("ion-fab-list",{side:"bottom"},e("ion-fab-button",{onClick:()=>this.addShape(),color:"trasteel"},e("ion-icon",{name:"add"})),e("ion-fab-button",{onClick:()=>this.downloadShapes(),color:"trasteel"},e("ion-icon",{name:"download"})))):e("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},e("ion-fab-button",{onClick:()=>this.downloadShapes(),size:"small",color:"trasteel"},e("ion-icon",{name:"close"}))):undefined,e("swiper-container",{key:"56acb4ae739c4353950b5903f5700d328a764cdb",class:"slider-show-shape swiper"},e("swiper-wrapper",{key:"183578b47f227c7a71cf23e89476391a2994cc29",class:"swiper-wrapper"},e("swiper-slide",{key:"c80d4b9608f8b9482c2ac1a2d3e91d4823b51344",class:"swiper-slide"},this.filter.isActive()?[e("ion-breadcrumbs",null,e("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.clearShapeFilter()},e("ion-icon",{color:"danger",name:"trash"})),e("ion-breadcrumb",null,this.filteredShapesList.length),Object.keys(this.filter).map((i=>!i.includes("operator")&&(this.filter[i]>0||this.filter[i]!==null)?e("ion-breadcrumb",null,i!="shapeTypeId"?i+" "+this.filter[i+"_operator"]+" "+this.filter[i]:a.getShapeTypeName(this.filter.shapeTypeId)?a.getShapeTypeName(this.filter.shapeTypeId).en:null):undefined)),e("ion-breadcrumb",null))]:undefined,e("app-infinite-scroll",{key:"7ef9a2c39d8c6b49246804b2c629c75d78fac02c",list:this.filteredShapesList,loading:this.loading,showFields:["shapeName"],orderBy:["shapeName"],options:this.getOptions(),returnField:"id",icon:h.getMapDocs(c).icon.name,onItemClicked:i=>this.openShape(i.detail),onListChanged:()=>{this.updateSlider()}})),this.showDownload?e("swiper-slide",{class:"swiper-slide"},e("ion-list",null,this.basket.length==0?e("ion-item",null,"Click on the shapes on the left to add to basket"):e("ion-grid",null,e("ion-row",null,e("ion-col",null,e("ion-button",{onClick:()=>this.downloadShapesList(),expand:"block",fill:"outline",color:"trasteel",disabled:!this.activateDownload},e("ion-icon",{name:"download",slot:"start"}),e("ion-label",null,r.getTransl("download","Download")),e("ion-badge",{slot:"end",color:"trasteel"},this.basket.length))),e("ion-col",{size:"1"},e("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.emptyBasket()},e("ion-icon",{name:"trash",color:"danger"}))))),this.basket.map(((i,s)=>e("ion-grid",{class:"ion-no-padding"},e("ion-row",{class:"ion-no-padding"},e("ion-col",{class:"ion-no-padding"},e("ion-item",{color:"light"},e("ion-label",null,i.shape.shapeName),e("ion-icon",{slot:"end",name:"arrow-right"}))),e("ion-col",{class:"ion-no-padding"},e("ion-item",{button:true,color:"light",onClick:()=>this.openDataSheet(s)},e("ion-label",null,i.datasheet?i.datasheet.productName:"insert datasheet"))),e("ion-col",{size:"2",class:"ion-no-padding"},e("ion-item",{color:"light"},e("ion-button",{slot:"end",fill:"clear","icon-only":true,onClick:()=>this.removeItemFromBasket(s)},e("ion-icon",{name:"trash",color:"danger"})))))))))):undefined)))]}get el(){return s(this)}};m.style=u;export{m as page_shapes};