import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o}from"./p-5d4a8e1f.js";import{S as s}from"./p-a75993af.js";import{U as n,n as c,T as l,J as d,K as r,F as f,S as h,l as m}from"./p-30358c9d.js";import{E as p}from"./p-a9f4af61.js";import{l as b}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const u="modal-contact-update ion-list{width:100%}";const y=u;const k=class{constructor(t){e(this,t);this.contactId=undefined;this.contact=undefined;this.customerLocations=[];this.segment="information";this.updateView=true;this.validContact=false;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=n.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.segmentTitles={information:l.getTransl("information","Information")};await this.loadContact()}async loadContact(){if(this.contactId){const e=await d.getContact(this.contactId);this.contact=e}else{this.contact=new r;this.contact.users={[n.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-contact",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.validateContact()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.contact[e.detail.name]=e.detail.value;this.validateContact()}handleInformationChange(){this.validateContact()}selectCustomer(e){this.contact.customerId=e.detail.value;f.getCustomer(e.detail.value).then((e=>{this.customer=e;this.customerLocations=e.locations;this.setLocationsSelect()}));this.validateContact()}selectCustomerLocation(e){this.contact.customerLocationId=e.detail.value;this.validateContact()}setLocationsSelect(){const e=this.el.querySelector("#selectLocation");const t={header:l.getTransl("location","Locations")};e.interfaceOptions=t;const a=Array.from(e.getElementsByTagName("ion-select-option"));a.map((t=>{e.removeChild(t)}));e.placeholder=l.getTransl("select","Select");this.customerLocations.map((t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=l.getTransl(t.type,f.getLocationsTypes(t.type)[0].locationName);e.appendChild(a)}));this.updateSlider()}updateParam(){this.validateContact()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break}}}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.contact.photoURL=a}else{this.contact.coverURL=a}this.save(false)}validateContact(){this.validContact=b.exports.isString(this.contact.firstName)&&b.exports.isString(this.contact.lastName)&&b.exports.isString(this.contact.customerId)}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteContact(){try{await d.deleteContact(this.contactId);o.dismiss()}catch(e){h.presentAlertError(e)}}async save(e=true){const t=await d.updateContact(this.contactId,this.contact,this.userProfile.uid);if(this.contactId){return e?o.dismiss():true}else{this.contactId=t.id;return true}}async cancel(){o.dismiss()}render(){return t(a,{key:"192aaf79203f0f8062c4d11bf7c2588e11104bb2"},t("ion-header",{key:"b7815213dadea97e6a3a57aa92b1a347a923bb1a"},t("app-upload-cover",{key:"f437deab654b1dbfa3887180e7af8c3305d87922",item:{collection:m,id:this.contactId,photoURL:this.contact.photoURL,coverURL:this.contact.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-header",{key:"f2cf8b82d51fb8304be90799f80f1fc66804f10c"},t("ion-toolbar",{key:"be1233d58a77faa923f2d82e6866c61c8554f841"},t("ion-segment",{key:"11ab06766a25156a50facd92adf207f781ee4978",mode:"md",color:p.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},t("ion-segment-button",{key:"fef1ece2a31cd6e70ba7adc342ef48234637ad32",value:"information",layout:"icon-start"},t("ion-label",{key:"0024c554897ac7352632626511330964ccf01b89"},this.segmentTitles.information))))),t("ion-content",{key:"57ce4e1d0f8bc37639de83aedd1b9f955d85505e",class:"slides"},t("swiper-container",{key:"270260710fd1c715bbd1dc1c27a56cd8c58ce5e0",class:"slider-edit-contact swiper"},t("swiper-wrapper",{key:"f40515b02708623d154dc1cd4c5ad1962d69d057",class:"swiper-wrapper"},t("swiper-slide",{key:"58e7cd9764c62745ff7957fc1c58559adb03bb8d",class:"swiper-slide"},t("ion-list",{key:"a99b100cfd97fe6ebb441ba20ce1cf9872d7b9cc",class:"ion-no-padding"},t("ion-list-header",{key:"847367e1bdaa8ca86d8b03902255b1c8f0bb759b"},t("my-transl",{key:"3ebf91f56340c34d486271722b2d84cf3d14e9d9",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"79500e2435c4a41492347f5f8fe1af1a9607da6e",lines:"none"},t("ion-select",{key:"262c99c27144a6abc4060d54ccec0909d0151a84",color:"trasteel",id:"selectCustomer",interface:"action-sheet",label:l.getTransl("customer","Customer"),"label-placement":"floating",onIonChange:e=>this.selectCustomer(e),value:this.contact&&this.contact.customerId?this.contact.customerId:null},f.customersList.map((e=>t("ion-select-option",{value:e.id},e.fullName))))),t("ion-item",{key:"75398e790d8e23c7aa8270a74ca5ed6c84815483",lines:"none"},t("ion-select",{key:"85407f99e90ad4ee4a008c0741048112aa6dfaed",color:"trasteel",id:"selectLocation",interface:"action-sheet",label:l.getTransl("location","Location"),"label-placement":"floating",onIonChange:e=>this.selectCustomerLocation(e),value:this.contact&&this.contact.customerLocationId?this.contact.customerLocationId:null})),t("app-form-item",{key:"140ae5ef1814d7ece54704d5b724fa470eeefbb5","label-tag":"name","label-text":"Name",value:this.contact.firstName,name:"firstName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"bd0572813872acf3a5aab114746c27f91e617bb1","label-tag":"surname","label-text":"Surname",value:this.contact.lastName,name:"lastName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"d38bf7977535c90c507ac2a1f053398f2486db70","label-tag":"work-position","label-text":"Work Position",value:this.contact.workPosition,name:"workPosition","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"ae8e1f1e6daeeffd8d47c94f80f4b159e74eb5e3","label-tag":"office-phone","label-text":"Office Phone",value:this.contact.officePhone,name:"officePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"13fab21a0f73e8e4e602068f4abc21c166d96851","label-tag":"mobile-phone","label-text":"Mobile Phone",value:this.contact.mobilePhone,name:"mobilePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"0fe758f0530c2fefc2a77e5d1befb5be5abd23bb","label-tag":"email","label-text":"Email",value:this.contact.email,name:"email","input-type":"email","input-form-mode":"email",onFormItemChanged:e=>this.handleChange(e)})),this.contactId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteContact()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined)))),t("app-modal-footer",{key:"20ba96133666a80565849c40e1d47d015921e784",color:p.getAppColor(),disableSave:!this.validContact,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};k.style=y;export{k as modal_contact_update};