import{r as e,h as i,f as t}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{i as a}from"./p-694b8ade.js";import{m as o}from"./p-c2915cc5.js";import{l as n}from"./p-1af05547.js";import{aj as s,U as l,E as d,ak as c}from"./p-773bd3de.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const r="modal-dive-configuration .scrollx{display:flex;flex-wrap:nowrap;overflow-x:auto}modal-dive-configuration .scrollx .item{flex:0 0 0 0}modal-dive-configuration .scrollx ::-webkit-scrollbar{display:none}modal-dive-configuration input{text-align:right}modal-dive-configuration .fixedLabel{min-width:80% !important;max-width:80% !important}modal-dive-configuration ion-item .item-inner{box-shadow:none !important;border-bottom:1px solid #dedede !important}modal-dive-configuration .item-input .label-md,modal-dive-configuration .item-select .label-md,modal-dive-configuration .item-datetime .label-md{color:rgb(0, 0, 0)}";const f=r;const m=class{constructor(i){e(this,i);this.validForm={name:false,depth:false,time:false,bottom:false};this.diveDataToShare=undefined;this.updateView=true;this.showSave=false}componentWillLoad(){this.screenWidth=window.screen.width;this.divePlan=this.diveDataToShare.divePlan;this.diveConfig=this.divePlan.configuration;this.orderTanks();this.ranges=this.divePlan.getParamRanges(this.diveConfig.parameters.units);let e=s.getStdGases();e=n.exports.orderBy(e,"fromDepth","asc");this.bottomGases=n.exports.filter(e,{deco:false});this.decoGases=n.exports.filter(e,{deco:true});let i=l.userSettings.userTanks;i=n.exports.orderBy(i,"volume");const t=n.exports.filter(i,{forDeco:false});const a=n.exports.filter(i,{forDeco:true});this.bottomTanks=[];t.forEach((e=>{this.bottomTanks.push(e.getTank())}));this.decoTanks=[];a.forEach((e=>{this.decoTanks.push(e.getTank())}));this.stdConfigurations=s.getStdConfigurations();this.userStdConfigurations=n.exports.cloneDeep(l.userSettings.userConfigurations)}componentDidLoad(){this.validateAll()}async addTank(e,i,t){let s={tank:t,tanksList:null,stdGasesList:null,ccr:this.diveConfig.parameters.configuration=="CCR",parameters:this.diveConfig.parameters,decoTanks:!i};if(i){s.tanksList=this.bottomTanks;s.stdGasesList=this.bottomGases}else{s.tanksList=this.decoTanks;s.stdGasesList=this.decoGases}var l=undefined;if(a("capacitor")){l="custom-mobile-popover";e=null}const d=await o.create({component:"popover-tank",event:e,translucent:true,backdropDismiss:false,cssClass:l,componentProps:s});d.present();d.onDidDismiss().then((e=>{e=e.data;if(e){let a;if(i){a=this.diveConfig.configuration.bottom}else{a=this.diveConfig.configuration.deco}if(!t){a.push(e)}else{let i=n.exports.indexOf(a,t);a.splice(i,1,e)}this.orderTanks();this.validateForm("tanks")}}))}deleteTank(e,i){let t;if(e){t=this.diveConfig.configuration.bottom}else{t=this.diveConfig.configuration.deco}t.splice(i,1);this.orderTanks()}orderTanks(){this.diveConfig.configuration.bottom=n.exports.orderBy(this.diveConfig.configuration.bottom,"gas.fromDepth");this.diveConfig.configuration.deco=n.exports.orderBy(this.diveConfig.configuration.deco,"gas.fromDepth");this.updateView=!this.updateView}updateParams(e){this.divePlan.parameters=e}save(){this.el.closest("ion-modal").dismiss(this.diveConfig)}close(){this.el.closest("ion-modal").dismiss()}inputHandler(e){this.diveConfig[e.detail.name]=e.detail.value}validateAll(){this.validForm.name=this.diveConfig.stdName.length>=3;this.validForm.depth=this.diveConfig.maxDepth>1;this.validForm.time=this.diveConfig.maxTime>1;this.validateForm("tanks");this.updateView=!this.updateView}validateForm(e,i){if(e=="name"){this.validForm.name=i}else if(e=="time"){this.validForm.time=i}else if(e=="depth"){this.validForm.depth=i}else{this.validForm.bottom=this.bottomTanks.length>0}this.showSave=this.validForm.name&&this.validForm.time&&this.validForm.depth&&this.validForm.bottom}copyConfiguration(e){this.diveConfig=e;this.validateAll()}render(){return[i("app-navbar",{key:"86a35a0e1d1f83ac2585ed6bb9fd3d67ffff9fc2",tag:"dive-configuration",text:"Dive Configuration",color:d.getAppColor(),modal:true}),i("ion-content",{key:"9b295d623a2c62abdb29fee8016713c7cb661480"},i("ion-list",{key:"77cf8c5750372285cd4f8d7eb45915af17f94cc0"},i("ion-list-header",{key:"f3651568fe2f00c9feea20e3d7f3d44d8b4283b0"},"Copy from standard configuration"),i("ion-row",{key:"32fa727839cb27a1f0cce2a759ef63c9e1bd60d7",class:"scrollx",id:"scrollTankGas"},this.userStdConfigurations?this.userStdConfigurations.map((e=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:d.getAppColor(),onClick:()=>this.copyConfiguration(e)},e.stdName)))):undefined,this.stdConfigurations?this.stdConfigurations.map((e=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:"success",onClick:()=>this.copyConfiguration(e)},"DP-",e.stdName)))):undefined),i("app-form-item",{key:"5d12e44a076e40b056fff41b0287408356806d92","label-tag":"configuration-name","label-text":"Configuration Name",value:this.diveConfig.stdName,name:"stdName","input-type":"text",onFormItemChanged:e=>this.inputHandler(e),validator:["required"],onIsValid:e=>this.validateForm("name",e.detail)}),i("app-form-item",{key:"5267379873434a1a8beea39901d1f096eb442870","label-tag":"max-depth","label-text":"Max Depth (xxx)",labelReplace:{xxx:this.diveConfig.parameters.depthUnit},value:n.exports.toString(this.diveConfig.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),validator:["required",{name:"minvalue",options:{min:1}}],onIsValid:e=>this.validateForm("depth",e.detail)}),i("app-form-item",{key:"385128718862ddf2070c1be7c7c6a2732fabc32c","label-tag":"max-time","label-text":"Max Time (min)",value:n.exports.toString(this.diveConfig.maxTime),name:"maxTime","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),validator:["required",{name:"minvalue",options:{min:1}}],onIsValid:e=>this.validateForm("time",e.detail)}),i("ion-list-header",{key:"f40a9671c6d861cf77a797a307f66275efe09142"},i("my-transl",{key:"e17412d033dcf9bd7e6115875930677ad74c5279",tag:"tanks-configuration",text:"Tank(s) Configuration",isLabel:true})),i("ion-list-header",{key:"2e79ba65afd3c065ae49ceff349f119cfd33c186"},i("ion-grid",{key:"217e98f145c07269e243ccd5ac250fae5252dd1b",class:"ion-no-padding"},i("ion-row",{key:"89db94ab3b79e5e0dac76f971eee5988f429b4f9"},i("ion-col",{key:"4c790a136d2a57e7b402d32d0e0da93328e1ecbc"},i("my-transl",{key:"29e1e95895ebd54d30cb1621caff492d35138440",tag:"bottom",text:"Bottom",isLabel:true})),i("ion-col",{key:"dcd122270bdc26db3a8c032c072c87eca0e070af",size:"1"},i("ion-row",{key:"4ab72e63271d7d4fa5187f1ec4a7d5323e17d73b",class:"ion-text-center"},i("ion-button",{key:"3bff897571852e3862de5318051d683d113aa16a","icon-only":true,fill:"clear",color:"primary",onClick:e=>this.addTank(this.screenWidth>=500?e:null,true)},i("ion-icon",{key:"c38fa34d7a48c4e0835d663ad3df5d06d1e6a6e6",name:"add-circle"}))))))),this.diveConfig.configuration.bottom.length>0?i("ion-grid",null,i("ion-row",{class:"ion-text-center"},this.diveConfig.configuration.bottom.map(((e,t)=>i("ion-col",{size:"12","size-sm":true},e.name?i("ion-card",null,i("ion-card-header",{class:"ion-text-center"},e.name),i("ion-card-content",{class:"ion-text-center"},i("p",null,e.gas.toString()),i("p",null,e.pressure,c.pressUnit," / ",e.getGasVolume(),c.volumeUnit)),i("ion-grid",{class:"ion-no-padding"},i("ion-row",null,i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:i=>this.addTank(this.screenWidth>=500?i:null,true,e)},i("ion-icon",{name:"create"}),i("my-transl",{tag:"edit",text:"Edit"}))),i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:()=>this.deleteTank(true,t)},i("ion-icon",{name:"trash"}),i("my-transl",{tag:"delete",text:"Delete"})))))):undefined))))):undefined,i("ion-list-header",{key:"707d7b254ab9036d4ba3f926d36c5c724bc8eeeb"},i("ion-grid",{key:"57dc245dc7258b1eed1bbc0dc1b1537485d9c442",class:"ion-no-padding"},i("ion-row",{key:"1fc11875b5024854f531f563d79ffd072839eed8"},i("ion-col",{key:"be3f72bd8e6425c6f267679db67acd6bb0585511"},i("my-transl",{key:"cd1410a30e5ad36ce150efcef95d62fd133d10ce",tag:"deco",text:"Deco",isLabel:true})),i("ion-col",{key:"5b21c2238fa10435fb562e5ae75a93b67664ff1f",size:"1"},i("ion-row",{key:"a46558d411e0224f1cdb319f929e2ebd77f162d8",class:"ion-text-center"},i("ion-button",{key:"e3768fb6052fa555c7b9ae5f628784f397a01adb","icon-only":true,fill:"clear",color:"primary",onClick:e=>this.addTank(this.screenWidth>=500?e:null,false)},i("ion-icon",{key:"37d93fd48686ea923c358d01b3c5fb427be93433",name:"add-circle"}))))))),this.diveConfig.configuration.deco.length>0?i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-text-center"},this.diveConfig.configuration.deco.map(((e,t)=>i("ion-col",{size:"12","size-sm":true},e.name?i("ion-card",null,i("ion-card-header",{class:"ion-text-center"},e.name),i("ion-card-content",{class:"ion-text-center"},i("p",null,e.gas.toString()),i("p",null,e.pressure,c.pressUnit," / ",e.getGasVolume(),c.volumeUnit)),i("ion-grid",{class:"ion-no-padding"},i("ion-row",null,i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:i=>this.addTank(this.screenWidth>=500?i:null,false,e)},i("ion-icon",{name:"create"}),i("my-transl",{tag:"edit",text:"Edit"}))),i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:()=>this.deleteTank(false,t)},i("ion-icon",{name:"trash"}),i("my-transl",{tag:"delete",text:"Delete"})))))):undefined))))):undefined,i("app-decoplanner-settings",{key:"1ab92914677b0367e71f69a6654a282151136988",diveDataToShare:this.diveDataToShare,onUpdateParamsEvent:e=>this.updateParams(e)}))),i("app-modal-footer",{key:"9243b02758239e4923b3e5eb9a266a2eda722041",disableSave:!this.showSave,onCancelEmit:()=>this.close(),onSaveEmit:()=>this.save()})]}get el(){return t(this)}};m.style=f;export{m as modal_dive_configuration};