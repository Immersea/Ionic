import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import{U as s,n as d,q as c,O as n,ao as o,ai as b,T as r,ap as l,R as p,E as f,Q as h}from"./p-773bd3de.js";import"./p-c7ee7cfe.js";import{b as m,n as y}from"./p-c2915cc5.js";import{l as u}from"./p-1af05547.js";import{S as k}from"./p-a75993af.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-dive-site-update ion-list{width:100%}";const v=g;const w=class{constructor(a){e(this,a);this.stdConfigurations=[];this.diveSiteId=undefined;this.diveSite=undefined;this.segment="map";this.updateView=true;this.validSite=false;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"dive-profiles",text:"Dive Profiles"},{tag:"team"}];this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new c(e);this.stdConfigurations=u.exports.cloneDeep(this.userSettings.userConfigurations)}));await this.loadDiveSite()}async loadDiveSite(){if(this.diveSiteId){this.diveSite=await n.getDiveSite(this.diveSiteId);this.draggableMarkerPosition={lat:this.diveSite.position.geopoint.latitude,lon:this.diveSite.position.geopoint.longitude}}else{this.diveSite=new o;this.diveSite.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}async componentDidLoad(){this.slider=new k(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+b(this.diveSite,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateSite()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#dive-type-select");const a={header:r.getTransl("site-type","Site Type")};e.interfaceOptions=a;e.placeholder=r.getTransl("select","Select");u.exports.each(n.getSiteTypes(),(a=>{const t=document.createElement("ion-select-option");t.value=a.type;t.textContent=a.name;e.appendChild(t)}));const t=this.el.querySelector("#entry-type-select");const i={header:r.getTransl("entry-type","Entry Type")};t.interfaceOptions=i;t.placeholder=r.getTransl("select","Select");u.exports.each(n.getEntryTypes(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;t.appendChild(a)}));const s=this.el.querySelector("#seabed-comp-select");const d={header:r.getTransl("seabed-comp","Seabed Composition")};s.interfaceOptions=d;s.placeholder=r.getTransl("select","Select");u.exports.each(n.getSeabedCompositions(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;s.appendChild(a)}));const c=this.el.querySelector("#seabed-cover-select");const o={header:r.getTransl("seabed-cover","Seabed Cover")};c.interfaceOptions=o;c.placeholder=r.getTransl("select","Select");u.exports.each(n.getSeabedCovers(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;c.appendChild(a)}))}updateLocation(e){this.draggableMarkerPosition={lat:u.exports.toNumber(e.detail.lat),lon:u.exports.toNumber(e.detail.lon)};this.diveSite.position=l.getPosition(e.detail.lat,e.detail.lon);this.validateSite()}updateAddress(e){this.diveSite.setAddress(e.detail)}handleChange(e){this.diveSite[e.detail.name]=e.detail.value;this.validateSite()}handleInformationChange(e){switch(e.detail.name){case"minDepth":this.diveSite.information.minDepth=u.exports.toNumber(e.detail.value);break;case"maxDepth":this.diveSite.information.maxDepth=u.exports.toNumber(e.detail.value);break;case"waterTemp.spring":this.diveSite.information.waterTemp.spring=e.detail.value;break;case"waterTemp.summer":this.diveSite.information.waterTemp.summer=e.detail.value;break;case"waterTemp.autumn":this.diveSite.information.waterTemp.autumn=e.detail.value;break;case"waterTemp.winter":this.diveSite.information.waterTemp.winter=e.detail.value;break;default:this.diveSite.information[e.detail.name]=e.detail.value}this.validateSite()}updateParam(e,a){let t=a.detail.value;switch(e){case"type":this.diveSite.type=t;break;case"entryType":this.diveSite.information.entryType=t;break;case"seabedComposition":this.diveSite.information.seabedComposition=t;break;case"seabedCover":this.diveSite.information.seabedCover=t;break}this.validateSite()}async addDivePlan(){let e=[];u.exports.forEach(this.stdConfigurations,((a,t)=>{e.push({type:"radio",label:a.stdName,value:t,checked:t==0?true:false})}));const a=await m.create({header:r.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:r.getTransl("ok","OK"),handler:e=>{this.addDivePlanWithConf(this.stdConfigurations[e])}},{text:r.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});a.present()}async addDivePlanWithConf(e){const a=await p.openModal("modal-dive-template",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,dive:0,user:this.userProfile});a.onDidDismiss().then((e=>{const a=e.data;if(a){a.dives[0].diveSiteId=this.diveSiteId;this.diveSite.divePlans.push(a);this.updateView=!this.updateView}}))}async viewDivePlan(e,a){this.diveSite.divePlans[a]=e.detail;this.updateView=!this.updateView}async removeDivePlan(e){this.diveSite.divePlans.splice(e,1);this.updateView=!this.updateView}updateImageUrls(e){const a=e.detail.type;const t=e.detail.url;if(a=="photo"){this.diveSite.photoURL=t}else{this.diveSite.coverURL=t}}validateSite(){this.validSite=u.exports.isNumber(this.diveSite.position.geopoint.latitude)&&u.exports.isNumber(this.diveSite.position.geopoint.longitude)&&u.exports.isString(this.diveSite.type)&&u.exports.isString(this.diveSite.information.entryType)&&u.exports.isString(this.diveSite.description)&&this.diveSite.information.minDepth>0&&this.diveSite.information.maxDepth>0}async save(){await n.updateDiveSite(this.diveSiteId,this.diveSite,this.userProfile.uid);return y.dismiss()}async cancel(){return y.dismiss()}render(){return a(t,{key:"7c554e27db3835763c30d4f5c31c895aacae9040"},a("ion-header",{key:"59cdfc69241b75c5f45daf00eb018e2e3deb2704"},a("app-upload-cover",{key:"242ac2a9c80023fef8ad68b184bd6c0e4728ddcc",item:{collection:h,id:this.diveSiteId,photoURL:this.diveSite.photoURL,coverURL:this.diveSite.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),a("app-header-segment-toolbar",{key:"29bbc5ea3b5125315d2ccb240ab232c6e2076940",color:f.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"5150ef01717c7f9e651c6380bbb84e9ea146ed9a",class:"slides"},a("swiper-container",{key:"3080127934a141357dfc140d8256cf2101a3d02e",class:"slider-dive-site swiper"},a("swiper-wrapper",{key:"951191b9d45d6267780c69491da5f24a413d17ec",class:"swiper-wrapper"},a("swiper-slide",{key:"10f12ec5f05586d3f3a89418936774f6840ee043",class:"swiper-slide"},a("div",{key:"1708b4b082c5fe1a649d7fb9986a4fba4730a92d",id:"map-container"},a("app-map",{key:"2ddd253fcf488a5fcdb34ed68776bae77c276a09",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),a("swiper-slide",{key:"b6ea08fea52f2671cbf907d52dd36399c8f12137",class:"swiper-slide"},a("app-coordinates",{key:"b1abe0c1db7c252861523fd6d08d6bbcd9bad211",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),a("swiper-slide",{key:"c909d35eea738b4b96bcb511a86c9f950fd576e2",class:"swiper-slide"},a("ion-list",{key:"56a8d282c4e86539b208858cbfe5f7ac9ffc216b",class:"ion-no-padding"},a("ion-list-header",{key:"1c0b719cc0b59ea29e1c43bdbd437f68837d6149"},a("my-transl",{key:"8c1fc75ba5f223a88fe2b3031987998defa361c4",tag:"general-information",text:"General Information",isLabel:true})),a("ion-item",{key:"a778214f0dbd83c2a95551ef6d37d20b5b7a1a26"},a("ion-label",{key:"dd4d1c473861b2005de05832a021eac7cdeb8e7c"},a("my-transl",{key:"a57d028ca911ce2e95b19ea047e20c672adede25",tag:"site-type",text:"Site Type"})),a("ion-select",{key:"332749ca45eeca175e885e074d53c74b166ffba4",id:"dive-type-select",onIonChange:e=>this.updateParam("type",e),value:this.diveSite.type})),a("ion-item",{key:"ea00bb682108ed2d032f001b2bacebbd5388af3a"},a("ion-label",{key:"b0f09025719c3d3355fc471b41c68c503d796694"},a("my-transl",{key:"ea713a08bdfb7c7b52e33d7db51c887c8bee7d0f",tag:"entry-type",text:"Entry Type"})),a("ion-select",{key:"47ba75a6551616d22113c0573c5be5f3deb3e7c0",id:"entry-type-select",onIonChange:e=>this.updateParam("entryType",e),value:this.diveSite.information.entryType})),a("app-form-item",{key:"b30b322458a4e61a9a75699b1d7f507ecd72f3fc","label-tag":"name","label-text":"Name",value:this.diveSite.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"874bc28bdd96042189df1089cb9ac88f1a9875fa","label-tag":"description","label-text":"Description",value:this.diveSite.description,name:"description",textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("ion-list-header",{key:"cc1f74cd88a4da42d7f54aab600bcf567fe7879b"},a("ion-label",{key:"c9a6a4da2f936ce78fb9ed471512729812b96c07"},a("my-transl",{key:"7fb903e3db07dc29855a55d077053a8f6b7dcfd1",tag:"site-details",text:"Site Details"}))),a("ion-grid",{key:"43ca6cbe95a353ffd9f1c41a9f43e675cd0a5bee",class:"ion-no-padding"},a("ion-row",{key:"bdeb217b2996eb599dd4a7c0e3fa6fdc309cebcb"},a("ion-col",{key:"8c3a8ccf3e3a00b200df30a202649538f21852db"},a("app-form-item",{key:"501c86194b068881cf260b101bebfe53d228cd80","label-tag":"min-depth","label-text":"Min. Depth","append-text":" (m)",value:u.exports.toString(this.diveSite.information.minDepth),name:"minDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})),a("ion-col",{key:"2314aa76a39853b8c7be64b4d13a1706aa535ba7"},a("app-form-item",{key:"bad86e14b54e0b0a52db1f5cc454a67a7add6f73","label-tag":"max-depth","label-text":"Max. Depth","append-text":" (m)",value:u.exports.toString(this.diveSite.information.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})))),a("app-form-item",{key:"7e03ff655068e8eea2d0729ba19154dbab5175b8","label-tag":"avg-vis","label-text":"Average Visibility","append-text":" (m)",value:u.exports.toString(this.diveSite.information.avgViz),name:"avgViz","input-type":"text",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}),a("ion-list-header",{key:"018dbdc64e300b959618b13b1db526a06a28bfb0"},a("my-transl",{key:"17411d3745d59910c08a16ce691273542db8eacd",tag:"water-temp",text:"Water Temperature","append-text":" (°C)",isLabel:true})),a("ion-grid",{key:"8f8f2f663169361f712e17b227353be151fcdee8",class:"ion-no-padding"},a("ion-row",{key:"d390f48fdc42d201782963fc86aa1b8303ece63b"},a("ion-col",{key:"5505b768440f7f353173f91e9468f3ed59990576"},a("app-form-item",{key:"31621bbcab638bf63f4ae9eca65699215e204704","label-tag":"spring","label-text":"Spring",value:u.exports.toString(this.diveSite.information.waterTemp.spring),name:"waterTemp.spring","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),a("ion-col",{key:"bbe270de40059d90de7f3f00e76c196093b6bfdd"},a("app-form-item",{key:"f566b68578b8084a7e9207b635d4b9938f6ebdfe","label-tag":"summer","label-text":"Summer",value:u.exports.toString(this.diveSite.information.waterTemp.summer),name:"waterTemp.summer","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}))),a("ion-row",{key:"99a93be096c7c4e2c8acdc342b4701d6d97ae091"},a("ion-col",{key:"a13eb396414537f1dcfa0b0b53e6e3bd5428a3c2"},a("app-form-item",{key:"a4b65d3a00f11105d2e595f3d8154ad4f604c418","label-tag":"autumn","label-text":"Autumn",value:u.exports.toString(this.diveSite.information.waterTemp.autumn),name:"waterTemp.autumn","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),a("ion-col",{key:"8bd16a536f86fb2ec318d8d93dd9f629f5fda575"},a("app-form-item",{key:"28c065c987c164536b2206ee6ec22c8b1603e173","label-tag":"winter","label-text":"Winter",value:u.exports.toString(this.diveSite.information.waterTemp.winter),name:"waterTemp.winter","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})))),a("ion-item",{key:"5d4266b2e53063a82b0fde338a21ce67e84bf168"},a("ion-label",{key:"5e63a66ae2985131721849565c988edf82f548b9"},a("my-transl",{key:"b6406bd4db1605039c5b2e17133f3af84c99d5d2",tag:"seabed-comp",text:"Seabed Composition"})),a("ion-select",{key:"42a073f9d2640b6cd94878b0e17685f2e6de2109",id:"seabed-comp-select",multiple:true,onIonChange:e=>this.updateParam("seabedComposition",e),value:this.diveSite.information.seabedComposition})),a("ion-item",{key:"424f963cb7141696cef70e4277ab4c3fb45b5d3a"},a("ion-label",{key:"a0e707fcec150ae02b1650cd63702896d9c2574d"},a("my-transl",{key:"b0b7cb50dbf89724d6e82dae67054846a58ee17d",tag:"seabed-cover",text:"Seabed Cover"})),a("ion-select",{key:"d5629e2faa2d54494673ae9a0b11b64ab092fd91",id:"seabed-cover-select",multiple:true,onIonChange:e=>this.updateParam("seabedCover",e),value:this.diveSite.information.seabedCover})))),a("swiper-slide",{key:"152cc515897f0c9f340e2f019f158a8dec49c5da",class:"swiper-slide"},a("ion-grid",{key:"db4c5bccc1677f4b9c46fe7bbdbc2f3e6ec1cfda"},a("ion-row",{key:"d43409e2bff3c7704b49c991f6f57a1758ff9a7f",class:"ion-text-start"},this.diveSite.divePlans.map(((e,t)=>a("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},a("app-dive-plan-card",{divePlan:e,edit:true,onViewEmit:e=>this.viewDivePlan(e,t),onRemoveEmit:()=>this.removeDivePlan(t)})))),a("ion-col",{key:"c10b2a1d5dec240dcfac5ce6743ce60fa63d04e4","size-sm":"12","size-md":"6","size-lg":"4"},a("ion-card",{key:"bcb1d24bebb7f22a7c980fabf9d1dd25fc5bc574",onClick:()=>this.addDivePlan()},a("ion-card-content",{key:"55f55aa594b54c68b3d415eaf85d078a35c97cc7",class:"ion-text-center"},a("ion-icon",{key:"f68dcd5766cdd1d54becee650cf7ac838e83b305",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),a("swiper-slide",{key:"c58437d61602c5baacc5a6b5266886e86917540d",class:"swiper-slide"},a("app-users-list",{key:"07874966103945ad06d33cf475e865b08353a5b3",item:this.diveSite,editable:true,show:["owner","editor"]}))))),a("app-modal-footer",{key:"8d7b616e837d698bcf004a881beb5ea7b76ea996",disableSave:!this.validSite,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};w.style=v;export{w as modal_dive_site_update};