{"version":3,"names":["modalProjectBricksallocationareaCss","ModalProjectBricksallocationareaStyle0","ModalBricksAllocationArea","componentWillLoad","this","loadBricksAllocationAreas","ProjectsService","downloadProjectSettings","bricksAllocationAreas","cloneDeep","getBricksAllocationAreas","length","bricksAllocationArea","addBricksAllocationArea","validateProject","selectType","ev","detail","value","handleChange","n","name","v","replace","trim","toLowerCase","validBricksAllocationArea","isString","bricksAllocationAreaId","updateView","BricksAllocationArea","push","index","duplicateBricksAllocationArea","deleteBricksAllocationArea","splice","error","SystemService","presentAlertError","save","dismiss","uploadProjectSettings","modalController","cancel","render","h","Host","key","lines","color","id","interface","label","TranslationService","getTransl","disabled","onIonChange","map","bricksAllocationAreaName","en","size","class","fill","onClick","slot","onFormItemChanged","labelPosition","validator","options","type","list","multiLanguage","Environment","getAppColor","disableSave","onCancelEmit","onSaveEmit"],"sources":["src/components/trasteel/modals/modal-project-bricksallocationarea/modal-project-bricksallocationarea.scss?tag=modal-project-bricksallocationarea","src/components/trasteel/modals/modal-project-bricksallocationarea/modal-project-bricksallocationarea.tsx"],"sourcesContent":["modal-project-bricksallocationarea {\n  ion-list {\n    width: 100%;\n  }\n}\n","import {Component, h, Host, State, Element} from \"@stencil/core\";\nimport {modalController} from \"@ionic/core\";\nimport {cloneDeep, isString} from \"lodash\";\nimport {TranslationService} from \"../../../../services/common/translations\";\nimport {Environment} from \"../../../../global/env\";\nimport {SystemService} from \"../../../../services/common/system\";\nimport {BricksAllocationArea} from \"../../../../interfaces/trasteel/refractories/projects\";\nimport {ProjectsService} from \"../../../../services/trasteel/refractories/projects\";\n\n@Component({\n  tag: \"modal-project-bricksallocationarea\",\n  styleUrl: \"modal-project-bricksallocationarea.scss\",\n})\nexport class ModalBricksAllocationArea {\n  @Element() el: HTMLElement;\n  @State() index: number = 0;\n  @State() bricksAllocationAreas: BricksAllocationArea[];\n  @State() bricksAllocationArea: BricksAllocationArea;\n  @State() updateView = true;\n  @State() validBricksAllocationArea = false;\n\n  async componentWillLoad() {\n    await this.loadBricksAllocationAreas();\n  }\n\n  async loadBricksAllocationAreas() {\n    await ProjectsService.downloadProjectSettings();\n    this.bricksAllocationAreas = cloneDeep(\n      ProjectsService.getBricksAllocationAreas()\n    );\n    if (this.bricksAllocationAreas && this.bricksAllocationAreas.length > 0) {\n      this.bricksAllocationArea = this.bricksAllocationAreas[0];\n    } else {\n      //create new and add to list\n      this.addBricksAllocationArea();\n    }\n    this.validateProject();\n  }\n\n  selectType(ev) {\n    this.bricksAllocationArea = this.bricksAllocationAreas[ev.detail.value];\n    this.validateProject();\n  }\n\n  handleChange(ev) {\n    const n = ev.detail.name;\n    let v = ev.detail.value;\n    if (n == \"familyId\") {\n      //remove spaces and lowercase\n      v = v.replace(/\\s+/g, \"-\").trim().toLowerCase();\n    }\n    this.bricksAllocationArea[n] = v;\n    this.validateProject();\n  }\n\n  validateProject() {\n    this.validBricksAllocationArea =\n      isString(this.bricksAllocationArea.bricksAllocationAreaId) &&\n      isString(this.bricksAllocationArea.bricksAllocationAreaId);\n    this.updateView = !this.updateView;\n  }\n\n  addBricksAllocationArea() {\n    this.bricksAllocationArea = new BricksAllocationArea();\n    this.bricksAllocationAreas.push(this.bricksAllocationArea);\n    this.index = this.bricksAllocationAreas.length - 1;\n  }\n\n  duplicateBricksAllocationArea() {\n    this.bricksAllocationArea = cloneDeep(this.bricksAllocationArea);\n    this.bricksAllocationArea.bricksAllocationAreaId =\n      this.bricksAllocationArea.bricksAllocationAreaId + \"_rev.\";\n    this.bricksAllocationAreas.push(this.bricksAllocationArea);\n    this.index = this.bricksAllocationAreas.length - 1;\n  }\n\n  async deleteBricksAllocationArea() {\n    try {\n      this.bricksAllocationAreas.splice(this.index, 1);\n      this.index = 0;\n      this.bricksAllocationArea = this.bricksAllocationAreas[0];\n      this.validateProject();\n    } catch (error) {\n      if (error) SystemService.presentAlertError(error);\n    }\n  }\n\n  async save(dismiss = true) {\n    await ProjectsService.uploadProjectSettings(\n      \"bricksAllocationArea\",\n      this.bricksAllocationAreas\n    );\n    return dismiss ? modalController.dismiss() : true;\n  }\n\n  async cancel() {\n    return modalController.dismiss();\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-content>\n          <ion-grid>\n            <ion-row>\n              <ion-col>\n                <ion-item lines=\"none\">\n                  <ion-select\n                    color=\"trasteel\"\n                    id=\"selectType\"\n                    interface=\"action-sheet\"\n                    label={TranslationService.getTransl(\n                      \"project_bricksallocationarea\",\n                      \"Project Bricks Allocation Area\"\n                    )}\n                    disabled={!this.validBricksAllocationArea}\n                    label-placement=\"floating\"\n                    onIonChange={(ev) => this.selectType(ev)}\n                    value={this.index ? this.index : 0}\n                  >\n                    {this.bricksAllocationAreas.map(\n                      (bricksAllocationArea, index) => (\n                        <ion-select-option value={index}>\n                          {bricksAllocationArea.bricksAllocationAreaId +\n                            \" | \" +\n                            bricksAllocationArea.bricksAllocationAreaName.en}\n                        </ion-select-option>\n                      )\n                    )}\n                  </ion-select>\n                </ion-item>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validBricksAllocationArea}\n                  onClick={() => this.addBricksAllocationArea()}\n                >\n                  <ion-icon name=\"add\" slot=\"start\" />\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validBricksAllocationArea}\n                  onClick={() => this.duplicateBricksAllocationArea()}\n                >\n                  <ion-icon slot=\"start\" name=\"duplicate\"></ion-icon>\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  color=\"danger\"\n                  disabled={this.bricksAllocationAreas.length == 0}\n                  onClick={() => this.deleteBricksAllocationArea()}\n                >\n                  <ion-icon slot=\"start\" name=\"trash\"></ion-icon>\n                </ion-button>\n              </ion-col>\n            </ion-row>\n          </ion-grid>\n          <app-form-item\n            label-text=\"ID\"\n            value={this.bricksAllocationArea.bricksAllocationAreaId}\n            name=\"bricksAllocationAreaId\"\n            input-type=\"string\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\n              \"required\",\n              {\n                name: \"uniqueid\",\n                options: {\n                  type: \"list\",\n                  index: \"bricksAllocationAreaId\",\n                  list: ProjectsService.getBricksAllocationAreas(),\n                },\n              },\n            ]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"Name\"\n            value={this.bricksAllocationArea.bricksAllocationAreaName}\n            name=\"bricksAllocationAreaName\"\n            input-type=\"text\"\n            multiLanguage={true}\n            text-rows=\"1\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\"required\"]}\n          ></app-form-item>\n        </ion-content>\n        <app-modal-footer\n          color={Environment.getAppColor()}\n          disableSave={!this.validBricksAllocationArea}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}