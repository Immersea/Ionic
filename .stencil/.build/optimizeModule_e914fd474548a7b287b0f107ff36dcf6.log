import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as s}from"./p-5d4a8e1f.js";import{l as o}from"./p-1af05547.js";import{S as l}from"./p-a75993af.js";import{U as d,n as c,Q as n,$ as r,a0 as p,T as f,S as h}from"./p-30358c9d.js";import{E as m}from"./p-a9f4af61.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-2578d979.js";import"./p-7ee16e8d.js";const b="modal-datasheet-update #properties-grid .showbool{--ion-grid-column-padding:1px}modal-datasheet-update #properties-grid ion-grid{--ion-grid-column-padding:2px;border-collapse:collapse;border-style:hidden}modal-datasheet-update #properties-grid ion-grid ion-row:first-child{background-color:var(--ion-color-trasteel);font-weight:bold;color:var(--ion-color-trasteel-contrast)}modal-datasheet-update #properties-grid ion-grid ion-col{border:1px solid black;border-bottom:0;border-right:0}modal-datasheet-update #properties-grid ion-grid ion-col:last-child{border-right:1px solid black}modal-datasheet-update #properties-grid ion-grid ion-row:last-child{border-bottom:1px solid black}modal-datasheet-update #properties-grid ion-grid .remove-background{padding:0}modal-datasheet-update #properties-grid ion-grid .remove-background ion-col,modal-datasheet-update #properties-grid ion-grid .remove-background ion-row{border:0px solid black;background-color:white;padding:0}";const u=b;const y=class{constructor(t){e(this,t);this.validDatasheet=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"properties",text:"Properties",disabled:false},{tag:"reference",text:"Reference",disabled:false},{tag:"comments",text:"Comments",disabled:false},{tag:"files",text:"Files",disabled:true}];this.datasheetId=undefined;this.duplicateDatasheet=undefined;this.revision=undefined;this.datasheet=undefined;this.updateView=true;this.scrollTop=0;this.propertyNames={};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=d.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));await this.loadDatasheet()}async loadDatasheet(){if(this.datasheetId){const e=await n.getDatasheet(this.datasheetId);this.datasheet=e}else{const e=new r(this.duplicateDatasheet?this.duplicateDatasheet.datasheet:null);if(this.duplicateDatasheet&&this.revision){e.revisionNo=e.revisionNo+1}else{e.techNo=n.getMaxDatasheetTechNo();e.revisionNo=0}e.users={[d.userRoles.uid]:["owner"]};this.datasheet=e}this.validateDatasheet()}async componentDidLoad(){this.slider=new l(".slider-edit-datasheet",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});if(this.datasheet.productName){setTimeout((()=>{Object.keys(this.datasheet.properties).forEach((e=>{this.selectPropertyNameForIndex(e)}));this.validateDatasheet()}))}}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.datasheet[e.detail.name]=e.detail.value;this.validateDatasheet()}handlePropertyChange(e,t){const a=t.detail.name;let i=t.detail.value;this.datasheet.properties[e][a]=i;this.validateDatasheet()}deleteProperty(e){this.datasheet.properties.splice(e,1);this.validateDatasheet()}validateDatasheet(){this.validDatasheet=o.exports.isString(this.datasheet.productName)&&o.exports.isString(this.datasheet.familyId)&&o.exports.isString(this.datasheet.majorFamilyId)&&o.exports.isString(this.datasheet.techNo)&&this.datasheet.classification&&o.exports.isString(this.datasheet.categoriesId)&&this.checkParameters();this.updateSlider()}checkParameters(){let e=true;this.datasheet.properties.forEach((t=>{e=e&&n.getDatasheetPropertyNames("id",t.name)&&(t.typical>0||t.higher>0||t.lower>=0)}));return e}selectMajorFamily(e){this.datasheet.majorFamilyId=e.detail.value;this.validateDatasheet()}selectFamily(e){this.datasheet.familyId=e.detail.value;this.validateDatasheet()}selectCategory(e){this.datasheet.categoriesId=e.detail.value;this.validateDatasheet()}addProperty(){this.datasheet.properties.push(new p);setTimeout((()=>{this.setPropertyTypeSelect(this.datasheet.properties.length-1)}),100)}async setPropertyTypeSelect(e){const t=this.el.querySelector("#selectPropertyType"+e);if(t){const e={header:f.getTransl("type","Type")};t.interfaceOptions=e;const a=Array.from(t.getElementsByTagName("ion-select-option"));a.map((e=>{t.removeChild(e)}));t.placeholder=f.getTransl("select","Select");n.getDatasheetPropertyTypes().map((e=>{const a=document.createElement("ion-select-option");a.value=e.typeId;a.textContent=f.getTransl(e.typeId,e.typeName);t.appendChild(a)}))}this.validateDatasheet()}selectPropertyType(e,t){this.datasheet.properties[e].type=t.detail.value;this.selectPropertyNameForIndex(e);this.validateDatasheet()}selectPropertyNameForIndex(e){let t=n.getDatasheetPropertyNames();if(t.length==0)t=n.getDatasheetPropertyNames();this.propertyNames[e]=t;this.validateDatasheet()}selectPropertyName(e,t){this.datasheet.properties[e].name=t.detail.value;const a=n.getDatasheetPropertyNames("id",t.detail.value)[0];this.datasheet.properties[e].position=a.position;this.validateDatasheet()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteDatasheet(){try{await n.deleteDatasheet(this.datasheetId);s.dismiss()}catch(e){if(e)h.presentAlertError(e)}}async save(e=true){const t=[];this.datasheet.properties.map((e=>{if(e.type&&e.name){t.push(e)}}));this.datasheet.properties=t;const a=await n.updateDatasheet(this.datasheetId,this.datasheet,this.userProfile.uid);if(!this.datasheetId){this.datasheetId=a.id;if(this.duplicateDatasheet&&this.revision){this.duplicateDatasheet.datasheet.oldProduct=true;await n.updateDatasheet(this.duplicateDatasheet.id,this.duplicateDatasheet.datasheet,this.userProfile.uid)}}e?s.dismiss():this.updateSlider()}async cancel(){return s.dismiss()}render(){return t(a,{key:"7ec776a0a654bca31ac42cbc88d115074a1f916f"},t("app-header-segment-toolbar",{key:"858ad02d1173b64caa0822f6878bbeba7bf363ed",color:m.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"1d5339bf0768bed3edaeb053bfe0e8533a49a305",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},t("swiper-container",{key:"0b0ceded5cd2de8db6ec897a1eac77f579be21a4",class:"slider-edit-datasheet swiper"},t("swiper-wrapper",{key:"640bb65fb6682bf3c99344430481fd8c3eba4b67",class:"swiper-wrapper"},t("swiper-slide",{key:"0093b169d3a6d8cb3e660f7da8fab0cd30246830",class:"swiper-slide"},t("ion-list",{key:"d8ee294f6f822c8b3ac4ae4a0d0a00d69c6b9d6b",class:"ion-no-padding"},t("app-select-search",{key:"9cb470a9940c786729735fade612ae86ffe4bc60",color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.datasheet&&this.datasheet.majorFamilyId?this.datasheet.majorFamilyId:null,lines:"inset",selectFn:e=>this.selectMajorFamily(e),selectOptions:n.getDatasheetMajorFamilies(),selectValueId:"majorFamilyId",selectValueText:["majorFamilyName"]}),t("app-select-search",{key:"4fad26046d6cc90cb089ad7f14172ecaed4eb49b",color:"trasteel",label:{tag:"product",text:"Product"},labelAddText:"*",value:this.datasheet&&this.datasheet.familyId?this.datasheet.familyId:null,lines:"inset",selectFn:e=>this.selectFamily(e),selectOptions:n.getDatasheetFamilies(),selectValueId:"familyId",selectValueText:["familyName"]}),t("app-select-search",{key:"093fafdbca97d439e4a1ff8b1f1a18fe4ec83ec0",color:"trasteel",label:{tag:"category",text:"Category"},labelAddText:"*",value:this.datasheet&&this.datasheet.categoriesId?this.datasheet.categoriesId:null,lines:"inset",selectFn:e=>this.selectCategory(e),selectOptions:n.getDatasheetCategories(),selectValueId:"categoriesId",selectValueText:["categoriesName"]}),t("app-form-item",{key:"78a3e7e7ec0009b3970af94eb66aff8a16bb4444",lines:"inset","label-tag":"tech-no","label-text":"Tech. #",value:this.datasheet.techNo,name:"techNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"10b6bf786ca3075fb1824df058632ad3418e4a0b",lines:"inset","label-tag":"revision-no","label-text":"Revision #",value:this.datasheet.revisionNo,name:"revisionNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"169c55835e92aead8a869e0c24f0d32d2b7cf522",lines:"inset","label-tag":"old","label-text":"Old",value:this.datasheet.oldProduct,name:"oldProduct","input-type":"boolean",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"5329e63741debee8e9aeb8e84ceddf7932622a56",lines:"inset","label-tag":"issued-on-date","label-text":"Issued on Date",value:this.datasheet.issuedOnDate,name:"issuedOnDate","input-type":"date","date-presentation":"date","prefer-wheel":false,onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"372db591b62f09efddf307bdcdfab94469f0e682",lines:"inset","label-tag":"product-name","label-text":"Product Name",value:this.datasheet.productName,name:"productName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"a894f325c7fdda0346e244f3929554a977848fd6",lines:"inset","label-tag":"classification","label-text":"Classification",value:this.datasheet.classification,name:"classification","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]}),t("app-form-item",{key:"1384aaa46c8d1b330ee6044d090ce6cfa4d1b68a",lines:"inset","label-tag":"application","label-text":"Application",value:this.datasheet.application,name:"application","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]})),this.datasheetId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteDatasheet()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"eb3680c0a02c2132ff48dbac0d05dc69980d6c6b",class:"swiper-slide"},t("div",{key:"87b850b81fee8fbb24bd558319cdf3b873f5ac68",id:"properties-grid"},t("ion-grid",{key:"09c5d5af4b34f2c713b468d01688d8d7841f8278"},t("ion-row",{key:"e7d597eec4a3ad40ec64425cc3d720f9d3673ed9"},t("ion-col",{key:"93bf73fcb4456d719876223cc87d7d2570306709",class:"centered"},t("small",{key:"bc96343f79f8da5d19daf5c9406673472b917fb9"},f.getTransl("type","Type"))),t("ion-col",{key:"144efcd2b9f0e353778811c9f372e2ac69c9b66b",class:"centered"},t("small",{key:"aad2693e24cb78d5d407cafeb31a92348bca0226"},f.getTransl("name","Name"))),t("ion-col",{key:"48b8f8c4cc96a14ebbf515505fd061d820c552c9",class:"centered"},t("small",{key:"8ed008f62e54ca92d0b18751614dc6959a22d830"},f.getTransl("typical","Typical"))),t("ion-col",{key:"4c95e4a9f3605612d577266e41de5a17499275de",class:"centered"},t("small",{key:"91fd150ed604457f70036f950268a3abe7eb7de9"},f.getTransl("prefix","Prefix"))),t("ion-col",{key:"82a7d5a7f708896bd283dd9821dc46d3e290e730",class:"centered"},t("small",{key:"75470e06521c08f317af25fa96c09514f5d1713c"},f.getTransl("from","From"))),t("ion-col",{key:"e4a16848f8c7a327c4b592bfa7c6abe4875f42a6",class:"centered"},t("small",{key:"5ffc4103f79be43a45284073b1f132027a5b045c"},f.getTransl("to","To"))),t("ion-col",{key:"4e9d053619eff4a2b3d9f08f1fac6fd9127db2b5",size:"1",class:"centered"},t("small",{key:"c80c8cc3ecd5c7700c02bdad0d697d7ea7df7bb2"},f.getTransl("show","Show")+"/"+f.getTransl("delete","Delete")))),this.datasheet.properties.map(((e,a)=>t("ion-row",null,t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.type?e.type:null,lines:"none",selectFn:e=>this.selectPropertyType(a,e),selectOptions:n.getDatasheetPropertyTypes(),selectValueId:"typeId",selectValueText:["typeName"]})),t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.name?e.name:null,lines:"none",disabled:!this.propertyNames[a],selectFn:e=>this.selectPropertyName(a,e),selectOptions:this.propertyNames[a],selectValueId:"nameId",selectValueText:["nameName"]})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.typical,name:"typical","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.prefix,name:"prefix","input-type":"text",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.lower,name:"lower","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.higher,name:"higher","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{size:"1",class:"centered "},t("ion-grid",{class:"remove-background"},t("ion-row",null,t("ion-col",{class:"centered"},t("app-form-item",{class:"ion-no-padding",value:e.show,name:"show","input-type":"boolean",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("ion-button",{class:"ion-no-padding","icon-only":true,color:"danger",fill:"clear",onClick:()=>this.deleteProperty(a)},t("ion-icon",{name:"trash"}))))))))))),t("io-item",{key:"c021cf884fe0ee5e427f5f6d8baa3f242e69f631"},t("ion-button",{key:"91641ba4d7033a2e1beaffefae04c6a523b27474",expand:"full",shape:"round",color:"trasteel",size:"small",onClick:()=>this.addProperty()},"+"))),t("swiper-slide",{key:"380b37396f2b63c947fc65a77ef3359314ad4325",class:"swiper-slide"},t("ion-list",{key:"8a1094ff348b29808c79713e5f807ac2edfeaf59"},t("app-form-item",{key:"b2c4a9560fd83af567e4c42348d93ef4c13c8c35",lines:"inset","label-tag":"producer","label-text":"Producer",value:this.datasheet.producerName,name:"producerName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"484c335278be9d3cb537a353e5d90ac1dfb699d3",lines:"inset","label-tag":"producer-ref-quality","label-text":"Producer Reference Quality",value:this.datasheet.producerReferenceQuality,name:"producerReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"09a9d3c996b413bd5535ca9c570cd2858f47616c",lines:"inset","label-tag":"competitor-ref-quality","label-text":"Competitor Reference Quality",value:this.datasheet.competitorReferenceQuality,name:"competitorReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"1e9a708eca2f46c99023a4ab31244870a971ec54",class:"swiper-slide"},t("ion-list",{key:"dab84cd702a2adc6db2f0f28a7f380ea9694ba86"},t("app-form-item",{key:"90ca1ecb3b5956b623811059e1cd93742b73b991",lines:"inset","label-tag":"comments","label-text":"Comments",value:this.datasheet.comments,name:"comments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"3bd66cc3847cba276a3af169a32f5558a260d69b",lines:"inset","label-tag":"performance-comments","label-text":"Performance Comments",value:this.datasheet.performanceComments,name:"performanceComments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"69fdc490e6a8542e3bf64aabe7925c208f717fcb",class:"swiper-slide"},"FILES - TO BE DONE")))),t("app-modal-footer",{key:"70a5184fe990b00dedceabb8d0b648be114410f5",color:m.getAppColor(),disableSave:!this.validDatasheet,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=u;export{y as modal_datasheet_update};