import{r as e,h as i,f as t}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{i as a}from"./p-694b8ade.js";import{n as o}from"./p-5d4a8e1f.js";import{l as n}from"./p-1af05547.js";import{a4 as s,U as l,a5 as d}from"./p-30358c9d.js";import{E as c}from"./p-a9f4af61.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-2578d979.js";import"./p-7ee16e8d.js";const r="modal-dive-configuration .scrollx{display:flex;flex-wrap:nowrap;overflow-x:auto}modal-dive-configuration .scrollx .item{flex:0 0 0 0}modal-dive-configuration .scrollx ::-webkit-scrollbar{display:none}modal-dive-configuration input{text-align:right}modal-dive-configuration .fixedLabel{min-width:80% !important;max-width:80% !important}modal-dive-configuration ion-item .item-inner{box-shadow:none !important;border-bottom:1px solid #dedede !important}modal-dive-configuration .item-input .label-md,modal-dive-configuration .item-select .label-md,modal-dive-configuration .item-datetime .label-md{color:rgb(0, 0, 0)}";const f=r;const m=class{constructor(i){e(this,i);this.validForm={name:false,depth:false,time:false,bottom:false};this.diveDataToShare=undefined;this.updateView=true;this.showSave=false}componentWillLoad(){this.screenWidth=window.screen.width;this.divePlan=this.diveDataToShare.divePlan;this.diveConfig=this.divePlan.configuration;this.orderTanks();this.ranges=this.divePlan.getParamRanges(this.diveConfig.parameters.units);let e=s.getStdGases();e=n.exports.orderBy(e,"fromDepth","asc");this.bottomGases=n.exports.filter(e,{deco:false});this.decoGases=n.exports.filter(e,{deco:true});let i=l.userSettings.userTanks;i=n.exports.orderBy(i,"volume");const t=n.exports.filter(i,{forDeco:false});const a=n.exports.filter(i,{forDeco:true});this.bottomTanks=[];t.forEach((e=>{this.bottomTanks.push(e.getTank())}));this.decoTanks=[];a.forEach((e=>{this.decoTanks.push(e.getTank())}));this.stdConfigurations=s.getStdConfigurations();this.userStdConfigurations=n.exports.cloneDeep(l.userSettings.userConfigurations)}componentDidLoad(){this.validateAll()}async addTank(e,i,t){let s={tank:t,tanksList:null,stdGasesList:null,ccr:this.diveConfig.parameters.configuration=="CCR",parameters:this.diveConfig.parameters,decoTanks:!i};if(i){s.tanksList=this.bottomTanks;s.stdGasesList=this.bottomGases}else{s.tanksList=this.decoTanks;s.stdGasesList=this.decoGases}var l=undefined;if(a("capacitor")){l="custom-mobile-popover";e=null}const d=await o.create({component:"popover-tank",event:e,translucent:true,backdropDismiss:false,cssClass:l,componentProps:s});d.present();d.onDidDismiss().then((e=>{e=e.data;if(e){let a;if(i){a=this.diveConfig.configuration.bottom}else{a=this.diveConfig.configuration.deco}if(!t){a.push(e)}else{let i=n.exports.indexOf(a,t);a.splice(i,1,e)}this.orderTanks();this.validateForm("tanks")}}))}deleteTank(e,i){let t;if(e){t=this.diveConfig.configuration.bottom}else{t=this.diveConfig.configuration.deco}t.splice(i,1);this.orderTanks()}orderTanks(){this.diveConfig.configuration.bottom=n.exports.orderBy(this.diveConfig.configuration.bottom,"gas.fromDepth");this.diveConfig.configuration.deco=n.exports.orderBy(this.diveConfig.configuration.deco,"gas.fromDepth");this.updateView=!this.updateView}updateParams(e){this.divePlan.parameters=e}save(){this.el.closest("ion-modal").dismiss(this.diveConfig)}close(){this.el.closest("ion-modal").dismiss()}inputHandler(e){this.diveConfig[e.detail.name]=e.detail.value}validateAll(){this.validForm.name=this.diveConfig.stdName.length>=3;this.validForm.depth=this.diveConfig.maxDepth>1;this.validForm.time=this.diveConfig.maxTime>1;this.validateForm("tanks");this.updateView=!this.updateView}validateForm(e,i){if(e=="name"){this.validForm.name=i}else if(e=="time"){this.validForm.time=i}else if(e=="depth"){this.validForm.depth=i}else{this.validForm.bottom=this.bottomTanks.length>0}this.showSave=this.validForm.name&&this.validForm.time&&this.validForm.depth&&this.validForm.bottom}copyConfiguration(e){this.diveConfig=e;this.validateAll()}render(){return[i("app-navbar",{key:"11f4501616b1b3fb4522c56ffe76a37431dfbc05",tag:"dive-configuration",text:"Dive Configuration",color:c.getAppColor(),modal:true}),i("ion-content",{key:"f9bc3ad605667e568d7a5904fa3cc1f96d0f9086"},i("ion-list",{key:"ed7be1a4ee3b0fd279cbd24e076453033d5edc32"},i("ion-list-header",{key:"f1a48bde8e842dd700f17b580cb18e90c2cbadc0"},"Copy from standard configuration"),i("ion-row",{key:"009eb2233237b8bf8f84af9385dea086259037ee",class:"scrollx",id:"scrollTankGas"},this.userStdConfigurations?this.userStdConfigurations.map((e=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:c.getAppColor(),onClick:()=>this.copyConfiguration(e)},e.stdName)))):undefined,this.stdConfigurations?this.stdConfigurations.map((e=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:"success",onClick:()=>this.copyConfiguration(e)},"DP-",e.stdName)))):undefined),i("app-form-item",{key:"1cb8b0ede8dfd4e5b95ec04419b6a8f8db424033","label-tag":"configuration-name","label-text":"Configuration Name",value:this.diveConfig.stdName,name:"stdName","input-type":"text",onFormItemChanged:e=>this.inputHandler(e),validator:["required"],onIsValid:e=>this.validateForm("name",e.detail)}),i("app-form-item",{key:"881dc8006465334b0db26b6cd863f65599326855","label-tag":"max-depth","label-text":"Max Depth (xxx)",labelReplace:{xxx:this.diveConfig.parameters.depthUnit},value:n.exports.toString(this.diveConfig.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),validator:["required",{name:"minvalue",options:{min:1}}],onIsValid:e=>this.validateForm("depth",e.detail)}),i("app-form-item",{key:"7199aaf6cf6c311fa7468d199fdde09fa1415ae6","label-tag":"max-time","label-text":"Max Time (min)",value:n.exports.toString(this.diveConfig.maxTime),name:"maxTime","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),validator:["required",{name:"minvalue",options:{min:1}}],onIsValid:e=>this.validateForm("time",e.detail)}),i("ion-list-header",{key:"feef8378963d4f6fbd38efe2a738ff622cce5bca"},i("my-transl",{key:"2b8fe2804bac096d5855b2836bb6a89556bcb195",tag:"tanks-configuration",text:"Tank(s) Configuration",isLabel:true})),i("ion-list-header",{key:"fa7ed6b5833a1566d1a65497c52d358b1dc804d4"},i("ion-grid",{key:"ae3cc463e0f34a54a924d3a13e7b7b52a17b45c1",class:"ion-no-padding"},i("ion-row",{key:"8cee29e79e9329b306c45795d09120d133a16ae2"},i("ion-col",{key:"54af8976555cc4027d6ab8936badc2d0ddc0df8c"},i("my-transl",{key:"fe2d6ccffab4a57e0286f13eb86c0377e35edee6",tag:"bottom",text:"Bottom",isLabel:true})),i("ion-col",{key:"d305a802d40077da253ac805055d4179c79857cc",size:"1"},i("ion-row",{key:"4c3944f654cce5fedc1d91bb998d9eb455a693a3",class:"ion-text-center"},i("ion-button",{key:"d7daa62f1ac211117d4a6a25ea4ae4cdc0e78959","icon-only":true,fill:"clear",color:"primary",onClick:e=>this.addTank(this.screenWidth>=500?e:null,true)},i("ion-icon",{key:"8272977a1044afaa79fd80d1f15174414e06dfad",name:"add-circle"}))))))),this.diveConfig.configuration.bottom.length>0?i("ion-grid",null,i("ion-row",{class:"ion-text-center"},this.diveConfig.configuration.bottom.map(((e,t)=>i("ion-col",{size:"12","size-sm":true},e.name?i("ion-card",null,i("ion-card-header",{class:"ion-text-center"},e.name),i("ion-card-content",{class:"ion-text-center"},i("p",null,e.gas.toString()),i("p",null,e.pressure,d.pressUnit," / ",e.getGasVolume(),d.volumeUnit)),i("ion-grid",{class:"ion-no-padding"},i("ion-row",null,i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:i=>this.addTank(this.screenWidth>=500?i:null,true,e)},i("ion-icon",{name:"create"}),i("my-transl",{tag:"edit",text:"Edit"}))),i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:()=>this.deleteTank(true,t)},i("ion-icon",{name:"trash"}),i("my-transl",{tag:"delete",text:"Delete"})))))):undefined))))):undefined,i("ion-list-header",{key:"cc10129f35c43be2bb63e848adddd1ff24ed689f"},i("ion-grid",{key:"1d9d036b6f341dad3649c2dfcc86292a17f6e90c",class:"ion-no-padding"},i("ion-row",{key:"6aaa7d4c86852dbe3d7cb6429ae335a33fb2bc78"},i("ion-col",{key:"06f899770bfbc2e7552e29460141922066c3b68e"},i("my-transl",{key:"a11682fba9f1f3a587f8be4d20b36ca21fe1e2b8",tag:"deco",text:"Deco",isLabel:true})),i("ion-col",{key:"950ab56b72faa9c14bcb0d7fc284c80ac7eea948",size:"1"},i("ion-row",{key:"86b7f5e63ed20ee7ebad0dc735f26fef64207af4",class:"ion-text-center"},i("ion-button",{key:"253bf5d176ba9458c51fe53e46a3e9be19d902c5","icon-only":true,fill:"clear",color:"primary",onClick:e=>this.addTank(this.screenWidth>=500?e:null,false)},i("ion-icon",{key:"0f9918562c8e08b458657624868ffe5998fc3b31",name:"add-circle"}))))))),this.diveConfig.configuration.deco.length>0?i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-text-center"},this.diveConfig.configuration.deco.map(((e,t)=>i("ion-col",{size:"12","size-sm":true},e.name?i("ion-card",null,i("ion-card-header",{class:"ion-text-center"},e.name),i("ion-card-content",{class:"ion-text-center"},i("p",null,e.gas.toString()),i("p",null,e.pressure,d.pressUnit," / ",e.getGasVolume(),d.volumeUnit)),i("ion-grid",{class:"ion-no-padding"},i("ion-row",null,i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:i=>this.addTank(this.screenWidth>=500?i:null,false,e)},i("ion-icon",{name:"create"}),i("my-transl",{tag:"edit",text:"Edit"}))),i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:()=>this.deleteTank(false,t)},i("ion-icon",{name:"trash"}),i("my-transl",{tag:"delete",text:"Delete"})))))):undefined))))):undefined,i("app-decoplanner-settings",{key:"fa10ec2de289be31447cae1570b2f8d4f7d5e588",diveDataToShare:this.diveDataToShare,onUpdateParamsEvent:e=>this.updateParams(e)}))),i("app-modal-footer",{key:"cd2b9c8d58d5a34cc5f97633324d16531d0ade14",disableSave:!this.showSave,onCancelEmit:()=>this.close(),onSaveEmit:()=>this.save()})]}get el(){return t(this)}};m.style=f;export{m as modal_dive_configuration};