import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import{U as s,p as c,t as o,T as d,ai as n,ap as l,R as r,E as b}from"./p-f42b650b.js";import"./p-c7ee7cfe.js";import{b as f,n as h}from"./p-c2915cc5.js";import{I as p,a as m,b as u}from"./p-0ee9e57c.js";import{S as y}from"./p-a75993af.js";import{l as k}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-immersea-location-update ion-list{width:100%}modal-immersea-location-update modal-quill-editor{width:100%;height:var(--mapHeight)}";const w=g;const v=class{constructor(a){e(this,a);this.stdConfigurations=[];this.mediaToUpload={};this.locationId=undefined;this.immerseaLocation=undefined;this.segment="information";this.updateView=true;this.validLocation=false;this.mediaArray={video:[],photo:[],documents:[]};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new o(e);this.stdConfigurations=k.exports.cloneDeep(this.userSettings.userConfigurations)}));this.segmentTitles={information:d.getTransl("information","Information"),article:d.getTransl("article","Article"),gallery:d.getTransl("gallery","Gallery"),map:d.getTransl("map","Map"),position:d.getTransl("position","Position"),team:d.getTransl("team","Team")};await this.loadImmerseaLocation()}async loadImmerseaLocation(){if(this.locationId){this.immerseaLocation=await p.getLocation(this.locationId);this.draggableMarkerPosition={lat:this.immerseaLocation.position.geopoint.latitude,lon:this.immerseaLocation.position.geopoint.longitude}}else{this.immerseaLocation=new m;this.immerseaLocation.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}orderMedia(){const e=[];const a=[];const t=[];Object.keys(this.immerseaLocation.media).map((i=>{const s=this.immerseaLocation.media[i];if(s.type.includes("application")){e.push(s)}else if(s.type.includes("video")){t.push(s)}else if(s.type.includes("image")){a.push(s)}}));this.mediaArray.documents=k.exports.orderBy(e,"order");this.mediaArray.video=k.exports.orderBy(t,"order");this.mediaArray.photo=k.exports.orderBy(a,"order")}async componentDidLoad(){this.slider=new y(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null;this.slider.updateSize()}}});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+n(this.immerseaLocation,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateLocation()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#sections-select");const a={header:d.getTransl("sections","Sections")};e.interfaceOptions=a;e.placeholder=d.getTransl("select","Select");k.exports.each(p.getSections(),(async a=>{const t=document.createElement("ion-select-option");t.value=a.tag;t.textContent=await d.getTransl(a.tag,a.text);e.appendChild(t)}));const t=this.el.querySelector("#topics-select");const i={header:d.getTransl("topics","Topics")};t.interfaceOptions=i;t.placeholder=d.getTransl("select","Select");k.exports.each(p.getTopics(),(async e=>{const a=document.createElement("ion-select-option");a.value=e.tag;a.textContent=await d.getTransl(e.tag,e.text);t.appendChild(a)}))}updateLocation(e){this.draggableMarkerPosition={lat:k.exports.toNumber(e.detail.lat),lon:k.exports.toNumber(e.detail.lon)};this.immerseaLocation.position=l.getPosition(e.detail.lat,e.detail.lon);this.validateLocation()}updateAddress(e){this.immerseaLocation.setAddress(e.detail)}handleChange(e){this.immerseaLocation[e.detail.name]=e.detail.value;this.validateLocation()}updateParam(e,a){let t=a.detail.value;switch(e){case"sections":this.immerseaLocation.sections=t;break;case"topics":this.immerseaLocation.topics=t;break}this.validateLocation()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break;case"article":this.slider.slideTo(1);break;case"gallery":this.slider.slideTo(2);break;case"map":this.slider.slideTo(3);this.mapElement.triggerMapResize();break;case"position":this.slider.slideTo(4);break;case"team":this.slider.slideTo(5);break}}}async slideChanged(){const e=this.slider.activeIndex;this.slider.update();switch(e){case 0:this.segment="information";break;case 1:this.segment="article";break;case 2:this.segment="gallery";break;case 3:this.segment="map";this.mapElement.triggerMapResize();break;case 4:this.segment="position";break;case 5:this.segment="team";break}}updateImageUrls(e){const a=e.detail.type;const t=e.detail.url;if(a=="photo"){this.immerseaLocation.photoURL=t}else{this.immerseaLocation.coverURL=t}}async addMedia(){if(this.locationId){const e=await r.openPopover("popover-media-loading");e.onDidDismiss().then((e=>{if(e&&e.data){this.immerseaLocation.media[e.data.media.id]=e.data.media;this.mediaToUpload[e.data.media.id]=e.data}}))}else{const e=await f.create({header:d.getTransl("media","Media"),message:d.getTransl("media-loader-error","Please save the item to upload new media."),buttons:[{text:d.getTransl("ok","OK")}]});e.present()}}async openEditor(){const e=await r.openModal("modal-quill-editor",{immerseaLocation:this.immerseaLocation});e.onDidDismiss().then((async e=>{if(e&&e.data){this.immerseaLocation.article=e.data;this.updateView=!this.updateView}}))}updatePublic(e){this.immerseaLocation.public=e.detail.checked;this.validateLocation()}validateLocation(){this.validLocation=this.immerseaLocation&&this.immerseaLocation.position&&k.exports.isNumber(this.immerseaLocation.position.geopoint.latitude)&&k.exports.isNumber(this.immerseaLocation.position.geopoint.longitude)&&this.immerseaLocation.sections.length>0&&this.immerseaLocation.topics.length>0&&k.exports.isString(this.immerseaLocation.region)&&k.exports.isString(this.immerseaLocation.displayName)}async save(){if(Object.keys(this.mediaToUpload).length>0){const e=await r.openPopover("popover-media-uploader",{files:this.mediaToUpload,itemId:this.locationId,collectionId:u});e.onDidDismiss().then((e=>{if(e&&e.data){const a=e.data;Object.keys(a).forEach((e=>{this.immerseaLocation.media[e].url=a[e]}));return this.saveLocation()}}))}else{return this.saveLocation()}}async saveLocation(){await p.updateLocation(this.locationId,this.immerseaLocation,this.userProfile.uid);return h.dismiss()}async cancel(){return h.dismiss()}render(){return a(t,{key:"a9efdb95a444e11550e692d780929808800a6ca2"},a("ion-header",{key:"ac807f63560128873640f41970a8e6fca98004fe"},a("app-upload-cover",{key:"9ac51e0da285b42b233633a04d5afd4ea0105cec",item:{collection:u,id:this.locationId,photoURL:this.immerseaLocation.photoURL,coverURL:this.immerseaLocation.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),a("ion-header",{key:"d004c8bdd24a1af2b133f7e6d7ae500a66decb59"},a("ion-toolbar",{key:"f03161cf321e7a36a0b6e61c4dcefb7b66f8f873"},a("ion-segment",{key:"7d566f2afc1c2d8306b888a7729b5712e288bba4",mode:"md",color:b.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},a("ion-segment-button",{key:"ebaf80bb635bd898bdf6e67e94ce46769e408479",value:"information",layout:"icon-start"},a("ion-label",{key:"6ff323e254aa1ccdc994025d9dc68bdf074fac7d"},this.segmentTitles.information)),a("ion-segment-button",{key:"6f2886d12a4bcc4ec487997f0d60574e6036b11f",value:"article",layout:"icon-start"},a("ion-label",{key:"d51a7de04ca2483fef43d8171bd81a30e2a9748b"},this.segmentTitles.article)),a("ion-segment-button",{key:"e5e43df2a7d44cc0c194850837415ce3c38e3c0a",value:"gallery",layout:"icon-start",disabled:!this.locationId},a("ion-label",{key:"2c787374a31baf78c08b8f5aed07b510bc476a86"},this.segmentTitles.gallery)),a("ion-segment-button",{key:"bb74255d6ea7ae6efac4a66d7286f96a5fbf0686",value:"map",layout:"icon-start"},a("ion-label",{key:"d960f7fe8977fb94375e830c0ad08f392c362b87"},this.segmentTitles.map)),a("ion-segment-button",{key:"790a6f1dd32d2768d8016d84d583aaf70ce753a8",value:"position",layout:"icon-start"},a("ion-label",{key:"d58ec684a546e6fb37f531a770a6b8ad065c34e7"},this.segmentTitles.position)),a("ion-segment-button",{key:"0758d265d7be4ca311f3af4a9698b22249fb730d",value:"team",layout:"icon-start"},a("ion-label",{key:"9ea7cd159b295568b482ca80a46938f972853527"},this.segmentTitles.team))))),a("ion-content",{key:"0c0f68aab713705cddb48599668792c62b596d9c",class:"slides"},a("swiper-container",{key:"9e756f8e178f1ac487c27d0569f6a7a648d41da3",class:"slider-dive-site swiper"},a("swiper-wrapper",{key:"fb2218d4f553ce074059cc8e59ab5ca2835c970b",class:"swiper-wrapper"},a("swiper-slide",{key:"8b27a22724730d94df57030b6ee11c7914b7c052",class:"swiper-slide"},a("ion-list",{key:"10a4fdba2f9e0ef0aaddde9936d24a282752cbfc",class:"ion-no-padding"},a("ion-item",{key:"e7c9f8b24c98fbce264aac2cf03cc29cfb3b3383"},a("ion-label",{key:"d3646c80c8db6b2ab57de9cff9539435ff65dbba"},a("my-transl",{key:"8bae4af6dafc400c371d0f9ea0334880b32ea262",tag:"public",text:"Public"})),a("ion-toggle",{key:"095eb79cfb72c3f418886c3c4232cc3fa4eb7049",slot:"end",onIonChange:e=>this.updatePublic(e),checked:this.immerseaLocation.public})),a("ion-item",{key:"a7f28f64c726148e890cffee4cd13ded2749a7fc"},a("ion-label",{key:"827d9d14344428491ac3f8a3156f8e99cc1bde2a"},a("my-transl",{key:"93c4d12943eb111a269d3193dda3a7d36960bd7e",tag:"sections",text:"Sections"}),a("sup",{key:"b2ab9611bd0d646b546183583d5552f97fd5e258"},"*")),a("ion-select",{key:"c11e21de6b4a632ad24ff608034c7d98abc6faea",id:"sections-select",onIonChange:e=>this.updateParam("sections",e),value:this.immerseaLocation.sections,multiple:true})),a("ion-item",{key:"142cb19339bc6abc919d728d598823d434e6099b"},a("ion-label",{key:"50ca559df429034451a3cfcb469f77eb01a4e5bd"},a("my-transl",{key:"8ae5bb9068fd471c793f767c83fb7b5ca82d3d42",tag:"topics",text:"Topics"}),a("sup",{key:"6736432a72ffd0ab6ade9b2a905994dfe3072925"},"*")),a("ion-select",{key:"c3c4a5cd9334ecd923459a63ce431d715c0668e6",id:"topics-select",onIonChange:e=>this.updateParam("topics",e),value:this.immerseaLocation.topics,multiple:true})),a("app-form-item",{key:"47245224da22585b750fe4f5d6c178fb3af97b1d","label-tag":"region","label-text":"Region",value:this.immerseaLocation.region,placeholder:"Sicilia Tirrenica, Sicilia Ionica, etc...",name:"region","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"58798a650db52cfa3f3d02e6ce5830047de8d943","label-tag":"area","label-text":"Area",value:this.immerseaLocation.area,placeholder:"Capo San Vito, Palermo, etc...",name:"area","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),a("app-form-item",{key:"0b71ce21623b76fdee6629ead7e89bfac335845d","label-tag":"name","label-text":"Name",value:this.immerseaLocation.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"9ef5a8ffee7f0b10751b156cba17d5c03d3dd3f4","label-tag":"short-description","label-text":"Short Description",value:this.immerseaLocation.shortDescription,name:"shortDescription",multiLanguage:true,textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}))),a("swiper-slide",{key:"0763a97cf53e3021bbb0ac84b808507e47515de9",class:"swiper-slide"},a("modal-quill-editor",{key:"7b12c5959e19695f8d2d122bfb895917bc6825de",immerseaLocation:this.immerseaLocation,updateView:this.updateView,readOnly:true,onEdit:()=>this.openEditor()})),a("swiper-slide",{key:"076119756ca390141da68b1f6a28c99d2b296b40",class:"swiper-slide"},a("ion-list",{key:"9de02ae20d6026af844fe2e113533a7f4b0b906f"},a("ion-item",{key:"caf9931978463a7629813cf65a479c3f35ff7f06",button:true,onClick:()=>this.addMedia()},a("ion-icon",{key:"92e5e078fc3ade33eb3ee87427b00757f34f8f20",slot:"start",name:"add"}),a("ion-label",{key:"0d3cb3c08a21ad250d63dc9d5c5629f023781a7c"},"Aggiungi")),Object.keys(this.mediaToUpload).length>0?[a("ion-list-header",null,"File da caricare"),Object.keys(this.mediaToUpload).map((e=>a("ion-item",null,a("ion-label",null,this.mediaToUpload[e].media.title))))]:undefined,a("ion-list-header",{key:"d668e0c7d8a026974a761b80af5ef45ece67fd71"},"Photo"),this.mediaArray.photo.length>0?this.mediaArray.photo.map((e=>a("ion-item",null,a("ion-label",null,e.title)))):a("ion-item",null,a("ion-label",null,"Nessuna foto caricata")),a("ion-list-header",{key:"eb8768744df14a6b3fd534b757c78f6a02765f59"},"Video"),this.mediaArray.video.length>0?this.mediaArray.video.map((e=>a("ion-item",null,a("ion-label",null,e.title)))):a("ion-item",null,a("ion-label",null,"Nessun video caricato")),a("ion-list-header",{key:"14bb5d303d66f496f4b262c2b6bdba8bcca03bfb"},"Documenti"),this.mediaArray.documents.length>0?this.mediaArray.documents.map((e=>a("ion-item",null,a("ion-label",null,e.title)))):a("ion-item",null,a("ion-label",null,"Nessun documento caricato")))),a("swiper-slide",{key:"63d8eb474a06ed00784c4d36cf245c61d722a680",class:"swiper-slide"},a("div",{key:"f2314ff7fdfa336b2d46f5652bfa169dd8e6aa99",id:"map-container"},a("app-map",{key:"7865065aafad87a3e09f67a3fe87da637aad1acc",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),a("swiper-slide",{key:"50b9c8398a1ee42ffaa2bbac528afa4877170355",class:"swiper-slide"},a("app-coordinates",{key:"e65039e599f2cd332e5c7e24c7fac2a58b7e9083",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),a("swiper-slide",{key:"be6bb5d2ccabd16cd88acf145a558cefe3aae851",class:"swiper-slide"},a("app-users-list",{key:"712b5535dc239926daf116d8ce4e85e042fe0bd0",item:this.immerseaLocation,editable:true,show:["owner","editor"]}))))),a("app-modal-footer",{key:"97efed9dc8574095edd3fd47638ed883a56514f3",disableSave:!this.validLocation,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=w;export{v as modal_immersea_location_update};