import{r as t,h as e,f as i,e as n}from"./p-cbe60c68.js";import{U as s,T as o,aa as a,w as l,z as d,c,aE as h}from"./p-b9378908.js";import{l as r}from"./p-1af05547.js";import{E as f}from"./p-a9f4af61.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-c7ee7cfe.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const u="app-dive-trip-bookings{width:100%;height:100%}";const b=u;const m=class{constructor(e){t(this,e);this.availableSpots=[];this.diveTrip=undefined;this.diveTripId=undefined;this.tripDiveIndex=undefined;this.editable=false;this.isEditing=false;this.segment=0;this.tripDive=undefined;this.bookingsList=undefined;this.waitingRequest=false;this.updateView=false;this.userBooking=undefined}componentWillLoad(){this.tripDive=this.diveTrip.tripDives[this.tripDiveIndex];this.userSub=s.userProfile$.subscribe((t=>{this.userId=t&&t.uid?t.uid:null;this.updateBookingsList()}));this.userId=s.userProfile&&s.userProfile.uid?s.userProfile.uid:null;this.updateBookingsList();this.segmentTitles={notinterested:o.getTransl("not-interested","Not Interested"),interested:o.getTransl("interested","Interested"),attend:o.getTransl("attend","Attend")}}disconnectedCallback(){this.userSub.unsubscribe()}async updateBookingsList(){this.bookingsList=[];this.availableSpots=[];this.usersList=[];let t=r.exports.orderBy(this.tripDive.bookings,["team"]);let e=0;let i=t[0]&&t[0].team?t[0].team:0;t.map((t=>{if(t.team>i){e++;i=t.team}t.team=e}));this.tripDive.bookings=t;i=-1;console.log("this.tripDive",this.tripDive);for(let e of t){if(e.team>i){this.bookingsList.push(e.team);i=e.team}let t=Object.assign(Object.assign({},e),{user:await s.getMapDataUserDetails(e.uid)});this.bookingsList.push(t);if(this.userId&&e.uid===this.userId){this.userBooking=e}}let n=0;this.tripDive.bookings.map((t=>{if(t.confirmedOrganiser){n++}}));for(let t=0;t<this.tripDive.numberOfParticipants-n;t++){this.availableSpots.push(0)}this.updateView=!this.updateView}segmentChanged(t){if(t.detail.value){this.segment=r.exports.toNumber(t.detail.value)}}async addBooking(t){const e=t.detail.value=="true"?true:t.detail.value=="false"?false:null;let i=this.userBooking?this.userBooking:{role:"diver",team:0,uid:this.userId,confirmedUser:e,confirmedOrganiser:false};try{this.waitingRequest=true;const t=await a.sendBookingRequest(this.diveTripId,this.tripDiveIndex,i.role,i.team,i.uid,e,i.confirmedOrganiser);this.waitingRequest=false;this.tripDive.bookings=t;this.updateBookingsList()}catch(t){this.waitingRequest=false}}updateBooking(t,e){const i=this.bookingsList[t];const n=this.tripDive.bookings.find((t=>t.uid===i.uid));n.confirmedOrganiser=e.detail.value=="true"?true:e.detail.value=="false"?false:null}editBookings(){this.isEditing=true}saveBookings(){this.isEditing=false;this.updateBookingsList()}addTeam(){let t=0;this.bookingsList.map((e=>{if(r.exports.isNumber(e))t=e}));this.bookingsList.push(t+1);this.updateView=!this.updateView}reorderTeams(t){const e=t.detail.from;const i=t.detail.to;const n=this.bookingsList[e];const s=this.tripDive.bookings.find((t=>t.uid===n.uid));let o=false;let a=0;this.bookingsList.map(((t,e)=>{if(r.exports.isNumber(t))a=t;if(i<=e&&!o){s.team=a;o=true}}));this.bookingsList=t.detail.complete(this.bookingsList)}render(){return e("ion-card",{key:"76263d805c0a31519dc74bcf0d0edb800d0301df"},e("ion-card-header",{key:"460128bb1071b2d2c540ac07f974fecc1c9950d7"},e("ion-card-title",{key:"41d09eba2bd8796114516c7847ba8c6360188357"},e("ion-item",{key:"64d7a5565f297e570e62079823903ab30bdd3642",class:"ion-no-padding",lines:"none"},e("ion-label",{key:"f4cad6f5f24a0268426b727f85dcccd47688e754"},l.format(this.tripDive.divePlan.dives[0].date,"PP")))),e("ion-card-subtitle",{key:"2f9234c5e4f30985d3c7b0412f28ce02a77b69b4"},e("ion-item",{key:"f8bdbe7dcbf57e29edee9ec05a8d579782380e88",class:"ion-no-padding",lines:"none"},e("ion-label",{key:"29993b11f7bfc3ab25429057cc7ced921ad44d4a"},this.tripDive.divePlan.title+" -> "+o.getTransl("max-participants","Max xxx participants",{xxx:this.tripDive.numberOfParticipants})),this.editable&&this.tripDive.bookings&&this.tripDive.bookings.length>0?!this.isEditing?e("ion-button",{slot:"end",onClick:()=>this.editBookings()},e("my-transl",{tag:"edit",text:"Edit"})):[e("ion-button",{slot:"end",onClick:()=>this.addTeam()},e("my-transl",{tag:"add-team",text:"Add Team"})),e("ion-button",{slot:"end",onClick:()=>this.saveBookings()},e("my-transl",{tag:"save",text:"Save"}))]:undefined))),e("ion-card-content",{key:"9bfa24936166728f467749b2e5b6ff266c6226c1"},!this.editable?e("ion-segment",{mode:"ios",color:f.getAppColor(),disabled:this.waitingRequest,onIonChange:t=>this.addBooking(t),value:this.userBooking?this.userBooking.confirmedUser.toString():""},e("ion-segment-button",{value:"",layout:"icon-start"},e("ion-icon",{name:"close-outline"}),e("ion-label",null,this.segmentTitles.notinterested)),e("ion-segment-button",{value:"false",layout:"icon-start"},e("ion-icon",{name:"help-outline"}),e("ion-label",null,this.segmentTitles.interested)),e("ion-segment-button",{value:"true",layout:"icon-start"},e("ion-icon",{name:"checkmark-outline"}),e("ion-label",null,this.segmentTitles.attend))):undefined,e("ion-list",{key:"1dafd0f6d08f139d468a15914bcc155568ba80a7"},e("ion-reorder-group",{key:"1f87f2962be0c80ba9ab8283ca2d6de3592e75b9",disabled:!this.isEditing,onIonItemReorder:t=>this.reorderTeams(t)},this.waitingRequest&&!this.userBooking?e("app-skeletons",{skeleton:"diveTripBooking"}):undefined,this.bookingsList.map(((t,i)=>r.exports.isNumber(t)?e("ion-item-divider",null,e("ion-label",null,"Team ",t+1)):t.uid==this.userId&&this.waitingRequest?e("app-skeletons",{skeleton:"diveTripBooking"}):e("ion-item",null,!this.isEditing&&t.user.photoURL?e("ion-avatar",{slot:"start"},e("ion-img",{src:t.user.photoURL})):e("ion-reorder",{slot:"start"}),e("ion-label",null,t.user.displayName),t.confirmedUser?e("ion-icon",{slot:"end",color:"success",name:"checkmark-outline"}):e("ion-icon",{slot:"end",color:"warning",name:"help-outline"}),!this.isEditing?t.confirmedOrganiser?e("ion-icon",{slot:"end",color:"success",name:"checkmark-outline"}):e("ion-icon",{slot:"end",color:"warning",name:"help-outline"}):e("ion-segment",{style:{maxWidth:"40%",marginLeft:"15%"},slot:"end",mode:"ios",color:f.getAppColor(),onIonChange:t=>this.updateBooking(i,t),value:t.confirmedOrganiser.toString()},e("ion-segment-button",{value:""},e("ion-icon",{color:"danger",name:"close-outline"})),e("ion-segment-button",{value:"false"},e("ion-icon",{color:"warning",name:"help-outline"})),e("ion-segment-button",{value:"true"},e("ion-icon",{color:"success",name:"checkmark-outline"}))))))),this.availableSpots.map((()=>e("ion-item",null,e("ion-icon",{slot:"start",name:"person-add-outline"}),e("ion-label",null,e("my-transl",{tag:"available",text:"Available"}))))))))}get el(){return i(this)}};m.style=b;const p="app-dive-trip-card{width:100%;height:100%}";const g=p;const k=class{constructor(e){t(this,e);this.updateDiveEmit=n(this,"updateDiveEmit",7);this.addDiveEmit=n(this,"addDiveEmit",7);this.removeDiveTripEmit=n(this,"removeDiveTripEmit",7);this.removeTripDiveEmit=n(this,"removeTripDiveEmit",7);this.diveSites=[];this.divingCenters=[];this.tripDive=undefined;this.editable=false;this.updateView=false;this.segment=0;this.loogBookButton=undefined}update(){this.findDiveSites()}componentWillLoad(){this.findDiveSites();this.userSub=s.userProfile$.subscribe((t=>{this.userId=t&&t.uid?t.uid:null;this.activateLogbook()}));this.userId=s.userProfile&&s.userProfile.uid?s.userProfile.uid:null;this.activateLogbook()}activateLogbook(){this.loogBookButton=false;this.tripDive.bookings.map((t=>{if(t.uid==this.userId){this.loogBookButton=true}}))}findDiveSites(){this.diveSites=[];this.divingCenters=[];this.tripDive.divePlan.dives.forEach((t=>{this.diveSites.push(d.diveSitesList.find((e=>e.id===t.diveSiteId)));this.divingCenters.push(c.divingCentersList.find((e=>e.id===t.divingCenterId)))}))}updateDivePlan(t,e){t.stopPropagation();this.updateDiveEmit.emit(e)}removeDiveTrip(){this.removeDiveTripEmit.emit()}addDivePlan(){this.addDiveEmit.emit()}removeDivePlan(t,e){t.stopPropagation();this.segment=this.segment-1;this.removeTripDiveEmit.emit(e)}segmentChanged(t){if(t.detail.value){this.segment=r.exports.toNumber(t.detail.value)}}createDivePlan(t){if(t.configuration){h.createNewDivePlan(t)}else{h.createNewDivePlanWithConfiguration(t)}}render(){return e("ion-card",{key:"509cfd9d3adfd304482cf0885b9a7b483e95acce"},e("ion-card-header",{key:"a9f3ee5bf3847022813ff2fbb07ece04ed69599d"},e("ion-card-title",{key:"ae9da0e78c20ccfa44612d81771dbaeda0267715"},e("ion-item",{key:"c7ff1a73f1ec7a4ce3845f6ecad0b632bb6b3c1a",class:"ion-no-padding",lines:"none"},e("ion-label",{key:"26783fdf4ddab92706e1742dd6217b09bb2e2fa8"},l.format(this.tripDive.divePlan.dives[0].date,"PP")),this.editable?[e("ion-button",{"icon-only":true,slot:"end",color:"danger",fill:"clear",onClick:()=>this.removeDiveTrip()},e("ion-icon",{name:"trash-bin-outline"})),e("ion-button",{"icon-only":true,slot:"end",color:"divetrip",fill:"clear",onClick:()=>this.addDivePlan()},e("ion-icon",{name:"add-circle"}))]:undefined)),e("ion-card-subtitle",{key:"0c74d4c337384fdea3d13704f8a0c94a16dd5dac"},this.tripDive.divePlan.title+" -> "+o.getTransl("max-participants","Max xxx participants",{xxx:this.tripDive.numberOfParticipants}))),e("ion-card-content",{key:"2ee2dce41e2da436210a154e74ae62ee1aa1f110"},this.tripDive.divePlan.dives.length>1?e("ion-toolbar",null,e("ion-segment",{mode:"md",color:f.getAppColor(),onIonChange:t=>this.segmentChanged(t),value:this.segment.toString()},Object.keys(this.tripDive.divePlan.dives).map((t=>e("ion-segment-button",{value:t},e("ion-label",null,e("my-transl",{tag:"dive",text:"Dive"})," "+(r.exports.toNumber(t)+1)+": "+l.format(this.tripDive.divePlan.dives[t].date,"p"))))))):undefined,e("ion-card",{key:"85475f307ad0a06d1904356d179fc2bd65bf867f"},this.diveSites[this.segment]?e("app-item-cover",{item:this.diveSites[this.segment]}):undefined,e("ion-card-header",{key:"9b33374ba1b47c2b633c169ef487016018d3bd49"},e("ion-card-subtitle",{key:"76f3497f104fa9e3003c1dca018039f15f6782e0"},this.diveSites[this.segment]?e("h2",null,this.diveSites[this.segment].displayName):undefined,this.divingCenters[this.segment]?e("h3",null,this.divingCenters[this.segment].displayName):undefined),e("ion-card-title",{key:"97b9c939295c100b82d737a4efeefdd75705291b"},e("ion-item",{key:"bb07b83805980a68dcfd6476baff36c2e011594f",class:"ion-no-padding",lines:"none"},e("ion-label",{key:"6e00dceef8e507a112f908fb2c621b7948cef9c9"},l.format(this.tripDive.divePlan.dives[this.segment].date,"p")),this.editable?[this.segment>0?e("ion-button",{"icon-only":true,slot:"end",color:"danger",fill:"clear",onClick:t=>this.removeDivePlan(t,this.segment)},e("ion-icon",{name:"trash-bin-outline"})):undefined,e("ion-button",{"icon-only":true,slot:"end",color:"primary",fill:"clear",onClick:t=>this.updateDivePlan(t,this.segment)},e("ion-icon",{name:"create"}))]:undefined))),this.tripDive.divePlan.configuration?e("ion-card-content",null,this.tripDive.divePlan.dives[this.segment].getProfilePointsDetails().map((t=>e("p",{class:"ion-text-start"},t)))):undefined)),!this.editable&&this.loogBookButton?e("ion-button",{expand:"full",color:"secondary",onClick:()=>this.createDivePlan(this.tripDive.divePlan)},this.tripDive.divePlan.dives.length==1?e("my-transl",{tag:"log-dive",text:"Log Dive"}):e("my-transl",{tag:"log-dives",text:"Log Dives"})):undefined)}get el(){return i(this)}static get watchers(){return{updateView:["update"]}}};k.style=g;export{m as app_dive_trip_bookings,k as app_dive_trip_card};