import{r as e,h as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as n}from"./p-5d4a8e1f.js";import{l as t}from"./p-1af05547.js";import{ak as i,U as s,t as o,o as l,aj as c,ag as d,T as r,aW as h,am as p,R as m,E as f}from"./p-9424d4f6.js";import{S as u}from"./p-a75993af.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const g="page-dive-planner .cards-container{margin:0;margin-bottom:1rem;}page-dive-planner .cards-column{margin-bottom:1rem !important;}page-dive-planner .card{display:flex;flex-direction:column;height:100%;box-sizing:border-box;cursor:pointer;transition:transform 0.2s ease-in-out;}page-dive-planner .card:hover{transform:scale(1.02);}page-dive-planner .card-content{flex-grow:1;}page-dive-planner .card-margins{margin-bottom:1rem;}page-dive-planner .add-card{min-height:200px;}page-dive-planner .add-card-content{display:flex;justify-content:center;align-items:center;height:100%;width:100%;}page-dive-planner .add-icon{width:70%;height:70%;}";const v=g;const b=class{constructor(a){e(this,a);this.plans=[];this.stdDiveProfile={depth:i.isMetric()?30:100,time:30,fO2:.32,fHe:0,setpoint:1.4};this.isLoaded=false;this.stdConfigurations=[];this.maxLocalPlans=15;this.localPlans=[];this.scrollTop=0}componentWillLoad(){this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new o(e);this.loadLocalData()}))}componentDidLoad(){if(!this.userSettings){s.initLocalUser()}this.swiper=new u(".swiper",{speed:400,spaceBetween:100,allowTouchMove:true})}async loadLocalData(){if(this.userSettings&&this.userSettings.settings){this.stdConfigurations=t.exports.cloneDeep(this.userSettings.userConfigurations);this.localPlans=this.userSettings.localPlans;this.orderPlans()}else{const e=await l.getLocalDocument("localplans");this.stdConfigurations=c.getStdConfigurations();if(e){this.localPlans=[];e.forEach((e=>{const a=new d(e);this.localPlans.push(a)}))}else{this.localPlans=c.getDivePlansFromConfigurations(this.stdConfigurations);l.saveLocalDocument("localplans",this.localPlans)}this.orderPlans()}}disconnectedCallback(){this.userSettingsSub$.unsubscribe()}async addDivePlan(){if(this.localPlans.length>=this.maxLocalPlans){const e=await n.create({header:r.getTransl("max-plans","Maximum Plans"),message:r.getTransl("max-plans-descr","You can store a maximum of xxx plans. Use the 'Logbook' for additional plans.",{xxx:this.maxLocalPlans}),buttons:[{text:r.getTransl("ok","OK")}]});e.present()}else{let e=[];if(s.userProfile&&s.userProfile){e.push({type:"radio",label:"New Configuration",value:-1,checked:false})}t.exports.forEach(this.stdConfigurations,((a,n)=>{e.push({type:"radio",label:a.stdName,value:n,checked:n==0?true:false})}));const a=await n.create({header:r.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:r.getTransl("ok","OK"),handler:async e=>{if(e>-1){this.addDivePlanWithConf(this.stdConfigurations[e])}else{let e=await s.checkLicence("configs",true);if(e){const e=s.userSettings.userConfigurations[0];const a=new h(e);a.stdName="";a.configuration.bottom=[];a.maxDepth=0;a.maxTime=0;const n=new p;n.setConfiguration(a);const t=await m.openModal("modal-dive-configuration",{diveDataToShare:{divePlan:n,showConfigurations:true}});t.onDidDismiss().then((e=>{e=e.data;if(e){const a=new h(e);const n=[a].concat(this.userSettings.userConfigurations);this.userSettings.userConfigurations=n;s.updateUserConfigurations(this.userSettings.userConfigurations);this.addDivePlanWithConf(a)}}))}}}},{text:r.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});a.present()}}async addDivePlanWithConf(e){const a=await m.openModal("modal-dive-planner",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,index:0,user:this.userSettings});a.onDidDismiss().then((e=>{const a=e.data;if(a){this.localPlans.push(a);this.updatePlans()}}))}async viewDive(e){const a=await m.openModal("modal-dive-planner",{addDive:false,divePlanModel:this.localPlans[e],stdConfigurations:this.stdConfigurations,index:0,user:this.userSettings});a.onDidDismiss().then((a=>{const n=a.data;if(n){this.localPlans[e]=n;this.updatePlans()}}))}updatePlans(){if(this.userSettings&&this.userSettings.localPlans){s.updateUserLocalPlans(this.localPlans)}else{l.saveLocalDocument("localplans",this.localPlans);this.loadLocalData()}}orderPlans(){this.localPlans=t.exports.orderBy(this.localPlans,"configuration.stdName")}async removeDive(e,a){e.stopPropagation();const t=await n.create({header:r.getTransl("delete-dive-header","Delete dive?"),message:r.getTransl("delete-dive-message","This dive plan will be deleted! Are you sure?"),buttons:[{text:r.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:r.getTransl("ok","OK"),handler:()=>{this.localPlans.splice(a,1);this.updatePlans()}}]});t.present()}render(){return[a("app-navbar",{key:"ea027dbcbc0311b18fa20c66eb6fd0e86375431a",tag:"deco-planner",text:"Deco Planner",color:f.isDecoplanner()?"gue-blue":"planner"}),a("ion-content",{key:"84a2073f5b46faf9e1266bff0e682e268a297afa"},this.localPlans.length>0?a("ion-grid",{class:"ion-no-padding"},a("ion-row",{class:"ion-no-padding cards-container"},this.localPlans.map(((e,n)=>a("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4",class:"ion-no-padding cards-column"},a("ion-card",{onClick:()=>this.viewDive(n),class:"card"},a("div",{class:"card-content"},a("ion-card-header",null,a("ion-card-subtitle",null,a("ion-item",{lines:"none",class:"ion-no-padding"},a("ion-button",{"icon-only":true,slot:"end",color:"danger",fill:"clear",onClick:e=>this.removeDive(e,n)},a("ion-icon",{name:"trash-bin-outline"})),a("ion-label",null,a("h1",null,e.configuration.stdName))),e.dives[0].getProfilePointsDetails().map((e=>a("p",{class:"ion-text-start"},e))))),a("ion-card-content",null,e.configuration.configuration.bottom.length>0?a("p",null,a("my-transl",{tag:"bottom-tanks",text:"Bottom Tanks"}),":"):undefined,e.configuration.configuration.bottom.map((e=>a("p",null,e.name+"->"+e.gas.toString()))),e.configuration.configuration.deco.length>0?a("p",null,a("my-transl",{tag:"deco-tanks",text:"Deco Tanks"}),":"):undefined,e.configuration.configuration.deco.map((e=>a("p",null,e.name+"->"+e.gas.toString()))))))))),a("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4",class:"ion-no-padding cards-column"},a("ion-card",{class:"card add-card",onClick:()=>this.addDivePlan()},a("ion-card-content",{class:"card-content add-card-content"},a("ion-icon",{name:"add-circle-outline",class:"add-icon"})))))):undefined)]}};b.style=v;export{b as page_dive_planner};