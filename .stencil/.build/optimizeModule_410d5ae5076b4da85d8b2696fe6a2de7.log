import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as s}from"./p-c2915cc5.js";import{l as o}from"./p-1af05547.js";import{S as l}from"./p-a75993af.js";import{U as d,n as c,a6 as n,ad as r,ae as p,T as h,S as f,E as b}from"./p-773bd3de.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const m="modal-datasheet-update #properties-grid .showbool{--ion-grid-column-padding:1px}modal-datasheet-update #properties-grid ion-grid{--ion-grid-column-padding:2px;border-collapse:collapse;border-style:hidden}modal-datasheet-update #properties-grid ion-grid ion-row:first-child{background-color:var(--ion-color-trasteel);font-weight:bold;color:var(--ion-color-trasteel-contrast)}modal-datasheet-update #properties-grid ion-grid ion-col{border:1px solid black;border-bottom:0;border-right:0}modal-datasheet-update #properties-grid ion-grid ion-col:last-child{border-right:1px solid black}modal-datasheet-update #properties-grid ion-grid ion-row:last-child{border-bottom:1px solid black}modal-datasheet-update #properties-grid ion-grid .remove-background{padding:0}modal-datasheet-update #properties-grid ion-grid .remove-background ion-col,modal-datasheet-update #properties-grid ion-grid .remove-background ion-row{border:0px solid black;background-color:white;padding:0}";const u=m;const y=class{constructor(t){e(this,t);this.validDatasheet=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"properties",text:"Properties",disabled:false},{tag:"reference",text:"Reference",disabled:false},{tag:"comments",text:"Comments",disabled:false},{tag:"files",text:"Files",disabled:true}];this.datasheetId=undefined;this.duplicateDatasheet=undefined;this.revision=undefined;this.datasheet=undefined;this.updateView=true;this.scrollTop=0;this.propertyNames={};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=d.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));await this.loadDatasheet()}async loadDatasheet(){if(this.datasheetId){const e=await n.getDatasheet(this.datasheetId);this.datasheet=e}else{const e=new r(this.duplicateDatasheet?this.duplicateDatasheet.datasheet:null);if(this.duplicateDatasheet&&this.revision){e.revisionNo=e.revisionNo+1}else{e.techNo=n.getMaxDatasheetTechNo();e.revisionNo=0}e.users={[d.userRoles.uid]:["owner"]};this.datasheet=e}this.validateDatasheet()}async componentDidLoad(){this.slider=new l(".slider-edit-datasheet",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});if(this.datasheet.productName){setTimeout((()=>{Object.keys(this.datasheet.properties).forEach((e=>{this.selectPropertyNameForIndex(e)}));this.validateDatasheet()}))}}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.datasheet[e.detail.name]=e.detail.value;this.validateDatasheet()}handlePropertyChange(e,t){const a=t.detail.name;let i=t.detail.value;this.datasheet.properties[e][a]=i;this.validateDatasheet()}deleteProperty(e){this.datasheet.properties.splice(e,1);this.validateDatasheet()}validateDatasheet(){this.validDatasheet=o.exports.isString(this.datasheet.productName)&&o.exports.isString(this.datasheet.familyId)&&o.exports.isString(this.datasheet.majorFamilyId)&&o.exports.isString(this.datasheet.techNo)&&this.datasheet.classification&&o.exports.isString(this.datasheet.categoriesId)&&this.checkParameters();this.updateSlider()}checkParameters(){let e=true;this.datasheet.properties.forEach((t=>{e=e&&n.getDatasheetPropertyNames("id",t.name)&&(t.typical>0||t.higher>0||t.lower>=0)}));return e}selectMajorFamily(e){this.datasheet.majorFamilyId=e.detail.value;this.validateDatasheet()}selectFamily(e){this.datasheet.familyId=e.detail.value;this.validateDatasheet()}selectCategory(e){this.datasheet.categoriesId=e.detail.value;this.validateDatasheet()}addProperty(){this.datasheet.properties.push(new p);setTimeout((()=>{this.setPropertyTypeSelect(this.datasheet.properties.length-1)}),100)}async setPropertyTypeSelect(e){const t=this.el.querySelector("#selectPropertyType"+e);if(t){const e={header:h.getTransl("type","Type")};t.interfaceOptions=e;const a=Array.from(t.getElementsByTagName("ion-select-option"));a.map((e=>{t.removeChild(e)}));t.placeholder=h.getTransl("select","Select");n.getDatasheetPropertyTypes().map((e=>{const a=document.createElement("ion-select-option");a.value=e.typeId;a.textContent=h.getTransl(e.typeId,e.typeName);t.appendChild(a)}))}this.validateDatasheet()}selectPropertyType(e,t){this.datasheet.properties[e].type=t.detail.value;this.selectPropertyNameForIndex(e);this.validateDatasheet()}selectPropertyNameForIndex(e){let t=n.getDatasheetPropertyNames();if(t.length==0)t=n.getDatasheetPropertyNames();this.propertyNames[e]=t;this.validateDatasheet()}selectPropertyName(e,t){this.datasheet.properties[e].name=t.detail.value;const a=n.getDatasheetPropertyNames("id",t.detail.value)[0];this.datasheet.properties[e].position=a.position;this.validateDatasheet()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteDatasheet(){try{await n.deleteDatasheet(this.datasheetId);s.dismiss()}catch(e){if(e)f.presentAlertError(e)}}async save(e=true){const t=[];this.datasheet.properties.map((e=>{if(e.type&&e.name){t.push(e)}}));this.datasheet.properties=t;const a=await n.updateDatasheet(this.datasheetId,this.datasheet,this.userProfile.uid);if(!this.datasheetId){this.datasheetId=a.id;if(this.duplicateDatasheet&&this.revision){this.duplicateDatasheet.datasheet.oldProduct=true;await n.updateDatasheet(this.duplicateDatasheet.id,this.duplicateDatasheet.datasheet,this.userProfile.uid)}}e?s.dismiss():this.updateSlider()}async cancel(){return s.dismiss()}render(){return t(a,{key:"e258962fd79a1281f4fe0566dc458395e32c34ce"},t("app-header-segment-toolbar",{key:"d5ab3e3d90ab8fbcaf9d68cf4bfc72cb55f0dec0",color:b.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"1548a6251d71c65f24d190f9b4ed901dad017753",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},t("swiper-container",{key:"0539e8dd0bd9f922cbf8f718e2e2ee24192b67fb",class:"slider-edit-datasheet swiper"},t("swiper-wrapper",{key:"6fa69f3a0b1ba96c7de5ff235594153128fbf94a",class:"swiper-wrapper"},t("swiper-slide",{key:"7a795e38dc3e948c4e9e0f7f10d5697fd870907b",class:"swiper-slide"},t("ion-list",{key:"2ed6f4d892bfa1bd41124198777cf66baa450f3c",class:"ion-no-padding"},t("app-select-search",{key:"bd25c70f61cbc87a8581f043a140c1059f61e1f6",color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.datasheet&&this.datasheet.majorFamilyId?this.datasheet.majorFamilyId:null,lines:"inset",selectFn:e=>this.selectMajorFamily(e),selectOptions:n.getDatasheetMajorFamilies(),selectValueId:"majorFamilyId",selectValueText:["majorFamilyName"]}),t("app-select-search",{key:"f09c8bc334134706640099261143b1c17c98425e",color:"trasteel",label:{tag:"product",text:"Product"},labelAddText:"*",value:this.datasheet&&this.datasheet.familyId?this.datasheet.familyId:null,lines:"inset",selectFn:e=>this.selectFamily(e),selectOptions:n.getDatasheetFamilies(),selectValueId:"familyId",selectValueText:["familyName"]}),t("app-select-search",{key:"94a0b6a8cecf23b5a2e966369f96d5254c6a7545",color:"trasteel",label:{tag:"category",text:"Category"},labelAddText:"*",value:this.datasheet&&this.datasheet.categoriesId?this.datasheet.categoriesId:null,lines:"inset",selectFn:e=>this.selectCategory(e),selectOptions:n.getDatasheetCategories(),selectValueId:"categoriesId",selectValueText:["categoriesName"]}),t("app-form-item",{key:"27a87465854dd8a088cbc430c429dd29b292aae8",lines:"inset","label-tag":"tech-no","label-text":"Tech. #",value:this.datasheet.techNo,name:"techNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"4e7acd6cec744f0ac0ce1a514f7290378a15a118",lines:"inset","label-tag":"revision-no","label-text":"Revision #",value:this.datasheet.revisionNo,name:"revisionNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"c79ac7ac223127f058adbd763cd0dfc9f79653b9",lines:"inset","label-tag":"old","label-text":"Old",value:this.datasheet.oldProduct,name:"oldProduct","input-type":"boolean",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"ca22eedede68ab33ba12ece9c4498b62f92a62e2",lines:"inset","label-tag":"issued-on-date","label-text":"Issued on Date",value:this.datasheet.issuedOnDate,name:"issuedOnDate","input-type":"date","date-presentation":"date","prefer-wheel":false,onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"74e9c9d1e6e9c4389575824ea446759d3f123659",lines:"inset","label-tag":"product-name","label-text":"Product Name",value:this.datasheet.productName,name:"productName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"8759d9b2772dabc39f6cc09e71406d5fa6e1c094",lines:"inset","label-tag":"classification","label-text":"Classification",value:this.datasheet.classification,name:"classification","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]}),t("app-form-item",{key:"987d7b936cbfb067190d1fdb03dc868325a8d06d",lines:"inset","label-tag":"application","label-text":"Application",value:this.datasheet.application,name:"application","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]})),this.datasheetId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteDatasheet()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"ca76df3b3be2bb970ef4078038564fa01d38b53a",class:"swiper-slide"},t("div",{key:"34a50eba2842a1ee863c9d8effedbdb142b0fa25",id:"properties-grid"},t("ion-grid",{key:"038e5440f083a0ca9794cfa7903cbf2ce2f579e2"},t("ion-row",{key:"7b3073dfbfd84a075867d8a60e01e677676fa888"},t("ion-col",{key:"66e8798435d17b4a044fce5d02b9282aec8cf7f6",class:"centered"},t("small",{key:"674da5974cc36af125dc570a90789a8e4bfb6cb8"},h.getTransl("type","Type"))),t("ion-col",{key:"26809a6c9fd862e90b1b381661eda18c31e2b22d",class:"centered"},t("small",{key:"79b0e5d2edc80e17faee3beb53e43074445acf71"},h.getTransl("name","Name"))),t("ion-col",{key:"ae6e2f57da1df9766219747d4b407903559f3ac2",class:"centered"},t("small",{key:"8871b8cc9dac9dab8ab6c0226404d26bbd690b2f"},h.getTransl("typical","Typical"))),t("ion-col",{key:"41057f223d1af99358104a7572954890ff2335ee",class:"centered"},t("small",{key:"4b774944857b55d481322944480ee8ecf197db6c"},h.getTransl("prefix","Prefix"))),t("ion-col",{key:"2ba305208608abadb7e56adfcf84383dfcbe59c7",class:"centered"},t("small",{key:"ea03814a06856e40f47d4b85595ac9c4900e265e"},h.getTransl("from","From"))),t("ion-col",{key:"6687718ba933be414cf2babfb942907b350b8aaa",class:"centered"},t("small",{key:"81a0e18eeaed9ad8b0c67cdafd573ff833077fcd"},h.getTransl("to","To"))),t("ion-col",{key:"185d528c52c4cce4017a9ea2b625cebedddb7946",size:"1",class:"centered"},t("small",{key:"30c00772bf74e287b79236f241420f220501640f"},h.getTransl("show","Show")+"/"+h.getTransl("delete","Delete")))),this.datasheet.properties.map(((e,a)=>t("ion-row",null,t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.type?e.type:null,lines:"none",selectFn:e=>this.selectPropertyType(a,e),selectOptions:n.getDatasheetPropertyTypes(),selectValueId:"typeId",selectValueText:["typeName"]})),t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.name?e.name:null,lines:"none",disabled:!this.propertyNames[a],selectFn:e=>this.selectPropertyName(a,e),selectOptions:this.propertyNames[a],selectValueId:"nameId",selectValueText:["nameName"]})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.typical,name:"typical","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.prefix,name:"prefix","input-type":"text",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.lower,name:"lower","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.higher,name:"higher","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{size:"1",class:"centered "},t("ion-grid",{class:"remove-background"},t("ion-row",null,t("ion-col",{class:"centered"},t("app-form-item",{class:"ion-no-padding",value:e.show,name:"show","input-type":"boolean",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("ion-button",{class:"ion-no-padding","icon-only":true,color:"danger",fill:"clear",onClick:()=>this.deleteProperty(a)},t("ion-icon",{name:"trash"}))))))))))),t("io-item",{key:"06a137627583671c359acbb7eb068ee96062ef22"},t("ion-button",{key:"3cc28f96ec7f04d3eeec4c25f8d547a73dc52c66",expand:"full",shape:"round",color:"trasteel",size:"small",onClick:()=>this.addProperty()},"+"))),t("swiper-slide",{key:"89fd19fced21be9c0acf4c3b82d619f68b87eb62",class:"swiper-slide"},t("ion-list",{key:"51cf9e0a2d2b88e5b5340452092d12f1ecc859ce"},t("app-form-item",{key:"dbbb2ecac94efd5cbda9b237c279e34de9d80a62",lines:"inset","label-tag":"producer","label-text":"Producer",value:this.datasheet.producerName,name:"producerName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"ff205853c2da327333faf4efade956311db2a203",lines:"inset","label-tag":"producer-ref-quality","label-text":"Producer Reference Quality",value:this.datasheet.producerReferenceQuality,name:"producerReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"5dd4b5ba4b57374f7921433d747e25ea60f0d224",lines:"inset","label-tag":"competitor-ref-quality","label-text":"Competitor Reference Quality",value:this.datasheet.competitorReferenceQuality,name:"competitorReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"5151fcc8620d1666ba9bcb383cfc2fd5172c07c1",class:"swiper-slide"},t("ion-list",{key:"b7661cc7dbf595136361e406bf4c241bdf7022ec"},t("app-form-item",{key:"9350342281d270346615fba7082ef57b7be38fd2",lines:"inset","label-tag":"comments","label-text":"Comments",value:this.datasheet.comments,name:"comments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"b30cc1d0b6c474437bbd3094fe7aa31e9c9da6ae",lines:"inset","label-tag":"performance-comments","label-text":"Performance Comments",value:this.datasheet.performanceComments,name:"performanceComments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"203121b15f8bd18f1c9d989de025453484efebe8",class:"swiper-slide"},"FILES - TO BE DONE")))),t("app-modal-footer",{key:"38c8e05ad825be82614c0c41a3f20afa50a4cdbc",color:b.getAppColor(),disableSave:!this.validDatasheet,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=u;export{y as modal_datasheet_update};