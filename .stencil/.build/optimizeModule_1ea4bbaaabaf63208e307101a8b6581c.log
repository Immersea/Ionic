import{r as e,h as t}from"./p-cbe60c68.js";import{U as i,S as a,R as s,aO as o,v as n,aP as c}from"./p-773bd3de.js";import{l as r}from"./p-1af05547.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-c2915cc5.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const d="page-admin-agencies .cover{height:var(--coverHeight)}";const l=d;const h=class{constructor(t){e(this,t);this.selectedAgency=undefined;this.selectedAgencyCertifications=[];this.isUpdated=false;this.updateView=true}componentWillLoad(){this.userRoles=i.userRoles;this.systemSub=a.systemPreferences$.subscribe((e=>{this.agencies=[];Object.keys(e.divingAgencies).forEach((t=>{if(this.userRoles.isSuperAdmin()||this.userRoles.roles.includes(t.toLowerCase()+"-admin")){const i=e.divingAgencies[t];i.id=t;this.agencies.push(i)}}));if(!this.selectedAgency)this.selectedAgency=r.exports.cloneDeep(this.agencies[0]);this.createCertificationsArray()}))}createCertificationsArray(){this.selectedAgencyCertifications=[];const e=[];Object.keys(this.selectedAgency.certifications).map((t=>{let i=this.selectedAgency.certifications[t];i.id=t;e.push(i)}));this.selectedAgencyCertifications=r.exports.orderBy(e,"order")}disconnectedCallback(){this.systemSub.unsubscribe()}updateAgency(e){this.isUpdated=false;this.selectedAgency=r.exports.cloneDeep(this.agencies.find((t=>t.id==e)));this.createCertificationsArray()}handleChange(e){this.isUpdated=true;this.selectedAgency[e.detail.name]=e.detail.value}async reorderCertifications(e){this.isUpdated=true;const t=r.exports.cloneDeep(this.selectedAgencyCertifications);const i=t.splice(e.detail.from,1)[0];t.splice(e.detail.to,0,i);t.forEach(((e,t)=>{e.order=t}));e.detail.complete(t);this.selectedAgencyCertifications=r.exports.orderBy(t,"order")}async editCertification(e){this.isUpdated=true;let t=null;if(e===undefined){t={id:null,maxDepth:20,name:"",order:this.selectedAgencyCertifications?this.selectedAgencyCertifications.length:0,group:""}}else{t=r.exports.cloneDeep(this.selectedAgencyCertifications[e])}const i=await s.openModal("modal-dive-certification-update",{agencyId:this.selectedAgency.id,diveCertification:t});i.onDidDismiss().then((t=>{const i=t.data;if(i){if(e===undefined){this.selectedAgencyCertifications.push(i)}else{this.selectedAgencyCertifications[e]=i}this.updateView=!this.updateView}}))}updateImageUrls(e){this.isUpdated=true;const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.selectedAgency.photoURL=i}else{this.selectedAgency.coverURL=i}}async save(){this.selectedAgency.certifications={};this.selectedAgencyCertifications.map((e=>{this.selectedAgency.certifications[e.id]=e}));const e=await o.updateDivingAgency(this.selectedAgency.id,this.selectedAgency);if(e){this.isUpdated=false}}cancel(){this.isUpdated=false;this.updateAgency(this.selectedAgency.id)}render(){return[t("ion-header",{key:"83813d20c94a009229f3d971bae7c7e25ab3fb82",class:"cover"},t("app-upload-cover",{key:"83b7f033539b62b7ac11da5e7c21bed69ff72830",item:{collection:n,id:this.selectedAgency.id,photoURL:this.selectedAgency.photoURL,coverURL:this.selectedAgency.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-content",{key:"deae0ba8fd1a82105098e8a8af90c2ea9012ffe1"},t("ion-fab",{key:"161875e51551c3e71583b20368214a625b8b54dd",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:c(0)}},t("ion-menu-button",{key:"ea2e80665c242f6669010659a84b2e846a5cc485",class:"fab-icon"})),t("ion-list",{key:"a5001abde3c0e758cf79daff7634526f9075b803"},this.agencies.length>0?t("ion-item",null,t("ion-label",null,"Select Diving Agency"),t("ion-select",{value:this.selectedAgency.id,onIonChange:e=>this.updateAgency(e.detail.value),interface:"popover"},this.agencies.map((e=>t("ion-select-option",{value:e.id},e.name))))):undefined,t("app-form-item",{key:"91dc473b97e2248dcc6bc438cbc0b960a75f9f14","label-tag":"name","label-text":"Name",value:this.selectedAgency.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"06bdae2eeaddb4ce863f5dde236aa0d1e64f1cdd","label-tag":"website","label-text":"Website",value:this.selectedAgency.website,name:"website","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]})),t("ion-list",{key:"bfe86fc49052ea16ab0797245d15c9935ecd3204"},t("ion-list-header",{key:"d6a4a0ce72e25a95f915cd9fa5eb112fa6476a82"},t("ion-label",{key:"1878346cbac6b21d421d3f05d4081ec96b8ec4b1"},t("my-transl",{key:"f63560bad8d83f3f8fe16643d95366806913c211",tag:"certifications",text:"Certifications"})),t("ion-button",{key:"5b3571e425e409df0ac943337a34b67601d0fc0a","icon-only":true,onClick:()=>this.editCertification()},t("ion-icon",{key:"e61e623158c5b9822a3adb37696167a0bf44aacc",name:"add-circle-outline"}))),t("ion-reorder-group",{key:"a9bb5947b6e65fb9cc00a2de419f62ea3059b2cf",disabled:false,onIonItemReorder:e=>this.reorderCertifications(e)},this.selectedAgencyCertifications.map(((e,i)=>t("ion-item",null,e.photoURL?t("ion-avatar",{slot:"start"},t("img",{src:e.photoURL})):undefined,t("ion-reorder",{slot:"end"}),t("ion-label",null,e.order+1,". ",e.name),t("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.editCertification(i)},t("ion-icon",{name:"create-outline"})))))))),this.isUpdated?t("app-modal-footer",{onSaveEmit:()=>this.save(),onCancelEmit:()=>this.cancel()}):undefined]}};h.style=l;export{h as page_admin_agencies};