import{r as e,h as t}from"./p-cbe60c68.js";import{U as i,S as a,R as s,ax as o,t as n,ay as c}from"./p-736235c6.js";import{l as r}from"./p-1af05547.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const d="page-admin-agencies .cover{height:var(--coverHeight)}";const l=d;const f=class{constructor(t){e(this,t);this.selectedAgency=undefined;this.selectedAgencyCertifications=[];this.isUpdated=false;this.updateView=true}componentWillLoad(){this.userRoles=i.userRoles;this.systemSub=a.systemPreferences$.subscribe((e=>{this.agencies=[];Object.keys(e.divingAgencies).forEach((t=>{if(this.userRoles.isSuperAdmin()||this.userRoles.roles.includes(t.toLowerCase()+"-admin")){const i=e.divingAgencies[t];i.id=t;this.agencies.push(i)}}));if(!this.selectedAgency)this.selectedAgency=r.exports.cloneDeep(this.agencies[0]);this.createCertificationsArray()}))}createCertificationsArray(){this.selectedAgencyCertifications=[];const e=[];Object.keys(this.selectedAgency.certifications).map((t=>{let i=this.selectedAgency.certifications[t];i.id=t;e.push(i)}));this.selectedAgencyCertifications=r.exports.orderBy(e,"order")}disconnectedCallback(){this.systemSub.unsubscribe()}updateAgency(e){this.isUpdated=false;this.selectedAgency=r.exports.cloneDeep(this.agencies.find((t=>t.id==e)));this.createCertificationsArray()}handleChange(e){this.isUpdated=true;this.selectedAgency[e.detail.name]=e.detail.value}async reorderCertifications(e){this.isUpdated=true;const t=r.exports.cloneDeep(this.selectedAgencyCertifications);const i=t.splice(e.detail.from,1)[0];t.splice(e.detail.to,0,i);t.forEach(((e,t)=>{e.order=t}));e.detail.complete(t);this.selectedAgencyCertifications=r.exports.orderBy(t,"order")}async editCertification(e){this.isUpdated=true;let t=null;if(e===undefined){t={id:null,maxDepth:20,name:"",order:this.selectedAgencyCertifications?this.selectedAgencyCertifications.length:0,group:""}}else{t=r.exports.cloneDeep(this.selectedAgencyCertifications[e])}const i=await s.openModal("modal-dive-certification-update",{agencyId:this.selectedAgency.id,diveCertification:t});i.onDidDismiss().then((t=>{const i=t.data;if(i){if(e===undefined){this.selectedAgencyCertifications.push(i)}else{this.selectedAgencyCertifications[e]=i}this.updateView=!this.updateView}}))}updateImageUrls(e){this.isUpdated=true;const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.selectedAgency.photoURL=i}else{this.selectedAgency.coverURL=i}}async save(){this.selectedAgency.certifications={};this.selectedAgencyCertifications.map((e=>{this.selectedAgency.certifications[e.id]=e}));const e=await o.updateDivingAgency(this.selectedAgency.id,this.selectedAgency);if(e){this.isUpdated=false}}cancel(){this.isUpdated=false;this.updateAgency(this.selectedAgency.id)}render(){return[t("ion-header",{key:"5cc12f81f982cac3e320f51e6e5a34572eb60056",class:"cover"},t("app-upload-cover",{key:"707c0571c9f6449aa05930a777e922ddcc76ef97",item:{collection:n,id:this.selectedAgency.id,photoURL:this.selectedAgency.photoURL,coverURL:this.selectedAgency.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-content",{key:"6177d06c2ef7a81d58f7edd1d486eaea832e3c00"},t("ion-fab",{key:"829d16084d25d6e399ef1225f007575f5ba0c5c1",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:c(0)}},t("ion-menu-button",{key:"21b99550714b44124829ac3903aee787dcba158c",class:"fab-icon"})),t("ion-list",{key:"d7fa3c47561a322beffa9560d2632313b20a2687"},this.agencies.length>0?t("ion-item",null,t("ion-label",null,"Select Diving Agency"),t("ion-select",{value:this.selectedAgency.id,onIonChange:e=>this.updateAgency(e.detail.value),interface:"popover"},this.agencies.map((e=>t("ion-select-option",{value:e.id},e.name))))):undefined,t("app-form-item",{key:"fea1ea4ced70b2744b033a20341c616f65905d48","label-tag":"name","label-text":"Name",value:this.selectedAgency.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"7401a150756855931a144def854cbe02441c9946","label-tag":"website","label-text":"Website",value:this.selectedAgency.website,name:"website","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]})),t("ion-list",{key:"225b7fe3abbbba9cfaa93d22101f1374d16fecac"},t("ion-list-header",{key:"5dbad3aef9519e45b48198c3b8738602ee73cef4"},t("ion-label",{key:"7c3f688cb22f3bfee95474c2d8ecc0dabf59dc4e"},t("my-transl",{key:"42bebd496e6b8a8a0b0b0e8559d5e3acb5891c2f",tag:"certifications",text:"Certifications"})),t("ion-button",{key:"029b64f0a444eaf53a0eb56d39c77b14de359630","icon-only":true,onClick:()=>this.editCertification()},t("ion-icon",{key:"aaf4309c433396eefe8dffb39ee3f4a2e4091638",name:"add-circle-outline"}))),t("ion-reorder-group",{key:"88f8b7d7f1d29d9ed9cfb42ea4d21f218e475840",disabled:false,onIonItemReorder:e=>this.reorderCertifications(e)},this.selectedAgencyCertifications.map(((e,i)=>t("ion-item",null,e.photoURL?t("ion-avatar",{slot:"start"},t("img",{src:e.photoURL})):undefined,t("ion-reorder",{slot:"end"}),t("ion-label",null,e.order+1,". ",e.name),t("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.editCertification(i)},t("ion-icon",{name:"create-outline"})))))))),this.isUpdated?t("app-modal-footer",{onSaveEmit:()=>this.save(),onCancelEmit:()=>this.cancel()}):undefined]}};f.style=l;export{f as page_admin_agencies};