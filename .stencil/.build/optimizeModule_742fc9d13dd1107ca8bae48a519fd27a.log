import{r as t,h as e,f as s,e as i}from"./p-cbe60c68.js";import{U as n,T as a,at as l,E as o,y as c}from"./p-6934ed3c.js";import"./p-c7ee7cfe.js";import{b as h}from"./p-c2915cc5.js";import{l as d}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const r="app-dive-class-bookings{width:100%;height:100%}";const p=r;const u=class{constructor(e){t(this,e);this.availableSpots=[];this.divingClass=undefined;this.divingClassId=undefined;this.editable=false;this.isEditing=false;this.segment=0;this.studentsList=undefined;this.waitingRequest=false;this.updateView=false;this.userBooking=undefined}async updateStudentsList(){this.studentsList=[];this.availableSpots=[];this.usersList=[];let t=this.divingClass.students;for(let e of t){let t=Object.assign(Object.assign({},e),{user:await n.getMapDataUserDetails(e.uid)});if(this.editable){this.studentsList.push(t)}else if(t.status=="applied"||t.status=="registered"){this.studentsList.push(t)}if(this.userId&&e.uid===this.userId){this.userBooking=e}}if(this.divingClass.status=="active"){let t=0;this.divingClass.students.map((e=>{if(e.status=="registered"){t++}}));for(let e=0;e<this.divingClass.numberOfStudents-t;e++){this.availableSpots.push(0)}}this.updateView=!this.updateView;return true}componentWillLoad(){this.userId=n.userProfile&&n.userProfile.uid?n.userProfile.uid:null;if(this.userId){this.updateStudentsList()}else{this.userSub=n.userProfile$.subscribe((t=>{this.userId=t&&t.uid?t.uid:null;this.updateStudentsList()}))}this.segmentTitles={cancelled:a.getTransl("cancelled","Cancelled"),applied:a.getTransl("applied","Applied"),registered:a.getTransl("registered","Registered"),denied:a.getTransl("denied","Denied")}}disconnectedCallback(){this.userSub.unsubscribe()}segmentChanged(t){if(t.detail.value){this.segment=d.exports.toNumber(t.detail.value)}}async applyToClass(){const t=await h.create({header:a.getTransl("apply-to-class","Apply to this class"),message:a.getTransl("apply-to-class-message","Please check first with the instructor eventual preconditions to apply to this class. Are you sure?"),buttons:[{text:a.getTransl("ok","OK"),handler:async()=>{this.userBooking={uid:this.userId,status:"applied",evaluations:[]};this.saveBooking(this.userBooking)}},{text:a.getTransl("cancel","Cancel"),role:"cancel"}]});t.present()}async saveBooking(t){try{this.waitingRequest=true;const e=await l.sendBookingRequest(this.divingClassId,t.uid,t.status,t.evaluations);this.waitingRequest=false;this.divingClass.students=e;this.updateStudentsList()}catch(t){this.waitingRequest=false}}updateBooking(t,e){const s=this.studentsList[t];const i=this.divingClass.students.find((t=>t.uid===s.uid));i.status=e.detail.value}editStudents(){this.isEditing=true}saveStudents(){this.isEditing=false;this.updateStudentsList()}render(){return e("ion-list",{key:"0c3e65094ccce3100f0099464a77c1cb1066daf7"},e("ion-item",{key:"63bb4f32063f766d7441a265266bc5c65f987d12",lines:"none"},e("ion-label",{key:"4be03dcf2b5fb00dcb3ff63c8416dd4d10e47bcc"},a.getTransl("max-participants","Max xxx participants",{xxx:this.divingClass.numberOfStudents})),this.editable&&this.divingClass.students&&this.divingClass.students.length>0?!this.isEditing?e("ion-button",{slot:"end",onClick:()=>this.editStudents()},e("my-transl",{tag:"edit",text:"Edit"})):[e("ion-button",{slot:"end",onClick:()=>this.saveStudents()},e("my-transl",{tag:"save",text:"Save"}))]:undefined),!this.editable&&!this.waitingRequest&&this.divingClass.status=="active"&&(!this.userBooking||this.userBooking&&this.userBooking.status==null)?e("ion-button",{expand:"block",onClick:()=>this.applyToClass()},e("my-transl",{tag:"apply-to-class",text:"Apply to this class"})):undefined,this.userBooking&&(this.userBooking.status=="cancelled"||this.userBooking.status=="denied")?e("ion-button",{expand:"block",color:"warning"},e("my-transl",{tag:this.userBooking.status,text:this.userBooking.status})):undefined,this.waitingRequest?e("app-skeletons",{skeleton:"diveTripBooking"}):undefined,this.studentsList.map(((t,s)=>t.uid==this.userId&&this.waitingRequest?e("app-skeletons",{skeleton:"diveTripBooking"}):e("ion-item",null,!this.isEditing&&t.user.photoURL?e("ion-avatar",{slot:"start"},e("ion-img",{src:t.user.photoURL})):undefined,e("ion-label",null,t.user.displayName),!this.isEditing?e("ion-note",{slot:"end"},a.getTransl(t.status,t.status)):e("ion-segment",{style:{maxWidth:"40%",marginLeft:"15%"},slot:"end",mode:"ios",color:o.getAppColor(),onIonChange:t=>this.updateBooking(s,t),value:t.status},e("ion-segment-button",{value:"cancelled"},e("my-transl",{tag:"cancelled",text:"Cancelled"})),e("ion-segment-button",{value:"applied"},e("my-transl",{tag:"applied",text:"Applied"})),e("ion-segment-button",{value:"registered"},e("my-transl",{tag:"registered",text:"Registered"})),e("ion-segment-button",{value:"denied"},e("my-transl",{tag:"denied",text:"Denied"})))))),this.availableSpots.map((()=>e("ion-item",null,e("ion-icon",{slot:"start",name:"person-add-outline"}),e("ion-label",null,e("my-transl",{tag:"available",text:"Available"}))))))}get el(){return s(this)}};u.style=p;const f="app-diving-class-schedule{}";const b=f;const m=class{constructor(e){t(this,e);this.scheduleEmit=i(this,"scheduleEmit",7);this.divingClass=undefined;this.editable=false;this.scheduleArray=[]}async updateClassSchedule(){this.scheduleArray=[];if(this.divingClass.activities&&this.divingClass.activities.length>0){const t={};this.divingClass.activities.map((e=>{t[e.day]=null}));Object.keys(t).map((e=>{const s=d.exports.toNumber(e);const i=this.divingClass.schedule[s-1]?this.divingClass.schedule[s-1]:new Date;const n=this.divingClass.schedule[s];const a=n&&c.differenceInDays(n,i)>=1?this.divingClass.schedule[s]:c.addDays(i,1);const l=c.format(a,"PP");t[e]=new Date(l);this.divingClass.schedule[e]=t[e]}));d.exports.orderBy(Object.keys(t)).forEach((e=>{this.scheduleArray.push({day:e,date:c.parseISO(t[e])})}));this.saveDatesToDives()}this.scheduleEmit.emit(true)}componentWillLoad(){this.updateClassSchedule()}updateActivities(t){this.divingClass.activities=t.detail;this.updateClassSchedule()}updateDate(t,e){this.divingClass.schedule[t]=new Date(e);this.updateClassSchedule()}saveDatesToDives(){this.divingClass.activities=this.divingClass.activities.map((t=>{if(t.divePlan){const e=c.addHours(this.divingClass.schedule[t.day],12);t.divePlan.dives[0].date=e}return t}))}render(){return e("ion-grid",{key:"09bbcf7b92aa36de98747bc5c279f5285e9b9862"},e("ion-row",{key:"5d4997e6770887abbf4fd9430640da31acbdb954"},this.scheduleArray.map((t=>e("ion-col",{size:"3"},e("ion-card",null,e("ion-card-title",null,e("my-transl",{tag:"day",text:"Day"})," "+t.day),e("ion-card-content",null,e("ion-datetime",{presentation:"date",onIonChange:e=>this.updateDate(t.day,e.detail.value),max:"2050",readonly:!this.editable,value:t.date.toISOString()}))))))),e("ion-row",{key:"6b78cc13b9f3abc70eb75ff8d89c00345685b716"},e("app-dive-course-activities",{key:"717a95ccf434e6b28326d4049c66e5e881710567",schedule:this.divingClass.activities,editable:this.editable,onScheduleEmit:t=>this.updateActivities(t)})))}};m.style=b;export{u as app_dive_class_bookings,m as app_diving_class_schedule};