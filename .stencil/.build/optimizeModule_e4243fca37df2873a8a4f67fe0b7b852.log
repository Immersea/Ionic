import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as o,o as n}from"./p-5d4a8e1f.js";import{S as s}from"./p-a75993af.js";import{U as c,n as d,F as l,L as r,T as f,O as b,R as h,S as m,C as u}from"./p-4a2e1f71.js";import{P as p,a9 as y,aa as k,ab as C}from"./p-2578d979.js";import{E as w}from"./p-a9f4af61.js";import{l as g}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";const v="modal-customer-update ion-list{width:100%}";const x=v;const L=class{constructor(t){e(this,t);this.saveNewOwner=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"locations",text:"Locations",disabled:false},{tag:"operating-conditions",text:"Operating Conditions",disabled:false}];this.customerId=undefined;this.customer=undefined;this.updateView=true;this.validCustomer=false;this.locationTypeSegment="add";this.slider=undefined}async componentWillLoad(){this.userProfileSub$=c.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));await this.loadCustomer()}async loadCustomer(){if(this.customerId){const e=await l.getCustomer(this.customerId);this.customer=e;if(this.customer.locations.length>0)this.locationTypeSegment=0}else{this.customer=new r;this.customer.users={[c.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-customer",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setTypesSelect();this.validateCustomer()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.customer[e.detail.name]=e.detail.value;this.validateCustomer()}handleInformationChange(){this.validateCustomer()}updateParam(){this.validateCustomer()}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.customer.photoURL=a}else{this.customer.coverURL=a}this.save(false)}validateCustomer(){let e=true;this.customer.locations.forEach((t=>{if(t&&t.position)e=e&&g.exports.isNumber(t.position.geopoint.latitude)&&g.exports.isNumber(t.position.geopoint.longitude)}));this.validCustomer=e&&g.exports.isString(this.customer.fullName)&&this.customer.typeId!=null}addLocation(){this.customer.locations.push(new p);this.locationTypeSegment=this.customer.locations.length-1;this.updateSlider()}updateLocation(){this.updateSlider()}deleteLocation(e){this.customer.locations.splice(e,1);this.updateSlider()}setTypesSelect(){const e=this.el.querySelector("#selectType");const t={header:f.getTransl("customer_type","Customer Type")};e.interfaceOptions=t;const a=Array.from(e.getElementsByTagName("ion-select-option"));a.map((t=>{e.removeChild(t)}));e.placeholder=f.getTransl("select","Select");l.getCustomerTypes().map((t=>{const a=document.createElement("ion-select-option");a.value=t.typeId;a.textContent=f.getTransl(t.typeId,t.typeName);e.appendChild(a)}))}selectType(e){this.customer.typeId=e.detail.value;this.validateCustomer()}locationTypeSegmentChanged(e){if(e.detail.value!=="add"){this.locationTypeSegment=e.detail.value;this.updateView=!this.updateView;this.updateSlider()}}selectOwner(e){this.customer.owner=e.detail.value;this.validateCustomer()}selectGroupOwner(e,t){this.customer.group[t]=e.detail.value;this.validateCustomer()}async editOwner(e,t,a){let i=new b;if(e){if(t>=0){i=this.customer.group[t];if(a){this.customer.group.splice(t,1)}}}else{i=this.customer.owner}if(!a){const a=await o.create({component:"popover-edit-customer-owner",translucent:true,componentProps:{owner:i,group:e}});a.onDidDismiss().then((async a=>{const i=a.data;if(i){if(e){if(t>=0){this.customer.group[t]=i.owner}else{this.customer.group.push(i.owner)}}else{this.customer.owner=i.owner}this.saveNewOwner=i.new;this.updateSlider()}}));a.present()}this.updateSlider()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editOperatingCondition(e,t){const a=await h.openModal("modal-operating-conditions-questionnaire",{condition:e,conditionData:g.exports.cloneDeep(t),editable:true});a.onDidDismiss().then((a=>{a=a.data;if(a&&t){if(e=="EAF")t=new y(a);else if(e=="LF")t=new k(a);else if(e=="CCM")t=new C(a);this.updateSlider()}else if(a){if(e=="EAF")this.customer.conditions.EAF.push(new y(a));else if(e=="LF")this.customer.conditions.LF.push(new k(a));else if(e=="CCM")this.customer.conditions.CCM.push(new C(a));this.updateSlider()}}))}async deleteCustomer(){try{await l.deleteCustomer(this.customerId);n.dismiss()}catch(e){if(e)m.presentAlertError(e)}}async save(e=true){const t=await l.updateCustomer(this.customerId,this.customer,this.userProfile.uid);if(this.customerId){return e?n.dismiss():true}else{this.customerId=t.id;return true}}async cancel(){n.dismiss()}render(){return t(a,{key:"d4748b4af36e74efaf3636f3587f480625473145"},t("ion-header",{key:"d2b5f0eb6be281686ab85f42d1022dd41db703a4"},t("app-upload-cover",{key:"0a3816a10119e17a1a7c0cd4e2a7b0a4d10a7ffc",item:{collection:u,id:this.customerId,photoURL:this.customer.photoURL,coverURL:this.customer.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("app-header-segment-toolbar",{key:"867c928359d137bbfd55f2d719d099025ce9d11d",color:w.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"35e0b5556c075c5625f7ba6da0bbab5a66eaaaca",class:"slides"},t("swiper-container",{key:"87ca56ec92e22bba3be0e39a84faa199615109d7",class:"slider-edit-customer swiper"},t("swiper-wrapper",{key:"f3d98d6501e64eaf584aaafc3de60201882424a2",class:"swiper-wrapper"},t("swiper-slide",{key:"66dc12982e50e0d52fff6b5bbdf19f6666bd4c4c",class:"swiper-slide"},t("ion-list",{key:"fe5d2314acdc4db84dae5cff002a0e7b11ef0ca4",class:"ion-no-padding"},t("ion-item",{key:"935aaea019e9f68ba48ecdca5593202141c9b85e",lines:"none"},t("ion-select",{key:"1d4651bce286f4bf301abf9fc467229c36c054c1",color:"trasteel",id:"selectType",interface:"action-sheet",label:f.getTransl("customer_type","Customer Type"),"label-placement":"floating",onIonChange:e=>this.selectType(e),value:this.customer&&this.customer.typeId?this.customer.typeId:null})),t("app-form-item",{key:"f8a83701ab617588e103415aca5e732d7a966ba5","label-tag":"name","label-text":"Name",value:this.customer.fullName,name:"fullName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"10e498ac4eec4a4446bc318a74a0325f84e01df8","label-tag":"local_name","label-text":"Local Name",value:this.customer.fullNameOther,name:"fullNameOther","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"4c92d731d58fb74674655731df0e8e24b3ead41f",labelTag:"other_name",labelText:"Other Name",value:this.customer.otherPlantName,name:"otherPlantName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"b8a4950ea69ef5142b2e595391373f4f0f78c77e",labelTag:"other_name",labelText:"Other Local Name",value:this.customer.otherPlantNameOther,name:"otherPlantNameOther","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"f94d3bb3bc4ecabe4b46f7868da3da1cdb17eb4f",labelTag:"short_name",labelText:"Short Name",value:this.customer.shortName,name:"shortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),this.customer.group.length==0?t("ion-item",{lines:"none"},t("ion-label",null,t("h2",null,t("my-transl",{tag:"add_customer_group",text:"Add Customer Group"}))),t("ion-button",{onClick:()=>this.editOwner(true),slot:"end"},"+")):undefined,this.customer.group.map(((e,a)=>t("ion-item",{lines:"none"},t("ion-label",null,a==0?t("ion-note",null,t("my-transl",{tag:"customer_group",text:"Customer Group"})):undefined,t("h2",null,e.groupName+" ["+e.groupOwnershipPerc+"%]")),a==this.customer.group.length-1?t("ion-button",{onClick:()=>this.editOwner(true),slot:"end"},"+"):undefined,t("ion-button",{slot:"end","icon-only":true,color:"danger",fill:"clear",onClick:()=>{this.editOwner(true,a,true)}},t("ion-icon",{name:"trash"})),t("ion-button",{slot:"end","icon-only":true,fill:"clear",onClick:()=>{this.editOwner(true,a)}},t("ion-icon",{name:"create"}))))),t("ion-item",{key:"321ab53d74855b6c044db5448d140ca6717faeb9",lines:"none"},t("ion-label",{key:"9a967173cde5759cff4a5e9bbf7946b180b5b8fd"},t("ion-note",{key:"b8a3b674490813a26ef448197d95eac95cb1a503"},t("my-transl",{key:"85248f9c89b2a8774a37cc05664e7e84a69f6380",tag:"customer_owner",text:"Customer Owner"})),t("h2",{key:"b01706e32322972e9d65aaddc18739447dea278e"},this.customer.owner.groupName)),t("ion-button",{key:"d7879106e22eecdbc47c5bf48820d64c15e664e3",slot:"end","icon-only":true,fill:"clear",onClick:()=>{this.editOwner(false)}},t("ion-icon",{key:"7b18e7ca3b3af48afcf2b92b1a44a7ad96ed8494",name:"create"}))),t("app-customer-plant-production",{key:"b82ee06068e9ec91b76c05558af1814603ff1efb",customer:this.customer,editable:true})),this.customerId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteCustomer()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"eb665cb70e3889c0320a092b1bdb3cbdd5d11e6f",class:"swiper-slide"},t("div",{key:"ce3bd1ff32667be9bc82b1cdefd84a8e3cd9b813"},t("ion-toolbar",{key:"f6338047ba1cc0bc91458e4e22b125a2d299f96d"},t("ion-segment",{key:"37a5482fe12652caf82704a4e1ce4f32999e829f",mode:"ios",scrollable:true,onIonChange:e=>this.locationTypeSegmentChanged(e),value:this.locationTypeSegment},this.customer.locations.map(((e,a)=>t("ion-segment-button",{value:a,layout:"icon-start"},t("ion-label",null,l.getLocationsTypes(e.type)[0].locationName)))),t("ion-segment-button",{key:"88917bb707deb3a7c0999a753a21c3ccb4760d3d",value:"add",onClick:()=>this.addLocation(),layout:"icon-start"},t("ion-label",{key:"a276c4ba76351ed7037ea8648746c7e4735a344f"},"+")))),this.customer.locations.map(((e,a)=>t("div",null,this.locationTypeSegment==a?t("div",null,t("app-location",{locations:l.getLocationsTypes(),location:e,slider:this.slider,onLocationSelected:()=>this.updateLocation(),onLocationDeleted:()=>this.deleteLocation(a)})):undefined))))),t("swiper-slide",{key:"ddca763fbe9cfb9723c427eb04b2b543834f5199",class:"swiper-slide"},t("ion-grid",{key:"463e5b814db02d2b14498fb4d23024ec6aab71be"},t("ion-row",{key:"8fc33a550ea5652edb9e560f246343a1a313ed0d"},t("ion-col",{key:"a22fc73f2bacfd4ecfac10be58d5dd16b78715ac"},t("ion-button",{key:"93dff0f3d9be9fb6c246d68a160270163586e14c",color:w.getAppColor(),onClick:()=>this.editOperatingCondition("EAF"),expand:"block"},t("ion-icon",{key:"a0cb2cb46e0a21ea2e49f0da544c080eb372564c",name:"add"}),t("ion-label",{key:"9974fd2ed919f2c6dde7eee368b60d8beda050dc"},"EAF"))),t("ion-col",{key:"98dbc1f715ef155d228d47f2f2e6d44ef8bf2dee"},t("ion-button",{key:"8ea5b1f07e8a1a8a1edc4a92e8cfe47d0a81025c",color:w.getAppColor(),onClick:()=>this.editOperatingCondition("LF"),expand:"block"},t("ion-icon",{key:"bd588904bcdd12a2be9d49f9c258242a15c502d6",name:"add"}),t("ion-label",{key:"fca9f33d2c35588fb85df2e04cf275a68a913c07"},"LF"))),t("ion-col",{key:"2d0b9781f201491a17dde100122d1769941b6bb6"},t("ion-button",{key:"5f6a6bc94434eb824fc9d3bf5bc457f7aeeb14ab",color:w.getAppColor(),onClick:()=>this.editOperatingCondition("CCM"),expand:"block"},t("ion-icon",{key:"05ad247e9bc23c58611f0baf3ccdee06960e5f99",name:"add"}),t("ion-label",{key:"7fe58d986e424541a6dfca76a330b02eddcbdd2a"},"CCM"))))),t("ion-list",{key:"0edc5b7c013d17c9cd044d90e119c30e97648a32"},t("ion-item-divider",{key:"475a3e12d6c23a06c6e7ffc6e4c9340af6815ce4"},"EAF"),this.customer.conditions.EAF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.editOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"fbf36021e64ea02efea7bfaeac93715e24beb64a"},"LF"),this.customer.conditions.LF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.editOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"18755ea5fca3a0f749c8a72fcaf5ff08bd239b00"},"CCM"),this.customer.conditions.CCM.map((e=>t("ion-item",null,t("ion-label",null,new Date(e.date).toLocaleDateString()))))))))),t("app-modal-footer",{key:"8caef664a5578db26e2d5eee2ccc4981d6f7db49",color:w.getAppColor(),disableSave:!this.validCustomer,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};L.style=x;export{L as modal_customer_update};