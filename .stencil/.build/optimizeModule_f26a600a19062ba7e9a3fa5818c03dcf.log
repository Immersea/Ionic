import{r as e,h as i,f as s}from"./p-cbe60c68.js";import{aM as t,m as a,am as o,S as n,Q as l,i as h,k as r,T as d}from"./p-83f44900.js";import{T as c}from"./p-3670ea54.js";import{l as p}from"./p-1af05547.js";import{S as f}from"./p-a75993af.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const b="page-shapes{}";const u=b;const m=class{constructor(i){e(this,i);this.shapesList=[];this.nonFilteredShapesList=[];this.localDocName="shapeBasket";this.filteredShapesList=[];this.loading=true;this.filter=new t;this.slider=undefined;this.updateView=true;this.showDownload=true;this.activateDownload=false;this.basket=[]}async componentWillLoad(){const e=await a.getLocalDocument("shapesFilter");this.filter=new t(e);o.shapesList$.subscribe((async e=>{this.updateList(e);this.nonFilteredShapesList=e;this.loading=false;this.filterLists()}));const i=await a.getLocalDocument(this.localDocName);if(i){this.basket=i;this.basket.forEach((e=>{if(e.datasheet){this.activateDownload=true}else{this.activateDownload=false}}))}}componentDidLoad(){this.searchToolbar=this.el.querySelector("#searchToolbar");this.slider=new f(".slider-show-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.downloadShapes()}updateList(e){this.shapesList=e;this.searchToolbar?this.searchToolbar.forceFilter(e):undefined;this.updateSlider()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}addShape(){o.presentShapeUpdate()}getOptions(){if(c.isRefraDBAdmin()){return[{tag:"delete",text:"Delete",icon:"trash",color:"danger",func:e=>o.deleteShape(e,false)},{tag:"duplicate",text:"Duplicate",icon:"duplicate",color:"secondary",func:e=>o.duplicateShape(e)},{tag:"edit",text:"Edit",icon:"create",color:"primary",func:e=>o.presentShapeUpdate(e)}]}else return null}async openShapeFilter(){a.deleteLocalDocument("filteredShapesList");this.filter=await o.openShapeFilter(this.filter);this.filterLists()}clearShapeFilter(){this.filter=new t;this.shapesList=p.exports.cloneDeep(this.nonFilteredShapesList);a.deleteLocalDocument("filteredShapesList");this.filterLists()}async filterLists(){a.saveLocalDocument("shapesFilter",this.filter);if(this.filter.isActive()){const e=await a.getLocalDocument("filteredShapesList");if(!e){this.loading=true;n.presentLoading("searching");this.shapesList=await o.filterShapes(this.filter);n.dismissLoading();this.filteredShapesList=p.exports.cloneDeep(this.shapesList);a.saveLocalDocument("filteredShapesList",this.filteredShapesList);this.loading=false}else{this.filteredShapesList=e}}else{this.filteredShapesList=p.exports.cloneDeep(this.nonFilteredShapesList)}this.searchToolbar?this.searchToolbar.forceFilter(this.shapesList):undefined;this.slider?this.updateSlider():undefined}downloadShapes(){this.showDownload=!this.showDownload;this.slider.params.slidesPerView=this.showDownload?2:1;this.updateSlider()}openShape(e){if(this.showDownload){const i=o.getShapeById(e);if(!p.exports.find(this.basket,{shape:i}))this.basket.push({shape:i,datasheet:null});this.basket=p.exports.orderBy(this.basket,"shape.shapeName");this.saveBasket()}else{o.presentShapeDetails(e)}}async openDataSheet(e){const i=await l.openSelectDataSheet();if(i){this.basket[e].datasheet=i;this.basket.forEach((e=>{if(!e.datasheet)e.datasheet=i}));this.activateDownload=true;this.saveBasket()}}async downloadShapesList(){o.exportShapes(this.basket,"en");this.downloadShapes()}emptyBasket(){this.basket=[];this.activateDownload=false;this.saveBasket()}removeItemFromBasket(e){if(this.basket.length==1){this.emptyBasket()}else{this.basket.splice(e,1);this.saveBasket()}}saveBasket(){this.updateSlider();a.saveLocalDocument(this.localDocName,this.basket)}render(){return[i("ion-header",{key:"f364ad98eaf7443dd3cd9450e11ff69a1aabe0b9"},i("app-navbar",{key:"48c3c51fbd60463d4f22b08945051560454700ee",tag:"shapes",text:"Shapes",color:"trasteel"}),i("ion-grid",{key:"e630d6f8b4b9b4edcf2f43a3280a5381ba0c0ff9",class:"ion-no-padding"},i("ion-row",{key:"96a361fa67583aca9697dfec0c3bce6605aafdb7",class:"ion-no-padding"},i("ion-col",{key:"7130b6aad376ebde92cc6496ad9803f11d0186d4",size:"1",class:"ion-no-padding"},i("ion-toolbar",{key:"34deb4dbd56a652003b8276fcd55956b86370b53",color:"trasteel"},i("ion-button",{key:"71ac5b9eb0756af94ab518aad2280530442fd0cc",fill:"clear",expand:"full","icon-only":true,onClick:()=>this.openShapeFilter()},i("ion-icon",{key:"bff8c36c14d0e9980f23477f44b3514ca26a5e6d",name:"filter",color:"light"})))),i("ion-col",{key:"2672d5bf3ad2bb578b5144bbba07fdbcb28614a9",size:"11",class:"ion-no-padding"},i("app-search-toolbar",{key:"121f157c8af996f26814d5ffda19ea07c14b3da4",id:"searchToolbar",searchTitle:"shapes",list:this.shapesList,orderFields:["shapeName"],color:"trasteel",placeholder:"Search by shape name",filterBy:["shapeName","shapeTypeId"],onFilteredList:e=>this.filteredShapesList=e.detail}))))),i("ion-content",{key:"34191259ae900b882640b4e722766cf8cc4fbd8e",class:"slides"},c.isRefraDBAdmin()?!this.showDownload?i("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},i("ion-fab-button",{size:"small",color:"trasteel"},i("ion-icon",{name:"chevron-down"})),i("ion-fab-list",{side:"bottom"},i("ion-fab-button",{onClick:()=>this.addShape(),color:"trasteel"},i("ion-icon",{name:"add"})),i("ion-fab-button",{onClick:()=>this.downloadShapes(),color:"trasteel"},i("ion-icon",{name:"download"})))):i("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},i("ion-fab-button",{onClick:()=>this.downloadShapes(),size:"small",color:"trasteel"},i("ion-icon",{name:"close"}))):undefined,i("swiper-container",{key:"49392dcefd3e261632bc8c9f7a16ea18ed6fef92",class:"slider-show-shape swiper"},i("swiper-wrapper",{key:"ee56c4fd2708d9655fad9d8146ed3257d2eb51ca",class:"swiper-wrapper"},i("swiper-slide",{key:"46beaf37c71c71fe410ca5647f585bf549044faa",class:"swiper-slide"},this.filter.isActive()?[i("ion-breadcrumbs",null,i("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.clearShapeFilter()},i("ion-icon",{color:"danger",name:"trash"})),i("ion-breadcrumb",null,this.filteredShapesList.length),Object.keys(this.filter).map((e=>!e.includes("operator")&&(this.filter[e]>0||this.filter[e]!==null)?i("ion-breadcrumb",null,e!="shapeTypeId"?e+" "+this.filter[e+"_operator"]+" "+this.filter[e]:o.getShapeTypeName(this.filter.shapeTypeId)?o.getShapeTypeName(this.filter.shapeTypeId).en:null):undefined)),i("ion-breadcrumb",null))]:undefined,i("app-infinite-scroll",{key:"f2699df6dd86f39279f2a35fe0065d3333c28f37",list:this.filteredShapesList,loading:this.loading,showFields:["shapeName"],orderBy:["shapeName"],options:this.getOptions(),returnField:"id",icon:h.getMapDocs(r).icon.name,onItemClicked:e=>this.openShape(e.detail),onListChanged:()=>{this.updateSlider()}})),this.showDownload?i("swiper-slide",{class:"swiper-slide"},i("ion-list",null,this.basket.length==0?i("ion-item",null,"Click on the shapes on the left to add to basket"):i("ion-grid",null,i("ion-row",null,i("ion-col",null,i("ion-button",{onClick:()=>this.downloadShapesList(),expand:"block",fill:"outline",color:"trasteel",disabled:!this.activateDownload},i("ion-icon",{name:"download",slot:"start"}),i("ion-label",null,d.getTransl("download","Download")),i("ion-badge",{slot:"end",color:"trasteel"},this.basket.length))),i("ion-col",{size:"1"},i("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.emptyBasket()},i("ion-icon",{name:"trash",color:"danger"}))))),this.basket.map(((e,s)=>i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-no-padding"},i("ion-col",{class:"ion-no-padding"},i("ion-item",{color:"light"},i("ion-label",null,e.shape.shapeName),i("ion-icon",{slot:"end",name:"arrow-right"}))),i("ion-col",{class:"ion-no-padding"},i("ion-item",{button:true,color:"light",onClick:()=>this.openDataSheet(s)},i("ion-label",null,e.datasheet?e.datasheet.productName:"insert datasheet"))),i("ion-col",{size:"2",class:"ion-no-padding"},i("ion-item",{color:"light"},i("ion-button",{slot:"end",fill:"clear","icon-only":true,onClick:()=>this.removeItemFromBasket(s)},i("ion-icon",{name:"trash",color:"danger"})))))))))):undefined)))]}get el(){return s(this)}};m.style=u;export{m as page_shapes};