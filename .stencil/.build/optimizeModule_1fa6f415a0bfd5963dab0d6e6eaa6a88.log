import{r as e,h as t}from"./p-cbe60c68.js";import{U as i,S as a,R as s,ax as o,t as n,ay as c}from"./p-83f44900.js";import{l as r}from"./p-1af05547.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const d="page-admin-agencies .cover{height:var(--coverHeight)}";const l=d;const h=class{constructor(t){e(this,t);this.selectedAgency=undefined;this.selectedAgencyCertifications=[];this.isUpdated=false;this.updateView=true}componentWillLoad(){this.userRoles=i.userRoles;this.systemSub=a.systemPreferences$.subscribe((e=>{this.agencies=[];Object.keys(e.divingAgencies).forEach((t=>{if(this.userRoles.isSuperAdmin()||this.userRoles.roles.includes(t.toLowerCase()+"-admin")){const i=e.divingAgencies[t];i.id=t;this.agencies.push(i)}}));if(!this.selectedAgency)this.selectedAgency=r.exports.cloneDeep(this.agencies[0]);this.createCertificationsArray()}))}createCertificationsArray(){this.selectedAgencyCertifications=[];const e=[];Object.keys(this.selectedAgency.certifications).map((t=>{let i=this.selectedAgency.certifications[t];i.id=t;e.push(i)}));this.selectedAgencyCertifications=r.exports.orderBy(e,"order")}disconnectedCallback(){this.systemSub.unsubscribe()}updateAgency(e){this.isUpdated=false;this.selectedAgency=r.exports.cloneDeep(this.agencies.find((t=>t.id==e)));this.createCertificationsArray()}handleChange(e){this.isUpdated=true;this.selectedAgency[e.detail.name]=e.detail.value}async reorderCertifications(e){this.isUpdated=true;const t=r.exports.cloneDeep(this.selectedAgencyCertifications);const i=t.splice(e.detail.from,1)[0];t.splice(e.detail.to,0,i);t.forEach(((e,t)=>{e.order=t}));e.detail.complete(t);this.selectedAgencyCertifications=r.exports.orderBy(t,"order")}async editCertification(e){this.isUpdated=true;let t=null;if(e===undefined){t={id:null,maxDepth:20,name:"",order:this.selectedAgencyCertifications?this.selectedAgencyCertifications.length:0,group:""}}else{t=r.exports.cloneDeep(this.selectedAgencyCertifications[e])}const i=await s.openModal("modal-dive-certification-update",{agencyId:this.selectedAgency.id,diveCertification:t});i.onDidDismiss().then((t=>{const i=t.data;if(i){if(e===undefined){this.selectedAgencyCertifications.push(i)}else{this.selectedAgencyCertifications[e]=i}this.updateView=!this.updateView}}))}updateImageUrls(e){this.isUpdated=true;const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.selectedAgency.photoURL=i}else{this.selectedAgency.coverURL=i}}async save(){this.selectedAgency.certifications={};this.selectedAgencyCertifications.map((e=>{this.selectedAgency.certifications[e.id]=e}));const e=await o.updateDivingAgency(this.selectedAgency.id,this.selectedAgency);if(e){this.isUpdated=false}}cancel(){this.isUpdated=false;this.updateAgency(this.selectedAgency.id)}render(){return[t("ion-header",{key:"8685f3bd5ac31526627d97dc64363875a210e582",class:"cover"},t("app-upload-cover",{key:"c7f6c8609c2f96f5000517e123ef8754d3f8359d",item:{collection:n,id:this.selectedAgency.id,photoURL:this.selectedAgency.photoURL,coverURL:this.selectedAgency.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-content",{key:"c16b997b505b7d0901b85dfd7679bd02f321484d"},t("ion-fab",{key:"15b2541d3581ad8b2942ca939c5ddbf88b166a5a",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:c(0)}},t("ion-menu-button",{key:"034b73f2653e062b9d7ecb420652e8a038e31150",class:"fab-icon"})),t("ion-list",{key:"f77cffdebb45968bd40821324d6e826c6d16e132"},this.agencies.length>0?t("ion-item",null,t("ion-label",null,"Select Diving Agency"),t("ion-select",{value:this.selectedAgency.id,onIonChange:e=>this.updateAgency(e.detail.value),interface:"popover"},this.agencies.map((e=>t("ion-select-option",{value:e.id},e.name))))):undefined,t("app-form-item",{key:"c7407e3e8610fce5f916834acc3ac59c7994fee0","label-tag":"name","label-text":"Name",value:this.selectedAgency.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"67e9532ae4cadd90f7e57b27ee614952c65405b4","label-tag":"website","label-text":"Website",value:this.selectedAgency.website,name:"website","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]})),t("ion-list",{key:"3a74adb9381d73c51d17084c7f22372b35e9a30d"},t("ion-list-header",{key:"e173b0bce2ccaab7753c73ce4b4bd1ffc52e8c4d"},t("ion-label",{key:"5f2f7378173942724a42a2cc1180316eae72f624"},t("my-transl",{key:"21a5449ad4bfde0434e8ae17eef32acf12aaaa6b",tag:"certifications",text:"Certifications"})),t("ion-button",{key:"c0ab962df5c1c5612e818c5ceb7d78a1c840b531","icon-only":true,onClick:()=>this.editCertification()},t("ion-icon",{key:"a9e823adeb4ec2144d565163570bbc169728e67d",name:"add-circle-outline"}))),t("ion-reorder-group",{key:"870e8d40775a4c0c733f2acc1f1185f2f5724a11",disabled:false,onIonItemReorder:e=>this.reorderCertifications(e)},this.selectedAgencyCertifications.map(((e,i)=>t("ion-item",null,e.photoURL?t("ion-avatar",{slot:"start"},t("img",{src:e.photoURL})):undefined,t("ion-reorder",{slot:"end"}),t("ion-label",null,e.order+1,". ",e.name),t("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.editCertification(i)},t("ion-icon",{name:"create-outline"})))))))),this.isUpdated?t("app-modal-footer",{onSaveEmit:()=>this.save(),onCancelEmit:()=>this.cancel()}):undefined]}};h.style=l;export{h as page_admin_agencies};