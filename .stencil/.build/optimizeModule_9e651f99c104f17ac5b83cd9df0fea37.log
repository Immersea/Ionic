import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import{U as s,n as d,e as o,af as n,a3 as r,d as c}from"./p-7ea622ea.js";import"./p-c7ee7cfe.js";import{n as l,o as f}from"./p-5d4a8e1f.js";import{l as h}from"./p-1af05547.js";import{S as p}from"./p-a75993af.js";import"./p-6c93b3f7.js";import"./p-e9c4f463.js";import"./p-5d8b2afa.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const m="modal-diving-school-update ion-list{width:100%}";const b=m;const u=class{constructor(t){e(this,t);this.divingSchoolId=undefined;this.divingSchool=undefined;this.updateView=true;this.validDivingSchool=false;this.schoolCourses=[];this.tmpDivingSchoolId=undefined;this.showDCId=false;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"diving-courses",text:"Diving Courses"},{tag:"team"}];this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));await this.loadDivingSchool()}async loadDivingSchool(){if(this.divingSchoolId){this.divingSchool=await o.getDivingSchool(this.divingSchoolId);this.draggableMarkerPosition={lat:this.divingSchool.position.geopoint.latitude,lon:this.divingSchool.position.geopoint.longitude}}else{this.divingSchool=new n;this.divingSchool.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}this.loadDivingSchoolCourses()}async loadDivingSchoolCourses(){this.schoolCourses=[];setTimeout((async()=>{this.divingCourses=await o.loadDivingSchoolCourses(this.divingSchool);this.divingCourses.divingSchoolCourses.forEach((e=>{this.schoolCourses.push(e)}));this.updateView=!this.updateView}),10)}async componentDidLoad(){this.slider=new p(".slider-diving-school",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+r(this.divingSchool,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateDiveSchool()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}updateLocation(e){this.draggableMarkerPosition={lat:h.exports.toNumber(e.detail.lat),lon:h.exports.toNumber(e.detail.lon)};this.divingSchool.setPosition(e.detail.lat,e.detail.lon);this.validateDiveSchool()}updateAddress(e){this.divingSchool.setAddress(e.detail)}handleChange(e){if(e.detail.name=="facebook"||e.detail.name=="instagram"||e.detail.name=="twitter"||e.detail.name=="website"||e.detail.name=="email"){const t=h.exports.toLower(e.detail.value).split(" ").join("-");this.divingSchool[e.detail.name]=t}else if(e.detail.name=="id"){this.setTmpId(e.detail.value)}else{this.divingSchool[e.detail.name]=e.detail.value}this.updateView=!this.updateView;this.validateDiveSchool()}setTmpId(e){this.tmpDivingSchoolId=h.exports.toLower(e).trim().split(" ").join("-").substring(0,16)}uniqueIdValid(e){if(e.detail){this.divingSchoolId=this.tmpDivingSchoolId}else{this.divingSchoolId=null}}updateImageUrls(e){const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.divingSchool.photoURL=i}else{this.divingSchool.coverURL=i}}validateDiveSchool(){this.validDivingSchool=h.exports.isNumber(this.divingSchool.position.geopoint.latitude)&&h.exports.isNumber(this.divingSchool.position.geopoint.longitude)&&h.exports.isString(this.divingSchool.displayName)&&h.exports.isString(this.divingSchool.description)}async openAddDiveCourse(){const e=await l.create({component:"popover-search-diving-course",translucent:true});e.onDidDismiss().then((e=>{const t=e.data;if(t&&t.certificationId){this.divingSchool.divingCourses.push(t);this.loadDivingSchoolCourses()}}));e.present()}removeDiveCourse(e){const t=this.divingSchool.divingCourses.findIndex((t=>t.agencyId===e.agencyId&&t.certificationId===e.certificationId));this.divingSchool.divingCourses.splice(t,1);this.loadDivingSchoolCourses()}async save(){await o.updateDivingSchool(this.divingSchoolId,this.divingSchool,this.userProfile.uid);return f.dismiss()}async cancel(){return f.dismiss()}render(){return t(i,{key:"f1b65e3c91835ff6d6d9ad787434f79339345b47"},t("ion-header",{key:"c9baa93e1d564a60dd335ea78733554aa28ad601"},t("app-upload-cover",{key:"8273d07c4990059c7e352e31db3361203771afbf",item:{collection:c,id:this.divingSchoolId,photoURL:this.divingSchool.photoURL,coverURL:this.divingSchool.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("app-header-segment-toolbar",{key:"fc255db0b92821aec656c55c0046dbf9c90f8a2a",color:"divingschool",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"86c71d1c5f122f6c1d2f56f716096efe04409a2f",class:"slides"},t("swiper-container",{key:"723b42fbd629530cb245b17d33ba418d53258e4e",class:"slider-diving-school swiper"},t("swiper-wrapper",{key:"53550aa70a6f51dba5b09cfd88ffd838216d7a6a",class:"swiper-wrapper"},t("swiper-slide",{key:"9d5164f0b1921678762ae56e22607007bbe98367",class:"swiper-slide"},t("div",{key:"f085def93057228d2cd4e855b244ded5df0a958a",id:"map-container"},t("app-map",{key:"60b79db5817deccb090549e33849c24886c64515",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),t("swiper-slide",{key:"537f2a4b2e36c664bd03582e21e1144b8e846578",class:"swiper-slide"},t("app-coordinates",{key:"43ffc1758720e4dea73a245d8f92b987aa9b135a",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),t("swiper-slide",{key:"e15f302b71bd8300274c9c25e91cad6f776ba326",class:"swiper-slide"},t("ion-list",{key:"9d4614a46f88c826f4f08cb6d56ed9293fdf1652",class:"ion-no-padding"},t("ion-list-header",{key:"4f0dea25ad37b03703361ee468cbae5149135266"},t("my-transl",{key:"6b2f378842fa9a168e7089e08a42b03e6008fd83",tag:"general-information",text:"General Information",isLabel:true})),t("app-form-item",{key:"461b5d78df539bebc66f45fc424c523b8fc82151","label-tag":"name","label-text":"Name",value:this.divingSchool.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),this.showDCId?t("app-form-item",{"label-tag":"unique-id","label-text":"Unique ID",value:this.tmpDivingSchoolId,name:"id","input-type":"text",onFormItemChanged:e=>this.handleChange(e),onIsValid:e=>this.uniqueIdValid(e),validator:["required",{name:"uniqueid",options:{type:c}}]}):undefined,t("app-form-item",{key:"f3fffefcc7cdda23bc14eeaac2d4b6ff44758a5e","label-tag":"description","label-text":"Description",value:this.divingSchool.description,name:"description",textRows:10,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"423f1cddf6bf6de1ef4294ac505f18a0ffd3d2d1","label-tag":"phone","label-text":"Phone",value:this.divingSchool.phoneNumber,name:"phoneNumber","input-type":"tel",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"bb19213b1f6e5fcf8729d019f9aedfa1555e92a6","label-tag":"email","label-text":"Email",value:this.divingSchool.email,name:"email","input-type":"email",onFormItemChanged:e=>this.handleChange(e),validator:["email"]}),t("app-form-item",{key:"fb5337bf6e9f1c0ac483eebaa73465fadc5ef758","label-tag":"website","label-text":"Website",value:this.divingSchool.website,name:"website","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingSchool.website?t("a",{class:"ion-padding-start",href:"http://"+this.divingSchool.website,target:"_blank"},"http://"+this.divingSchool.website):undefined,t("app-form-item",{key:"1838eb2c153cf2b4903e857a1ac57f3115798cbf","label-tag":"facebook-id","label-text":"Facebook ID",value:this.divingSchool.facebook,name:"facebook","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingSchool.facebook?t("a",{class:"ion-padding-start",href:"https://www.facebook.com/"+this.divingSchool.facebook,target:"_blank"},"https://www.facebook.com/"+this.divingSchool.facebook):undefined,t("app-form-item",{key:"f7887e2421bdd77a30340dd932bcd389775f5cd6","label-tag":"instagram-id","label-text":"Instagram ID",value:this.divingSchool.instagram,name:"instagram","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingSchool.instagram?t("a",{class:"ion-padding-start",href:"https://www.instagram.com/"+this.divingSchool.instagram,target:"_blank"},"https://www.instagram.com/"+this.divingSchool.instagram):undefined,t("app-form-item",{key:"5b4a050002adeb8311a89e320cb0e3b251cf77d3","label-tag":"twitter id","label-text":"Twitter ID",value:this.divingSchool.twitter,name:"twitter","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingSchool.twitter?t("a",{class:"ion-padding-start",href:"https://www.twitter.com/"+this.divingSchool.twitter,target:"_blank"},"https://www.twitter.com/"+this.divingSchool.twitter):undefined)),t("swiper-slide",{key:"5af4ef4387e47719b82f61acd2639ab17f06f7e3",class:"swiper-slide"},t("ion-grid",{key:"d0a2c6588fdf224d6392d4c8f6c208ec53b67ae4"},t("ion-row",{key:"e38d3142f03d827d26d42b65b5800f1ab5cde65d",class:"ion-text-start"},this.schoolCourses.map((e=>t("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},t("app-dive-course-card",{divingCourse:e,edit:true,onRemoveEmit:e=>this.removeDiveCourse(e.detail)})))),t("ion-col",{key:"6c0a0889699628f175342f0f4e5d91622906cd95","size-sm":"12","size-md":"6","size-lg":"4"},t("ion-card",{key:"943f5f0f8e15d2b902f03a7d5f446c16d6a7af4d",onClick:()=>this.openAddDiveCourse()},t("ion-card-content",{key:"4f8038e1948ef5922037be7c65daff85cd502de8",class:"ion-text-center"},t("ion-icon",{key:"91f8cf4ee4d850a0323a96c338ac0e7a0f6bdb92",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),t("swiper-slide",{key:"a57a05afd68172f5b83c49610fa9fea769418c78",class:"swiper-slide"},t("app-users-list",{key:"ded366b782674058e611506953f0e60fc3833f0d",item:this.divingSchool,editable:true,show:["owner","editor","instructor"]}))))),t("app-modal-footer",{key:"fea4024916b90899b064adf37f54dc99ebaecee0",disableSave:!this.validDivingSchool,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};u.style=b;export{u as modal_diving_school_update};