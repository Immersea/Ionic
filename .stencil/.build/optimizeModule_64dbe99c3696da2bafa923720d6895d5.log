import{r as e,h as t,H as i,f as s}from"./p-cbe60c68.js";import{z as n,c as o,T as a}from"./p-30358c9d.js";import{l}from"./p-1af05547.js";import"./p-c7ee7cfe.js";import{n as c}from"./p-5d4a8e1f.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const h="popover-new-dive-trip .validation-error{text-align:center;font-size:0.7rem;color:red}";const p=h;const r=class{constructor(t){e(this,t);this.sitesList=[];this.divingCentersList=[];this.tripDive=undefined;this.diveIndex=undefined;this.diveSite=undefined;this.updateView=false;this.noDivePlans=false;this.validTrip=false}async componentWillLoad(){this.sitesList=n.diveSitesList;this.divingCentersList=o.divingCentersList}componentDidLoad(){if(this.tripDive&&this.diveIndex>=0){this.participants=this.tripDive.numberOfParticipants;this.tripDate=this.tripDive.divePlan.dives[0].date;console.log("this.tripDate",this.tripDive,this.tripDate,this.tripDate.toISOString());this.diveSite=this.sitesList.find((e=>e.id===this.tripDive.divePlan.dives[this.diveIndex].diveSiteId));this.divingCenterId=this.tripDive.divePlan.dives[this.diveIndex].divingCenterId;this.setSelectDivePlans();this.divePlanTitle=this.tripDive.divePlan.title;this.divePlanName=this.tripDive.divePlan.configuration?this.tripDive.divePlan.configuration.stdName:null;this.surfaceInterval=this.diveIndex>0?this.tripDive.divePlan.dives[this.diveIndex].surfaceInterval:undefined;this.validateTrip()}}async openSearchSite(){const e=await c.create({component:"popover-search-dive-site",translucent:true});e.onDidDismiss().then((e=>{this.divePlanName=null;const t=e.data;this.diveSite=this.sitesList.find((e=>e.id===t));this.validateTrip();this.setSelectDivePlans()}));e.present()}setSelectDivePlans(){const e=this.el.querySelector("#selectDivePlans");const t={header:a.getTransl("dive-profile","Dive Profile")};e.interfaceOptions=t;const i=Array.from(e.getElementsByTagName("ion-select-option"));i.map((t=>{e.removeChild(t)}));if(this.diveSite.divePlans&&this.diveSite.divePlans.length>0){e.placeholder=a.getTransl("select","Select");this.diveSite.divePlans.map((t=>{const i=document.createElement("ion-select-option");i.value=t;i.textContent=t;e.appendChild(i)}));this.noDivePlans=false;e.disabled=false}else{e.placeholder=a.getTransl("no-profiles","No Dive Profiles available for this site");e.disabled=true;this.noDivePlans=true}const s=this.el.querySelector("#selectDivingCenter");const n={header:a.getTransl("diving-center","Diving Center")};s.interfaceOptions=n;const o=Array.from(s.getElementsByTagName("ion-select-option"));o.map((e=>{s.removeChild(e)}));if(this.diveSite.divingCenters&&this.diveSite.divingCenters.length>0){s.placeholder=a.getTransl("select","Select");const e=document.createElement("ion-select-option");e.value=null;e.textContent="-";s.appendChild(e);this.diveSite.divingCenters.map((e=>{const t=document.createElement("ion-select-option");const i=this.divingCentersList.find((t=>t.id===e));t.value=e;t.textContent=i.displayName;s.appendChild(t)}));s.disabled=false}else{s.placeholder=a.getTransl("no-divecenters","No Diving Centers available for this site");s.disabled=true}this.updateView=!this.updateView}updateDate(e){this.tripDate=new Date(e.detail.value);this.validateTrip()}updateSurfaceInterval(e){this.surfaceInterval=e;this.validateTrip()}updateParticipants(e){this.participants=l.exports.toNumber(e.detail.value);this.validateTrip()}updateTitle(e){this.divePlanTitle=e.detail.value;this.validateTrip()}updateDivePlanName(e){this.divePlanName=e.detail.value}updateDivingCenter(e){this.divingCenterId=e.detail.value}validateTrip(){this.validTrip=(!this.diveIndex&&!this.tripDive||this.diveIndex===0?l.exports.isDate(this.tripDate)&&l.exports.isNumber(this.participants)&&l.exports.isString(this.divePlanTitle):l.exports.isNumber(this.surfaceInterval))&&this.diveSite&&l.exports.isString(this.diveSite.id);this.updateView=!this.updateView}async save(){c.dismiss({participants:this.participants,date:this.tripDate,title:this.divePlanTitle,diveSiteId:this.diveSite.id,divingCenterId:this.divingCenterId,divePlanName:this.divePlanName,surfaceInterval:this.surfaceInterval})}cancel(){c.dismiss()}render(){return t(i,{key:"3a7e40f75c5f0e3911fabbeeef2e873446f0d460"},t("ion-toolbar",{key:"b22480eb75925580e41f697a645e948634ef6ec9"},t("ion-title",{key:"0e3540e553e793b81aad31f873720aad7922e2c5"},t("my-transl",{key:"781c987a8a701b4c85d6a593d6e86ed9656d8e2d",tag:"dive-trip",text:"Dive Trip"}))),!this.diveIndex&&!this.tripDive||this.diveIndex===0?[t("app-form-item",{"label-tag":"date-time","label-text":"Date/Time",value:this.tripDate?this.tripDate.toISOString():null,name:"tripDate","input-type":"date",datePresentation:"date-time",lines:"inset",onFormItemChanged:e=>this.updateDate(e)}),t("app-form-item",{"label-tag":"title","label-text":"Title",value:this.divePlanTitle,name:"divePlanTitle","input-type":"text",lines:"inset",onFormItemChanged:e=>this.updateTitle(e)}),t("app-form-item",{"label-tag":"number-participants","label-text":"Max Number of Participants",value:this.participants,name:"participants","input-type":"number",lines:"inset",onFormItemChanged:e=>this.updateParticipants(e)})]:t("ion-item",null,t("ion-select",{label:a.getTransl("surface-interval","Surface Interval"),onIonChange:e=>this.updateSurfaceInterval(e.detail.value),value:this.surfaceInterval},t("ion-select-option",{value:.5},"0:30"),t("ion-select-option",{value:1},"1:00"),t("ion-select-option",{value:1.5},"1:30"),t("ion-select-option",{value:2},"2:00"),t("ion-select-option",{value:2.5},"2:30"),t("ion-select-option",{value:3},"3:00"),t("ion-select-option",{value:3.5},"3:30"),t("ion-select-option",{value:4},"4:00"),t("ion-select-option",{value:4.5},"4:30"),t("ion-select-option",{value:5},"5:00"),t("ion-select-option",{value:5.5},"5:30"),t("ion-select-option",{value:6},"6:00"),t("ion-select-option",{value:6.5},"6:30"),t("ion-select-option",{value:7},"7:00"),t("ion-select-option",{value:7.5},"7:30"),t("ion-select-option",{value:8},"8:00"),t("ion-select-option",{value:8.5},"8:30"),t("ion-select-option",{value:9},"9:00"),t("ion-select-option",{value:9.5},"9:30"),t("ion-select-option",{value:10},"10:00"),t("ion-select-option",{value:10.5},"10:30"),t("ion-select-option",{value:11},"11:00"),t("ion-select-option",{value:11.5},"11:30"),t("ion-select-option",{value:12},"12:00"))),t("ion-item",{key:"4f32ec99bb03e643e2db2085ced386fdca1ad97d",button:true,onClick:()=>this.openSearchSite()},t("ion-input",{key:"b997a5d2e620366aca5d34df86bf0e3d9dc463a9",label:a.getTransl("dive-site","Dive Site"),"label-placement":"floating",placeholder:a.getTransl("select-dive-site","Select Dive Site"),value:this.diveSite?this.diveSite.displayName:undefined}),t("ion-icon",{key:"16e41dcc053db5ad2cb915738dae9f0077b303c3",slot:"end",name:"search-outline"})),t("ion-item",{key:"8870fe5fb942990185213b431a560ef7b0c22fb3"},t("ion-select",{key:"18e2314e42d2ac83cca21ecdd307c9e7104e0c42",label:a.getTransl("dive-profile","Dive Profile"),id:"selectDivePlans",onIonChange:e=>this.updateDivePlanName(e),disabled:true,value:this.divePlanName})),t("ion-item",{key:"0b89728c8bb4b43ddfdac0eb4dd203a8a75077b6"},t("ion-select",{key:"f5b39ae362964971dd987c1481dbb5519ef51e54",label:a.getTransl("diving-center","Diving Center"),id:"selectDivingCenter",onIonChange:e=>this.updateDivingCenter(e),disabled:true,value:this.divingCenterId})),t("app-modal-footer",{key:"66be28192b23762f5eaf19b759058c24eb08e7a4",disableSave:!this.validTrip,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return s(this)}};r.style=p;export{r as popover_new_dive_trip};