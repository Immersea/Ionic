import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import{U as s,n as d,q as n,c as o,ac as r,a3 as c,b as h}from"./p-30358c9d.js";import"./p-c7ee7cfe.js";import{n as l,o as p}from"./p-5d4a8e1f.js";import{l as f}from"./p-1af05547.js";import{S as m}from"./p-a75993af.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const b="modal-diving-center-update ion-list{width:100%}";const u=b;const g=class{constructor(t){e(this,t);this.stdConfigurations=[];this.divingCenterId=undefined;this.divingCenter=undefined;this.segment="map";this.updateView=true;this.validDiveCenter=false;this.diveSites=undefined;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"dive-sites",text:"Dive Sites"},{tag:"team"}];this.tmpDivingCenterId=undefined;this.slider=undefined;this.showDCId=false}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new n(e);this.stdConfigurations=f.exports.cloneDeep(this.userSettings.userConfigurations)}));await this.loadDivingCenter()}async loadDivingCenter(){if(this.divingCenterId){this.showDCId=false;this.tmpDivingCenterId=this.divingCenterId;this.divingCenter=await o.getDivingCenter(this.divingCenterId);this.draggableMarkerPosition={lat:this.divingCenter.position.geopoint.latitude,lon:this.divingCenter.position.geopoint.longitude}}else{this.showDCId=true;this.divingCenter=new r;this.divingCenter.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}this.loadDivingCenterSites()}loadDivingCenterSites(){this.diveSites=o.loadDivingCenterSites(this.divingCenter)}async componentDidLoad(){this.slider=new m(".slider-diving-center",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+c(this.divingCenter.coverURL,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateDiveCenter()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}updateLocation(e){this.draggableMarkerPosition={lat:f.exports.toNumber(e.detail.lat),lon:f.exports.toNumber(e.detail.lon)};this.divingCenter.setPosition(e.detail.lat,e.detail.lon);this.validateDiveCenter()}updateAddress(e){this.divingCenter.setAddress(e.detail)}handleChange(e){if(e.detail.name=="facebook"||e.detail.name=="instagram"||e.detail.name=="twitter"||e.detail.name=="website"||e.detail.name=="email"){const t=f.exports.toLower(e.detail.value).split(" ").join("-");this.divingCenter[e.detail.name]=t}else if(e.detail.name=="id"){this.setTmpId(e.detail.value)}else{this.divingCenter[e.detail.name]=e.detail.value}this.updateView=!this.updateView;this.validateDiveCenter()}setTmpId(e){this.tmpDivingCenterId=f.exports.toLower(e).trim().split(" ").join("-").substring(0,16)}updateImageUrls(e){const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.divingCenter.photoURL=i}else{this.divingCenter.coverURL=i}}uniqueIdValid(e){if(e.detail){this.divingCenterId=this.tmpDivingCenterId}else{this.divingCenterId=null}}validateDiveCenter(){this.validDiveCenter=f.exports.isNumber(this.divingCenter.position.geopoint.latitude)&&f.exports.isNumber(this.divingCenter.position.geopoint.longitude)&&f.exports.isString(this.divingCenterId)&&f.exports.isString(this.divingCenter.displayName)&&f.exports.isString(this.divingCenter.description)}async openAddDiveSite(){const e=await l.create({component:"popover-search-dive-site",translucent:true});e.onDidDismiss().then((e=>{const t=e.data;this.divingCenter.diveSites.push(t);this.loadDivingCenterSites()}));e.present()}removeDiveSite(e){const t=this.divingCenter.diveSites.findIndex((t=>t==e));this.divingCenter.diveSites.splice(t,1);this.loadDivingCenterSites()}async save(){await o.updateDivingCenter(this.divingCenterId,this.divingCenter,this.userProfile.uid);return p.dismiss()}async cancel(){return p.dismiss()}render(){return t(i,{key:"0c3481c5b7a3fb24e63a46e24f4c6754ebcf5a22"},t("ion-header",{key:"d5efe33a26080da0b13554a79a70a79ac8d32e9a"},t("app-upload-cover",{key:"e5b6453a7d61e3f2411933fb96ecae8a2fc865c7",item:{collection:h,id:this.divingCenterId,photoURL:this.divingCenter.photoURL,coverURL:this.divingCenter.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("app-header-segment-toolbar",{key:"3217110118e8582224a7e7e0469c42189f00aee8",color:"divingcenter",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"5347f97f6f664f4e85736321a2c3259f91ecb8e0",class:"slides"},t("swiper-container",{key:"98bf170b9434be4c202af5a8b19192fb29f486a7",class:"slider-diving-center swiper"},t("swiper-wrapper",{key:"1bfa6dac0d571d0f4f7f157369e3ca163986a403",class:"swiper-wrapper"},t("swiper-slide",{key:"a79b58406a8d97029fc95f7db81e2b6da2771daf",class:"swiper-slide"},t("div",{key:"92502e2cfd2c6ce167f8670f6b803224ffe7dab0",id:"map-container"},t("app-map",{key:"d6b1d9b97ea4ace610a09488e181235347ba4377",id:"map",pageId:"diving-center",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),t("swiper-slide",{key:"e21d2d87d0a83303404f1377116ba94c43526470",class:"swiper-slide"},t("app-coordinates",{key:"b680b33a750313329cc43eff0343a8f7b71a452d",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),t("swiper-slide",{key:"8a067d6174b0f4c9ced19e43406491f634ddb809",class:"swiper-slide"},t("ion-list",{key:"c46cc2a5c2906d31aa98d8e64d4fd08ff72fc37e",class:"ion-no-padding"},t("ion-list-header",{key:"012d7d9340d404ce7f300c7b0deb0f7b393e0984"},t("my-transl",{key:"9ecc6cf01bb572a5be249178882926bcdaf609e0",tag:"general-information",text:"General Information",isLabel:true})),t("app-form-item",{key:"ed22239ea29e1ca79c973f38f9daa422d7e25002","label-tag":"name","label-text":"Name",value:this.divingCenter.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),onFormItemBlur:()=>this.setTmpId(this.divingCenter.displayName),validator:["required"]}),this.showDCId?t("app-form-item",{"label-tag":"unique-id","label-text":"Unique ID",value:this.tmpDivingCenterId,name:"id","input-type":"text",onFormItemChanged:e=>this.handleChange(e),onIsValid:e=>this.uniqueIdValid(e),validator:["required",{name:"uniqueid",options:{type:h}}]}):undefined,t("app-form-item",{key:"a033309dd140d99d64ed704db84943d34c6f319f","label-tag":"description","label-text":"Description",value:this.divingCenter.description,name:"description",textRows:10,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"72a36839efb448dd8f981ec34390951dfda02aff","label-tag":"phone","label-text":"Phone",value:this.divingCenter.phoneNumber,name:"phoneNumber","input-type":"tel",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"c9a37e2cd9e370517cc4572755ca58b14302b4bf","label-tag":"email","label-text":"Email",value:this.divingCenter.email,name:"email","input-type":"email",onFormItemChanged:e=>this.handleChange(e),validator:["email"]}),t("app-form-item",{key:"1e31f8f6296106e90746401f765dd26329aeb311","label-tag":"website","label-text":"Website",value:this.divingCenter.website,name:"website","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingCenter.website?t("a",{class:"ion-padding-start",href:"http://"+this.divingCenter.website,target:"_blank"},"http://"+this.divingCenter.website):undefined,t("app-form-item",{key:"b16f45f3f2b24125d6b0c857459769097440e4a5","label-tag":"facebook-id","label-text":"Facebook ID",value:this.divingCenter.facebook,name:"facebook","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingCenter.facebook?t("a",{class:"ion-padding-start",href:"https://www.facebook.com/"+this.divingCenter.facebook,target:"_blank"},"https://www.facebook.com/"+this.divingCenter.facebook):undefined,t("app-form-item",{key:"ecd0f367218f2b16e58b66526f403999b793993a","label-tag":"instagram-id","label-text":"Instagram ID",value:this.divingCenter.instagram,name:"instagram","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingCenter.instagram?t("a",{class:"ion-padding-start",href:"https://www.instagram.com/"+this.divingCenter.instagram,target:"_blank"},"https://www.instagram.com/"+this.divingCenter.instagram):undefined,t("app-form-item",{key:"96982971138fce0907a1c52c8e8abaa7c0d69a89","label-tag":"twitter id","label-text":"Twitter ID",value:this.divingCenter.twitter,name:"twitter","input-type":"url",onFormItemChanged:e=>this.handleChange(e),validator:[]}),this.divingCenter.twitter?t("a",{class:"ion-padding-start",href:"https://www.twitter.com/"+this.divingCenter.twitter,target:"_blank"},"https://www.twitter.com/"+this.divingCenter.twitter):undefined)),t("swiper-slide",{key:"78be3d178179b037b5f4494e5307db1f8f2d0775",class:"swiper-slide"},t("ion-grid",{key:"eeb4dd7285eac01095d86f9e473f708b525ad1cd"},t("ion-row",{key:"945913465ad58fd80e37b07addced3409b565c12",class:"ion-text-start"},this.diveSites.divingCenterSites.map((e=>t("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},t("app-dive-site-card",{diveSite:e,startlocation:this.divingCenter,edit:true,onRemoveEmit:e=>this.removeDiveSite(e.detail.value)})))),t("ion-col",{key:"937546207a3612d97becc453124a036dd7d5d29c","size-sm":"12","size-md":"6","size-lg":"4"},t("ion-card",{key:"ac60f893f05054b3a45a58b5d402aab9ad4ccebd",onClick:()=>this.openAddDiveSite()},t("ion-card-content",{key:"1d6a4a7dd6cf3c18d2db0d6a87dde2acaa0c4d93",class:"ion-text-center"},t("ion-icon",{key:"e5526d7ddf4dd49e2bc3c0cc0a9bce6ce895d067",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),t("swiper-slide",{key:"0908ddade486f7d666d5e0060843d1c9a5797112",class:"swiper-slide"},t("app-users-list",{key:"03c285ae02c25961e5db0954501adfb838e4f58f",item:this.divingCenter,editable:true,show:["owner","editor"]}))))),t("app-modal-footer",{key:"90ba8addc6d980e13ece831770c0fdb66c42f965",disableSave:!this.validDiveCenter,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};g.style=u;export{g as modal_diving_center_update};