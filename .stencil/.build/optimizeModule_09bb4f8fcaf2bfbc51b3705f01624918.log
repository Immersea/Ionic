import{r as t,h as i,f as e}from"./p-cbe60c68.js";import{aQ as s,U as o,T as a,a5 as n,aI as l}from"./p-30358c9d.js";import"./p-c7ee7cfe.js";import{b as h}from"./p-5d4a8e1f.js";import{l as r}from"./p-1af05547.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const d="popover-level .scrollx{display:flex;flex-wrap:nowrap;overflow-x:auto}popover-level .scrollx .item{flex:0 0 0 0}popover-level .scrollx ::-webkit-scrollbar{display:none}popover-level .notification{min-height:20px;height:20px;font-size:0.8em;color:#ea6153;border-width:1px;border-color:#ea6153;padding-left:10px}popover-level .notification .item-inner{margin-left:0px !important;border-bottom:0px !important}popover-level .notification .icon{font-size:1.7em;padding-left:6px !important;padding-top:4px !important}";const f=d;const p=class{constructor(i){t(this,i);this.hasTrimixlicence=true;this.hasReblicence=true;this.updateGas=true;this.ccr=false;this.parameters=undefined;this.stdGasesList=undefined;this.levelProp=undefined;this.units="Metric";this.gasWarning=false;this.ENDWarning=false;this.level=new s;this.form=undefined;this.updateView=false}async componentWillLoad(){this.hasTrimixlicence=await o.checkLicence("trimix");this.hasReblicence=await o.checkLicence("reb");this.level=new s;if(this.levelProp.depth){this.level.setGas(this.levelProp.gas.fO2,this.levelProp.gas.fHe);this.level.setValue("depth",this.levelProp.depth);this.level.setValue("setpoint",this.levelProp.setpoint);this.level.setValue("time",this.levelProp.time);this.level.setValue("index",this.levelProp.index)}this.setForm();this.updateStdGasList()}componentDidLoad(){this.scrollGas=this.el.querySelector("#scrollGas");this.updateStdGasList();this.popover=this.el.closest("ion-popover")}disconnectedCallback(){this.setForm()}async setForm(){this.form=this.level.getForm();this.hasTrimixlicence=await o.checkLicence("trimix");this.hasReblicence=await o.checkLicence("reb")}updateStdGasList(){this.stdGases=[];let t=false;let i=0,e=0;this.stdGasesList.forEach((s=>{i++;let a=this.level.gas.O2===s.O2&&this.level.gas.He===s.He?true:false;if(a){t=true;e=i}s.ppO2=this.parameters.bottomppO2;const n=s.getGas();const l=o.userRoles.licences.checkGasLimitations(n,false);this.stdGases.push({selected:a,active:l,gas:n})}));if(t&&this.scrollGas){setTimeout((()=>{let t=this.scrollGas.scrollWidth;let s=this.scrollGas.clientWidth;let o=i/(t/s);e=e-o;e=e<0?0:e;this.scrollGas.scrollLeft=t*e/i*1.15}))}this.updateNewGas=t&&this.updateGas;this.updateWarnings(this.level.depth,this.level.gas.ppO2)}updateWarnings(t,i){this.gasWarning=this.level.gas.highPO2WarningatDepthWithTarget(t,i);this.ENDWarning=this.level.gas.highENDWarningatDepth(this.level.depth);this.updateView=!this.updateView}setStdGasForDepth(){if(!this.hasTrimixlicence){return}if(this.updateNewGas){let t=r.exports.find(this.stdGases,(t=>t.gas.fromDepth>=this.level.depth));if(t){t.selected=true;this.level.setValue("setpoint",t.gas.ppO2);if(!this.hasTrimixlicence&&t.He>0){t.gas.He=0}this.level.setGas(t.gas.O2/100,t.gas.He/100)}}this.setForm()}selectStdGas(t){if(!this.hasTrimixlicence&&t.He>0){o.checkLicence("trimix",true);return}this.updateNewGas=true;this.level.setValue("setpoint",t.ppO2);this.level.setGas(t.O2/100,t.He/100);this.updateStdGasList();this.setForm()}updateValue(t){this.level.setValue(t,this.form[t]);if(t=="depth"){this.setStdGasForDepth();this.updateStdGasList()}else if(t=="o2"||t=="he"){this.level.setGas(r.exports.round(this.form.o2/100,2),r.exports.round(this.form.he/100,2));this.updateStdGasList()}}inputHandler(t){let i=r.exports.toNumber(t.detail.value);this.form[t.detail.name]=i;this.updateValue(t.detail.name)}blurHandler(t){let i=r.exports.toNumber(t.detail.value);if(t.detail.name==="depth"){const t=o.userRoles.licences.checkDepthLimitations();if(i>t){i=t}}else if(t.detail.name==="o2"){const t=o.userRoles.licences.getUserLimitations().minO2;const e=o.userRoles.licences.getUserLimitations().maxO2;if(i>e){i=e}else if(i<t){i=t}if(this.form.he+i>100){this.form.he=100-i}}else if(t.detail.name==="he"){const t=o.userRoles.licences.getUserLimitations().maxHe;if(i>t){i=t}if(this.form.o2+i>100){this.form.o2=100-i}}else if(t.detail.name==="setpoint"){i=r.exports.toNumber(i)}this.form[t.detail.name]=i;this.updateValue(t.detail.name);this.setForm();this.updateStdGasList()}async showpO2Info(){const t=await h.create({header:"pO2 setpoint",message:a.getTransl("po2-setpoint-info","The pO2 setpoint is used to update the setpoint of the CCR within the range of this level or deco gas."),buttons:[{text:a.getTransl("ok","OK")}]});t.present()}render(){return[i("ion-list",{key:"98ff59d9fb940587c8b0f80b7ee2161474060afc",style:{marginBottom:"0px"}},i("ion-grid",{key:"22d32c60fab0f73adb1fdb9a0f21067b6f824798",class:"ion-no-padding"},i("ion-row",{key:"8b9f121bf47385c19f5f8573d9e13ceac2197a7f"},i("ion-col",{key:"af54b9057bcf9cce091f4989e0e7e1e9a5572dce"},i("app-form-item",{key:"0ada6e95efb33d26c68540645b32a62602c6dfbf","label-tag":"depth","label-text":"Depth",value:this.form.depth,name:"depth","input-type":"number",onFormItemChanged:t=>this.inputHandler(t),onFormItemBlur:t=>this.blurHandler(t),validator:["required",{name:"minmaxvalue",options:{min:1,max:o.userRoles.licences.checkDepthLimitations()}}]})),i("ion-col",{key:"2a6a0cf1a5d7b292fe5d444e62fd2bee538e96a4"},i("app-form-item",{key:"73de35c8e6a4f163c3757eacbfdebbe96f072e97","label-tag":"time","label-text":"Time",value:this.form.time,name:"time","input-type":"number",onFormItemChanged:t=>this.inputHandler(t),onFormItemBlur:t=>this.blurHandler(t),validator:["required"]}))),i("ion-row",{key:"17698ecf38510ba7bd5af8882d41dee76bfe2621"},i("ion-col",{key:"ad612bf30e918b11cb47da24835861c85e2da477"},i("ion-row",{key:"6fd3828426b1f66035497a08eba94fbf097629f0",class:"ion-no-padding"},i("app-form-item",{key:"8d667ffcf54036666fc8350d97f3b6552eac34bf","label-text":"O2",value:this.form.o2,name:"o2","input-type":"number",onFormItemChanged:t=>this.inputHandler(t),onFormItemBlur:t=>this.blurHandler(t),forceInvalid:this.gasWarning,validator:["required",{name:"minmaxvalue",options:{min:o.userRoles.licences.getUserLimitations().minO2,max:o.userRoles.licences.getUserLimitations().maxO2}}]})),this.gasWarning?i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("div",{class:"notification"},i("ion-icon",{name:"warning","item-start":true}),"High pO2 (",this.level.gas.getpO2atDepth(this.level.depth),")!"))):undefined),i("ion-col",{key:"a659ca372d2611dd9ada58a1de83bb5e34e667c4"},this.hasTrimixlicence?[i("ion-row",{class:"ion-no-padding"},i("app-form-item",{"label-text":"He",value:this.form.he,name:"he","input-type":"number",onFormItemChanged:t=>this.inputHandler(t),onFormItemBlur:t=>this.blurHandler(t),forceInvalid:this.ENDWarning,validator:["required",{name:"minmaxvalue",options:{min:0,max:o.userRoles.licences.getUserLimitations().maxHe}}]})),this.ENDWarning?i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("div",{class:"notification"},i("ion-icon",{name:"warning","item-start":true}),"High END (",this.level.gas.getEND(this.level.depth),n.depthUnit,")!"))):undefined]:i("app-form-item",{"label-text":"He",value:this.form.he,onClick:()=>o.checkLicence("trimix",true)}))),this.ccr?i("ion-row",null,i("ion-col",null,this.hasReblicence?i("app-form-item",{"label-tag":"pO2-setpoint","label-text":"pO2 setPoint",value:this.form.setpoint,name:"setpoint","input-type":"number",onFormItemChanged:t=>this.inputHandler(t),onFormItemBlur:t=>this.blurHandler(t),validator:[{name:"minmaxvalue",options:{min:.5,max:1.6}}]}):i("app-form-item",{"label-tag":"pO2-setpoint","label-text":"pO2 setPoint",value:this.form.setpoint,onClick:()=>o.checkLicence("reb",true)})),i("ion-col",{size:"2",class:"ion-no-padding"},i("ion-button",{shape:"round",fill:"clear","icon-only":true,class:"ion-no-padding",onClick:()=>this.showpO2Info()},i("ion-icon",{name:"help-circle-outline"})))):undefined,i("ion-row",{key:"e24a5d9eef965384fffb9f211de79e5b61ffdf2f",class:"scrollx",id:"scrollGas"},this.stdGases.map((t=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:t.selected?"secondary":"primary",disabled:!t.active,onClick:()=>this.selectStdGas(t.gas)},l.getGasName(t.gas)))))),i("ion-row",{key:"d63892b600a546b5bc2d8b37dc8d2159c56c6fe8"},i("ion-col",{key:"133f732ed796d02eff438eca16b17a1a6d38b22d"},i("div",{key:"58698cf487c3c10da85cf5cfb2572b5218f0c52a",class:"notification",style:{color:"blue"}},"MOD:"," ",this.level.gas.getModF(this.level.gas.fO2,this.level.gas.ppO2),n.depthUnit," @ ",this.level.gas.ppO2," pO2"),i("div",{key:"c942c041db55450b75e7246b53b594930d87f2ae",class:"notification",style:{color:"blue"}},"END: ",this.level.gas.getEND(this.level.depth),n.depthUnit," @ ",this.level.depth,n.depthUnit),i("div",{key:"13b4a7c83374c504810ed310d25a56c8bb92c7b7",class:"notification",style:{color:"blue"}},"pO2: ",this.level.gas.getpO2atDepth(this.level.depth)," @"," ",this.level.depth,n.depthUnit))))),i("app-modal-footer",{key:"6c8fe7edf9fa6ce09e8d3bfa3f269e6236d7d9b9",onCancelEmit:()=>this.popover.dismiss(),onSaveEmit:()=>this.popover.dismiss(this.form)})]}get el(){return e(this)}};p.style=f;export{p as popover_level};