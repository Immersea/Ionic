import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o}from"./p-5d4a8e1f.js";import{S as s}from"./p-a75993af.js";import{U as n,n as c,T as l,J as d,K as r,F as f,S as h,l as m}from"./p-736235c6.js";import{E as b}from"./p-46038295.js";import{l as p}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const u="modal-contact-update ion-list{width:100%}";const y=u;const k=class{constructor(t){e(this,t);this.contactId=undefined;this.contact=undefined;this.customerLocations=[];this.segment="information";this.updateView=true;this.validContact=false;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=n.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.segmentTitles={information:l.getTransl("information","Information")};await this.loadContact()}async loadContact(){if(this.contactId){const e=await d.getContact(this.contactId);this.contact=e}else{this.contact=new r;this.contact.users={[n.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-contact",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.validateContact()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.contact[e.detail.name]=e.detail.value;this.validateContact()}handleInformationChange(){this.validateContact()}selectCustomer(e){this.contact.customerId=e.detail.value;f.getCustomer(e.detail.value).then((e=>{this.customer=e;this.customerLocations=e.locations;this.setLocationsSelect()}));this.validateContact()}selectCustomerLocation(e){this.contact.customerLocationId=e.detail.value;this.validateContact()}setLocationsSelect(){const e=this.el.querySelector("#selectLocation");const t={header:l.getTransl("location","Locations")};e.interfaceOptions=t;const a=Array.from(e.getElementsByTagName("ion-select-option"));a.map((t=>{e.removeChild(t)}));e.placeholder=l.getTransl("select","Select");this.customerLocations.map((t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=l.getTransl(t.type,f.getLocationsTypes(t.type)[0].locationName);e.appendChild(a)}));this.updateSlider()}updateParam(){this.validateContact()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break}}}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.contact.photoURL=a}else{this.contact.coverURL=a}this.save(false)}validateContact(){this.validContact=p.exports.isString(this.contact.firstName)&&p.exports.isString(this.contact.lastName)&&p.exports.isString(this.contact.customerId)}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteContact(){try{await d.deleteContact(this.contactId);o.dismiss()}catch(e){h.presentAlertError(e)}}async save(e=true){const t=await d.updateContact(this.contactId,this.contact,this.userProfile.uid);if(this.contactId){return e?o.dismiss():true}else{this.contactId=t.id;return true}}async cancel(){o.dismiss()}render(){return t(a,{key:"60dd79e132be77550bfddce413f7fa06595ea49d"},t("ion-header",{key:"d8072ddf2e1ac71c293500ecafd829efac4199fb"},t("app-upload-cover",{key:"f6ccea9295dbbb2b345951fb183d970f826b6e54",item:{collection:m,id:this.contactId,photoURL:this.contact.photoURL,coverURL:this.contact.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-header",{key:"3b154f3e55f9947fa4c29bf7fee63c5fecd031a6"},t("ion-toolbar",{key:"45fcbb58e68262a805c23c9e5408e9caf32c7ada"},t("ion-segment",{key:"5723bb3ccbb7cc53e6943cd68c1573eea0f868b3",mode:"md",color:b.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},t("ion-segment-button",{key:"ccc6620e41a0d316b45d0f25997de5868ecabc75",value:"information",layout:"icon-start"},t("ion-label",{key:"20b9099f120bfb836cc6c46be2c15e8a8f1a6418"},this.segmentTitles.information))))),t("ion-content",{key:"15a22f79aed152278c5eadc43df31d553cfdd617",class:"slides"},t("swiper-container",{key:"a2e844141b3b542874be69c99d77f226dce40f0d",class:"slider-edit-contact swiper"},t("swiper-wrapper",{key:"961dcff1d972885756455ec42965c48a24577536",class:"swiper-wrapper"},t("swiper-slide",{key:"e65a8724535ffc2daa4986cc9bb403c6096212a4",class:"swiper-slide"},t("ion-list",{key:"bd14a9bc6c53af58ed47bcbf5f5528eb3653e8f0",class:"ion-no-padding"},t("ion-list-header",{key:"0c4af64911ea7b58de64708c87f5c450f8cf5f2f"},t("my-transl",{key:"fc6cfc094b48e248eb7b3dea432fe167828a590a",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"8c4feaadadb39dd918f5524d1b2f9dd92028f0aa",lines:"none"},t("ion-select",{key:"fefe4bced33db01ade38cb899b77e8eb8bd65a98",color:"trasteel",id:"selectCustomer",interface:"action-sheet",label:l.getTransl("customer","Customer"),"label-placement":"floating",onIonChange:e=>this.selectCustomer(e),value:this.contact&&this.contact.customerId?this.contact.customerId:null},f.customersList.map((e=>t("ion-select-option",{value:e.id},e.fullName))))),t("ion-item",{key:"8fa147be84f119a7e8e68af3942413f3c4b54f1e",lines:"none"},t("ion-select",{key:"19b8487ca2ddf5951d32313c460d3f7c5edd0c78",color:"trasteel",id:"selectLocation",interface:"action-sheet",label:l.getTransl("location","Location"),"label-placement":"floating",onIonChange:e=>this.selectCustomerLocation(e),value:this.contact&&this.contact.customerLocationId?this.contact.customerLocationId:null})),t("app-form-item",{key:"56db948d135e3b665d16ba89d4997f6271497eaa","label-tag":"name","label-text":"Name",value:this.contact.firstName,name:"firstName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"eba52183a1fea05fc77e28109d7edc6912f80804","label-tag":"surname","label-text":"Surname",value:this.contact.lastName,name:"lastName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"78f6f0b0e00046bd76b9b9d8c6ffdc3b051aa0a6","label-tag":"work-position","label-text":"Work Position",value:this.contact.workPosition,name:"workPosition","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"0f10a825841e5cabf4641cd23f42554bc074130c","label-tag":"office-phone","label-text":"Office Phone",value:this.contact.officePhone,name:"officePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"cc92ba75e7a6cdd9297fa19c039dc15c47727a5b","label-tag":"mobile-phone","label-text":"Mobile Phone",value:this.contact.mobilePhone,name:"mobilePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"65fae6db7d6082c4793fd16a467767524b425189","label-tag":"email","label-text":"Email",value:this.contact.email,name:"email","input-type":"email","input-form-mode":"email",onFormItemChanged:e=>this.handleChange(e)})),this.contactId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteContact()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined)))),t("app-modal-footer",{key:"7077816cb545a83fc350e710cd5bcd76ce3504c2",color:b.getAppColor(),disableSave:!this.validContact,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};k.style=y;export{k as modal_contact_update};