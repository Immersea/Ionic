import{r as e,h as t,f as o}from"./p-cbe60c68.js";import{ah as s,F as r,i,P as c}from"./p-30358c9d.js";import{l as a}from"./p-1af05547.js";import{T as p}from"./p-87afedc7.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const d="page-projects{}";const n=d;const l=class{constructor(t){e(this,t);this.projectsList=[];this.filteredProjectsList=[];this.loading=true;this.updateView=true}componentWillLoad(){s.projectsList$.subscribe((async e=>{const t=[];e.map((e=>{const o=a.exports.cloneDeep(e);const s=r.getCustomersDetails(e.customerId);if(s){o.customerId=s.fullName;t.push(o)}}));this.updateList(t);this.loading=false}))}componentDidLoad(){this.searchToolbar=this.el.querySelector("#searchToolbar");this.updateList(this.projectsList)}updateList(e){this.projectsList=e;this.searchToolbar?this.searchToolbar.forceFilter(this.projectsList):undefined;this.updateView=!this.updateView}addProject(){s.presentProjectUpdate()}getOptions(){if(p.isRefraDBAdmin()){return[{tag:"delete",text:"Delete",icon:"trash",color:"danger",func:e=>s.deleteProject(e,false)},{tag:"duplicate",text:"Duplicate",icon:"duplicate",color:"secondary",func:e=>s.duplicateProject(e)},{tag:"edit",text:"Edit",icon:"create",color:"primary",func:e=>s.presentProjectUpdate(e)}]}else return null}render(){return[t("ion-header",{key:"b7ec3e322787675263a5398fca74a4bedc589646"},t("app-navbar",{key:"e4a080755dc078257020d205f66de7c3a4acfffd",tag:"projects",text:"Projects",color:"trasteel"}),t("app-search-toolbar",{key:"1cc985aa394539461a5e50c66ed4f77e2617ccd6",id:"searchToolbar",searchTitle:"projects",list:this.projectsList,orderFields:["customerId","projectLocalId"],color:"trasteel",placeholder:"Search by customer or project",filterBy:["customerId","projectLocalId","projectDescription"],onFilteredList:e=>this.filteredProjectsList=e.detail})),t("ion-content",{key:"dbcdab75b8044e7d7d94d6ef10a7dbfeaa616535"},p.isRefraDBAdmin()?t("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},t("ion-fab-button",{size:"small",onClick:()=>this.addProject(),color:"trasteel"},t("ion-icon",{name:"add"}))):undefined,t("app-infinite-scroll",{key:"70e2e76a18271dfa88e58eb51462b5c8b10e789d",list:this.filteredProjectsList,loading:this.loading,showFields:["projectLocalId"],showNotes:["projectDescription"],groupBy:["customerId"],options:this.getOptions(),returnField:"id",icon:i.getMapDocs(c).icon.name,onItemClicked:e=>s.presentProjectDetails(e.detail)}))]}get el(){return o(this)}};l.style=n;export{l as page_projects};