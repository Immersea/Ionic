{"version":3,"names":["pageDiveTripDetailsCss","PageDiveTripDetailsStyle0","PageDiveTripDetails","this","markers","tag","disabled","sm","md","lg","componentWillLoad","diveTrip","DiveTripsService","getDiveTrip","tripid","userSub","UserService","userProfile$","subscribe","user","userId","uid","showChatSlide","userProfile","columns","calculateColumns","tripDives","length","showChat","chatId","organiser","id","isArray","users","map","tripDive","bookings","booking","confirmedOrganiser","titles","setChatHeigth","slideContainer","el","querySelector","setAttribute","mapHeight","componentDidLoad","slider","Swiper","speed","spaceBetween","allowTouchMove","autoHeight","disconnectedCallback","unsubscribe","render","h","key","color","slot","onClick","RouterService","goBack","name","displayName","swiper","class","trip","style","marginTop","marginLeft","marginRight","text","Object","keys","i","diveTripId","tripDiveIndex","toNumber","undefined"],"sources":["src/components/udive/pages/dive-trip/page-dive-trip-details/page-dive-trip-details.scss?tag=page-dive-trip-details","src/components/udive/pages/dive-trip/page-dive-trip-details/page-dive-trip-details.tsx"],"sourcesContent":["page-dive-trip-details {\n  ion-segment-button {\n    --color-checked: var(--ion-color-divetrip-contrast);\n  }\n  #chat-slide {\n    width: 100%;\n    height: 100%;\n  }\n}\n","import {Component, h, Prop, State, Element} from \"@stencil/core\";\nimport {DiveTripsService} from \"../../../../../services/udive/diveTrips\";\nimport {DiveTrip} from \"../../../../../interfaces/udive/dive-trip/diveTrip\";\nimport {Marker} from \"../../../../../interfaces/interfaces\";\nimport {RouterService} from \"../../../../../services/common/router\";\nimport {Subscription} from \"rxjs\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {calculateColumns, mapHeight} from \"../../../../../helpers/utils\";\nimport Swiper from \"swiper\";\nimport {isArray, toNumber} from \"lodash\";\n\n@Component({\n  tag: \"page-dive-trip-details\",\n  styleUrl: \"page-dive-trip-details.scss\",\n})\nexport class PageDiveTripDetails {\n  @Element() el: HTMLElement;\n  @Prop() tripid: string;\n  @State() diveTrip: DiveTrip;\n  @State() titles = [\n    {tag: \"dives\"},\n    {tag: \"bookings\"},\n    {tag: \"chat\", disabled: true},\n  ];\n  @State() slider: Swiper;\n  markers: Marker[] = [];\n  mapElement: HTMLAppMapElement;\n  userSub: Subscription;\n  @State() userId: string;\n  @State() columns = {\n    sm: 12,\n    md: 6,\n    lg: 4,\n  };\n  @State() showChat: boolean = false;\n  @State() updateView: boolean = false;\n\n  async componentWillLoad() {\n    this.diveTrip = await DiveTripsService.getDiveTrip(this.tripid);\n    this.userSub = UserService.userProfile$.subscribe((user) => {\n      this.userId = user && user.uid ? user.uid : null;\n      this.showChatSlide();\n    });\n    this.userId =\n      UserService.userProfile && UserService.userProfile.uid\n        ? UserService.userProfile.uid\n        : null;\n\n    this.columns = calculateColumns(this.diveTrip.tripDives.length);\n  }\n\n  showChatSlide() {\n    this.showChat = false;\n    if (this.diveTrip && this.diveTrip.chatId) {\n      this.showChat = this.diveTrip.organiser.id === this.userId; //user is organiser\n      this.showChat =\n        this.showChat || isArray(this.diveTrip.users[this.userId]); //user is in the team\n      this.diveTrip.tripDives.map((tripDive) => {\n        tripDive.bookings.map((booking) => {\n          this.showChat =\n            this.showChat ||\n            (booking.uid === this.userId && booking.confirmedOrganiser); //user is confirmed in the bookings\n        });\n      });\n      this.titles[2].disabled = !this.showChat;\n    }\n  }\n\n  setChatHeigth() {\n    const slideContainer = this.el.querySelector(\"#chat-slide\");\n    slideContainer.setAttribute(\"style\", \"height: \" + mapHeight(null) + \"px\");\n  }\n\n  async componentDidLoad() {\n    this.slider = new Swiper(\".slider-dive-trip\", {\n      speed: 400,\n      spaceBetween: 100,\n      allowTouchMove: true,\n      autoHeight: true,\n    });\n  }\n\n  disconnectedCallback() {\n    this.userSub.unsubscribe();\n  }\n\n  render() {\n    return [\n      <ion-header>\n        <ion-toolbar color=\"divetrip\">\n          <ion-buttons slot=\"start\">\n            <ion-button onClick={() => RouterService.goBack()} icon-only>\n              <ion-icon name=\"arrow-back\"></ion-icon>\n            </ion-button>\n          </ion-buttons>\n          <ion-title>{this.diveTrip.displayName}</ion-title>\n        </ion-toolbar>\n      </ion-header>,\n      <app-header-segment-toolbar\n        color=\"divetrip\"\n        swiper={this.slider}\n        titles={this.titles}\n      ></app-header-segment-toolbar>,\n      <ion-content class=\"slides\">\n        <swiper-container class=\"slider-dive-trip swiper\">\n          <swiper-wrapper class=\"swiper-wrapper\">\n            <swiper-slide class=\"swiper-slide\">\n              <ion-grid>\n                <ion-row class=\"ion-text-start\">\n                  {this.diveTrip.tripDives.map((trip) => (\n                    <ion-col\n                      size-sm={this.columns.sm}\n                      size-md={this.columns.md}\n                      size-lg={this.columns.lg}\n                    >\n                      <app-dive-trip-card tripDive={trip} />\n                    </ion-col>\n                  ))}\n                </ion-row>\n              </ion-grid>\n            </swiper-slide>\n            <swiper-slide class=\"swiper-slide\">\n              <ion-grid>\n                <ion-row class=\"ion-text-start\">\n                  {!this.userId ? (\n                    <div\n                      style={{\n                        marginTop: \"10%\",\n                        marginLeft: \"auto\",\n                        marginRight: \"auto\",\n                      }}\n                    >\n                      <ion-card>\n                        <ion-card-header>\n                          <ion-card-title>\n                            <my-transl\n                              tag=\"please-login\"\n                              text=\"Please login to view this page\"\n                            />\n                          </ion-card-title>\n                        </ion-card-header>\n                      </ion-card>\n                    </div>\n                  ) : (\n                    Object.keys(this.diveTrip.tripDives).map((i) => (\n                      <ion-col\n                        size-sm={this.columns.sm}\n                        size-md={this.columns.md}\n                        size-lg={this.columns.lg}\n                      >\n                        <app-dive-trip-bookings\n                          diveTrip={this.diveTrip}\n                          diveTripId={this.tripid}\n                          tripDiveIndex={toNumber(i)}\n                        />\n                      </ion-col>\n                    ))\n                  )}\n                </ion-row>\n              </ion-grid>\n            </swiper-slide>\n            {this.showChat ? (\n              <swiper-slide class=\"swiper-slide\">\n                <app-chat id=\"chat-slide\" chatId={this.diveTrip.chatId} />\n              </swiper-slide>\n            ) : undefined}\n          </swiper-wrapper>\n        </swiper-container>\n      </ion-content>,\n    ];\n  }\n}\n"],"mappings":"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","ignoreList":[]}