import{r as e,h as t}from"./p-cbe60c68.js";import{U as i,S as a,R as s,ax as o,t as n,ay as c}from"./p-30358c9d.js";import{l as d}from"./p-1af05547.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const r="page-admin-agencies .cover{height:var(--coverHeight)}";const l=r;const f=class{constructor(t){e(this,t);this.selectedAgency=undefined;this.selectedAgencyCertifications=[];this.isUpdated=false;this.updateView=true}componentWillLoad(){this.userRoles=i.userRoles;this.systemSub=a.systemPreferences$.subscribe((e=>{this.agencies=[];Object.keys(e.divingAgencies).forEach((t=>{if(this.userRoles.isSuperAdmin()||this.userRoles.roles.includes(t.toLowerCase()+"-admin")){const i=e.divingAgencies[t];i.id=t;this.agencies.push(i)}}));if(!this.selectedAgency)this.selectedAgency=d.exports.cloneDeep(this.agencies[0]);this.createCertificationsArray()}))}createCertificationsArray(){this.selectedAgencyCertifications=[];const e=[];Object.keys(this.selectedAgency.certifications).map((t=>{let i=this.selectedAgency.certifications[t];i.id=t;e.push(i)}));this.selectedAgencyCertifications=d.exports.orderBy(e,"order")}disconnectedCallback(){this.systemSub.unsubscribe()}updateAgency(e){this.isUpdated=false;this.selectedAgency=d.exports.cloneDeep(this.agencies.find((t=>t.id==e)));this.createCertificationsArray()}handleChange(e){this.isUpdated=true;this.selectedAgency[e.detail.name]=e.detail.value}async reorderCertifications(e){this.isUpdated=true;const t=d.exports.cloneDeep(this.selectedAgencyCertifications);const i=t.splice(e.detail.from,1)[0];t.splice(e.detail.to,0,i);t.forEach(((e,t)=>{e.order=t}));e.detail.complete(t);this.selectedAgencyCertifications=d.exports.orderBy(t,"order")}async editCertification(e){this.isUpdated=true;let t=null;if(e===undefined){t={id:null,maxDepth:20,name:"",order:this.selectedAgencyCertifications?this.selectedAgencyCertifications.length:0,group:""}}else{t=d.exports.cloneDeep(this.selectedAgencyCertifications[e])}const i=await s.openModal("modal-dive-certification-update",{agencyId:this.selectedAgency.id,diveCertification:t});i.onDidDismiss().then((t=>{const i=t.data;if(i){if(e===undefined){this.selectedAgencyCertifications.push(i)}else{this.selectedAgencyCertifications[e]=i}this.updateView=!this.updateView}}))}updateImageUrls(e){this.isUpdated=true;const t=e.detail.type;const i=e.detail.url;if(t=="photo"){this.selectedAgency.photoURL=i}else{this.selectedAgency.coverURL=i}}async save(){this.selectedAgency.certifications={};this.selectedAgencyCertifications.map((e=>{this.selectedAgency.certifications[e.id]=e}));const e=await o.updateDivingAgency(this.selectedAgency.id,this.selectedAgency);if(e){this.isUpdated=false}}cancel(){this.isUpdated=false;this.updateAgency(this.selectedAgency.id)}render(){return[t("ion-header",{key:"00de5f6ac3a585b1e019b4bce6f82f1f51b6b60e",class:"cover"},t("app-upload-cover",{key:"b2f0679ad7d3cd0c10baa7753b564451aee109c6",item:{collection:n,id:this.selectedAgency.id,photoURL:this.selectedAgency.photoURL,coverURL:this.selectedAgency.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-content",{key:"931941f831a62cb6a6bf901f23382141f28d25dd"},t("ion-fab",{key:"eccfd7e84d945700294a27b27e3601b96f857b45",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:c(0)}},t("ion-menu-button",{key:"70232f533ae20394d3f3f23cf492044339fb1047",class:"fab-icon"})),t("ion-list",{key:"875c0ed80676f0f898201589344daf277d55d50a"},this.agencies.length>0?t("ion-item",null,t("ion-label",null,"Select Diving Agency"),t("ion-select",{value:this.selectedAgency.id,onIonChange:e=>this.updateAgency(e.detail.value),interface:"popover"},this.agencies.map((e=>t("ion-select-option",{value:e.id},e.name))))):undefined,t("app-form-item",{key:"3659f771de8e08ce4498ac405c040e94f0212d32","label-tag":"name","label-text":"Name",value:this.selectedAgency.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"66db30a47288ad8dd0ce8f62e3aec1dd773ac15b","label-tag":"website","label-text":"Website",value:this.selectedAgency.website,name:"website","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]})),t("ion-list",{key:"49afd2ae0ca662348884c519062bd10e701ad8b7"},t("ion-list-header",{key:"59df4bc5e69d5e83cd4523b913cabf85246ed65e"},t("ion-label",{key:"5455382ceb8c1b08f2018e93df07ab85cfa20ec3"},t("my-transl",{key:"54a81e9aa9c932e702a7b4d7fe6d1a5968a5aa66",tag:"certifications",text:"Certifications"})),t("ion-button",{key:"191c742bf8b02c2adbda06829a4862d61aa534fd","icon-only":true,onClick:()=>this.editCertification()},t("ion-icon",{key:"c60af01caba8f1a3d6db5b36da5956151688fafd",name:"add-circle-outline"}))),t("ion-reorder-group",{key:"89f63187254949ed0df5b62adb59851056786b39",disabled:false,onIonItemReorder:e=>this.reorderCertifications(e)},this.selectedAgencyCertifications.map(((e,i)=>t("ion-item",null,e.photoURL?t("ion-avatar",{slot:"start"},t("img",{src:e.photoURL})):undefined,t("ion-reorder",{slot:"end"}),t("ion-label",null,e.order+1,". ",e.name),t("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.editCertification(i)},t("ion-icon",{name:"create-outline"})))))))),this.isUpdated?t("app-modal-footer",{onSaveEmit:()=>this.save(),onCancelEmit:()=>this.cancel()}):undefined]}};f.style=l;export{f as page_admin_agencies};