{"version":3,"names":["pageProjectsCss","PageProjectsStyle0","PageProjects","this","projectsList","componentWillLoad","ProjectsService","projectsList$","subscribe","async","list","customersList","map","item","newItem","cloneDeep","customer","CustomersService","getCustomersDetails","customerId","fullName","push","updateList","loading","componentDidLoad","searchToolbar","el","querySelector","forceFilter","undefined","updateView","addProject","presentProjectUpdate","getOptions","TrasteelService","isRefraDBAdmin","tag","text","icon","color","func","returnField","deleteProject","duplicateProject","render","h","key","id","searchTitle","orderFields","placeholder","filterBy","onFilteredList","ev","filteredProjectsList","detail","vertical","horizontal","slot","edge","size","onClick","name","showFields","showNotes","groupBy","options","TrasteelFilterService","getMapDocs","PROJECTSCOLLECTION","onItemClicked","presentProjectDetails"],"sources":["src/components/trasteel/pages/refractories/page-projects/page-projects.scss?tag=page-projects","src/components/trasteel/pages/refractories/page-projects/page-projects.tsx"],"sourcesContent":["page-projects {\n  /* Component styles go here */\n}\n","import {Component, State, h} from \"@stencil/core\";\nimport {MapDataProject} from \"../../../../../interfaces/trasteel/refractories/projects\";\nimport {\n  PROJECTSCOLLECTION,\n  ProjectsService,\n} from \"../../../../../services/trasteel/refractories/projects\";\nimport {TrasteelFilterService} from \"../../../../../services/trasteel/common/trs-db-filter\";\nimport {cloneDeep} from \"lodash\";\nimport {CustomersService} from \"../../../../../services/trasteel/crm/customers\";\nimport {TrasteelService} from \"../../../../../services/trasteel/common/services\";\nimport {Element} from \"@stencil/core\";\n\n@Component({\n  tag: \"page-projects\",\n  styleUrl: \"page-projects.scss\",\n})\nexport class PageProjects {\n  @Element() el: HTMLElement;\n  projectsList: MapDataProject[] = [];\n  @State() filteredProjectsList: MapDataProject[] = [];\n  @State() loading = true;\n  @State() updateView = true;\n  searchToolbar: any;\n\n  componentWillLoad() {\n    ProjectsService.projectsList$.subscribe(async (list: MapDataProject[]) => {\n      //replace name of customers\n      const customersList = [];\n      list.map((item) => {\n        const newItem = cloneDeep(item);\n        const customer = CustomersService.getCustomersDetails(item.customerId);\n        if (customer) {\n          newItem.customerId = customer.fullName;\n          customersList.push(newItem);\n        }\n      });\n      this.updateList(customersList);\n      this.loading = false;\n    });\n  }\n\n  componentDidLoad() {\n    this.searchToolbar = this.el.querySelector(\n      \"#searchToolbar\"\n    ) as HTMLAppSearchToolbarElement;\n    this.updateList(this.projectsList);\n  }\n\n  updateList(list) {\n    this.projectsList = list;\n    this.searchToolbar\n      ? this.searchToolbar.forceFilter(this.projectsList)\n      : undefined;\n    this.updateView = !this.updateView;\n  }\n\n  addProject() {\n    ProjectsService.presentProjectUpdate();\n  }\n\n  getOptions() {\n    if (TrasteelService.isRefraDBAdmin()) {\n      return [\n        {\n          tag: \"delete\",\n          text: \"Delete\",\n          icon: \"trash\",\n          color: \"danger\",\n          func: (returnField) =>\n            ProjectsService.deleteProject(returnField, false),\n        },\n        {\n          tag: \"duplicate\",\n          text: \"Duplicate\",\n          icon: \"duplicate\",\n          color: \"secondary\",\n          func: (returnField) => ProjectsService.duplicateProject(returnField),\n        },\n        {\n          tag: \"edit\",\n          text: \"Edit\",\n          icon: \"create\",\n          color: \"primary\",\n          func: (returnField) =>\n            ProjectsService.presentProjectUpdate(returnField),\n        },\n      ];\n    } else return null;\n  }\n\n  render() {\n    return [\n      <ion-header>\n        <app-navbar\n          tag=\"projects\"\n          text=\"Projects\"\n          color=\"trasteel\"\n        ></app-navbar>\n        <app-search-toolbar\n          id=\"searchToolbar\"\n          searchTitle=\"projects\"\n          list={this.projectsList}\n          orderFields={[\"customerId\", \"projectLocalId\"]}\n          color=\"trasteel\"\n          placeholder=\"Search by customer or project\"\n          filterBy={[\"customerId\", \"projectLocalId\", \"projectDescription\"]}\n          onFilteredList={(ev) => (this.filteredProjectsList = ev.detail)}\n        ></app-search-toolbar>\n      </ion-header>,\n      <ion-content>\n        {TrasteelService.isRefraDBAdmin() ? (\n          <ion-fab vertical=\"top\" horizontal=\"end\" slot=\"fixed\" edge>\n            <ion-fab-button\n              size=\"small\"\n              onClick={() => this.addProject()}\n              color=\"trasteel\"\n            >\n              <ion-icon name=\"add\"></ion-icon>\n            </ion-fab-button>\n          </ion-fab>\n        ) : undefined}\n        <app-infinite-scroll\n          list={this.filteredProjectsList}\n          loading={this.loading}\n          showFields={[\"projectLocalId\"]}\n          showNotes={[\"projectDescription\"]}\n          groupBy={[\"customerId\"]}\n          options={this.getOptions()}\n          returnField=\"id\"\n          icon={TrasteelFilterService.getMapDocs(PROJECTSCOLLECTION).icon.name}\n          onItemClicked={(ev) =>\n            ProjectsService.presentProjectDetails(ev.detail)\n          }\n        ></app-infinite-scroll>\n      </ion-content>,\n    ];\n  }\n}\n"],"mappings":"uYAAA,MAAMA,EAAkB,kBACxB,MAAAC,EAAeD,E,MCeFE,EAAY,M,yBAEvBC,KAAAC,aAAiC,G,0BACiB,G,aAC/B,K,gBACG,I,CAGtB,iBAAAC,GACEC,EAAgBC,cAAcC,WAAUC,MAAOC,IAE7C,MAAMC,EAAgB,GACtBD,EAAKE,KAAKC,IACR,MAAMC,EAAUC,oBAAUF,GAC1B,MAAMG,EAAWC,EAAiBC,oBAAoBL,EAAKM,YAC3D,GAAIH,EAAU,CACZF,EAAQK,WAAaH,EAASI,SAC9BT,EAAcU,KAAKP,E,KAGvBX,KAAKmB,WAAWX,GAChBR,KAAKoB,QAAU,KAAK,G,CAIxB,gBAAAC,GACErB,KAAKsB,cAAgBtB,KAAKuB,GAAGC,cAC3B,kBAEFxB,KAAKmB,WAAWnB,KAAKC,a,CAGvB,UAAAkB,CAAWZ,GACTP,KAAKC,aAAeM,EACpBP,KAAKsB,cACDtB,KAAKsB,cAAcG,YAAYzB,KAAKC,cACpCyB,UACJ1B,KAAK2B,YAAc3B,KAAK2B,U,CAG1B,UAAAC,GACEzB,EAAgB0B,sB,CAGlB,UAAAC,GACE,GAAIC,EAAgBC,iBAAkB,CACpC,MAAO,CACL,CACEC,IAAK,SACLC,KAAM,SACNC,KAAM,QACNC,MAAO,SACPC,KAAOC,GACLnC,EAAgBoC,cAAcD,EAAa,QAE/C,CACEL,IAAK,YACLC,KAAM,YACNC,KAAM,YACNC,MAAO,YACPC,KAAOC,GAAgBnC,EAAgBqC,iBAAiBF,IAE1D,CACEL,IAAK,OACLC,KAAM,OACNC,KAAM,SACNC,MAAO,UACPC,KAAOC,GACLnC,EAAgB0B,qBAAqBS,I,MAGtC,OAAO,I,CAGhB,MAAAG,GACE,MAAO,CACLC,EAAA,cAAAC,IAAA,4CACED,EAAA,cAAAC,IAAA,2CACEV,IAAI,WACJC,KAAK,WACLE,MAAM,aAERM,EAAA,sBAAAC,IAAA,2CACEC,GAAG,gBACHC,YAAY,WACZtC,KAAMP,KAAKC,aACX6C,YAAa,CAAC,aAAc,kBAC5BV,MAAM,WACNW,YAAY,gCACZC,SAAU,CAAC,aAAc,iBAAkB,sBAC3CC,eAAiBC,GAAQlD,KAAKmD,qBAAuBD,EAAGE,UAG5DV,EAAA,eAAAC,IAAA,4CACGZ,EAAgBC,iBACfU,EAAA,WAASW,SAAS,MAAMC,WAAW,MAAMC,KAAK,QAAQC,KAAI,MACxDd,EAAA,kBACEe,KAAK,QACLC,QAAS,IAAM1D,KAAK4B,aACpBQ,MAAM,YAENM,EAAA,YAAUiB,KAAK,UAGjBjC,UACJgB,EAAA,uBAAAC,IAAA,2CACEpC,KAAMP,KAAKmD,qBACX/B,QAASpB,KAAKoB,QACdwC,WAAY,CAAC,kBACbC,UAAW,CAAC,sBACZC,QAAS,CAAC,cACVC,QAAS/D,KAAK8B,aACdQ,YAAY,KACZH,KAAM6B,EAAsBC,WAAWC,GAAoB/B,KAAKwB,KAChEQ,cAAgBjB,GACd/C,EAAgBiE,sBAAsBlB,EAAGE,W","ignoreList":[]}