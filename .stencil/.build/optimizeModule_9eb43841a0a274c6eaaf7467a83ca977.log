import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import{U as s,n as d,q as c,z as n,a9 as o,a3 as b,T as r,R as f,B as l}from"./p-30358c9d.js";import"./p-c7ee7cfe.js";import{b as p,o as h}from"./p-5d4a8e1f.js";import{l as m}from"./p-1af05547.js";import{S as y}from"./p-a75993af.js";import{M as u}from"./p-2578d979.js";import{E as k}from"./p-a9f4af61.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";import"./p-694b8ade.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-dive-site-update ion-list{width:100%}";const v=g;const w=class{constructor(t){e(this,t);this.stdConfigurations=[];this.diveSiteId=undefined;this.diveSite=undefined;this.segment="map";this.updateView=true;this.validSite=false;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"dive-profiles",text:"Dive Profiles"},{tag:"team"}];this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new c(e);this.stdConfigurations=m.exports.cloneDeep(this.userSettings.userConfigurations)}));await this.loadDiveSite()}async loadDiveSite(){if(this.diveSiteId){this.diveSite=await n.getDiveSite(this.diveSiteId);this.draggableMarkerPosition={lat:this.diveSite.position.geopoint.latitude,lon:this.diveSite.position.geopoint.longitude}}else{this.diveSite=new o;this.diveSite.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}async componentDidLoad(){this.slider=new y(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+b(this.diveSite,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateSite()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#dive-type-select");const t={header:r.getTransl("site-type","Site Type")};e.interfaceOptions=t;e.placeholder=r.getTransl("select","Select");m.exports.each(n.getSiteTypes(),(t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=t.name;e.appendChild(a)}));const a=this.el.querySelector("#entry-type-select");const i={header:r.getTransl("entry-type","Entry Type")};a.interfaceOptions=i;a.placeholder=r.getTransl("select","Select");m.exports.each(n.getEntryTypes(),(e=>{const t=document.createElement("ion-select-option");t.value=e.type;t.textContent=e.name;a.appendChild(t)}));const s=this.el.querySelector("#seabed-comp-select");const d={header:r.getTransl("seabed-comp","Seabed Composition")};s.interfaceOptions=d;s.placeholder=r.getTransl("select","Select");m.exports.each(n.getSeabedCompositions(),(e=>{const t=document.createElement("ion-select-option");t.value=e.type;t.textContent=e.name;s.appendChild(t)}));const c=this.el.querySelector("#seabed-cover-select");const o={header:r.getTransl("seabed-cover","Seabed Cover")};c.interfaceOptions=o;c.placeholder=r.getTransl("select","Select");m.exports.each(n.getSeabedCovers(),(e=>{const t=document.createElement("ion-select-option");t.value=e.type;t.textContent=e.name;c.appendChild(t)}))}updateLocation(e){this.draggableMarkerPosition={lat:m.exports.toNumber(e.detail.lat),lon:m.exports.toNumber(e.detail.lon)};this.diveSite.position=u.getPosition(e.detail.lat,e.detail.lon);this.validateSite()}updateAddress(e){this.diveSite.setAddress(e.detail)}handleChange(e){this.diveSite[e.detail.name]=e.detail.value;this.validateSite()}handleInformationChange(e){switch(e.detail.name){case"minDepth":this.diveSite.information.minDepth=m.exports.toNumber(e.detail.value);break;case"maxDepth":this.diveSite.information.maxDepth=m.exports.toNumber(e.detail.value);break;case"waterTemp.spring":this.diveSite.information.waterTemp.spring=e.detail.value;break;case"waterTemp.summer":this.diveSite.information.waterTemp.summer=e.detail.value;break;case"waterTemp.autumn":this.diveSite.information.waterTemp.autumn=e.detail.value;break;case"waterTemp.winter":this.diveSite.information.waterTemp.winter=e.detail.value;break;default:this.diveSite.information[e.detail.name]=e.detail.value}this.validateSite()}updateParam(e,t){let a=t.detail.value;switch(e){case"type":this.diveSite.type=a;break;case"entryType":this.diveSite.information.entryType=a;break;case"seabedComposition":this.diveSite.information.seabedComposition=a;break;case"seabedCover":this.diveSite.information.seabedCover=a;break}this.validateSite()}async addDivePlan(){let e=[];m.exports.forEach(this.stdConfigurations,((t,a)=>{e.push({type:"radio",label:t.stdName,value:a,checked:a==0?true:false})}));const t=await p.create({header:r.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:r.getTransl("ok","OK"),handler:e=>{this.addDivePlanWithConf(this.stdConfigurations[e])}},{text:r.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});t.present()}async addDivePlanWithConf(e){const t=await f.openModal("modal-dive-template",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,dive:0,user:this.userProfile});t.onDidDismiss().then((e=>{const t=e.data;if(t){t.dives[0].diveSiteId=this.diveSiteId;this.diveSite.divePlans.push(t);this.updateView=!this.updateView}}))}async viewDivePlan(e,t){this.diveSite.divePlans[t]=e.detail;this.updateView=!this.updateView}async removeDivePlan(e){this.diveSite.divePlans.splice(e,1);this.updateView=!this.updateView}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.diveSite.photoURL=a}else{this.diveSite.coverURL=a}}validateSite(){this.validSite=m.exports.isNumber(this.diveSite.position.geopoint.latitude)&&m.exports.isNumber(this.diveSite.position.geopoint.longitude)&&m.exports.isString(this.diveSite.type)&&m.exports.isString(this.diveSite.information.entryType)&&m.exports.isString(this.diveSite.description)&&this.diveSite.information.minDepth>0&&this.diveSite.information.maxDepth>0}async save(){await n.updateDiveSite(this.diveSiteId,this.diveSite,this.userProfile.uid);return h.dismiss()}async cancel(){return h.dismiss()}render(){return t(a,{key:"77d0f459d6fea9da5cd34476ab77487196846c96"},t("ion-header",{key:"d32f4700c0093fbcdd9e514677e77f13fa24e8cd"},t("app-upload-cover",{key:"4e37fba160f20ce61b91b6ab4e2a5ddcf40895ca",item:{collection:l,id:this.diveSiteId,photoURL:this.diveSite.photoURL,coverURL:this.diveSite.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("app-header-segment-toolbar",{key:"41a8823f91bf7ce3f3ebeb3391dcd7646357e1f3",color:k.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"733ba2b5293c20ebe0b9df5fbbbcaaa6b4f45928",class:"slides"},t("swiper-container",{key:"98ff238340dda45370bfa7878a3f90c7abf3f8ba",class:"slider-dive-site swiper"},t("swiper-wrapper",{key:"56b9879f1241a946137a932380d29fc16e784e6c",class:"swiper-wrapper"},t("swiper-slide",{key:"c261e0fb866e3f188b6153489b13a112e05ef91c",class:"swiper-slide"},t("div",{key:"5817f5b0d3753bce2841ee130081eee7c5904d11",id:"map-container"},t("app-map",{key:"dd6cfe5efb28171d9c4a63b2c89b189b8340b7f3",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),t("swiper-slide",{key:"c6d3ff4a6ea726a638358382137c2bdf2afde743",class:"swiper-slide"},t("app-coordinates",{key:"da7c6ff8adb67369f1c0e0fc0fc1ec16536cf43f",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),t("swiper-slide",{key:"b78f8b6df456c539830b9bd73a6ac2393326e043",class:"swiper-slide"},t("ion-list",{key:"9a0e00d93f366b24af5107200ece2c5933ee1273",class:"ion-no-padding"},t("ion-list-header",{key:"f388562c17fd5e5c1b45ebb07f3ef06157a3559d"},t("my-transl",{key:"c5350476089bba72128313fc1de42e7f313252e4",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"4d552c63c20ebf968daed609aed0e0523a0e32d7"},t("ion-label",{key:"a31eb506183d1a3abb8bbcb590e2d112261f5e2f"},t("my-transl",{key:"166cb2739c67a4a2d65dae831680ecb65a374692",tag:"site-type",text:"Site Type"})),t("ion-select",{key:"2a4ed2936c8b2254b01d820bca4346bd848c8e8c",id:"dive-type-select",onIonChange:e=>this.updateParam("type",e),value:this.diveSite.type})),t("ion-item",{key:"29a52b431faf3fb7586dc774b7e7ee6aabb4c229"},t("ion-label",{key:"dca0ca68be2a92dc8d28c884e3672756fc830aba"},t("my-transl",{key:"2acdd71f99873b8a0927e085f7e95508af099dde",tag:"entry-type",text:"Entry Type"})),t("ion-select",{key:"c9bdc1321adfa3024d5c52fa4f591aa1e1eab58b",id:"entry-type-select",onIonChange:e=>this.updateParam("entryType",e),value:this.diveSite.information.entryType})),t("app-form-item",{key:"4c3aeb320ab2638972176b011ef5416db3bdcbe3","label-tag":"name","label-text":"Name",value:this.diveSite.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"0d7cacfa5e2a76e49d1d4f39b70d268f6429a85d","label-tag":"description","label-text":"Description",value:this.diveSite.description,name:"description",textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-list-header",{key:"c06d24ff975058520e608a5a8e8d02d6f0541eca"},t("ion-label",{key:"c56b2f2a1d2b037001a3855b6bc69d6ff79fc971"},t("my-transl",{key:"f26de35b8669dca6a86d05b435a698a056fb4011",tag:"site-details",text:"Site Details"}))),t("ion-grid",{key:"857f01e350b0becf066cec6496afa237f3c42775",class:"ion-no-padding"},t("ion-row",{key:"6106c95feb12369654c9b070d54fe0f229b2fb44"},t("ion-col",{key:"a80341b1965db490b450a0bdceabdb89cee7321c"},t("app-form-item",{key:"7ccbcd222ee7f10d5507b2f85c72463dda674b9c","label-tag":"min-depth","label-text":"Min. Depth","append-text":" (m)",value:m.exports.toString(this.diveSite.information.minDepth),name:"minDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})),t("ion-col",{key:"8b707e41837db4d12451e3e687238df86aafd7f1"},t("app-form-item",{key:"8e8f3dd36707f035b0160c71ceefeeac27216acb","label-tag":"max-depth","label-text":"Max. Depth","append-text":" (m)",value:m.exports.toString(this.diveSite.information.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})))),t("app-form-item",{key:"f407f20b7e246f95788d625f63d1a4a4377513a3","label-tag":"avg-vis","label-text":"Average Visibility","append-text":" (m)",value:m.exports.toString(this.diveSite.information.avgViz),name:"avgViz","input-type":"text",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}),t("ion-list-header",{key:"f90be585ec9364cd8df19307b4cb4519f34afc8d"},t("my-transl",{key:"bd84aecacf5e5198a6f0dde30d073ed0632028da",tag:"water-temp",text:"Water Temperature","append-text":" (°C)",isLabel:true})),t("ion-grid",{key:"ec7540571527cf78a10ad5eb796af9d0c0eebc5f",class:"ion-no-padding"},t("ion-row",{key:"ad3b38dc7bfdb77b0df4ccaf57602f3ec73d50d9"},t("ion-col",{key:"550082b16fc1d05927bb3099e46824d3b736498d"},t("app-form-item",{key:"61cf7206a78f4b625ef5823cfced5d62515616ad","label-tag":"spring","label-text":"Spring",value:m.exports.toString(this.diveSite.information.waterTemp.spring),name:"waterTemp.spring","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),t("ion-col",{key:"f4b04a74f58782ee43113c5fdae684491820dee1"},t("app-form-item",{key:"7fc325575c8e9c1c35c6d53e4ed028faf6060715","label-tag":"summer","label-text":"Summer",value:m.exports.toString(this.diveSite.information.waterTemp.summer),name:"waterTemp.summer","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}))),t("ion-row",{key:"a876009d917591bb8e5661f204147e79becc7bae"},t("ion-col",{key:"3329fb9ed97693aece8ccc9229bf94d310961e89"},t("app-form-item",{key:"f21dee4a5390023a8ad468a45e6a9319ef923cdc","label-tag":"autumn","label-text":"Autumn",value:m.exports.toString(this.diveSite.information.waterTemp.autumn),name:"waterTemp.autumn","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),t("ion-col",{key:"8461f4bd4cc1a10bee03a63dce44646115041e5a"},t("app-form-item",{key:"422007112c2187d6203f4f9b3a175e8b18c9e5aa","label-tag":"winter","label-text":"Winter",value:m.exports.toString(this.diveSite.information.waterTemp.winter),name:"waterTemp.winter","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})))),t("ion-item",{key:"f9d2e8e336cffaf4577d34e348ffceda0e2b8f63"},t("ion-label",{key:"e60b9c0bd9f3285db49fe7791abd49682fc12b6a"},t("my-transl",{key:"91ed41e448bd62ebb082af90d313e69f44bac6a6",tag:"seabed-comp",text:"Seabed Composition"})),t("ion-select",{key:"a5dba2c194b83979560b04ed78031a940aa724a2",id:"seabed-comp-select",multiple:true,onIonChange:e=>this.updateParam("seabedComposition",e),value:this.diveSite.information.seabedComposition})),t("ion-item",{key:"dd7199f70ed46bca7438689dd86ddaf44dc9b071"},t("ion-label",{key:"b13b1527b94c31b35cc26bbd824d3bc86655960d"},t("my-transl",{key:"f55f6d0cef27fe047517cb7fa8d0811db0cf6eb8",tag:"seabed-cover",text:"Seabed Cover"})),t("ion-select",{key:"4145f09f9d3fa47c0cbdd5b6ae2a184836e4bd23",id:"seabed-cover-select",multiple:true,onIonChange:e=>this.updateParam("seabedCover",e),value:this.diveSite.information.seabedCover})))),t("swiper-slide",{key:"beaadd568200667a146614321c405b9030821156",class:"swiper-slide"},t("ion-grid",{key:"b8b82bcf50d668978c765e2407cd78fc0849c99a"},t("ion-row",{key:"bb086ff3399e8905fcd37053a3ec0338dcc03947",class:"ion-text-start"},this.diveSite.divePlans.map(((e,a)=>t("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},t("app-dive-plan-card",{divePlan:e,edit:true,onViewEmit:e=>this.viewDivePlan(e,a),onRemoveEmit:()=>this.removeDivePlan(a)})))),t("ion-col",{key:"d3e4c33c7e1b890662626b65d1652141e3b61b13","size-sm":"12","size-md":"6","size-lg":"4"},t("ion-card",{key:"88258806fa30afe6699532336fe8bdfcacfefaef",onClick:()=>this.addDivePlan()},t("ion-card-content",{key:"f8209160ddc55fbcd27227a9dbf0e158801c4642",class:"ion-text-center"},t("ion-icon",{key:"fde3d70512193042c19996ee308634d146126f12",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),t("swiper-slide",{key:"28b60c7308bf7a22ce8a7b48270d83ce4259975e",class:"swiper-slide"},t("app-users-list",{key:"74f80920c217f0fc7b35b91bc820616cbc8626b9",item:this.diveSite,editable:true,show:["owner","editor"]}))))),t("app-modal-footer",{key:"4e90ec39d9e7835399404301b0302f439c9a26a7",disableSave:!this.validSite,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};w.style=v;export{w as modal_dive_site_update};