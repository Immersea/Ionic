import{r as i,h as s,H as t}from"./p-cbe60c68.js";import{aa as e,e as n,c as o,U as h,a,d as l,D as r,b as p,x as d,T as c,w as f}from"./p-f3984daf.js";import{l as u}from"./p-1af05547.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const m="app-admin-dive-trips{}";const k=m;const b=class{constructor(s){i(this,s);this.userPublicProfilesList=[];this.divingCentersList=[];this.diveCommunitiesList=[];this.divingSchoolsList=[];this.filterByOrganisierId=undefined;this.filterByTrips=undefined;this.adminDiveTripsArray=[];this.updateView=false;this.creatingNewDiveTrip=false;this.loadingDiveTrips=true;this.editingDiveTrip=""}async componentWillLoad(){this.loadingDiveTrips$=e.creatingNewDiveTrip$.subscribe((i=>{this.creatingNewDiveTrip=i}));this.editingDiveTrip$=e.editingDiveTripId$.subscribe((i=>{this.editingDiveTrip=i}));if(this.filterByOrganisierId){if(this.filterByOrganisierId===n.selectedDivingSchoolId){this.userDiveTrips$=n.selectedDivingSchoolTrips$.subscribe((i=>this.loadDiveTrips(i)))}else if(this.filterByOrganisierId===o.selectedDivingCenterId){this.userDiveTrips$=o.selectedDivingCenterTrips$.subscribe((i=>this.loadDiveTrips(i)))}}else{this.userDiveTrips$=h.userDiveTrips$.subscribe((i=>this.loadDiveTrips(i)))}this.userPublicProfilesList$=h.userPublicProfilesList$.subscribe((i=>{this.userPublicProfilesList=i;this.filter()}));this.divingCentersList$=o.divingCentersList$.subscribe((i=>{this.divingCentersList=i;this.filter()}));this.diveCommunitiesList$=a.diveCommunitiesList$.subscribe((i=>{this.diveCommunitiesList=i;this.filter()}));this.divingSchoolsList$=n.divingSchoolsList$.subscribe((i=>{this.divingSchoolsList=i;this.filter()}));this.userRoles$=h.userRoles$.subscribe((i=>{this.userRoles=i;this.filter()}))}disconnectedCallback(){this.userRoles$.unsubscribe();this.userDiveTrips$.unsubscribe();this.userPublicProfilesList$.unsubscribe();this.divingCentersList$.unsubscribe();this.diveCommunitiesList$.unsubscribe();this.divingSchoolsList$.unsubscribe();this.editingDiveTrip$.unsubscribe();this.loadingDiveTrips$.unsubscribe()}loadDiveTrips(i){e.resetSkeletons();this.loadingDiveTrips=false;if(i){let s=[];Object.keys(i).forEach((t=>{let e=i[t];e.id=t;if(this.filterByOrganisierId&&e.organiser.id==this.filterByOrganisierId){s.push(e)}else if(!this.filterByOrganisierId){s.push(e)}}));s=u.exports.orderBy(s,"date","desc");this.adminDiveTripsArray=s;this.filter()}}filter(){if(this.adminDiveTripsArray.length>0){this.adminDiveTripsArray.map((i=>{const s=i.organiser;switch(s.collectionId){case d:s.item=this.userPublicProfilesList.find((i=>i.uid===s.id));break;case p:s.item=this.divingCentersList.find((i=>i.id===s.id));break;case r:s.item=this.diveCommunitiesList.find((i=>i.id===s.id));break;case l:s.item=this.divingSchoolsList.find((i=>i.id===s.id));break}if(this.userRoles){const s=this.userRoles.editorOf[i.id];i.editor=s&&s.roles&&s.roles.length>0;i.owner=s&&s.roles&&s.roles.includes("owner")}}));if(this.filterByTrips){const i=Object.keys(this.filterByTrips);this.adminDiveTripsArray=this.adminDiveTripsArray.filter((s=>i.includes(s.id)))}this.updateView=!this.updateView}}update(i,s){i.stopPropagation();e.presentDiveTripUpdate(null,null,s)}delete(i,s){i.stopPropagation();e.deleteDiveTrip(s)}render(){return s(t,{key:"2299fd731b41d739476c939b71f59670e09dc502"},this.loadingDiveTrips?[s("app-skeletons",{skeleton:"diveTrip"}),s("app-skeletons",{skeleton:"diveTrip"}),s("app-skeletons",{skeleton:"diveTrip"}),s("app-skeletons",{skeleton:"diveTrip"}),s("app-skeletons",{skeleton:"diveTrip"})]:undefined,this.creatingNewDiveTrip?s("app-skeletons",{skeleton:"diveTrip"}):undefined,this.adminDiveTripsArray.map((i=>this.editingDiveTrip==i.id?s("app-skeletons",{skeleton:"diveTrip"}):s("ion-item",{button:true,onClick:()=>e.pushDiveTrip(i.id),detail:true},i.organiser&&i.organiser.item&&i.organiser.item.photoURL?s("ion-avatar",{slot:"start"},s("ion-img",{src:i.organiser.item.photoURL})):undefined,s("ion-label",null,s("h2",null,i.displayName),s("h4",null,f.format(i.date,"PP")),i.organiser&&i.organiser.item&&i.organiser.item.displayName?s("p",null,s("my-transl",{tag:"organiser",text:"Organiser"}),": "+i.organiser.item.displayName):undefined),i.owner?s("ion-button",{fill:"clear",color:"danger","icon-only":true,slot:"end",onClick:s=>this.delete(s,i.id)},s("ion-icon",{name:"trash",slot:"end"})):undefined,i.editor?s("ion-button",{fill:"clear",color:"divetrip","icon-only":true,slot:"end",onClick:s=>this.update(s,i.id)},s("ion-icon",{name:"create",slot:"end"})):undefined))),this.adminDiveTripsArray.length==0?s("ion-item",null,s("ion-label",null,s("h2",null,c.getTransl("no-dive-trips","No dive trips yet. Click on the '+' button to create your first one.")))):undefined)}};b.style=k;export{b as app_admin_dive_trips};