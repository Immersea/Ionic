import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as n}from"./p-5d4a8e1f.js";import{l as s}from"./p-1af05547.js";import{S as o}from"./p-a75993af.js";import{U as m,n as l,am as d,ap as p,aw as r,R as h,k as b,S as f,T as c}from"./p-f3984daf.js";import{E as u}from"./p-a9f4af61.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-2578d979.js";import"./p-7ee16e8d.js";const v="modal-shape-update ion-list{width:100%}";const x=v;const y=class{constructor(a){e(this,a);this.validShape=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"drawing",text:"Drawing",disabled:false}];this.shapeId=undefined;this.duplicateShape=undefined;this.shape=undefined;this.updateView=true;this.scrollTop=0;this.shapeTypes=undefined;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=m.userProfile$.subscribe((e=>{this.userProfile=new l(e)}));await this.loadShape()}async loadShape(){this.shapeTypes=await d.getShapeTypes();if(this.shapeId){const e=await d.getShape(this.shapeId);this.shape=e}else{this.shape=new p(this.duplicateShape?this.duplicateShape.shape:null);if(this.duplicateShape){this.shape.shapeName="NEW - "+this.duplicateShape.shape.shapeName}this.shape.users={[m.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new o(".slider-edit-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,breakpoints:{768:{slidesPerView:1},992:{slidesPerView:2}}});if(this.shape.shapeName)this.validateShape();this.updateSlider()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){const a=e.detail.name;const t=e.detail.value;this.shape[a]=t;if((a=="A"||a=="B"||a=="H"||a=="L")&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0){this.shape.volume=this.shape.getVolume();this.shape.radius=this.shape.getInternalRadius()}this.validateShape()}validateShape(){this.validShape=s.exports.isString(this.shape.shapeTypeId)&&s.exports.isString(this.shape.shapeName)&&s.exports.isNumber(this.shape.A)&&s.exports.isNumber(this.shape.B)&&s.exports.isNumber(this.shape.H)&&s.exports.isNumber(this.shape.L)&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0;this.updateSlider()}async selectType(e){this.shape.shapeTypeId=e.detail.value;await d.setDwgForShape(this.shape);this.validateShape()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editDrawing(){if(!this.shape.dwg){this.shape.dwg=new r}this.shape.dwg.id=this.shapeId;this.shape.dwg.name=this.shape.shapeName;const e=await h.openPopover("popover-media-loading",{media:this.shape.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const a={[e.data.media.id]:e.data};const t=e.data.media;const i=await h.openPopover("popover-media-uploader",{files:a,itemId:this.shapeId,collectionId:b});i.onDidDismiss().then((e=>{if(e&&e.data){const a=e.data;this.shape.dwg=t;Object.keys(a).forEach((e=>{this.shape.dwg.url=a[e]}));this.save(false);this.updateSlider()}}))}}))}async deleteShape(){try{await d.deleteShape(this.shapeId);n.dismiss()}catch(e){if(e)f.presentAlertError(e)}}async save(e=true){const a=await d.updateShape(this.shapeId,this.shape,this.userProfile.uid);if(!this.shapeId){this.shapeId=a.id}e?n.dismiss():undefined}async cancel(){return n.dismiss()}render(){return a(t,{key:"84555c1c1e840432dc77cadccad6fc060dad9039"},a("app-header-segment-toolbar",{key:"b9c64c79218bfeb60f822bf0b394faab3ce4d5f4",color:u.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"f76e93bcdbac5bf28cf71f7c406c0b78975d6ee7",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},a("swiper-container",{key:"1902a3f64372631093703cf236fff97c4376b98f",class:"slider-edit-shape swiper"},a("swiper-wrapper",{key:"d8580c0c0ed36f8120b424030cd8316b42ca3509",class:"swiper-wrapper"},a("swiper-slide",{key:"33aa70d4c575ae7140ac74749b7a30ad0c025ebf",class:"swiper-slide"},a("ion-list",{key:"8ec033849c44d68a102302e756a9906618d387f7",class:"ion-no-padding"},this.shapeTypes?a("app-select-search",{color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.shape&&this.shape.shapeTypeId?this.shape.shapeTypeId:null,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"]}):undefined,a("app-form-item",{key:"5211ed1b01d44a733e9b3e5e41c201d7c9822984",lines:"inset","label-tag":"name","label-text":"Name",value:this.shape.shapeName,name:"shapeName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"19596e12058085f13d1907683b33257417d7bd79",lines:"inset","label-tag":"shortName","label-text":"Short Name",value:this.shape.shapeShortName,name:"shapeShortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e)}),a("app-form-item",{key:"31cfdd4f4391dece17be857ba1368216605af6aa","label-text":"H",value:this.shape.H,appendText:" (mm)",name:"H","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"785b0d995c8d4e062776493af1599e6205db8364","label-text":"H1",value:this.shape.H1,appendText:" (mm)",name:"H1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"ed3f58c73a0d63aa3c45c3db9796a58d22f76431","label-text":"H2",value:this.shape.H2,appendText:" (mm)",name:"H2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"731c2f08d78b193fae796603b25c356ae21213bb","label-text":"L",value:this.shape.L,appendText:" (mm)",name:"L","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"fe6ff5169fa65148b4a6308b736c7b5c0fdd1a8c","label-text":"L1",appendText:" (mm)",value:this.shape.L1,name:"L1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"0d6a4b887399ea3f69d311d559fc676c51b6cdb7","label-text":"La",appendText:" (mm)",value:this.shape.La,name:"La","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"1ed8f39a26e0a2ec3c68617923aadfbae94cd4fa","label-text":"Lb",appendText:" (mm)",value:this.shape.Lb,name:"Lb","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"8306a7afb75186183880be6a3a7e60990cacfc7e","label-text":"A",appendText:" (mm)",value:this.shape.A,name:"A","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"c5503577112dbd711aa3f59092cee26edd17cc59","label-text":"A1",appendText:" (mm)",value:this.shape.A1,name:"A1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"39962ba81fe712247dae53b482b6fe33f6855dab","label-text":"B",appendText:" (mm)",value:this.shape.B,name:"B","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"702c644133889c018fbcb545ed90e095ea7b1528","label-text":"B1",appendText:" (mm)",value:this.shape.B1,name:"B1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"76a05d85fe9d66379d36b9ecea51ebfabf02022d","label-text":"ANG",appendText:" (°)",value:this.shape.ANG,name:"ANG","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"3ceef1d2ee9888f10b36a7720859cf8451e838ee","label-text":"ANG1",appendText:" (°)",value:this.shape.ANG1,name:"ANG1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"4c2941803c91919b606253ea3236f50715de3e2f","label-text":"D",appendText:" (mm)",value:this.shape.D,name:"D","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"48999ec2ac54b9fe54cfe67c8938e4214c69df9d","label-text":"D1",appendText:" (mm)",value:this.shape.D1,name:"D1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"b47a7efe6211c1973fecf6cba117117fc84de5cf","label-text":"D2",appendText:" (mm)",value:this.shape.D2,name:"D2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"a2de1b9cd2ccd4dd2c92d5783fd303a076681d31","label-text":"D3",appendText:" (mm)",value:this.shape.D3,name:"D3","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"5668693498726bf1b0fe002ab7da84adc6283e4d","label-text":"D4",appendText:" (mm)",value:this.shape.D4,name:"D4","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"7fbc12dbc470654faeb0cc9ab49cd6f9fbd1a835","label-text":"De",appendText:" (mm)",value:this.shape.De,name:"De","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"7acc47da59caac3b4c0731b8d271219bf553baec","label-text":"Di",appendText:" (mm)",value:this.shape.Di,name:"Di","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"29abce96cf9773af731f3425da497ac9fe03f0d9","label-text":"N",appendText:" (mm)",value:this.shape.N,name:"N","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"312da4c0ed3ae4fb0a540b14c9e36ad04062a91b","label-text":"Decimals",value:this.shape.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:0}}]}),a("app-form-item",{key:"12e22cd79e72e424fe10d60b8fc06729b5ef4194","label-text":"Radius",appendText:(this.shape.shapeTypeId=="su-brick"?" MIN":"")+" (mm)",value:this.shape.radius,name:"radius","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),this.shape.shapeTypeId=="su-brick"?a("app-form-item",{"label-text":"Radius",appendText:" MAX (mm)",value:this.shape.radius_max,name:"radius_max","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:this.shape.radius}}]}):undefined,a("app-form-item",{key:"59a69d143287bc021c559c9217756ea5229b726e","label-text":"Volume",appendText:" (dm3)",value:this.shape.volume,name:"volume","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]})),this.shapeId?a("ion-footer",{class:"ion-no-border"},a("ion-toolbar",null,a("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteShape()},a("ion-icon",{slot:"start",name:"trash"}),a("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),a("swiper-slide",{key:"36b34ebb036967dae0ae22e1f4475f2024905dce",class:"swiper-slide"},a("app-banner",{key:"031c2e8ecab124192e30c3af5e608264c295bcfe",scrollTopValue:this.scrollTop,backgroundCoverFill:false,heightPx:500,link:this.shape.dwg?this.shape.dwg.url:null}),a("ion-footer",{key:"142e2767dd5bf19f26e876d8a19eeaab3c9c2c98",class:"ion-no-border"},a("ion-toolbar",{key:"92fbe2477f95f1ec755afdecaaff85d476e54bf1"},a("ion-button",{key:"c77bd4c2886e16a6ae467be27e0390f0d154dfa4",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeId,onClick:()=>this.editDrawing()},a("ion-icon",{key:"2b2dd7659ad04956fd758b58e1f188e4d866d0a5",slot:"start",name:"create"}),a("ion-label",{key:"9b7a62fe5b9ddaed10ca9bd67167412e562170ad"},!this.shapeId?c.getTransl("media-loader-error","Please save the item to upload new media."):c.getTransl("edit_dwg","Edit Drawing"))))))))),a("app-modal-footer",{key:"93b64c962d43709aa148298135a07cb63724bbf3",color:u.getAppColor(),disableSave:!this.validShape,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=x;export{y as modal_shape_update};