import{r as e,h as i,f as t}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{i as a}from"./p-694b8ade.js";import{m as o}from"./p-c2915cc5.js";import{l as n}from"./p-1af05547.js";import{aj as s,U as l,E as c,ak as d}from"./p-f42b650b.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const r="modal-dive-configuration .scrollx{display:flex;flex-wrap:nowrap;overflow-x:auto}modal-dive-configuration .scrollx .item{flex:0 0 0 0}modal-dive-configuration .scrollx ::-webkit-scrollbar{display:none}modal-dive-configuration input{text-align:right}modal-dive-configuration .fixedLabel{min-width:80% !important;max-width:80% !important}modal-dive-configuration ion-item .item-inner{box-shadow:none !important;border-bottom:1px solid #dedede !important}modal-dive-configuration .item-input .label-md,modal-dive-configuration .item-select .label-md,modal-dive-configuration .item-datetime .label-md{color:rgb(0, 0, 0)}";const f=r;const m=class{constructor(i){e(this,i);this.validForm={name:false,depth:false,time:false,bottom:false};this.diveDataToShare=undefined;this.updateView=true;this.showSave=false}componentWillLoad(){this.screenWidth=window.screen.width;this.divePlan=this.diveDataToShare.divePlan;this.diveConfig=this.divePlan.configuration;this.orderTanks();this.ranges=this.divePlan.getParamRanges(this.diveConfig.parameters.units);let e=s.getStdGases();e=n.exports.orderBy(e,"fromDepth","asc");this.bottomGases=n.exports.filter(e,{deco:false});this.decoGases=n.exports.filter(e,{deco:true});let i=l.userSettings.userTanks;i=n.exports.orderBy(i,"volume");const t=n.exports.filter(i,{forDeco:false});const a=n.exports.filter(i,{forDeco:true});this.bottomTanks=[];t.forEach((e=>{this.bottomTanks.push(e.getTank())}));this.decoTanks=[];a.forEach((e=>{this.decoTanks.push(e.getTank())}));this.stdConfigurations=s.getStdConfigurations();this.userStdConfigurations=n.exports.cloneDeep(l.userSettings.userConfigurations)}componentDidLoad(){this.validateAll()}async addTank(e,i,t){let s={tank:t,tanksList:null,stdGasesList:null,ccr:this.diveConfig.parameters.configuration=="CCR",parameters:this.diveConfig.parameters,decoTanks:!i};if(i){s.tanksList=this.bottomTanks;s.stdGasesList=this.bottomGases}else{s.tanksList=this.decoTanks;s.stdGasesList=this.decoGases}var l=undefined;if(a("capacitor")){l="custom-mobile-popover";e=null}const c=await o.create({component:"popover-tank",event:e,translucent:true,backdropDismiss:false,cssClass:l,componentProps:s});c.present();c.onDidDismiss().then((e=>{e=e.data;if(e){let a;if(i){a=this.diveConfig.configuration.bottom}else{a=this.diveConfig.configuration.deco}if(!t){a.push(e)}else{let i=n.exports.indexOf(a,t);a.splice(i,1,e)}this.orderTanks();this.validateForm("tanks")}}))}deleteTank(e,i){let t;if(e){t=this.diveConfig.configuration.bottom}else{t=this.diveConfig.configuration.deco}t.splice(i,1);this.orderTanks()}orderTanks(){this.diveConfig.configuration.bottom=n.exports.orderBy(this.diveConfig.configuration.bottom,"gas.fromDepth");this.diveConfig.configuration.deco=n.exports.orderBy(this.diveConfig.configuration.deco,"gas.fromDepth");this.updateView=!this.updateView}updateParams(e){this.divePlan.parameters=e}save(){this.el.closest("ion-modal").dismiss(this.diveConfig)}close(){this.el.closest("ion-modal").dismiss()}inputHandler(e){this.diveConfig[e.detail.name]=e.detail.value}validateAll(){this.validForm.name=this.diveConfig.stdName.length>=3;this.validForm.depth=this.diveConfig.maxDepth>1;this.validForm.time=this.diveConfig.maxTime>1;this.validateForm("tanks");this.updateView=!this.updateView}validateForm(e,i){if(e=="name"){this.validForm.name=i}else if(e=="time"){this.validForm.time=i}else if(e=="depth"){this.validForm.depth=i}else{this.validForm.bottom=this.bottomTanks.length>0}this.showSave=this.validForm.name&&this.validForm.time&&this.validForm.depth&&this.validForm.bottom}copyConfiguration(e){this.diveConfig=e;this.validateAll()}render(){return[i("app-navbar",{key:"009fe671339f95fe29ec4e63761cb8a48cf8dfae",tag:"dive-configuration",text:"Dive Configuration",color:c.getAppColor(),modal:true}),i("ion-content",{key:"633e9fef8f3b1e58631fe87e0c701cb00bc50c58"},i("ion-list",{key:"fc6d2d690285528c9184d0cdb2feb2cd41261e24"},i("ion-list-header",{key:"1083f193f114fa5c1f70cb7c302362615111abe4"},"Copy from standard configuration"),i("ion-row",{key:"3f546cd78201034454809c5a9c1d74b173b5314e",class:"scrollx",id:"scrollTankGas"},this.userStdConfigurations?this.userStdConfigurations.map((e=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:c.getAppColor(),onClick:()=>this.copyConfiguration(e)},e.stdName)))):undefined,this.stdConfigurations?this.stdConfigurations.map((e=>i("ion-col",{class:"item"},i("ion-button",{shape:"round",color:"success",onClick:()=>this.copyConfiguration(e)},"DP-",e.stdName)))):undefined),i("app-form-item",{key:"935ceeff3f04fc4405500f809e680dbecac453e8","label-tag":"configuration-name","label-text":"Configuration Name",value:this.diveConfig.stdName,name:"stdName","input-type":"text",onFormItemChanged:e=>this.inputHandler(e),validator:["required"],onIsValid:e=>this.validateForm("name",e.detail)}),i("app-form-item",{key:"c4dae688242ae3b79de7557b30660e1038dc8e62","label-tag":"max-depth","label-text":"Max Depth (xxx)",labelReplace:{xxx:this.diveConfig.parameters.depthUnit},value:n.exports.toString(this.diveConfig.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),validator:["required",{name:"minvalue",options:{min:1}}],onIsValid:e=>this.validateForm("depth",e.detail)}),i("app-form-item",{key:"f52c1415f6964a729e90d7728b53b494b88f3758","label-tag":"max-time","label-text":"Max Time (min)",value:n.exports.toString(this.diveConfig.maxTime),name:"maxTime","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),validator:["required",{name:"minvalue",options:{min:1}}],onIsValid:e=>this.validateForm("time",e.detail)}),i("ion-list-header",{key:"778ceed457ce669b01f8e43953bc6f565bc80f55"},i("my-transl",{key:"dc828354b4a022b7cf1d53092730f7ee915e9a0a",tag:"tanks-configuration",text:"Tank(s) Configuration",isLabel:true})),i("ion-list-header",{key:"db768abc2b03b8c1c427ee4c3fa6a866d700382b"},i("ion-grid",{key:"bf7ff092546fd837c7a93e63b2e1bddeb938463c",class:"ion-no-padding"},i("ion-row",{key:"b6ad2f8048f015862f1a1d99a0e198d5f247ee38"},i("ion-col",{key:"1be3c7a410add13defd1b810177403bf3387c17b"},i("my-transl",{key:"7163d3f8dca1063eddef4a8fb9801fa5ce1a84a6",tag:"bottom",text:"Bottom",isLabel:true})),i("ion-col",{key:"0726eb2654d45391e3d5ca2e48573d48b288a7b5",size:"1"},i("ion-row",{key:"93d48b7e7e44c3ab1758d2818f009550e5f15e2f",class:"ion-text-center"},i("ion-button",{key:"ac948ca6dbe021136ca67c7840d134c75dbea0f8","icon-only":true,fill:"clear",color:"primary",onClick:e=>this.addTank(this.screenWidth>=500?e:null,true)},i("ion-icon",{key:"6797f81f5fd3da5d5809ec2d7ec8974b6b05cce6",name:"add-circle"}))))))),this.diveConfig.configuration.bottom.length>0?i("ion-grid",null,i("ion-row",{class:"ion-text-center"},this.diveConfig.configuration.bottom.map(((e,t)=>i("ion-col",{size:"12","size-sm":true},e.name?i("ion-card",null,i("ion-card-header",{class:"ion-text-center"},e.name),i("ion-card-content",{class:"ion-text-center"},i("p",null,e.gas.toString()),i("p",null,e.pressure,d.pressUnit," / ",e.getGasVolume(),d.volumeUnit)),i("ion-grid",{class:"ion-no-padding"},i("ion-row",null,i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:i=>this.addTank(this.screenWidth>=500?i:null,true,e)},i("ion-icon",{name:"create"}),i("my-transl",{tag:"edit",text:"Edit"}))),i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:()=>this.deleteTank(true,t)},i("ion-icon",{name:"trash"}),i("my-transl",{tag:"delete",text:"Delete"})))))):undefined))))):undefined,i("ion-list-header",{key:"db99a842685e16a1cf1d4317462a2e9953e2a836"},i("ion-grid",{key:"5469adb9b9ea85db30b3ad6df8bc8f7cf6f74322",class:"ion-no-padding"},i("ion-row",{key:"f7b11663263a84d63c592a51c56220cf2f655e5f"},i("ion-col",{key:"ef9e6673f548d008b4aa37fc0c9f426518e7706b"},i("my-transl",{key:"36cdb5f22f490d8931a0b27b150361bd723f03c2",tag:"deco",text:"Deco",isLabel:true})),i("ion-col",{key:"2adfbdf0b8b2344e2b3e8c357919234d67ca6b66",size:"1"},i("ion-row",{key:"1d154300d38d9b10148f5c913b8f94269e5c27ad",class:"ion-text-center"},i("ion-button",{key:"e3cdafbf9eabe600c33c5fd5790e3f74c9977c35","icon-only":true,fill:"clear",color:"primary",onClick:e=>this.addTank(this.screenWidth>=500?e:null,false)},i("ion-icon",{key:"c99abc6a878d7e07c6ab2ab9c36e0dbcb1460b75",name:"add-circle"}))))))),this.diveConfig.configuration.deco.length>0?i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-text-center"},this.diveConfig.configuration.deco.map(((e,t)=>i("ion-col",{size:"12","size-sm":true},e.name?i("ion-card",null,i("ion-card-header",{class:"ion-text-center"},e.name),i("ion-card-content",{class:"ion-text-center"},i("p",null,e.gas.toString()),i("p",null,e.pressure,d.pressUnit," / ",e.getGasVolume(),d.volumeUnit)),i("ion-grid",{class:"ion-no-padding"},i("ion-row",null,i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:i=>this.addTank(this.screenWidth>=500?i:null,false,e)},i("ion-icon",{name:"create"}),i("my-transl",{tag:"edit",text:"Edit"}))),i("ion-col",null,i("ion-button",{"icon-left":true,fill:"clear",size:"small",onClick:()=>this.deleteTank(false,t)},i("ion-icon",{name:"trash"}),i("my-transl",{tag:"delete",text:"Delete"})))))):undefined))))):undefined,i("app-decoplanner-settings",{key:"2d01266d15ddd798033b64ec4e93abcd465301a8",diveDataToShare:this.diveDataToShare,onUpdateParamsEvent:e=>this.updateParams(e)}))),i("app-modal-footer",{key:"c4de8adad7cb63c7b3c94ebb7526e2956830e25e",disableSave:!this.showSave,onCancelEmit:()=>this.close(),onSaveEmit:()=>this.save()})]}get el(){return t(this)}};m.style=f;export{m as modal_dive_configuration};