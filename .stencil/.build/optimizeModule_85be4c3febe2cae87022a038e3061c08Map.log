{"version":3,"names":["modalShapeTypeCss","ModalShapeTypeStyle0","ModalShapeType","componentWillLoad","this","loadShapeTypes","ShapesService","downloadShapeSettings","shapeTypes","cloneDeep","getShapeTypes","length","shapeType","addShapeType","validateShape","selectType","ev","find","x","typeId","detail","value","handleChange","n","name","v","replace","trim","toLowerCase","validShapeType","isString","typeName","en","isNumber","decimals","position","dwg","url","updateView","editDrawing","id","description","popover","RouterService","openPopover","media","onDidDismiss","then","async","data","mediaToUpload","mediaToStore","files","itemId","collectionId","SHAPESCOLLECTION","urls","Object","keys","forEach","save","ShapeType","push","index","duplicateShapeType","deleteShapeType","splice","error","SystemService","presentAlertError","dismiss","uploadShapeTypes","modalController","cancel","render","h","Host","key","heightPx","backgroundCoverFill","link","expand","fill","color","disabled","onClick","slot","TranslationService","getTransl","label","tag","text","lines","selectFn","selectOptions","selectValueId","selectValueText","size","class","onFormItemChanged","labelPosition","validator","options","min","type","list","multiLanguage","inputStep","Environment","getAppColor","disableSave","onCancelEmit","onSaveEmit"],"sources":["src/components/trasteel/modals/modal-shape-type/modal-shape-type.scss?tag=modal-shape-type","src/components/trasteel/modals/modal-shape-type/modal-shape-type.tsx"],"sourcesContent":["modal-shape-type {\n  ion-list {\n    width: 100%;\n  }\n}\n","import {Component, h, Host, State, Element} from \"@stencil/core\";\nimport {modalController} from \"@ionic/core\";\nimport {cloneDeep, isNumber, isString} from \"lodash\";\nimport {TranslationService} from \"../../../../services/common/translations\";\nimport {ShapeType} from \"../../../../interfaces/trasteel/refractories/shapes\";\nimport {\n  SHAPESCOLLECTION,\n  ShapesService,\n} from \"../../../../services/trasteel/refractories/shapes\";\nimport {RouterService} from \"../../../../services/common/router\";\nimport {Environment} from \"../../../../global/env\";\nimport {SystemService} from \"../../../../services/common/system\";\n\n@Component({\n  tag: \"modal-shape-type\",\n  styleUrl: \"modal-shape-type.scss\",\n})\nexport class ModalShapeType {\n  @Element() el: HTMLElement;\n  @State() index: number = 0;\n  @State() shapeTypes: ShapeType[];\n  @State() shapeType: ShapeType;\n  @State() updateView = true;\n  @State() validShapeType = false;\n\n  async componentWillLoad() {\n    await this.loadShapeTypes();\n  }\n\n  async loadShapeTypes() {\n    await ShapesService.downloadShapeSettings();\n    this.shapeTypes = cloneDeep(await ShapesService.getShapeTypes());\n    if (this.shapeTypes && this.shapeTypes.length > 0) {\n      this.shapeType = this.shapeTypes[0];\n    } else {\n      //create new and add to list\n      this.shapeTypes = [];\n      this.addShapeType();\n    }\n    this.validateShape();\n  }\n\n  selectType(ev) {\n    this.shapeType = this.shapeTypes.find((x) => x.typeId == ev.detail.value);\n    this.validateShape();\n  }\n\n  handleChange(ev) {\n    const n = ev.detail.name;\n    let v = ev.detail.value;\n    if (n == \"typeId\") {\n      //remove spaces and lowercase\n      v = v.replace(/\\s+/g, \"-\").trim().toLowerCase();\n    }\n    this.shapeType[n] = v;\n    this.validateShape();\n  }\n\n  validateShape() {\n    this.validShapeType =\n      isString(this.shapeType.typeId) &&\n      isString(this.shapeType.typeName.en) &&\n      isNumber(this.shapeType.decimals) &&\n      this.shapeType.position > 0 &&\n      isString(this.shapeType.dwg.url);\n    this.updateView = !this.updateView;\n  }\n\n  async editDrawing() {\n    this.shapeType.dwg.id = this.shapeType.typeId;\n    this.shapeType.dwg.name = this.shapeType.typeName.en;\n    this.shapeType.dwg.description = \"\";\n    const popover = await RouterService.openPopover(\"popover-media-loading\", {\n      media: this.shapeType.dwg,\n    });\n    popover.onDidDismiss().then(async (ev) => {\n      if (ev && ev.data) {\n        const mediaToUpload = {\n          [ev.data.media.id]: ev.data,\n        };\n        const mediaToStore = ev.data.media;\n        const popover = await RouterService.openPopover(\n          \"popover-media-uploader\",\n          {\n            files: mediaToUpload,\n            itemId: this.shapeType.typeId,\n            collectionId: SHAPESCOLLECTION,\n          }\n        );\n        popover.onDidDismiss().then((ev) => {\n          if (ev && ev.data) {\n            const urls = ev.data;\n            //update urls into media\n            this.shapeType.dwg = mediaToStore;\n            Object.keys(urls).forEach((id) => {\n              this.shapeType.dwg.url = urls[id];\n            });\n            this.save(false);\n            this.validateShape();\n          }\n        });\n      }\n    });\n  }\n\n  addShapeType() {\n    this.shapeType = new ShapeType();\n    this.shapeTypes.push(this.shapeType);\n    this.index = this.shapeTypes.length - 1;\n  }\n\n  duplicateShapeType() {\n    this.shapeType = cloneDeep(this.shapeType);\n    this.shapeType.typeId = this.shapeType.typeId + \"_rev.\";\n    this.shapeTypes.push(this.shapeType);\n    this.index = this.shapeTypes.length - 1;\n  }\n\n  async deleteShapeType() {\n    try {\n      this.shapeTypes.splice(this.index, 1);\n      this.index = 0;\n      this.shapeType = this.shapeTypes[0];\n      this.validateShape();\n    } catch (error) {\n      if (error) SystemService.presentAlertError(error);\n    }\n  }\n\n  async save(dismiss = true) {\n    await ShapesService.uploadShapeTypes(this.shapeTypes);\n    return dismiss ? modalController.dismiss() : true;\n  }\n\n  async cancel() {\n    return modalController.dismiss();\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-content>\n          <app-banner\n            heightPx={500}\n            backgroundCoverFill={false}\n            link={this.shapeType.dwg ? this.shapeType.dwg.url : null}\n          ></app-banner>\n          <ion-button\n            expand=\"block\"\n            fill=\"outline\"\n            color=\"trasteel\"\n            disabled={!this.shapeType.typeId}\n            onClick={() => this.editDrawing()}\n          >\n            <ion-icon slot=\"start\" name=\"create\"></ion-icon>\n            <ion-label>\n              {!this.shapeType.typeId\n                ? TranslationService.getTransl(\n                    \"media-loader-error\",\n                    \"Please insert the ID to upload new media.\"\n                  )\n                : TranslationService.getTransl(\"edit-drawing\", \"Edit Drawing\")}\n            </ion-label>\n          </ion-button>\n          <ion-grid>\n            <ion-row>\n              <ion-col>\n                <app-select-search\n                  label={{\n                    tag: \"shape_type\",\n                    text: \"Shape Type\",\n                  }}\n                  value={this.shapeType.typeId}\n                  lines=\"inset\"\n                  selectFn={(ev) => this.selectType(ev)}\n                  selectOptions={this.shapeTypes}\n                  selectValueId=\"typeId\"\n                  selectValueText={[\"typeName\", \"en\"]}\n                  disabled={!this.validShapeType}\n                ></app-select-search>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validShapeType}\n                  onClick={() => this.addShapeType()}\n                >\n                  <ion-icon name=\"add\" slot=\"start\" />\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validShapeType}\n                  onClick={() => this.duplicateShapeType()}\n                >\n                  <ion-icon slot=\"start\" name=\"duplicate\"></ion-icon>\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  color=\"danger\"\n                  disabled={this.shapeTypes.length == 0}\n                  onClick={() => this.deleteShapeType()}\n                >\n                  <ion-icon slot=\"start\" name=\"trash\"></ion-icon>\n                </ion-button>\n              </ion-col>\n            </ion-row>\n          </ion-grid>\n\n          <app-form-item\n            label-text=\"Position\"\n            value={this.shapeType.position}\n            name=\"position\"\n            input-type=\"number\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\n              \"required\",\n              {\n                name: \"minvalue\",\n                options: {min: 1},\n              },\n            ]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"ID\"\n            value={this.shapeType.typeId}\n            name=\"typeId\"\n            input-type=\"string\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\n              \"required\",\n              {\n                name: \"uniqueid\",\n                options: {\n                  type: \"list\",\n                  index: \"typeId\",\n                  list: this.shapeTypes,\n                },\n              },\n            ]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"Name\"\n            value={this.shapeType.typeName}\n            name=\"typeName\"\n            input-type=\"text\"\n            multiLanguage={true}\n            text-rows=\"1\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\"required\"]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"Decimals\"\n            value={this.shapeType.decimals}\n            name=\"decimals\"\n            inputStep=\"1\"\n            input-type=\"number\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\"required\"]}\n          ></app-form-item>\n        </ion-content>\n        <app-modal-footer\n          color={Environment.getAppColor()}\n          disableSave={!this.validShapeType}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}