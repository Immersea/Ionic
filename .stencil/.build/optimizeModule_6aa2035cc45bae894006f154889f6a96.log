import{r as e,h as a,f as t}from"./p-cbe60c68.js";import{S as i,W as s,R as n,ai as l,E as o,aO as d}from"./p-8f24d722.js";import{S as c}from"./p-a75993af.js";import{T as r}from"./p-4413a3ef.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-1af05547.js";import"./p-e9c4f463.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const p="page-customer-details{}";const b=p;const f=class{constructor(a){e(this,a);this.markers=[];this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"locations",text:"Locations",disabled:false},{tag:"operating-conditions",text:"Operating Conditions",disabled:false},{tag:"map",text:"Map",disabled:false}];this.itemId=undefined;this.customer=undefined;this.locationTypeSegment=0;this.slider=undefined}async componentWillLoad(){await this.loadCustomer()}async loadCustomer(){await i.presentLoading("loading");try{this.customer=await s.getCustomer(this.itemId);i.dismissLoading();this.markers=[];if(this.customer.locations.length>0){this.customer.locations.forEach((e=>{if(e.position&&e.position.geopoint){const a={latitude:e.position.geopoint.latitude,longitude:e.position.geopoint.longitude,icon:{type:"ionicon",name:"location",color:"secondary",size:"large"}};this.markers.push(a)}}));if(this.markers.length>0)this.loadMap();this.titles[1].disabled=this.customer.locations.length==0;this.titles[2].disabled=!(this.customer.conditions.EAF.length>0||this.customer.conditions.LF.length>0||this.customer.conditions.CCM.length>0);this.titles[3].disabled=this.customer.locations.length==0||this.markers.length==0}}catch(e){i.dismissLoading();n.goBack();i.presentAlertError(e)}}async componentDidLoad(){this.slider=new c(".slider-customer",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(this.markers.length>0)this.loadMap()}async loadMap(){await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");if(this.mapElement){const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+(l(this.customer)+20)+"px");setTimeout((()=>{this.mapElement.triggerMapResize();this.mapElement.fitToBounds(this.markers)}))}this.updateSlider()}async editCustomer(){const e=await s.presentCustomerUpdate(this.itemId);e.onDidDismiss().then((()=>this.loadCustomer()))}locationTypeSegmentChanged(e){this.locationTypeSegment=e.detail.value;this.updateSlider()}async openOperatingCondition(e,a){await n.openModal("modal-operating-conditions-questionnaire",{condition:e,conditionData:a,editable:false})}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}render(){return[this.customer.coverURL||this.customer.photoURL?a("ion-header",null,a("app-item-cover",{item:this.customer})):undefined,a("ion-header",{key:"ffd90922feceb062a880f90aca36f253d1a0a88a"},a("app-navbar",{key:"53f1f617e957be9652b26f08a140e19274ea3864",text:this.customer.fullName,color:"trasteel",backButton:this.customer&&!this.customer.coverURL&&!this.customer.photoURL,rightButtonText:r.isCustomerDBAdmin()?{icon:"create",fill:"outline",tag:"edit",text:"Edit"}:null,rightButtonFc:()=>this.editCustomer()})),a("app-header-segment-toolbar",{key:"b16ee820913ee3b5cb6195bbc0862a3928a9eaf9",color:o.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"c1b5e73ced35634388415434085ce7dc943863fd",class:"slides"},a("ion-fab",{key:"538f3b6751ce7fc29143208882e1ca24e84d61a1",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:d(2)}},a("ion-fab-button",{key:"92aa9bd72525fc9b75acbdc35d208b981280431e",onClick:()=>n.goBack(),class:"fab-icon"},a("ion-icon",{key:"c02af5929ef6ec6f088a903e290b035d9a220a44",name:"arrow-back-circle-outline"}))),a("swiper-container",{key:"6d6fb9b849562c03d6abb3440d08ef77094b0d67",class:"slider-customer swiper"},a("swiper-wrapper",{key:"30007bd97edada651ea80d412c230e345cc31d6a",class:"swiper-wrapper"},a("swiper-slide",{key:"bdf35ff97345fce3ec427b9dc45c2391e28f58c2",class:"swiper-slide"},a("ion-list",{key:"7a56cff9d18043d6a6c6a46b1944ba44db49abc6",class:"ion-no-padding"},a("app-item-detail",{key:"a009ac252f4b03317ebad6641b02c2a92a1087e4",lines:"none",labelTag:"plant_type",labelText:"Plant Type",detailText:s.getCustomerTypes(this.customer.typeId)[0].typeName}),a("app-item-detail",{key:"6caad5508a2d811cab93a7be4a0b2cd938e6ad18",lines:"none",labelTag:"name",labelText:"Name",detailText:this.customer.fullName}),a("app-item-detail",{key:"6612bd1fa8b22f21b7153eef4e19f7938f20c2d3",lines:"none",labelTag:"local_name",labelText:"Local Name",detailText:this.customer.fullNameOther}),a("app-item-detail",{key:"a5a830c15319c1659bc0e445dd4507e841292a0f",lines:"none",labelTag:"other_name",labelText:"Other Name",detailText:this.customer.otherPlantName}),a("app-item-detail",{key:"d1dec9aa38af3eda6a145954312d36b6bf1374e1",lines:"none",labelTag:"other_name",labelText:"Other Local Name",detailText:this.customer.otherPlantNameOther}),a("app-item-detail",{key:"333143a8c9c563c2a755a436de594ec4e415c1b0",lines:"none",labelTag:"short_name",labelText:"Short Name",detailText:this.customer.shortName}),this.customer.group.map(((e,t)=>a("app-item-detail",{lines:"none",labelTag:t==0?"group":null,labelText:t==0?"Group":null,detailText:e.groupName+" ["+e.groupOwnershipPerc+"%]"}))),a("app-item-detail",{key:"62c83e92ebf20be9b26d204a55e59d8ec85b2997",lines:"none",labelTag:"owner",labelText:"Owner",detailText:this.customer.owner.groupName}),a("app-customer-plant-production",{key:"629f09ead41580994f14982c4b2672a04386d807",customer:this.customer}))),a("swiper-slide",{key:"c85b5a1cd17e48f063eae3a682a45b068dcf4d55",class:"swiper-slide"},a("div",{key:"7938fd6c432bf30dabf9a67fc09e08298e515dd0"},this.customer.locations.length>0?[a("ion-toolbar",null,a("ion-segment",{mode:"ios",scrollable:true,onIonChange:e=>this.locationTypeSegmentChanged(e),value:this.locationTypeSegment},this.customer.locations.map(((e,t)=>a("ion-segment-button",{value:t,layout:"icon-start"},a("ion-label",null,s.getLocationsTypes(e.type)[0].locationName)))))),this.customer.locations.map(((e,t)=>a("div",null,this.locationTypeSegment==t?a("div",null,a("app-location",{locations:s.getLocationsTypes(),location:e,slider:this.slider,editable:false})):undefined)))]:undefined)),a("swiper-slide",{key:"68322057ae8cf002e0c3337fc0d19bd903f68afd",class:"swiper-slide"},a("ion-list",{key:"061e700060be6baab9dcf1813bd5348c5a4d9536"},a("ion-item-divider",{key:"73ad6ff93cbfd23352347bfa0ed01caad05d4330"},"EAF"),this.customer.conditions.EAF.map((e=>a("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},a("ion-label",null,new Date(e.date).toLocaleDateString())))),a("ion-item-divider",{key:"f386a440c2fb5ac0bb3c8933108e6f48f4372d7d"},"LF"),this.customer.conditions.LF.map((e=>a("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},a("ion-label",null,new Date(e.date).toLocaleDateString())))),a("ion-item-divider",{key:"72fad9cd4503364348a074d127f69da5a8834b93"},"CCM"),this.customer.conditions.CCM.map((e=>a("ion-item",null,a("ion-label",null,new Date(e.date).toLocaleDateString())))))),a("swiper-slide",{key:"58b51bf89234930245ea024490f7b7a6f0abf267",class:"swiper-slide"},this.customer.locations.length>0&&this.markers.length>0?a("div",{id:"map-container"},a("app-map",{id:"map",pageId:"customer-details",center:this.customer.locations[0],markers:this.markers})):a("div",null,a("ion-item",null,"NO MAP AVAILABLE"))))))]}get el(){return t(this)}};f.style=b;export{f as page_customer_details};