import{r as t,h as s,H as e,f as i,e as r}from"./p-cbe60c68.js";import{r as o,n}from"./p-0c274673.js";import{g as c}from"./p-ae1763fb.js";import{a,g as h}from"./p-5347adbe.js";import{r as d}from"./p-9c77ce6f.js";import{a as l,b as f,h as p}from"./p-005de791.js";import"./p-694b8ade.js";import"./p-6879854f.js";import"./p-78bffe29.js";import"./p-3647f076.js";const u=":host([slot]){display:none;line-height:0;z-index:100}.reorder-icon{display:block}::slotted(ion-icon){font-size:dynamic-font(16px)}.reorder-icon{font-size:2.125rem;opacity:0.4}";const m=u;const b=":host([slot]){display:none;line-height:0;z-index:100}.reorder-icon{display:block}::slotted(ion-icon){font-size:dynamic-font(16px)}.reorder-icon{font-size:1.9375rem;opacity:0.3}";const y=b;const g=class{constructor(s){t(this,s)}onClick(t){const s=this.el.closest("ion-reorder-group");t.preventDefault();if(!s||!s.disabled){t.stopImmediatePropagation()}}render(){const t=c(this);const i=t==="ios"?o:n;return s(e,{key:"663d74e231e3af56b6298ee2539fdac9c8465839",class:t},s("slot",{key:"c7c384ab8c9ca8abdc89cd984a39dfde70e342ca"},s("ion-icon",{key:"c8b6052db03d4b9e33a90e600c20861c73ee73ce",icon:i,lazy:false,class:"reorder-icon",part:"icon","aria-hidden":"true"})))}get el(){return i(this)}};g.style={ios:m,md:y};const x=".reorder-list-active>*{display:block;transition:transform 300ms;will-change:transform}.reorder-enabled{user-select:none}.reorder-enabled ion-reorder{display:block;cursor:grab;pointer-events:all;touch-action:none}.reorder-selected,.reorder-selected ion-reorder{cursor:grabbing}.reorder-selected{position:relative;transition:none !important;box-shadow:0 0 10px rgba(0, 0, 0, 0.4);opacity:0.8;z-index:100}.reorder-visible ion-reorder .reorder-icon{transform:translate3d(0,  0,  0)}";const j=x;const k=class{constructor(s){t(this,s);this.ionItemReorder=r(this,"ionItemReorder",7);this.lastToIndex=-1;this.cachedHeights=[];this.scrollElTop=0;this.scrollElBottom=0;this.scrollElInitial=0;this.containerTop=0;this.containerBottom=0;this.state=0;this.disabled=true}disabledChanged(){if(this.gesture){this.gesture.enable(!this.disabled)}}async connectedCallback(){const t=a(this.el);if(t){this.scrollEl=await h(t)}this.gesture=(await import("./p-52ed752a.js")).createGesture({el:this.el,gestureName:"reorder",gesturePriority:110,threshold:0,direction:"y",passive:false,canStart:t=>this.canStart(t),onStart:t=>this.onStart(t),onMove:t=>this.onMove(t),onEnd:()=>this.onEnd()});this.disabledChanged()}disconnectedCallback(){this.onEnd();if(this.gesture){this.gesture.destroy();this.gesture=undefined}}complete(t){return Promise.resolve(this.completeReorder(t))}canStart(t){if(this.selectedItemEl||this.state!==0){return false}const s=t.event.target;const e=s.closest("ion-reorder");if(!e){return false}const i=z(e,this.el);if(!i){return false}t.data=i;return true}onStart(t){t.event.preventDefault();const s=this.selectedItemEl=t.data;const e=this.cachedHeights;e.length=0;const i=this.el;const r=i.children;if(!r||r.length===0){return}let o=0;for(let t=0;t<r.length;t++){const s=r[t];o+=s.offsetHeight;e.push(o);s.$ionIndex=t}const n=i.getBoundingClientRect();this.containerTop=n.top;this.containerBottom=n.bottom;if(this.scrollEl){const t=this.scrollEl.getBoundingClientRect();this.scrollElInitial=this.scrollEl.scrollTop;this.scrollElTop=t.top+w;this.scrollElBottom=t.bottom-w}else{this.scrollElInitial=0;this.scrollElTop=0;this.scrollElBottom=0}this.lastToIndex=v(s);this.selectedItemHeight=s.offsetHeight;this.state=1;s.classList.add(M);l()}onMove(t){const s=this.selectedItemEl;if(!s){return}const e=this.autoscroll(t.currentY);const i=this.containerTop-e;const r=this.containerBottom-e;const o=Math.max(i,Math.min(t.currentY,r));const n=e+o-t.startY;const c=o-i;const a=this.itemIndexForTop(c);if(a!==this.lastToIndex){const t=v(s);this.lastToIndex=a;f();this.reorderMove(t,a)}s.style.transform=`translateY(${n}px)`}onEnd(){const t=this.selectedItemEl;this.state=2;if(!t){this.state=0;return}const s=this.lastToIndex;const e=v(t);if(s===e){this.completeReorder()}else{this.ionItemReorder.emit({from:e,to:s,complete:this.completeReorder.bind(this)})}p()}completeReorder(t){const s=this.selectedItemEl;if(s&&this.state===2){const e=this.el.children;const i=e.length;const r=this.lastToIndex;const o=v(s);d((()=>{if(r!==o&&(t===undefined||t===true)){const t=o<r?e[r+1]:e[r];this.el.insertBefore(s,t)}for(let t=0;t<i;t++){e[t].style["transform"]=""}}));if(Array.isArray(t)){t=S(t,o,r)}s.style.transition="";s.classList.remove(M);this.selectedItemEl=undefined;this.state=0}return t}itemIndexForTop(t){const s=this.cachedHeights;for(let e=0;e<s.length;e++){if(s[e]>t){return e}}return s.length-1}reorderMove(t,s){const e=this.selectedItemHeight;const i=this.el.children;for(let r=0;r<i.length;r++){const o=i[r].style;let n="";if(r>t&&r<=s){n=`translateY(${-e}px)`}else if(r<t&&r>=s){n=`translateY(${e}px)`}o["transform"]=n}}autoscroll(t){if(!this.scrollEl){return 0}let s=0;if(t<this.scrollElTop){s=-C}else if(t>this.scrollElBottom){s=C}if(s!==0){this.scrollEl.scrollBy(0,s)}return this.scrollEl.scrollTop-this.scrollElInitial}render(){const t=c(this);return s(e,{key:"491f3e5843cf728ff4589e58bd86b8ce6709b293",class:{[t]:true,"reorder-enabled":!this.disabled,"reorder-list-active":this.state!==0}})}get el(){return i(this)}static get watchers(){return{disabled:["disabledChanged"]}}};const v=t=>t["$ionIndex"];const z=(t,s)=>{let e;while(t){e=t.parentElement;if(e===s){return t}t=e}return undefined};const w=60;const C=10;const M="reorder-selected";const S=(t,s,e)=>{const i=t[s];t.splice(s,1);t.splice(e,0,i);return t.slice()};k.style=j;export{g as ion_reorder,k as ion_reorder_group};