import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as o}from"./p-c2915cc5.js";import{S as s}from"./p-a75993af.js";import{U as n,p as c,T as l,_ as d,$ as r,W as h,S as b,E as f,l as m}from"./p-944b5726.js";import{l as p}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const u="modal-contact-update ion-list{width:100%}";const y=u;const k=class{constructor(t){e(this,t);this.contactId=undefined;this.contact=undefined;this.customerLocations=[];this.segment="information";this.updateView=true;this.validContact=false;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=n.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.segmentTitles={information:l.getTransl("information","Information")};await this.loadContact()}async loadContact(){if(this.contactId){const e=await d.getContact(this.contactId);this.contact=e}else{this.contact=new r;this.contact.users={[n.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-contact",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.validateContact()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.contact[e.detail.name]=e.detail.value;this.validateContact()}handleInformationChange(){this.validateContact()}selectCustomer(e){this.contact.customerId=e.detail.value;h.getCustomer(e.detail.value).then((e=>{this.customer=e;this.customerLocations=e.locations;this.setLocationsSelect()}));this.validateContact()}selectCustomerLocation(e){this.contact.customerLocationId=e.detail.value;this.validateContact()}setLocationsSelect(){const e=this.el.querySelector("#selectLocation");const t={header:l.getTransl("location","Locations")};e.interfaceOptions=t;const a=Array.from(e.getElementsByTagName("ion-select-option"));a.map((t=>{e.removeChild(t)}));e.placeholder=l.getTransl("select","Select");this.customerLocations.map((t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=l.getTransl(t.type,h.getLocationsTypes(t.type)[0].locationName);e.appendChild(a)}));this.updateSlider()}updateParam(){this.validateContact()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break}}}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.contact.photoURL=a}else{this.contact.coverURL=a}this.save(false)}validateContact(){this.validContact=p.exports.isString(this.contact.firstName)&&p.exports.isString(this.contact.lastName)&&p.exports.isString(this.contact.customerId)}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteContact(){try{await d.deleteContact(this.contactId);o.dismiss()}catch(e){b.presentAlertError(e)}}async save(e=true){const t=await d.updateContact(this.contactId,this.contact,this.userProfile.uid);if(this.contactId){return e?o.dismiss():true}else{this.contactId=t.id;return true}}async cancel(){o.dismiss()}render(){return t(a,{key:"13ca9e862a450092106dd88dc492a7dd80b2c8ae"},t("ion-header",{key:"b4e5e5762ecdcbd2a4828a5f84cb97991aa5204f"},t("app-upload-cover",{key:"11988f7d2e63de1a090898ea478b4df95a2b6e32",item:{collection:m,id:this.contactId,photoURL:this.contact.photoURL,coverURL:this.contact.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-header",{key:"549ddb1c624be64ac6a338739520c706f4691e4d"},t("ion-toolbar",{key:"0c41e4fac9613fb98ddc3badf9b6d22402b24f7e"},t("ion-segment",{key:"a6fc1aaa9797b74922d14e29ca031700f2e92ed8",mode:"md",color:f.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},t("ion-segment-button",{key:"111fe2607c2de497445f0dc012be4d228285c31a",value:"information",layout:"icon-start"},t("ion-label",{key:"4a15bb0b3d289fdb31a639a47c0b9a260cc04980"},this.segmentTitles.information))))),t("ion-content",{key:"8e58c4779d4d788e3e688e304769a994f06e0ff1",class:"slides"},t("swiper-container",{key:"06e479ba980707ee971af5760cdb9671b9d160db",class:"slider-edit-contact swiper"},t("swiper-wrapper",{key:"85fe4fd9026eecc1b2bbaf7ba432b4cfcd1afa90",class:"swiper-wrapper"},t("swiper-slide",{key:"35745a47bba1a7d31299709f7899ec8c0c82606b",class:"swiper-slide"},t("ion-list",{key:"1d2fc43a964f49d91e8ee297247387fec7f7a55e",class:"ion-no-padding"},t("ion-list-header",{key:"2d790c985a7c757f5e842d2a5da9c07ab2345395"},t("my-transl",{key:"5bea752023e9b4a37c53c44f9f0e87b0c23b0408",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"45699116bb7c23122669472d315e9e968cd482b1",lines:"none"},t("ion-select",{key:"04c70c69cda8391ebe207bad3061bfafe088b6cb",color:"trasteel",id:"selectCustomer",interface:"action-sheet",label:l.getTransl("customer","Customer"),"label-placement":"floating",onIonChange:e=>this.selectCustomer(e),value:this.contact&&this.contact.customerId?this.contact.customerId:null},h.customersList.map((e=>t("ion-select-option",{value:e.id},e.fullName))))),t("ion-item",{key:"6eb521c5dc3e05af7c6e5e1e47bdb7e7fe5dfa44",lines:"none"},t("ion-select",{key:"b8780b1aba98892a4218ceb4807bffb941946e7f",color:"trasteel",id:"selectLocation",interface:"action-sheet",label:l.getTransl("location","Location"),"label-placement":"floating",onIonChange:e=>this.selectCustomerLocation(e),value:this.contact&&this.contact.customerLocationId?this.contact.customerLocationId:null})),t("app-form-item",{key:"f3819d674b2e7834d8de76cb3266ebe33483cdc3","label-tag":"name","label-text":"Name",value:this.contact.firstName,name:"firstName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"10b47b6146eba2bc43fc1648d4dd18097dcf8b59","label-tag":"surname","label-text":"Surname",value:this.contact.lastName,name:"lastName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"de0f2df084001b0b74bacbd60598ca3686671ecb","label-tag":"work-position","label-text":"Work Position",value:this.contact.workPosition,name:"workPosition","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"6a1e94b4d8700cec1e4b750294940b51c1b77173","label-tag":"office-phone","label-text":"Office Phone",value:this.contact.officePhone,name:"officePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"8bb1af7670302e8cd1f74382fec4eb0daecd1aaf","label-tag":"mobile-phone","label-text":"Mobile Phone",value:this.contact.mobilePhone,name:"mobilePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"1776f4f2bd8f7ec3761acf3128ccea10e6766ca8","label-tag":"email","label-text":"Email",value:this.contact.email,name:"email","input-type":"email","input-form-mode":"email",onFormItemChanged:e=>this.handleChange(e)})),this.contactId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteContact()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined)))),t("app-modal-footer",{key:"61a67a8ea87e113bfdc39fdb22e49476a44a3e0c",color:f.getAppColor(),disableSave:!this.validContact,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};k.style=y;export{k as modal_contact_update};