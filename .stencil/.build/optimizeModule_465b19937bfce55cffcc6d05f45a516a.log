import{r as e,h as t,H as s,f as i}from"./p-cbe60c68.js";import{T as a,e as c,d,S as o,at as n,au as l,U as h}from"./p-773bd3de.js";import"./p-c7ee7cfe.js";import{b as f,n as b}from"./p-c2915cc5.js";import{l as r}from"./p-1af05547.js";import{S as p}from"./p-a75993af.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const u="modal-diving-class-update ion-list{width:100%}modal-diving-class-update app-diving-class-schedule{width:100%}modal-diving-class-update ion-segment-button{--color-checked:var(--ion-color-divingclass-contrast)}";const m=u;const v=class{constructor(t){e(this,t);this.divingClassId=undefined;this.collectionId=undefined;this.organiserId=undefined;this.divingClass=undefined;this.updateView=true;this.validClass=false;this.selectedCourse=undefined;this.addressText=undefined;this.titles=[{tag:"details"},{tag:"schedule"},{tag:"team"},{tag:"students"}];this.slider=undefined;this.selectGotFocus=false}async componentWillLoad(){await this.loadDivingClass();this.statusTitles={active:a.getTransl("active","Active"),closed:a.getTransl("closed","Closed"),cancelled:a.getTransl("cancelled","Cancelled")};this.placeholder=a.getTransl("insert-title","Insert title");if(this.organiserId==c.selectedDivingSchoolId){this.divingSchool=c.selectedDivingSchool}else if(this.collectionId==d){this.divingSchool=await c.getDivingSchool(this.organiserId)}this.divingAgencies=o.systemPreferences.divingAgencies;this.divingCourses=await o.getDivingCoursesForSchool(this.divingSchool);if(this.divingClass&&this.divingClass.course){this.selectedCourse=this.divingCourses.find((e=>e.agencyId===this.divingClass.course.agencyId&&e.id===this.divingClass.course.certificationId))}}async loadDivingClass(){if(this.divingClassId){this.divingClass=await n.getDivingClass(this.divingClassId);this.collectionId=this.divingClass.organiser.collectionId;this.organiserId=this.divingClass.organiser.id}else{this.divingClass=new l;this.divingClass.organiser={collectionId:this.collectionId,id:this.organiserId};this.divingClass.users={[h.userRoles.uid]:["owner","instructor"]}}this.addressText=this.divingClass.location&&this.divingClass.location.display_name?this.divingClass.location.display_name:null}async componentDidLoad(){this.slider=new p(".slider-dive-class",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.appBookings=this.el.getElementsByTagName("app-dive-class-bookings")[0];this.appSchedule=this.el.getElementsByTagName("app-diving-class-schedule")[0];this.createCourseSelectOptions();this.validateClass()}createCourseSelectOptions(){this.selectCourseElement=this.el.querySelector("#dive-course-select");const e={header:a.getTransl("diving-course","Diving Course")};const t=Array.from(this.selectCourseElement.getElementsByTagName("ion-select-option"));t.map((e=>{this.selectCourseElement.removeChild(e)}));this.selectCourseElement.interfaceOptions=e;r.exports.each(this.divingCourses,(e=>{const t=document.createElement("ion-select-option");t.value=e;t.textContent=this.divingAgencies[e.agencyId].name+" - "+e.name;this.selectCourseElement.appendChild(t)}))}async changeCourse(e){if(this.selectGotFocus&&this.divingClass&&this.divingClass.activities&&this.divingClass.activities.length>0){const t=await f.create({header:a.getTransl("diving-course","Diving Course"),message:a.getTransl("update-class-activities","This will update all class activities! Are you sure?"),buttons:[{text:a.getTransl("ok","OK"),handler:()=>{this.selectGotFocus=false;this.updateCourseDetails(e)}},{text:a.getTransl("cancel","Cancel"),handler:()=>{this.selectGotFocus=false;this.createCourseSelectOptions();this.selectedCourse=Object.assign({},this.selectedCourse)},role:"cancel",cssClass:"secondary"}]});t.present()}else{this.updateCourseDetails(e)}}updateCourseDetails(e){this.selectedCourse=e;this.divingClass.name=this.divingAgencies[this.selectedCourse.agencyId].name+" - "+this.selectedCourse.name;this.divingClass.activities=r.exports.cloneDeep(e.activities);this.divingClass.numberOfStudents=e.numberOfStudents;this.divingClass.course={certificationId:e.id,agencyId:e.agencyId};this.appBookings.updateStudentsList();this.appSchedule.updateClassSchedule();this.validateClass()}selectLocation(e){this.divingClass.location=e;this.addressText=e.display_name;this.validateClass()}updateStudents(e){this.divingClass.numberOfStudents=r.exports.toNumber(e);this.appBookings.updateStudentsList();this.validateClass()}updateStatus(e){this.divingClass.status=e;this.validateClass()}handleChange(e){this.divingClass[e.detail.name]=e.detail.value;this.validateClass()}validateClass(){this.validClass=r.exports.isString(this.divingClass.name)&&this.divingClass.numberOfStudents>0&&this.divingClass.location&&r.exports.isString(this.divingClass.location.display_name)&&r.exports.isString(this.divingClass.status)&&Object.keys(this.divingClass.schedule).length>0;this.updateView=!this.updateView}async save(){await n.updateDivingClass(this.divingClassId,this.divingClass);return b.dismiss(false)}async cancel(){return b.dismiss(true)}render(){return t(s,{key:"9fa834f67b3f58c27d077d943bec6e4c301e3118"},this.selectedCourse&&this.selectedCourse.photoURL?t("ion-header",null,t("app-item-cover",{item:this.selectedCourse})):undefined,this.selectedCourse?t("ion-header",null,t("ion-toolbar",{color:"divingclass"},t("ion-title",null,this.divingClass.name))):undefined,t("app-header-segment-toolbar",{key:"8657e8a5b0db2276ba1e3679107a4277607423e3",color:"divingclass",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"56a2d7c8fe021dc642672d0ce207da45dfd17de2",class:"slides"},t("swiper-container",{key:"7ae4909cabf3c486aba4dfeb282344c498a4157e",class:"slider-dive-class swiper"},t("swiper-wrapper",{key:"d2859a8d5877438bd72e1efde0ff5a045d533ab0",class:"swiper-wrapper"},t("swiper-slide",{key:"2066c08491cb7b6ee86018854fec7c0ceb6eb0f5",class:"swiper-slide"},t("ion-list",{key:"2f77b0eb1a8bf6e164b3fa5a551f1cb8bc94ca85"},t("ion-item",{key:"a6631b46199582350a932f7e5ea2e6dd9e8c07b8"},t("ion-label",{key:"f0b032401eaef2ce8178690373f202538002bb7e"},t("my-transl",{key:"01d1823069a5e47c667733af746f7fccce95c8a2",tag:"diving-course",text:"Diving Course"})),t("ion-select",{key:"e5f93f264c5049be258ea71e146dd1c374f32ffe",id:"dive-course-select",interface:"action-sheet",onIonChange:e=>this.changeCourse(e.detail.value),onIonFocus:()=>this.selectGotFocus=true,placeholder:a.getTransl("select","Select"),value:this.selectedCourse})),t("app-form-item",{key:"aa051c4e094ee06c9ccea4423fc331b1625b464f","label-tag":"name","label-text":"Name",value:this.divingClass.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-item",{key:"c67a456574dace0c03b6a657426b02c6e419f29f"},t("ion-label",{key:"2342ccf1fe3e784ec21dbf56b48d9e117e118518"},t("my-transl",{key:"706eeacdb1cb06be493967122305938bda8bced7",tag:"number-of-students",text:"Number of Students"})),t("ion-select",{key:"0db18269e83966e53cb81b821ab5506100eb53f4",value:this.divingClass.numberOfStudents,onIonChange:e=>this.updateStudents(e.detail.value),interface:"popover"},t("ion-select-option",{key:"b950b14392886b416210a8b335a2f6da26a106c1",value:1},"1"),t("ion-select-option",{key:"cdd94f99f2017c641aea65003ec3040801cc69bf",value:2},"2"),t("ion-select-option",{key:"70d4ef44e40dcd60ee92283932043ba620200e84",value:3},"3"),t("ion-select-option",{key:"2d6d5bc5e3517c3034d29356a3662a460f88aacb",value:4},"4"),t("ion-select-option",{key:"ba61c7e7be51c4df45f3a0fd3992e46da8828d93",value:5},"5"),t("ion-select-option",{key:"2d1ccc24486be5fd7aebd0a7b3b78a8ba7e15f8c",value:6},"6"),t("ion-select-option",{key:"48b52789d6aeb951463fcdb36f0d31946917b0e6",value:7},"7"),t("ion-select-option",{key:"6ca0f774f86dffa12f53cc17e17e8446a2b43706",value:8},"8"),t("ion-select-option",{key:"d7d28546bd546ce93ac107206ca41c59978c6450",value:9},"9"),t("ion-select-option",{key:"d9d9eea8993127846dfb818c67499f0194596e26",value:10},"10"),t("ion-select-option",{key:"0e5ffc6d195e25357eabf16526074f55c07c7cac",value:11},"11"),t("ion-select-option",{key:"739f91e4db7f744766d7c7c8b9eaaabe9de5ea46",value:12},"12"),t("ion-select-option",{key:"efb60c4f4cc53216fa78355d38ff71daf3c21d31",value:13},"13"),t("ion-select-option",{key:"275911f5ed2b1395e54e81ae6a842eabfc29872c",value:14},"14"),t("ion-select-option",{key:"afab4c1ce3c7a3d15cafd68583f34bacd6f89ba3",value:15},"15"))),t("app-form-item",{key:"5eb317fb8a8d451f5f541b8b60bcb2b64883a270","label-tag":"location","label-text":"Location",value:this.addressText,name:"location","input-type":"text",onFormItemChanged:e=>this.addressText=e.detail.value,onFormLocationSelected:e=>this.selectLocation(e.detail),validator:["address"]}),t("ion-item",{key:"64df2e07d54c1fe9a036c709bc42e1d90d2db478"},t("ion-label",{key:"3b3c6b7342574df8bb0affa2afec6acd8a0f30fd"},t("my-transl",{key:"87bf8c8b28b63a3bdf5db06f9a2387aada20b4cc",tag:"status",text:"Status"})),t("ion-select",{key:"2ef8d3198b49491ba16260cd06fe3ddea808cf97",value:this.divingClass.status,onIonChange:e=>this.updateStatus(e.detail.value),interface:"popover"},t("ion-select-option",{key:"84d86aa92cb64a1010a2ca13e9182d8c1b70ba7a",value:"active"},this.statusTitles.active),t("ion-select-option",{key:"650703d9e12f147a188f66b21b6e5453598d50cc",value:"closed"},this.statusTitles.closed),t("ion-select-option",{key:"5f590de3e0be98efe22f8ba997ca6ca31a5c5e9f",value:"cancelled"},this.statusTitles.cancelled))),t("app-form-item",{key:"bb67cc2bd40a124a7548b0b3de308f173d356b5e","label-tag":"comments","label-text":"Comments",value:this.divingClass.comments,name:"comments","input-type":"text",textRows:4,onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"dabba283a7bcbfaa08e0ebda8cb03fdea7f00c4f",class:"swiper-slide"},t("app-diving-class-schedule",{key:"b853b569a0c7eab624534a2ce625a8db81b404a1",divingClass:this.divingClass,editable:true,onScheduleEmit:()=>this.validateClass()})),t("swiper-slide",{key:"30acf03dd56e334327ea72562bd2d655589442dd",class:"swiper-slide"},t("app-users-list",{key:"865b61cc02008151d1ccf028bba8667ad1ea55ba",item:this.divingClass,editable:true,show:["owner","divemaster","instructor"]})),t("swiper-slide",{key:"64740f6c97fe04062053b71ba2f98d053eb80d0a",class:"swiper-slide"},t("app-dive-class-bookings",{key:"2f0249004ad8cfa5fe54b1a7de4b8d1bc982aeb4",divingClass:this.divingClass,divingClassId:this.divingClassId,editable:true}))))),t("app-modal-footer",{key:"b4a86d7b4cf7f0cc4f97c4924ef72e28fefeff01",disableSave:!this.validClass,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=m;export{v as modal_diving_class_update};