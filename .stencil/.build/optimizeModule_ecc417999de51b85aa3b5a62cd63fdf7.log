import{r as e,h as t,f as i}from"./p-cbe60c68.js";import{aS as a,U as o,T as s,aI as n,a5 as r}from"./p-30358c9d.js";import{l as c}from"./p-1af05547.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const l="popover-tank .scrollx{display:flex;flex-wrap:nowrap;overflow-x:auto}popover-tank .scrollx .item{flex:0 0 0 0}popover-tank .scrollx ::-webkit-scrollbar{display:none}popover-tank .notification{min-height:20px;height:20px;font-size:0.8em;color:#ea6153;border-width:1px;border-color:#ea6153;padding-left:10px}popover-tank .notification .item-inner{margin-left:0px !important;border-bottom:0px !important}popover-tank .notification .icon{font-size:1.7em;padding-left:6px !important;padding-top:4px !important}";const d=l;const p=class{constructor(t){e(this,t);this.hasTrimixlicence=false;this.hasReblicence=false;this.ccr=false;this.stdGasesList=undefined;this.parameters=undefined;this.tank=undefined;this.decoTanks=undefined;this.form=undefined;this.tanksList=undefined}componentWillLoad(){if(!this.tank){let e=new a;e.setForDeco(this.decoTanks);this.tank=e.getTank()}this.selectedTank=c.exports.find(this.tanksList,{name:this.tank.name});if(!this.selectedTank)this.selectedTank=c.exports.find(this.tanksList,{name:this.tank.name.toUpperCase()});let e=this.tank.gas;if(e.fO2){this.tank.gas=e}this.setForm();this.updateStdGasList()}componentDidLoad(){this.scrollGas=this.el.querySelector("#scrollTankGas");this.updateStdGasList();this.popover=this.el.closest("ion-popover");this.setForm()}async setForm(){this.form=this.tank.getForm();this.hasTrimixlicence=await o.checkLicence("trimix");this.hasReblicence=await o.checkLicence("reb")}updateStdGasList(){this.stdGases=[];let e=false;let t=0,i=0;this.stdGasesList.forEach((a=>{t++;let o=this.tank.gas.O2===a.O2&&this.tank.gas.He===a.He?true:false;if(o){e=true;i=t}this.stdGases.push({selected:o,gas:a.getGas()})}));if(e&&this.scrollGas){setTimeout((()=>{let e=this.scrollGas.scrollWidth;let a=this.scrollGas.clientWidth;let o=t/(e/a);i=i-o;i=i<0?0:i;this.scrollGas.scrollLeft=e*i/t*1.15}))}}selectStdGas(e){if(!this.hasTrimixlicence&&e.He>0){o.checkLicence("trimix",true);return}this.tank.gas=e;this.setForm();this.updateStdGasList()}updateTank(){this.tank.setPressure(c.exports.toNumber(this.form.pressure));this.tank.gas.updateGas(c.exports.toNumber(this.form.O2)/100,c.exports.toNumber(this.form.He)/100,c.exports.toNumber(this.form.fromDepth));this.updateStdGasList()}save(){this.tank.setTankType(this.selectedTank);this.popover.dismiss(this.tank)}close(){this.popover.dismiss()}inputHandler(e){this.form[e.detail.name]=e.detail.value}blurHandler(){this.updateTank();this.setForm()}selectTank(e){this.selectedTank=e.detail.value}render(){return[t("ion-list",{key:"44fd24649add7e2eb9b0c29dcb30dfcb8cd4350b",style:{marginBottom:"0"}},t("ion-grid",{key:"7337b5c77f26c8ee02e454899f9dc28db6e922e1",class:"ion-no-padding"},t("ion-row",{key:"c6772812974f7413b1a092dc87e0fd359d634f32"},t("ion-col",{key:"aac235fcb8fe8bbcd7f9f62de0a223cd761a9526"},t("ion-item",{key:"27e8ae674cc6847e52f21e76bc1efe24ecc51eb4"},t("ion-select",{key:"5cc6b71d987c52fb330905759fa1783293cda770",label:s.getTransl("tank","Tank"),onIonChange:e=>this.selectTank(e),value:this.selectedTank},this.tanksList.map((e=>t("ion-select-option",{value:e},e.name))))))),t("ion-row",{key:"805c2423572cbbc5fa5474b46e3f64b7946679a5"},t("ion-col",{key:"4ba8f6c5fd7aa95ea7cd11e3f41bcacf66a8f4e0"},t("app-form-item",{key:"2c8dcc4837bc53c0131767aa7b60a2ad0f30ef3f","label-tag":"pressure","label-text":"Pressure",value:this.form.pressure,name:"pressure","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),onFormItemBlur:()=>this.blurHandler(),validator:["required"]}))),t("ion-row",{key:"423bd1a1526f7decacbb4116a594e1ab866c2b3e"},t("ion-col",{key:"98f213df4589a08ddc7984b382e5c77c32d4a887"},t("app-form-item",{key:"fd6d41238d8d7ee031069407049c7bdfdbc6666c","label-text":"O2",value:this.form.O2,name:"O2","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),onFormItemBlur:()=>this.blurHandler(),validator:["required",{name:"minmaxvalue",options:{min:1,max:100-this.form.He}}]})),t("ion-col",{key:"8e8cdce27fa8f2aeb0d97aa8aebee2793263113e"},this.hasTrimixlicence?t("app-form-item",{"label-text":"He",value:this.form.He,name:"He","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),onFormItemBlur:()=>this.blurHandler(),validator:["required",{name:"minmaxvalue",options:{min:0,max:100-this.form.O2}}]}):t("ion-item",{onClick:()=>o.checkLicence("trimix",true)},t("ion-label",null,"He"),this.form.He))),t("ion-row",{key:"2dc84405cc03693bea928a0e9517d127421a9690"},t("ion-col",{key:"0aef4fb4846af282250add4efdc79675778ca025"},t("app-form-item",{key:"a820b7a7840211bd5ff9e0c49035cec96158e315","label-tag":"depth","label-text":"Depth",value:this.form.fromDepth,name:"fromDepth","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),onFormItemBlur:()=>this.blurHandler(),validator:["required"]})),this.ccr?t("ion-col",null,this.hasReblicence?t("app-form-item",{"label-tag":"pO2-setpoint","label-text":"pO2 setPoint",value:this.form.ppO2,name:"ppO2","input-type":"number",onFormItemChanged:e=>this.inputHandler(e),onFormItemBlur:()=>this.blurHandler(),validator:[{name:"minmaxvalue",options:{min:.5,max:1.6}}]}):t("app-form-item",{"label-tag":"pO2-setpoint","label-text":"pO2 setPoint",value:this.form.ppO2,onClick:()=>o.checkLicence("reb",true)})):undefined),t("ion-row",{key:"16fbb75c107a3dc1d4fbca5af3e4be678d3f4ff8",class:"scrollx",id:"scrollTankGas"},this.stdGases.map((e=>t("ion-col",{class:"item"},t("ion-button",{shape:"round",color:e.selected?"secondary":"primary",onClick:()=>this.selectStdGas(e.gas)},n.getGasName(e.gas)))))),t("ion-row",{key:"0da52ac7d86407d45077037b77eaee0f185537ea"},t("ion-col",{key:"ac436e47f7273c2c50c0a6c024cd2098dff81f06"},t("div",{key:"e92bbf0acbc82dd4991f85670ed8c6145f3a1eea",class:"notification",style:{color:"blue"}},"MOD: ",this.tank.gas.getMod(),r.depthUnit," @ ",this.tank.gas.ppO2," pO2"),t("div",{key:"cd3b6d3cf9a8715457fe8c7bc36424e635f8ffaf",class:"notification",style:{color:"blue"}},"pO2: ",this.tank.gas.getpO2atDepth(this.tank.gas.fromDepth,2)," ","pO2 @ ",this.tank.gas.fromDepth,r.depthUnit))))),t("app-modal-footer",{key:"edf7cf9ae53d56bee0b3b1a4620351b3867cca73",onCancelEmit:()=>this.close(),onSaveEmit:()=>this.save()})]}get el(){return i(this)}};p.style=d;export{p as popover_tank};