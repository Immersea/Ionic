import{r as e,h as t,f as i}from"./p-cbe60c68.js";import{S as a,W as s,R as d,ai as n,E as l,aP as o}from"./p-773bd3de.js";import{S as c}from"./p-a75993af.js";import{T as b}from"./p-1d025719.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-1af05547.js";import"./p-e9c4f463.js";import"./p-c2915cc5.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const r="page-customer-details{}";const p=r;const f=class{constructor(t){e(this,t);this.markers=[];this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"locations",text:"Locations",disabled:false},{tag:"operating-conditions",text:"Operating Conditions",disabled:false},{tag:"map",text:"Map",disabled:false}];this.itemId=undefined;this.customer=undefined;this.locationTypeSegment=0;this.slider=undefined}async componentWillLoad(){await this.loadCustomer()}async loadCustomer(){await a.presentLoading("loading");try{this.customer=await s.getCustomer(this.itemId);a.dismissLoading();this.markers=[];if(this.customer.locations.length>0){this.customer.locations.forEach((e=>{if(e.position&&e.position.geopoint){const t={latitude:e.position.geopoint.latitude,longitude:e.position.geopoint.longitude,icon:{type:"ionicon",name:"location",color:"secondary",size:"large"}};this.markers.push(t)}}));if(this.markers.length>0)this.loadMap();this.titles[1].disabled=this.customer.locations.length==0;this.titles[2].disabled=!(this.customer.conditions.EAF.length>0||this.customer.conditions.LF.length>0||this.customer.conditions.CCM.length>0);this.titles[3].disabled=this.customer.locations.length==0||this.markers.length==0}}catch(e){a.dismissLoading();d.goBack();a.presentAlertError(e)}}async componentDidLoad(){this.slider=new c(".slider-customer",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(this.markers.length>0)this.loadMap()}async loadMap(){await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");if(this.mapElement){const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+(n(this.customer)+20)+"px");setTimeout((()=>{this.mapElement.triggerMapResize();this.mapElement.fitToBounds(this.markers)}))}this.updateSlider()}async editCustomer(){const e=await s.presentCustomerUpdate(this.itemId);e.onDidDismiss().then((()=>this.loadCustomer()))}locationTypeSegmentChanged(e){this.locationTypeSegment=e.detail.value;this.updateSlider()}async openOperatingCondition(e,t){await d.openModal("modal-operating-conditions-questionnaire",{condition:e,conditionData:t,editable:false})}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}render(){return[this.customer.coverURL||this.customer.photoURL?t("ion-header",null,t("app-item-cover",{item:this.customer})):undefined,t("ion-header",{key:"2c77ec1359b0b26373412723f095b943401ec521"},t("app-navbar",{key:"9d7adb44c9216e5c51aeddf7716d02f1648135df",text:this.customer.fullName,color:"trasteel",backButton:this.customer&&!this.customer.coverURL&&!this.customer.photoURL,rightButtonText:b.isCustomerDBAdmin()?{icon:"create",fill:"outline",tag:"edit",text:"Edit"}:null,rightButtonFc:()=>this.editCustomer()})),t("app-header-segment-toolbar",{key:"afe9cc971b265be588cdb507a5ab9b95f4489d89",color:l.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"6d99fb2b603777ce0db2a5150dba03f4aff4f317",class:"slides"},t("ion-fab",{key:"5e696ddf709429b973f4d42907cca543d1fd15d8",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:o(2)}},t("ion-fab-button",{key:"d099310d87018c6872b4dbd442c57cce5116bb5a",onClick:()=>d.goBack(),class:"fab-icon"},t("ion-icon",{key:"f330266bd931e14f0987bc2bbb3358106ef0b8d9",name:"arrow-back-circle-outline"}))),t("swiper-container",{key:"1423b90217b3e9d1bb42d737a0d4c0cbb62fe3d9",class:"slider-customer swiper"},t("swiper-wrapper",{key:"d63d53d795bf640fce0de1a209179b8415c50a36",class:"swiper-wrapper"},t("swiper-slide",{key:"e8d844272202e6fddf33c13aae9188ae57e6e84d",class:"swiper-slide"},t("ion-list",{key:"d8a36e0dbb0c99dc8c3ebdc76ed179c882c115e1",class:"ion-no-padding"},t("app-item-detail",{key:"0dd0240aeceffeac96395f8117f7b5c5ed82fca7",lines:"none",labelTag:"plant_type",labelText:"Plant Type",detailText:s.getCustomerTypes(this.customer.typeId)[0].typeName}),t("app-item-detail",{key:"087fddd466de0e9949bf42a8b3a6aed76468faf5",lines:"none",labelTag:"name",labelText:"Name",detailText:this.customer.fullName}),t("app-item-detail",{key:"fa6fbd860588b662997934957d9ca35deb5680c5",lines:"none",labelTag:"local_name",labelText:"Local Name",detailText:this.customer.fullNameOther}),t("app-item-detail",{key:"8fb924da0b1d26dd58b4070481c005e0f04d9860",lines:"none",labelTag:"other_name",labelText:"Other Name",detailText:this.customer.otherPlantName}),t("app-item-detail",{key:"4a47023a27db13b80efeac875d441474faf83fca",lines:"none",labelTag:"other_name",labelText:"Other Local Name",detailText:this.customer.otherPlantNameOther}),t("app-item-detail",{key:"259d7d1dc33be17302d72d34fb8747a64e3d9f7d",lines:"none",labelTag:"short_name",labelText:"Short Name",detailText:this.customer.shortName}),this.customer.group.map(((e,i)=>t("app-item-detail",{lines:"none",labelTag:i==0?"group":null,labelText:i==0?"Group":null,detailText:e.groupName+" ["+e.groupOwnershipPerc+"%]"}))),t("app-item-detail",{key:"b668fbdbb28ec4d7aab8f5d6aa83906006236dce",lines:"none",labelTag:"owner",labelText:"Owner",detailText:this.customer.owner.groupName}),t("app-customer-plant-production",{key:"55bc0efa3bc95cdf6f63604edeec793502e634b3",customer:this.customer}))),t("swiper-slide",{key:"932b51a365c5ce5d3b85257518c9601ff62fb0c9",class:"swiper-slide"},t("div",{key:"decfc7f73928edb33e4837934a855149e8500696"},this.customer.locations.length>0?[t("ion-toolbar",null,t("ion-segment",{mode:"ios",scrollable:true,onIonChange:e=>this.locationTypeSegmentChanged(e),value:this.locationTypeSegment},this.customer.locations.map(((e,i)=>t("ion-segment-button",{value:i,layout:"icon-start"},t("ion-label",null,s.getLocationsTypes(e.type)[0].locationName)))))),this.customer.locations.map(((e,i)=>t("div",null,this.locationTypeSegment==i?t("div",null,t("app-location",{locations:s.getLocationsTypes(),location:e,slider:this.slider,editable:false})):undefined)))]:undefined)),t("swiper-slide",{key:"8668b7b3ee5bb54a725e364b45476ff40d4f2f3e",class:"swiper-slide"},t("ion-list",{key:"4db3c4055fc30500aede25b0f4effaa29c02d9d7"},t("ion-item-divider",{key:"64ca9b8d106034b0b4c6b082829c5865f464e7b7"},"EAF"),this.customer.conditions.EAF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"5142a7b9202c2976dc4557b95960f43b5087185e"},"LF"),this.customer.conditions.LF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"67901d181d2ac8343b7092a565ca405006e03339"},"CCM"),this.customer.conditions.CCM.map((e=>t("ion-item",null,t("ion-label",null,new Date(e.date).toLocaleDateString())))))),t("swiper-slide",{key:"dedb5703242e98a27db54ce3fde912a5023996ba",class:"swiper-slide"},this.customer.locations.length>0&&this.markers.length>0?t("div",{id:"map-container"},t("app-map",{id:"map",pageId:"customer-details",center:this.customer.locations[0],markers:this.markers})):t("div",null,t("ion-item",null,"NO MAP AVAILABLE"))))))]}get el(){return i(this)}};f.style=p;export{f as page_customer_details};