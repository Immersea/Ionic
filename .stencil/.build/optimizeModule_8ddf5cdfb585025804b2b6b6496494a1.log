import{r as e,h as t}from"./p-cbe60c68.js";import{S as i,E as s,n as a,T as o,o as l,R as n}from"./p-8f24d722.js";import"./p-c7ee7cfe.js";import{b as r}from"./p-5d4a8e1f.js";import{l as h}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const c="page-login{}page-login .apple{--background:black}page-login .facebook{--background:var(--facebook-color)}page-login .google{--background:var(--google-color)}page-login .validation-error{padding-left:18px;font-size:0.7rem;color:red}page-login .small{font-size:0.8rem;color:var(--ion-color-tint)}page-login .centered{align-items:center;justify-content:center;text-align:center}";const d=c;const p=class{constructor(t){e(this,t);this.newUserRegistration=false;this.email={name:"email",valid:false,value:""};this.emailpsw={name:"emailpsw",valid:false,value:""};this.psw={name:"psw",valid:false,value:""};this.retypepsw={name:"retypepsw",valid:true,value:""};this.passwordCheck=true;this.trasteelLogin=false;this.disablePswFields=false;this.disableEmailLinkFields=false;this.disableGoogle=false;this.disableFacebook=true;this.disableApple=false;this.network=false;this.scrollTop=0;this.checkingEmail=false}componentWillLoad(){i.getNetworkStatus().then((e=>{e.subscribe((e=>{this.network=e}))}));this.trasteelLogin=s.isTrasteel()}componentDidLoad(){i.dismissLoading()}async sendLink(){try{await a.sendEmailLink(this.email.value.trim());this.email.value="";this.showAlert(false)}catch(e){this.showAlert(e)}}async googleLogin(){try{await a.google()}catch(e){this.showAlert(e)}}async appleLogin(){const e=await r.create({header:o.getTransl("login","Login"),message:o.getTransl("apple-login-message","In order to login with the same Apple account also with other devices, it is necessary to share your original email address."),buttons:[{text:o.getTransl("ok","OK"),handler:async()=>{try{await a.apple()}catch(e){this.showAlert(e)}}},{text:o.getTransl("cancel","Cancel")}]});e.present()}async loginWithEmail(){try{await a.signInWithEmailPsw(this.email.valid?this.email.value.trim():this.emailpsw.value.trim(),this.psw.value);const e=await l.getLocalDocument("emailForSignIn");if(e){this.emailpsw.value="";this.psw.value="";this.showAlert(false)}else{a.dismissLoading()}}catch(e){this.showAlert(e)}}forgotPsw(){i.presentLoading("please-wait");const e=this.email.value?this.email.value:this.emailpsw.value;a.passwordReset(e).then((()=>{i.dismissLoading();this.showPswResetAlert("pswreset")})).catch((()=>{i.dismissLoading();this.showPswResetAlert("pswreseterror")}))}async showAlert(e){let t=o.getTransl("login","Login");let i=o.getTransl("login-error","There was an error in the login process. Please try again later.");let l=o.getTransl("registration-success-email","The registration/login has been completed! You will now receive a link in your email to complete the login process. If you don't receive the email within 1 minute please check in your spam folder.");if(e){s.log("registration/login error",[e]);switch(e.code){case"auth/popup-blocked":i=o.getTransl("popup-error","You should allow popup windows in the browser's preferences in order to complete the login process.");break;case"auth/account-exists-with-different-credential":if(e.email){this.emailpsw.value=e.email;this.checkEmail()}i=o.getTransl("popup-error-existing-account","You have already logged in with this email using another Sign-In method. Insert your email in the 'Email' field to check your exisiting method.");break;case"auth/missing-or-invalid-nonce":if(e.email){this.emailpsw.value=e.email;this.checkEmail()}i=o.getTransl("popup-error-duplicate-credential","Duplicate credential received. Please try again with a new credential.");break;default:i+=e.message?" ("+e.message+")":""}}const h=await r.create({header:t,message:e?i:l,buttons:[{text:o.getTransl("ok","OK"),handler:async()=>{n.push("/","root")}}]});a.dismissLoading();h.present()}async showPswResetAlert(e){let t=o.getTransl("login","Login");let i=o.getTransl("pswreset","You will receive shortly an email to reset your password. Please follow the instructions and then come back to the login page.");let s=o.getTransl("pswreseterror","There was an error in the reset process. Please try again later.");let l="";switch(e){case"pswreset":l=i;break;case"pswreseterror":l=s;break}const n=await r.create({header:t,message:l,buttons:[{text:o.getTransl("ok","OK")}]});a.dismissLoading();n.present()}inputHandler(e){this[e.detail.name]=e.detail;if(e.detail.name=="retypepsw"){this.checkRetypePassword()}else if(e.detail.name=="emailpsw"||e.detail.name=="email"){this.psw.value="";this.psw.valid=true;this.retypepsw.valid=true;this.retypepsw.value="";const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const i=h.exports.toLower(e.detail.value);this.email.value=h.exports.toLower(i);this.emailpsw.value=this.email.value;if(s.isTrasteel()&&e.detail.name=="email"){if(!this.email.value.includes("@trasteel.com")&&!this.email.value.includes("@trasteelnetwork.com")&&!this.email.value.includes("@o-range.tech")&&!this.email.value.includes("@ipermediastudio.it")||!t.test(this.email.value)){this.email.valid=false;this.emailpsw.valid=false}else{this.email.valid=true;this.emailpsw.valid=true}}else{if(t.test(this.email.value)){this.email.valid=true;this.emailpsw.valid=true}else{this.email.valid=false;this.emailpsw.valid=false}}this.checkEmail()}}async checkEmail(){if(!this.checkingEmail){this.checkingEmail=true;if(this.emailpsw.valid){await i.presentLoading("searching");const e=await a.fetchSignInMethodsForEmail(this.emailpsw.value);this.disablePswFields=false;this.disableEmailLinkFields=false;this.disableGoogle=false;this.disableFacebook=true;this.disableApple=false;if(e.length==0){this.newUserRegistration=true}else{this.newUserRegistration=false;this.disablePswFields=!e.includes("password");this.disableEmailLinkFields=!e.includes("emailLink");this.disableFacebook=true;//!methods.includes("facebook.com");
this.disableApple=!e.includes("apple.com");this.disableGoogle=!e.includes("google.com")}await i.dismissLoading()}else{this.newUserRegistration=false;this.disablePswFields=false;this.disableGoogle=false;this.disableFacebook=true;this.disableApple=false}if(this.newUserRegistration)this.checkRetypePassword();this.checkingEmail=false}}checkRetypePassword(){this.passwordCheck=this.psw.value==this.retypepsw.value}render(){return[t("app-navbar",{key:"32fd61a7c7de7134ac43b3ea21f394f6369259c8",color:s.getAppColor(),tag:"login",text:"Login"}),t("ion-content",{key:"77ed0340788a9b66b4f5c64dbb8e0581e8136ddb",scrollEvents:true,onIonScroll:e=>this.scrollTop=e.detail.scrollTop},s.isUdive()||s.isDecoplanner()?t("app-banner",{scrollTopValue:this.scrollTop,heightPx:250,link:"./assets/images/friendship2SM.jpg"}):undefined,t("ion-grid",{key:"3b72c357dd959656732407e754286d7a1d70d0a0"},!this.network?t("ion-row",null,t("ion-col",null,t("ion-item",{color:"danger"},t("ion-icon",{name:"warning",slot:"start"}),t("ion-label",null,t("my-transl",{tag:"no-network",text:"Network not available!"}))))):undefined,t("ion-row",{key:"2460ebd2d74d2be88f77ae1447b34d5114279382"},t("ion-col",{key:"1fd0573877b60907ca43f8982c844157022c2cd0"},this.trasteelLogin?[t("app-form-item",{"label-tag":"email","label-text":"Email",name:"email",lines:"full","input-type":"email",onFormItemChanged:e=>this.inputHandler(e),disabled:!this.network,debounce:500,validator:["required","email"]}),t("ion-text",{class:"ion-padding-start small"},"Only emails @trasteel.com or @trasteelnetwork.com are accepted."),!this.disableEmailLinkFields?[t("ion-button",{"margin-top":true,expand:"block",disabled:!this.email.valid||!this.network,onClick:()=>this.sendLink()},t("my-transl",{tag:"login-email",text:(this.newUserRegistration?"Register":"Login")+" with Email Link"})),!this.disablePswFields?[t("ion-item-divider",null),t("ion-item-divider",null,t("ion-label",null,t("p",{class:"centered"},"- or type password -")))]:undefined]:undefined]:t("app-form-item",{"label-tag":"email","label-text":"Email",name:"emailpsw",lines:"full","input-type":"email",onFormItemChanged:e=>this.inputHandler(e),disabled:!this.network,debounce:500,validator:["required","email"]}),!this.disablePswFields?[t("app-form-item",{"label-tag":"password","label-text":"Password",name:"psw",lines:"full","input-type":"password",onFormItemChanged:e=>this.inputHandler(e),disabled:!this.network,validator:["required"]}),this.newUserRegistration?t("app-form-item",{"label-tag":"retype-password","label-text":"Re-type Password",name:"retypepsw",lines:"full","input-type":"password",onFormItemChanged:e=>this.inputHandler(e),disabled:!this.network,validator:["required"]}):undefined,!this.passwordCheck?t("my-transl",{class:"validation-error",tag:"password-error",text:"Passwords are not the same"}):undefined,t("ion-button",{"margin-top":true,expand:"block",disabled:!this.emailpsw.valid||!this.psw.valid||!this.retypepsw.valid||!this.network||!this.passwordCheck,onClick:()=>this.loginWithEmail()},!this.emailpsw.valid&&!this.newUserRegistration?o.getTransl("login-emailpsw","Login/Register with Email and Password"):this.newUserRegistration?o.getTransl("register-emailpsw","Register with Email and Password"):o.getTransl("login-only-emailpsw","Login with Email and Password"))]:undefined)),!this.disablePswFields&&!this.newUserRegistration&&this.emailpsw.valid?t("ion-row",null,t("ion-col",{class:"ion-text-right"},t("a",{onClick:()=>this.forgotPsw()},t("my-transl",{tag:"forgot-psw",text:"Forgot password"})))):undefined,!this.trasteelLogin?[t("ion-row",null,t("ion-col",{class:"ion-text-center"},!this.disablePswFields&&!this.disableGoogle&&!this.disableFacebook&&!this.disableApple?t("p",null,"- or -"):undefined)),!this.disableGoogle?t("ion-row",null,t("ion-col",null,t("ion-button",{expand:"block",onClick:()=>this.googleLogin(),disabled:!this.network,class:"google"},t("ion-icon",{name:"logo-google",slot:"start"}),(this.newUserRegistration?"Register":"Login")+" with Google"))):undefined,!this.disableApple&&!i.isAndroid()?t("ion-row",null,t("ion-col",null,t("ion-button",{expand:"block",onClick:()=>this.appleLogin(),disabled:!this.network,class:"apple"},t("ion-icon",{name:"logo-apple",slot:"start"}),(this.newUserRegistration?"Register":"Login")+" with Apple"))):undefined]:undefined))]}};p.style=d;export{p as page_login};