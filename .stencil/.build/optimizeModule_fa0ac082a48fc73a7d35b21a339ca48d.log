import{r as e,h as i}from"./p-cbe60c68.js";import{S as t}from"./p-a75993af.js";import{U as a}from"./p-43ef96c1.js";import{U as s,a as n,b as l}from"./p-d2a582b5.js";import{U as o,E as d,W as c}from"./p-773bd3de.js";import{T as r}from"./p-1d025719.js";import{l as p}from"./p-1af05547.js";import"./p-c7ee7cfe.js";import"./p-c2915cc5.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const f="page-user-plans{}";const h=f;const b=class{constructor(i){e(this,i);this.titles=[{tag:"personal",text:"Personal",disabled:false},{tag:"team",text:"Team",disabled:false}];this.usersList=[];this.uid=undefined;this.userPlans=undefined;this.slider=undefined;this.usersTeams=undefined;this.selectedUser=undefined;this.updateView=false}async componentWillLoad(){await this.loadUserPlans()}async loadUserPlans(){if(this.uid){let e=new s(await a.getPlansOfUser(this.uid));this.userPlans=new s;this.userPlans.users=e.users;e.userPlans.map((e=>{const i=new n;i.customerId=e.customerId;i.otherName=e.otherName;i.planOfActions=[];e.planOfActions.map((e=>{if(e.product=="refractories"&&r.isRefraTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="electrodes"&&r.isElecTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="engineering"&&r.isEngTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="rawmaterials"&&r.isRawTeamAdmin()){i.planOfActions.push(e)}}));if(i.planOfActions.length>0){this.userPlans.userPlans.push(i)}}));this.selectedUser=await o.getPublicProfileUserDetails(this.uid);this.updateSlider()}else{this.userPlansSub=a.userPlans$.subscribe((e=>{this.userPlans=e;this.updateSlider()}));r.isTeamAdmin()?this.usersListSub=o.userPublicProfilesList$.subscribe((e=>{this.usersList=e;this.updateSlider()})):undefined}}disconnectedCallback(){if(this.uid);else{r.isTeamAdmin()?this.usersListSub.unsubscribe():undefined;this.userPlansSub.unsubscribe()}}async componentDidLoad(){this.slider=new t(".slider-plans"+this.uid,{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(!this.uid&&r.isTeamAdmin()){this.usersTeams=await r.getUsersTeams()}}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editPlan(e){const i=await a.presentUserPlansUpdate(this.uid,this.userPlans,e);i.onDidDismiss().then((()=>{if(this.uid)this.loadUserPlans()}))}renderTeam(){if(this.usersTeams&&this.usersTeams.usersTeams&&this.usersTeams.usersTeams.length>0){const e={};this.usersTeams.usersTeams.map((i=>{if(i.uid!==o.userProfile.uid){e[i.uid]=true}}));let t=[];Object.keys(e).map((e=>{t.push(this.usersList.find((i=>i.uid==e)))}));t=p.exports.orderBy(t,"displayName");return t.length>0?[t.map((e=>[i("ion-item",{button:true,onClick:()=>a.openUsersPlans(e.uid)},e.displayName+" - "+e.email)]))]:null}else return null}render(){return[i("ion-header",{key:"4d721b7c7d31a1048475b86f7c12b46ba47cb27e"},i("app-navbar",{key:"f3850bb0a930dc581cb0e71ceda6f2ddad833bcd",tag:this.uid==null?"plan-of-actions":null,text:this.uid==null?"Plan of Actions":"Plan of Actions - "+this.selectedUser.displayName,color:d.getAppColor(),backButton:this.uid!=null})),!this.uid&&r.isTeamAdmin()?i("app-header-segment-toolbar",{color:d.getAppColor(),swiper:this.slider,titles:this.titles}):undefined,i("ion-content",{key:"5767d6023ac6a1287c65fcddea2a9066e2a7f455",class:"slides"},i("ion-fab",{key:"5da6eae05cf4f8ba34461cbf36b288fb8156cae3",vertical:"top",horizontal:"end",slot:"fixed",edge:true},i("ion-fab-button",{key:"2442a49f8f94a5fdc4e26383f45438bb5e3f3a37",size:"small",onClick:()=>this.editPlan(),color:d.getAppColor()},i("ion-icon",{key:"787a863582d55ac917698f116778cef4f8ace196",name:"add"}))),i("swiper-container",{key:"1f872702c7db7201c5a7fd14b38eb598871ba97a",class:"slider-plans"+this.uid+" swiper"},i("swiper-wrapper",{key:"edb1023e36f3296912fafecd76bf6a7af328546a",class:"swiper-wrapper"},i("swiper-slide",{key:"e4b6669da0462f43273d8eefbcffdd092b5b5a1f",class:"swiper-slide"},i("div",{key:"ecd9374318f25a56dc4f4721ee0ddcb61ba3064b",class:"ion-padding-top"}),this.userPlans&&this.userPlans.userPlans&&this.userPlans.userPlans.length>0?this.userPlans.userPlans.map(((e,t)=>[i("ion-item",{button:true,onClick:()=>this.editPlan(t)},i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("ion-item-divider",{color:"trasteel"},e.customerId!=null?c.getCustomersDetails(e.customerId).fullName:e.otherName))),e.planOfActions.map((e=>[i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"product","label-text":"Product",detailText:l[e.product]})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"updated","label-text":"Updated",detailText:new Date(e.updated).toLocaleDateString()})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"due-date","label-text":"Due Date",detailText:new Date(e.dueDate).toLocaleDateString()}))),i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"actual-situation","label-text":"Actual Situation",detailText:e.situation})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"plan","label-text":"Plan",detailText:e.plan}))),i("ion-row",{class:"ion-no-padding"},i("ion-item-divider",null))]))))])):i("ion-item",null,i("ion-label",null,"Insert a new plan of actions"))),!this.uid&&r.isTeamAdmin()?i("swiper-slide",{class:"swiper-slide"},i("ion-list",null,this.renderTeam())):undefined)))]}};b.style=h;export{b as page_user_plans};