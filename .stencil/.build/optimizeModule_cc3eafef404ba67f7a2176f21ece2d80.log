import{r as t,h as e}from"./p-cbe60c68.js";import{U as i,T as a,n as s,S as n,z as o,E as r}from"./p-f42b650b.js";import"./p-c7ee7cfe.js";import{n as l,b as h}from"./p-c2915cc5.js";import{l as p}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const m="modal-user-update .cover-container{height:var(--coverHeight)}modal-user-update ion-thumbnail{position:relative;margin:-50px auto 0 auto;width:100px;height:100px}modal-user-update ion-thumbnail img{border-radius:50%;padding:0.08em;border:solid 0.25em lightsteelblue;background-color:white}modal-user-update ion-thumbnail ion-button{top:50%;left:50%;margin-right:-50%;transform:translate(-50%, -50%);position:absolute;color:#141414;font-size:24px}modal-user-update .cover{position:relative;background-color:lightblue;background-size:cover;background-position:center;background-repeat:no-repeat;box-shadow:0 4px 8px 0 rgba(0, 0, 0, 0.2);width:100%;height:var(--coverHeight)}modal-user-update .cover ion-button{bottom:5%;left:10%;margin-right:-50%;transform:translate(-50%, -50%);position:absolute;color:#141414;font-size:24px}";const d=m;const c=class{constructor(e){t(this,e);this.uploading=false;this.userProfile=undefined;this.userSettings=undefined;this.updateView=true;this.addressText=undefined;this.checkEmailPsw=false}componentWillLoad(){this.settingsSub=i.userSettings$.subscribe((t=>{if(t){this.userSettings=t;this.userSub=i.userProfile$.subscribe((t=>{if(t){this.userProfile=t;this.addressText=this.userProfile.address?this.userProfile.address.display_name:""}}))}}))}componentDidLoad(){if(!this.userProfile){i.initLocalUser()}this.checkEmailPswRegistration()}disconnectedCallback(){this.settingsSub.unsubscribe();this.userSub.unsubscribe()}async update(){this.userProfile.setDisplayName();await i.updateUserProfile(this.userProfile);await i.updateUserSettings(this.userSettings);return l.dismiss()}async cancel(){return l.dismiss()}changeLanguage(t){this.userSettings.setLanguage(t.detail);a.setLanguage(t.detail)}async changeUnits(t){this.userSettings.settings.units=t.detail.value;this.userSettings.userConfigurations=this.userSettings.userConfigurations.map((t=>{const e=t.parameters;e.setUnits(this.userSettings.settings.units);t.convertUnits(e);return t}));this.userSettings.localPlans=this.userSettings.localPlans.map((t=>{t.convertUnits(this.userSettings.settings.units);return t}))}inputHandler(t){if(t.detail.name=="facebook"||t.detail.name=="instagram"||t.detail.name=="twitter"||t.detail.name=="website"||t.detail.name=="email"){const e=p.exports.toLower(t.detail.value).split(" ").join("-");this.userProfile[t.detail.name]=e}else{this.userProfile[t.detail.name]=t.detail.value}this.updateView=!this.updateView}selectLocation(t){this.userProfile.address=t;this.addressText=t.display_name}updateImageUrls(t){const e=t.detail.type;const i=t.detail.url;if(e=="photo"){this.userProfile.photoURL=i}else{this.userProfile.coverURL=i}this.updateView=!this.updateView}async checkEmailPswRegistration(){const t=await s.fetchSignInMethodsForEmail(this.userProfile.email);if(t.includes("password")){this.checkEmailPsw=true}else{this.checkEmailPsw=false}}sendResetPsw(){n.presentLoading("please-wait");s.passwordReset(this.userProfile.email).then((()=>{n.dismissLoading();this.showAlert("pswreset")})).catch((()=>{n.dismissLoading();this.showAlert("pswreseterror")}))}async showAlert(t){let e=a.getTransl("login","Login");let i=a.getTransl("pswreset","You will receive shortly an email to reset your password. Please follow the instructions and then come back to the login page.");let n=a.getTransl("pswreseterror","There was an error in the reset process. Please try again later.");let o="";switch(t){case"pswreset":o=i;break;case"pswreseterror":o=n;break}const r=await h.create({header:e,message:o,buttons:[{text:a.getTransl("ok","OK"),handler:async()=>{}}]});s.dismissLoading();r.present()}render(){return[this.uploading?e("ion-progress-bar",{type:"indeterminate"}):undefined,this.userProfile&&this.userProfile.uid?[e("ion-header",null,e("div",{class:"cover-container"},e("app-upload-cover",{item:{collection:o,id:this.userProfile.uid,photoURL:this.userProfile.photoURL,coverURL:this.userProfile.coverURL},onCoverUploaded:t=>this.updateImageUrls(t)}))),e("ion-content",null,e("ion-list",null,e("app-form-item",{"label-tag":"name","label-text":"Name",value:this.userProfile.name,name:"name",lines:"inset","input-type":"text",onFormItemChanged:t=>this.inputHandler(t),validator:["required"]}),e("app-form-item",{"label-tag":"surname","label-text":"Surname",lines:"inset",value:this.userProfile.surname,name:"surname","input-type":"text",onFormItemChanged:t=>this.inputHandler(t),validator:["required"]}),!r.isTrasteel()?[e("app-form-item",{"label-tag":"address","label-text":"Address",value:this.addressText,name:"address",lines:"inset","input-type":"text",onFormItemChanged:t=>this.addressText=t.detail.value,onFormLocationSelected:t=>this.selectLocation(t.detail),validator:["address"]}),e("app-form-item",{"label-tag":"biography","label-text":"Biography",value:this.userProfile.bio,"text-rows":4,name:"bio",lines:"inset","input-type":"text",onFormItemChanged:t=>this.inputHandler(t),validator:[]}),e("app-form-item",{"label-tag":"phone","label-text":"Phone",value:this.userProfile.phoneNumber,name:"phoneNumber","input-type":"tel",lines:"inset",onFormItemChanged:t=>this.inputHandler(t),validator:[]}),e("app-form-item",{"label-tag":"email","label-text":"Email",value:this.userProfile.email,name:"email",lines:"inset","input-type":"email",onFormItemChanged:t=>this.inputHandler(t),validator:["email"]}),e("app-form-item",{"label-tag":"website","label-text":"Website",value:this.userProfile.website,name:"website",lines:"inset","input-type":"url",onFormItemChanged:t=>this.inputHandler(t),validator:[]}),this.userProfile.website?e("a",{class:"ion-padding-start",href:"http://"+this.userProfile.website,target:"_blank"},"http://"+this.userProfile.website):undefined,e("app-form-item",{"label-tag":"facebook-id","label-text":"Facebook ID",value:this.userProfile.facebook,name:"facebook",lines:"inset","input-type":"url",onFormItemChanged:t=>this.inputHandler(t),validator:[]}),this.userProfile.facebook?e("a",{class:"ion-padding-start",href:"https://www.facebook.com/"+this.userProfile.facebook,target:"_blank"},"https://www.facebook.com/"+this.userProfile.facebook):undefined,e("app-form-item",{"label-tag":"instagram-id","label-text":"Instagram ID",value:this.userProfile.instagram,name:"instagram",lines:"inset","input-type":"url",onFormItemChanged:t=>this.inputHandler(t),validator:[]}),this.userProfile.instagram?e("a",{class:"ion-padding-start",href:"https://www.instagram.com/"+this.userProfile.instagram,target:"_blank"},"https://www.instagram.com/"+this.userProfile.instagram):undefined,e("app-form-item",{"label-tag":"twitter id","label-text":"Twitter ID",value:this.userProfile.twitter,name:"twitter",lines:"inset","input-type":"url",onFormItemChanged:t=>this.inputHandler(t),validator:[]}),this.userProfile.twitter?e("a",{class:"ion-padding-start",href:"https://www.twitter.com/"+this.userProfile.twitter,target:"_blank"},"https://www.twitter.com/"+this.userProfile.twitter):undefined,e("ion-item",{lines:"inset"},e("ion-select",{label:a.getTransl("units","Units"),onIonChange:t=>this.changeUnits(t),value:this.userSettings.settings.units,interfaceOptions:{header:a.getTransl("units","Units"),message:a.getTransl("units-chnage-message","This will change the units for the whole app! Are you sure?"),buttons:[a.getTransl("OK","OK"),a.getTransl("cancel","Cancel")]}},e("ion-select-option",{value:"Metric"},"Metric"),e("ion-select-option",{value:"Imperial"},"Imperial")))]:undefined,e("app-language-picker",{picker:true,selectedLangCode:this.userSettings.getLanguage()?this.userSettings.getLanguage():undefined,onLanguageChanged:t=>this.changeLanguage(t)}),this.checkEmailPsw?e("ion-button",{color:r.getAppColor(),expand:"block",onClick:()=>{this.sendResetPsw()}},e("my-transl",{tag:"reset-psw",text:"Reset Password"})):undefined))]:undefined,e("app-modal-footer",{key:"4ea8d66389d183d872b1145711a6c165dc8fbc3b",onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.update()})]}};c.style=d;export{c as modal_user_update};