import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n}from"./p-c2915cc5.js";import{l as s}from"./p-1af05547.js";import{S as o}from"./p-a75993af.js";import{U as m,n as d,aD as l,aG as p,aN as b,R as r,k as h,S as c,E as f,T as u}from"./p-773bd3de.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const v="modal-shape-update ion-list{width:100%}";const x=v;const y=class{constructor(a){e(this,a);this.validShape=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"drawing",text:"Drawing",disabled:false}];this.shapeId=undefined;this.duplicateShape=undefined;this.shape=undefined;this.updateView=true;this.scrollTop=0;this.shapeTypes=undefined;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=m.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));await this.loadShape()}async loadShape(){this.shapeTypes=await l.getShapeTypes();if(this.shapeId){const e=await l.getShape(this.shapeId);this.shape=e}else{this.shape=new p(this.duplicateShape?this.duplicateShape.shape:null);if(this.duplicateShape){this.shape.shapeName="NEW - "+this.duplicateShape.shape.shapeName}this.shape.users={[m.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new o(".slider-edit-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,breakpoints:{768:{slidesPerView:1},992:{slidesPerView:2}}});if(this.shape.shapeName)this.validateShape();this.updateSlider()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){const a=e.detail.name;const t=e.detail.value;this.shape[a]=t;if((a=="A"||a=="B"||a=="H"||a=="L")&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0){this.shape.volume=this.shape.getVolume();this.shape.radius=this.shape.getInternalRadius()}this.validateShape()}validateShape(){this.validShape=s.exports.isString(this.shape.shapeTypeId)&&s.exports.isString(this.shape.shapeName)&&s.exports.isNumber(this.shape.A)&&s.exports.isNumber(this.shape.B)&&s.exports.isNumber(this.shape.H)&&s.exports.isNumber(this.shape.L)&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0;this.updateSlider()}async selectType(e){this.shape.shapeTypeId=e.detail.value;await l.setDwgForShape(this.shape);this.validateShape()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editDrawing(){if(!this.shape.dwg){this.shape.dwg=new b}this.shape.dwg.id=this.shapeId;this.shape.dwg.name=this.shape.shapeName;const e=await r.openPopover("popover-media-loading",{media:this.shape.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const a={[e.data.media.id]:e.data};const t=e.data.media;const i=await r.openPopover("popover-media-uploader",{files:a,itemId:this.shapeId,collectionId:h});i.onDidDismiss().then((e=>{if(e&&e.data){const a=e.data;this.shape.dwg=t;Object.keys(a).forEach((e=>{this.shape.dwg.url=a[e]}));this.save(false);this.updateSlider()}}))}}))}async deleteShape(){try{await l.deleteShape(this.shapeId);n.dismiss()}catch(e){if(e)c.presentAlertError(e)}}async save(e=true){const a=await l.updateShape(this.shapeId,this.shape,this.userProfile.uid);if(!this.shapeId){this.shapeId=a.id}e?n.dismiss():undefined}async cancel(){return n.dismiss()}render(){return a(t,{key:"46cabd3411900344d8bee39bedea3b6b82bbad1b"},a("app-header-segment-toolbar",{key:"a487c35d8e641fbf07f2eee20e38cfab48885927",color:f.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"ef79a61a55618219fda2b32bae8ffca890797b6a",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},a("swiper-container",{key:"ca9eb25b88f28a1b2767204db2e43c9ad558ddee",class:"slider-edit-shape swiper"},a("swiper-wrapper",{key:"bd46ab047b694842d71d38144bd648c6d3574f00",class:"swiper-wrapper"},a("swiper-slide",{key:"c3d6968905c6e18328daf11920552c84b27bef4c",class:"swiper-slide"},a("ion-list",{key:"65b8a417d7b55ba8bc34fd6d7e3f8f8e5cf87b14",class:"ion-no-padding"},this.shapeTypes?a("app-select-search",{color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.shape&&this.shape.shapeTypeId?this.shape.shapeTypeId:null,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"]}):undefined,a("app-form-item",{key:"a2ed9cf14c9b493c035594b8e6c592ce81055355",lines:"inset","label-tag":"name","label-text":"Name",value:this.shape.shapeName,name:"shapeName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"fcb6c3c40c9f561ef5cd915f463a7dd92d48813b",lines:"inset","label-tag":"shortName","label-text":"Short Name",value:this.shape.shapeShortName,name:"shapeShortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e)}),a("app-form-item",{key:"35623f2c979183de59b5f5b15eec8dddb741079a","label-text":"H",value:this.shape.H,appendText:" (mm)",name:"H","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"8c33bc1d943a32bb89b912422ef83bd652c377b2","label-text":"H1",value:this.shape.H1,appendText:" (mm)",name:"H1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"ca6bc3e808fc8e48e1adc2086c02658afeade273","label-text":"H2",value:this.shape.H2,appendText:" (mm)",name:"H2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"5e4a3c66e2406b65e5eccd26d005666071a88363","label-text":"L",value:this.shape.L,appendText:" (mm)",name:"L","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"79b2b459c7f0429c6d706b336e2979b03ac92bb9","label-text":"L1",appendText:" (mm)",value:this.shape.L1,name:"L1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"a7a176de62c04d8891498a3f9c8ab0454b9a9fb4","label-text":"La",appendText:" (mm)",value:this.shape.La,name:"La","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"5828e13b0c49bae53dff07ebaf1da31b47c89180","label-text":"Lb",appendText:" (mm)",value:this.shape.Lb,name:"Lb","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"db5677eb6f22c253b7ea9eb63006158437cd244d","label-text":"A",appendText:" (mm)",value:this.shape.A,name:"A","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"a829f8c9af855504cf5ab51578624944ec13a27a","label-text":"A1",appendText:" (mm)",value:this.shape.A1,name:"A1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"b3d167571fa43c30cfdd1a1aa34760045e7ab8a8","label-text":"B",appendText:" (mm)",value:this.shape.B,name:"B","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"bfc8fd55ef83c2d15d719b0d0714cfcbd7be6f07","label-text":"B1",appendText:" (mm)",value:this.shape.B1,name:"B1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"2fe467734210b5a0bd01de152dc991634852c654","label-text":"ANG",appendText:" (°)",value:this.shape.ANG,name:"ANG","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"4a3189ffa2a64c4a2080afc01d1dd180e607f2cc","label-text":"ANG1",appendText:" (°)",value:this.shape.ANG1,name:"ANG1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"b27f01db102cb13f259939d18334d221919b2bff","label-text":"D",appendText:" (mm)",value:this.shape.D,name:"D","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"bb853e15c1189058d85199977a13dd3ad470ae5e","label-text":"D1",appendText:" (mm)",value:this.shape.D1,name:"D1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"2a8c9dade24d135d061c3c140d58094e96fc3b43","label-text":"D2",appendText:" (mm)",value:this.shape.D2,name:"D2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"d77452fb670e8fef42cc32251fcaa56f9031c124","label-text":"D3",appendText:" (mm)",value:this.shape.D3,name:"D3","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"15c17c47ab1bc5766da5ded94cdf44103f52dcdb","label-text":"D4",appendText:" (mm)",value:this.shape.D4,name:"D4","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"68bb2efbec7ea20f1f9ba3a35b300232e6093cc7","label-text":"De",appendText:" (mm)",value:this.shape.De,name:"De","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"b5f5e08688011f17d43b393731f0f16a6c64ce40","label-text":"Di",appendText:" (mm)",value:this.shape.Di,name:"Di","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"85294bb9af46dd63599a6a5e8b52cf2529a0a8ea","label-text":"N",appendText:" (mm)",value:this.shape.N,name:"N","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"e4f34c21adaea157b7da396c1f40b2719b3ee75c","label-text":"Decimals",value:this.shape.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:0}}]}),a("app-form-item",{key:"b6c3805d1c4f067d4e0fb40de221db2163e424d8","label-text":"Radius",appendText:(this.shape.shapeTypeId=="su-brick"?" MIN":"")+" (mm)",value:this.shape.radius,name:"radius","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),this.shape.shapeTypeId=="su-brick"?a("app-form-item",{"label-text":"Radius",appendText:" MAX (mm)",value:this.shape.radius_max,name:"radius_max","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:this.shape.radius}}]}):undefined,a("app-form-item",{key:"0ea27cedca38c491f240ec9db55cd2004f0e5a22","label-text":"Volume",appendText:" (dm3)",value:this.shape.volume,name:"volume","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]})),this.shapeId?a("ion-footer",{class:"ion-no-border"},a("ion-toolbar",null,a("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteShape()},a("ion-icon",{slot:"start",name:"trash"}),a("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),a("swiper-slide",{key:"e9a25df11736dec67718f53680bd1f45904caede",class:"swiper-slide"},a("app-banner",{key:"b4561baf6e544c8e8574f1d2667dd99fd50f461c",scrollTopValue:this.scrollTop,backgroundCoverFill:false,heightPx:500,link:this.shape.dwg?this.shape.dwg.url:null}),a("ion-footer",{key:"6c50b8c4bce33dbc7c43989cd90af48dcee6e44f",class:"ion-no-border"},a("ion-toolbar",{key:"46b0df88be1f76aa0e6ac7dd1abde7549a54373d"},a("ion-button",{key:"7dbb858b69661bbf1116d7a2eb4a94dd081d2995",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeId,onClick:()=>this.editDrawing()},a("ion-icon",{key:"23928bd849700b93ffe7a66d15cc9d9dfca161da",slot:"start",name:"create"}),a("ion-label",{key:"658b2daec42de4cb85a7108e0747d59d22a090f5"},!this.shapeId?u.getTransl("media-loader-error","Please save the item to upload new media."):u.getTransl("edit_dwg","Edit Drawing"))))))))),a("app-modal-footer",{key:"db8b54099c7764e3e0f05ab3f2dbf648c2e25191",color:f.getAppColor(),disableSave:!this.validShape,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=x;export{y as modal_shape_update};