import{r as e,h as t,H as s,f as i}from"./p-cbe60c68.js";import{T as a,e as c,d,S as o,ad as n,ae as l,U as h}from"./p-30358c9d.js";import"./p-c7ee7cfe.js";import{b as f,o as b}from"./p-5d4a8e1f.js";import{l as r}from"./p-1af05547.js";import{S as p}from"./p-a75993af.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const u="modal-diving-class-update ion-list{width:100%}modal-diving-class-update app-diving-class-schedule{width:100%}modal-diving-class-update ion-segment-button{--color-checked:var(--ion-color-divingclass-contrast)}";const m=u;const v=class{constructor(t){e(this,t);this.divingClassId=undefined;this.collectionId=undefined;this.organiserId=undefined;this.divingClass=undefined;this.updateView=true;this.validClass=false;this.selectedCourse=undefined;this.addressText=undefined;this.titles=[{tag:"details"},{tag:"schedule"},{tag:"team"},{tag:"students"}];this.slider=undefined;this.selectGotFocus=false}async componentWillLoad(){await this.loadDivingClass();this.statusTitles={active:a.getTransl("active","Active"),closed:a.getTransl("closed","Closed"),cancelled:a.getTransl("cancelled","Cancelled")};this.placeholder=a.getTransl("insert-title","Insert title");if(this.organiserId==c.selectedDivingSchoolId){this.divingSchool=c.selectedDivingSchool}else if(this.collectionId==d){this.divingSchool=await c.getDivingSchool(this.organiserId)}this.divingAgencies=o.systemPreferences.divingAgencies;this.divingCourses=await o.getDivingCoursesForSchool(this.divingSchool);if(this.divingClass&&this.divingClass.course){this.selectedCourse=this.divingCourses.find((e=>e.agencyId===this.divingClass.course.agencyId&&e.id===this.divingClass.course.certificationId))}}async loadDivingClass(){if(this.divingClassId){this.divingClass=await n.getDivingClass(this.divingClassId);this.collectionId=this.divingClass.organiser.collectionId;this.organiserId=this.divingClass.organiser.id}else{this.divingClass=new l;this.divingClass.organiser={collectionId:this.collectionId,id:this.organiserId};this.divingClass.users={[h.userRoles.uid]:["owner","instructor"]}}this.addressText=this.divingClass.location&&this.divingClass.location.display_name?this.divingClass.location.display_name:null}async componentDidLoad(){this.slider=new p(".slider-dive-class",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.appBookings=this.el.getElementsByTagName("app-dive-class-bookings")[0];this.appSchedule=this.el.getElementsByTagName("app-diving-class-schedule")[0];this.createCourseSelectOptions();this.validateClass()}createCourseSelectOptions(){this.selectCourseElement=this.el.querySelector("#dive-course-select");const e={header:a.getTransl("diving-course","Diving Course")};const t=Array.from(this.selectCourseElement.getElementsByTagName("ion-select-option"));t.map((e=>{this.selectCourseElement.removeChild(e)}));this.selectCourseElement.interfaceOptions=e;r.exports.each(this.divingCourses,(e=>{const t=document.createElement("ion-select-option");t.value=e;t.textContent=this.divingAgencies[e.agencyId].name+" - "+e.name;this.selectCourseElement.appendChild(t)}))}async changeCourse(e){if(this.selectGotFocus&&this.divingClass&&this.divingClass.activities&&this.divingClass.activities.length>0){const t=await f.create({header:a.getTransl("diving-course","Diving Course"),message:a.getTransl("update-class-activities","This will update all class activities! Are you sure?"),buttons:[{text:a.getTransl("ok","OK"),handler:()=>{this.selectGotFocus=false;this.updateCourseDetails(e)}},{text:a.getTransl("cancel","Cancel"),handler:()=>{this.selectGotFocus=false;this.createCourseSelectOptions();this.selectedCourse=Object.assign({},this.selectedCourse)},role:"cancel",cssClass:"secondary"}]});t.present()}else{this.updateCourseDetails(e)}}updateCourseDetails(e){this.selectedCourse=e;this.divingClass.name=this.divingAgencies[this.selectedCourse.agencyId].name+" - "+this.selectedCourse.name;this.divingClass.activities=r.exports.cloneDeep(e.activities);this.divingClass.numberOfStudents=e.numberOfStudents;this.divingClass.course={certificationId:e.id,agencyId:e.agencyId};this.appBookings.updateStudentsList();this.appSchedule.updateClassSchedule();this.validateClass()}selectLocation(e){this.divingClass.location=e;this.addressText=e.display_name;this.validateClass()}updateStudents(e){this.divingClass.numberOfStudents=r.exports.toNumber(e);this.appBookings.updateStudentsList();this.validateClass()}updateStatus(e){this.divingClass.status=e;this.validateClass()}handleChange(e){this.divingClass[e.detail.name]=e.detail.value;this.validateClass()}validateClass(){this.validClass=r.exports.isString(this.divingClass.name)&&this.divingClass.numberOfStudents>0&&this.divingClass.location&&r.exports.isString(this.divingClass.location.display_name)&&r.exports.isString(this.divingClass.status)&&Object.keys(this.divingClass.schedule).length>0;this.updateView=!this.updateView}async save(){await n.updateDivingClass(this.divingClassId,this.divingClass);return b.dismiss(false)}async cancel(){return b.dismiss(true)}render(){return t(s,{key:"5f513335b42e362f489ff71036b5ee9f6b9b62e7"},this.selectedCourse&&this.selectedCourse.photoURL?t("ion-header",null,t("app-item-cover",{item:this.selectedCourse})):undefined,this.selectedCourse?t("ion-header",null,t("ion-toolbar",{color:"divingclass"},t("ion-title",null,this.divingClass.name))):undefined,t("app-header-segment-toolbar",{key:"3d0ffbdca83398df71462b02753968204f8ac277",color:"divingclass",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"71a51c58d491130de2ba05cc329f88ed9f338293",class:"slides"},t("swiper-container",{key:"4d2b269013a8ee4cfe12ba637c1feaf8deac9e53",class:"slider-dive-class swiper"},t("swiper-wrapper",{key:"915c9e67148530a308f7b440fec17d3fd8de4d08",class:"swiper-wrapper"},t("swiper-slide",{key:"1875231bf8e95c19529f4b19529965d929447620",class:"swiper-slide"},t("ion-list",{key:"29a1e0ac6222c343a8cbbcbf0c66bf2772c0897f"},t("ion-item",{key:"3771eb83c1a1a0bf9c1a3e6e31203cb446506cbd"},t("ion-label",{key:"fa2aabd166e129fc71a8f00fcce33b9ad4250e69"},t("my-transl",{key:"95afe246da9925bb8265ff64b573ec2fb16eed59",tag:"diving-course",text:"Diving Course"})),t("ion-select",{key:"47ec103a4d5d64dcf99627e6fbdb5506ebf9cd1e",id:"dive-course-select",interface:"action-sheet",onIonChange:e=>this.changeCourse(e.detail.value),onIonFocus:()=>this.selectGotFocus=true,placeholder:a.getTransl("select","Select"),value:this.selectedCourse})),t("app-form-item",{key:"95fa51265111a3a5360e566d7ea4f3752f077cc4","label-tag":"name","label-text":"Name",value:this.divingClass.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-item",{key:"c795045aebf8f11799876b30d824de7192e145a4"},t("ion-label",{key:"052b3eb4dbd615fda59431675320107e7c16f1ea"},t("my-transl",{key:"f711dc50cd0189ea50ab10120ca5bfc2a9b78bde",tag:"number-of-students",text:"Number of Students"})),t("ion-select",{key:"000578eb80a1e91ef2fec3f7845fe8edade1761d",value:this.divingClass.numberOfStudents,onIonChange:e=>this.updateStudents(e.detail.value),interface:"popover"},t("ion-select-option",{key:"2f89d0da7e570d114dc157ee4573a6231149eb9a",value:1},"1"),t("ion-select-option",{key:"a2034080dedb24478d0266c79b07e8038ab22dde",value:2},"2"),t("ion-select-option",{key:"8f68bb0a1044b06a94ed6ea82a27b66e4f85e4f7",value:3},"3"),t("ion-select-option",{key:"be295042c36bea46adbfbed91a741eb33f494cd3",value:4},"4"),t("ion-select-option",{key:"080cb5bf822bb47a693abd62506ca6eec3adc470",value:5},"5"),t("ion-select-option",{key:"464693b43f0cbd044ac26d42fc3ce1dfc11c184c",value:6},"6"),t("ion-select-option",{key:"e8bf32ef81e7d5ba78783ffd26f0fba8e1cbf66b",value:7},"7"),t("ion-select-option",{key:"6e0e06d8e0f713494004a0e64b6ffd53b2df50c8",value:8},"8"),t("ion-select-option",{key:"16abed19ceb483eb48635d236b72f7d7474fc32c",value:9},"9"),t("ion-select-option",{key:"c1fcb6f30baeab921e81b7e89b126dc3eebd3f22",value:10},"10"),t("ion-select-option",{key:"c587dd13a96daba7e12845d79239d7f800451772",value:11},"11"),t("ion-select-option",{key:"ebc39c52ffe9931830b1342d9b10725b041d8611",value:12},"12"),t("ion-select-option",{key:"c1433e9b998d04db10bbaa88fe83a9e5abf90265",value:13},"13"),t("ion-select-option",{key:"22c8ec180ecb128573a50fb873218bac9ac495ad",value:14},"14"),t("ion-select-option",{key:"3681e2240a529cb1a934dd853394f6ad9b996e95",value:15},"15"))),t("app-form-item",{key:"0921ca73d265d37cfab32c852c611f7d20070088","label-tag":"location","label-text":"Location",value:this.addressText,name:"location","input-type":"text",onFormItemChanged:e=>this.addressText=e.detail.value,onFormLocationSelected:e=>this.selectLocation(e.detail),validator:["address"]}),t("ion-item",{key:"e2f0074c789a41acea7366d56b76bb36b310b98d"},t("ion-label",{key:"833c2fa1eed651127b0542c23b0dc9a67500f176"},t("my-transl",{key:"77d75536f939ba6fad64ebab5cccfcf1117cf6c0",tag:"status",text:"Status"})),t("ion-select",{key:"f39fd602c23722a255d3f5982d1b1b4960bc95f7",value:this.divingClass.status,onIonChange:e=>this.updateStatus(e.detail.value),interface:"popover"},t("ion-select-option",{key:"b99a3e80b5d72d2eee6fef072396cbb106ad9a12",value:"active"},this.statusTitles.active),t("ion-select-option",{key:"8c1ca532ee7fb8e5cbdbb406f7dff9781dfbe52d",value:"closed"},this.statusTitles.closed),t("ion-select-option",{key:"e5c9953c0549bb7376da315337661c757213783f",value:"cancelled"},this.statusTitles.cancelled))),t("app-form-item",{key:"cc5fda5c5e5dc736e89e7ef18acd399a3d8108d4","label-tag":"comments","label-text":"Comments",value:this.divingClass.comments,name:"comments","input-type":"text",textRows:4,onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"4cbd99561480a66f21b4ad6abac063acb86dc3fd",class:"swiper-slide"},t("app-diving-class-schedule",{key:"7cb80b693b5d245da47ac3e55bd90e8003ce14fd",divingClass:this.divingClass,editable:true,onScheduleEmit:()=>this.validateClass()})),t("swiper-slide",{key:"700f54426c6e4febfe0fee1a1e016485ccb4b02d",class:"swiper-slide"},t("app-users-list",{key:"1f2e511ec81a5a6e6015283a2a118f6097511c72",item:this.divingClass,editable:true,show:["owner","divemaster","instructor"]})),t("swiper-slide",{key:"0a371362c3708217192966c876a3b49a38b4d70f",class:"swiper-slide"},t("app-dive-class-bookings",{key:"5b4e66e4aa467c776d58398b74668b84308ece90",divingClass:this.divingClass,divingClassId:this.divingClassId,editable:true}))))),t("app-modal-footer",{key:"0ec481f15f666f675ada6b14672d3003b9e44a04",disableSave:!this.validClass,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=m;export{v as modal_diving_class_update};