import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import{U as s,p as c,t as d,O as n,ao as o,ai as b,T as r,ap as l,R as f,E as p,Q as h}from"./p-944b5726.js";import"./p-c7ee7cfe.js";import{b as m,n as y}from"./p-c2915cc5.js";import{l as u}from"./p-1af05547.js";import{S as k}from"./p-a75993af.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-dive-site-update ion-list{width:100%}";const v=g;const w=class{constructor(a){e(this,a);this.stdConfigurations=[];this.diveSiteId=undefined;this.diveSite=undefined;this.segment="map";this.updateView=true;this.validSite=false;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"dive-profiles",text:"Dive Profiles"},{tag:"team"}];this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new d(e);this.stdConfigurations=u.exports.cloneDeep(this.userSettings.userConfigurations)}));await this.loadDiveSite()}async loadDiveSite(){if(this.diveSiteId){this.diveSite=await n.getDiveSite(this.diveSiteId);this.draggableMarkerPosition={lat:this.diveSite.position.geopoint.latitude,lon:this.diveSite.position.geopoint.longitude}}else{this.diveSite=new o;this.diveSite.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}async componentDidLoad(){this.slider=new k(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+b(this.diveSite,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateSite()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#dive-type-select");const a={header:r.getTransl("site-type","Site Type")};e.interfaceOptions=a;e.placeholder=r.getTransl("select","Select");u.exports.each(n.getSiteTypes(),(a=>{const t=document.createElement("ion-select-option");t.value=a.type;t.textContent=a.name;e.appendChild(t)}));const t=this.el.querySelector("#entry-type-select");const i={header:r.getTransl("entry-type","Entry Type")};t.interfaceOptions=i;t.placeholder=r.getTransl("select","Select");u.exports.each(n.getEntryTypes(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;t.appendChild(a)}));const s=this.el.querySelector("#seabed-comp-select");const c={header:r.getTransl("seabed-comp","Seabed Composition")};s.interfaceOptions=c;s.placeholder=r.getTransl("select","Select");u.exports.each(n.getSeabedCompositions(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;s.appendChild(a)}));const d=this.el.querySelector("#seabed-cover-select");const o={header:r.getTransl("seabed-cover","Seabed Cover")};d.interfaceOptions=o;d.placeholder=r.getTransl("select","Select");u.exports.each(n.getSeabedCovers(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;d.appendChild(a)}))}updateLocation(e){this.draggableMarkerPosition={lat:u.exports.toNumber(e.detail.lat),lon:u.exports.toNumber(e.detail.lon)};this.diveSite.position=l.getPosition(e.detail.lat,e.detail.lon);this.validateSite()}updateAddress(e){this.diveSite.setAddress(e.detail)}handleChange(e){this.diveSite[e.detail.name]=e.detail.value;this.validateSite()}handleInformationChange(e){switch(e.detail.name){case"minDepth":this.diveSite.information.minDepth=u.exports.toNumber(e.detail.value);break;case"maxDepth":this.diveSite.information.maxDepth=u.exports.toNumber(e.detail.value);break;case"waterTemp.spring":this.diveSite.information.waterTemp.spring=e.detail.value;break;case"waterTemp.summer":this.diveSite.information.waterTemp.summer=e.detail.value;break;case"waterTemp.autumn":this.diveSite.information.waterTemp.autumn=e.detail.value;break;case"waterTemp.winter":this.diveSite.information.waterTemp.winter=e.detail.value;break;default:this.diveSite.information[e.detail.name]=e.detail.value}this.validateSite()}updateParam(e,a){let t=a.detail.value;switch(e){case"type":this.diveSite.type=t;break;case"entryType":this.diveSite.information.entryType=t;break;case"seabedComposition":this.diveSite.information.seabedComposition=t;break;case"seabedCover":this.diveSite.information.seabedCover=t;break}this.validateSite()}async addDivePlan(){let e=[];u.exports.forEach(this.stdConfigurations,((a,t)=>{e.push({type:"radio",label:a.stdName,value:t,checked:t==0?true:false})}));const a=await m.create({header:r.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:r.getTransl("ok","OK"),handler:e=>{this.addDivePlanWithConf(this.stdConfigurations[e])}},{text:r.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});a.present()}async addDivePlanWithConf(e){const a=await f.openModal("modal-dive-template",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,dive:0,user:this.userProfile});a.onDidDismiss().then((e=>{const a=e.data;if(a){a.dives[0].diveSiteId=this.diveSiteId;this.diveSite.divePlans.push(a);this.updateView=!this.updateView}}))}async viewDivePlan(e,a){this.diveSite.divePlans[a]=e.detail;this.updateView=!this.updateView}async removeDivePlan(e){this.diveSite.divePlans.splice(e,1);this.updateView=!this.updateView}updateImageUrls(e){const a=e.detail.type;const t=e.detail.url;if(a=="photo"){this.diveSite.photoURL=t}else{this.diveSite.coverURL=t}}validateSite(){this.validSite=u.exports.isNumber(this.diveSite.position.geopoint.latitude)&&u.exports.isNumber(this.diveSite.position.geopoint.longitude)&&u.exports.isString(this.diveSite.type)&&u.exports.isString(this.diveSite.information.entryType)&&u.exports.isString(this.diveSite.description)&&this.diveSite.information.minDepth>0&&this.diveSite.information.maxDepth>0}async save(){await n.updateDiveSite(this.diveSiteId,this.diveSite,this.userProfile.uid);return y.dismiss()}async cancel(){return y.dismiss()}render(){return a(t,{key:"8aeabea4b35ec41a99fc1d5eeaef4fa055d2517c"},a("ion-header",{key:"debbab2575a826ad2cd91b805f4cc00c0d7e9706"},a("app-upload-cover",{key:"459bc8bc83334683c85352da97bf5bc0fec4ba6a",item:{collection:h,id:this.diveSiteId,photoURL:this.diveSite.photoURL,coverURL:this.diveSite.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),a("app-header-segment-toolbar",{key:"adc1d61176f2f7639b0eb1fb6c569da4086aef4b",color:p.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"a3e6cb3295f2a690a05901ee8f8d25489c4a48af",class:"slides"},a("swiper-container",{key:"425086ef6e335c4c058e92e253ff2ba702913cb1",class:"slider-dive-site swiper"},a("swiper-wrapper",{key:"705424272f0b88ad6a62baeaafa5ecc1d3f8c5dc",class:"swiper-wrapper"},a("swiper-slide",{key:"e31aea5095cbb275a48ebe89b627f43ce6e5e766",class:"swiper-slide"},a("div",{key:"77513b0d2a9ac642ad5c3bdcefbd05ef82c76a00",id:"map-container"},a("app-map",{key:"740791d66bcddfbf10a471862c713f3761ff1c52",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),a("swiper-slide",{key:"faba7dc6fe90802260ebcbcf24fd59331763d9e0",class:"swiper-slide"},a("app-coordinates",{key:"28e15fac3a802b06bef209a0e87da5605c01cac5",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),a("swiper-slide",{key:"4fd8e39bda7b3a099310bfd052cf6333b2543a68",class:"swiper-slide"},a("ion-list",{key:"fc2c7d2a7aaec9a9fb5e28ff0710d4716e7df852",class:"ion-no-padding"},a("ion-list-header",{key:"2253c92c379df91e5496904ce6cf0115027393a1"},a("my-transl",{key:"f3a08b7bd0bc5625579d5386cb940090f6142c5d",tag:"general-information",text:"General Information",isLabel:true})),a("ion-item",{key:"7e0526b9a24b1cb3ee6a36ffcbf8ae4f0705bf97"},a("ion-label",{key:"b7bf5c59d5ab8e34b7089a90092bd94ef242f197"},a("my-transl",{key:"e719ba819324e9495a92693642b8f89f384043c6",tag:"site-type",text:"Site Type"})),a("ion-select",{key:"80fa40ff15baf2f1792997d26aa8b322abddf6d0",id:"dive-type-select",onIonChange:e=>this.updateParam("type",e),value:this.diveSite.type})),a("ion-item",{key:"3ece14e927f19d9e92de3ef51e8ee4c302887bb1"},a("ion-label",{key:"9f39898dc1b629f125e91ab7c20e4858171c0693"},a("my-transl",{key:"736f49f79c7adccc6c6e6598b49df7918fbcca35",tag:"entry-type",text:"Entry Type"})),a("ion-select",{key:"cf94c7015a0ee5a597ec48aeb041174459613fe3",id:"entry-type-select",onIonChange:e=>this.updateParam("entryType",e),value:this.diveSite.information.entryType})),a("app-form-item",{key:"f3a48587e57d5e3d0572bfa1d70ec4fc57d9b6cc","label-tag":"name","label-text":"Name",value:this.diveSite.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"8f0a2b0ff8787eb3bb418b2c289772c778afe376","label-tag":"description","label-text":"Description",value:this.diveSite.description,name:"description",textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("ion-list-header",{key:"c0882a33a73b4a06a6687825f22b3261ecb77a6c"},a("ion-label",{key:"909f23f1e4a2d642c03640e77a107f44ff2ec99d"},a("my-transl",{key:"c959c298d55a351699a204873aa4b2698f3ed773",tag:"site-details",text:"Site Details"}))),a("ion-grid",{key:"b1610f0d4392f7ef49a329e041d69e7d77d00e21",class:"ion-no-padding"},a("ion-row",{key:"ad298fa5da8043584ded84fe48d9673ad36a4046"},a("ion-col",{key:"be131f39ac20da4aa9d8a353158421f5939cbd99"},a("app-form-item",{key:"46c0618449b00817ded6304f886dd9b29a731e04","label-tag":"min-depth","label-text":"Min. Depth","append-text":" (m)",value:u.exports.toString(this.diveSite.information.minDepth),name:"minDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})),a("ion-col",{key:"4b4d376856cd34365a68892e6b88507e28aafb37"},a("app-form-item",{key:"a9602b462cd52b37ca2a70d66a07e586228e88f4","label-tag":"max-depth","label-text":"Max. Depth","append-text":" (m)",value:u.exports.toString(this.diveSite.information.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})))),a("app-form-item",{key:"8ed3e6049ddefc1d211667cabf385b1697361894","label-tag":"avg-vis","label-text":"Average Visibility","append-text":" (m)",value:u.exports.toString(this.diveSite.information.avgViz),name:"avgViz","input-type":"text",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}),a("ion-list-header",{key:"fa0b912703edfb827cb08b97078e7b5bf9dae324"},a("my-transl",{key:"0b4d90a1220ed4c05d2d7f0187314fecd531d54b",tag:"water-temp",text:"Water Temperature","append-text":" (°C)",isLabel:true})),a("ion-grid",{key:"724ef0c4a44ac17b2fb717e3dfa1cbdc50168d7c",class:"ion-no-padding"},a("ion-row",{key:"7e0241f01156e86aaf7bd5d4b525ee3a3c349438"},a("ion-col",{key:"e140babb570756f9b9d8006e77f06dccff7c65a2"},a("app-form-item",{key:"a271603a9c4fa424da96f55e20e1272f3ef6adba","label-tag":"spring","label-text":"Spring",value:u.exports.toString(this.diveSite.information.waterTemp.spring),name:"waterTemp.spring","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),a("ion-col",{key:"520cbe72cb7ce0ea993101e97ed55f6598e164d2"},a("app-form-item",{key:"8c4865e45b68922252800ead6af9c1cf9435a21f","label-tag":"summer","label-text":"Summer",value:u.exports.toString(this.diveSite.information.waterTemp.summer),name:"waterTemp.summer","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}))),a("ion-row",{key:"d2fce66bd96616494e5227c2a0ac2f8b9beceec2"},a("ion-col",{key:"d44d9c7d612ad65c55b5fcc1ce2eb5b742775652"},a("app-form-item",{key:"71e0602971b6b5a8450c57fa7201db77ca65387c","label-tag":"autumn","label-text":"Autumn",value:u.exports.toString(this.diveSite.information.waterTemp.autumn),name:"waterTemp.autumn","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),a("ion-col",{key:"f0505b4aa7ce5599de0df28b9c7e3b0831777aff"},a("app-form-item",{key:"8893298de19e408779e1f92b6250a45e14793673","label-tag":"winter","label-text":"Winter",value:u.exports.toString(this.diveSite.information.waterTemp.winter),name:"waterTemp.winter","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})))),a("ion-item",{key:"a4fa3472f76492b295764101ee6d377b2706514b"},a("ion-label",{key:"8869b74dc88bda1183e4b5a984fd4b8a778dfa9e"},a("my-transl",{key:"d2db25448a9f10c3e54493682e70c9ab20c77a02",tag:"seabed-comp",text:"Seabed Composition"})),a("ion-select",{key:"0b840b6d3f2bfd62d0e2787907c072a7743a3bd2",id:"seabed-comp-select",multiple:true,onIonChange:e=>this.updateParam("seabedComposition",e),value:this.diveSite.information.seabedComposition})),a("ion-item",{key:"00d71eaf24dd2754c8997ac63c2839f24ac41b16"},a("ion-label",{key:"ebb0833ee37a38d19554d4b981fccab1526655ba"},a("my-transl",{key:"fb76850c15da17111fa493cdbf721f35f1b055f8",tag:"seabed-cover",text:"Seabed Cover"})),a("ion-select",{key:"8b34e4fe4f9ebf2a3b5c2d54769ccbef9c9b636b",id:"seabed-cover-select",multiple:true,onIonChange:e=>this.updateParam("seabedCover",e),value:this.diveSite.information.seabedCover})))),a("swiper-slide",{key:"56baee81ae7fada68cdb0e06a8e7a5454750a4e0",class:"swiper-slide"},a("ion-grid",{key:"8f268d4248f7a8f698f1b4113f123431ccd989e6"},a("ion-row",{key:"9274a75f083e7299f87bef64b7b29c541fb51323",class:"ion-text-start"},this.diveSite.divePlans.map(((e,t)=>a("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},a("app-dive-plan-card",{divePlan:e,edit:true,onViewEmit:e=>this.viewDivePlan(e,t),onRemoveEmit:()=>this.removeDivePlan(t)})))),a("ion-col",{key:"aadc7a4ad12319de6c81645dbfa18f86d3ca32ef","size-sm":"12","size-md":"6","size-lg":"4"},a("ion-card",{key:"78bb5b686f0a971fd535e0bf7b536d717728425e",onClick:()=>this.addDivePlan()},a("ion-card-content",{key:"580319d5bb0f3b71390294c61ae9314c497450a4",class:"ion-text-center"},a("ion-icon",{key:"7bef303fd500d560fadc1c4499205c6a70844e77",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),a("swiper-slide",{key:"1eb11800a137c1cc10a3a8eaae14e36d7cb48e3e",class:"swiper-slide"},a("app-users-list",{key:"382d970a5fb4b4768e8d875e72c338ab2c250888",item:this.diveSite,editable:true,show:["owner","editor"]}))))),a("app-modal-footer",{key:"15758cf32c3d0d7d4f1dbaaf0f2dbade19a8416f",disableSave:!this.validSite,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};w.style=v;export{w as modal_dive_site_update};