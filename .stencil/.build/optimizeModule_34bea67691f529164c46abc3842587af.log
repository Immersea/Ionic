import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as s}from"./p-c2915cc5.js";import{l as o}from"./p-1af05547.js";import{aD as d,R as n,k as c,aM as l,S as h,E as b,T as r}from"./p-773bd3de.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const f="modal-shape-type ion-list{width:100%}";const p=f;const m=class{constructor(t){e(this,t);this.index=0;this.shapeTypes=undefined;this.shapeType=undefined;this.updateView=true;this.validShapeType=false}async componentWillLoad(){await this.loadShapeTypes()}async loadShapeTypes(){await d.downloadShapeSettings();this.shapeTypes=o.exports.cloneDeep(await d.getShapeTypes());if(this.shapeTypes&&this.shapeTypes.length>0){this.shapeType=this.shapeTypes[0]}else{this.shapeTypes=[];this.addShapeType()}this.validateShape()}selectType(e){this.shapeType=this.shapeTypes.find((t=>t.typeId==e.detail.value));this.validateShape()}handleChange(e){const t=e.detail.name;let i=e.detail.value;if(t=="typeId"){i=i.replace(/\s+/g,"-").trim().toLowerCase()}this.shapeType[t]=i;this.validateShape()}validateShape(){this.validShapeType=o.exports.isString(this.shapeType.typeId)&&o.exports.isString(this.shapeType.typeName.en)&&o.exports.isNumber(this.shapeType.decimals)&&this.shapeType.position>0&&o.exports.isString(this.shapeType.dwg.url);this.updateView=!this.updateView}async editDrawing(){this.shapeType.dwg.id=this.shapeType.typeId;this.shapeType.dwg.name=this.shapeType.typeName.en;this.shapeType.dwg.description="";const e=await n.openPopover("popover-media-loading",{media:this.shapeType.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const t={[e.data.media.id]:e.data};const i=e.data.media;const a=await n.openPopover("popover-media-uploader",{files:t,itemId:this.shapeType.typeId,collectionId:c});a.onDidDismiss().then((e=>{if(e&&e.data){const t=e.data;this.shapeType.dwg=i;Object.keys(t).forEach((e=>{this.shapeType.dwg.url=t[e]}));this.save(false);this.validateShape()}}))}}))}addShapeType(){this.shapeType=new l;this.shapeTypes.push(this.shapeType);this.index=this.shapeTypes.length-1}duplicateShapeType(){this.shapeType=o.exports.cloneDeep(this.shapeType);this.shapeType.typeId=this.shapeType.typeId+"_rev.";this.shapeTypes.push(this.shapeType);this.index=this.shapeTypes.length-1}async deleteShapeType(){try{this.shapeTypes.splice(this.index,1);this.index=0;this.shapeType=this.shapeTypes[0];this.validateShape()}catch(e){if(e)h.presentAlertError(e)}}async save(e=true){await d.uploadShapeTypes(this.shapeTypes);return e?s.dismiss():true}async cancel(){return s.dismiss()}render(){return t(i,{key:"74562cb93171f4880e0e7e659449b3209b0f4fb5"},t("ion-content",{key:"4296ef818a371d85f86ff21cc267ad45434db1a9"},t("app-banner",{key:"f818e191a77f7e9d7038486c79a94dd8c8af2d14",heightPx:500,backgroundCoverFill:false,link:this.shapeType.dwg?this.shapeType.dwg.url:null}),t("ion-button",{key:"01bdc8b11c72711e3e6e0a3fc4265426b88ad34b",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeType.typeId,onClick:()=>this.editDrawing()},t("ion-icon",{key:"3cd2da6801a804654ba2e8f8b6fb0106afaba66c",slot:"start",name:"create"}),t("ion-label",{key:"45fff0e2fdc7a240b71d9e09af282fcd35d7d067"},!this.shapeType.typeId?r.getTransl("media-loader-error","Please insert the ID to upload new media."):r.getTransl("edit-drawing","Edit Drawing"))),t("ion-grid",{key:"277e52845b581bbfffa11efd0b9a35f3da862493"},t("ion-row",{key:"664b159ac82999c866981279cc9e787011969569"},t("ion-col",{key:"be99117b50c303b249ea3564d087dc85ad29461a"},t("app-select-search",{key:"4ca643ac9a2cad0f9389000ecb0c333ce0e595bd",label:{tag:"shape_type",text:"Shape Type"},value:this.shapeType.typeId,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"],disabled:!this.validShapeType})),t("ion-col",{key:"9f566c6294ceb57de052da513487ca2687e4aeb9",size:"1",class:"ion-text-center"},t("ion-button",{key:"f9ffc8fd39551a270dab923bbbcef79064b97b21",fill:"clear",disabled:!this.validShapeType,onClick:()=>this.addShapeType()},t("ion-icon",{key:"fd8079b9c825dcb6c633205e3e0dc4fd28af3be1",name:"add",slot:"start"}))),t("ion-col",{key:"472a66d0753b541a5c6fe0e246bf890ead49fcab",size:"1",class:"ion-text-center"},t("ion-button",{key:"c1abfac6b4c64fd04bebf9d63591a36ecd830c43",fill:"clear",disabled:!this.validShapeType,onClick:()=>this.duplicateShapeType()},t("ion-icon",{key:"a687dc644f9b86d764f102709494586a3bda968d",slot:"start",name:"duplicate"}))),t("ion-col",{key:"1a9aad77b00e2fe76be568a110c23a1920d0ed53",size:"1",class:"ion-text-center"},t("ion-button",{key:"654a58b04dedafe821a6637194b53bd100c9e731",fill:"clear",color:"danger",disabled:this.shapeTypes.length==0,onClick:()=>this.deleteShapeType()},t("ion-icon",{key:"cbb91ca92fd3e815cc5679230b84b7eecbe0b1f5",slot:"start",name:"trash"}))))),t("app-form-item",{key:"a03775f1806de61872685224b560ae22b1622bf2","label-text":"Position",value:this.shapeType.position,name:"position","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"b516c040bf91a3a642eecb810a6a48749efe45ea","label-text":"ID",value:this.shapeType.typeId,name:"typeId","input-type":"string",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"uniqueid",options:{type:"list",index:"typeId",list:this.shapeTypes}}]}),t("app-form-item",{key:"19f97ed3beb15a57d269906421319674f73c61a9","label-text":"Name",value:this.shapeType.typeName,name:"typeName","input-type":"text",multiLanguage:true,"text-rows":"1",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required"]}),t("app-form-item",{key:"a5e7dea3a2281a8d863368d036780461d9470b17","label-text":"Decimals",value:this.shapeType.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required"]})),t("app-modal-footer",{key:"55154d137b5a1af7767900bcb56809fdd1397f87",color:b.getAppColor(),disableSave:!this.validShapeType,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};m.style=p;export{m as modal_shape_type};