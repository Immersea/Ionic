import{r as t,h as i}from"./p-cbe60c68.js";import{N as e,T as s,S as o}from"./p-4094830e.js";import"./p-c7ee7cfe.js";import{a as n}from"./p-5d4a8e1f.js";import{l as c}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const a="app-user-manage-notifications{width:100%;}";const r=a;const l=class{constructor(i){t(this,i);this.notificationsArray=[];this.topicsArray=[];this.updateView=false}async componentWillLoad(){this.deviceToken=await e.getLocalNotificationToken();this.updateNotifications()}async updateNotifications(){this.notificationDoc=await e.getUserTokensDoc();this.loadNotifications()}async loadNotifications(){if(this.notificationDoc&&this.notificationDoc[this.deviceToken]){this.topics=this.notificationDoc[this.deviceToken].topics}else{this.topics=null}this.notificationsArray=[];Object.keys(this.notificationDoc).forEach((t=>{const i=this.notificationDoc[t];let e=[];if(i.topics){Object.keys(i.topics).map((i=>{let s=true;Object.keys(this.notificationDoc).map((t=>{const e=this.notificationDoc[t].topics[i];if(c.exports.isBoolean(e)){s=s&&e}}));e.push({id:i,devicetoken:t,activeOnDevice:this.topics?this.topics[i]:false,activeOnAllDevices:s,name:this.getTopicName(i)})}));e=c.exports.orderBy(e,"name")}this.notificationsArray.push({devicetoken:t,info:i.info,topics:e})}));this.notificationsArray=c.exports.orderBy(this.notificationsArray,"devicetoken");this.updateView=!this.updateView}getTopicName(t){console.log("getTopicName",t)}async changeTopicSubscription(t){const i={text:s.getTransl("remove-notification-from-device","Remove from this device only"),handler:async()=>{o.presentLoading("updating");e.unsubscribeUserDeviceFromTopic(t.id,t.deviceToken).then((t=>{this.notificationDoc=t;this.loadNotifications();o.dismissLoading()})).catch((t=>{this.showErrors(t);this.updateNotifications();o.dismissLoading()}));return true}};const c={text:s.getTransl("add-notification-to-device","Add to this device only"),handler:async()=>{o.presentLoading("updating");e.subscribeUserDeviceToTopic(t.id,t.deviceToken).then((t=>{this.notificationDoc=t;this.loadNotifications();o.dismissLoading()})).catch((t=>{this.showErrors(t);this.updateNotifications();o.dismissLoading()}));return true}};const a={text:s.getTransl("remove-notification-from-all-devices","Remove from all my devices"),handler:async()=>{o.presentLoading("updating");e.unsubscribeUserFromTopic(t.id).then((t=>{this.notificationDoc=t;this.loadNotifications();o.dismissLoading()})).catch((t=>{this.showErrors(t);this.updateNotifications();o.dismissLoading()}));return true}};const r={text:s.getTransl("add-notification-to-all-devices","Add to all my devices"),handler:async()=>{o.presentLoading("updating");e.subscribeUserToTopic(t.id).then((t=>{this.notificationDoc=t;this.loadNotifications();o.dismissLoading()})).catch((t=>{this.showErrors(t);this.updateNotifications();o.dismissLoading()}));return true}};const l=await n.create({header:t.name,buttons:[t.activeOnDevice?i:c,t.activeOnAllDevices?a:r,{text:s.getTransl("delete","Delete"),role:"destructive",handler:async()=>{e.deleteUserFromTopic(t.id).then((t=>{this.notificationDoc=t;this.loadNotifications()})).catch((t=>{this.showErrors(t);this.updateNotifications()}));return true}},{text:s.getTransl("cancel","Cancel"),role:"cancel"}]});await l.present()}async showErrors(t){o.presentAlertError(JSON.stringify(t))}render(){return i("div",{key:"49e63ae3cf697c5a7e2823579d5dc6814e299cfd"},this.notificationsArray.length==0?i("ion-item",null,"No notifications set"):undefined,this.notificationsArray.map((t=>i("ion-item-group",null,i("ion-item-divider",null,i("ion-label",null,t.info.model+": "+t.info.operatingSystem+"-"+t.info.osVersion+(t.devicetoken==this.deviceToken?" (this device)":""))),t.topics.length==0?i("ion-item",null,"No notifications for this device"):undefined,t.topics.map((t=>i("ion-item",{button:true,detail:false,onClick:()=>this.changeTopicSubscription(t)},i("ion-label",null,t.name),i("ion-button",{slot:"end","icon-only":true,fill:"clear",color:t.activeOnDevice?"success":"danger"},i("ion-icon",{name:t.activeOnDevice?"checkmark":"close"})),i("ion-button",{slot:"end","icon-only":true,fill:"clear",color:t.activeOnAllDevices?"success":"danger"},i("ion-icon",{name:t.activeOnAllDevices?"checkmark-done":"close"})))))))))}};l.style=r;export{l as app_user_manage_notifications};