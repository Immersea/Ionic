import{r as s,h as t,f as i}from"./p-cbe60c68.js";import{S as e,a8 as a,az as n,m as o,aA as l,U as r,T as h,y as c}from"./p-736235c6.js";import{N as d,T as p,Z as f,V as b}from"./p-1819cfda.js";import{S as u}from"./p-a75993af.js";import{l as m}from"./p-1af05547.js";import"./p-46038295.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";const g="page-admin-translations app-admin-translations{width:100%;height:100%}";const y=g;const j=class{constructor(t){s(this,t);this.segment="translations";this.slider=undefined;this.translations=[];this.filteredTranslations=[];this.filter="";this.translationsBackup=[];this.translationsChanged={};this.updateView=false}componentWillLoad(){this.languages=e.getLanguages();this.selectedLanguage=this.languages[0];this.translationsSub=d(p(b(c,l),f("input")),(s=>{this.translations=[];s.forEach((s=>{const t=s.data();t["id"]=s.id;this.translations.push(t)}));this.translationsBackup=m.exports.cloneDeep(this.translations);this.filterTranslations()}))}componentDidLoad(){this.setSliderHeight()}setSliderHeight(){this.slider=new u(".slider-translations",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null;this.slider.updateSize()}}});const s=Array.from(this.el.getElementsByClassName("slide-container"));s.map((s=>{s.setAttribute("style","height: "+a(null,4)+"px")}));this.slider.updateSize();this.updateView=!this.updateView}disconnectedCallback(){this.translationsSub()}segmentChanged(s){if(s.detail.value){this.segment=s.detail.value;if(s.detail.value=="admin"){this.slider.slideTo(1)}else if(s.detail.value=="translations"){this.slider.slideTo(0)}this.updateView=!this.updateView}}selectLanguage(s){this.selectedLanguage=s.target.value;this.updateView=!this.updateView}async runTranslationsScript(){try{await n.updateTranslations();e.presentAlert("Done","Translations saved!")}catch(s){console.log("error runTranslationsScript",s)}}translationChanged(s){if(s&&s.detail){const t=s.detail;this.translationsChanged[t.id]=t;let i=this.translations.findIndex((s=>s.id===t.id));this.translations[i]=t;this.translations=[...this.translations];i=this.filteredTranslations.findIndex((s=>s.id===t.id));this.filteredTranslations[i]=t;this.filteredTranslations=[...this.filteredTranslations];this.updateView=!this.updateView}}filterTranslations(s){if(s&&s.target.value){this.filter=s.target.value}if(this.filter&&this.filter!==""){this.filteredTranslations=this.translations.filter((s=>s.input.toLowerCase().includes(this.filter.toLowerCase())))}else{this.filteredTranslations=m.exports.cloneDeep(this.translations)}this.updateView=!this.updateView}close(){this.translations=m.exports.cloneDeep(this.translationsBackup);this.filterTranslations()}async save(){const s=[];Object.keys(this.translationsChanged).map((t=>{const i=this.translationsChanged[t];delete i.id;s.push(o.updateDocument(l,t,i))}));await Promise.all(s);this.translationsChanged=[]}render(){return[t("ion-header",{key:"59532a2315ab46e42d7a7e95c595ade718329f34"},t("app-navbar",{key:"bc0e711f06256341604919600a3b13dac0ac372c",color:"udive",tag:"translations",text:"Translations"})),r.userRoles&&r.userRoles.isSuperAdmin()?[t("ion-header",null,t("ion-toolbar",{color:"udive",class:"no-safe-padding"},t("ion-segment",{mode:"md",onIonChange:s=>this.segmentChanged(s),value:this.segment},t("ion-segment-button",{value:"translations",layout:"icon-start"},t("ion-label",null,"TRANSLATIONS")),t("ion-segment-button",{value:"admin",layout:"icon-start"},t("ion-label",null,"ADMIN"))))),this.segment=="translations"?t("ion-header",null,t("ion-toolbar",{color:"udive"},t("ion-searchbar",{animated:true,placeholder:h.getTransl("search","Search"),value:this.filter,debounce:250,onIonInput:s=>this.filterTranslations(s)})),t("ion-toolbar",{color:"udive"},t("ion-item",null,t("ion-select",{label:h.getTransl("language","Language"),labelPlacement:"floating",interface:"action-sheet",value:this.selectedLanguage,onIonChange:s=>this.selectLanguage(s)},this.languages.map((s=>t("ion-select-option",{value:s},s.label)))),t("ion-icon",{slot:"end",class:"flag-icon flag-icon-"+(this.selectedLanguage.countryCode=="en"?"gb":this.selectedLanguage.countryCode)})))):undefined]:undefined,t("ion-content",{key:"7905bf62735f4c893aa3b92e5b0e75b72eb9be91"},t("swiper-container",{key:"f422d9e00d7a191a52b719ae4f086fe421f272d0",class:"slider-translations swiper"},t("swiper-wrapper",{key:"4418256876cee60387f1e4914ae3bb61a37e2f76",class:"swiper-wrapper"},t("swiper-slide",{key:"766079146f88911aab65756a207270825ddf3ccd",class:"swiper-slide"},t("ion-content",{key:"a296bcd1bfd3a84916d951a28bc9600c8a05427a",class:"slide-container"},t("ion-grid",{key:"9272dfb8ea736f0a0674a9c8459363a4dc19dd03"},t("ion-row",{key:"0218d3f4bc1c4ab12c5343d1d88d167da35428c1"},t("ion-col",{key:"68c2587b97bbd1568286e4adb27bbe00c3efc82c"},t("app-admin-translations",{key:"5c44c46db64bb7cf48d0e3b8ed1d324a28d02efb",translations:this.filteredTranslations,language:this.selectedLanguage.value,onTranslationChanged:s=>this.translationChanged(s)})))))),r.userRoles&&r.userRoles.isSuperAdmin()?t("swiper-slide",{class:"swiper-slide"},t("ion-content",{class:"slide-container"},t("ion-button",{size:"large",onClick:()=>this.runTranslationsScript()},"Run Translations Script"))):undefined))),Object.keys(this.translationsChanged).length>0?t("app-modal-footer",{onCancelEmit:()=>this.close(),onSaveEmit:()=>this.save()}):undefined]}get el(){return i(this)}};j.style=y;export{j as page_admin_translations};