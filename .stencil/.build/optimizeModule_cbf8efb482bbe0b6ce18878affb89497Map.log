{"version":3,"names":["appDragdropFileCss","AppDragdropFileStyle0","AppDragdropFile","componentWillLoad","this","file","handleFiles","componentDidLoad","dropArea","el","querySelector","inputElement","autoOpen","click","undefined","forEach","eventName","addEventListener","preventDefaults","document","body","classList","add","remove","e","dt","dataTransfer","files","preventDefault","stopPropagation","selectedFile","target","test","fileType","regex","RegExp","type","fileTypes","includes","fileSelected","emit","alert","alertController","create","header","TranslationService","getTransl","message","join","buttons","text","handler","async","present","render","h","key","id","name","round","size","tag","class","accept","length","onClick","onChange","ev","htmlFor"],"sources":["src/components/common/app/common/app-dragdrop-file/app-dragdrop-file.scss?tag=app-dragdrop-file","src/components/common/app/common/app-dragdrop-file/app-dragdrop-file.tsx"],"sourcesContent":["app-dragdrop-file {\n  #drop-area {\n    border: 2px dashed white;\n    border-radius: 20px;\n    width: 90%;\n    height: var(--coverHeight);\n    margin: 0 auto 0 auto;\n    padding: 20px;\n    text-align: center;\n    visibility: visible;\n  }\n  #drop-area.highlight {\n    border-color: var(--ion-color-primary) !important;\n    border-style: solid !important;\n    border-width: 5px !important;\n  }\n  p {\n    margin-top: 0;\n    color: white;\n  }\n  ion-note {\n    padding: 0;\n  }\n  .my-form {\n    text-align: center;\n  }\n  .button {\n    display: inline-block;\n    margin: 20px 0 20px 0;\n    padding: 20px;\n    background-color: var(--ion-color-primary);\n    color: var(--ion-color-primary-contrast);\n    cursor: pointer;\n    border-radius: 5px;\n  }\n  .button:hover {\n    background: var(--ion-color-tertiary);\n    color: var(--ion-color-tertiary-contrast);\n  }\n  #fileElem {\n    display: none;\n  }\n}\n","import {\n  Component,\n  h,\n  Element,\n  Event,\n  EventEmitter,\n  Prop,\n  State,\n} from \"@stencil/core\";\nimport {alertController} from \"@ionic/core\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {round} from \"lodash\";\n@Component({\n  tag: \"app-dragdrop-file\",\n  styleUrl: \"app-dragdrop-file.scss\",\n})\nexport class AppDragdropFile {\n  @Element() el: HTMLElement;\n  form: HTMLFormElement;\n  dropArea: any;\n  inputElement: HTMLInputElement;\n  @Event() fileSelected: EventEmitter<File>;\n  @Prop() fileType: string;\n  @Prop() fileTypes: string[];\n  @Prop() autoOpen = false; //open file box at startup\n  @Prop() file: File;\n  @State() selectedFile: File;\n\n  componentWillLoad() {\n    if (this.file) {\n      this.handleFiles([this.file]);\n    }\n  }\n  componentDidLoad() {\n    // ************************ Drag and drop ***************** //\n    this.dropArea = this.el.querySelector(\"#drop-area\");\n    this.inputElement = this.el.querySelector(\"#fileElem\");\n    this.autoOpen ? this.inputElement.click() : undefined;\n    // Prevent default drag behaviors\n    [\"dragenter\", \"dragover\", \"dragleave\", \"drop\"].forEach((eventName) => {\n      this.dropArea.addEventListener(eventName, this.preventDefaults, false);\n      document.body.addEventListener(eventName, this.preventDefaults, false);\n    });\n\n    // Highlight drop area when item is dragged over it\n    [\"dragenter\", \"dragover\"].forEach((eventName) => {\n      this.dropArea.addEventListener(\n        eventName,\n        () => {\n          this.dropArea.classList.add(\"highlight\");\n        },\n        false\n      );\n    });\n    [\"dragleave\", \"drop\"].forEach((eventName) => {\n      this.dropArea.addEventListener(\n        eventName,\n        () => {\n          this.dropArea.classList.remove(\"highlight\");\n        },\n        false\n      );\n    });\n\n    // Handle dropped files\n    this.dropArea.addEventListener(\n      \"drop\",\n      (e) => {\n        const dt = e.dataTransfer;\n        this.handleFiles(dt.files);\n      },\n      false\n    );\n  }\n\n  preventDefaults(e) {\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  async handleFiles(file) {\n    this.selectedFile = null;\n    if (file.target) {\n      //coming from button click\n      this.selectedFile = file.target.files[0];\n    } else {\n      this.selectedFile = file[0];\n    }\n\n    let test = false;\n\n    if (this.fileType) {\n      const regex = new RegExp(\"^\" + this.fileType + \"\\\\/\\\\w+\");\n      // /^image\\/\\w+/.test(uploadUrl.type)\n      test = regex.test(this.selectedFile.type);\n    } else {\n      test = this.fileTypes.includes(this.selectedFile.type);\n    }\n\n    if (test) {\n      this.fileSelected.emit(this.selectedFile);\n    } else {\n      this.selectedFile = null;\n      const alert = await alertController.create({\n        header: TranslationService.getTransl(\"select-file\", \"Select a File\"),\n        message:\n          TranslationService.getTransl(\n            \"select-file-message\",\n            \"Please select a file of type: \"\n          ) + (this.fileType ? this.fileType : this.fileTypes.join(\", \")),\n        buttons: [\n          {\n            text: TranslationService.getTransl(\"ok\", \"OK\"),\n            handler: async () => {\n              this.inputElement.click();\n            },\n          },\n        ],\n      });\n      alert.present();\n    }\n  }\n\n  render() {\n    return [\n      <div id=\"drop-area\">\n        <p>\n          {this.selectedFile ? (\n            [\n              <ion-note>{this.selectedFile.name}</ion-note>,\n              <br />,\n              <ion-note>\n                {round(this.selectedFile.size / 1024 / 1024, 1)}MB\n              </ion-note>,\n            ]\n          ) : (\n            <my-transl\n              tag=\"dragdrop-file\"\n              text=\"Upload a file with the file dialog or by dragging and\n            dropping the file onto the dashed region\"\n            />\n          )}\n        </p>\n      </div>,\n      <form class=\"my-form\">\n        <input\n          type=\"file\"\n          id=\"fileElem\"\n          accept={\n            this.fileType\n              ? this.fileType + \"/*\"\n              : this.fileTypes && this.fileTypes.length > 0\n                ? this.fileTypes.join(\",\")\n                : \"*/*\"\n          }\n          onClick={() => {\n            return false;\n          }}\n          onChange={(ev) => this.handleFiles(ev)}\n        />\n        <label id=\"labelElem\" class=\"button\" htmlFor=\"fileElem\">\n          <my-transl tag=\"select-file\" text=\"Select a File\" />\n        </label>\n      </form>,\n    ];\n  }\n}\n"],"mappings":"6aAAA,MAAMA,EAAqB,kyBAC3B,MAAAC,EAAeD,E,MCeFE,EAAe,M,mIAQP,M,gDAInB,iBAAAC,GACE,GAAIC,KAAKC,KAAM,CACbD,KAAKE,YAAY,CAACF,KAAKC,M,EAG3B,gBAAAE,GAEEH,KAAKI,SAAWJ,KAAKK,GAAGC,cAAc,cACtCN,KAAKO,aAAeP,KAAKK,GAAGC,cAAc,aAC1CN,KAAKQ,SAAWR,KAAKO,aAAaE,QAAUC,UAE5C,CAAC,YAAa,WAAY,YAAa,QAAQC,SAASC,IACtDZ,KAAKI,SAASS,iBAAiBD,EAAWZ,KAAKc,gBAAiB,OAChEC,SAASC,KAAKH,iBAAiBD,EAAWZ,KAAKc,gBAAiB,MAAM,IAIxE,CAAC,YAAa,YAAYH,SAASC,IACjCZ,KAAKI,SAASS,iBACZD,GACA,KACEZ,KAAKI,SAASa,UAAUC,IAAI,YAAY,GAE1C,MACD,IAEH,CAAC,YAAa,QAAQP,SAASC,IAC7BZ,KAAKI,SAASS,iBACZD,GACA,KACEZ,KAAKI,SAASa,UAAUE,OAAO,YAAY,GAE7C,MACD,IAIHnB,KAAKI,SAASS,iBACZ,QACCO,IACC,MAAMC,EAAKD,EAAEE,aACbtB,KAAKE,YAAYmB,EAAGE,MAAM,GAE5B,M,CAIJ,eAAAT,CAAgBM,GACdA,EAAEI,iBACFJ,EAAEK,iB,CAGJ,iBAAMvB,CAAYD,GAChBD,KAAK0B,aAAe,KACpB,GAAIzB,EAAK0B,OAAQ,CAEf3B,KAAK0B,aAAezB,EAAK0B,OAAOJ,MAAM,E,KACjC,CACLvB,KAAK0B,aAAezB,EAAK,E,CAG3B,IAAI2B,EAAO,MAEX,GAAI5B,KAAK6B,SAAU,CACjB,MAAMC,EAAQ,IAAIC,OAAO,IAAM/B,KAAK6B,SAAW,WAE/CD,EAAOE,EAAMF,KAAK5B,KAAK0B,aAAaM,K,KAC/B,CACLJ,EAAO5B,KAAKiC,UAAUC,SAASlC,KAAK0B,aAAaM,K,CAGnD,GAAIJ,EAAM,CACR5B,KAAKmC,aAAaC,KAAKpC,KAAK0B,a,KACvB,CACL1B,KAAK0B,aAAe,KACpB,MAAMW,QAAcC,EAAgBC,OAAO,CACzCC,OAAQC,EAAmBC,UAAU,cAAe,iBACpDC,QACEF,EAAmBC,UACjB,sBACA,mCACG1C,KAAK6B,SAAW7B,KAAK6B,SAAW7B,KAAKiC,UAAUW,KAAK,OAC3DC,QAAS,CACP,CACEC,KAAML,EAAmBC,UAAU,KAAM,MACzCK,QAASC,UACPhD,KAAKO,aAAaE,OAAO,MAKjC4B,EAAMY,S,EAIV,MAAAC,GACE,MAAO,CACLC,EAAA,OAAAC,IAAA,2CAAKC,GAAG,aACNF,EAAA,KAAAC,IAAA,4CACGpD,KAAK0B,aAAY,CAEdyB,EAAA,gBAAWnD,KAAK0B,aAAa4B,MAC7BH,EAAA,WACAA,EAAA,gBACGI,gBAAMvD,KAAK0B,aAAa8B,KAAO,KAAO,KAAM,GAAE,OAInDL,EAAA,aACEM,IAAI,gBACJX,KAAK,kHAMbK,EAAA,QAAAC,IAAA,2CAAMM,MAAM,WACVP,EAAA,SAAAC,IAAA,2CACEpB,KAAK,OACLqB,GAAG,WACHM,OACE3D,KAAK6B,SACD7B,KAAK6B,SAAW,KAChB7B,KAAKiC,WAAajC,KAAKiC,UAAU2B,OAAS,EACxC5D,KAAKiC,UAAUW,KAAK,KACpB,MAERiB,QAAS,IACA,MAETC,SAAWC,GAAO/D,KAAKE,YAAY6D,KAErCZ,EAAA,SAAAC,IAAA,2CAAOC,GAAG,YAAYK,MAAM,SAASM,QAAQ,YAC3Cb,EAAA,aAAAC,IAAA,2CAAWK,IAAI,cAAcX,KAAK,oB","ignoreList":[]}