import{r as e,h as i}from"./p-cbe60c68.js";import{S as t}from"./p-a75993af.js";import{U as a}from"./p-f55a46d6.js";import{U as s,a as n,b as l}from"./p-d2a582b5.js";import{U as o,F as d}from"./p-7ea622ea.js";import{T as r}from"./p-ba5b5ce2.js";import{l as c}from"./p-1af05547.js";import{E as p}from"./p-5d8b2afa.js";import"./p-c7ee7cfe.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-6c93b3f7.js";import"./p-e9c4f463.js";import"./p-7ee16e8d.js";const f="page-user-plans{}";const h=f;const u=class{constructor(i){e(this,i);this.titles=[{tag:"personal",text:"Personal",disabled:false},{tag:"team",text:"Team",disabled:false}];this.usersList=[];this.uid=undefined;this.userPlans=undefined;this.slider=undefined;this.usersTeams=undefined;this.selectedUser=undefined;this.updateView=false}async componentWillLoad(){await this.loadUserPlans()}async loadUserPlans(){if(this.uid){let e=new s(await a.getPlansOfUser(this.uid));this.userPlans=new s;this.userPlans.users=e.users;e.userPlans.map((e=>{const i=new n;i.customerId=e.customerId;i.otherName=e.otherName;i.planOfActions=[];e.planOfActions.map((e=>{if(e.product=="refractories"&&r.isRefraTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="electrodes"&&r.isElecTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="engineering"&&r.isEngTeamAdmin()){i.planOfActions.push(e)}else if(e.product=="rawmaterials"&&r.isRawTeamAdmin()){i.planOfActions.push(e)}}));if(i.planOfActions.length>0){this.userPlans.userPlans.push(i)}}));this.selectedUser=await o.getPublicProfileUserDetails(this.uid);this.updateSlider()}else{this.userPlansSub=a.userPlans$.subscribe((e=>{this.userPlans=e;this.updateSlider()}));r.isTeamAdmin()?this.usersListSub=o.userPublicProfilesList$.subscribe((e=>{this.usersList=e;this.updateSlider()})):undefined}}disconnectedCallback(){if(this.uid);else{r.isTeamAdmin()?this.usersListSub.unsubscribe():undefined;this.userPlansSub.unsubscribe()}}async componentDidLoad(){this.slider=new t(".slider-plans"+this.uid,{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(!this.uid&&r.isTeamAdmin()){this.usersTeams=await r.getUsersTeams()}}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editPlan(e){const i=await a.presentUserPlansUpdate(this.uid,this.userPlans,e);i.onDidDismiss().then((()=>{if(this.uid)this.loadUserPlans()}))}renderTeam(){if(this.usersTeams&&this.usersTeams.usersTeams&&this.usersTeams.usersTeams.length>0){const e={};this.usersTeams.usersTeams.map((i=>{if(i.uid!==o.userProfile.uid){e[i.uid]=true}}));let t=[];Object.keys(e).map((e=>{t.push(this.usersList.find((i=>i.uid==e)))}));t=c.exports.orderBy(t,"displayName");return t.length>0?[t.map((e=>[i("ion-item",{button:true,onClick:()=>a.openUsersPlans(e.uid)},e.displayName+" - "+e.email)]))]:null}else return null}render(){return[i("ion-header",{key:"fea53a538e671f7b12d487d3bff2c9c7ce08d120"},i("app-navbar",{key:"1c6947aabac70fcebfc3ab6112dfac7c4e9a64c3",tag:this.uid==null?"plan-of-actions":null,text:this.uid==null?"Plan of Actions":"Plan of Actions - "+this.selectedUser.displayName,color:p.getAppColor(),backButton:this.uid!=null})),!this.uid&&r.isTeamAdmin()?i("app-header-segment-toolbar",{color:p.getAppColor(),swiper:this.slider,titles:this.titles}):undefined,i("ion-content",{key:"6cb4afdf1e3d71eee051aabc5cdb3a8b38e87559",class:"slides"},i("ion-fab",{key:"41d32187daa3946f6a66de89af8ae2a2eb2ad1f7",vertical:"top",horizontal:"end",slot:"fixed",edge:true},i("ion-fab-button",{key:"5a125f969e6be2c7371518332fb8df67e4176223",size:"small",onClick:()=>this.editPlan(),color:p.getAppColor()},i("ion-icon",{key:"5db26861f18216aa584b7d49c867d1b22e07d8ba",name:"add"}))),i("swiper-container",{key:"2521904f940ee5eab44d9353bbe118789370d425",class:"slider-plans"+this.uid+" swiper"},i("swiper-wrapper",{key:"ddffa3c1f163e5830d5b89e3ccd6ce02565dca59",class:"swiper-wrapper"},i("swiper-slide",{key:"55151138a677830a1e46bfa34e4dfd85777889c7",class:"swiper-slide"},i("div",{key:"0c5da40321d0dddae98fd399cb7482419a2b5087",class:"ion-padding-top"}),this.userPlans&&this.userPlans.userPlans&&this.userPlans.userPlans.length>0?this.userPlans.userPlans.map(((e,t)=>[i("ion-item",{button:true,onClick:()=>this.editPlan(t)},i("ion-grid",{class:"ion-no-padding"},i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("ion-item-divider",{color:"trasteel"},e.customerId!=null?d.getCustomersDetails(e.customerId).fullName:e.otherName))),e.planOfActions.map((e=>[i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"product","label-text":"Product",detailText:l[e.product]})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"updated","label-text":"Updated",detailText:new Date(e.updated).toLocaleDateString()})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"due-date","label-text":"Due Date",detailText:new Date(e.dueDate).toLocaleDateString()}))),i("ion-row",{class:"ion-no-padding"},i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"actual-situation","label-text":"Actual Situation",detailText:e.situation})),i("ion-col",null,i("app-item-detail",{lines:"none","label-tag":"plan","label-text":"Plan",detailText:e.plan}))),i("ion-row",{class:"ion-no-padding"},i("ion-item-divider",null))]))))])):i("ion-item",null,i("ion-label",null,"Insert a new plan of actions"))),!this.uid&&r.isTeamAdmin()?i("swiper-slide",{class:"swiper-slide"},i("ion-list",null,this.renderTeam())):undefined)))]}};u.style=h;export{u as page_user_plans};