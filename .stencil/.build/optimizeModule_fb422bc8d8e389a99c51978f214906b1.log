import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n as o}from"./p-c2915cc5.js";import{S as s}from"./p-a75993af.js";import{U as n,n as c,T as l,_ as d,$ as r,W as f,S as h,E as b,l as m}from"./p-773bd3de.js";import{l as p}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const u="modal-contact-update ion-list{width:100%}";const y=u;const k=class{constructor(t){e(this,t);this.contactId=undefined;this.contact=undefined;this.customerLocations=[];this.segment="information";this.updateView=true;this.validContact=false;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=n.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));this.segmentTitles={information:l.getTransl("information","Information")};await this.loadContact()}async loadContact(){if(this.contactId){const e=await d.getContact(this.contactId);this.contact=e}else{this.contact=new r;this.contact.users={[n.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new s(".slider-edit-contact",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.validateContact()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.contact[e.detail.name]=e.detail.value;this.validateContact()}handleInformationChange(){this.validateContact()}selectCustomer(e){this.contact.customerId=e.detail.value;f.getCustomer(e.detail.value).then((e=>{this.customer=e;this.customerLocations=e.locations;this.setLocationsSelect()}));this.validateContact()}selectCustomerLocation(e){this.contact.customerLocationId=e.detail.value;this.validateContact()}setLocationsSelect(){const e=this.el.querySelector("#selectLocation");const t={header:l.getTransl("location","Locations")};e.interfaceOptions=t;const a=Array.from(e.getElementsByTagName("ion-select-option"));a.map((t=>{e.removeChild(t)}));e.placeholder=l.getTransl("select","Select");this.customerLocations.map((t=>{const a=document.createElement("ion-select-option");a.value=t.type;a.textContent=l.getTransl(t.type,f.getLocationsTypes(t.type)[0].locationName);e.appendChild(a)}));this.updateSlider()}updateParam(){this.validateContact()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break}}}updateImageUrls(e){const t=e.detail.type;const a=e.detail.url;if(t=="photo"){this.contact.photoURL=a}else{this.contact.coverURL=a}this.save(false)}validateContact(){this.validContact=p.exports.isString(this.contact.firstName)&&p.exports.isString(this.contact.lastName)&&p.exports.isString(this.contact.customerId)}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteContact(){try{await d.deleteContact(this.contactId);o.dismiss()}catch(e){h.presentAlertError(e)}}async save(e=true){const t=await d.updateContact(this.contactId,this.contact,this.userProfile.uid);if(this.contactId){return e?o.dismiss():true}else{this.contactId=t.id;return true}}async cancel(){o.dismiss()}render(){return t(a,{key:"a8becc12af3a3ab38364d9ea073e89d74c7c8122"},t("ion-header",{key:"df52aa2a7854c25934d81d8c55758d3c041fcfb6"},t("app-upload-cover",{key:"dfce3d278519097e21cbf5fed53f5ffb499b9064",item:{collection:m,id:this.contactId,photoURL:this.contact.photoURL,coverURL:this.contact.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),t("ion-header",{key:"24ec9529c84a68883ac34879589d056fffd1c3cc"},t("ion-toolbar",{key:"8e225060a3e33f39b3897c69081ac1253c2236bb"},t("ion-segment",{key:"361bed78a91c86626827acf59e62853593399095",mode:"md",color:b.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},t("ion-segment-button",{key:"abf2563f88402b80b270fee3c564b9e2bfe322c7",value:"information",layout:"icon-start"},t("ion-label",{key:"b22a9ddb595e00a20c9babacab11b3cd65212fa2"},this.segmentTitles.information))))),t("ion-content",{key:"9cbf5aa974bf39a68576265f639ec3a826ac85db",class:"slides"},t("swiper-container",{key:"21b3d5ef36520d6da4491265204578f8d3e8f0c4",class:"slider-edit-contact swiper"},t("swiper-wrapper",{key:"dd30aca85a16e0ce19613630b93cab3dc1daaaad",class:"swiper-wrapper"},t("swiper-slide",{key:"b7a536eab6eeb882c286e9918b46013f5b963c78",class:"swiper-slide"},t("ion-list",{key:"3917252d4e20b5d43d96504cebc9ef1de8c74fa9",class:"ion-no-padding"},t("ion-list-header",{key:"ea977f7ffd76df69c0b228a04cbb847e9b14f74d"},t("my-transl",{key:"7a52f6735bcd340af0bf26c14cb182df730905df",tag:"general-information",text:"General Information",isLabel:true})),t("ion-item",{key:"7d97dcedc50d96ba15d96e8ddac40c6ea16109e1",lines:"none"},t("ion-select",{key:"e40bfdc8b65cfddcc4a030469b20fd52c4ae5453",color:"trasteel",id:"selectCustomer",interface:"action-sheet",label:l.getTransl("customer","Customer"),"label-placement":"floating",onIonChange:e=>this.selectCustomer(e),value:this.contact&&this.contact.customerId?this.contact.customerId:null},f.customersList.map((e=>t("ion-select-option",{value:e.id},e.fullName))))),t("ion-item",{key:"005871be4610b0bcb49e156be4dbc0e7dd7b0824",lines:"none"},t("ion-select",{key:"3c30e155b88c959e876f5c5baff9f0ba38554792",color:"trasteel",id:"selectLocation",interface:"action-sheet",label:l.getTransl("location","Location"),"label-placement":"floating",onIonChange:e=>this.selectCustomerLocation(e),value:this.contact&&this.contact.customerLocationId?this.contact.customerLocationId:null})),t("app-form-item",{key:"57db93ed4d4e9c4adaaf7598fb97069fa8769748","label-tag":"name","label-text":"Name",value:this.contact.firstName,name:"firstName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"5f89177c215be01b692a1aba8c544c5ccab2fe93","label-tag":"surname","label-text":"Surname",value:this.contact.lastName,name:"lastName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"f74e4873588d95dff493fd5edbb6dc2370a0c4f3","label-tag":"work-position","label-text":"Work Position",value:this.contact.workPosition,name:"workPosition","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"f9f9ce922ffcdf4173f6de10c7509add62c1fef8","label-tag":"office-phone","label-text":"Office Phone",value:this.contact.officePhone,name:"officePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"03d204ce989f0d59fe9249996ed60af210ee5b63","label-tag":"mobile-phone","label-text":"Mobile Phone",value:this.contact.mobilePhone,name:"mobilePhone","input-type":"tel",onFormItemChanged:e=>this.handleChange(e)}),t("app-form-item",{key:"a2c50156c5c6191b59f58c06977990785ba31d4f","label-tag":"email","label-text":"Email",value:this.contact.email,name:"email","input-type":"email","input-form-mode":"email",onFormItemChanged:e=>this.handleChange(e)})),this.contactId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteContact()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined)))),t("app-modal-footer",{key:"4cf7ea415b5835f982d2d4c0edc96a3d59fe6af1",color:b.getAppColor(),disableSave:!this.validContact,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};k.style=y;export{k as modal_contact_update};