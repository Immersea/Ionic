import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as n}from"./p-5d4a8e1f.js";import{l as s}from"./p-1af05547.js";import{S as o}from"./p-a75993af.js";import{U as m,n as l,am as d,ap as p,aw as r,R as f,k as h,S as b,T as c}from"./p-736235c6.js";import{E as u}from"./p-46038295.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-1819cfda.js";import"./p-7ee16e8d.js";const v="modal-shape-update ion-list{width:100%}";const x=v;const y=class{constructor(a){e(this,a);this.validShape=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"drawing",text:"Drawing",disabled:false}];this.shapeId=undefined;this.duplicateShape=undefined;this.shape=undefined;this.updateView=true;this.scrollTop=0;this.shapeTypes=undefined;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=m.userProfile$.subscribe((e=>{this.userProfile=new l(e)}));await this.loadShape()}async loadShape(){this.shapeTypes=await d.getShapeTypes();if(this.shapeId){const e=await d.getShape(this.shapeId);this.shape=e}else{this.shape=new p(this.duplicateShape?this.duplicateShape.shape:null);if(this.duplicateShape){this.shape.shapeName="NEW - "+this.duplicateShape.shape.shapeName}this.shape.users={[m.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new o(".slider-edit-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,breakpoints:{768:{slidesPerView:1},992:{slidesPerView:2}}});if(this.shape.shapeName)this.validateShape();this.updateSlider()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){const a=e.detail.name;const t=e.detail.value;this.shape[a]=t;if((a=="A"||a=="B"||a=="H"||a=="L")&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0){this.shape.volume=this.shape.getVolume();this.shape.radius=this.shape.getInternalRadius()}this.validateShape()}validateShape(){this.validShape=s.exports.isString(this.shape.shapeTypeId)&&s.exports.isString(this.shape.shapeName)&&s.exports.isNumber(this.shape.A)&&s.exports.isNumber(this.shape.B)&&s.exports.isNumber(this.shape.H)&&s.exports.isNumber(this.shape.L)&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0;this.updateSlider()}async selectType(e){this.shape.shapeTypeId=e.detail.value;await d.setDwgForShape(this.shape);this.validateShape()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editDrawing(){if(!this.shape.dwg){this.shape.dwg=new r}this.shape.dwg.id=this.shapeId;this.shape.dwg.name=this.shape.shapeName;const e=await f.openPopover("popover-media-loading",{media:this.shape.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const a={[e.data.media.id]:e.data};const t=e.data.media;const i=await f.openPopover("popover-media-uploader",{files:a,itemId:this.shapeId,collectionId:h});i.onDidDismiss().then((e=>{if(e&&e.data){const a=e.data;this.shape.dwg=t;Object.keys(a).forEach((e=>{this.shape.dwg.url=a[e]}));this.save(false);this.updateSlider()}}))}}))}async deleteShape(){try{await d.deleteShape(this.shapeId);n.dismiss()}catch(e){if(e)b.presentAlertError(e)}}async save(e=true){const a=await d.updateShape(this.shapeId,this.shape,this.userProfile.uid);if(!this.shapeId){this.shapeId=a.id}e?n.dismiss():undefined}async cancel(){return n.dismiss()}render(){return a(t,{key:"e49aef135d27e1f506a8b1dc94d97f06eef48368"},a("app-header-segment-toolbar",{key:"995b50700f9ef9a65fcf79cb9d2a7cecc485edf1",color:u.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"1e0c0eab1f077edb4e5a23c26f65af1a6ce5538a",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},a("swiper-container",{key:"24eac3fd9c2e013f341a614ff673016e6c8e9e94",class:"slider-edit-shape swiper"},a("swiper-wrapper",{key:"b849668a7165b10945e7cba233282e26406c3d96",class:"swiper-wrapper"},a("swiper-slide",{key:"ed155f338f19e0709db1627857ddc1a29f852609",class:"swiper-slide"},a("ion-list",{key:"67a38394c6b14a20c609ac4d82244e80d17c2baa",class:"ion-no-padding"},this.shapeTypes?a("app-select-search",{color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.shape&&this.shape.shapeTypeId?this.shape.shapeTypeId:null,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"]}):undefined,a("app-form-item",{key:"89ab4b8e14e8e4e2547cef5b0ff1d03281181447",lines:"inset","label-tag":"name","label-text":"Name",value:this.shape.shapeName,name:"shapeName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"13e06d020a516a565ac2d867689aa28420c98d27",lines:"inset","label-tag":"shortName","label-text":"Short Name",value:this.shape.shapeShortName,name:"shapeShortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e)}),a("app-form-item",{key:"8f10657e662e8b3c170fcfec52a62726a1ede370","label-text":"H",value:this.shape.H,appendText:" (mm)",name:"H","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"d9e9a3cde9efe4c460f6299efca387fdc32935ad","label-text":"H1",value:this.shape.H1,appendText:" (mm)",name:"H1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"062e984fd3720811c6a71b500d889d61709e2371","label-text":"H2",value:this.shape.H2,appendText:" (mm)",name:"H2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"046c5291a348288edf3086ca7f838b04b47b24e9","label-text":"L",value:this.shape.L,appendText:" (mm)",name:"L","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"47ba0ce80de9b02cb2c00bc9bdcea51afb15c0e4","label-text":"L1",appendText:" (mm)",value:this.shape.L1,name:"L1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"891c66e93fa20571520fa666fe980106a5002217","label-text":"La",appendText:" (mm)",value:this.shape.La,name:"La","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"5dbc4ac6832ca645f403f95a1eb7656f974b3c49","label-text":"Lb",appendText:" (mm)",value:this.shape.Lb,name:"Lb","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"2658c700dc238d52bd694a95e0a10c62600d5320","label-text":"A",appendText:" (mm)",value:this.shape.A,name:"A","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"14581a3edb2df643454af13c2a73a35c17e1ce71","label-text":"A1",appendText:" (mm)",value:this.shape.A1,name:"A1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"0fedf7cc2dbbd087c0f43f0bb72e67308dfbdf6b","label-text":"B",appendText:" (mm)",value:this.shape.B,name:"B","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"bcedfd0d57593b91747a0eaa35f6e8da9f1d1939","label-text":"B1",appendText:" (mm)",value:this.shape.B1,name:"B1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"1428ca207fa0088b09b3ebd34d76735eeb053d7e","label-text":"ANG",appendText:" (°)",value:this.shape.ANG,name:"ANG","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"1f5a24af47f4afa0d5f82767d3c2549df0af039f","label-text":"ANG1",appendText:" (°)",value:this.shape.ANG1,name:"ANG1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"dbd8aae3aab03226b8389078e908e41e566e240a","label-text":"D",appendText:" (mm)",value:this.shape.D,name:"D","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"502a98667b5c4c1d3e3b8a12ebe2eca392735345","label-text":"D1",appendText:" (mm)",value:this.shape.D1,name:"D1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"f8f39822521cf979b2a6b98ce8d9f46ac0d18b9f","label-text":"D2",appendText:" (mm)",value:this.shape.D2,name:"D2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"7a868d3021a43e13d6c437fd5b92c03ae1c49b69","label-text":"D3",appendText:" (mm)",value:this.shape.D3,name:"D3","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"d1975008bfb657f72b2e12ea9ce732536b8280e1","label-text":"D4",appendText:" (mm)",value:this.shape.D4,name:"D4","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"3e66869f3dd9a9e0079c09d3487cfbf581c98f26","label-text":"De",appendText:" (mm)",value:this.shape.De,name:"De","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"0e5b1f5aae30d4edc1ce6bf1fbeb63765d99e79f","label-text":"Di",appendText:" (mm)",value:this.shape.Di,name:"Di","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"4a0998423ef00521ef5ba14a9d07e11ab5d1a181","label-text":"N",appendText:" (mm)",value:this.shape.N,name:"N","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"c611751457f71f6c89b159942541e952f8425e8b","label-text":"Decimals",value:this.shape.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:0}}]}),a("app-form-item",{key:"23aae5c483f543fd2a5e43a53246083e28786b63","label-text":"Radius",appendText:(this.shape.shapeTypeId=="su-brick"?" MIN":"")+" (mm)",value:this.shape.radius,name:"radius","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),this.shape.shapeTypeId=="su-brick"?a("app-form-item",{"label-text":"Radius",appendText:" MAX (mm)",value:this.shape.radius_max,name:"radius_max","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:this.shape.radius}}]}):undefined,a("app-form-item",{key:"6086b745656cd297786293c5a1613e024ecef049","label-text":"Volume",appendText:" (dm3)",value:this.shape.volume,name:"volume","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]})),this.shapeId?a("ion-footer",{class:"ion-no-border"},a("ion-toolbar",null,a("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteShape()},a("ion-icon",{slot:"start",name:"trash"}),a("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),a("swiper-slide",{key:"538e7b399c5759affb440835e33c0f6fa48c61f0",class:"swiper-slide"},a("app-banner",{key:"7ab9ec44c8cf3a948d66bd63d5c5350516c2a145",scrollTopValue:this.scrollTop,backgroundCoverFill:false,heightPx:500,link:this.shape.dwg?this.shape.dwg.url:null}),a("ion-footer",{key:"ccf7a849962339fdf29783f070650b4b06a83c85",class:"ion-no-border"},a("ion-toolbar",{key:"5f5afeebe3867875074dae80155bd9abd377013c"},a("ion-button",{key:"e1e5f77fe391d32540456f2fc1d6732a7a5eaf75",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeId,onClick:()=>this.editDrawing()},a("ion-icon",{key:"1b5318cf60e462350c089bd9d4ee865414f30a29",slot:"start",name:"create"}),a("ion-label",{key:"834ff75c08256735cce55e2ee3ace87d4898377f"},!this.shapeId?c.getTransl("media-loader-error","Please save the item to upload new media."):c.getTransl("edit_dwg","Edit Drawing"))))))))),a("app-modal-footer",{key:"e3344346634fd4d1fd509b0008f5be21dec20455",color:u.getAppColor(),disableSave:!this.validShape,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=x;export{y as modal_shape_update};