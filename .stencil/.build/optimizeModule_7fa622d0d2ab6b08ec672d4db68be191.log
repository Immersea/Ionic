import{R as t,Y as e,E as s,S as i,o as n,Z as r}from"./p-26083a07.js";import{l as a}from"./p-1af05547.js";class o{constructor(){this.shouldBeAsync=true;this.publishableKeyTest_Immersea="pk_test_51IyID2DiIthbhXzgcmfDTzMVwJEf8cXgDaMgWdulWi1yjdKdTEYaj9FZXeFiGRWlR9P8IXDpYnkD84OyrGlikLfI00PE5fMGdl";this.publishableKeyProd_Immersea="sk_test_51IyID2DiIthbhXzg0non2BblyCy3l2qF4hiTybt5ZQaFZ3OJLvmGsFK3Z4JI8omJru3sWjTuHxh3ZCnNWqsFLYG300Lnvr5vYV";this.publishableKeyTest_ORange="pk_test_51IvOEYEKefFL9WPBfoYdfFjPfbnvO9gK8A5wAD5cnpzbJmtYugrv45nowbB1P50jn2ECZ9xcbk49SWTS6dqDDMgR00dtep8t1v";this.publishableKeyProd_ORange="pk_live_51IvOEYEKefFL9WPBMN1NQ3iqosSXd9X62oF3tI6kWclmEoDUYlbXu7BqBNDTtZUGbMhRr4Z74pNVcjUVvc9kI5DN004WVwJgzv";this.test=true;this.immersea=true;this.publishableKey=this.test?this.immersea?this.publishableKeyTest_Immersea:this.publishableKeyTest_ORange:this.immersea?this.publishableKeyProd_Immersea:this.publishableKeyProd_ORange;this.stripe=null}initStripe(){this.stripe=Stripe(this.publishableKey)}async payWithCard(e,s,i,n){this.paymentCollectionID=e;this.paymentId=s;var r={collectionId:e,orderId:s,amount:a.exports.round(i,2)*100,currency:"eur",connectedAccountID:n,application_fee_amount:0};console.log("options",r);t.openModal("app-stripe-pay",r,false)}async connectStripeUser(){let t;try{t=await e(r,"stripeConnectStandardUser")({link:s.getSiteUrl()})}catch(e){t={error:e}}if(t&&t.error){return{error:t.error}}else{return t}}async retrieveStripeConnectedAccount(t){let s;try{s=await e(r,"stripeRetrieveConnectedAccount")({accountID:t})}catch(t){s={error:t}}if(s&&s.error){return{error:s.error}}else{return s}}async makePaymentIntent(t,s,n){if(Stripe){this.stripe=Stripe(this.publishableKey);if(n){this.el=n}const o={amount:a.exports.round(t,2),currency:s};this.el.querySelector("button").disabled=false;let c;try{c=await e(r,"createPaymentIntent")(o)}catch(t){c={error:t}}if(c&&c.error){i.presentAlertError(c.error)}else{const t=await this.setupElements(c.data);this.el.querySelector("button").disabled=false;const e=this.el.querySelector("#payment-form");e.addEventListener("submit",(e=>{e.preventDefault();this.pay(t.stripe,t.card,t.clientSecret)}))}}}async makePaymentIntentToConnectedAccount(t,s,n,o,c){if(Stripe){this.stripe=Stripe(this.publishableKey,{stripeAccount:o});if(c){this.el=c}const h={amount:a.exports.round(t,2),currency:s,payment_method_types:["card"],application_fee_amount:n,connectedStripeAccount:o};this.el.querySelector("button").disabled=false;let l;try{l=await e(r,"createPaymentIntentForConnectedAccount")(h)}catch(t){l={error:t}}if(l&&l.error){i.presentAlertError(l.error)}else{const t=await this.setupElements(l.data);this.el.querySelector("button").disabled=false;const e=this.el.querySelector("#payment-form");e.addEventListener("submit",(e=>{e.preventDefault();this.pay(t.stripe,t.card,t.clientSecret)}))}}}setupElements(t){var e=this.stripe.elements();var s={base:{color:"#32325d",fontFamily:"Arial, sans-serif",fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#32325d"}},invalid:{fontFamily:"Arial, sans-serif",color:"#fa755a",iconColor:"#fa755a"}};var i=e.create("card",{style:s});i.mount("#card-element");i.on("change",(t=>{this.el.querySelector("button").disabled=t.empty;this.el.querySelector("#card-errors").textContent=t.error?t.error.message:""}));return{stripe:this.stripe,card:i,clientSecret:t.clientSecret}}pay(t,e,s){this.changeLoadingState(true);t.confirmCardPayment(s,{payment_method:{card:e}}).then((t=>{if(t.error){this.showError(t.error.message)}else{this.orderComplete(s)}}))}orderComplete(t){this.stripe.retrievePaymentIntent(t).then((t=>{const e=t.paymentIntent;this.updatePaymentStatus(e.id,e.status);this.el.querySelector(".sr-payment-form").classList.add("hidden");this.el.querySelector("#success").classList.remove("hidden");this.changeLoadingState(false)}))}async showError(t){this.changeLoadingState(false);var e=this.el.querySelector(".sr-field-error");e.textContent=t;setTimeout((()=>{e.textContent=""}),4e3);this.updatePaymentStatus(null,"error")}async updatePaymentStatus(t,e){const s=await n.getDocument(this.paymentCollectionID,this.paymentId);const i={id:t,status:e,payAt:"stripe"};s.paymentStaus=i;await n.updateDocument(this.paymentCollectionID,this.paymentId,s)}changeLoadingState(t){if(t){this.el.querySelector("button").disabled=true;this.el.querySelector("#spinner").classList.remove("hidden");this.el.querySelector("#button-text").classList.add("hidden")}else{this.el.querySelector("button").disabled=false;this.el.querySelector("#spinner").classList.add("hidden");document.querySelector("#button-text").classList.remove("hidden")}}}const c=new o;export{c as S};