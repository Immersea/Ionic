import{r as e,h as t,H as s,f as i}from"./p-cbe60c68.js";import{T as a,e as c,d as o,S as d,at as n,au as l,U as h}from"./p-944b5726.js";import"./p-c7ee7cfe.js";import{b as f,n as b}from"./p-c2915cc5.js";import{l as r}from"./p-1af05547.js";import{S as p}from"./p-a75993af.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const u="modal-diving-class-update ion-list{width:100%}modal-diving-class-update app-diving-class-schedule{width:100%}modal-diving-class-update ion-segment-button{--color-checked:var(--ion-color-divingclass-contrast)}";const m=u;const v=class{constructor(t){e(this,t);this.divingClassId=undefined;this.collectionId=undefined;this.organiserId=undefined;this.divingClass=undefined;this.updateView=true;this.validClass=false;this.selectedCourse=undefined;this.addressText=undefined;this.titles=[{tag:"details"},{tag:"schedule"},{tag:"team"},{tag:"students"}];this.slider=undefined;this.selectGotFocus=false}async componentWillLoad(){await this.loadDivingClass();this.statusTitles={active:a.getTransl("active","Active"),closed:a.getTransl("closed","Closed"),cancelled:a.getTransl("cancelled","Cancelled")};this.placeholder=a.getTransl("insert-title","Insert title");if(this.organiserId==c.selectedDivingSchoolId){this.divingSchool=c.selectedDivingSchool}else if(this.collectionId==o){this.divingSchool=await c.getDivingSchool(this.organiserId)}this.divingAgencies=d.systemPreferences.divingAgencies;this.divingCourses=await d.getDivingCoursesForSchool(this.divingSchool);if(this.divingClass&&this.divingClass.course){this.selectedCourse=this.divingCourses.find((e=>e.agencyId===this.divingClass.course.agencyId&&e.id===this.divingClass.course.certificationId))}}async loadDivingClass(){if(this.divingClassId){this.divingClass=await n.getDivingClass(this.divingClassId);this.collectionId=this.divingClass.organiser.collectionId;this.organiserId=this.divingClass.organiser.id}else{this.divingClass=new l;this.divingClass.organiser={collectionId:this.collectionId,id:this.organiserId};this.divingClass.users={[h.userRoles.uid]:["owner","instructor"]}}this.addressText=this.divingClass.location&&this.divingClass.location.display_name?this.divingClass.location.display_name:null}async componentDidLoad(){this.slider=new p(".slider-dive-class",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.appBookings=this.el.getElementsByTagName("app-dive-class-bookings")[0];this.appSchedule=this.el.getElementsByTagName("app-diving-class-schedule")[0];this.createCourseSelectOptions();this.validateClass()}createCourseSelectOptions(){this.selectCourseElement=this.el.querySelector("#dive-course-select");const e={header:a.getTransl("diving-course","Diving Course")};const t=Array.from(this.selectCourseElement.getElementsByTagName("ion-select-option"));t.map((e=>{this.selectCourseElement.removeChild(e)}));this.selectCourseElement.interfaceOptions=e;r.exports.each(this.divingCourses,(e=>{const t=document.createElement("ion-select-option");t.value=e;t.textContent=this.divingAgencies[e.agencyId].name+" - "+e.name;this.selectCourseElement.appendChild(t)}))}async changeCourse(e){if(this.selectGotFocus&&this.divingClass&&this.divingClass.activities&&this.divingClass.activities.length>0){const t=await f.create({header:a.getTransl("diving-course","Diving Course"),message:a.getTransl("update-class-activities","This will update all class activities! Are you sure?"),buttons:[{text:a.getTransl("ok","OK"),handler:()=>{this.selectGotFocus=false;this.updateCourseDetails(e)}},{text:a.getTransl("cancel","Cancel"),handler:()=>{this.selectGotFocus=false;this.createCourseSelectOptions();this.selectedCourse=Object.assign({},this.selectedCourse)},role:"cancel",cssClass:"secondary"}]});t.present()}else{this.updateCourseDetails(e)}}updateCourseDetails(e){this.selectedCourse=e;this.divingClass.name=this.divingAgencies[this.selectedCourse.agencyId].name+" - "+this.selectedCourse.name;this.divingClass.activities=r.exports.cloneDeep(e.activities);this.divingClass.numberOfStudents=e.numberOfStudents;this.divingClass.course={certificationId:e.id,agencyId:e.agencyId};this.appBookings.updateStudentsList();this.appSchedule.updateClassSchedule();this.validateClass()}selectLocation(e){this.divingClass.location=e;this.addressText=e.display_name;this.validateClass()}updateStudents(e){this.divingClass.numberOfStudents=r.exports.toNumber(e);this.appBookings.updateStudentsList();this.validateClass()}updateStatus(e){this.divingClass.status=e;this.validateClass()}handleChange(e){this.divingClass[e.detail.name]=e.detail.value;this.validateClass()}validateClass(){this.validClass=r.exports.isString(this.divingClass.name)&&this.divingClass.numberOfStudents>0&&this.divingClass.location&&r.exports.isString(this.divingClass.location.display_name)&&r.exports.isString(this.divingClass.status)&&Object.keys(this.divingClass.schedule).length>0;this.updateView=!this.updateView}async save(){await n.updateDivingClass(this.divingClassId,this.divingClass);return b.dismiss(false)}async cancel(){return b.dismiss(true)}render(){return t(s,{key:"cc75ec2aa6ba32c703b9de6f00e5de59b262907e"},this.selectedCourse&&this.selectedCourse.photoURL?t("ion-header",null,t("app-item-cover",{item:this.selectedCourse})):undefined,this.selectedCourse?t("ion-header",null,t("ion-toolbar",{color:"divingclass"},t("ion-title",null,this.divingClass.name))):undefined,t("app-header-segment-toolbar",{key:"6079222322d54fa5be01949435a2e70f7c7ab561",color:"divingclass",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"a87ba3d6dbed922e2bb18b36319ca09c00daec43",class:"slides"},t("swiper-container",{key:"8f4abfc49303fcdef728ca8b205b631c4683801d",class:"slider-dive-class swiper"},t("swiper-wrapper",{key:"3b79002bf69407a8d0766b0ace3dedfc30a6a284",class:"swiper-wrapper"},t("swiper-slide",{key:"4c810db053f6769773b4776d14994c7e6d6d7100",class:"swiper-slide"},t("ion-list",{key:"6a2a62f9b42e90eb8a6fb7e9800f66dd0e1d056d"},t("ion-item",{key:"e19524cd6e2a28209dd632ad83093f15a5d8f913"},t("ion-label",{key:"2f0e27f8a9ba08cdf2944d840210049d3de0231b"},t("my-transl",{key:"d34cd0ffacb5157bd21ac0aa42834a22d906376e",tag:"diving-course",text:"Diving Course"})),t("ion-select",{key:"52f88ad238a7eaa8ccd50e843bf1884df46be271",id:"dive-course-select",interface:"action-sheet",onIonChange:e=>this.changeCourse(e.detail.value),onIonFocus:()=>this.selectGotFocus=true,placeholder:a.getTransl("select","Select"),value:this.selectedCourse})),t("app-form-item",{key:"e1e8523dab516c49f5746a875f47cd2e1dec11ae","label-tag":"name","label-text":"Name",value:this.divingClass.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-item",{key:"4cdb05efedd3be83d049703f48bb581ec86b2818"},t("ion-label",{key:"d079673e7f6689acee53c0778c5d82ef7c775a0e"},t("my-transl",{key:"26792a3fef21ff79870926f8ca0164fbf53486a4",tag:"number-of-students",text:"Number of Students"})),t("ion-select",{key:"fdc7c64c1772f4fd96ddfe71a35c114269a84778",value:this.divingClass.numberOfStudents,onIonChange:e=>this.updateStudents(e.detail.value),interface:"popover"},t("ion-select-option",{key:"7d9b7e33161e45a57140665ebc2f402992618f50",value:1},"1"),t("ion-select-option",{key:"ef68950503829590946415bc91bf33290fa1906a",value:2},"2"),t("ion-select-option",{key:"a2d39f499a58280b59225ff7fb3b1ac74ce42523",value:3},"3"),t("ion-select-option",{key:"1058fbcff08953bc2b3d848c113111a61a2143ce",value:4},"4"),t("ion-select-option",{key:"88182fbbe056d4977a1cc1af35f15ab39e183e0a",value:5},"5"),t("ion-select-option",{key:"731f053cc6e822ce4ea6ef74336ae518673af105",value:6},"6"),t("ion-select-option",{key:"0c3857853b633f1494b86232e8c0221809430c60",value:7},"7"),t("ion-select-option",{key:"b4862785a4c5e8bac4440cf79098bed542095da6",value:8},"8"),t("ion-select-option",{key:"6b3601777fe3f82c66f5394b432395d1bb12f396",value:9},"9"),t("ion-select-option",{key:"8cf6b7d9b758b1931368210c64887480796be03a",value:10},"10"),t("ion-select-option",{key:"bfefc11a876d4aaac0b3cc01f7013c571eff6ddf",value:11},"11"),t("ion-select-option",{key:"111b2822dab44727384b2716868aba233258805c",value:12},"12"),t("ion-select-option",{key:"78f536e08ac10abe6968d157d29c6311c3681d3b",value:13},"13"),t("ion-select-option",{key:"9cf7f92bf5182d77bdee13f995ce86121a2c3ae3",value:14},"14"),t("ion-select-option",{key:"40cc96d2a0be1cd59c0074485933e7c999ec1ae8",value:15},"15"))),t("app-form-item",{key:"e87dc37e45834d5476df0b2a7b6641b25b742aa2","label-tag":"location","label-text":"Location",value:this.addressText,name:"location","input-type":"text",onFormItemChanged:e=>this.addressText=e.detail.value,onFormLocationSelected:e=>this.selectLocation(e.detail),validator:["address"]}),t("ion-item",{key:"a03f52865023fd5e8ba6e50fe225de41507e2249"},t("ion-label",{key:"b9cb0282971f8252246a5632b62ab94a88fa387e"},t("my-transl",{key:"0a54d0849bac19947b8e9bc10d446a53f3ab944e",tag:"status",text:"Status"})),t("ion-select",{key:"31404b53f5e232952a9fb903215039966453db06",value:this.divingClass.status,onIonChange:e=>this.updateStatus(e.detail.value),interface:"popover"},t("ion-select-option",{key:"620ea0d729f9e4d49c8e8714f97c25f54065b638",value:"active"},this.statusTitles.active),t("ion-select-option",{key:"eeb2eee00f2c6b9050d5371f09a415f48951d07b",value:"closed"},this.statusTitles.closed),t("ion-select-option",{key:"a7bc065972fb9ff07bb4192f394062e6080013b1",value:"cancelled"},this.statusTitles.cancelled))),t("app-form-item",{key:"01c0018e9aad2fc40d14ce3ed4927de33266b596","label-tag":"comments","label-text":"Comments",value:this.divingClass.comments,name:"comments","input-type":"text",textRows:4,onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"53655ee1b871050de652f51476325b9b2d1508ac",class:"swiper-slide"},t("app-diving-class-schedule",{key:"7b1be05831dc21246b87842ac3c39daf1b1ee0f1",divingClass:this.divingClass,editable:true,onScheduleEmit:()=>this.validateClass()})),t("swiper-slide",{key:"8bd277afbd7001a85e36b749f91d7042a46401ac",class:"swiper-slide"},t("app-users-list",{key:"4d84077acfc3513eca3ff069e7a9744188d07f84",item:this.divingClass,editable:true,show:["owner","divemaster","instructor"]})),t("swiper-slide",{key:"91f858dccd404292c89e33279922364bfc395923",class:"swiper-slide"},t("app-dive-class-bookings",{key:"1b4b610c9c6831574d6310f0fb0e30be4457634e",divingClass:this.divingClass,divingClassId:this.divingClassId,editable:true}))))),t("app-modal-footer",{key:"919e4f5eefc095abc669793baee73b47c72e8be0",disableSave:!this.validClass,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=m;export{v as modal_diving_class_update};