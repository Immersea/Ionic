import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as s}from"./p-5d4a8e1f.js";import{l as o}from"./p-1af05547.js";import{S as l}from"./p-a75993af.js";import{U as d,n,Q as r,$ as c,a0 as p,T as h,S as m}from"./p-736235c6.js";import{E as f}from"./p-46038295.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-1819cfda.js";import"./p-7ee16e8d.js";const b="modal-datasheet-update #properties-grid .showbool{--ion-grid-column-padding:1px}modal-datasheet-update #properties-grid ion-grid{--ion-grid-column-padding:2px;border-collapse:collapse;border-style:hidden}modal-datasheet-update #properties-grid ion-grid ion-row:first-child{background-color:var(--ion-color-trasteel);font-weight:bold;color:var(--ion-color-trasteel-contrast)}modal-datasheet-update #properties-grid ion-grid ion-col{border:1px solid black;border-bottom:0;border-right:0}modal-datasheet-update #properties-grid ion-grid ion-col:last-child{border-right:1px solid black}modal-datasheet-update #properties-grid ion-grid ion-row:last-child{border-bottom:1px solid black}modal-datasheet-update #properties-grid ion-grid .remove-background{padding:0}modal-datasheet-update #properties-grid ion-grid .remove-background ion-col,modal-datasheet-update #properties-grid ion-grid .remove-background ion-row{border:0px solid black;background-color:white;padding:0}";const u=b;const y=class{constructor(t){e(this,t);this.validDatasheet=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"properties",text:"Properties",disabled:false},{tag:"reference",text:"Reference",disabled:false},{tag:"comments",text:"Comments",disabled:false},{tag:"files",text:"Files",disabled:true}];this.datasheetId=undefined;this.duplicateDatasheet=undefined;this.revision=undefined;this.datasheet=undefined;this.updateView=true;this.scrollTop=0;this.propertyNames={};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=d.userProfile$.subscribe((e=>{this.userProfile=new n(e)}));await this.loadDatasheet()}async loadDatasheet(){if(this.datasheetId){const e=await r.getDatasheet(this.datasheetId);this.datasheet=e}else{const e=new c(this.duplicateDatasheet?this.duplicateDatasheet.datasheet:null);if(this.duplicateDatasheet&&this.revision){e.revisionNo=e.revisionNo+1}else{e.techNo=r.getMaxDatasheetTechNo();e.revisionNo=0}e.users={[d.userRoles.uid]:["owner"]};this.datasheet=e}this.validateDatasheet()}async componentDidLoad(){this.slider=new l(".slider-edit-datasheet",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});if(this.datasheet.productName){setTimeout((()=>{Object.keys(this.datasheet.properties).forEach((e=>{this.selectPropertyNameForIndex(e)}));this.validateDatasheet()}))}}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.datasheet[e.detail.name]=e.detail.value;this.validateDatasheet()}handlePropertyChange(e,t){const a=t.detail.name;let i=t.detail.value;this.datasheet.properties[e][a]=i;this.validateDatasheet()}deleteProperty(e){this.datasheet.properties.splice(e,1);this.validateDatasheet()}validateDatasheet(){this.validDatasheet=o.exports.isString(this.datasheet.productName)&&o.exports.isString(this.datasheet.familyId)&&o.exports.isString(this.datasheet.majorFamilyId)&&o.exports.isString(this.datasheet.techNo)&&this.datasheet.classification&&o.exports.isString(this.datasheet.categoriesId)&&this.checkParameters();this.updateSlider()}checkParameters(){let e=true;this.datasheet.properties.forEach((t=>{e=e&&r.getDatasheetPropertyNames("id",t.name)&&(t.typical>0||t.higher>0||t.lower>=0)}));return e}selectMajorFamily(e){this.datasheet.majorFamilyId=e.detail.value;this.validateDatasheet()}selectFamily(e){this.datasheet.familyId=e.detail.value;this.validateDatasheet()}selectCategory(e){this.datasheet.categoriesId=e.detail.value;this.validateDatasheet()}addProperty(){this.datasheet.properties.push(new p);setTimeout((()=>{this.setPropertyTypeSelect(this.datasheet.properties.length-1)}),100)}async setPropertyTypeSelect(e){const t=this.el.querySelector("#selectPropertyType"+e);if(t){const e={header:h.getTransl("type","Type")};t.interfaceOptions=e;const a=Array.from(t.getElementsByTagName("ion-select-option"));a.map((e=>{t.removeChild(e)}));t.placeholder=h.getTransl("select","Select");r.getDatasheetPropertyTypes().map((e=>{const a=document.createElement("ion-select-option");a.value=e.typeId;a.textContent=h.getTransl(e.typeId,e.typeName);t.appendChild(a)}))}this.validateDatasheet()}selectPropertyType(e,t){this.datasheet.properties[e].type=t.detail.value;this.selectPropertyNameForIndex(e);this.validateDatasheet()}selectPropertyNameForIndex(e){let t=r.getDatasheetPropertyNames();if(t.length==0)t=r.getDatasheetPropertyNames();this.propertyNames[e]=t;this.validateDatasheet()}selectPropertyName(e,t){this.datasheet.properties[e].name=t.detail.value;const a=r.getDatasheetPropertyNames("id",t.detail.value)[0];this.datasheet.properties[e].position=a.position;this.validateDatasheet()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteDatasheet(){try{await r.deleteDatasheet(this.datasheetId);s.dismiss()}catch(e){if(e)m.presentAlertError(e)}}async save(e=true){const t=[];this.datasheet.properties.map((e=>{if(e.type&&e.name){t.push(e)}}));this.datasheet.properties=t;const a=await r.updateDatasheet(this.datasheetId,this.datasheet,this.userProfile.uid);if(!this.datasheetId){this.datasheetId=a.id;if(this.duplicateDatasheet&&this.revision){this.duplicateDatasheet.datasheet.oldProduct=true;await r.updateDatasheet(this.duplicateDatasheet.id,this.duplicateDatasheet.datasheet,this.userProfile.uid)}}e?s.dismiss():this.updateSlider()}async cancel(){return s.dismiss()}render(){return t(a,{key:"db15dfc9c4ad4367538440bba5977398623019e6"},t("app-header-segment-toolbar",{key:"5a814f9c54c2e5eec5a023723e7d2dc0c7ae3a3f",color:f.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"54856f3ccc79d9dc2bd0547544107d441899e50b",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},t("swiper-container",{key:"7cc5a09192624b8524b9f348166830e7169eadda",class:"slider-edit-datasheet swiper"},t("swiper-wrapper",{key:"0d2d1c6d6ffe286c4ee82ed8491b911e8aadbad4",class:"swiper-wrapper"},t("swiper-slide",{key:"e0a34f347f776ca73ab919659ad19e63cfa339e7",class:"swiper-slide"},t("ion-list",{key:"359d1c56939857a0c379299d6b41ad527803e52c",class:"ion-no-padding"},t("app-select-search",{key:"f7e786ff031326ffa47890096006c5720a013f83",color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.datasheet&&this.datasheet.majorFamilyId?this.datasheet.majorFamilyId:null,lines:"inset",selectFn:e=>this.selectMajorFamily(e),selectOptions:r.getDatasheetMajorFamilies(),selectValueId:"majorFamilyId",selectValueText:["majorFamilyName"]}),t("app-select-search",{key:"24003b7eadcb6984a543ba510d07d84b29077c28",color:"trasteel",label:{tag:"product",text:"Product"},labelAddText:"*",value:this.datasheet&&this.datasheet.familyId?this.datasheet.familyId:null,lines:"inset",selectFn:e=>this.selectFamily(e),selectOptions:r.getDatasheetFamilies(),selectValueId:"familyId",selectValueText:["familyName"]}),t("app-select-search",{key:"60547776167c75bb500c7970e3bd4a5ee3dc222f",color:"trasteel",label:{tag:"category",text:"Category"},labelAddText:"*",value:this.datasheet&&this.datasheet.categoriesId?this.datasheet.categoriesId:null,lines:"inset",selectFn:e=>this.selectCategory(e),selectOptions:r.getDatasheetCategories(),selectValueId:"categoriesId",selectValueText:["categoriesName"]}),t("app-form-item",{key:"1f0fbd11289a1a62366c4fbe029229c025dbf655",lines:"inset","label-tag":"tech-no","label-text":"Tech. #",value:this.datasheet.techNo,name:"techNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"b47ab41e4cd922edf7021f6bc3aef69745fd3d21",lines:"inset","label-tag":"revision-no","label-text":"Revision #",value:this.datasheet.revisionNo,name:"revisionNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"9ef7d55dc683933d7a1dd5593a391f52810d1eff",lines:"inset","label-tag":"old","label-text":"Old",value:this.datasheet.oldProduct,name:"oldProduct","input-type":"boolean",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"83277747b10cf9e4836c00360b1d569fd77fcad4",lines:"inset","label-tag":"issued-on-date","label-text":"Issued on Date",value:this.datasheet.issuedOnDate,name:"issuedOnDate","input-type":"date","date-presentation":"date","prefer-wheel":false,onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"e987094a6d5a1ad4c9ddcfb7747aab958d7fcfb3",lines:"inset","label-tag":"product-name","label-text":"Product Name",value:this.datasheet.productName,name:"productName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"6f331ad775b4f46e68651eaa9066fbea0612de1f",lines:"inset","label-tag":"classification","label-text":"Classification",value:this.datasheet.classification,name:"classification","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]}),t("app-form-item",{key:"c419d8be817b2d756ea2c0f6f81a341d2a5bdbb6",lines:"inset","label-tag":"application","label-text":"Application",value:this.datasheet.application,name:"application","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]})),this.datasheetId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteDatasheet()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"0ca93d0cab54f63bac43ba6468eed1e10f6aef68",class:"swiper-slide"},t("div",{key:"14752ccd3d54913a478bfb264705b8e2c49623ef",id:"properties-grid"},t("ion-grid",{key:"43835c9b3529f575f51d7d27c1ccb28c0adb9b31"},t("ion-row",{key:"1e6a04e2b57a9f54fbd1113f6c1931aaedc589d6"},t("ion-col",{key:"51f8a89c863ae1e2a4d14ea9843f2c3702b6aad9",class:"centered"},t("small",{key:"ddffd4446086efad8b42987187ab585bffd42dce"},h.getTransl("type","Type"))),t("ion-col",{key:"dbc2d3cdf5296ac232adea2a1428b15a0fca543a",class:"centered"},t("small",{key:"7716ce6cf93e4f7baa5434e7f91802c91965eadf"},h.getTransl("name","Name"))),t("ion-col",{key:"f7b93d9b4a9cf4c18194ac72857d60a2d4d01621",class:"centered"},t("small",{key:"dac4773f0578e3d54d151985ae936f78dc6c8deb"},h.getTransl("typical","Typical"))),t("ion-col",{key:"369464c8a8f079ec3c3baffbc8d0429d64a47351",class:"centered"},t("small",{key:"a613d436073b35a4d181ff63bb69aa6749c961f4"},h.getTransl("prefix","Prefix"))),t("ion-col",{key:"f8ffb5026670d44b31e01c41a23def8e3dc4cfa5",class:"centered"},t("small",{key:"2626f89a66606fa0550ace04a4136c2b07b55525"},h.getTransl("from","From"))),t("ion-col",{key:"1c483334beb8493a535d386798542df5d2282d5c",class:"centered"},t("small",{key:"012d8db396a54aa84c6d5927c754dbe2d35b91f4"},h.getTransl("to","To"))),t("ion-col",{key:"8100478dda416163ef339ea9c76c9583796dfa69",size:"1",class:"centered"},t("small",{key:"2aa1f186d2e0260a995288c1a89b70ee874baeb1"},h.getTransl("show","Show")+"/"+h.getTransl("delete","Delete")))),this.datasheet.properties.map(((e,a)=>t("ion-row",null,t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.type?e.type:null,lines:"none",selectFn:e=>this.selectPropertyType(a,e),selectOptions:r.getDatasheetPropertyTypes(),selectValueId:"typeId",selectValueText:["typeName"]})),t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.name?e.name:null,lines:"none",disabled:!this.propertyNames[a],selectFn:e=>this.selectPropertyName(a,e),selectOptions:this.propertyNames[a],selectValueId:"nameId",selectValueText:["nameName"]})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.typical,name:"typical","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.prefix,name:"prefix","input-type":"text",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.lower,name:"lower","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.higher,name:"higher","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{size:"1",class:"centered "},t("ion-grid",{class:"remove-background"},t("ion-row",null,t("ion-col",{class:"centered"},t("app-form-item",{class:"ion-no-padding",value:e.show,name:"show","input-type":"boolean",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("ion-button",{class:"ion-no-padding","icon-only":true,color:"danger",fill:"clear",onClick:()=>this.deleteProperty(a)},t("ion-icon",{name:"trash"}))))))))))),t("io-item",{key:"b0206df87c37303e4de317f10c0b521355112d00"},t("ion-button",{key:"7d208afa0de3cb31194a692637d09b581a807e88",expand:"full",shape:"round",color:"trasteel",size:"small",onClick:()=>this.addProperty()},"+"))),t("swiper-slide",{key:"9fe1b2c8dd22d5b8907155a04c98f5f2080deb1f",class:"swiper-slide"},t("ion-list",{key:"e535809a1c8407c3b982e91b309e7c7a8153cc54"},t("app-form-item",{key:"f0dd60ad515823e16538a5ecc8c2611fc5ceb271",lines:"inset","label-tag":"producer","label-text":"Producer",value:this.datasheet.producerName,name:"producerName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"5eaae71d49d739071291059508c69f3710da243b",lines:"inset","label-tag":"producer-ref-quality","label-text":"Producer Reference Quality",value:this.datasheet.producerReferenceQuality,name:"producerReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"d584f93513ec0b1725e5306ee6edd82d2a01190d",lines:"inset","label-tag":"competitor-ref-quality","label-text":"Competitor Reference Quality",value:this.datasheet.competitorReferenceQuality,name:"competitorReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"5a3cccb2d2f911a9dd50d71fcf6abb2ea60ebda1",class:"swiper-slide"},t("ion-list",{key:"689cbedbb16d98e5a398e8e429febb87c0eb183d"},t("app-form-item",{key:"2e9c2f5606d593f81a794b9662c0b509f57cf33c",lines:"inset","label-tag":"comments","label-text":"Comments",value:this.datasheet.comments,name:"comments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"7dd87cfe445e9185336609f272e0ef0b07c72340",lines:"inset","label-tag":"performance-comments","label-text":"Performance Comments",value:this.datasheet.performanceComments,name:"performanceComments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"ab313f3d48035904fbda017a2e9c919539b96a4d",class:"swiper-slide"},"FILES - TO BE DONE")))),t("app-modal-footer",{key:"75053e67c415dc3e707ad5267e1ba680112fa015",color:f.getAppColor(),disableSave:!this.validDatasheet,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=u;export{y as modal_datasheet_update};