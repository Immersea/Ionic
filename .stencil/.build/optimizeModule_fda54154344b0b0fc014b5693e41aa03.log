import{bn as e,c4 as t}from"./p-773bd3de.js";import{C as a,a as i}from"./p-e7cdf6db.js";import"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-1af05547.js";import"./p-e9c4f463.js";import"./p-c2915cc5.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";class o extends e{async getPhoto(e){return new Promise((async(t,i)=>{if(e.webUseInput||e.source===a.Photos){this.fileInputExperience(e,t)}else if(e.source===a.Prompt){let a=document.querySelector("pwa-action-sheet");if(!a){a=document.createElement("pwa-action-sheet");document.body.appendChild(a)}a.header=e.promptLabelHeader||"Photo";a.cancelable=false;a.options=[{title:e.promptLabelPhoto||"From Photos"},{title:e.promptLabelPicture||"Take Picture"}];a.addEventListener("onSelection",(async a=>{const o=a.detail;if(o===0){this.fileInputExperience(e,t)}else{this.cameraExperience(e,t,i)}}))}else{this.cameraExperience(e,t,i)}}))}async pickImages(e){return new Promise((async e=>{this.multipleFileInputExperience(e)}))}async cameraExperience(e,a,o){if(customElements.get("pwa-camera-modal")){const s=document.createElement("pwa-camera-modal");s.facingMode=e.direction===i.Front?"user":"environment";document.body.appendChild(s);try{await s.componentOnReady();s.addEventListener("onPhoto",(async i=>{const n=i.detail;if(n===null){o(new t("User cancelled photos app"))}else if(n instanceof Error){o(n)}else{a(await this._getCameraPhoto(n,e))}s.dismiss();document.body.removeChild(s)}));s.present()}catch(t){this.fileInputExperience(e,a)}}else{console.error(`Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements.`);this.fileInputExperience(e,a)}}fileInputExperience(e,t){let o=document.querySelector("#_capacitor-camera-input");const s=()=>{var e;(e=o.parentNode)===null||e===void 0?void 0:e.removeChild(o)};if(!o){o=document.createElement("input");o.id="_capacitor-camera-input";o.type="file";o.hidden=true;document.body.appendChild(o);o.addEventListener("change",(a=>{const i=o.files[0];let n="jpeg";if(i.type==="image/png"){n="png"}else if(i.type==="image/gif"){n="gif"}if(e.resultType==="dataUrl"||e.resultType==="base64"){const a=new FileReader;a.addEventListener("load",(()=>{if(e.resultType==="dataUrl"){t({dataUrl:a.result,format:n})}else if(e.resultType==="base64"){const e=a.result.split(",")[1];t({base64String:e,format:n})}s()}));a.readAsDataURL(i)}else{t({webPath:URL.createObjectURL(i),format:n});s()}}))}o.accept="image/*";o.capture=true;if(e.source===a.Photos||e.source===a.Prompt){o.removeAttribute("capture")}else if(e.direction===i.Front){o.capture="user"}else if(e.direction===i.Rear){o.capture="environment"}o.click()}multipleFileInputExperience(e){let t=document.querySelector("#_capacitor-camera-input-multiple");const a=()=>{var e;(e=t.parentNode)===null||e===void 0?void 0:e.removeChild(t)};if(!t){t=document.createElement("input");t.id="_capacitor-camera-input-multiple";t.type="file";t.hidden=true;t.multiple=true;document.body.appendChild(t);t.addEventListener("change",(i=>{const o=[];for(let e=0;e<t.files.length;e++){const a=t.files[e];let i="jpeg";if(a.type==="image/png"){i="png"}else if(a.type==="image/gif"){i="gif"}o.push({webPath:URL.createObjectURL(a),format:i})}e({photos:o});a()}))}t.accept="image/*";t.click()}_getCameraPhoto(e,t){return new Promise(((a,i)=>{const o=new FileReader;const s=e.type.split("/")[1];if(t.resultType==="uri"){a({webPath:URL.createObjectURL(e),format:s,saved:false})}else{o.readAsDataURL(e);o.onloadend=()=>{const e=o.result;if(t.resultType==="dataUrl"){a({dataUrl:e,format:s,saved:false})}else{a({base64String:e.split(",")[1],format:s,saved:false})}};o.onerror=e=>{i(e)}}}))}async checkPermissions(){if(typeof navigator==="undefined"||!navigator.permissions){throw this.unavailable("Permissions API not available in this browser")}try{const e=await window.navigator.permissions.query({name:"camera"});return{camera:e.state,photos:"granted"}}catch(e){throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const s=new o;export{s as Camera,o as CameraWeb};