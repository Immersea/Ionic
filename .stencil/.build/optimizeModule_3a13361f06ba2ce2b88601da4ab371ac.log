import{r as e,h as t,H as i,f as a}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as n,n as l}from"./p-c2915cc5.js";import{U as s,W as o,T as c,E as d}from"./p-944b5726.js";import{U as r,a as h,P as u,b as f}from"./p-d2a582b5.js";import{U as p}from"./p-0d594f67.js";import{l as m}from"./p-1af05547.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const b="modal-user-plans-update ion-list{width:100%}";const y=b;const g=class{constructor(t){e(this,t);this.uid=undefined;this.userPlans=new r;this.planIndex=undefined;this.userPlan=new h;this.validPlan=false;this.selectedCustomer=undefined;this.updateView=false}async componentWillLoad(){if(!this.uid)this.uid=s.userProfile.uid;if(this.planIndex>=0){this.userPlan=m.exports.cloneDeep(this.userPlans.userPlans[this.planIndex]);this.selectedCustomer=o.getCustomersDetails(this.userPlan.customerId)}else{this.userPlan=new h}}async componentDidLoad(){this.validatePlan()}async openSelectCustomer(){const e=await o.openSelectCustomer(this.selectedCustomer);if(e){this.userPlan.customerId=e.id;this.selectedCustomer=e}}addAction(){this.userPlan.planOfActions.push(new u);this.validatePlan()}handleOtherChange(e){this.userPlan.otherName=e.detail.value;this.validatePlan()}handleChange(e,t){e[t.detail.name]=t.detail.value;e.updated=(new Date).toISOString();this.validatePlan()}removePlan(e){this.userPlan.planOfActions.splice(e,1);this.validatePlan()}async deletePlan(){const e=await n.create({header:c.getTransl("delete-plan","Delete Plan"),message:c.getTransl("delete-plan-message","This plan will be deleted! Are you sure?"),buttons:[{text:c.getTransl("ok","OK"),handler:async()=>{this.save(true)}},{text:c.getTransl("cancel","Cancel"),handler:async()=>{}}]});e.present()}validatePlan(){this.validPlan=true;this.validPlan=this.validPlan&&(this.userPlan.customerId!=null||this.userPlan.otherName!=null);let e=this.userPlan.planOfActions.length>0;this.userPlan.planOfActions.forEach((t=>{e=e&&t.dueDate!=null;e=e&&t.updated!=null;e=e&&t.product!=null;e=e&&t.plan!=null;e=e&&t.situation!=null}));this.validPlan=this.validPlan&&e;this.updateView=!this.updateView}async save(e=false){if(!this.userPlans.users){this.userPlans.users={};this.userPlans.users[this.uid]=["owner"]}if(this.planIndex>=0&&this.userPlan.planOfActions.length==0){e=true}if(this.planIndex>=0&&!e){this.userPlans.userPlans[this.planIndex]=this.userPlan}else if(e){this.userPlans.userPlans.splice(this.planIndex)}else{this.userPlans.userPlans.push(this.userPlan)}await p.updateUserPlan(this.uid,this.userPlans);l.dismiss()}async cancel(){return l.dismiss()}render(){return t(i,{key:"7c703e8fcf85f01ac7e400666f596e4cc9acc3ad"},t("ion-header",{key:"bfac3b4d2d794481019511072dbd614742d8a58b"},t("ion-toolbar",{key:"12f25243214576c6362c637353ca5eb198c03695",color:"trasteel"},t("ion-title",{key:"6d7d80140658ff48a8df5ee810f2f281c947b35d"},t("my-transl",{key:"b597a21068684e55fe6eb00665c702b6487cdf75",tag:"plan-of-actions",text:"Plan of Actions"})))),t("ion-content",{key:"81bc8d85c4bfa2ee9bd77d40bce6ac4804a61cd9"},t("ion-list",{key:"88e057acd3a1bb8b82bdb836a938cfb5952e205d"},this.userPlan.otherName==null?t("ion-item",{button:true,lines:"inset",onClick:()=>this.openSelectCustomer()},t("ion-label",null,t("p",{class:"small"},t("my-transl",{tag:"customer",text:"Customer"}),"*"),t("h2",null,this.selectedCustomer?this.selectedCustomer.fullName:null))):undefined,this.userPlan.customerId==null&&this.userPlan.otherName==null?t("ion-item-divider",null,t("ion-label",null,"- or -")):undefined,this.userPlan.customerId==null?t("app-form-item",{lines:"inset","label-tag":"other","label-text":"Other",value:this.userPlan.otherName,name:"otherName","input-type":"string",onFormItemChanged:e=>this.handleOtherChange(e)}):undefined,t("ion-button",{key:"64b3013deb07d9e9fa7fd6edbb9e57d2dc01ea7d",color:"trasteel",fill:"outline",expand:"full",disabled:this.userPlan.customerId==null&&this.userPlan.otherName==null,onClick:()=>{this.addAction()}},t("ion-icon",{key:"48894bd82566e33aa4342a7a0097a2bfc3a3e01e",name:"add",slot:"start"}),t("ion-label",{key:"7af9aea21c613005496fcc9c58c2b99842b6611e"},t("my-transl",{key:"93d1c216a7896f7c14927356a2163bc66a5ffa98",tag:"add-action",text:"Add Action"}))),t("ion-grid",{key:"906c8a5676e5d54cf8c827a4e13e821e8730ce72"},this.userPlan.planOfActions.map(((e,i)=>[t("ion-row",null,t("ion-col",null,t("ion-select",{color:"trasteel",id:"application",interface:"action-sheet",label:c.getTransl("product","Product"),"label-placement":"floating",onIonChange:t=>{e.product=t.detail.value;this.validatePlan()},value:e.product},Object.keys(f).map((e=>t("ion-select-option",{value:e},f[e]))))),t("ion-col",{size:"3"},t("app-form-item",{lines:"inset","label-tag":"due-date","label-text":"Due Date",value:e.dueDate,name:"dueDate","input-type":"date","date-presentation":"date",onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",{size:"1"},t("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.removePlan(i)},t("ion-icon",{name:"trash",color:"danger"})))),t("ion-row",null,t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"actual-situation","label-text":"Actual Situation",value:e.situation,name:"situation","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]})),t("ion-col",null,t("app-form-item",{lines:"inset","label-tag":"plan","label-text":"Plan",value:e.plan,name:"plan","input-type":"text",textRows:3,onFormItemChanged:t=>this.handleChange(e,t),validator:["required"]}))),t("ion-row",null,t("ion-item-divider",null))]))),this.userPlan.planOfActions.length>0?t("ion-button",{color:"danger",fill:"outline",expand:"full",onClick:()=>{this.deletePlan()}},t("ion-icon",{name:"trash",slot:"start"}),t("ion-label",null,t("my-transl",{tag:"delete",text:"Delete"}))):undefined)),t("app-modal-footer",{key:"2101f95b96282fc91073edf25dfdb239c79af0bd",color:d.getAppColor(),disableSave:!this.validPlan,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return a(this)}};g.style=y;export{g as modal_user_plans_update};