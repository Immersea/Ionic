import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{n}from"./p-c2915cc5.js";import{l as s}from"./p-1af05547.js";import{S as o}from"./p-a75993af.js";import{U as m,p as l,aD as d,aG as p,aN as r,R as b,k as h,S as f,E as c,T as u}from"./p-f42b650b.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const v="modal-shape-update ion-list{width:100%}";const x=v;const y=class{constructor(a){e(this,a);this.validShape=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"drawing",text:"Drawing",disabled:false}];this.shapeId=undefined;this.duplicateShape=undefined;this.shape=undefined;this.updateView=true;this.scrollTop=0;this.shapeTypes=undefined;this.slider=undefined}async componentWillLoad(){this.userProfileSub$=m.userProfile$.subscribe((e=>{this.userProfile=new l(e)}));await this.loadShape()}async loadShape(){this.shapeTypes=await d.getShapeTypes();if(this.shapeId){const e=await d.getShape(this.shapeId);this.shape=e}else{this.shape=new p(this.duplicateShape?this.duplicateShape.shape:null);if(this.duplicateShape){this.shape.shapeName="NEW - "+this.duplicateShape.shape.shapeName}this.shape.users={[m.userRoles.uid]:["owner"]}}}async componentDidLoad(){this.slider=new o(".slider-edit-shape",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,breakpoints:{768:{slidesPerView:1},992:{slidesPerView:2}}});if(this.shape.shapeName)this.validateShape();this.updateSlider()}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){const a=e.detail.name;const t=e.detail.value;this.shape[a]=t;if((a=="A"||a=="B"||a=="H"||a=="L")&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0){this.shape.volume=this.shape.getVolume();this.shape.radius=this.shape.getInternalRadius()}this.validateShape()}validateShape(){this.validShape=s.exports.isString(this.shape.shapeTypeId)&&s.exports.isString(this.shape.shapeName)&&s.exports.isNumber(this.shape.A)&&s.exports.isNumber(this.shape.B)&&s.exports.isNumber(this.shape.H)&&s.exports.isNumber(this.shape.L)&&this.shape.A>0&&this.shape.B>0&&this.shape.H>0&&this.shape.L>0;this.updateSlider()}async selectType(e){this.shape.shapeTypeId=e.detail.value;await d.setDwgForShape(this.shape);this.validateShape()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async editDrawing(){if(!this.shape.dwg){this.shape.dwg=new r}this.shape.dwg.id=this.shapeId;this.shape.dwg.name=this.shape.shapeName;const e=await b.openPopover("popover-media-loading",{media:this.shape.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const a={[e.data.media.id]:e.data};const t=e.data.media;const i=await b.openPopover("popover-media-uploader",{files:a,itemId:this.shapeId,collectionId:h});i.onDidDismiss().then((e=>{if(e&&e.data){const a=e.data;this.shape.dwg=t;Object.keys(a).forEach((e=>{this.shape.dwg.url=a[e]}));this.save(false);this.updateSlider()}}))}}))}async deleteShape(){try{await d.deleteShape(this.shapeId);n.dismiss()}catch(e){if(e)f.presentAlertError(e)}}async save(e=true){const a=await d.updateShape(this.shapeId,this.shape,this.userProfile.uid);if(!this.shapeId){this.shapeId=a.id}e?n.dismiss():undefined}async cancel(){return n.dismiss()}render(){return a(t,{key:"c4519d4ae674644a87236c7730706f9388555f26"},a("app-header-segment-toolbar",{key:"9127330a3f7c9f5490a12eb108b5d16ac7b5b02f",color:c.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"6891a08b1f4519b9dbfe6247338da38714272352",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},a("swiper-container",{key:"514f49b83fd4770c6b2c5b2acfb3ed71f6f10f78",class:"slider-edit-shape swiper"},a("swiper-wrapper",{key:"37750e3e89f182d0ba5bdf061f3f0ad00ac3aeac",class:"swiper-wrapper"},a("swiper-slide",{key:"4b7a69ed1eff4419fecbc6c4cd480103289382f5",class:"swiper-slide"},a("ion-list",{key:"3be666a3fc61d41f87b4b90dc1f593e6c3327a87",class:"ion-no-padding"},this.shapeTypes?a("app-select-search",{color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.shape&&this.shape.shapeTypeId?this.shape.shapeTypeId:null,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"]}):undefined,a("app-form-item",{key:"1dfda7d3d1aa629f469614010924b0cf51d3cadb",lines:"inset","label-tag":"name","label-text":"Name",value:this.shape.shapeName,name:"shapeName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"1506c3d0525a6121711fd104eaa64262462967ab",lines:"inset","label-tag":"shortName","label-text":"Short Name",value:this.shape.shapeShortName,name:"shapeShortName","input-type":"text",onFormItemChanged:e=>this.handleChange(e)}),a("app-form-item",{key:"08b5818333af1f042884097bd7b24f46b66dbd56","label-text":"H",value:this.shape.H,appendText:" (mm)",name:"H","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"dd826a5b12791797256aaad4091d0f98eda8248b","label-text":"H1",value:this.shape.H1,appendText:" (mm)",name:"H1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"86407c8b4c1adda59a7c06869c62dbbe26d64b15","label-text":"H2",value:this.shape.H2,appendText:" (mm)",name:"H2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"73c2aae83357a3d2ace1dc7877cc87e036f9f9d0","label-text":"L",value:this.shape.L,appendText:" (mm)",name:"L","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"169356ae82a081d2ddbaa75f1cbe77ca5a4679aa","label-text":"L1",appendText:" (mm)",value:this.shape.L1,name:"L1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"8946473bc0ce987e942d9bd58a0d9af7caf70073","label-text":"La",appendText:" (mm)",value:this.shape.La,name:"La","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"72a8601918f0f9d9e8895ae647bd440eb20ca14d","label-text":"Lb",appendText:" (mm)",value:this.shape.Lb,name:"Lb","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"e1ecf9391b99a28c19342e74acbcebefb7419dfb","label-text":"A",appendText:" (mm)",value:this.shape.A,name:"A","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"c8b88ca153cdecc96e3c0e324d81d7267dc9a431","label-text":"A1",appendText:" (mm)",value:this.shape.A1,name:"A1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"b894634458a15c1176c4a8c3b97e9bedc0d2e993","label-text":"B",appendText:" (mm)",value:this.shape.B,name:"B","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"9a8257c98c4823045ab534db834ebd994a05a772","label-text":"B1",appendText:" (mm)",value:this.shape.B1,name:"B1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"2e8b7f33141ad4491cb3a7f536a8e1a580b6b3e8","label-text":"ANG",appendText:" (°)",value:this.shape.ANG,name:"ANG","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"98f81893589986c80cbf388857b9be2d6a3597e4","label-text":"ANG1",appendText:" (°)",value:this.shape.ANG1,name:"ANG1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"3c9162c019b4111189a50a800197d39f4562e314","label-text":"D",appendText:" (mm)",value:this.shape.D,name:"D","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"a84eaffeac2c342aba820bf3df3382b7653ff620","label-text":"D1",appendText:" (mm)",value:this.shape.D1,name:"D1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"4b4778f5260c071dc9e80a49c5a00fb6c2875154","label-text":"D2",appendText:" (mm)",value:this.shape.D2,name:"D2","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"4bd4e6b97fce73f2a27ee459d9ef51195d80665c","label-text":"D3",appendText:" (mm)",value:this.shape.D3,name:"D3","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"48868326930c9e6c95b74b09c00d78f47b3fa81a","label-text":"D4",appendText:" (mm)",value:this.shape.D4,name:"D4","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"edcf367a88e3e0d3d8dc6f11f93e20d7dde77076","label-text":"De",appendText:" (mm)",value:this.shape.De,name:"De","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"df0f5fdaa4e75364376bfd2c4de22abd080ba58d","label-text":"Di",appendText:" (mm)",value:this.shape.Di,name:"Di","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"f450a9e6952ffc751846116e9d129438c6267399","label-text":"N",appendText:" (mm)",value:this.shape.N,name:"N","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),a("app-form-item",{key:"72f14bf35d79ede139de01d1fd8f19c252e75b65","label-text":"Decimals",value:this.shape.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:0}}]}),a("app-form-item",{key:"04739cf0421835d6dc63ca06f0e792e76b3b1bbe","label-text":"Radius",appendText:(this.shape.shapeTypeId=="su-brick"?" MIN":"")+" (mm)",value:this.shape.radius,name:"radius","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]}),this.shape.shapeTypeId=="su-brick"?a("app-form-item",{"label-text":"Radius",appendText:" MAX (mm)",value:this.shape.radius_max,name:"radius_max","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:this.shape.radius}}]}):undefined,a("app-form-item",{key:"52be26ff6cadf38fa0b727c932cd8b6d7453bb4d","label-text":"Volume",appendText:" (dm3)",value:this.shape.volume,name:"volume","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:[{name:"minvalue",options:{min:1}}]})),this.shapeId?a("ion-footer",{class:"ion-no-border"},a("ion-toolbar",null,a("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteShape()},a("ion-icon",{slot:"start",name:"trash"}),a("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),a("swiper-slide",{key:"bebd9adbaee0b831b49b830036d57df095933e7e",class:"swiper-slide"},a("app-banner",{key:"1318ed0efec712e5207b8a260742fc63690de073",scrollTopValue:this.scrollTop,backgroundCoverFill:false,heightPx:500,link:this.shape.dwg?this.shape.dwg.url:null}),a("ion-footer",{key:"732763afcc736a3595b6e7368a182605a30fa65c",class:"ion-no-border"},a("ion-toolbar",{key:"0ed449997ae8cf0a046cb1a1a104c6a34a9e61c2"},a("ion-button",{key:"5c26f35353657986e8a04bfda4a2e41f7b60e54c",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeId,onClick:()=>this.editDrawing()},a("ion-icon",{key:"971308df45becaf9c5e2d31f1d8b8d55ca737114",slot:"start",name:"create"}),a("ion-label",{key:"67ee087cc66c4d04c5e803434d3e1e0a82ef678f"},!this.shapeId?u.getTransl("media-loader-error","Please save the item to upload new media."):u.getTransl("edit_dwg","Edit Drawing"))))))))),a("app-modal-footer",{key:"fdf3d6aeb25580b83118660ee629b767207bcf14",color:c.getAppColor(),disableSave:!this.validShape,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=x;export{y as modal_shape_update};