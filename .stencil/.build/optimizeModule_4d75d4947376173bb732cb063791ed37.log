import{r as e,h as t,f as i}from"./p-cbe60c68.js";import{S as a,F as s,R as n,a3 as l,ay as o}from"./p-30358c9d.js";import{S as d}from"./p-a75993af.js";import{T as c}from"./p-87afedc7.js";import{E as f}from"./p-a9f4af61.js";import"./p-2578d979.js";import"./p-1af05547.js";import"./p-e9c4f463.js";import"./p-c7ee7cfe.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const r="page-customer-details{}";const p=r;const h=class{constructor(t){e(this,t);this.markers=[];this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"locations",text:"Locations",disabled:false},{tag:"operating-conditions",text:"Operating Conditions",disabled:false},{tag:"map",text:"Map",disabled:false}];this.itemId=undefined;this.customer=undefined;this.locationTypeSegment=0;this.slider=undefined}async componentWillLoad(){await this.loadCustomer()}async loadCustomer(){await a.presentLoading("loading");try{this.customer=await s.getCustomer(this.itemId);a.dismissLoading();this.markers=[];if(this.customer.locations.length>0){this.customer.locations.forEach((e=>{if(e.position&&e.position.geopoint){const t={latitude:e.position.geopoint.latitude,longitude:e.position.geopoint.longitude,icon:{type:"ionicon",name:"location",color:"secondary",size:"large"}};this.markers.push(t)}}));if(this.markers.length>0)this.loadMap();this.titles[1].disabled=this.customer.locations.length==0;this.titles[2].disabled=!(this.customer.conditions.EAF.length>0||this.customer.conditions.LF.length>0||this.customer.conditions.CCM.length>0);this.titles[3].disabled=this.customer.locations.length==0||this.markers.length==0}}catch(e){a.dismissLoading();n.goBack();a.presentAlertError(e)}}async componentDidLoad(){this.slider=new d(".slider-customer",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});if(this.markers.length>0)this.loadMap()}async loadMap(){await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");if(this.mapElement){const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+(l(this.customer)+20)+"px");setTimeout((()=>{this.mapElement.triggerMapResize();this.mapElement.fitToBounds(this.markers)}))}this.updateSlider()}async editCustomer(){const e=await s.presentCustomerUpdate(this.itemId);e.onDidDismiss().then((()=>this.loadCustomer()))}locationTypeSegmentChanged(e){this.locationTypeSegment=e.detail.value;this.updateSlider()}async openOperatingCondition(e,t){await n.openModal("modal-operating-conditions-questionnaire",{condition:e,conditionData:t,editable:false})}updateSlider(){setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}render(){return[this.customer.coverURL||this.customer.photoURL?t("ion-header",null,t("app-item-cover",{item:this.customer})):undefined,t("ion-header",{key:"ea422aa7fafecc7602fea676e6814f13f911ac88"},t("app-navbar",{key:"ce30f7a11233d6943ecc418245f1479a483fc73f",text:this.customer.fullName,color:"trasteel",backButton:this.customer&&!this.customer.coverURL&&!this.customer.photoURL,rightButtonText:c.isCustomerDBAdmin()?{icon:"create",fill:"outline",tag:"edit",text:"Edit"}:null,rightButtonFc:()=>this.editCustomer()})),t("app-header-segment-toolbar",{key:"05a5e189b719631fe0e821a23a64fa638848a712",color:f.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"c8e28ad305f5f6558396723a87e76e27328bb3bc",class:"slides"},t("ion-fab",{key:"175b4c5290c8821474366b379f3acd6a189600f6",vertical:"top",horizontal:"start",slot:"fixed",style:{marginTop:o(2)}},t("ion-fab-button",{key:"88c2510f276b2418d0cdc6472b0aad9cae563090",onClick:()=>n.goBack(),class:"fab-icon"},t("ion-icon",{key:"b2f86061d5da6a3160d46ffb57bf9169f03d13f2",name:"arrow-back-circle-outline"}))),t("swiper-container",{key:"ae1a4bd704d53b68580fa90590521a9d0847959c",class:"slider-customer swiper"},t("swiper-wrapper",{key:"26791ed63120ce2ad176add933152a2b30fcf5ec",class:"swiper-wrapper"},t("swiper-slide",{key:"4dc61682c38095b2f0933c56079638335b9efc4a",class:"swiper-slide"},t("ion-list",{key:"7526dee0c388119fb8b46ce3545e3234a115e586",class:"ion-no-padding"},t("app-item-detail",{key:"d909082b09b19328d4ed371a71c7c8262c038b43",lines:"none",labelTag:"plant_type",labelText:"Plant Type",detailText:s.getCustomerTypes(this.customer.typeId)[0].typeName}),t("app-item-detail",{key:"e86ad1bad95b391d331fae5f2df6188efe7a1bf6",lines:"none",labelTag:"name",labelText:"Name",detailText:this.customer.fullName}),t("app-item-detail",{key:"304db10f4d9fa56af2f520fbcc2a066945102992",lines:"none",labelTag:"local_name",labelText:"Local Name",detailText:this.customer.fullNameOther}),t("app-item-detail",{key:"280affbb03752000f9d19f6fc4105ab1e9349f59",lines:"none",labelTag:"other_name",labelText:"Other Name",detailText:this.customer.otherPlantName}),t("app-item-detail",{key:"4fc4d86dfad508c8149f91c6ed2d045db43ff35d",lines:"none",labelTag:"other_name",labelText:"Other Local Name",detailText:this.customer.otherPlantNameOther}),t("app-item-detail",{key:"a0a44e76f9ff9c28b10d5b19d16a72e66c52f3fb",lines:"none",labelTag:"short_name",labelText:"Short Name",detailText:this.customer.shortName}),this.customer.group.map(((e,i)=>t("app-item-detail",{lines:"none",labelTag:i==0?"group":null,labelText:i==0?"Group":null,detailText:e.groupName+" ["+e.groupOwnershipPerc+"%]"}))),t("app-item-detail",{key:"0f4a441a9afc0fdc17f0859c64ecf01336cce260",lines:"none",labelTag:"owner",labelText:"Owner",detailText:this.customer.owner.groupName}),t("app-customer-plant-production",{key:"8df2d67790661bade10c0fe6cb265c1a71ebbe7c",customer:this.customer}))),t("swiper-slide",{key:"9991f9cee365568e1b145443e4b37e8a0a08197a",class:"swiper-slide"},t("div",{key:"78327f6cb943d5afb5e2697963344294f7538412"},this.customer.locations.length>0?[t("ion-toolbar",null,t("ion-segment",{mode:"ios",scrollable:true,onIonChange:e=>this.locationTypeSegmentChanged(e),value:this.locationTypeSegment},this.customer.locations.map(((e,i)=>t("ion-segment-button",{value:i,layout:"icon-start"},t("ion-label",null,s.getLocationsTypes(e.type)[0].locationName)))))),this.customer.locations.map(((e,i)=>t("div",null,this.locationTypeSegment==i?t("div",null,t("app-location",{locations:s.getLocationsTypes(),location:e,slider:this.slider,editable:false})):undefined)))]:undefined)),t("swiper-slide",{key:"80d4d5de3ecd36423d8acd4b13d80a0e243d086a",class:"swiper-slide"},t("ion-list",{key:"c13efbefcfdee4167d91cb80d9d17523fe1940e0"},t("ion-item-divider",{key:"869fdb697be511a614785c3c99f3656c44721983"},"EAF"),this.customer.conditions.EAF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"626b204ab062ea8ac044f35a336c659e4b95421b"},"LF"),this.customer.conditions.LF.map((e=>t("ion-item",{button:true,detail:true,onClick:()=>this.openOperatingCondition("EAF",e)},t("ion-label",null,new Date(e.date).toLocaleDateString())))),t("ion-item-divider",{key:"64caac776d316d363be994fa40414cf245d44e3f"},"CCM"),this.customer.conditions.CCM.map((e=>t("ion-item",null,t("ion-label",null,new Date(e.date).toLocaleDateString())))))),t("swiper-slide",{key:"e97d6ed6cb345199611cfa6471b1dfd2ab790b63",class:"swiper-slide"},this.customer.locations.length>0&&this.markers.length>0?t("div",{id:"map-container"},t("app-map",{id:"map",pageId:"customer-details",center:this.customer.locations[0],markers:this.markers})):t("div",null,t("ion-item",null,"NO MAP AVAILABLE"))))))]}get el(){return i(this)}};h.style=p;export{h as page_customer_details};