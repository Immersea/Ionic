import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import{U as s,n as d,q as c,z as n,a9 as o,a3 as b,T as r,R as l,B as f}from"./p-736235c6.js";import"./p-c7ee7cfe.js";import{b as p,o as h}from"./p-5d4a8e1f.js";import{l as m}from"./p-1af05547.js";import{S as y}from"./p-a75993af.js";import{M as u}from"./p-1819cfda.js";import{E as k}from"./p-46038295.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";import"./p-694b8ade.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-dive-site-update ion-list{width:100%}";const v=g;const w=class{constructor(a){e(this,a);this.stdConfigurations=[];this.diveSiteId=undefined;this.diveSite=undefined;this.segment="map";this.updateView=true;this.validSite=false;this.titles=[{tag:"map"},{tag:"position"},{tag:"information"},{tag:"dive-profiles",text:"Dive Profiles"},{tag:"team"}];this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new d(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new c(e);this.stdConfigurations=m.exports.cloneDeep(this.userSettings.userConfigurations)}));await this.loadDiveSite()}async loadDiveSite(){if(this.diveSiteId){this.diveSite=await n.getDiveSite(this.diveSiteId);this.draggableMarkerPosition={lat:this.diveSite.position.geopoint.latitude,lon:this.diveSite.position.geopoint.longitude}}else{this.diveSite=new o;this.diveSite.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}async componentDidLoad(){this.slider=new y(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+b(this.diveSite,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateSite()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#dive-type-select");const a={header:r.getTransl("site-type","Site Type")};e.interfaceOptions=a;e.placeholder=r.getTransl("select","Select");m.exports.each(n.getSiteTypes(),(a=>{const t=document.createElement("ion-select-option");t.value=a.type;t.textContent=a.name;e.appendChild(t)}));const t=this.el.querySelector("#entry-type-select");const i={header:r.getTransl("entry-type","Entry Type")};t.interfaceOptions=i;t.placeholder=r.getTransl("select","Select");m.exports.each(n.getEntryTypes(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;t.appendChild(a)}));const s=this.el.querySelector("#seabed-comp-select");const d={header:r.getTransl("seabed-comp","Seabed Composition")};s.interfaceOptions=d;s.placeholder=r.getTransl("select","Select");m.exports.each(n.getSeabedCompositions(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;s.appendChild(a)}));const c=this.el.querySelector("#seabed-cover-select");const o={header:r.getTransl("seabed-cover","Seabed Cover")};c.interfaceOptions=o;c.placeholder=r.getTransl("select","Select");m.exports.each(n.getSeabedCovers(),(e=>{const a=document.createElement("ion-select-option");a.value=e.type;a.textContent=e.name;c.appendChild(a)}))}updateLocation(e){this.draggableMarkerPosition={lat:m.exports.toNumber(e.detail.lat),lon:m.exports.toNumber(e.detail.lon)};this.diveSite.position=u.getPosition(e.detail.lat,e.detail.lon);this.validateSite()}updateAddress(e){this.diveSite.setAddress(e.detail)}handleChange(e){this.diveSite[e.detail.name]=e.detail.value;this.validateSite()}handleInformationChange(e){switch(e.detail.name){case"minDepth":this.diveSite.information.minDepth=m.exports.toNumber(e.detail.value);break;case"maxDepth":this.diveSite.information.maxDepth=m.exports.toNumber(e.detail.value);break;case"waterTemp.spring":this.diveSite.information.waterTemp.spring=e.detail.value;break;case"waterTemp.summer":this.diveSite.information.waterTemp.summer=e.detail.value;break;case"waterTemp.autumn":this.diveSite.information.waterTemp.autumn=e.detail.value;break;case"waterTemp.winter":this.diveSite.information.waterTemp.winter=e.detail.value;break;default:this.diveSite.information[e.detail.name]=e.detail.value}this.validateSite()}updateParam(e,a){let t=a.detail.value;switch(e){case"type":this.diveSite.type=t;break;case"entryType":this.diveSite.information.entryType=t;break;case"seabedComposition":this.diveSite.information.seabedComposition=t;break;case"seabedCover":this.diveSite.information.seabedCover=t;break}this.validateSite()}async addDivePlan(){let e=[];m.exports.forEach(this.stdConfigurations,((a,t)=>{e.push({type:"radio",label:a.stdName,value:t,checked:t==0?true:false})}));const a=await p.create({header:r.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:r.getTransl("ok","OK"),handler:e=>{this.addDivePlanWithConf(this.stdConfigurations[e])}},{text:r.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});a.present()}async addDivePlanWithConf(e){const a=await l.openModal("modal-dive-template",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,dive:0,user:this.userProfile});a.onDidDismiss().then((e=>{const a=e.data;if(a){a.dives[0].diveSiteId=this.diveSiteId;this.diveSite.divePlans.push(a);this.updateView=!this.updateView}}))}async viewDivePlan(e,a){this.diveSite.divePlans[a]=e.detail;this.updateView=!this.updateView}async removeDivePlan(e){this.diveSite.divePlans.splice(e,1);this.updateView=!this.updateView}updateImageUrls(e){const a=e.detail.type;const t=e.detail.url;if(a=="photo"){this.diveSite.photoURL=t}else{this.diveSite.coverURL=t}}validateSite(){this.validSite=m.exports.isNumber(this.diveSite.position.geopoint.latitude)&&m.exports.isNumber(this.diveSite.position.geopoint.longitude)&&m.exports.isString(this.diveSite.type)&&m.exports.isString(this.diveSite.information.entryType)&&m.exports.isString(this.diveSite.description)&&this.diveSite.information.minDepth>0&&this.diveSite.information.maxDepth>0}async save(){await n.updateDiveSite(this.diveSiteId,this.diveSite,this.userProfile.uid);return h.dismiss()}async cancel(){return h.dismiss()}render(){return a(t,{key:"8d0bd5ccd7308eaf698dd6d51e8eaa99071c2272"},a("ion-header",{key:"8ed69f8a8389155f84171a2122e72f13d4cdf837"},a("app-upload-cover",{key:"f8c8e832c8ff2c58d1410824dcbad85bc6190adb",item:{collection:f,id:this.diveSiteId,photoURL:this.diveSite.photoURL,coverURL:this.diveSite.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),a("app-header-segment-toolbar",{key:"e9a906be850deadf2e83adfb2ec398c85ddc8c16",color:k.getAppColor(),swiper:this.slider,titles:this.titles}),a("ion-content",{key:"23dd6eff565bf4681189fe99f8b79670a37ff5cd",class:"slides"},a("swiper-container",{key:"facfc7422ec8da981691a3a6672d3e4abc0bfa2b",class:"slider-dive-site swiper"},a("swiper-wrapper",{key:"129a4cbf630da87673f3f4a18bffdde4d8064aa4",class:"swiper-wrapper"},a("swiper-slide",{key:"3beaed91b65c7c35b41b7cedeaa80c963dd73e1a",class:"swiper-slide"},a("div",{key:"619fd709a6690082a1f85009251e8fac6d729bfe",id:"map-container"},a("app-map",{key:"00fb4b1c5bbd564a38273942beff47b4115bf7db",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),a("swiper-slide",{key:"a5dc986ec5bec7a005350fdd882d353f04a60889",class:"swiper-slide"},a("app-coordinates",{key:"959a6bed038eddfeff52b4d7c9f30dc43bd53519",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),a("swiper-slide",{key:"0bbdbdca2e6768e11f2fa9b4030d46db3b26e0d2",class:"swiper-slide"},a("ion-list",{key:"a9870a70117c6047fb280cdc4c1eb0c797c3aef4",class:"ion-no-padding"},a("ion-list-header",{key:"d35798377387d8b18d166de95713331bd2ce16c9"},a("my-transl",{key:"ed62339382c452d4337c6085b08d31c6e382f50b",tag:"general-information",text:"General Information",isLabel:true})),a("ion-item",{key:"51075990910ff66fa11e9a6ac3c755754aeeb3b2"},a("ion-label",{key:"d2cd5e5f58b968046c877948e44e4224bf2414f4"},a("my-transl",{key:"4451e0e12243451730d2392669f26cff3c7cbc49",tag:"site-type",text:"Site Type"})),a("ion-select",{key:"b4a3fc31fb7fa51003b6aeaec68a8dc406ea3b23",id:"dive-type-select",onIonChange:e=>this.updateParam("type",e),value:this.diveSite.type})),a("ion-item",{key:"ca3ac5fdbed3999c7c6026ecb9c1aebc5e1512cf"},a("ion-label",{key:"555948ad85f1e89cdb3455388f8844439251b926"},a("my-transl",{key:"53a3c6d08c2f4ca9a85fbb7e16c630fce9371571",tag:"entry-type",text:"Entry Type"})),a("ion-select",{key:"1073a55a28a175ca1e4afeaf5151de08aaf00534",id:"entry-type-select",onIonChange:e=>this.updateParam("entryType",e),value:this.diveSite.information.entryType})),a("app-form-item",{key:"2d0cbf57e1965bdf86341deb6c5f5a19083fb8fd","label-tag":"name","label-text":"Name",value:this.diveSite.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"436d8198bd6652b348057eb1476d3db7a1a1e04c","label-tag":"description","label-text":"Description",value:this.diveSite.description,name:"description",textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("ion-list-header",{key:"77ac808a535f17d5ccea6215fea9a1b1abc57ab4"},a("ion-label",{key:"b47e31c1adbda6b991559166793a5590b0000892"},a("my-transl",{key:"70ce97bdd26ece6a419904d059104ae2030c89a6",tag:"site-details",text:"Site Details"}))),a("ion-grid",{key:"102adbfdacabb2016da3bb47df786b50423f69ab",class:"ion-no-padding"},a("ion-row",{key:"1480b54d8f171f56e7630b85f22b5ce67a4a270f"},a("ion-col",{key:"ea6ecd94988bb5b9f8dce66926f81df0107ef9b8"},a("app-form-item",{key:"35d22ada49a3475ef4afe6e420344d37db8455a6","label-tag":"min-depth","label-text":"Min. Depth","append-text":" (m)",value:m.exports.toString(this.diveSite.information.minDepth),name:"minDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})),a("ion-col",{key:"137328f5cc37453cbfa6c08fa543d8d10b9c9c4b"},a("app-form-item",{key:"e9758cc1b39668009c7c43302f6184f39e2435eb","label-tag":"max-depth","label-text":"Max. Depth","append-text":" (m)",value:m.exports.toString(this.diveSite.information.maxDepth),name:"maxDepth","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:["required"]})))),a("app-form-item",{key:"157ce304d69f1b19619e00d5505cd60ff1ce7723","label-tag":"avg-vis","label-text":"Average Visibility","append-text":" (m)",value:m.exports.toString(this.diveSite.information.avgViz),name:"avgViz","input-type":"text",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}),a("ion-list-header",{key:"2c224f187d7c559c6d11aabee94a545de2868d22"},a("my-transl",{key:"d9f32c9cd7f8b49fb5411cf1c488a78a776dac6f",tag:"water-temp",text:"Water Temperature","append-text":" (°C)",isLabel:true})),a("ion-grid",{key:"986cd41616dc7a4ae85c5c102c033f0cf61411af",class:"ion-no-padding"},a("ion-row",{key:"071553369de6e22c5cd32e73f48877e3630e9d17"},a("ion-col",{key:"356abc18262f45fcacb6e662e354cb4b102cc257"},a("app-form-item",{key:"8660f544ebeeed79736b5116108163bea142fb5f","label-tag":"spring","label-text":"Spring",value:m.exports.toString(this.diveSite.information.waterTemp.spring),name:"waterTemp.spring","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),a("ion-col",{key:"74dc8ebae31cdaa4772daead5729da635735f433"},a("app-form-item",{key:"6a31c07effa3ac096c9e6db1f2805216ca79abb2","label-tag":"summer","label-text":"Summer",value:m.exports.toString(this.diveSite.information.waterTemp.summer),name:"waterTemp.summer","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]}))),a("ion-row",{key:"5c6a1091aaad920021607396a435037850437dec"},a("ion-col",{key:"f161b7f5e6214afb80e4973785b50c2b839062f3"},a("app-form-item",{key:"b51812808bece600fe1dfe234794684107aa7165","label-tag":"autumn","label-text":"Autumn",value:m.exports.toString(this.diveSite.information.waterTemp.autumn),name:"waterTemp.autumn","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})),a("ion-col",{key:"1818bdf375e07009b1f416646631052464162995"},a("app-form-item",{key:"dc8c26ad0a74c367f987afdbe2ce700e260ec276","label-tag":"winter","label-text":"Winter",value:m.exports.toString(this.diveSite.information.waterTemp.winter),name:"waterTemp.winter","input-type":"number",onFormItemChanged:e=>this.handleInformationChange(e),validator:[]})))),a("ion-item",{key:"91e8e3606b74d61525c1af536e40b00a006abbe6"},a("ion-label",{key:"1b6321f02b0c8f3b76ac71be2bdbacc9dde9b27e"},a("my-transl",{key:"006467ff609e355ab180ffba54575ac08b10b39a",tag:"seabed-comp",text:"Seabed Composition"})),a("ion-select",{key:"056078d851bee344716cf33a850c77b8060c34c0",id:"seabed-comp-select",multiple:true,onIonChange:e=>this.updateParam("seabedComposition",e),value:this.diveSite.information.seabedComposition})),a("ion-item",{key:"74b4f6cd2dd20918b88e82c3e1a83ecfb645a8d9"},a("ion-label",{key:"d81b5ce4c72d2f3aa2c6349e433b950bef2d0f08"},a("my-transl",{key:"5738635e3a8d88af66e50fba6b1a22bc97850335",tag:"seabed-cover",text:"Seabed Cover"})),a("ion-select",{key:"28ed9ab65127211d778f6701def6430db09893e8",id:"seabed-cover-select",multiple:true,onIonChange:e=>this.updateParam("seabedCover",e),value:this.diveSite.information.seabedCover})))),a("swiper-slide",{key:"f7e022495f57ef9b53701347d11fc0f8eb9c49b5",class:"swiper-slide"},a("ion-grid",{key:"963c1b307d38532e4c903de67753abdf71565aa5"},a("ion-row",{key:"fa3e4736c4cd868424d5c9427313e6df8b755699",class:"ion-text-start"},this.diveSite.divePlans.map(((e,t)=>a("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4"},a("app-dive-plan-card",{divePlan:e,edit:true,onViewEmit:e=>this.viewDivePlan(e,t),onRemoveEmit:()=>this.removeDivePlan(t)})))),a("ion-col",{key:"b30d960505d94aafbf4e80dc93d41fa4db762cf0","size-sm":"12","size-md":"6","size-lg":"4"},a("ion-card",{key:"7c2e2b3bc675a12b1aa8a194e55b4c2ba6a8fdb9",onClick:()=>this.addDivePlan()},a("ion-card-content",{key:"2d76608c1f91f6f6a31643b3bab206dc46d47c4e",class:"ion-text-center"},a("ion-icon",{key:"372f2d8c4bde92210b55bc87099e91d1117be642",name:"add-circle-outline",style:{fontSize:"130px"}}))))))),a("swiper-slide",{key:"fc6dd656bdf59617622ffe287d9411d81e0c5676",class:"swiper-slide"},a("app-users-list",{key:"166d4550ec4268be9e39a98271c9e3d2959eecca",item:this.diveSite,editable:true,show:["owner","editor"]}))))),a("app-modal-footer",{key:"75fb8244225765b99ed51efabf13d1c16d13980b",disableSave:!this.validSite,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};w.style=v;export{w as modal_dive_site_update};