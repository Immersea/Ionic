import{r as e,h as a,H as t,f as i}from"./p-cbe60c68.js";import{U as s,n as o,q as c,T as d,ai as n,ap as l,R as r,E as h}from"./p-773bd3de.js";import"./p-c7ee7cfe.js";import{b,n as f}from"./p-c2915cc5.js";import{I as p,a as m,b as u}from"./p-081da3e8.js";import{S as y}from"./p-a75993af.js";import{l as k}from"./p-1af05547.js";import"./p-694b8ade.js";import"./p-e9c4f463.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-c11a967f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const g="modal-immersea-location-update ion-list{width:100%}modal-immersea-location-update modal-quill-editor{width:100%;height:var(--mapHeight)}";const w=g;const v=class{constructor(a){e(this,a);this.stdConfigurations=[];this.mediaToUpload={};this.locationId=undefined;this.immerseaLocation=undefined;this.segment="information";this.updateView=true;this.validLocation=false;this.mediaArray={video:[],photo:[],documents:[]};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=s.userProfile$.subscribe((e=>{this.userProfile=new o(e)}));this.userSettingsSub$=s.userSettings$.subscribe((e=>{this.userSettings=new c(e);this.stdConfigurations=k.exports.cloneDeep(this.userSettings.userConfigurations)}));this.segmentTitles={information:d.getTransl("information","Information"),article:d.getTransl("article","Article"),gallery:d.getTransl("gallery","Gallery"),map:d.getTransl("map","Map"),position:d.getTransl("position","Position"),team:d.getTransl("team","Team")};await this.loadImmerseaLocation()}async loadImmerseaLocation(){if(this.locationId){this.immerseaLocation=await p.getLocation(this.locationId);this.draggableMarkerPosition={lat:this.immerseaLocation.position.geopoint.latitude,lon:this.immerseaLocation.position.geopoint.longitude}}else{this.immerseaLocation=new m;this.immerseaLocation.users={[s.userRoles.uid]:["owner"]};this.draggableMarkerPosition={}}}orderMedia(){const e=[];const a=[];const t=[];Object.keys(this.immerseaLocation.media).map((i=>{const s=this.immerseaLocation.media[i];if(s.type.includes("application")){e.push(s)}else if(s.type.includes("video")){t.push(s)}else if(s.type.includes("image")){a.push(s)}}));this.mediaArray.documents=k.exports.orderBy(e,"order");this.mediaArray.video=k.exports.orderBy(t,"order");this.mediaArray.photo=k.exports.orderBy(a,"order")}async componentDidLoad(){this.slider=new y(".slider-dive-site",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null;this.slider.updateSize()}}});this.setSelectOptions();await customElements.whenDefined("app-map");this.mapElement=this.el.querySelector("#map");const e=this.el.querySelector("#map-container");e.setAttribute("style","height: "+n(this.immerseaLocation,true)+"px");this.mapElement["mapLoaded"]().then((()=>{this.mapElement.triggerMapResize()}));this.mapElement.triggerMapResize();this.validateLocation()}disconnectedCallback(){this.userProfileSub$.unsubscribe();this.userSettingsSub$.unsubscribe()}setSelectOptions(){const e=this.el.querySelector("#sections-select");const a={header:d.getTransl("sections","Sections")};e.interfaceOptions=a;e.placeholder=d.getTransl("select","Select");k.exports.each(p.getSections(),(async a=>{const t=document.createElement("ion-select-option");t.value=a.tag;t.textContent=await d.getTransl(a.tag,a.text);e.appendChild(t)}));const t=this.el.querySelector("#topics-select");const i={header:d.getTransl("topics","Topics")};t.interfaceOptions=i;t.placeholder=d.getTransl("select","Select");k.exports.each(p.getTopics(),(async e=>{const a=document.createElement("ion-select-option");a.value=e.tag;a.textContent=await d.getTransl(e.tag,e.text);t.appendChild(a)}))}updateLocation(e){this.draggableMarkerPosition={lat:k.exports.toNumber(e.detail.lat),lon:k.exports.toNumber(e.detail.lon)};this.immerseaLocation.position=l.getPosition(e.detail.lat,e.detail.lon);this.validateLocation()}updateAddress(e){this.immerseaLocation.setAddress(e.detail)}handleChange(e){this.immerseaLocation[e.detail.name]=e.detail.value;this.validateLocation()}updateParam(e,a){let t=a.detail.value;switch(e){case"sections":this.immerseaLocation.sections=t;break;case"topics":this.immerseaLocation.topics=t;break}this.validateLocation()}segmentChanged(e){if(e.detail.value){this.segment=e.detail.value;this.slider.update();switch(this.segment){case"information":this.slider.slideTo(0);break;case"article":this.slider.slideTo(1);break;case"gallery":this.slider.slideTo(2);break;case"map":this.slider.slideTo(3);this.mapElement.triggerMapResize();break;case"position":this.slider.slideTo(4);break;case"team":this.slider.slideTo(5);break}}}async slideChanged(){const e=this.slider.activeIndex;this.slider.update();switch(e){case 0:this.segment="information";break;case 1:this.segment="article";break;case 2:this.segment="gallery";break;case 3:this.segment="map";this.mapElement.triggerMapResize();break;case 4:this.segment="position";break;case 5:this.segment="team";break}}updateImageUrls(e){const a=e.detail.type;const t=e.detail.url;if(a=="photo"){this.immerseaLocation.photoURL=t}else{this.immerseaLocation.coverURL=t}}async addMedia(){if(this.locationId){const e=await r.openPopover("popover-media-loading");e.onDidDismiss().then((e=>{if(e&&e.data){this.immerseaLocation.media[e.data.media.id]=e.data.media;this.mediaToUpload[e.data.media.id]=e.data}}))}else{const e=await b.create({header:d.getTransl("media","Media"),message:d.getTransl("media-loader-error","Please save the item to upload new media."),buttons:[{text:d.getTransl("ok","OK")}]});e.present()}}async openEditor(){const e=await r.openModal("modal-quill-editor",{immerseaLocation:this.immerseaLocation});e.onDidDismiss().then((async e=>{if(e&&e.data){this.immerseaLocation.article=e.data;this.updateView=!this.updateView}}))}updatePublic(e){this.immerseaLocation.public=e.detail.checked;this.validateLocation()}validateLocation(){this.validLocation=this.immerseaLocation&&this.immerseaLocation.position&&k.exports.isNumber(this.immerseaLocation.position.geopoint.latitude)&&k.exports.isNumber(this.immerseaLocation.position.geopoint.longitude)&&this.immerseaLocation.sections.length>0&&this.immerseaLocation.topics.length>0&&k.exports.isString(this.immerseaLocation.region)&&k.exports.isString(this.immerseaLocation.displayName)}async save(){if(Object.keys(this.mediaToUpload).length>0){const e=await r.openPopover("popover-media-uploader",{files:this.mediaToUpload,itemId:this.locationId,collectionId:u});e.onDidDismiss().then((e=>{if(e&&e.data){const a=e.data;Object.keys(a).forEach((e=>{this.immerseaLocation.media[e].url=a[e]}));return this.saveLocation()}}))}else{return this.saveLocation()}}async saveLocation(){await p.updateLocation(this.locationId,this.immerseaLocation,this.userProfile.uid);return f.dismiss()}async cancel(){return f.dismiss()}render(){return a(t,{key:"17040584a7aea3f881cfa57950127a9cabe7c96a"},a("ion-header",{key:"da12ab7945ad1625ae43147533186624e885ea0b"},a("app-upload-cover",{key:"255e2a846b01db6f65b06a7de444d58b9a1ace10",item:{collection:u,id:this.locationId,photoURL:this.immerseaLocation.photoURL,coverURL:this.immerseaLocation.coverURL},onCoverUploaded:e=>this.updateImageUrls(e)})),a("ion-header",{key:"dd0b6d16d88098eca7095dd3b74eb92cbdc2672b"},a("ion-toolbar",{key:"1dd560a52f0aa59360dcd41f638c262021059b38"},a("ion-segment",{key:"ed81f26291e28a6b19f974a285d5e8adabe41ba8",mode:"md",color:h.getAppColor(),scrollable:true,onIonChange:e=>this.segmentChanged(e),value:this.segment},a("ion-segment-button",{key:"6879fcffa47f9481c4a6fe9a0e049472f511dc28",value:"information",layout:"icon-start"},a("ion-label",{key:"c5cb77d4a3caf05ae3a6159110e49e7e8f671373"},this.segmentTitles.information)),a("ion-segment-button",{key:"9d690f92f72a7decd2f1e5d58401bfe017514369",value:"article",layout:"icon-start"},a("ion-label",{key:"890ac51625cdd69b1cfc3e9bc31ef35865640a0f"},this.segmentTitles.article)),a("ion-segment-button",{key:"da8704b6c3f9509b9bf82aaa1ccf529c934fc0f3",value:"gallery",layout:"icon-start",disabled:!this.locationId},a("ion-label",{key:"39f79f1e652cd8de768b28e27051dc74ecc8eba8"},this.segmentTitles.gallery)),a("ion-segment-button",{key:"284e2448ffe780ee3826020f07d9efbd8116632f",value:"map",layout:"icon-start"},a("ion-label",{key:"03ec07e8a233a1057e087725c460666bc09a7104"},this.segmentTitles.map)),a("ion-segment-button",{key:"24d5ddf6421112bac254862b60d076017366c42c",value:"position",layout:"icon-start"},a("ion-label",{key:"476433754e2e10193bd624b7a850effe63eeb9b8"},this.segmentTitles.position)),a("ion-segment-button",{key:"1b54003250cf320d4b15adf494098cc44d52afad",value:"team",layout:"icon-start"},a("ion-label",{key:"5a1cd19222b893e5953d2c3aa611a73de1063c86"},this.segmentTitles.team))))),a("ion-content",{key:"0a803a792896260fd0aba7a02f11bc17fa2d4206",class:"slides"},a("swiper-container",{key:"412f9cfdfdf1766687421e5cbc286e61ee28057a",class:"slider-dive-site swiper"},a("swiper-wrapper",{key:"594aadad9a395df9420a69978deaf03e12daf954",class:"swiper-wrapper"},a("swiper-slide",{key:"758813076a8f4d02b0c877b2f9285af696e2802e",class:"swiper-slide"},a("ion-list",{key:"36a49d354b01a90a3ba4d59209be2bacae27ed8d",class:"ion-no-padding"},a("ion-item",{key:"4595d9d3990b6b20d212ebc73734d2a41f6248dc"},a("ion-label",{key:"2477d0e4d25f753db91c87660cc63d4cdd55bf7b"},a("my-transl",{key:"0be8e1e761949163e8ece90a923b18966a204a47",tag:"public",text:"Public"})),a("ion-toggle",{key:"db5662d9c1d11ae2e9f00f8f3307d2c0d6b6ac3c",slot:"end",onIonChange:e=>this.updatePublic(e),checked:this.immerseaLocation.public})),a("ion-item",{key:"87e55f0b43e11ad4efd6af60cd8b5107458634c2"},a("ion-label",{key:"f2b51dd1a9e531bbfcd2ac036a5eb2f4d9039918"},a("my-transl",{key:"904906257bcb90498b337648acd8f150a6babd12",tag:"sections",text:"Sections"}),a("sup",{key:"32687d99671e335074977873079e51a0fe2e4864"},"*")),a("ion-select",{key:"0d1602841396c396814d09213fdaa946aefd3f7d",id:"sections-select",onIonChange:e=>this.updateParam("sections",e),value:this.immerseaLocation.sections,multiple:true})),a("ion-item",{key:"9f72963874f865526ba27339b56ba9151be851fa"},a("ion-label",{key:"554679c6cbfcc3d5916c83a9ea3adfcb7c40b7fc"},a("my-transl",{key:"457215ded17e8bd24930072557f8de7a22325c4e",tag:"topics",text:"Topics"}),a("sup",{key:"888ded92ee96e9876d9df3bd5cc46670f19bc612"},"*")),a("ion-select",{key:"67269a2c946f782f2e2815216bd9427ce554f846",id:"topics-select",onIonChange:e=>this.updateParam("topics",e),value:this.immerseaLocation.topics,multiple:true})),a("app-form-item",{key:"3c3b9574ed7f580c665acf1a20d64b97e18915f3","label-tag":"region","label-text":"Region",value:this.immerseaLocation.region,placeholder:"Sicilia Tirrenica, Sicilia Ionica, etc...",name:"region","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"34531b76701298b52441ba45c0da4f1fedc7e413","label-tag":"area","label-text":"Area",value:this.immerseaLocation.area,placeholder:"Capo San Vito, Palermo, etc...",name:"area","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),a("app-form-item",{key:"101249de331af7885896737fc46cd5a5ce7c6dc1","label-tag":"name","label-text":"Name",value:this.immerseaLocation.displayName,name:"displayName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),a("app-form-item",{key:"082d631bceff8d8b139ff788c478faa831d9711b","label-tag":"short-description","label-text":"Short Description",value:this.immerseaLocation.shortDescription,name:"shortDescription",multiLanguage:true,textRows:5,"input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}))),a("swiper-slide",{key:"ff5888bcd700543b1155366c36f9bd0f3452da38",class:"swiper-slide"},a("modal-quill-editor",{key:"79af0b39f0aee565b3bb92b21b0a5f3883005bb8",immerseaLocation:this.immerseaLocation,updateView:this.updateView,readOnly:true,onEdit:()=>this.openEditor()})),a("swiper-slide",{key:"603177e7eb761e3af570a6bc1e98e14911754d50",class:"swiper-slide"},a("ion-list",{key:"270307e4a7484895c0ef014246108e3d93b4a70c"},a("ion-item",{key:"1f6dd4d1a942ab424455c3d782bd39647bf96e8a",button:true,onClick:()=>this.addMedia()},a("ion-icon",{key:"ae2566fa5ac7f66361993c8c811c59fed985cb11",slot:"start",name:"add"}),a("ion-label",{key:"1f3750cc3a9091bc720df54d092ba447c6bbce66"},"Aggiungi")),Object.keys(this.mediaToUpload).length>0?[a("ion-list-header",null,"File da caricare"),Object.keys(this.mediaToUpload).map((e=>a("ion-item",null,a("ion-label",null,this.mediaToUpload[e].media.title))))]:undefined,a("ion-list-header",{key:"3199fa985150e3709ff77721de39d524aefc3ca6"},"Photo"),this.mediaArray.photo.length>0?this.mediaArray.photo.map((e=>a("ion-item",null,a("ion-label",null,e.title)))):a("ion-item",null,a("ion-label",null,"Nessuna foto caricata")),a("ion-list-header",{key:"8f69c063bf982e6d2a7b586c7cce1a49f65514de"},"Video"),this.mediaArray.video.length>0?this.mediaArray.video.map((e=>a("ion-item",null,a("ion-label",null,e.title)))):a("ion-item",null,a("ion-label",null,"Nessun video caricato")),a("ion-list-header",{key:"334b8a30e53cdcea3985ad1d1e314eebc5edecbe"},"Documenti"),this.mediaArray.documents.length>0?this.mediaArray.documents.map((e=>a("ion-item",null,a("ion-label",null,e.title)))):a("ion-item",null,a("ion-label",null,"Nessun documento caricato")))),a("swiper-slide",{key:"4d973f844c626be24b852557bddfd4f79de1393f",class:"swiper-slide"},a("div",{key:"60265b1f34e5e72539c6ee3a783deea5ed649bfc",id:"map-container"},a("app-map",{key:"7f89312532b01cb2f0632376640e72963cb3644a",id:"map",pageId:"dive-sites",draggableMarkerPosition:this.draggableMarkerPosition,onDragMarkerEnd:e=>this.updateLocation(e)}))),a("swiper-slide",{key:"eb8f75f171fc718b720e781056ed50ef0dc82eca",class:"swiper-slide"},a("app-coordinates",{key:"d127c39985e0a9d9ef2d14f944614de2de3dbf81",coordinates:this.draggableMarkerPosition,onCoordinatesEmit:e=>this.updateLocation(e),onAddressEmit:e=>this.updateAddress(e)})),a("swiper-slide",{key:"4cb7b6aa4b5b0356dbf23a52ef59c3afd75036b0",class:"swiper-slide"},a("app-users-list",{key:"847a12a1e1f99c3edfe25ea9755d737afc515350",item:this.immerseaLocation,editable:true,show:["owner","editor"]}))))),a("app-modal-footer",{key:"79393d188436d89a0836ae1da2f3c471d0891872",disableSave:!this.validLocation,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=w;export{v as modal_immersea_location_update};