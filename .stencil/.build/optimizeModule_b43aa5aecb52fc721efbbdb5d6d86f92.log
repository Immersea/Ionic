import{r as s,h as t,f as i}from"./p-cbe60c68.js";import{S as e,a8 as a,az as n,m as o,aA as l,U as r,T as h,y as c}from"./p-30358c9d.js";import{N as d,T as p,Z as f,V as b}from"./p-2578d979.js";import{S as u}from"./p-a75993af.js";import{l as m}from"./p-1af05547.js";import"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";import"./p-e9c4f463.js";const g="page-admin-translations app-admin-translations{width:100%;height:100%}";const y=g;const j=class{constructor(t){s(this,t);this.segment="translations";this.slider=undefined;this.translations=[];this.filteredTranslations=[];this.filter="";this.translationsBackup=[];this.translationsChanged={};this.updateView=false}componentWillLoad(){this.languages=e.getLanguages();this.selectedLanguage=this.languages[0];this.translationsSub=d(p(b(c,l),f("input")),(s=>{this.translations=[];s.forEach((s=>{const t=s.data();t["id"]=s.id;this.translations.push(t)}));this.translationsBackup=m.exports.cloneDeep(this.translations);this.filterTranslations()}))}componentDidLoad(){this.setSliderHeight()}setSliderHeight(){this.slider=new u(".slider-translations",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null;this.slider.updateSize()}}});const s=Array.from(this.el.getElementsByClassName("slide-container"));s.map((s=>{s.setAttribute("style","height: "+a(null,4)+"px")}));this.slider.updateSize();this.updateView=!this.updateView}disconnectedCallback(){this.translationsSub()}segmentChanged(s){if(s.detail.value){this.segment=s.detail.value;if(s.detail.value=="admin"){this.slider.slideTo(1)}else if(s.detail.value=="translations"){this.slider.slideTo(0)}this.updateView=!this.updateView}}selectLanguage(s){this.selectedLanguage=s.target.value;this.updateView=!this.updateView}async runTranslationsScript(){try{await n.updateTranslations();e.presentAlert("Done","Translations saved!")}catch(s){console.log("error runTranslationsScript",s)}}translationChanged(s){if(s&&s.detail){const t=s.detail;this.translationsChanged[t.id]=t;let i=this.translations.findIndex((s=>s.id===t.id));this.translations[i]=t;this.translations=[...this.translations];i=this.filteredTranslations.findIndex((s=>s.id===t.id));this.filteredTranslations[i]=t;this.filteredTranslations=[...this.filteredTranslations];this.updateView=!this.updateView}}filterTranslations(s){if(s&&s.target.value){this.filter=s.target.value}if(this.filter&&this.filter!==""){this.filteredTranslations=this.translations.filter((s=>s.input.toLowerCase().includes(this.filter.toLowerCase())))}else{this.filteredTranslations=m.exports.cloneDeep(this.translations)}this.updateView=!this.updateView}close(){this.translations=m.exports.cloneDeep(this.translationsBackup);this.filterTranslations()}async save(){const s=[];Object.keys(this.translationsChanged).map((t=>{const i=this.translationsChanged[t];delete i.id;s.push(o.updateDocument(l,t,i))}));await Promise.all(s);this.translationsChanged=[]}render(){return[t("ion-header",{key:"cc82b9b08fa076c6b1112243a679755b01e2b2b4"},t("app-navbar",{key:"39dc3feee0d994f7054e439e218a80a996e9f4b1",color:"udive",tag:"translations",text:"Translations"})),r.userRoles&&r.userRoles.isSuperAdmin()?[t("ion-header",null,t("ion-toolbar",{color:"udive",class:"no-safe-padding"},t("ion-segment",{mode:"md",onIonChange:s=>this.segmentChanged(s),value:this.segment},t("ion-segment-button",{value:"translations",layout:"icon-start"},t("ion-label",null,"TRANSLATIONS")),t("ion-segment-button",{value:"admin",layout:"icon-start"},t("ion-label",null,"ADMIN"))))),this.segment=="translations"?t("ion-header",null,t("ion-toolbar",{color:"udive"},t("ion-searchbar",{animated:true,placeholder:h.getTransl("search","Search"),value:this.filter,debounce:250,onIonInput:s=>this.filterTranslations(s)})),t("ion-toolbar",{color:"udive"},t("ion-item",null,t("ion-select",{label:h.getTransl("language","Language"),labelPlacement:"floating",interface:"action-sheet",value:this.selectedLanguage,onIonChange:s=>this.selectLanguage(s)},this.languages.map((s=>t("ion-select-option",{value:s},s.label)))),t("ion-icon",{slot:"end",class:"flag-icon flag-icon-"+(this.selectedLanguage.countryCode=="en"?"gb":this.selectedLanguage.countryCode)})))):undefined]:undefined,t("ion-content",{key:"d1ed8e47e74f0db6b9bcd58198a5053d34c5c697"},t("swiper-container",{key:"dca851375da41764e4d118ed4bb28be19c54b53e",class:"slider-translations swiper"},t("swiper-wrapper",{key:"cafb43dbbbba2553dc97632c5f1a409efba6f6ad",class:"swiper-wrapper"},t("swiper-slide",{key:"cd4b582df6fc425167edd568b647e4a989dbb345",class:"swiper-slide"},t("ion-content",{key:"2596a75b129856804c0341ac61eef9e32eaf3d92",class:"slide-container"},t("ion-grid",{key:"4c24a3be599755afcba0126f446cb6ce79d1f289"},t("ion-row",{key:"2f0bdfb0cfe125697fd64e55301016be4af2d863"},t("ion-col",{key:"8c93be64d3d144f53b4ce90215baf04d302dd268"},t("app-admin-translations",{key:"529e1bfc08be7e4bdb66f38d51a486482c1272c7",translations:this.filteredTranslations,language:this.selectedLanguage.value,onTranslationChanged:s=>this.translationChanged(s)})))))),r.userRoles&&r.userRoles.isSuperAdmin()?t("swiper-slide",{class:"swiper-slide"},t("ion-content",{class:"slide-container"},t("ion-button",{size:"large",onClick:()=>this.runTranslationsScript()},"Run Translations Script"))):undefined))),Object.keys(this.translationsChanged).length>0?t("app-modal-footer",{onCancelEmit:()=>this.close(),onSaveEmit:()=>this.save()}):undefined]}get el(){return i(this)}};j.style=y;export{j as page_admin_translations};