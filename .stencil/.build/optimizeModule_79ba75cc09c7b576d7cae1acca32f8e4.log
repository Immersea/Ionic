import{r as e,h as t,f as i}from"./p-cbe60c68.js";import{aD as s,m as o,Q as a,S as n,i as l,j as r,T as c}from"./p-b9378908.js";import{T as d}from"./p-69581db2.js";import{l as h}from"./p-1af05547.js";import{S as f}from"./p-a75993af.js";import"./p-2578d979.js";import"./p-e9c4f463.js";import"./p-a9f4af61.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const p="page-datasheets{}";const u=p;const b=class{constructor(t){e(this,t);this.datasheetsList=[];this.nonFilteredDatasheetsList=[];this.localDocName="datasheetBasket";this.filteredDatasheetsList=[];this.loading=true;this.filter=new s;this.slider=undefined;this.updateView=true;this.showDownload=true;this.basket=[]}async componentWillLoad(){const e=await o.getLocalDocument("datasheetsFilter");this.filter=new s(e);a.datasheetsList$.subscribe((async e=>{this.updateList(e);this.nonFilteredDatasheetsList=e;this.loading=false;this.filterLists()}));const t=await o.getLocalDocument(this.localDocName);if(t)this.basket=t}componentDidLoad(){this.searchToolbar=this.el.querySelector("#searchToolbar");this.slider=new f(".slider-show-datasheet",{speed:400,spaceBetween:0,allowTouchMove:false,autoHeight:true,slidesPerView:1,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.downloadDatasheets()}updateList(e){this.datasheetsList=e;this.searchToolbar?this.searchToolbar.forceFilter(e):undefined;this.updateView=!this.updateView}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}filterDatasheets(e){if(this.filter.oldProduct===true){this.filteredDatasheetsList=h.exports.cloneDeep(e)}else{this.filteredDatasheetsList=e.filter((e=>e.oldProduct==false))}}addDatasheet(){a.presentDatasheetUpdate()}getOptions(){if(d.isRefraDBAdmin()){return[{tag:"delete",text:"Delete",icon:"trash",color:"danger",func:e=>a.deleteDatasheet(e,false)},{tag:"revision",text:"Revision",icon:"duplicate",color:"secondary",func:e=>a.duplicateDatasheet(e,true)},{tag:"copy",text:"Copy",icon:"copy",color:"tertiary",func:e=>a.duplicateDatasheet(e,false)},{tag:"edit",text:"Edit",icon:"create",color:"primary",func:e=>a.presentDatasheetUpdate(e)}]}else return null}async openDatasheetFilter(){o.deleteLocalDocument("filteredDatasheetList");this.filter=await a.openDatasheetFilter(this.filter);this.filterLists()}clearDatasheetFilter(){this.filter=new s;this.datasheetsList=h.exports.cloneDeep(this.nonFilteredDatasheetsList);o.deleteLocalDocument("filteredDatasheetList");this.filterLists()}async filterLists(){o.saveLocalDocument("datasheetsFilter",this.filter);if(this.filter.isActive()){const e=await o.getLocalDocument("filteredDatasheetList");if(!e){await n.presentLoading("searching");const e=await a.filterDatasheets(this.filter);n.dismissLoading();if(e){this.datasheetsList=e;o.saveLocalDocument("filteredDatasheetList",this.datasheetsList)}else{this.filterDatasheets(this.nonFilteredDatasheetsList)}}else{this.datasheetsList=e}this.filterDatasheets(this.datasheetsList)}else{this.filterDatasheets(this.nonFilteredDatasheetsList)}this.searchToolbar?this.searchToolbar.forceFilter(this.datasheetsList):undefined;this.slider?this.updateSlider():undefined}makeBreadCrumb(e){if(e=="familyId"){const e=a.getDatasheetFamilies(this.filter.familyId);if(e&&e.length>0)return e[0].familyName;else return this.filter.familyId}else if(e=="majorFamilyId"){const e=a.getDatasheetMajorFamilies(this.filter.majorFamilyId);if(e&&e.length>0)return e[0].majorFamilyName;else return this.filter.majorFamilyId}else if(e=="oldProduct"){return this.filter.oldProduct?"All revs.":"Last Rev."}else if(e=="properties"){if(this.filter.properties.length>0){let e="( ";this.filter.properties.forEach(((t,i)=>{const s=a.getDatasheetPropertyNames("id",t.valueName);e+=(s&&s.length>0?s[0].nameName:t.valueName)+t.operator+t.value+(i<this.filter.properties.length-1?" / ":" )")}));return e}else return""}return null}downloadDatasheets(){this.showDownload=!this.showDownload;this.slider.params.slidesPerView=this.showDownload?2:1;this.updateSlider()}openDatasheet(e){if(this.showDownload){const t=a.getDatasheetsById(e);if(!h.exports.includes(this.basket,t))this.basket.push(t);this.saveBasket();this.updateSlider()}else{a.presentDatasheetDetails(e)}}async downloadDatasheetsList(){const e=[];for(const t of this.basket){t["datasheetId"]=t.id;e.push(t)}a.exportDatasheets(e);this.downloadDatasheets()}emptyBasket(){this.basket=[];this.saveBasket()}removeItemFromBasket(e){this.basket.splice(e,1);this.saveBasket()}saveBasket(){this.updateView=!this.updateView;o.saveLocalDocument(this.localDocName,this.basket)}render(){return[t("ion-header",{key:"41d05719c4f8e6e11db251e8f38baabb0f438cfd"},t("app-navbar",{key:"f088e5c51b8458f0dee6d2ba26b191e1df828e09",tag:"datasheets",text:"Data Sheets",color:"trasteel"}),t("ion-grid",{key:"d1d0690ab0d3ede9881142450e7fc867c2e86158",class:"ion-no-padding"},t("ion-row",{key:"2c3a0245153fa746ba9d8d1b7e75b68f732328ee",class:"ion-no-padding"},t("ion-col",{key:"3cd695c52f5dd60242d2974af955ecf5154ed206",size:"1",class:"ion-no-padding"},t("ion-toolbar",{key:"e0e9a92e7cbb2fec06c58102944883a2180e7f70",color:"trasteel"},t("ion-button",{key:"e8dc442463c39e4b83ece67a5d8d91f196132029",fill:"clear",expand:"full","icon-only":true,onClick:()=>this.openDatasheetFilter()},t("ion-icon",{key:"0b014f2a1bfe0eb5ec5d2c913ac3b969d5f39d26",name:"filter",color:"light"})))),t("ion-col",{key:"e5439bb94d10fee1a8b62347fde8a30839debdab",size:"11",class:"ion-no-padding"},t("app-search-toolbar",{key:"936713f7d0cff3c1c15c5e3829515d88a620c55c",id:"searchToolbar",searchTitle:"datasheets",list:this.datasheetsList,orderFields:["productName"],color:"trasteel",placeholder:"Search by product, family or tech#",filterBy:["productName","familyId","techNo"],onFilteredList:e=>this.filterDatasheets(e.detail)}))))),t("ion-content",{key:"7fb5fea5df809a427abad2abfbce4c4d5a185db9",class:"slides"},d.isRefraDBAdmin()?!this.showDownload?t("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},t("ion-fab-button",{size:"small",color:"trasteel"},t("ion-icon",{name:"chevron-down"})),t("ion-fab-list",{side:"bottom"},t("ion-fab-button",{onClick:()=>this.addDatasheet(),color:"trasteel"},t("ion-icon",{name:"add"})),t("ion-fab-button",{onClick:()=>this.downloadDatasheets(),color:"trasteel"},t("ion-icon",{name:"download"})))):t("ion-fab",{vertical:"top",horizontal:"end",slot:"fixed",edge:true},t("ion-fab-button",{onClick:()=>this.downloadDatasheets(),size:"small",color:"trasteel"},t("ion-icon",{name:"close"}))):undefined,t("swiper-container",{key:"df4b5dfc856cec4011a84ea4878e397e251e359b",class:"slider-show-datasheet swiper"},t("swiper-wrapper",{key:"411ddce6f4587e05a8031450e699ec769ced6c9d",class:"swiper-wrapper"},t("swiper-slide",{key:"b0ad13cbacf43588a7bf1c3cb8d1c4100725d3fc",class:"swiper-slide"},this.filter.isActive()?[t("ion-breadcrumbs",null,t("ion-button",{"icon-only":true,fill:"clear",onClick:()=>this.clearDatasheetFilter()},t("ion-icon",{color:"danger",name:"trash"})),t("ion-breadcrumb",null,"#",this.filteredDatasheetsList.length),Object.keys(this.filter).map((e=>(h.exports.isArray(this.filter[e])?this.filter[e].length>0:this.filter[e]!==null)?t("ion-breadcrumb",null,this.makeBreadCrumb(e)):undefined)),t("ion-breadcrumb",null))]:undefined,t("app-infinite-scroll",{key:"a6f92d709855583befb5116e924a576acfbf7462",list:this.filteredDatasheetsList,loading:this.loading,showFields:["productName"],options:this.getOptions(),returnField:"id",icon:l.getMapDocs(r).icon.name,onItemClicked:e=>this.openDatasheet(e.detail),onListChanged:()=>{this.updateSlider()}})),this.showDownload?t("swiper-slide",{class:"swiper-slide"},t("ion-list",null,this.basket.length==0?t("ion-item",null,"Click on the datasheets on the left to add to basket"):t("ion-grid",null,t("ion-row",null,t("ion-col",null,t("ion-button",{onClick:()=>this.downloadDatasheetsList(),expand:"block",fill:"outline",color:"trasteel"},t("ion-icon",{name:"download",slot:"start"}),t("ion-label",null,c.getTransl("download","Download")),t("ion-badge",{slot:"end",color:"trasteel"},this.basket.length))),t("ion-col",{size:"1"},t("ion-button",{fill:"clear","icon-only":true,onClick:()=>this.emptyBasket()},t("ion-icon",{name:"trash",color:"danger"}))))),this.basket.map(((e,i)=>t("ion-item",{color:"light"},t("ion-label",null,e.productName),t("ion-button",{slot:"end",fill:"clear","icon-only":true,onClick:()=>this.removeItemFromBasket(i)},t("ion-icon",{name:"trash",color:"danger"}))))))):undefined)))]}get el(){return i(this)}};b.style=u;export{b as page_datasheets};