import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as s}from"./p-5d4a8e1f.js";import{l as d}from"./p-1af05547.js";import{am as o,R as c,k as n,av as l,S as h,T as r}from"./p-736235c6.js";import{E as b}from"./p-46038295.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-1819cfda.js";import"./p-7ee16e8d.js";const p="modal-shape-type ion-list{width:100%}";const f=p;const m=class{constructor(t){e(this,t);this.index=0;this.shapeTypes=undefined;this.shapeType=undefined;this.updateView=true;this.validShapeType=false}async componentWillLoad(){await this.loadShapeTypes()}async loadShapeTypes(){await o.downloadShapeSettings();this.shapeTypes=d.exports.cloneDeep(await o.getShapeTypes());if(this.shapeTypes&&this.shapeTypes.length>0){this.shapeType=this.shapeTypes[0]}else{this.shapeTypes=[];this.addShapeType()}this.validateShape()}selectType(e){this.shapeType=this.shapeTypes.find((t=>t.typeId==e.detail.value));this.validateShape()}handleChange(e){const t=e.detail.name;let a=e.detail.value;if(t=="typeId"){a=a.replace(/\s+/g,"-").trim().toLowerCase()}this.shapeType[t]=a;this.validateShape()}validateShape(){this.validShapeType=d.exports.isString(this.shapeType.typeId)&&d.exports.isString(this.shapeType.typeName.en)&&d.exports.isNumber(this.shapeType.decimals)&&this.shapeType.position>0&&d.exports.isString(this.shapeType.dwg.url);this.updateView=!this.updateView}async editDrawing(){this.shapeType.dwg.id=this.shapeType.typeId;this.shapeType.dwg.name=this.shapeType.typeName.en;this.shapeType.dwg.description="";const e=await c.openPopover("popover-media-loading",{media:this.shapeType.dwg});e.onDidDismiss().then((async e=>{if(e&&e.data){const t={[e.data.media.id]:e.data};const a=e.data.media;const i=await c.openPopover("popover-media-uploader",{files:t,itemId:this.shapeType.typeId,collectionId:n});i.onDidDismiss().then((e=>{if(e&&e.data){const t=e.data;this.shapeType.dwg=a;Object.keys(t).forEach((e=>{this.shapeType.dwg.url=t[e]}));this.save(false);this.validateShape()}}))}}))}addShapeType(){this.shapeType=new l;this.shapeTypes.push(this.shapeType);this.index=this.shapeTypes.length-1}duplicateShapeType(){this.shapeType=d.exports.cloneDeep(this.shapeType);this.shapeType.typeId=this.shapeType.typeId+"_rev.";this.shapeTypes.push(this.shapeType);this.index=this.shapeTypes.length-1}async deleteShapeType(){try{this.shapeTypes.splice(this.index,1);this.index=0;this.shapeType=this.shapeTypes[0];this.validateShape()}catch(e){if(e)h.presentAlertError(e)}}async save(e=true){await o.uploadShapeTypes(this.shapeTypes);return e?s.dismiss():true}async cancel(){return s.dismiss()}render(){return t(a,{key:"c73b40a88dd07e2f698882946975b321aae576ec"},t("ion-content",{key:"ed2906353ca2cbead0a77006c9a01edd5870738c"},t("app-banner",{key:"3787f6f761021cb9460e6693758834c25e23b2ad",heightPx:500,backgroundCoverFill:false,link:this.shapeType.dwg?this.shapeType.dwg.url:null}),t("ion-button",{key:"67cc03a7247ede5ef949e0f5bf17295ba73dd7bb",expand:"block",fill:"outline",color:"trasteel",disabled:!this.shapeType.typeId,onClick:()=>this.editDrawing()},t("ion-icon",{key:"fea31da750d3a37ebaf5b89d06fb15a8140c9e99",slot:"start",name:"create"}),t("ion-label",{key:"2b71124db19fe4f7da82bafa35bae9995eb2a077"},!this.shapeType.typeId?r.getTransl("media-loader-error","Please insert the ID to upload new media."):r.getTransl("edit-drawing","Edit Drawing"))),t("ion-grid",{key:"fe43e7e9b338f42861149d58bd1f7370dd7e98b8"},t("ion-row",{key:"ef919bfdd8619c41034a54cf2a38cc9d115bfbf6"},t("ion-col",{key:"fdba3baa72c5678071a5bd2317d5f4295a10fb2b"},t("app-select-search",{key:"6446ec8621066d400e83a5b1a6bfa60dcbfd7aff",label:{tag:"shape_type",text:"Shape Type"},value:this.shapeType.typeId,lines:"inset",selectFn:e=>this.selectType(e),selectOptions:this.shapeTypes,selectValueId:"typeId",selectValueText:["typeName","en"],disabled:!this.validShapeType})),t("ion-col",{key:"55577aa118e3400df1e41d55fb0f5d45983f489e",size:"1",class:"ion-text-center"},t("ion-button",{key:"69d5d0cd83f36aea9d158d514636bced6ccdcc4c",fill:"clear",disabled:!this.validShapeType,onClick:()=>this.addShapeType()},t("ion-icon",{key:"1e3ded6a9a05478a305ccbee60cb0da96c8d507e",name:"add",slot:"start"}))),t("ion-col",{key:"2780cbc9b08429fb1afe8fba79d1a1cc4a7bc69a",size:"1",class:"ion-text-center"},t("ion-button",{key:"2b6e2a5ec1e0bc5794ea9d6877546a13314a68b6",fill:"clear",disabled:!this.validShapeType,onClick:()=>this.duplicateShapeType()},t("ion-icon",{key:"a8d84abb8e0a9a769c8c7e1c9a2cebbfe224dd0f",slot:"start",name:"duplicate"}))),t("ion-col",{key:"24394e9026e15bdfa08e5a146545fe77709b4e52",size:"1",class:"ion-text-center"},t("ion-button",{key:"df29d9cbe333309d17f9ad68fd8c80647b6c5bc2",fill:"clear",color:"danger",disabled:this.shapeTypes.length==0,onClick:()=>this.deleteShapeType()},t("ion-icon",{key:"91436d656f7c8db14644df6b2c80ed42ab951311",slot:"start",name:"trash"}))))),t("app-form-item",{key:"6b90f180f5f24f069766e2ae68bb8c6662565574","label-text":"Position",value:this.shapeType.position,name:"position","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"minvalue",options:{min:1}}]}),t("app-form-item",{key:"db649205eb1335eed153ea577d346a7e5062c6ef","label-text":"ID",value:this.shapeType.typeId,name:"typeId","input-type":"string",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required",{name:"uniqueid",options:{type:"list",index:"typeId",list:this.shapeTypes}}]}),t("app-form-item",{key:"b56e236d326ceb2ddfeac023094a7129e9a09ab2","label-text":"Name",value:this.shapeType.typeName,name:"typeName","input-type":"text",multiLanguage:true,"text-rows":"1",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required"]}),t("app-form-item",{key:"d135ac977cebd934beb326a8e66aad03c443e1b0","label-text":"Decimals",value:this.shapeType.decimals,name:"decimals",inputStep:"1","input-type":"number",onFormItemChanged:e=>this.handleChange(e),labelPosition:"fixed",validator:["required"]})),t("app-modal-footer",{key:"c8630579ea22d5da48a097e673d27c734dcaf4d2",color:b.getAppColor(),disableSave:!this.validShapeType,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};m.style=f;export{m as modal_shape_type};