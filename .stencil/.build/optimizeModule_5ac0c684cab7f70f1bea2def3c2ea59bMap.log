{"version":3,"names":["modalProjectQuantityunitCss","ModalProjectQuantityunitStyle0","ModalQuantityUnit","componentWillLoad","this","loadQuantityUnits","ProjectsService","downloadProjectSettings","quantityUnits","cloneDeep","getQuantityUnits","length","quantityUnit","addQuantityUnit","validateProject","selectType","ev","detail","value","handleChange","n","name","v","replace","trim","toLowerCase","validQuantityUnit","isString","quantityUnitId","updateView","QuantityUnit","push","index","duplicateQuantityUnit","deleteQuantityUnit","splice","error","SystemService","presentAlertError","save","dismiss","uploadProjectSettings","modalController","cancel","render","h","Host","key","lines","color","id","interface","label","TranslationService","getTransl","disabled","onIonChange","map","quantityUnitName","en","size","class","fill","onClick","slot","onFormItemChanged","labelPosition","validator","options","type","list","multiLanguage","Environment","getAppColor","disableSave","onCancelEmit","onSaveEmit"],"sources":["src/components/trasteel/modals/modal-project-quantityunit/modal-project-quantityunit.scss?tag=modal-project-quantityunit","src/components/trasteel/modals/modal-project-quantityunit/modal-project-quantityunit.tsx"],"sourcesContent":["modal-project-quantityunit {\n  ion-list {\n    width: 100%;\n  }\n}\n","import {Component, h, Host, State, Element} from \"@stencil/core\";\nimport {modalController} from \"@ionic/core\";\nimport {cloneDeep, isString} from \"lodash\";\nimport {TranslationService} from \"../../../../services/common/translations\";\nimport {Environment} from \"../../../../global/env\";\nimport {SystemService} from \"../../../../services/common/system\";\nimport {QuantityUnit} from \"../../../../interfaces/trasteel/refractories/projects\";\nimport {ProjectsService} from \"../../../../services/trasteel/refractories/projects\";\n\n@Component({\n  tag: \"modal-project-quantityunit\",\n  styleUrl: \"modal-project-quantityunit.scss\",\n})\nexport class ModalQuantityUnit {\n  @Element() el: HTMLElement;\n  @State() index: number = 0;\n  @State() quantityUnits: QuantityUnit[];\n  @State() quantityUnit: QuantityUnit;\n  @State() updateView = true;\n  @State() validQuantityUnit = false;\n\n  async componentWillLoad() {\n    await this.loadQuantityUnits();\n  }\n\n  async loadQuantityUnits() {\n    await ProjectsService.downloadProjectSettings();\n    this.quantityUnits = cloneDeep(ProjectsService.getQuantityUnits());\n    if (this.quantityUnits && this.quantityUnits.length > 0) {\n      this.quantityUnit = this.quantityUnits[0];\n    } else {\n      //create new and add to list\n      this.addQuantityUnit();\n    }\n    this.validateProject();\n  }\n\n  selectType(ev) {\n    this.quantityUnit = this.quantityUnits[ev.detail.value];\n    this.validateProject();\n  }\n\n  handleChange(ev) {\n    const n = ev.detail.name;\n    let v = ev.detail.value;\n    if (n == \"familyId\") {\n      //remove spaces and lowercase\n      v = v.replace(/\\s+/g, \"-\").trim().toLowerCase();\n    }\n    this.quantityUnit[n] = v;\n    this.validateProject();\n  }\n\n  validateProject() {\n    this.validQuantityUnit =\n      isString(this.quantityUnit.quantityUnitId) &&\n      isString(this.quantityUnit.quantityUnitId);\n    this.updateView = !this.updateView;\n  }\n\n  addQuantityUnit() {\n    this.quantityUnit = new QuantityUnit();\n    this.quantityUnits.push(this.quantityUnit);\n    this.index = this.quantityUnits.length - 1;\n  }\n\n  duplicateQuantityUnit() {\n    this.quantityUnit = cloneDeep(this.quantityUnit);\n    this.quantityUnit.quantityUnitId =\n      this.quantityUnit.quantityUnitId + \"_rev.\";\n    this.quantityUnits.push(this.quantityUnit);\n    this.index = this.quantityUnits.length - 1;\n  }\n\n  async deleteQuantityUnit() {\n    try {\n      this.quantityUnits.splice(this.index, 1);\n      this.index = 0;\n      this.quantityUnit = this.quantityUnits[0];\n      this.validateProject();\n    } catch (error) {\n      if (error) SystemService.presentAlertError(error);\n    }\n  }\n\n  async save(dismiss = true) {\n    await ProjectsService.uploadProjectSettings(\n      \"quantityUnit\",\n      this.quantityUnits\n    );\n    return dismiss ? modalController.dismiss() : true;\n  }\n\n  async cancel() {\n    return modalController.dismiss();\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-content>\n          <ion-grid>\n            <ion-row>\n              <ion-col>\n                <ion-item lines=\"none\">\n                  <ion-select\n                    color=\"trasteel\"\n                    id=\"selectType\"\n                    interface=\"action-sheet\"\n                    label={TranslationService.getTransl(\n                      \"project_quantityunit\",\n                      \"Project Quantity Unit\"\n                    )}\n                    disabled={!this.validQuantityUnit}\n                    label-placement=\"floating\"\n                    onIonChange={(ev) => this.selectType(ev)}\n                    value={this.index ? this.index : 0}\n                  >\n                    {this.quantityUnits.map((quantityUnit, index) => (\n                      <ion-select-option value={index}>\n                        {quantityUnit.quantityUnitId +\n                          \" | \" +\n                          quantityUnit.quantityUnitName.en}\n                      </ion-select-option>\n                    ))}\n                  </ion-select>\n                </ion-item>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validQuantityUnit}\n                  onClick={() => this.addQuantityUnit()}\n                >\n                  <ion-icon name=\"add\" slot=\"start\" />\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validQuantityUnit}\n                  onClick={() => this.duplicateQuantityUnit()}\n                >\n                  <ion-icon slot=\"start\" name=\"duplicate\"></ion-icon>\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  color=\"danger\"\n                  disabled={this.quantityUnits.length == 0}\n                  onClick={() => this.deleteQuantityUnit()}\n                >\n                  <ion-icon slot=\"start\" name=\"trash\"></ion-icon>\n                </ion-button>\n              </ion-col>\n            </ion-row>\n          </ion-grid>\n          <app-form-item\n            label-text=\"ID\"\n            value={this.quantityUnit.quantityUnitId}\n            name=\"quantityUnitId\"\n            input-type=\"string\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\n              \"required\",\n              {\n                name: \"uniqueid\",\n                options: {\n                  type: \"list\",\n                  index: \"quantityUnitId\",\n                  list: ProjectsService.getQuantityUnits(),\n                },\n              },\n            ]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"Name\"\n            value={this.quantityUnit.quantityUnitName}\n            name=\"quantityUnitName\"\n            input-type=\"text\"\n            multiLanguage={true}\n            text-rows=\"1\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\"required\"]}\n          ></app-form-item>\n        </ion-content>\n        <app-modal-footer\n          color={Environment.getAppColor()}\n          disableSave={!this.validQuantityUnit}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}