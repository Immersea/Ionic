import{r as i,h as t,f as e}from"./p-cbe60c68.js";import{aH as s,U as o,a5 as a,T as n,aI as l}from"./p-364f0bff.js";import"./p-c7ee7cfe.js";import{b as r}from"./p-5d4a8e1f.js";import{l as h}from"./p-1af05547.js";import"./p-66796388.js";import"./p-e9c4f463.js";import"./p-be6a132e.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const c="popover-gas{}popover-gas .scrollx{display:flex;flex-wrap:nowrap;overflow-x:auto}popover-gas .scrollx .item{flex:0 0 0 0}popover-gas .scrollx ::-webkit-scrollbar{display:none}popover-gas .notification{min-height:20px;height:20px;font-size:0.8em;color:#ea6153;border-width:1px;border-color:#ea6153;padding-left:10px}popover-gas .notification .item-inner{margin-left:0px !important;border-bottom:0px !important}popover-gas .notification .icon{font-size:1.7em;padding-left:6px !important;padding-top:4px !important}";const p=c;const d=class{constructor(t){i(this,t);this.hasTrimixlicence=true;this.hasReblicence=true;this.ccr=false;this.parameters=undefined;this.stdDecoGases=undefined;this.gasProp=undefined;this.gasWarning=false;this.ENDWarning=false;this.gas=new s;this.form=undefined;this.updateView=false}async componentWillLoad(){this.hasTrimixlicence=await o.checkLicence("trimix");this.hasReblicence=await o.checkLicence("reb");this.updateStdGasList();if(this.gasProp&&this.gasProp.getFO2()){this.gas=this.gasProp}else{const i=h.exports.last(h.exports.filter(this.stdGases,{active:true}));this.gas=i?i["gas"]:new s(.21,0,30,1.2)}this.setForm();this.updateStdGasList()}componentDidLoad(){this.scrollGas=this.el.querySelector("#scrollGas");this.stdDecoGases.forEach((i=>{if(a.isImperial()){i.fromDepth=h.exports.round(a.metersToFeet(i.fromDepth)/10)*10}}));this.updateStdGasList();this.popover=this.el.closest("ion-popover")}disconnectedCallback(){this.setForm()}async setForm(){this.form=this.gas.getForm();this.hasTrimixlicence=await o.checkLicence("trimix");this.hasReblicence=await o.checkLicence("reb")}updateStdGasList(){this.stdGases=[];let i=false;let t=0,e=0;this.stdDecoGases.forEach((s=>{t++;let a=this.gas.O2===s.O2&&this.gas.He===s.He?true:false;if(a){i=true;e=t}const n=s.getGas();const l=o.userRoles.licences.checkGasLimitations(n,false);this.stdGases.push({selected:a,active:l,gas:n})}));setTimeout((()=>{if(i&&this.scrollGas){let i=this.scrollGas.scrollWidth;let s=this.scrollGas.clientWidth;let o=t/(i/s);e=e-o;e=e<0?0:e;this.scrollGas.scrollLeft=i*e/t*1.15}}));this.updateWarnings(this.gas.fromDepth,1.6)}updateWarnings(i,t){this.gasWarning=this.gas.highPO2WarningatDepthWithTarget(i,t);this.ENDWarning=this.gas.highENDWarningatDepth(this.gas.fromDepth);this.updateView=!this.updateView}selectStdGas(i){if(!this.hasTrimixlicence&&i.He>0){o.checkLicence("trimix",true);return}this.gas=i;this.setForm();this.updateStdGasList()}updateGas(i){if(i=="o2"){this.gas.setFO2(h.exports.round(h.exports.toNumber(this.form.o2),2)/100)}else if(i=="he"){this.gas.setFHe(h.exports.round(h.exports.toNumber(this.form.he),2)/100)}else if(i=="fromDepth"){this.gas.setFromDepth(h.exports.toNumber(this.form.fromDepth))}else if(i=="ppO2"){this.gas.ppO2=h.exports.toNumber(this.form.ppO2)}this.updateStdGasList()}inputHandler(i){let t=h.exports.toNumber(i.detail.value);this.form[i.detail.name]=t;this.updateGas(i.detail.name)}blurHandler(i){let t=h.exports.toNumber(i.detail.value);if(i.detail.name==="o2"){const i=o.userRoles.licences.getUserLimitations().minO2;const e=o.userRoles.licences.getUserLimitations().maxO2;if(t>e){t=e}else if(t<i){t=i}if(this.form.he+t>100){this.form.he=100-t}}else if(i.detail.name==="he"){const i=o.userRoles.licences.getUserLimitations().maxHe;if(t>i){t=i}if(this.form.o2+t>100){this.form.o2=100-t}}else if(i.detail.name==="ppO2"){t=h.exports.toNumber(t)}this.form[i.detail.name]=t;this.updateGas(i.detail.name);this.setForm();this.updateStdGasList()}setUseAsDiluent(i){this.gas.setUseAsDiluent(i);this.setForm()}async showpO2Info(){const i=await r.create({header:"pO2 setpoint",message:n.getTransl("po2-setpoint-info","The pO2 setpoint is used to update the setpoint of the CCR within the range of this level or deco gas."),buttons:[{text:n.getTransl("ok","OK")}]});i.present()}render(){return[t("ion-list",{key:"0ed69f43fcc28e6d7ea6abbec081fd15ca9ccdc5",style:{marginBottom:"0px"}},t("ion-grid",{key:"f647117ac364a00e1bf134b8458cc554c94cfb0d",class:"ion-no-padding"},t("ion-row",{key:"7ea0a611c92b045e31f76d589d7f5a36857583ca"},t("ion-col",{key:"f52ab23d424c7e7c17df4e99a8318ed65d78d7fe"},t("ion-row",{key:"ced3cc0972c3e6a257ebcbedc363e0cec1989246",class:"ion-no-padding"},t("app-form-item",{key:"87e170cbef8f88d72f0b1c0f63f8004ae8d7943a","label-text":"O2",value:this.form.o2,name:"o2","input-type":"number",onFormItemChanged:i=>this.inputHandler(i),onFormItemBlur:i=>this.blurHandler(i),forceInvalid:this.gasWarning,validator:["required",{name:"minmaxvalue",options:{min:o.userRoles.licences.getUserLimitations().minO2,max:o.userRoles.licences.getUserLimitations().maxO2}}]})),this.gasWarning?t("ion-row",{class:"ion-no-padding"},t("ion-col",null,t("div",{class:"notification"},t("ion-icon",{name:"warning","item-start":true}),"High pO2 (",this.gas.getpO2atDepth(this.gas.fromDepth),")!"))):undefined),t("ion-col",{key:"761d74c2de02c0f64b363c169326e7fa2f89a9ee"},this.hasTrimixlicence?[t("ion-row",{class:"ion-no-padding"},t("app-form-item",{"label-text":"He",value:this.form.he,name:"he","input-type":"number",onFormItemChanged:i=>this.inputHandler(i),onFormItemBlur:i=>this.blurHandler(i),forceInvalid:this.ENDWarning,validator:["required",{name:"minmaxvalue",options:{min:0,max:o.userRoles.licences.getUserLimitations().maxHe}}]})),this.ENDWarning?t("ion-row",{class:"ion-no-padding"},t("ion-col",null,t("div",{class:"notification"},t("ion-icon",{name:"warning","item-start":true}),"High END (",this.gas.getEND(this.gas.fromDepth),a.depthUnit,")!"))):undefined]:t("app-form-item",{"label-text":"He",value:this.form.he,onClick:()=>o.checkLicence("trimix",true)}))),t("ion-row",{key:"6efc47201494f2ce181923ba354b235bbafb8dad"},t("ion-col",{key:"dd3e169d76031ab3fde0ad92091f496d1931f654"},t("app-form-item",{key:"3a10267fd10e9a30fb3a8111a3798226cec77d15","label-tag":"from-depth","label-text":"From Depth",value:this.form.fromDepth,name:"fromDepth","input-type":"number",onFormItemChanged:i=>this.inputHandler(i),onFormItemBlur:i=>this.blurHandler(i),validator:["required"]}))),this.ccr?[t("ion-row",null,t("ion-col",null,this.hasReblicence?t("app-form-item",{"label-tag":"pO2-setpoint","label-text":"pO2 setPoint",value:this.form.ppO2,name:"ppO2","input-type":"number",onFormItemChanged:i=>this.inputHandler(i),onFormItemBlur:i=>this.blurHandler(i),validator:[{name:"minmaxvalue",options:{min:.5,max:1.6}}]}):t("app-form-item",{"label-tag":"pO2-setpoint","label-text":"pO2 setPoint",value:this.form.ppO2,onClick:()=>o.checkLicence("reb",true)})),t("ion-col",{size:"2",class:"ion-no-padding"},t("ion-button",{shape:"round",fill:"clear","icon-only":true,class:"ion-no-padding",onClick:()=>this.showpO2Info()},t("ion-icon",{name:"help-circle-outline"})))),t("ion-row",{class:"ion-no-padding"},t("ion-item",{style:{width:"100%"}},t("ion-label",null,t("my-transl",{tag:"use-as-diluent",text:"Use as diluent gas"})),t("ion-toggle",{color:"gue-blue",slot:"end",onIonChange:i=>this.setUseAsDiluent(i.detail.checked),checked:this.gas.getUseAsDiluent()})))]:undefined,t("ion-row",{key:"c4d3fed371b17f535be67c4aac0d2c7ece0a20a7",class:"scrollx",id:"scrollGas"},this.stdGases.map((i=>t("ion-col",{class:"item"},t("ion-button",{shape:"round",color:i.selected?"secondary":"primary",disabled:!i.active,onClick:()=>this.selectStdGas(i.gas)},l.getGasName(i.gas)))))),t("ion-row",{key:"ae13cc2224bc209f7884bf69156fd739eef28932"},t("ion-col",{key:"beae886bdc5b65935e08aa25f51145bc57730898"},t("div",{key:"f10f15bdc5ea403f11029a77db705529faceb256",class:"notification",style:{color:"blue"}},"MOD: ",this.gas.getModF(this.gas.fO2,this.gas.ppO2),a.depthUnit," @ ",this.gas.ppO2," pO2"),t("div",{key:"dc5dc1700b42aab431c64654e8dfcea492124c6e",class:"notification",style:{color:"blue"}},"pO2: ",this.gas.getpO2atDepth(this.gas.fromDepth)," @"," ",this.gas.fromDepth,a.depthUnit))))),t("app-modal-footer",{key:"31b86ff66240d5dfb53546c755f0fb4e83e5dd1a",onCancelEmit:()=>this.popover.dismiss(),onSaveEmit:()=>this.popover.dismiss(this.form)})]}get el(){return e(this)}};d.style=p;export{d as popover_gas};
//# sourceMappingURL=p-6e469d69.entry.js.map