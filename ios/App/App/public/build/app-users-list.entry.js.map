{"file":"app-users-list.entry.esm.js","mappings":"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","names":["isArray","orderBy"],"sources":["src/components/common/app/common/app-users-list/app-users-list.scss?tag=app-users-list","src/components/common/app/common/app-users-list/app-users-list.tsx"],"sourcesContent":["app-users-list {\n  width: 100%;\n}\n","import {Component, h, Prop, State} from \"@stencil/core\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {UserProfile} from \"../../../../../interfaces/common/user/user-profile\";\nimport {popoverController} from \"@ionic/core\";\nimport {isArray, orderBy} from \"lodash\";\n\n@Component({\n  tag: \"app-users-list\",\n  styleUrl: \"app-users-list.scss\",\n})\nexport class AppUsersList {\n  @Prop() item: any;\n  @Prop() editable: boolean = false;\n  @Prop() show: string[];\n  userProfile: UserProfile;\n  @State() owner: any[] = [];\n  @State() editor: any[] = [];\n  @State() instructor: any[] = [];\n  @State() divemaster: any[] = [];\n  isOwner = false;\n  groups: {\n    owner: {show: boolean; tag: string; text: string};\n    editor: {show: boolean; tag: string; text: string};\n    instructor: {show: boolean; tag: string; text: string};\n    divemaster: {show: boolean; tag: string; text: string};\n  };\n\n  async componentWillLoad() {\n    this.groups = {\n      owner: {\n        show: this.show.includes(\"owner\"),\n        tag: \"admin\",\n        text: \"Administrator\",\n      },\n      editor: {\n        show: this.show.includes(\"editor\"),\n        tag: \"editor\",\n        text: \"Editor\",\n      },\n      instructor: {\n        show: this.show.includes(\"instructor\"),\n        tag: \"instructor\",\n        text: \"Instructor\",\n      },\n      divemaster: {\n        show: this.show.includes(\"divemaster\"),\n        tag: \"divemaster\",\n        text: \"Divemaster\",\n      },\n    };\n    this.userProfile = UserService.userProfile;\n    this.isOwner =\n      isArray(this.item.users[this.userProfile.uid]) &&\n      this.item.users[this.userProfile.uid].includes(\"owner\");\n    await this.setUsers();\n  }\n\n  async setUsers() {\n    this.owner = [];\n    this.editor = [];\n    this.instructor = [];\n    for (let userId of Object.keys(this.item.users)) {\n      if (this.item.users[userId].includes(\"owner\")) {\n        this.owner.push(await UserService.getMapDataUserDetails(userId));\n      }\n      if (this.item.users[userId].includes(\"editor\")) {\n        this.editor.push(await UserService.getMapDataUserDetails(userId));\n      }\n      if (this.item.users[userId].includes(\"instructor\")) {\n        this.instructor.push(await UserService.getMapDataUserDetails(userId));\n      }\n      if (this.item.users[userId].includes(\"divemaster\")) {\n        this.divemaster.push(await UserService.getMapDataUserDetails(userId));\n      }\n    }\n    this.owner = orderBy(this.owner, \"displayName\");\n    this.editor = orderBy(this.editor, \"displayName\");\n    this.instructor = orderBy(this.instructor, \"displayName\");\n    this.divemaster = orderBy(this.divemaster, \"displayName\");\n  }\n\n  async addUser(role) {\n    const popover = await popoverController.create({\n      component: \"popover-search-user\",\n      translucent: true,\n    });\n    popover.onDidDismiss().then((ev) => {\n      const userId = ev.data;\n      let user = this.item.users[userId];\n      if (user && !this.item.users[userId].includes(role)) {\n        this.item.users[userId].push(role);\n      } else if (!user) {\n        this.item.users[userId] = [role];\n      }\n      this.setUsers();\n    });\n    popover.present();\n  }\n\n  removeUser(user, role) {\n    const index = this.item.users[user.uid].findIndex((item) => item == role);\n    this.item.users[user.uid].splice(index, 1);\n    if (this.item.users[user.uid].length == 0) {\n      delete this.item.users[user.uid];\n    }\n    this.setUsers();\n  }\n\n  render() {\n    return [\n      <ion-list>\n        {Object.keys(this.groups).map((group) => [\n          this.groups[group].show && (this[group].length > 0 || this.editable)\n            ? [\n                <ion-item lines=\"full\">\n                  <my-transl\n                    tag={this.groups[group].tag}\n                    text={this.groups[group].text}\n                    isLabel\n                  ></my-transl>\n                  {this.editable &&\n                  (this.isOwner || UserService.userRoles.isSuperAdmin()) ? (\n                    <ion-button\n                      color=\"primary\"\n                      fill=\"clear\"\n                      slot=\"end\"\n                      onClick={() => this.addUser(group)}\n                    >\n                      <ion-icon name=\"add-circle\"></ion-icon>\n                    </ion-button>\n                  ) : undefined}\n                </ion-item>,\n              ]\n            : undefined,\n          this[group].length > 0\n            ? [\n                this[group].map((user) => (\n                  <ion-item>\n                    {this.editable &&\n                    (this.isOwner || UserService.userRoles.isSuperAdmin()) ? (\n                      <ion-button\n                        icon-only\n                        slot=\"end\"\n                        color=\"danger\"\n                        fill=\"clear\"\n                        disabled={UserService.userRoles.uid == user.uid}\n                        onClick={() => this.removeUser(user, group)}\n                      >\n                        <ion-icon name=\"trash-bin-outline\"></ion-icon>\n                      </ion-button>\n                    ) : undefined}\n                    {user.photoURL ? (\n                      <ion-avatar slot=\"start\">\n                        <ion-img src={user.photoURL} />\n                      </ion-avatar>\n                    ) : undefined}\n                    <ion-label>{user.displayName}</ion-label>\n                  </ion-item>\n                )),\n              ]\n            : undefined,\n        ])}\n      </ion-list>,\n    ];\n  }\n}\n"],"version":3}