{"file":"app-map.entry.esm.js","mappings":"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","names":["toNumber","each"],"sources":["src/components/common/app/map/app-map/app-map.scss?tag=app-map","src/components/common/app/map/app-map/app-map.tsx"],"sourcesContent":["app-map {\n  width: 100%;\n  height: 100%;\n\n  div[id=\"load-message\"] {\n    text-align: center;\n    width: 100%;\n    height: 100%;\n    top: 0px;\n    bottom: 0px;\n    left: 0px;\n    flex: 1;\n    div {\n      padding-top: 30%;\n    }\n  }\n  div[id^=\"map-container-\"] {\n    visibility: hidden;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0px;\n    bottom: 0px;\n    left: 0px;\n    flex: 1;\n    background-color: transparent;\n  }\n\n  div[id^=\"map-container-dashboard\"] {\n    border-radius: 10px;\n    -moz-border-radius: 10px;\n    -webkit-mask-border-radius: 10px;\n    -webkit-border-radius: 10px;\n  }\n  /*\n  .marker {\n    //background-image: url(\"../../../assets/images/checkmark.svg\");\n    background: radial-gradient(\n      rgba(255, 255, 255, 0.8) 0%,\n      rgba(255, 255, 255, 0) 90%\n    );\n    font-size: 30px;\n    background-size: cover;\n    width: 35px;\n    height: 35px;\n    border-radius: 50%;\n    cursor: pointer;\n  }*/\n  .mapboxgl-popup-tip {\n    border-top-color: rgba(255, 255, 255, 0.8) !important;\n    border-bottom-color: rgba(255, 255, 255, 0.8) !important;\n  }\n  .mapboxgl-popup-content {\n    background-color: rgba(255, 255, 255, 0.8);\n    padding: 0;\n  }\n}\n","import {\n  Component,\n  h,\n  Method,\n  State,\n  Prop,\n  Event,\n  EventEmitter,\n  Element,\n  Host,\n  Watch,\n} from \"@stencil/core\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {toastController} from \"@ionic/core\";\nimport {MAPBOX, Environment} from \"../../../../../global/env\";\nimport mapboxgl from \"mapbox-gl\";\n//import {UDiveFilterService} from \"../../../../../services/udive/ud-db-filter\";\nimport {CollectionGroup, SearchTag} from \"../../../../../interfaces/interfaces\";\nimport {DatabaseService} from \"../../../../../services/common/database\";\nimport {Subscription} from \"rxjs\";\nimport {Marker} from \"../../../../../interfaces/interfaces\";\n\nimport {Geolocation} from \"@capacitor/geolocation\";\nimport {Network} from \"@capacitor/network\";\n//import {TrasteelFilterService} from \"../../../../../services/trasteel/ud-db-filter\";\nimport {MapService, Position} from \"../../../../../services/common/map\";\nimport {UDiveFilterService} from \"../../../../../services/udive/ud-db-filter\";\nimport {TrasteelFilterService} from \"../../../../../services/trasteel/common/trs-db-filter\";\nimport {each, toNumber} from \"lodash\";\n\n/*const shapes = {\n  BLOB:\n    \"M129.9,75C86.6,150 -86.6,150 -129.9,75C-173.2,0 -86.6,-150 0,-150C86.6,-150 173.2,0 129.9,75Z\",\n  MAP_PIN:\n    \"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z\",\n  SQUARE_PIN: \"M22-48h-44v43h16l6 5 6-5h16z\",\n  SHIELD:\n    \"M18.8-31.8c.3-3.4 1.3-6.6 3.2-9.5l-7-6.7c-2.2 1.8-4.8 2.8-7.6 3-2.6.2-5.1-.2-7.5-1.4-2.4 1.1-4.9 1.6-7.5 1.4-2.7-.2-5.1-1.1-7.3-2.7l-7.1 6.7c1.7 2.9 2.7 6 2.9 9.2.1 1.5-.3 3.5-1.3 6.1-.5 1.5-.9 2.7-1.2 3.8-.2 1-.4 1.9-.5 2.5 0 2.8.8 5.3 2.5 7.5 1.3 1.6 3.5 3.4 6.5 5.4 3.3 1.6 5.8 2.6 7.6 3.1.5.2 1 .4 1.5.7l1.5.6c1.2.7 2 1.4 2.4 2.1.5-.8 1.3-1.5 2.4-2.1.7-.3 1.3-.5 1.9-.8.5-.2.9-.4 1.1-.5.4-.1.9-.3 1.5-.6.6-.2 1.3-.5 2.2-.8 1.7-.6 3-1.1 3.8-1.6 2.9-2 5.1-3.8 6.4-5.3 1.7-2.2 2.6-4.8 2.5-7.6-.1-1.3-.7-3.3-1.7-6.1-.9-2.8-1.3-4.9-1.2-6.4z\",\n  ROUTE:\n    \"M24-28.3c-.2-13.3-7.9-18.5-8.3-18.7l-1.2-.8-1.2.8c-2 1.4-4.1 2-6.1 2-3.4 0-5.8-1.9-5.9-1.9l-1.3-1.1-1.3 1.1c-.1.1-2.5 1.9-5.9 1.9-2.1 0-4.1-.7-6.1-2l-1.2-.8-1.2.8c-.8.6-8 5.9-8.2 18.7-.2 1.1 2.9 22.2 23.9 28.3 22.9-6.7 24.1-26.9 24-28.3z\",\n  SQUARE: \"M-24-48h48v48h-48z\",\n  SQUARE_ROUNDED:\n    \"M24-8c0 4.4-3.6 8-8 8h-32c-4.4 0-8-3.6-8-8v-32c0-4.4 3.6-8 8-8h32c4.4 0 8 3.6 8 8v32z\"\n};*/\n\n@Component({\n  tag: \"app-map\",\n  styleUrl: \"app-map.scss\",\n})\nexport class AppMap {\n  @Element() el: HTMLElement;\n  @Event() mapLoadingCompleted: EventEmitter;\n  @Event() dragMarkerEnd: EventEmitter;\n  @Event() emitMapBounds: EventEmitter;\n  @Prop() pageId: string;\n  @Prop({mutable: true}) markers: Marker[] = []; //used to insert markers from outside component - in case of any marker then the map is not populated\n  @Prop() markersAsFeature = false;\n  @Prop({mutable: true}) searchTags: SearchTag[] = []; //used to search markers inside the database\n\n  @Prop() center: any;\n  @Prop({mutable: true}) currentPosition: boolean = false;\n  @Prop({mutable: true}) draggableMarkerPosition: any; //set to {} to get the marker in the current user position - otherwise set to lat/lon\n\n  @State() mapsLoaded: boolean = false;\n  @State() loadErrorMessage: string = \"\";\n\n  public map: any;\n\n  private mapElement: any;\n  private networkHandler = null;\n  toast: HTMLIonToastElement;\n  currentMarkers = [];\n  draggableMapMarker: any;\n  startLocation: Position = null;\n  searchFilters = [];\n  markerCollections: CollectionGroup;\n  geoJsonData: any[] = [];\n  actualCenterPosition: any;\n  mapDataSub$: Subscription;\n  dbFilter: any;\n\n  waitForMapCounts = 0;\n\n  @Watch(\"markers\")\n  updateMarkers() {\n    //remove markers\n    this.currentMarkers.forEach((marker) => {\n      marker.remove();\n    });\n    this.addMarkers();\n  }\n\n  addMarkers() {\n    //add markers as clustered points like MapData or as normal markers\n    if (this.markersAsFeature) {\n      if (this.markers.length > 0) {\n        this.addMapPointsForCollection(\n          this.markers,\n          \"primary\",\n          \"markers-feature\"\n        );\n        this.fitToBounds(this.markers);\n      }\n    } else {\n      //add markers\n      this.currentMarkers = [];\n      if (this.markers.length > 0) {\n        this.markers.forEach((marker: Marker) => {\n          var el = Object.assign(document.createElement(\"app-map-icon\"), {\n            marker: marker,\n          });\n          let lngLat = new mapboxgl.LngLat(\n            toNumber(marker.longitude),\n            toNumber(marker.latitude)\n          );\n          const mapBoxMarker = new mapboxgl.Marker(el)\n            .setLngLat(lngLat)\n            .addTo(this.map);\n          // Add a layer for the marker icon\n\n          if (marker.clickFn)\n            mapBoxMarker.getElement().addEventListener(\"click\", () => {\n              marker.clickFn();\n            });\n          this.currentMarkers.push(mapBoxMarker);\n        });\n        this.fitToBounds(this.markers);\n      }\n    }\n  }\n\n  @Method()\n  async mapLoaded(): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      this.waitForMapCounts = 0;\n      this.waitForMap(resolve, reject);\n    });\n  }\n  waitForMap(resolveFunc, rejectFunc) {\n    if (this.map) {\n      this.map.on(\"load\", () => resolveFunc(true));\n    } else if (this.waitForMapCounts <= 20) {\n      setTimeout(() => {\n        this.waitForMapCounts += 1;\n        this.waitForMap(resolveFunc, rejectFunc);\n      }, 200);\n    } else {\n      rejectFunc(false);\n    }\n  }\n\n  @Method()\n  async createLine(id, pointA, pointB) {\n    if (pointA && pointB) {\n      const geojson = {\n        type: \"FeatureCollection\",\n        features: [\n          {\n            type: \"Feature\",\n            geometry: {\n              type: \"LineString\",\n              coordinates: [\n                [\n                  pointA.position.geopoint.longitude,\n                  pointA.position.geopoint.latitude,\n                ],\n                [\n                  pointB.position.geopoint.longitude,\n                  pointB.position.geopoint.latitude,\n                ],\n              ],\n            },\n          },\n        ],\n      };\n      this.map.addSource(id, {\n        type: \"geojson\",\n        data: geojson,\n      });\n      this.map.addLayer({\n        id: id,\n        type: \"line\",\n        source: id,\n        layout: {\n          \"line-join\": \"round\",\n          \"line-cap\": \"round\",\n        },\n        paint: {\n          \"line-color\": \"#1ac8ff\",\n          \"line-width\": 5,\n        },\n      });\n    }\n\n    return true;\n  }\n\n  @Method()\n  async removeLine(id) {\n    if (this.map.getLayer(id)) this.map.removeLayer(id);\n    if (this.map.getSource(id)) this.map.removeSource(id);\n    return true;\n  }\n\n  @Method()\n  async fitToBounds(points?) {\n    if (this.map) {\n      if (points && points.length > 0) {\n        if (points.length > 1) {\n          const bounds = new mapboxgl.LngLatBounds();\n          points.forEach((point) => {\n            if (point) {\n              let lngLat = null;\n              if (point.position) {\n                lngLat = new mapboxgl.LngLat(\n                  point.position.geopoint.longitude,\n                  point.position.geopoint.latitude\n                );\n              } else {\n                lngLat = new mapboxgl.LngLat(point.longitude, point.latitude);\n              }\n              bounds.extend(lngLat);\n            }\n          });\n          this.map.fitBounds(bounds, {\n            padding: {top: 100, bottom: 100, left: 100, right: 100},\n            duration: 500,\n          });\n        } else {\n          //set zoom level and center map\n          let lngLat = null;\n          if (points[0].position) {\n            lngLat = new mapboxgl.LngLat(\n              points[0].position.geopoint.longitude,\n              points[0].position.geopoint.latitude\n            );\n          } else {\n            lngLat = new mapboxgl.LngLat(\n              points[0].longitude,\n              points[0].latitude\n            );\n          }\n          this.map.easeTo({\n            center: lngLat,\n            zoom: 18,\n          });\n        }\n        this.map.resize();\n        return true;\n      } else if (this.geoJsonData.length > 0) {\n        const bounds = new mapboxgl.LngLatBounds();\n        this.geoJsonData.forEach((geojson) => {\n          geojson.features.forEach((feature) => {\n            bounds.extend(feature.geometry.coordinates);\n          });\n        });\n        this.map.fitBounds(bounds, {\n          padding: {top: 100, bottom: 100, left: 100, right: 100},\n          duration: 500,\n        });\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  @Method()\n  async triggerMapResize() {\n    this.mapLoaded().then(() => {\n      this.mapFlyTo(this.actualCenterPosition);\n      this.map.resize();\n    });\n  }\n\n  @Method()\n  async closePopup() {\n    this.map.fire(\"closePopup\");\n    return true;\n  }\n\n  @Method()\n  async updateSearchTags(searchTags) {\n    this.searchTags = searchTags;\n    this.dbFilter.filterDocuments(searchTags);\n    return true;\n  }\n\n  @Watch(\"draggableMarkerPosition\")\n  async updateDraggableMarkerPos() {\n    const lngLat = new mapboxgl.LngLat(\n      this.draggableMarkerPosition.lon,\n      this.draggableMarkerPosition.lat\n    );\n    this.draggableMapMarker.setLngLat(lngLat);\n    this.mapFlyTo(lngLat);\n    return true;\n  }\n\n  componentWillLoad() {\n    this.startLocation = MapService.getPosition();\n    //get updates from data collections\n    if (Environment.isUdive() || Environment.isDecoplanner()) {\n      this.dbFilter = UDiveFilterService;\n    } else if (Environment.isTrasteel()) {\n      this.dbFilter = TrasteelFilterService;\n    }\n    if (this.dbFilter) {\n      this.mapDataSub$ = this.dbFilter.mapDataSub$.subscribe((data) => {\n        this.markerCollections = data;\n        this.createGeoJsonData();\n      });\n    } else {\n      this.createGeoJsonData();\n    }\n  }\n\n  componentDidLoad() {\n    //init map\n    this.init().then(\n      () => {\n        this.loadErrorMessage = \"\";\n      },\n      (err) => {\n        //this.loadErrorMessage = err;\n        this.mapsLoaded = false;\n        //this.createGeoJsonData();\n        this.createToastOverlay(\"Error: \" + err);\n        console.log(\"Error \", err);\n      }\n    );\n  }\n\n  disconnectedCallback() {\n    this.toast ? this.toast.dismiss() : undefined;\n    this.mapDataSub$ ? this.mapDataSub$.unsubscribe() : undefined;\n  }\n\n  async createToastOverlay(error) {\n    this.toast ? this.toast.dismiss() : undefined;\n    let message = error\n      ? error\n      : TranslationService.getTransl(\n          \"current_position\",\n          \"Looking for current position\"\n        );\n    this.toast = await toastController.create({\n      message: error ? message : message + \"...\",\n      duration: error ? 2000 : 0,\n      color: error ? \"danger\" : \"dark\",\n      buttons: [\n        {\n          icon: \"close\",\n          role: \"cancel\",\n        },\n      ],\n    });\n    this.toast.present();\n  }\n\n  init(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.loadSDK().then(\n        () => {\n          this.initMap().then(\n            () => {\n              resolve(true);\n            },\n            (err) => {\n              reject(err);\n            }\n          );\n        },\n        (err) => {\n          reject(err);\n        }\n      );\n    });\n  }\n\n  loadSDK(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      if (!this.mapsLoaded) {\n        Network.getStatus().then(\n          (status) => {\n            if (status.connected) {\n              resolve(true);\n            } else {\n              if (this.networkHandler == null) {\n                this.networkHandler = Network.addListener(\n                  \"networkStatusChange\",\n                  (status) => {\n                    if (status.connected) {\n                      this.networkHandler.remove();\n                      this.init().then(\n                        () => {\n                          this.loadErrorMessage = \"\";\n                        },\n                        (err) => {\n                          console.log(\"Error \", err);\n                          this.createToastOverlay(\"Error: \" + err);\n                          //this.loadErrorMessage = err;\n                        }\n                      );\n                    }\n                  }\n                );\n              }\n              reject(\"Network offline\");\n            }\n          },\n          (err) => {\n            console.log(err);\n            // NOTE: navigator.onLine temporarily required until Network plugin has web implementation\n            if (navigator.onLine) {\n              resolve(true);\n            } else {\n              reject(\"Network offline\");\n            }\n          }\n        );\n      } else {\n        reject(\"SDK already loaded\");\n      }\n    });\n  }\n\n  async initMap(): Promise<any> {\n    this.mapElement = this.el.querySelector(\"#map-container-\" + this.pageId);\n    const previousUserLocation: Position =\n      await DatabaseService.getLocalDocument(\"lastUserLocation\");\n    var previousUserZoom =\n      await DatabaseService.getLocalDocument(\"lastUserZoom\");\n\n    //if draggablemarker then don't find position and center on the marker\n    if (this.draggableMarkerPosition) {\n      this.currentPosition = false;\n    } else if (this.center) {\n      this.currentPosition = false;\n    } else if (!previousUserLocation || !previousUserLocation.geopoint) {\n      //find current location if there is no previous user location\n      this.currentPosition = true;\n    } else {\n      this.startLocation = MapService.getPosition(\n        previousUserLocation.geopoint.latitude,\n        previousUserLocation.geopoint.longitude\n      );\n    }\n    previousUserZoom = previousUserZoom ? previousUserZoom : 10;\n\n    mapboxgl.accessToken = MAPBOX;\n\n    let center = this.center\n      ? new mapboxgl.LngLat(\n          this.center.position.geopoint.longitude,\n          this.center.position.geopoint.latitude\n        )\n      : new mapboxgl.LngLat(\n          this.startLocation.geopoint.longitude,\n          this.startLocation.geopoint.latitude\n        );\n    this.map = new mapboxgl.Map({\n      container: this.mapElement,\n      attributionControl: false, //need this to show a compact attribution icon (i) instead of the whole text\n      center: center,\n      zoom: this.center ? \"15\" : previousUserZoom,\n    });\n    let layerId = \"satellite-v9\";\n    this.map.setStyle(\"mapbox://styles/mapbox/\" + layerId);\n    this.map.on(\"load\", () => {\n      this.mapElement.style.visibility = \"visible\";\n      this.map.resize();\n      this.mapsLoaded = true;\n      if (this.dbFilter) {\n        this.dbFilter.sendMapData();\n      } else {\n        //run incase of no dbFilter to load markers\n        this.createGeoJsonData();\n      }\n      this.loadErrorMessage = \"\";\n      // Add geolocate control to the map.\n      this.map.addControl(\n        new mapboxgl.GeolocateControl({\n          positionOptions: {\n            enableHighAccuracy: true,\n          },\n          trackUserLocation: true,\n        }),\n        \"bottom-left\"\n      );\n      this.mapLoadingCompleted.emit(true);\n    });\n    this.map.on(\"moveend\", () => {\n      this.saveCurrentPosition();\n      var bounds = this.map.getBounds();\n      this.emitMapBounds.emit(bounds);\n    });\n\n    this.map.on(\"zoom\", () => {\n      this.saveCurrentPosition();\n    });\n\n    return this.setCurrentPosition();\n  }\n\n  async setCurrentPosition(): Promise<any> {\n    return new Promise(async (resolve, reject) => {\n      //search for user position if required by Prop or if there is a new draggable marker to be set or if there is no previous user current position\n      if (\n        this.currentPosition ||\n        (this.draggableMarkerPosition &&\n          Object.keys(this.draggableMarkerPosition).length == 0) //new site/etc. draggableMarker = {}\n      ) {\n        await this.createToastOverlay(false);\n        let pos = {\n          latitude: this.startLocation.geopoint.latitude,\n          longitude: this.startLocation.geopoint.longitude,\n        };\n        Geolocation.getCurrentPosition().then(\n          (position) => {\n            if (position && position.coords) {\n              pos = {\n                latitude: position.coords.latitude,\n                longitude: position.coords.longitude,\n              };\n            }\n            if (!this.center) {\n              let lngLat = new mapboxgl.LngLat(pos.longitude, pos.latitude);\n              this.mapFlyTo(lngLat);\n            }\n            //save position in local storage for next center\n            this.saveCurrentPosition();\n            if (this.currentPosition) {\n              //this.geoPositionMarker(pos.latitude, pos.longitude);\n            } else {\n              this.draggableMarker(pos.latitude, pos.longitude);\n            }\n            this.toast.dismiss();\n\n            resolve(true);\n          },\n          () => {\n            //fly anyway to last known position and set draggable marker\n            let lngLat = new mapboxgl.LngLat(pos.longitude, pos.latitude);\n            this.mapFlyTo(lngLat);\n            if (!this.currentPosition) {\n              this.draggableMarker(pos.latitude, pos.longitude);\n            }\n            reject(\"Could not find current position\");\n          }\n        );\n      } else if (\n        this.draggableMarkerPosition &&\n        this.draggableMarkerPosition.lat\n      ) {\n        this.draggableMarker(\n          this.draggableMarkerPosition.lat,\n          this.draggableMarkerPosition.lon\n        );\n        resolve(true);\n      } else {\n        resolve(true);\n      }\n    });\n  }\n\n  saveCurrentPosition() {\n    //save position in local storage for next center\n    if (this.pageId == \"map\" || this.pageId == \"dashboard\") {\n      const center = this.map.getCenter();\n      DatabaseService.saveLocalDocument(\n        \"lastUserLocation\",\n        MapService.getPosition(center.lat, center.lon)\n      );\n      DatabaseService.saveLocalDocument(\"lastUserZoom\", this.map.getZoom());\n    }\n  }\n\n  /*async geoPositionMarker(lat, lon) {\n    var size = 100;\n    var map = this.map;\n    // implementation of CustomLayerInterface to draw a pulsing dot icon on the map\n    // see https://docs.mapbox.com/mapbox-gl-js/api/#customlayerinterface for more info\n    var pulsingDot = {\n      width: size,\n      height: size,\n      data: new Uint8Array(size * size * 4),\n\n      // get rendering context for the map canvas when layer is added to the map\n      onAdd: function() {\n        var canvas = document.createElement(\"canvas\");\n        canvas.width = this.width;\n        canvas.height = this.height;\n        this.context = canvas.getContext(\"2d\");\n      },\n\n      // called once before every frame where the icon will be used\n      render: function() {\n        var duration = 1000;\n        var t = (performance.now() % duration) / duration;\n\n        var radius = (size / 2) * 0.3;\n        var outerRadius = (size / 3) * 0.7 * t + radius;\n        var context = this.context;\n\n        // draw outer circle\n        context.clearRect(0, 0, this.width, this.height);\n        context.beginPath();\n        context.arc(\n          this.width / 2,\n          this.height / 2,\n          outerRadius,\n          0,\n          Math.PI * 2\n        );\n        context.fillStyle = \"rgba(137, 200, 200,\" + (1 - t) + \")\";\n        context.fill();\n\n        // draw inner circle\n        context.beginPath();\n        context.arc(this.width / 2, this.height / 2, radius, 0, Math.PI * 2);\n        context.fillStyle = \"rgba(137, 196, 244, 1)\";\n        context.strokeStyle = \"white\";\n        context.lineWidth = 2 + 4 * (1 - t);\n        context.fill();\n        context.stroke();\n\n        // update this image's data with data from the canvas\n        this.data = context.getImageData(0, 0, this.width, this.height).data;\n\n        // continuously repaint the map, resulting in the smooth animation of the dot\n        map.triggerRepaint();\n\n        // return `true` to let the map know that the image was updated\n        return true;\n      }\n    };\n\n    this.map.addImage(\"pulsing-dot\", pulsingDot, { pixelRatio: 2 });\n\n    this.map.addSource(\"points\", {\n      type: \"geojson\",\n      data: {\n        type: \"FeatureCollection\",\n        features: [\n          {\n            type: \"Feature\",\n            geometry: {\n              type: \"Point\",\n              coordinates: [lon, lat]\n            }\n          }\n        ]\n      }\n    });\n    this.map.addLayer({\n      id: \"points\",\n      type: \"symbol\",\n      source: \"points\",\n      layout: {\n        \"icon-image\": \"pulsing-dot\"\n      }\n    });\n  }*/\n\n  async draggableMarker(lat, lon) {\n    // create a HTML element for each feature\n    var el = document.createElement(\"ion-icon\");\n    el.className = \"marker\";\n    el.name = \"pin\";\n    el.color = \"danger\";\n    el.size = \"large\";\n    let lngLat = new mapboxgl.LngLat(toNumber(lon), toNumber(lat));\n    this.draggableMapMarker = new mapboxgl.Marker(el)\n      .setLngLat(lngLat)\n      .addTo(this.map);\n    this.draggableMapMarker.setDraggable(true);\n    this.draggableMapMarker.setOffset([0, -12]);\n    this.draggableMapMarker.on(\"dragend\", () => {\n      var lngLat = this.draggableMapMarker.getLngLat();\n      this.mapFlyTo(lngLat);\n    });\n    this.mapFlyTo(lngLat);\n  }\n\n  mapFlyTo(lngLat) {\n    if (lngLat && lngLat.lat) {\n      this.actualCenterPosition = lngLat;\n      this.dragMarkerEnd.emit({\n        lat: lngLat.lat,\n        lon: lngLat.lng,\n      });\n      this.map.flyTo({\n        center: lngLat,\n        essential: true,\n      });\n    }\n  }\n\n  async createGeoJsonData() {\n    if (this.mapsLoaded) {\n      if (!this.markers || this.markers.length == 0) {\n        //this.dbFilter.filterDocuments(this.searchTags);\n        //this.markerCollections = this.dbFilter.mapData;\n        this.geoJsonData = [];\n        each(this.markerCollections, async (collectionItems, collectionKey) => {\n          const collection = collectionItems.filteredCollection;\n          this.addMapPointsForCollection(\n            collection,\n            collectionItems.icon ? collectionItems.icon.color : \"primary\",\n            collectionKey\n          );\n        });\n      } else {\n        this.addMarkers();\n      }\n    }\n  }\n\n  addMapPointsForCollection(collection, color, key) {\n    const featureCollection = {\n      type: \"FeatureCollection\",\n      crs: {\n        type: \"name\",\n        properties: {\n          name: key,\n          color: color,\n        },\n      },\n      features: [],\n    };\n    each(collection, async (markerItem, markerKey) => {\n      if (markerItem && markerItem.position) {\n        featureCollection.features.push({\n          type: \"Feature\",\n          properties: {\n            id: markerKey,\n            item: JSON.stringify(markerItem),\n            collection: key,\n          },\n          geometry: {\n            type: \"Point\",\n            coordinates: [\n              markerItem.position.geopoint.longitude,\n              markerItem.position.geopoint.latitude,\n            ],\n          },\n        });\n      }\n    });\n\n    if (featureCollection.features.length > 0) {\n      this.geoJsonData.push(featureCollection);\n      this.addCluster(featureCollection);\n    } else {\n      //remove old collection\n      this.removeCluster(featureCollection);\n    }\n  }\n\n  async addCluster(geoJsonData) {\n    if (this.map) {\n      const dataName = geoJsonData.crs.properties.name;\n      const dataColor = geoJsonData.crs.properties.color;\n\n      //set first layers\n      const layer1Id = \"clusters-\" + dataName;\n      const layer2Id = \"cluster-count-\" + dataName;\n      const layer3Id = \"unclustered-point-\" + dataName;\n      const source = this.map.getSource(dataName);\n      if (!source) {\n        // Add a new source from our GeoJSON data and\n        // set the 'cluster' option to true. GL-JS will\n        // add the point_count property to your source data.\n        this.map.addSource(dataName, {\n          type: \"geojson\",\n          // Point to GeoJSON data.\n          data: geoJsonData,\n          cluster: true,\n          clusterMaxZoom: 14, // Max zoom to cluster points on\n          clusterRadius: 50, // Radius of each cluster when clustering points (defaults to 50)\n        });\n        this.map.addLayer({\n          id: layer1Id,\n          type: \"circle\",\n          source: dataName,\n          filter: [\"has\", \"point_count\"],\n          paint: {\n            // Use step expressions (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-step)\n            // with three steps to implement three types of circles:\n            //   * 20px circles when point count is less than 100\n            //   * 30px circles when point count is between 100 and 300\n            //   * 40px circles when point count is greater than or equal to 300\n            \"circle-color\": getComputedStyle(\n              document.documentElement\n            ).getPropertyValue(\"--ion-color-\" + dataColor),\n            \"circle-radius\": [\n              \"step\",\n              [\"get\", \"point_count\"],\n              20,\n              100,\n              30,\n              300,\n              40,\n            ],\n          },\n        });\n\n        this.map.addLayer({\n          id: layer2Id,\n          type: \"symbol\",\n          source: dataName,\n          filter: [\"has\", \"point_count\"],\n          layout: {\n            \"text-field\": \"{point_count_abbreviated}\",\n            \"text-font\": [\"DIN Offc Pro Medium\", \"Arial Unicode MS Bold\"],\n            \"text-size\": 12,\n          },\n        });\n\n        this.map.addLayer({\n          id: layer3Id,\n          type: \"circle\",\n          source: dataName,\n          filter: [\"!\", [\"has\", \"point_count\"]],\n          paint: {\n            \"circle-color\": getComputedStyle(\n              document.documentElement\n            ).getPropertyValue(\"--ion-color-\" + dataColor),\n            \"circle-radius\": 8,\n            \"circle-stroke-width\": 1,\n            \"circle-stroke-color\": \"#fff\",\n          },\n        });\n\n        // inspect a cluster on click\n        this.map.on(\"click\", layer1Id, (e) => {\n          var features = this.map.queryRenderedFeatures(e.point, {\n            layers: [layer1Id],\n          });\n          var clusterId = features[0].properties.cluster_id;\n          this.map\n            .getSource(dataName)\n            .getClusterExpansionZoom(clusterId, (err, zoom) => {\n              if (err) return;\n\n              this.map.easeTo({\n                center: features[0].geometry.coordinates,\n                zoom: zoom,\n              });\n            });\n        });\n\n        // When a click event occurs on a feature in\n        // the unclustered-point layer, open a popup at\n        // the location of the feature, with\n        // description HTML from its properties.\n        this.map.on(\"click\", layer3Id, (e) => {\n          const coordinates = e.features[0].geometry.coordinates.slice();\n          // Ensure that if the map is zoomed out such that\n          // multiple copies of the feature are visible, the\n          // popup appears over the copy being pointed to.\n          while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n          }\n\n          // create the popup\n          const properties = JSON.stringify(e.features[0].properties);\n          const popup = new mapboxgl.Popup({offset: 15})\n            .setLngLat(coordinates)\n            .setHTML(\"<app-map-popup properties='\" + properties + \"' />\")\n            .addTo(this.map);\n          // Add a custom event listener to the map\n          this.map.on(\"closePopup\", () => {\n            popup.remove();\n          });\n        });\n\n        this.map.on(\"mouseenter\", layer1Id, () => {\n          this.map.getCanvas().style.cursor = \"pointer\";\n        });\n        this.map.on(\"mouseleave\", layer1Id, () => {\n          this.map.getCanvas().style.cursor = \"\";\n        });\n        this.map.on(\"mouseenter\", layer3Id, () => {\n          this.map.getCanvas().style.cursor = \"pointer\";\n        });\n        this.map.on(\"mouseleave\", layer3Id, () => {\n          this.map.getCanvas().style.cursor = \"\";\n        });\n      } else {\n        //update source data\n        source.setData(geoJsonData);\n      }\n    }\n  }\n\n  removeCluster(geoJsonData) {\n    if (this.map) {\n      const sourceId = geoJsonData.crs.properties.name;\n      // Find all layers that use the source\n      this.map.getStyle().layers.forEach((layer) => {\n        if (layer.source === sourceId) {\n          this.map.removeLayer(layer.id);\n        }\n      });\n\n      // Once all layers are removed, remove the source\n      if (this.map.getSource(sourceId)) {\n        this.map.removeSource(sourceId);\n      }\n    }\n  }\n\n  /*@Method()\n  async addMarker(marker: Marker) {\n    var mapMarker = null;\n    if (USE_GOOGLE) {\n      let latLng = new google.maps.LatLng(marker.lat, marker.lon);\n      mapMarker = new google.maps.Marker({\n        map: this.map,\n        position: latLng,\n        animation: google.maps.Animation.DROP,\n        icon: {\n          path: shapes.ROUTE,\n          fillColor: marker.icon.color,\n          fillOpacity: 0.8,\n          strokeColor: \"\",\n          strokeWeight: 0,\n          labelOrigin: new google.maps.Point(0, -26)\n        },\n        label: {\n          fontFamily: \"'map-icons'\",\n          text: marker.icon.name, //icon code\n          fontSize: \"30px\",\n          fontWeight: \"900\", //careful! some icons in FA5 only exist for specific font weights\n          color: \"blue\" //color of the text inside marker\n        }\n      });\n    } else {\n      let latLng = new mapboxgl.LngLat(\n        toNumber(marker.lon),\n        toNumber(marker.lat)\n      );\n      // create a HTML element for each feature\n      var el = document.createElement(\"ion-icon\");\n      if (marker.icon.type == \"mapicon\") {\n        el.className = \"marker map-icon \" + marker.icon.name;\n      } else {\n        el.className = \"marker\";\n        el.name = marker.icon.name;\n      }\n      el.color = marker.icon.color;\n      // make a marker for each feature and add to the map\n      // create the popup\n      var popup = new mapboxgl.Popup({ offset: 15 }).setHTML(\n        \"<app-map-popup name='\" +\n          marker.name +\n          \"' collection='\" +\n          marker.collection +\n          \"' item='\" +\n          marker.id +\n          \"' />\"\n      );\n      mapMarker = new mapboxgl.Marker(el)\n        .setLngLat(latLng)\n        .setPopup(popup)\n        .addTo(this.map);\n    }\n    return mapMarker;\n  }\n\n  @Method()\n  async getCenter() {\n    return this.map.getCenter();\n  }*/\n\n  render() {\n    return (\n      <Host>\n        <div id={\"map-container-\" + this.pageId}></div>\n        {!this.mapsLoaded ? (\n          <div id=\"load-message\">\n            {this.loadErrorMessage != \"\" ? (\n              <div>\n                <ion-icon name=\"warning\" color=\"dark\"></ion-icon>\n                <ion-text color=\"dark\">\n                  <h3>{this.loadErrorMessage}</h3>\n                </ion-text>\n              </div>\n            ) : (\n              <div>\n                <ion-spinner name=\"bubbles\" color=\"dark\"></ion-spinner>\n                <ion-text color=\"dark\">\n                  <h3>\n                    <my-transl tag=\"loading_map\" text=\"Loading map\"></my-transl>\n                    ...\n                  </h3>\n                </ion-text>\n              </div>\n            )}\n          </div>\n        ) : undefined}\n      </Host>\n    );\n  }\n}\n"],"version":3}