{"file":"modal-dive-trip-update.entry.esm.js","mappings":"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","names":["orderBy","isString","toNumber"],"sources":["src/components/udive/modals/dive-trip/modal-dive-trip-update/modal-dive-trip-update.scss?tag=modal-dive-trip-update","src/components/udive/modals/dive-trip/modal-dive-trip-update/modal-dive-trip-update.tsx"],"sourcesContent":["modal-dive-trip-update {\n  ion-list {\n    width: 100%;\n  }\n  ion-segment-button {\n    --color-checked: var(--ion-color-divetrip-contrast);\n  }\n}\n","import {Component, h, Host, Prop, State, Element} from \"@stencil/core\";\nimport {DiveTrip} from \"../../../../../interfaces/udive/dive-trip/diveTrip\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {modalController} from \"@ionic/core\";\nimport {isString, orderBy, toNumber} from \"lodash\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {DiveTripsService} from \"../../../../../services/udive/diveTrips\";\nimport Swiper from \"swiper\";\n\n@Component({\n  tag: \"modal-dive-trip-update\",\n  styleUrl: \"modal-dive-trip-update.scss\",\n})\nexport class ModalDiveTripUpdate {\n  @Element() el: HTMLElement;\n  @Prop() diveTripId: string = undefined;\n  @Prop() collectionId: string;\n  @Prop() organiserId: string;\n  @State() diveTrip: DiveTrip;\n  @State() updateView = true;\n  @State() validTrip = false;\n  placeholder: string;\n  @State() titles = [{tag: \"dives\"}, {tag: \"team\"}, {tag: \"bookings\"}];\n  @State() slider: Swiper;\n\n  async componentWillLoad() {\n    await this.loadDiveTrip();\n    this.placeholder = TranslationService.getTransl(\n      \"insert-title\",\n      \"Insert title\"\n    );\n  }\n\n  async loadDiveTrip() {\n    if (this.diveTripId) {\n      this.diveTrip = await DiveTripsService.getDiveTrip(this.diveTripId);\n    } else {\n      this.diveTrip = new DiveTrip();\n      this.diveTrip.organiser = {\n        collectionId: this.collectionId,\n        id: this.organiserId,\n      };\n      this.diveTrip.users = {\n        [UserService.userRoles.uid]: [\"owner\"],\n      };\n    }\n  }\n\n  async componentDidLoad() {\n    this.slider = new Swiper(\".slider-dive-trip\", {\n      speed: 400,\n      spaceBetween: 100,\n      allowTouchMove: false,\n      autoHeight: true,\n      on: {\n        slideChange: () => {\n          this.slider ? this.slider.updateAutoHeight() : null;\n        },\n      },\n    });\n    this.validateTrip();\n  }\n\n  async addDiveTrip(tripIndex?: number, diveIndex?: number) {\n    this.diveTrip = await DiveTripsService.addDiveTrip(\n      this.diveTrip,\n      tripIndex,\n      diveIndex\n    );\n    this.validateTrip();\n  }\n\n  removeDiveTrip(index) {\n    this.diveTrip = DiveTripsService.removeDiveTrip(this.diveTrip, index);\n    this.validateTrip();\n  }\n\n  removeTripDive(tripIndex, diveIndex) {\n    this.diveTrip = DiveTripsService.removeTripDive(\n      this.diveTrip,\n      tripIndex,\n      diveIndex\n    );\n    this.updateView = !this.updateView;\n  }\n\n  setTitle(ev) {\n    this.diveTrip.displayName = ev.target.value;\n    this.validateTrip();\n  }\n\n  validateTrip() {\n    this.diveTrip.tripDives = orderBy(\n      this.diveTrip.tripDives,\n      \"divePlan.dives[0].date\"\n    );\n    this.validTrip =\n      isString(this.diveTrip.displayName) &&\n      this.diveTrip.displayName.length > 3 &&\n      this.diveTrip.tripDives.length > 0;\n    this.updateView = !this.updateView;\n  }\n\n  async save() {\n    await DiveTripsService.updateDiveTrip(this.diveTripId, this.diveTrip);\n    return modalController.dismiss(false);\n  }\n\n  async cancel() {\n    return modalController.dismiss(true);\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-header>\n          <ion-toolbar color=\"divetrip\">\n            <ion-title>\n              <ion-input\n                placeholder={this.placeholder + \"...\"}\n                inputmode=\"text\"\n                onIonInput={(ev) => this.setTitle(ev)}\n                value={this.diveTrip.displayName}\n              ></ion-input>\n            </ion-title>\n          </ion-toolbar>\n        </ion-header>\n        <app-header-segment-toolbar\n          color=\"divetrip\"\n          swiper={this.slider}\n          titles={this.titles}\n        ></app-header-segment-toolbar>\n        <ion-content class=\"slides\">\n          <swiper-container class=\"slider-dive-trip swiper\">\n            <swiper-wrapper class=\"swiper-wrapper\">\n              <swiper-slide class=\"swiper-slide\">\n                <ion-grid>\n                  <ion-row class=\"ion-text-start\">\n                    {this.diveTrip.tripDives.map((trip, i) => (\n                      <ion-col size-sm=\"12\" size-md=\"6\" size-lg=\"4\">\n                        <app-dive-trip-card\n                          tripDive={trip}\n                          editable={true}\n                          updateView={this.updateView}\n                          onAddDiveEmit={() => this.addDiveTrip(i)}\n                          onRemoveDiveTripEmit={() => this.removeDiveTrip(i)}\n                          onRemoveTripDiveEmit={(ev) =>\n                            this.removeTripDive(i, toNumber(ev.detail))\n                          }\n                          onUpdateDiveEmit={(ev) =>\n                            this.addDiveTrip(i, toNumber(ev.detail))\n                          }\n                        />\n                      </ion-col>\n                    ))}\n                    <ion-col size-sm=\"12\" size-md=\"6\" size-lg=\"4\">\n                      <ion-card onClick={() => this.addDiveTrip()}>\n                        <ion-card-content class=\"ion-text-center\">\n                          <ion-icon\n                            name=\"add-circle-outline\"\n                            style={{fontSize: \"130px\"}}\n                          ></ion-icon>\n                        </ion-card-content>\n                      </ion-card>\n                    </ion-col>\n                  </ion-row>\n                </ion-grid>\n              </swiper-slide>\n              <swiper-slide class=\"swiper-slide\">\n                <app-users-list\n                  item={this.diveTrip}\n                  editable\n                  show={[\"owner\", \"divemaster\", \"instructor\"]}\n                />\n              </swiper-slide>\n\n              <swiper-slide class=\"swiper-slide\">\n                <ion-grid>\n                  <ion-row>\n                    {Object.keys(this.diveTrip.tripDives).map((i) => (\n                      <ion-col size-sm=\"12\" size-md=\"12\" size-lg=\"12\">\n                        <app-dive-trip-bookings\n                          diveTrip={this.diveTrip}\n                          diveTripId={this.diveTripId}\n                          tripDiveIndex={toNumber(i)}\n                          editable={true}\n                        />\n                      </ion-col>\n                    ))}\n                  </ion-row>\n                </ion-grid>\n              </swiper-slide>\n            </swiper-wrapper>\n          </swiper-container>\n        </ion-content>\n        <app-modal-footer\n          disableSave={!this.validTrip}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"version":3}