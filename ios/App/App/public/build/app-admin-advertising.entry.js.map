{"file":"app-admin-advertising.entry.esm.js","mappings":"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","names":["orderBy"],"sources":["src/interfaces/common/advertising/advertising.ts","src/services/common/advertising.ts","src/components/common/app/admin/app-admin-advertising/app-admin-advertising.scss?tag=app-admin-advertising","src/components/common/app/admin/app-admin-advertising/app-admin-advertising.tsx"],"sourcesContent":["import { getRandomId } from \"../../../helpers/utils\";\n\nexport interface AdvertisingDoc {\n  [id: string]: Advertising;\n}\n\nexport class Advertising {\n  id: string;\n  order: number;\n  title: string;\n  subtitle: string;\n  description: string;\n  coverURL: string;\n  link: string;\n  active: boolean;\n\n  constructor(data?) {\n    this.id = data && data.id ? data.id : getRandomId();\n    this.order = data && data.order ? data.order : 0;\n    this.title = data && data.title ? data.title : \"\";\n    this.subtitle = data && data.subtitle ? data.subtitle : \"\";\n    this.description = data && data.description ? data.description : \"\";\n    this.coverURL = data && data.coverURL ? data.coverURL : null;\n    this.link = data && data.link ? data.link : \"\";\n    this.active = data && data.active ? true : false;\n  }\n}\n","import {\n  Advertising,\n  AdvertisingDoc,\n} from \"../../interfaces/common/advertising/advertising\";\nimport {DatabaseService} from \"./database\";\nimport {SYSTEMCOLLECTION} from \"./system\";\nimport {orderBy} from \"lodash\";\nimport {alertController} from \"@ionic/core\";\nimport {TranslationService} from \"./translations\";\nimport {BehaviorSubject, Subscription} from \"rxjs\";\nimport {StorageService} from \"./storage\";\n\nexport const ADVERTISINGDOC = \"advertising\";\n\nexport class AdvertisingController {\n  advertisingDoc: AdvertisingDoc;\n  advertisingDocSub: Subscription;\n  advertisingObservable$: BehaviorSubject<Advertising[]> = new BehaviorSubject(\n    <Advertising[]>[]\n  );\n\n  async getAdvertisingObservable() {\n    const observable = await DatabaseService.getDocumentObservable(\n      SYSTEMCOLLECTION,\n      ADVERTISINGDOC\n    );\n    this.advertisingDocSub = observable.subscribe((doc) => {\n      this.advertisingDoc = {};\n      Object.keys(doc).map((key) => {\n        this.advertisingDoc[key] = new Advertising(doc[key]);\n      });\n      this.advertisingObservable$.next(this.getAdvertisingArray());\n    });\n  }\n\n  unsubscribeAdvertising() {\n    this.advertisingDocSub ? this.advertisingDocSub.unsubscribe() : undefined;\n  }\n\n  async getActiveAdvertising(): Promise<Advertising[]> {\n    const res = await DatabaseService.getDocument(\n      SYSTEMCOLLECTION,\n      ADVERTISINGDOC\n    );\n    this.advertisingDoc = {};\n    if (res) {\n      Object.keys(res).map((key) => {\n        if (res[key].active) {\n          this.advertisingDoc[key] = res[key];\n        }\n      });\n    }\n    return this.getAdvertisingArray();\n  }\n\n  getAdvertisingArray(): Advertising[] {\n    const array = [];\n    Object.keys(this.advertisingDoc).map((key) => {\n      array.push(this.advertisingDoc[key]);\n    });\n    return orderBy(array, \"order\");\n  }\n\n  async updateAdvertising(advertising: Advertising) {\n    this.advertisingDoc[advertising.id] = advertising;\n    this.reorderAdvertDoc();\n    await this.saveAdvertDoc();\n  }\n\n  reorderAdvertDoc() {\n    //reorder items\n    let array = [];\n    Object.keys(this.advertisingDoc).map((key) => {\n      array.push(this.advertisingDoc[key]);\n    });\n    array = orderBy(array, \"order\");\n    let order = 0;\n    array.map((item) => {\n      item.order = order;\n      order++;\n      this.advertisingDoc[item.id] = item;\n    });\n  }\n\n  async saveAdvertDoc() {\n    await DatabaseService.updateDocument(\n      SYSTEMCOLLECTION,\n      ADVERTISINGDOC,\n      this.advertisingDoc\n    );\n  }\n\n  async removeAdvertising(advertising: Advertising) {\n    const confirm = await alertController.create({\n      header: TranslationService.getTransl(\n        \"delete-advertising-header\",\n        \"Delete Advertising?\"\n      ),\n      message: TranslationService.getTransl(\n        \"delete-advertising-message\",\n        \"This advertising will be deleted! Are you sure?\"\n      ),\n      buttons: [\n        {\n          text: TranslationService.getTransl(\"cancel\", \"Cancel\"),\n          role: \"cancel\",\n          handler: () => {},\n        },\n        {\n          text: TranslationService.getTransl(\"ok\", \"OK\"),\n          handler: () => {\n            delete this.advertisingDoc[advertising.id];\n            StorageService.deletePhotoURLs(ADVERTISINGDOC, advertising.id);\n            this.reorderAdvertDoc();\n            this.saveAdvertDoc();\n          },\n        },\n      ],\n    });\n    confirm.present();\n  }\n\n  followAdvertisingLink(advertising) {\n    window.open(\"http://\" + advertising.link, \"_blank\");\n  }\n}\n\nexport const AdvertisingService = new AdvertisingController();\n","app-admin-advertising {\n    /* Component styles go here */\n}\n","import { Component, h, State } from \"@stencil/core\";\nimport { Advertising } from \"../../../../../interfaces/common/advertising/advertising\";\nimport { AdvertisingService } from \"../../../../../services/common/advertising\";\nimport { popoverController } from \"@ionic/core\";\nimport { Subscription } from \"rxjs\";\n\n@Component({\n  tag: \"app-admin-advertising\",\n  styleUrl: \"app-admin-advertising.scss\",\n})\nexport class AppAdminAdvertising {\n  advertisingSub: Subscription;\n  @State() advertisingArray: Advertising[] = [];\n  editable: boolean = true;\n\n  async componentWillLoad() {\n    this.advertisingSub = AdvertisingService.advertisingObservable$.subscribe(\n      (adverts) => {\n        this.advertisingArray = adverts;\n      }\n    );\n    AdvertisingService.getAdvertisingObservable();\n  }\n\n  async disconnectedCallback() {\n    this.advertisingSub.unsubscribe();\n    AdvertisingService.unsubscribeAdvertising();\n  }\n\n  async editAdvertising(event, advertising) {\n    event.stopPropagation();\n    const popover = await popoverController.create({\n      component: \"popover-edit-advertising\",\n      componentProps: { advertising: advertising },\n      event: null,\n      translucent: true,\n    });\n    popover.onDidDismiss().then(async (ev) => {\n      if (ev) {\n        const advertising = ev.data;\n        await AdvertisingService.updateAdvertising(advertising);\n      }\n    });\n    popover.present();\n  }\n\n  async removeAdvertising(event, advertising) {\n    event.stopPropagation();\n    await AdvertisingService.removeAdvertising(advertising);\n  }\n\n  render() {\n    return (\n      <ion-content>\n        {this.editable ? (\n          <ion-item\n            button\n            onClick={(ev) => this.editAdvertising(ev, null)}\n            color='light'\n          >\n            <ion-icon name='add-circle' slot='start' color='beach'></ion-icon>\n            <ion-label>\n              <my-transl tag='add' text='Add' />\n            </ion-label>\n          </ion-item>\n        ) : undefined}\n        {this.advertisingArray.map((advert) => (\n          <app-advertising-card\n            edit={true}\n            advertising={advert}\n            onEditEmit={(ev) => this.editAdvertising(ev, advert)}\n          />\n        ))}\n      </ion-content>\n    );\n  }\n}\n"],"version":3}