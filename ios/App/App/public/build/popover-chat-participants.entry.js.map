{"file":"popover-chat-participants.entry.esm.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM,0BAA0B,GAAG,6BAA6B;;MCgBnD,uBAAuB;;;QAIlC,cAAS,GAAU,EAAE,CAAC;QACtB,qBAAgB,GAAU,EAAE,CAAC;QAC7B,0BAAqB,GAAU,EAAE,CAAC;QAClC,4BAAuB,GAAU,EAAE,CAAC;QAGpC,iBAAY,GAAG,KAAK,CAAC;QACrB,yBAAoB,GAAG,KAAK,CAAC;;wBARA,IAAI;wBAKN,EAAE;0BAIP,KAAK;;IAG3B,MAAM,iBAAiB;QACrB,MAAM,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAE7D,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,KAAK,IAAI,EAAE,IAAI,gBAAgB,EAAE;YAC/B,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,CAAC;YAC/C,IAAI,WAAW,CAAC,YAAY,IAAI,cAAc,EAAE;gBAC9C,MAAM,aAAa,GAAG,MAAM,WAAW,CAAC,2BAA2B,CACjE,WAAW,CAAC,EAAE,CACf,CAAC;gBACF,IAAI,aAAa,IAAI,aAAa,CAAC,GAAG,EAAE;oBACtC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;iBACpC;aACF;SACF;QACD,IAAI,WAAW,CAAC,OAAO,EAAE,EAAE;YACzB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CACpC,oBAAoB,CAAC,iBAAiB,CACvC,CAAC;YACF,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CACpC,oBAAoB,CAAC,iBAAiB,CACvC,CAAC;YACF,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CACpC,qBAAqB,CAAC,kBAAkB,CACzC,CAAC;SACH;QACD,IAAI,CAAC,gBAAgB,GAAGA,sBAAO,CAC7B,IAAI,CAAC,SAAS,CAAC,MAAM,CACnB,CAAC,WAAW,KACV,gBAAgB,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE,CAAC;YACzC,gBAAgB,CAAC,QAAQ,CAAC,WAAW,CAAC,GAAG,CAAC,CAC7C,EACD,aAAa,CACd,CAAC;QACF,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC7C,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,KACrC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAC1C,CAAC;QAEF,IAAI,WAAW,CAAC,OAAO,EAAE,EAAE;YACzB,IAAI,CAAC,QAAQ;gBACX,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAW,CAAC,GAAG,CAAC;oBACpD,IAAI,CAAC,SAAS,CAAC,QAAQ,CACrB,qBAAqB,CAAC,uBAAuB,CAC9C;oBACD,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,oBAAoB,CAAC,sBAAsB,CAAC;oBACpE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,oBAAoB,CAAC,sBAAsB,CAAC,CAAC;SACxE;KACF;IAED,MAAM,WAAW,CAAC,EAAE;QAClB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC;QAClD,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,iBAAiB,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE;YACnD,MAAM,IAAI,GAAG,MAAM,WAAW,CAAC,iBAAiB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACpE,IAAI,IAAI,IAAI,IAAI,CAAC,GAAG,EAAE;gBACpB,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACzB,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;aAC3B;iBAAM;gBACL,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;gBACnB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;aAC1B;YACD,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;SACpC;KACF;IAED,aAAa;QACX,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAC1B,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;KACpB;IAED,OAAO,CAAC,IAAI;QACV,IAAI,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,GAAG,KAAK,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE;YACzE,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjC,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACvC;QACD,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;KAClC;IAED,UAAU,CAAC,IAAI;QACb,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAC1B,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAC7B,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,IAAI,GAAG,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CACpD,EACD,CAAC,CACF,CAAC;QACF,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAC/B,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAClC,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,IAAI,CAAC,GAAG,IAAI,GAAG,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CACpD,EACD,CAAC,CACF,CAAC;QACF,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACxC,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;QACvB,IAAI,CAAC,aAAa,EAAE,CAAC;QACrB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;KAClC;IAED,UAAU,CAAC,EAAE;QACX,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC;KAClC;IAED,KAAK;QACH,iBAAiB,CAAC,OAAO,EAAE,CAAC;KAC7B;IAED,IAAI;QACF,iBAAiB,CAAC,OAAO,CAAC;YACxB,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;YACxB,KAAK,EAAE,IAAI,CAAC,qBAAqB;YACjC,OAAO,EAAE,IAAI,CAAC,uBAAuB;SACtC,CAAC,CAAC;KACJ;IAED,MAAM;QACJ,QACE,EAAC,IAAI,uDACH,sEACE,mEACG,IAAI,CAAC,QAAQ,IAAI,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,MAAM,GAAG,CAAC,IAC9D,gBAAU,KAAK,EAAC,MAAM,IACpB,iBACE,IAAI,EAAC,KAAK,EACV,WAAW,EAAE,kBAAkB,CAAC,SAAS,CACvC,WAAW,EACX,kBAAkB,CACnB,EACD,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EACrB,UAAU,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,GAC5B,CACJ,IACT,SAAS,EACZ,IAAI,CAAC,QAAQ;cACV;gBACE,kBAAY,WAAW,UACrB,uBACE,qBACE,iBACE,GAAG,EAAC,wBAAwB,EAC5B,IAAI,EAAC,wBAAwB,GAC7B,CACQ,CACA,CACH;aACd;cACD,SAAS,EACZ,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,IAAI,MAC9B,oBACG,IAAI,CAAC,QAAQ,IACZ,kBAAY,IAAI,EAAC,OAAO,IACtB,eAAS,GAAG,EAAE,IAAI,CAAC,QAAQ,GAAI,CACpB,IACX,SAAS,EACb,qBAAY,IAAI,CAAC,WAAW,CAAa,EACxC,IAAI,CAAC,QAAQ;YACd,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC;YAClC,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,CAAC,IAC/B,kBACE,IAAI,EAAC,KAAK,qBAEV,IAAI,EAAC,OAAO,EACZ,KAAK,EAAC,QAAQ,EACd,OAAO,EAAE,MAAM,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAEpC,gBAAU,IAAI,EAAC,uBAAuB,GAAY,CACvC,IACX,SAAS,CACJ,CACZ,CAAC,CACO,EACV,IAAI,CAAC,QAAQ;cACV;gBACE,kBAAY,WAAW,UACrB,uBACE,qBACE,iBACE,GAAG,EAAC,uBAAuB,EAC3B,IAAI,EAAC,uBAAuB,GAC5B,CACQ,CACA,CACH;gBACb,kBAAY,WAAW,UACrB,uBACE,qBACE,KAAK,EAAE,IAAI,CAAC,YAAY,EACxB,WAAW,EAAC,OAAO,EACnB,SAAS,EAAC,OAAO,EACjB,IAAI,EAAC,OAAO,EACZ,YAAY,EAAC,QAAQ,EACrB,SAAS,EAAC,cAAc,EACxB,YAAY,EAAC,OAAO,EACpB,UAAU,EAAE,MAAM,IAAI,CAAC,aAAa,EAAE,EACtC,UAAU,EAAE,MAAM,IAAI,CAAC,aAAa,EAAE,EACtC,WAAW,EAAE,MAAM,IAAI,CAAC,aAAa,EAAE,EACvC,WAAW,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,GAC1B,CACL,CACH;aACd;cACD,SAAS,EACb,mEACG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,MACtB,oBACG,IAAI,CAAC,QAAQ,IACZ,kBAAY,IAAI,EAAC,OAAO,IACtB,eAAS,GAAG,EAAE,IAAI,CAAC,QAAQ,GAAI,CACpB,IACX,SAAS,EACb,qBAAY,IAAI,CAAC,WAAW,CAAa,EACzC,kBACE,IAAI,EAAC,KAAK,qBAEV,IAAI,EAAC,OAAO,EACZ,KAAK,EAAC,SAAS,EACf,OAAO,EAAE,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAEjC,gBAAU,IAAI,EAAC,oBAAoB,GAAY,CACpC,CACJ,CACZ,CAAC,EACD,IAAI,CAAC,YAAY,IAChB,oBACE,qBACE,iBAAW,GAAG,EAAC,gBAAgB,EAAC,IAAI,EAAC,gBAAgB,GAAG,CAC9C,CACH,IACT,SAAS,CACJ,CACC,EACd,yEACE,YAAY,EAAE,MAAM,IAAI,CAAC,KAAK,EAAE,EAChC,WAAW,EAAE,CAAC,IAAI,CAAC,oBAAoB,EACvC,UAAU,EAAE,MAAM,IAAI,CAAC,IAAI,EAAE,GAC7B,CACG,EACP;KACH;;;;;;;","names":["orderBy"],"sources":["src/components/common/popovers/popover-chat-participants/popover-chat-participants.scss?tag=popover-chat-participants","src/components/common/popovers/popover-chat-participants/popover-chat-participants.tsx"],"sourcesContent":["popover-chat-participants {\n  /* Component styles go here */\n}\n","import {Component, h, Host, State, Element, Prop} from \"@stencil/core\";\nimport {UserService} from \"../../../../services/common/user\";\nimport {DivingCentersService} from \"../../../../services/udive/divingCenters\";\nimport {DivingSchoolsService} from \"../../../../services/udive/divingSchools\";\nimport {ServiceCentersService} from \"../../../../services/udive/serviceCenters\";\nimport {popoverController} from \"@ionic/core\";\nimport {TranslationService} from \"../../../../services/common/translations\";\nimport {Chat} from \"../../../../interfaces/common/chat/chat\";\nimport {Environment} from \"../../../../global/env\";\nimport {getEmailValidator} from \"../../../../validators/email-validator\";\nimport {orderBy} from \"lodash\";\n\n@Component({\n  tag: \"popover-chat-participants\",\n  styleUrl: \"popover-chat-participants.scss\",\n})\nexport class PopoverChatParticipants {\n  @Element() el: HTMLElement;\n  @Prop() chat: Chat;\n  @State() editable: boolean = true;\n  usersList: any[] = [];\n  participantsList: any[] = [];\n  addedParticipantsList: any[] = [];\n  removedParticipantsList: any[] = [];\n  @State() showList: any[] = [];\n  searchFilter: string;\n  userNotFound = false;\n  modifiedParticipants = false;\n  @State() updateView = false;\n  ownersIds: string[];\n\n  async componentWillLoad() {\n    const chatParticipants = Object.keys(this.chat.participants);\n\n    this.usersList = [];\n    for (let id of chatParticipants) {\n      const participant = this.chat.participants[id];\n      if (participant.collectionId == \"userProfiles\") {\n        const publicProfile = await UserService.getPublicProfileUserDetails(\n          participant.id\n        );\n        if (publicProfile && publicProfile.uid) {\n          this.usersList.push(publicProfile);\n        }\n      }\n    }\n    if (Environment.isUdive()) {\n      this.usersList = this.usersList.concat(\n        DivingCentersService.divingCentersList\n      );\n      this.usersList = this.usersList.concat(\n        DivingSchoolsService.divingSchoolsList\n      );\n      this.usersList = this.usersList.concat(\n        ServiceCentersService.serviceCentersList\n      );\n    }\n    this.participantsList = orderBy(\n      this.usersList.filter(\n        (participant) =>\n          chatParticipants.includes(participant.id) ||\n          chatParticipants.includes(participant.uid)\n      ),\n      \"displayName\"\n    );\n    const userIds = Object.keys(this.chat.users);\n    this.ownersIds = userIds.filter((userId) =>\n      this.chat.users[userId].includes(\"owner\")\n    );\n\n    if (Environment.isUdive()) {\n      this.editable =\n        this.ownersIds.includes(UserService.userProfile.uid) ||\n        this.ownersIds.includes(\n          ServiceCentersService.selectedServiceCenterId\n        ) ||\n        this.ownersIds.includes(DivingCentersService.selectedDivingCenterId) ||\n        this.ownersIds.includes(DivingSchoolsService.selectedDivingSchoolId);\n    }\n  }\n\n  async searchUsers(ev) {\n    this.searchFilter = ev.target.value.toLowerCase();\n    this.showList = [];\n    if (getEmailValidator().validate(this.searchFilter)) {\n      const user = await UserService.searchUserByEmail(this.searchFilter);\n      if (user && user.uid) {\n        this.showList.push(user);\n        this.userNotFound = false;\n      } else {\n        this.showList = [];\n        this.userNotFound = true;\n      }\n      this.updateView = !this.updateView;\n    }\n  }\n\n  resetShowList() {\n    this.userNotFound = false;\n    this.showList = [];\n  }\n\n  addUser(user) {\n    if (this.participantsList.findIndex((part) => user.uid === part.id) == -1) {\n      this.participantsList.push(user);\n      this.addedParticipantsList.push(user);\n    }\n    this.searchFilter = \"\";\n    this.resetShowList();\n    this.modifiedParticipants = true;\n  }\n\n  removeUser(user) {\n    this.participantsList.splice(\n      this.participantsList.findIndex(\n        (val) => val.uid === user.uid || val.id === user.id\n      ),\n      1\n    );\n    this.addedParticipantsList.splice(\n      this.addedParticipantsList.findIndex(\n        (val) => val.uid === user.uid || val.id === user.id\n      ),\n      1\n    );\n    this.removedParticipantsList.push(user);\n    this.searchFilter = \"\";\n    this.resetShowList();\n    this.modifiedParticipants = true;\n  }\n\n  changeName(ev) {\n    this.chat.name = ev.target.value;\n  }\n\n  close() {\n    popoverController.dismiss();\n  }\n\n  save() {\n    popoverController.dismiss({\n      chatName: this.chat.name,\n      added: this.addedParticipantsList,\n      removed: this.removedParticipantsList,\n    });\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-content>\n          <ion-list>\n            {this.editable && Object.keys(this.chat.participants).length > 2 ? (\n              <ion-item color=\"chat\">\n                <ion-input\n                  mode=\"ios\"\n                  placeholder={TranslationService.getTransl(\n                    \"chat-name\",\n                    \"Insert Chat Name\"\n                  )}\n                  value={this.chat.name}\n                  onIonInput={(ev) => this.changeName(ev)}\n                ></ion-input>\n              </ion-item>\n            ) : undefined}\n            {this.editable\n              ? [\n                  <ion-header translucent>\n                    <ion-toolbar>\n                      <ion-title>\n                        <my-transl\n                          tag=\"edit-chat-participants\"\n                          text=\"Edit Chat Participants\"\n                        />\n                      </ion-title>\n                    </ion-toolbar>\n                  </ion-header>,\n                ]\n              : undefined}\n            {this.participantsList.map((user) => (\n              <ion-item>\n                {user.photoURL ? (\n                  <ion-avatar slot=\"start\">\n                    <ion-img src={user.photoURL} />\n                  </ion-avatar>\n                ) : undefined}\n                <ion-label>{user.displayName}</ion-label>\n                {this.editable &&\n                !this.ownersIds.includes(user.uid) &&\n                !this.ownersIds.includes(user.id) ? (\n                  <ion-button\n                    slot=\"end\"\n                    icon-only\n                    fill=\"clear\"\n                    color=\"danger\"\n                    onClick={() => this.removeUser(user)}\n                  >\n                    <ion-icon name=\"person-remove-outline\"></ion-icon>\n                  </ion-button>\n                ) : undefined}\n              </ion-item>\n            ))}\n          </ion-list>\n          {this.editable\n            ? [\n                <ion-header translucent>\n                  <ion-toolbar>\n                    <ion-title>\n                      <my-transl\n                        tag=\"add-chat-participants\"\n                        text=\"Add Chat Participants\"\n                      />\n                    </ion-title>\n                  </ion-toolbar>\n                </ion-header>,\n                <ion-header translucent>\n                  <ion-toolbar>\n                    <ion-searchbar\n                      value={this.searchFilter}\n                      placeholder=\"Email\"\n                      inputmode=\"email\"\n                      type=\"email\"\n                      enterkeyhint=\"search\"\n                      clearIcon=\"close-circle\"\n                      autocomplete=\"email\"\n                      onIonInput={() => this.resetShowList()}\n                      onIonClear={() => this.resetShowList()}\n                      onIonCancel={() => this.resetShowList()}\n                      onIonChange={(ev) => this.searchUsers(ev)}\n                    ></ion-searchbar>\n                  </ion-toolbar>\n                </ion-header>,\n              ]\n            : undefined}\n          <ion-list>\n            {this.showList.map((user) => (\n              <ion-item>\n                {user.photoURL ? (\n                  <ion-avatar slot=\"start\">\n                    <ion-img src={user.photoURL} />\n                  </ion-avatar>\n                ) : undefined}\n                <ion-label>{user.displayName}</ion-label>\n                <ion-button\n                  slot=\"end\"\n                  icon-only\n                  fill=\"clear\"\n                  color=\"success\"\n                  onClick={() => this.addUser(user)}\n                >\n                  <ion-icon name=\"person-add-outline\"></ion-icon>\n                </ion-button>\n              </ion-item>\n            ))}\n            {this.userNotFound ? (\n              <ion-item>\n                <ion-label>\n                  <my-transl tag=\"user-not-found\" text=\"User Not Found\" />\n                </ion-label>\n              </ion-item>\n            ) : undefined}\n          </ion-list>\n        </ion-content>\n        <app-modal-footer\n          onCancelEmit={() => this.close()}\n          disableSave={!this.modifiedParticipants}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"version":3}