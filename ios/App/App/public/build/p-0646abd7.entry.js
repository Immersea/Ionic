import{r as s,h as i,H as t}from"./p-cbe60c68.js";import{ad as e,e as n,U as o,c as l,d as a,b as h,x as r,T as p,w as c}from"./p-83f44900.js";import{l as d}from"./p-1af05547.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-c7ee7cfe.js";import"./p-694b8ade.js";import"./p-5d4a8e1f.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-7ee16e8d.js";const f="app-admin-diving-classes{}";const u=f;const m=class{constructor(i){s(this,i);this.userPublicProfilesList=[];this.divingCentersList=[];this.divingSchoolsList=[];this.filterByOrganisierId=undefined;this.filterByClasses=undefined;this.adminDivingClassesArray=[];this.updateView=false;this.creatingNewDivingClass=false;this.loadingDivingClasses=true;this.editingDivingClass=""}async componentWillLoad(){this.loadingDivingClasses$=e.creatingNewDivingClass$.subscribe((s=>{this.creatingNewDivingClass=s}));this.editingDivingClass$=e.editingDivingClassId$.subscribe((s=>{this.editingDivingClass=s}));if(this.filterByOrganisierId&&this.filterByOrganisierId===n.selectedDivingSchoolId){this.userDivingClasses$=n.selectedDivingSchoolClasses$.subscribe((s=>this.loadDivingClasses(s)))}else{this.userDivingClasses$=o.userDivingClasses$.subscribe((s=>this.loadDivingClasses(s)))}this.userPublicProfilesList$=o.userPublicProfilesList$.subscribe((s=>{this.userPublicProfilesList=s;this.filter()}));this.divingCentersList$=l.divingCentersList$.subscribe((s=>{this.divingCentersList=s;this.filter()}));this.divingSchoolsList$=n.divingSchoolsList$.subscribe((s=>{this.divingSchoolsList=s;this.filter()}));this.userRoles$=o.userRoles$.subscribe((s=>{this.userRoles=s;this.filter()}))}disconnectedCallback(){this.userRoles$.unsubscribe();this.userDivingClasses$.unsubscribe();this.userPublicProfilesList$.unsubscribe();this.divingCentersList$.unsubscribe();this.divingSchoolsList$.unsubscribe();this.editingDivingClass$.unsubscribe();this.loadingDivingClasses$.unsubscribe()}async loadDivingClasses(s){e.resetSkeletons();this.loadingDivingClasses=false;if(s){let i=[];Object.keys(s).forEach((t=>{let e=s[t];e.id=t;if(this.filterByOrganisierId&&e.organiser.id==this.filterByOrganisierId){i.push(e)}else if(!this.filterByOrganisierId){i.push(e)}}));i=d.exports.orderBy(i,"date","desc");this.adminDivingClassesArray=i;this.filter()}}filter(){if(this.adminDivingClassesArray.length>0){this.adminDivingClassesArray.map((s=>{const i=s.organiser;switch(i.collectionId){case r:i.item=this.userPublicProfilesList.find((s=>s.uid===i.id));break;case h:i.item=this.divingCentersList.find((s=>s.id===i.id));break;case a:i.item=this.divingSchoolsList.find((s=>s.id===i.id));break}if(this.userRoles){const i=this.userRoles.editorOf[s.id];s.editor=i&&i.roles&&i.roles.length>0;s.owner=i&&i.roles&&i.roles.includes("owner")}}));if(this.filterByClasses){const s=Object.keys(this.filterByClasses);this.adminDivingClassesArray=this.adminDivingClassesArray.filter((i=>s.includes(i.id)))}this.updateView=!this.updateView}}update(s,i){s.stopPropagation();e.presentDivingClassUpdate(null,null,i)}delete(s,i){s.stopPropagation();e.deleteDivingClass(i)}render(){return i(t,{key:"c1637fb323eb28940889bf010017521ce9a835c6"},this.loadingDivingClasses?[i("app-skeletons",{skeleton:"diveTrip"}),i("app-skeletons",{skeleton:"diveTrip"}),i("app-skeletons",{skeleton:"diveTrip"}),i("app-skeletons",{skeleton:"diveTrip"}),i("app-skeletons",{skeleton:"diveTrip"})]:undefined,this.creatingNewDivingClass?i("app-skeletons",{skeleton:"diveTrip"}):undefined,this.adminDivingClassesArray.map((s=>this.editingDivingClass==s.id?i("app-skeletons",{skeleton:"diveTrip"}):i("ion-item",{button:true,onClick:()=>e.pushDivingClass(s.id),detail:true},s.organiser&&s.organiser.item&&s.organiser.item.photoURL?i("ion-avatar",{slot:"start"},i("ion-img",{src:s.organiser.item.photoURL})):undefined,i("ion-label",null,i("h2",null,s.displayName),i("h4",null,c.format(s.date,"PP")),s.organiser&&s.organiser.item&&s.organiser.item.displayName?i("p",null,i("my-transl",{tag:"organiser",text:"Organiser"}),": "+s.organiser.item.displayName):undefined),s.owner?i("ion-button",{fill:"clear",color:"danger","icon-only":true,slot:"end",onClick:i=>this.delete(i,s.id)},i("ion-icon",{name:"trash",slot:"end"})):undefined,s.editor?i("ion-button",{fill:"clear",color:"divingclass","icon-only":true,slot:"end",onClick:i=>this.update(i,s.id)},i("ion-icon",{name:"create",slot:"end"})):undefined))),this.adminDivingClassesArray.length==0?i("ion-item",null,i("ion-label",null,i("h2",null,p.getTransl("no-dive-classes","No diving classes yet. Look for your next class with our diving schools and instructors!")))):undefined)}};m.style=u;export{m as app_admin_diving_classes};
//# sourceMappingURL=p-0646abd7.entry.js.map