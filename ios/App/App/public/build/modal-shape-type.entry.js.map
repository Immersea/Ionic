{"file":"modal-shape-type.entry.esm.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAM,iBAAiB,GAAG,uCAAuC;;MCiBpD,cAAc;;;qBAEA,CAAC;;;0BAGJ,IAAI;8BACA,KAAK;;IAE/B,MAAM,iBAAiB;QACrB,MAAM,IAAI,CAAC,cAAc,EAAE,CAAC;KAC7B;IAED,MAAM,cAAc;QAClB,MAAM,aAAa,CAAC,qBAAqB,EAAE,CAAC;QAC5C,IAAI,CAAC,UAAU,GAAGA,wBAAS,CAAC,MAAM,aAAa,CAAC,aAAa,EAAE,CAAC,CAAC;QACjE,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE;YACjD,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;SACrC;aAAM;;YAEL,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,IAAI,CAAC,YAAY,EAAE,CAAC;SACrB;QACD,IAAI,CAAC,aAAa,EAAE,CAAC;KACtB;IAED,UAAU,CAAC,EAAE;QACX,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,IAAI,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAC1E,IAAI,CAAC,aAAa,EAAE,CAAC;KACtB;IAED,YAAY,CAAC,EAAE;QACb,MAAM,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC;QACzB,IAAI,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC;QACxB,IAAI,CAAC,IAAI,QAAQ,EAAE;;YAEjB,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;SACjD;QACD,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,CAAC,aAAa,EAAE,CAAC;KACtB;IAED,aAAa;QACX,IAAI,CAAC,cAAc;YACjBC,uBAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAC/BA,uBAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC;gBACpCC,uBAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC;gBACjC,IAAI,CAAC,SAAS,CAAC,QAAQ,GAAG,CAAC;gBAC3BD,uBAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACnC,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC;KACpC;IAED,MAAM,WAAW;QACf,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;QAC9C,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,EAAE,CAAC;QACrD,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,WAAW,GAAG,EAAE,CAAC;QACpC,MAAM,OAAO,GAAG,MAAM,aAAa,CAAC,WAAW,CAAC,uBAAuB,EAAE;YACvE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG;SAC1B,CAAC,CAAC;QACH,OAAO,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE;YACnC,IAAI,EAAE,IAAI,EAAE,CAAC,IAAI,EAAE;gBACjB,MAAM,aAAa,GAAG;oBACpB,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,CAAC,IAAI;iBAC5B,CAAC;gBACF,MAAM,YAAY,GAAG,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC;gBACnC,MAAM,OAAO,GAAG,MAAM,aAAa,CAAC,WAAW,CAC7C,wBAAwB,EACxB;oBACE,KAAK,EAAE,aAAa;oBACpB,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM;oBAC7B,YAAY,EAAE,gBAAgB;iBAC/B,CACF,CAAC;gBACF,OAAO,CAAC,YAAY,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE;oBAC7B,IAAI,EAAE,IAAI,EAAE,CAAC,IAAI,EAAE;wBACjB,MAAM,IAAI,GAAG,EAAE,CAAC,IAAI,CAAC;;wBAErB,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG,YAAY,CAAC;wBAClC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,EAAE;4BAC3B,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC,CAAC;yBACnC,CAAC,CAAC;wBACH,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;wBACjB,IAAI,CAAC,aAAa,EAAE,CAAC;qBACtB;iBACF,CAAC,CAAC;aACJ;SACF,CAAC,CAAC;KACJ;IAED,YAAY;QACV,IAAI,CAAC,SAAS,GAAG,IAAI,SAAS,EAAE,CAAC;QACjC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACrC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC;KACzC;IAED,kBAAkB;QAChB,IAAI,CAAC,SAAS,GAAGD,wBAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QAC3C,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,OAAO,CAAC;QACxD,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;QACrC,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,CAAC;KACzC;IAED,MAAM,eAAe;QACnB,IAAI;YACF,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;YACtC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;YACf,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,aAAa,EAAE,CAAC;SACtB;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,KAAK;gBAAE,aAAa,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;SACnD;KACF;IAED,MAAM,IAAI,CAAC,OAAO,GAAG,IAAI;QACvB,MAAM,aAAa,CAAC,gBAAgB,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACtD,OAAO,OAAO,GAAG,eAAe,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC;KACnD;IAED,MAAM,MAAM;QACV,OAAO,eAAe,CAAC,OAAO,EAAE,CAAC;KAClC;IAED,MAAM;QACJ,QACE,EAAC,IAAI,uDACH,sEACE,mEACE,QAAQ,EAAE,GAAG,EACb,mBAAmB,EAAE,KAAK,EAC1B,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,GAC5C,EACd,mEACE,MAAM,EAAC,OAAO,EACd,IAAI,EAAC,SAAS,EACd,KAAK,EAAC,UAAU,EAChB,QAAQ,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAChC,OAAO,EAAE,MAAM,IAAI,CAAC,WAAW,EAAE,IAEjC,iEAAU,IAAI,EAAC,OAAO,EAAC,IAAI,EAAC,QAAQ,GAAY,EAChD,oEACG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM;cACnB,kBAAkB,CAAC,SAAS,CAC1B,oBAAoB,EACpB,2CAA2C,CAC5C;cACD,kBAAkB,CAAC,SAAS,CAAC,cAAc,EAAE,cAAc,CAAC,CACtD,CACD,EACb,mEACE,kEACE,kEACE,0EACE,KAAK,EAAE;gBACL,GAAG,EAAE,YAAY;gBACjB,IAAI,EAAE,YAAY;aACnB,EACD,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAC5B,KAAK,EAAC,OAAO,EACb,QAAQ,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,EACrC,aAAa,EAAE,IAAI,CAAC,UAAU,EAC9B,aAAa,EAAC,QAAQ,EACtB,eAAe,EAAE,CAAC,UAAU,EAAE,IAAI,CAAC,EACnC,QAAQ,EAAE,CAAC,IAAI,CAAC,cAAc,GACX,CACb,EACV,gEAAS,IAAI,EAAC,GAAG,EAAC,KAAK,EAAC,iBAAiB,IACvC,mEACE,IAAI,EAAC,OAAO,EACZ,QAAQ,EAAE,CAAC,IAAI,CAAC,cAAc,EAC9B,OAAO,EAAE,MAAM,IAAI,CAAC,YAAY,EAAE,IAElC,iEAAU,IAAI,EAAC,KAAK,EAAC,IAAI,EAAC,OAAO,GAAG,CACzB,CACL,EACV,gEAAS,IAAI,EAAC,GAAG,EAAC,KAAK,EAAC,iBAAiB,IACvC,mEACE,IAAI,EAAC,OAAO,EACZ,QAAQ,EAAE,CAAC,IAAI,CAAC,cAAc,EAC9B,OAAO,EAAE,MAAM,IAAI,CAAC,kBAAkB,EAAE,IAExC,iEAAU,IAAI,EAAC,OAAO,EAAC,IAAI,EAAC,WAAW,GAAY,CACxC,CACL,EACV,gEAAS,IAAI,EAAC,GAAG,EAAC,KAAK,EAAC,iBAAiB,IACvC,mEACE,IAAI,EAAC,OAAO,EACZ,KAAK,EAAC,QAAQ,EACd,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,MAAM,IAAI,CAAC,EACrC,OAAO,EAAE,MAAM,IAAI,CAAC,eAAe,EAAE,IAErC,iEAAU,IAAI,EAAC,OAAO,EAAC,IAAI,EAAC,OAAO,GAAY,CACpC,CACL,CACF,CACD,EAEX,oFACa,UAAU,EACrB,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAC9B,IAAI,EAAC,UAAU,gBACJ,QAAQ,EACnB,iBAAiB,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAChD,aAAa,EAAC,OAAO,EACrB,SAAS,EAAE;gBACT,UAAU;gBACV;oBACE,IAAI,EAAE,UAAU;oBAChB,OAAO,EAAE,EAAC,GAAG,EAAE,CAAC,EAAC;iBAClB;aACF,GACc,EACjB,oFACa,IAAI,EACf,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,MAAM,EAC5B,IAAI,EAAC,QAAQ,gBACF,QAAQ,EACnB,iBAAiB,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAChD,aAAa,EAAC,OAAO,EACrB,SAAS,EAAE;gBACT,UAAU;gBACV;oBACE,IAAI,EAAE,UAAU;oBAChB,OAAO,EAAE;wBACP,IAAI,EAAE,MAAM;wBACZ,KAAK,EAAE,QAAQ;wBACf,IAAI,EAAE,IAAI,CAAC,UAAU;qBACtB;iBACF;aACF,GACc,EACjB,oFACa,MAAM,EACjB,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAC9B,IAAI,EAAC,UAAU,gBACJ,MAAM,EACjB,aAAa,EAAE,IAAI,eACT,GAAG,EACb,iBAAiB,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAChD,aAAa,EAAC,OAAO,EACrB,SAAS,EAAE,CAAC,UAAU,CAAC,GACR,EACjB,oFACa,UAAU,EACrB,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,EAC9B,IAAI,EAAC,UAAU,EACf,SAAS,EAAC,GAAG,gBACF,QAAQ,EACnB,iBAAiB,EAAE,CAAC,EAAE,KAAK,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,EAChD,aAAa,EAAC,OAAO,EACrB,SAAS,EAAE,CAAC,UAAU,CAAC,GACR,CACL,EACd,yEACE,KAAK,EAAE,WAAW,CAAC,WAAW,EAAE,EAChC,WAAW,EAAE,CAAC,IAAI,CAAC,cAAc,EACjC,YAAY,EAAE,MAAM,IAAI,CAAC,MAAM,EAAE,EACjC,UAAU,EAAE,MAAM,IAAI,CAAC,IAAI,EAAE,GAC7B,CACG,EACP;KACH;;;;;;;","names":["cloneDeep","isString","isNumber"],"sources":["src/components/trasteel/modals/modal-shape-type/modal-shape-type.scss?tag=modal-shape-type","src/components/trasteel/modals/modal-shape-type/modal-shape-type.tsx"],"sourcesContent":["modal-shape-type {\n  ion-list {\n    width: 100%;\n  }\n}\n","import {Component, h, Host, State, Element} from \"@stencil/core\";\nimport {modalController} from \"@ionic/core\";\nimport {cloneDeep, isNumber, isString} from \"lodash\";\nimport {TranslationService} from \"../../../../services/common/translations\";\nimport {ShapeType} from \"../../../../interfaces/trasteel/refractories/shapes\";\nimport {\n  SHAPESCOLLECTION,\n  ShapesService,\n} from \"../../../../services/trasteel/refractories/shapes\";\nimport {RouterService} from \"../../../../services/common/router\";\nimport {Environment} from \"../../../../global/env\";\nimport {SystemService} from \"../../../../services/common/system\";\n\n@Component({\n  tag: \"modal-shape-type\",\n  styleUrl: \"modal-shape-type.scss\",\n})\nexport class ModalShapeType {\n  @Element() el: HTMLElement;\n  @State() index: number = 0;\n  @State() shapeTypes: ShapeType[];\n  @State() shapeType: ShapeType;\n  @State() updateView = true;\n  @State() validShapeType = false;\n\n  async componentWillLoad() {\n    await this.loadShapeTypes();\n  }\n\n  async loadShapeTypes() {\n    await ShapesService.downloadShapeSettings();\n    this.shapeTypes = cloneDeep(await ShapesService.getShapeTypes());\n    if (this.shapeTypes && this.shapeTypes.length > 0) {\n      this.shapeType = this.shapeTypes[0];\n    } else {\n      //create new and add to list\n      this.shapeTypes = [];\n      this.addShapeType();\n    }\n    this.validateShape();\n  }\n\n  selectType(ev) {\n    this.shapeType = this.shapeTypes.find((x) => x.typeId == ev.detail.value);\n    this.validateShape();\n  }\n\n  handleChange(ev) {\n    const n = ev.detail.name;\n    let v = ev.detail.value;\n    if (n == \"typeId\") {\n      //remove spaces and lowercase\n      v = v.replace(/\\s+/g, \"-\").trim().toLowerCase();\n    }\n    this.shapeType[n] = v;\n    this.validateShape();\n  }\n\n  validateShape() {\n    this.validShapeType =\n      isString(this.shapeType.typeId) &&\n      isString(this.shapeType.typeName.en) &&\n      isNumber(this.shapeType.decimals) &&\n      this.shapeType.position > 0 &&\n      isString(this.shapeType.dwg.url);\n    this.updateView = !this.updateView;\n  }\n\n  async editDrawing() {\n    this.shapeType.dwg.id = this.shapeType.typeId;\n    this.shapeType.dwg.name = this.shapeType.typeName.en;\n    this.shapeType.dwg.description = \"\";\n    const popover = await RouterService.openPopover(\"popover-media-loading\", {\n      media: this.shapeType.dwg,\n    });\n    popover.onDidDismiss().then(async (ev) => {\n      if (ev && ev.data) {\n        const mediaToUpload = {\n          [ev.data.media.id]: ev.data,\n        };\n        const mediaToStore = ev.data.media;\n        const popover = await RouterService.openPopover(\n          \"popover-media-uploader\",\n          {\n            files: mediaToUpload,\n            itemId: this.shapeType.typeId,\n            collectionId: SHAPESCOLLECTION,\n          }\n        );\n        popover.onDidDismiss().then((ev) => {\n          if (ev && ev.data) {\n            const urls = ev.data;\n            //update urls into media\n            this.shapeType.dwg = mediaToStore;\n            Object.keys(urls).forEach((id) => {\n              this.shapeType.dwg.url = urls[id];\n            });\n            this.save(false);\n            this.validateShape();\n          }\n        });\n      }\n    });\n  }\n\n  addShapeType() {\n    this.shapeType = new ShapeType();\n    this.shapeTypes.push(this.shapeType);\n    this.index = this.shapeTypes.length - 1;\n  }\n\n  duplicateShapeType() {\n    this.shapeType = cloneDeep(this.shapeType);\n    this.shapeType.typeId = this.shapeType.typeId + \"_rev.\";\n    this.shapeTypes.push(this.shapeType);\n    this.index = this.shapeTypes.length - 1;\n  }\n\n  async deleteShapeType() {\n    try {\n      this.shapeTypes.splice(this.index, 1);\n      this.index = 0;\n      this.shapeType = this.shapeTypes[0];\n      this.validateShape();\n    } catch (error) {\n      if (error) SystemService.presentAlertError(error);\n    }\n  }\n\n  async save(dismiss = true) {\n    await ShapesService.uploadShapeTypes(this.shapeTypes);\n    return dismiss ? modalController.dismiss() : true;\n  }\n\n  async cancel() {\n    return modalController.dismiss();\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-content>\n          <app-banner\n            heightPx={500}\n            backgroundCoverFill={false}\n            link={this.shapeType.dwg ? this.shapeType.dwg.url : null}\n          ></app-banner>\n          <ion-button\n            expand=\"block\"\n            fill=\"outline\"\n            color=\"trasteel\"\n            disabled={!this.shapeType.typeId}\n            onClick={() => this.editDrawing()}\n          >\n            <ion-icon slot=\"start\" name=\"create\"></ion-icon>\n            <ion-label>\n              {!this.shapeType.typeId\n                ? TranslationService.getTransl(\n                    \"media-loader-error\",\n                    \"Please insert the ID to upload new media.\"\n                  )\n                : TranslationService.getTransl(\"edit-drawing\", \"Edit Drawing\")}\n            </ion-label>\n          </ion-button>\n          <ion-grid>\n            <ion-row>\n              <ion-col>\n                <app-select-search\n                  label={{\n                    tag: \"shape_type\",\n                    text: \"Shape Type\",\n                  }}\n                  value={this.shapeType.typeId}\n                  lines=\"inset\"\n                  selectFn={(ev) => this.selectType(ev)}\n                  selectOptions={this.shapeTypes}\n                  selectValueId=\"typeId\"\n                  selectValueText={[\"typeName\", \"en\"]}\n                  disabled={!this.validShapeType}\n                ></app-select-search>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validShapeType}\n                  onClick={() => this.addShapeType()}\n                >\n                  <ion-icon name=\"add\" slot=\"start\" />\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  disabled={!this.validShapeType}\n                  onClick={() => this.duplicateShapeType()}\n                >\n                  <ion-icon slot=\"start\" name=\"duplicate\"></ion-icon>\n                </ion-button>\n              </ion-col>\n              <ion-col size=\"1\" class=\"ion-text-center\">\n                <ion-button\n                  fill=\"clear\"\n                  color=\"danger\"\n                  disabled={this.shapeTypes.length == 0}\n                  onClick={() => this.deleteShapeType()}\n                >\n                  <ion-icon slot=\"start\" name=\"trash\"></ion-icon>\n                </ion-button>\n              </ion-col>\n            </ion-row>\n          </ion-grid>\n\n          <app-form-item\n            label-text=\"Position\"\n            value={this.shapeType.position}\n            name=\"position\"\n            input-type=\"number\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\n              \"required\",\n              {\n                name: \"minvalue\",\n                options: {min: 1},\n              },\n            ]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"ID\"\n            value={this.shapeType.typeId}\n            name=\"typeId\"\n            input-type=\"string\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\n              \"required\",\n              {\n                name: \"uniqueid\",\n                options: {\n                  type: \"list\",\n                  index: \"typeId\",\n                  list: this.shapeTypes,\n                },\n              },\n            ]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"Name\"\n            value={this.shapeType.typeName}\n            name=\"typeName\"\n            input-type=\"text\"\n            multiLanguage={true}\n            text-rows=\"1\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\"required\"]}\n          ></app-form-item>\n          <app-form-item\n            label-text=\"Decimals\"\n            value={this.shapeType.decimals}\n            name=\"decimals\"\n            inputStep=\"1\"\n            input-type=\"number\"\n            onFormItemChanged={(ev) => this.handleChange(ev)}\n            labelPosition=\"fixed\"\n            validator={[\"required\"]}\n          ></app-form-item>\n        </ion-content>\n        <app-modal-footer\n          color={Environment.getAppColor()}\n          disableSave={!this.validShapeType}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"version":3}