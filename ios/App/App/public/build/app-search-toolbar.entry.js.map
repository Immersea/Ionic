{"file":"app-search-toolbar.entry.esm.js","mappings":"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","names":["toLower","includes","uniq","orderBy"],"sources":["src/components/common/app/common/app-search-toolbar/app-search-toolbar.scss?tag=app-search-toolbar","src/components/common/app/common/app-search-toolbar/app-search-toolbar.tsx"],"sourcesContent":["app-search-toolbar {\n}\n","import {\n  Component,\n  h,\n  Prop,\n  Event,\n  Element,\n  EventEmitter,\n  Host,\n  Method,\n} from \"@stencil/core\";\nimport {Environment} from \"../../../../../global/env\";\nimport {DatabaseService} from \"../../../../../services/common/database\";\nimport {includes, orderBy, toLower, uniq} from \"lodash\";\n\nconst TITLE = \"app-search-toolbar-\";\n\n@Component({\n  tag: \"app-search-toolbar\",\n  styleUrl: \"app-search-toolbar.scss\",\n})\nexport class AppSearchToolbar {\n  @Element() el: HTMLElement;\n  @Prop({mutable: true}) list: any[] = [];\n  @Prop() searchTitle: string;\n  @Prop() orderFields: string[] = [];\n  @Prop() color: string = Environment.getAppColor();\n  @Prop() placeholder: string = \"Search\";\n  @Prop() filterBy: string[];\n  searchString: string = null;\n\n  @Event() filteredList: EventEmitter<any>;\n\n  @Method()\n  //used to force reset a value in case of changes of the \"value\" on the main DOM\n  async forceFilter(list) {\n    this.list = list;\n    this.filterList();\n  }\n\n  async setFocus() {\n    const searchbar = this.el.querySelector(\"ion-searchbar\");\n    if (searchbar) {\n      searchbar.componentOnReady().then(() => {\n        setTimeout(() => {\n          searchbar.setFocus();\n        }, 500);\n      });\n    }\n  }\n\n  async componentWillLoad() {\n    if (this.searchTitle) {\n      const search = await DatabaseService.getLocalDocument(\n        TITLE + this.searchTitle\n      );\n      if (search) {\n        this.searchString = search;\n        this.filterList();\n      }\n    } else {\n      this.filterList();\n    }\n  }\n\n  componentDidLoad() {\n    this.setFocus();\n  }\n\n  filterList() {\n    let filterList = [];\n    if (this.searchString) {\n      const search = toLower(this.searchString);\n      let filters = [];\n      this.filterBy.forEach((key) => {\n        filters = [\n          ...filters,\n          ...this.list.filter((x) => includes(toLower(x[key]), search)),\n        ];\n      });\n      //remove duplicates\n      filterList = uniq(filters);\n    } else {\n      filterList = this.list;\n    }\n    this.filteredList.emit(orderBy(filterList, this.orderFields));\n  }\n\n  handleSearch(ev) {\n    this.searchString = \"\";\n    const target = ev.target as HTMLIonSearchbarElement;\n    if (target) {\n      this.searchString = target.value!.toLowerCase();\n      if (this.searchTitle) {\n        DatabaseService.saveLocalDocument(\n          TITLE + this.searchTitle,\n          this.searchString\n        );\n      }\n    }\n    this.filterList();\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-toolbar color={this.color}>\n          <ion-searchbar\n            animated={true}\n            show-cancel-button=\"focus\"\n            debounce={250}\n            value={this.searchString}\n            placeholder={this.placeholder}\n            onIonInput={(ev) => this.handleSearch(ev)}\n          ></ion-searchbar>\n        </ion-toolbar>\n      </Host>\n    );\n  }\n}\n"],"version":3}