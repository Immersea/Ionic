import{r as e,h as t,H as s,f as i}from"./p-cbe60c68.js";import{T as a,e as c,d,S as o,ad as n,ae as l,U as h}from"./p-83f44900.js";import"./p-c7ee7cfe.js";import{b as f,o as b}from"./p-5d4a8e1f.js";import{l as r}from"./p-1af05547.js";import{S as p}from"./p-a75993af.js";import"./p-1819cfda.js";import"./p-e9c4f463.js";import"./p-46038295.js";import"./p-694b8ade.js";import"./p-7ee16e8d.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";const u="modal-diving-class-update ion-list{width:100%}modal-diving-class-update app-diving-class-schedule{width:100%}modal-diving-class-update ion-segment-button{--color-checked:var(--ion-color-divingclass-contrast)}";const m=u;const v=class{constructor(t){e(this,t);this.divingClassId=undefined;this.collectionId=undefined;this.organiserId=undefined;this.divingClass=undefined;this.updateView=true;this.validClass=false;this.selectedCourse=undefined;this.addressText=undefined;this.titles=[{tag:"details"},{tag:"schedule"},{tag:"team"},{tag:"students"}];this.slider=undefined;this.selectGotFocus=false}async componentWillLoad(){await this.loadDivingClass();this.statusTitles={active:a.getTransl("active","Active"),closed:a.getTransl("closed","Closed"),cancelled:a.getTransl("cancelled","Cancelled")};this.placeholder=a.getTransl("insert-title","Insert title");if(this.organiserId==c.selectedDivingSchoolId){this.divingSchool=c.selectedDivingSchool}else if(this.collectionId==d){this.divingSchool=await c.getDivingSchool(this.organiserId)}this.divingAgencies=o.systemPreferences.divingAgencies;this.divingCourses=await o.getDivingCoursesForSchool(this.divingSchool);if(this.divingClass&&this.divingClass.course){this.selectedCourse=this.divingCourses.find((e=>e.agencyId===this.divingClass.course.agencyId&&e.id===this.divingClass.course.certificationId))}}async loadDivingClass(){if(this.divingClassId){this.divingClass=await n.getDivingClass(this.divingClassId);this.collectionId=this.divingClass.organiser.collectionId;this.organiserId=this.divingClass.organiser.id}else{this.divingClass=new l;this.divingClass.organiser={collectionId:this.collectionId,id:this.organiserId};this.divingClass.users={[h.userRoles.uid]:["owner","instructor"]}}this.addressText=this.divingClass.location&&this.divingClass.location.display_name?this.divingClass.location.display_name:null}async componentDidLoad(){this.slider=new p(".slider-dive-class",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true,on:{slideChange:()=>{this.slider?this.slider.updateAutoHeight():null}}});this.appBookings=this.el.getElementsByTagName("app-dive-class-bookings")[0];this.appSchedule=this.el.getElementsByTagName("app-diving-class-schedule")[0];this.createCourseSelectOptions();this.validateClass()}createCourseSelectOptions(){this.selectCourseElement=this.el.querySelector("#dive-course-select");const e={header:a.getTransl("diving-course","Diving Course")};const t=Array.from(this.selectCourseElement.getElementsByTagName("ion-select-option"));t.map((e=>{this.selectCourseElement.removeChild(e)}));this.selectCourseElement.interfaceOptions=e;r.exports.each(this.divingCourses,(e=>{const t=document.createElement("ion-select-option");t.value=e;t.textContent=this.divingAgencies[e.agencyId].name+" - "+e.name;this.selectCourseElement.appendChild(t)}))}async changeCourse(e){if(this.selectGotFocus&&this.divingClass&&this.divingClass.activities&&this.divingClass.activities.length>0){const t=await f.create({header:a.getTransl("diving-course","Diving Course"),message:a.getTransl("update-class-activities","This will update all class activities! Are you sure?"),buttons:[{text:a.getTransl("ok","OK"),handler:()=>{this.selectGotFocus=false;this.updateCourseDetails(e)}},{text:a.getTransl("cancel","Cancel"),handler:()=>{this.selectGotFocus=false;this.createCourseSelectOptions();this.selectedCourse=Object.assign({},this.selectedCourse)},role:"cancel",cssClass:"secondary"}]});t.present()}else{this.updateCourseDetails(e)}}updateCourseDetails(e){this.selectedCourse=e;this.divingClass.name=this.divingAgencies[this.selectedCourse.agencyId].name+" - "+this.selectedCourse.name;this.divingClass.activities=r.exports.cloneDeep(e.activities);this.divingClass.numberOfStudents=e.numberOfStudents;this.divingClass.course={certificationId:e.id,agencyId:e.agencyId};this.appBookings.updateStudentsList();this.appSchedule.updateClassSchedule();this.validateClass()}selectLocation(e){this.divingClass.location=e;this.addressText=e.display_name;this.validateClass()}updateStudents(e){this.divingClass.numberOfStudents=r.exports.toNumber(e);this.appBookings.updateStudentsList();this.validateClass()}updateStatus(e){this.divingClass.status=e;this.validateClass()}handleChange(e){this.divingClass[e.detail.name]=e.detail.value;this.validateClass()}validateClass(){this.validClass=r.exports.isString(this.divingClass.name)&&this.divingClass.numberOfStudents>0&&this.divingClass.location&&r.exports.isString(this.divingClass.location.display_name)&&r.exports.isString(this.divingClass.status)&&Object.keys(this.divingClass.schedule).length>0;this.updateView=!this.updateView}async save(){await n.updateDivingClass(this.divingClassId,this.divingClass);return b.dismiss(false)}async cancel(){return b.dismiss(true)}render(){return t(s,{key:"9016f7906d487c98436f129ff678ea79246112ec"},this.selectedCourse&&this.selectedCourse.photoURL?t("ion-header",null,t("app-item-cover",{item:this.selectedCourse})):undefined,this.selectedCourse?t("ion-header",null,t("ion-toolbar",{color:"divingclass"},t("ion-title",null,this.divingClass.name))):undefined,t("app-header-segment-toolbar",{key:"c6f9cb9d7b612e190af172eababc4e4f2e42b979",color:"divingclass",swiper:this.slider,titles:this.titles}),t("ion-content",{key:"3ce33e68311ad6b12d04359e5ce0c258138b4503",class:"slides"},t("swiper-container",{key:"b3a7926b9a9376cc26d026ef083c95d272bc5027",class:"slider-dive-class swiper"},t("swiper-wrapper",{key:"b316638b0b1ae23e875815cc012547af12477325",class:"swiper-wrapper"},t("swiper-slide",{key:"2dc1ed16a8879e35ae15fcbc2e8a1cdb7b21ef68",class:"swiper-slide"},t("ion-list",{key:"c2ff426e0c5223e3a9e6d66f2c0aadb429f190a8"},t("ion-item",{key:"cdc49cca72595ba50f60c6d8040e2bfd4321fd50"},t("ion-label",{key:"e2851127c612ca6b762c98911cac9577f8602a8c"},t("my-transl",{key:"6569f478f4957c4cd63d05f45f00ad529b15c07e",tag:"diving-course",text:"Diving Course"})),t("ion-select",{key:"2b27ef8032aa4cd6a95b81ab81c6d7344ce8a23b",id:"dive-course-select",interface:"action-sheet",onIonChange:e=>this.changeCourse(e.detail.value),onIonFocus:()=>this.selectGotFocus=true,placeholder:a.getTransl("select","Select"),value:this.selectedCourse})),t("app-form-item",{key:"d7850694431b9d0d9d4d3bb26842e10f1a8e68bf","label-tag":"name","label-text":"Name",value:this.divingClass.name,name:"name","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("ion-item",{key:"f16a3d9a3825d1a917ac78b1e101e7dd9f7bd3b6"},t("ion-label",{key:"c73d6c15cb80d2f8c12e2de6fa47f18a1f38016a"},t("my-transl",{key:"7a217dabbc61a613e3134e2cfb60db19569b7385",tag:"number-of-students",text:"Number of Students"})),t("ion-select",{key:"a3093efb6cd70fd064d1bd03dcbdee484d1b5a4f",value:this.divingClass.numberOfStudents,onIonChange:e=>this.updateStudents(e.detail.value),interface:"popover"},t("ion-select-option",{key:"c9d82a38404a21f6bcd131a7d6ab0d1cbc29ad8f",value:1},"1"),t("ion-select-option",{key:"32d92619248a384f08b16dd75497a0afe2b4c631",value:2},"2"),t("ion-select-option",{key:"690b6f8bb0a863031f3771f43d042624c38693db",value:3},"3"),t("ion-select-option",{key:"9516c529ebc911f989044127d70e0475fda9c29c",value:4},"4"),t("ion-select-option",{key:"c88f3829d8a8337cf3db250377243043800e486a",value:5},"5"),t("ion-select-option",{key:"0316fce6d7a3c90e21f761386d9920a32b44787b",value:6},"6"),t("ion-select-option",{key:"ae5f3394809c21f69b8b9f0e2a05f0a061164895",value:7},"7"),t("ion-select-option",{key:"25fd8a4fce7106e5d8844f971986941ff47a637b",value:8},"8"),t("ion-select-option",{key:"52b8edf4f8daf60d83b541da4f4cba742a270fa8",value:9},"9"),t("ion-select-option",{key:"3a2fdc9004264bc46515559c821b46ad871c2295",value:10},"10"),t("ion-select-option",{key:"965974708aeb5981e683b7289a3f89fbcc7be0ed",value:11},"11"),t("ion-select-option",{key:"0e18b5b92cf9f954092e6c9a14de1d2b0252bd98",value:12},"12"),t("ion-select-option",{key:"2a781aeb43754e35bde9922bfb8130691bc0e0ea",value:13},"13"),t("ion-select-option",{key:"fbd42923600f74a27fdec05225601042f5dd0799",value:14},"14"),t("ion-select-option",{key:"e6dfcf701b8658fa8a376a51593af6e2094202d5",value:15},"15"))),t("app-form-item",{key:"40377088bbe9a1dc2ef14334303212dba84b86aa","label-tag":"location","label-text":"Location",value:this.addressText,name:"location","input-type":"text",onFormItemChanged:e=>this.addressText=e.detail.value,onFormLocationSelected:e=>this.selectLocation(e.detail),validator:["address"]}),t("ion-item",{key:"65fffd729ae6bd30ae0643912f5363d1a57a7864"},t("ion-label",{key:"1ebdb2520ddb6eba7d2d37831534a7822d9a2807"},t("my-transl",{key:"154e821ef438ff5ae5e9bdd687355e922dd02742",tag:"status",text:"Status"})),t("ion-select",{key:"c7ef1699cb9a40b03788ec254214873d897ae81d",value:this.divingClass.status,onIonChange:e=>this.updateStatus(e.detail.value),interface:"popover"},t("ion-select-option",{key:"b4aa2f72868b76a371003f6f591e5b521d584b42",value:"active"},this.statusTitles.active),t("ion-select-option",{key:"a75f0849d8de19f3abd8f9967bcbcc5ed7024e10",value:"closed"},this.statusTitles.closed),t("ion-select-option",{key:"4cf5f7ae10d92858e2fa7f79c3dcd1d58a2a17d1",value:"cancelled"},this.statusTitles.cancelled))),t("app-form-item",{key:"0f4a8fd4243b36154e2525c48cf640ba8ba27a5e","label-tag":"comments","label-text":"Comments",value:this.divingClass.comments,name:"comments","input-type":"text",textRows:4,onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"162312fbb8d93222410abfa3884e28ded8da9561",class:"swiper-slide"},t("app-diving-class-schedule",{key:"12b9f207491bf1d855c5e3db63c4a28049fdb770",divingClass:this.divingClass,editable:true,onScheduleEmit:()=>this.validateClass()})),t("swiper-slide",{key:"d6266271a62a39faf2ffa1295c10718f5a4c325a",class:"swiper-slide"},t("app-users-list",{key:"82942b580a7d2a966d9e76fbb0c96f1c5f6578ce",item:this.divingClass,editable:true,show:["owner","divemaster","instructor"]})),t("swiper-slide",{key:"c4b09c37be700c229c349139cb2dbb8075cecbe0",class:"swiper-slide"},t("app-dive-class-bookings",{key:"f42c3e71f16dbf848479f4e81bef0ef1ea52a4dc",divingClass:this.divingClass,divingClassId:this.divingClassId,editable:true}))))),t("app-modal-footer",{key:"bc30d82a25cbc5b2bf471ddaa32c1a11a3c8045b",disableSave:!this.validClass,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};v.style=m;export{v as modal_diving_class_update};
//# sourceMappingURL=p-339cf488.entry.js.map