{"file":"app-dive-class-bookings.entry.esm.js","mappings":"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","names":["toNumber"],"sources":["src/components/udive/app/diving-classes/app-dive-class-bookings/app-dive-class-bookings.scss?tag=app-dive-class-bookings","src/components/udive/app/diving-classes/app-dive-class-bookings/app-dive-class-bookings.tsx"],"sourcesContent":["app-dive-class-bookings {\n  /* Component styles go here */\n  width: 100%;\n  height: 100%;\n}\n","import {Component, h, Prop, State, Element, Method} from \"@stencil/core\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {\n  DivingClass,\n  Student,\n} from \"../../../../../interfaces/udive/diving-class/divingClass\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {DivingClassesService} from \"../../../../../services/udive/divingClasses\";\nimport {Subscription} from \"rxjs\";\nimport {alertController} from \"@ionic/core\";\nimport {toNumber} from \"lodash\";\nimport {Environment} from \"../../../../../global/env\";\n\n@Component({\n  tag: \"app-dive-class-bookings\",\n  styleUrl: \"app-dive-class-bookings.scss\",\n})\nexport class AppDiveClassBookings {\n  @Element() el: HTMLElement;\n  @Prop({mutable: true}) divingClass: DivingClass;\n  @Prop() divingClassId: string;\n  @Prop() editable = false;\n  @State() isEditing = false;\n  @State() segment: number = 0;\n  @State() studentsList: any[];\n  availableSpots = [];\n  @State() waitingRequest = false;\n  @State() updateView = false;\n  segmentTitles: {\n    cancelled: string;\n    applied: string;\n    registered: string;\n    denied: string;\n  };\n  @State() userBooking: Student;\n  userSub: Subscription;\n  userId: string;\n  usersList: any[];\n  loogBookButton: boolean;\n\n  @Method()\n  async updateStudentsList() {\n    this.studentsList = [];\n    this.availableSpots = [];\n    this.usersList = [];\n    let students = this.divingClass.students;\n    for (let student of students) {\n      let listItem = {\n        ...student,\n        user: await UserService.getMapDataUserDetails(student.uid),\n      };\n      //show all students only to organiser\n      if (this.editable) {\n        this.studentsList.push(listItem);\n      } else if (\n        listItem.status == \"applied\" ||\n        listItem.status == \"registered\"\n      ) {\n        this.studentsList.push(listItem);\n      }\n\n      if (this.userId && student.uid === this.userId) {\n        this.userBooking = student;\n      }\n    }\n    if (this.divingClass.status == \"active\") {\n      let registeredStudents = 0;\n      this.divingClass.students.map((student) => {\n        if (student.status == \"registered\") {\n          registeredStudents++;\n        }\n      });\n      for (\n        let index = 0;\n        index < this.divingClass.numberOfStudents - registeredStudents;\n        index++\n      ) {\n        this.availableSpots.push(0);\n      }\n    }\n\n    this.updateView = !this.updateView;\n    return true;\n  }\n\n  componentWillLoad() {\n    this.userId =\n      UserService.userProfile && UserService.userProfile.uid\n        ? UserService.userProfile.uid\n        : null;\n    if (this.userId) {\n      this.updateStudentsList();\n    } else {\n      this.userSub = UserService.userProfile$.subscribe((user) => {\n        this.userId = user && user.uid ? user.uid : null;\n        this.updateStudentsList();\n      });\n    }\n\n    this.segmentTitles = {\n      cancelled: TranslationService.getTransl(\"cancelled\", \"Cancelled\"),\n      applied: TranslationService.getTransl(\"applied\", \"Applied\"),\n      registered: TranslationService.getTransl(\"registered\", \"Registered\"),\n      denied: TranslationService.getTransl(\"denied\", \"Denied\"),\n    };\n  }\n\n  disconnectedCallback() {\n    this.userSub.unsubscribe();\n  }\n\n  segmentChanged(ev) {\n    if (ev.detail.value) {\n      this.segment = toNumber(ev.detail.value);\n    }\n  }\n\n  async applyToClass() {\n    const alert = await alertController.create({\n      header: TranslationService.getTransl(\n        \"apply-to-class\",\n        \"Apply to this class\"\n      ),\n      message: TranslationService.getTransl(\n        \"apply-to-class-message\",\n        \"Please check first with the instructor eventual preconditions to apply to this class. Are you sure?\"\n      ),\n      buttons: [\n        {\n          text: TranslationService.getTransl(\"ok\", \"OK\"),\n          handler: async () => {\n            this.userBooking = {\n              uid: this.userId,\n              status: \"applied\",\n              evaluations: [],\n            };\n            this.saveBooking(this.userBooking);\n          },\n        },\n        {\n          text: TranslationService.getTransl(\"cancel\", \"Cancel\"),\n          role: \"cancel\",\n        },\n      ],\n    });\n    alert.present();\n  }\n\n  async saveBooking(booking) {\n    try {\n      this.waitingRequest = true;\n      const bookings = await DivingClassesService.sendBookingRequest(\n        this.divingClassId,\n        booking.uid,\n        booking.status,\n        booking.evaluations\n      );\n      this.waitingRequest = false;\n      this.divingClass.students = bookings;\n      this.updateStudentsList();\n    } catch (error) {\n      this.waitingRequest = false;\n    }\n  }\n\n  updateBooking(i, ev) {\n    const search = this.studentsList[i];\n    const item = this.divingClass.students.find(\n      (student) => student.uid === search.uid\n    );\n    item.status = ev.detail.value;\n  }\n\n  editStudents() {\n    this.isEditing = true;\n  }\n\n  saveStudents() {\n    this.isEditing = false;\n    this.updateStudentsList();\n  }\n\n  render() {\n    return (\n      <ion-list>\n        <ion-item lines=\"none\">\n          <ion-label>\n            {TranslationService.getTransl(\n              \"max-participants\",\n              \"Max xxx participants\",\n              {xxx: this.divingClass.numberOfStudents}\n            )}\n          </ion-label>\n          {this.editable &&\n          this.divingClass.students &&\n          this.divingClass.students.length > 0 ? (\n            !this.isEditing ? (\n              <ion-button slot=\"end\" onClick={() => this.editStudents()}>\n                <my-transl tag=\"edit\" text=\"Edit\" />\n              </ion-button>\n            ) : (\n              [\n                <ion-button slot=\"end\" onClick={() => this.saveStudents()}>\n                  <my-transl tag=\"save\" text=\"Save\" />\n                </ion-button>,\n              ]\n            )\n          ) : undefined}\n        </ion-item>\n        {!this.editable &&\n        !this.waitingRequest &&\n        this.divingClass.status == \"active\" &&\n        (!this.userBooking ||\n          (this.userBooking && this.userBooking.status == null)) ? (\n          <ion-button expand=\"block\" onClick={() => this.applyToClass()}>\n            <my-transl tag=\"apply-to-class\" text=\"Apply to this class\" />\n          </ion-button>\n        ) : undefined}\n        {this.userBooking &&\n        (this.userBooking.status == \"cancelled\" ||\n          this.userBooking.status == \"denied\") ? (\n          <ion-button expand=\"block\" color=\"warning\">\n            <my-transl\n              tag={this.userBooking.status}\n              text={this.userBooking.status}\n            />\n          </ion-button>\n        ) : undefined}\n        {this.waitingRequest ? (\n          <app-skeletons skeleton=\"diveTripBooking\" />\n        ) : undefined}\n        {this.studentsList.map((student, k) =>\n          student.uid == this.userId && this.waitingRequest ? (\n            <app-skeletons skeleton=\"diveTripBooking\" />\n          ) : (\n            <ion-item>\n              {!this.isEditing && student.user.photoURL ? (\n                <ion-avatar slot=\"start\">\n                  <ion-img src={student.user.photoURL} />\n                </ion-avatar>\n              ) : undefined}\n              <ion-label>{student.user.displayName}</ion-label>\n              {!this.isEditing ? (\n                <ion-note slot=\"end\">\n                  {TranslationService.getTransl(student.status, student.status)}\n                </ion-note>\n              ) : (\n                <ion-segment\n                  style={{\n                    maxWidth: \"40%\",\n                    marginLeft: \"15%\",\n                  }}\n                  slot=\"end\"\n                  mode=\"ios\"\n                  color={Environment.getAppColor()}\n                  onIonChange={(ev) => this.updateBooking(k, ev)}\n                  value={student.status}\n                >\n                  <ion-segment-button value=\"cancelled\">\n                    <my-transl tag=\"cancelled\" text=\"Cancelled\" />\n                  </ion-segment-button>\n                  <ion-segment-button value=\"applied\">\n                    <my-transl tag=\"applied\" text=\"Applied\" />\n                  </ion-segment-button>\n                  <ion-segment-button value=\"registered\">\n                    <my-transl tag=\"registered\" text=\"Registered\" />\n                  </ion-segment-button>\n                  <ion-segment-button value=\"denied\">\n                    <my-transl tag=\"denied\" text=\"Denied\" />\n                  </ion-segment-button>\n                </ion-segment>\n              )}\n            </ion-item>\n          )\n        )}\n        {this.availableSpots.map(() => (\n          <ion-item>\n            <ion-icon slot=\"start\" name=\"person-add-outline\"></ion-icon>\n            <ion-label>\n              <my-transl tag=\"available\" text=\"Available\" />\n            </ion-label>\n          </ion-item>\n        ))}\n      </ion-list>\n    );\n  }\n}\n"],"version":3}