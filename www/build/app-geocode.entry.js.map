{"file":"app-geocode.entry.esm.js","mappings":"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","names":[],"sources":["src/components/common/app/map/app-geocode/app-geocode.scss?tag=app-geocode","src/components/common/app/map/app-geocode/app-geocode.tsx"],"sourcesContent":["app-geocode {\n    /* Component styles go here */\n}\n","import {\n  Component,\n  h,\n  Prop,\n  Watch,\n  State,\n  Event,\n  EventEmitter,\n  Host,\n} from \"@stencil/core\";\nimport {LOCATIONIQ_GEOCODE} from \"../../../../../global/env\";\nimport {LocationIQ} from \"../../../../../services/common/map\";\n\n@Component({\n  tag: \"app-geocode\",\n  styleUrl: \"app-geocode.scss\",\n})\nexport class AppGeocode {\n  @Event() locationsFound: EventEmitter;\n  @Event() locationSelected: EventEmitter;\n  geocoder: any;\n  @Prop({mutable: true}) address: string = \"\";\n  @Prop({mutable: true}) gotFocus: boolean = false;\n  timer: number;\n  resultFound = false;\n  showNoResults = false;\n\n  @State() results: Array<LocationIQ> = [];\n\n  @Watch(\"address\")\n  startTimer() {\n    this.resultFound = false;\n    //wait for user to finish typing\n    this.timer = 1500;\n    this.countdown();\n  }\n\n  countdown() {\n    const timer = setTimeout(() => {\n      this.timer -= 1;\n      if (this.timer == 0) {\n        this.fetchGeocode();\n      } else {\n        clearTimeout(timer);\n        this.countdown();\n      }\n    }, 1);\n  }\n\n  async fetchGeocode() {\n    if (this.address && this.address.length > 10) {\n      const req =\n        \"https://eu1.locationiq.com/v1/search.php?limit=10&addressdetails=1&key=\" +\n        LOCATIONIQ_GEOCODE +\n        \"&q=\" +\n        this.address.replace(\" \", \"+\") +\n        \"&format=json&accept-language=en\";\n      fetch(req).then(\n        async (response) => {\n          if (response.ok) {\n            this.results = await response.json();\n            this.showNoResults = false;\n            this.locationsFound.emit(this.results);\n          } else {\n            this.results = [];\n            this.showNoResults = true;\n            this.locationsFound.emit(false);\n          }\n        },\n        () => {\n          this.results = [];\n          this.showNoResults = true;\n          this.locationsFound.emit(false);\n        }\n      );\n    }\n  }\n\n  selectLocation(loc: LocationIQ) {\n    this.results = [];\n    this.address = loc.display_name;\n    this.locationSelected.emit(loc);\n    this.resultFound = true;\n  }\n\n  render() {\n    return (\n      <Host>\n        {!this.resultFound && this.gotFocus ? (\n          <ion-list>\n            {this.address &&\n            this.address.length > 0 &&\n            this.results.length == 0 &&\n            !this.showNoResults ? (\n              <ion-item color=\"light\">\n                <ion-icon\n                  name=\"navigate-circle-outline\"\n                  slot=\"start\"\n                ></ion-icon>\n                <ion-label>\n                  <ion-skeleton-text\n                    animated\n                    style={{width: \"60%\"}}\n                  ></ion-skeleton-text>\n                </ion-label>\n              </ion-item>\n            ) : undefined}\n            {this.showNoResults ? (\n              <ion-item color=\"danger\">\n                <ion-icon name=\"alert\" slot=\"start\"></ion-icon>\n                <ion-label>\n                  <my-transl\n                    tag=\"no-locations\"\n                    text=\"No locations found!\"\n                  ></my-transl>\n                </ion-label>\n              </ion-item>\n            ) : (\n              this.results.map((loc) => (\n                <ion-item\n                  button\n                  color=\"dark\"\n                  onClick={() => this.selectLocation(loc)}\n                >\n                  <ion-icon\n                    name=\"navigate-circle-outline\"\n                    slot=\"start\"\n                  ></ion-icon>\n                  <ion-label>{loc.display_name}</ion-label>\n                </ion-item>\n              ))\n            )}\n          </ion-list>\n        ) : undefined}\n      </Host>\n    );\n  }\n}\n"],"version":3}