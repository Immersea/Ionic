import{r as e,h as t,H as a,f as i}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{o as s}from"./p-5d4a8e1f.js";import{l as o}from"./p-1af05547.js";import{S as l}from"./p-a75993af.js";import{U as d,n as c,a6 as n,ad as r,ae as p,T as f,S as h,E as m}from"./p-a7a717b1.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";const b="modal-datasheet-update #properties-grid .showbool{--ion-grid-column-padding:1px}modal-datasheet-update #properties-grid ion-grid{--ion-grid-column-padding:2px;border-collapse:collapse;border-style:hidden}modal-datasheet-update #properties-grid ion-grid ion-row:first-child{background-color:var(--ion-color-trasteel);font-weight:bold;color:var(--ion-color-trasteel-contrast)}modal-datasheet-update #properties-grid ion-grid ion-col{border:1px solid black;border-bottom:0;border-right:0}modal-datasheet-update #properties-grid ion-grid ion-col:last-child{border-right:1px solid black}modal-datasheet-update #properties-grid ion-grid ion-row:last-child{border-bottom:1px solid black}modal-datasheet-update #properties-grid ion-grid .remove-background{padding:0}modal-datasheet-update #properties-grid ion-grid .remove-background ion-col,modal-datasheet-update #properties-grid ion-grid .remove-background ion-row{border:0px solid black;background-color:white;padding:0}";const u=b;const y=class{constructor(t){e(this,t);this.validDatasheet=false;this.titles=[{tag:"information",text:"Information",disabled:false},{tag:"properties",text:"Properties",disabled:false},{tag:"reference",text:"Reference",disabled:false},{tag:"comments",text:"Comments",disabled:false},{tag:"files",text:"Files",disabled:true}];this.datasheetId=undefined;this.duplicateDatasheet=undefined;this.revision=undefined;this.datasheet=undefined;this.updateView=true;this.scrollTop=0;this.propertyNames={};this.slider=undefined}async componentWillLoad(){this.userProfileSub$=d.userProfile$.subscribe((e=>{this.userProfile=new c(e)}));await this.loadDatasheet()}async loadDatasheet(){if(this.datasheetId){const e=await n.getDatasheet(this.datasheetId);this.datasheet=e}else{const e=new r(this.duplicateDatasheet?this.duplicateDatasheet.datasheet:null);if(this.duplicateDatasheet&&this.revision){e.revisionNo=e.revisionNo+1}else{e.techNo=n.getMaxDatasheetTechNo();e.revisionNo=0}e.users={[d.userRoles.uid]:["owner"]};this.datasheet=e}this.validateDatasheet()}async componentDidLoad(){this.slider=new l(".slider-edit-datasheet",{speed:400,spaceBetween:100,allowTouchMove:false,autoHeight:true});if(this.datasheet.productName){setTimeout((()=>{Object.keys(this.datasheet.properties).forEach((e=>{this.selectPropertyNameForIndex(e)}));this.validateDatasheet()}))}}disconnectedCallback(){this.userProfileSub$.unsubscribe()}handleChange(e){this.datasheet[e.detail.name]=e.detail.value;this.validateDatasheet()}handlePropertyChange(e,t){const a=t.detail.name;let i=t.detail.value;this.datasheet.properties[e][a]=i;this.validateDatasheet()}deleteProperty(e){this.datasheet.properties.splice(e,1);this.validateDatasheet()}validateDatasheet(){this.validDatasheet=o.exports.isString(this.datasheet.productName)&&o.exports.isString(this.datasheet.familyId)&&o.exports.isString(this.datasheet.majorFamilyId)&&o.exports.isString(this.datasheet.techNo)&&this.datasheet.classification&&o.exports.isString(this.datasheet.categoriesId)&&this.checkParameters();this.updateSlider()}checkParameters(){let e=true;this.datasheet.properties.forEach((t=>{e=e&&n.getDatasheetPropertyNames("id",t.name)&&(t.typical>0||t.higher>0||t.lower>=0)}));return e}selectMajorFamily(e){this.datasheet.majorFamilyId=e.detail.value;this.validateDatasheet()}selectFamily(e){this.datasheet.familyId=e.detail.value;this.validateDatasheet()}selectCategory(e){this.datasheet.categoriesId=e.detail.value;this.validateDatasheet()}addProperty(){this.datasheet.properties.push(new p);setTimeout((()=>{this.setPropertyTypeSelect(this.datasheet.properties.length-1)}),100)}async setPropertyTypeSelect(e){const t=this.el.querySelector("#selectPropertyType"+e);if(t){const e={header:f.getTransl("type","Type")};t.interfaceOptions=e;const a=Array.from(t.getElementsByTagName("ion-select-option"));a.map((e=>{t.removeChild(e)}));t.placeholder=f.getTransl("select","Select");n.getDatasheetPropertyTypes().map((e=>{const a=document.createElement("ion-select-option");a.value=e.typeId;a.textContent=f.getTransl(e.typeId,e.typeName);t.appendChild(a)}))}this.validateDatasheet()}selectPropertyType(e,t){this.datasheet.properties[e].type=t.detail.value;this.selectPropertyNameForIndex(e);this.validateDatasheet()}selectPropertyNameForIndex(e){let t=n.getDatasheetPropertyNames();if(t.length==0)t=n.getDatasheetPropertyNames();this.propertyNames[e]=t;this.validateDatasheet()}selectPropertyName(e,t){this.datasheet.properties[e].name=t.detail.value;const a=n.getDatasheetPropertyNames("id",t.detail.value)[0];this.datasheet.properties[e].position=a.position;this.validateDatasheet()}updateSlider(){this.updateView=!this.updateView;setTimeout((()=>{this.slider?this.slider.update():undefined}),100)}async deleteDatasheet(){try{await n.deleteDatasheet(this.datasheetId);s.dismiss()}catch(e){if(e)h.presentAlertError(e)}}async save(e=true){const t=[];this.datasheet.properties.map((e=>{if(e.type&&e.name){t.push(e)}}));this.datasheet.properties=t;const a=await n.updateDatasheet(this.datasheetId,this.datasheet,this.userProfile.uid);if(!this.datasheetId){this.datasheetId=a.id;if(this.duplicateDatasheet&&this.revision){this.duplicateDatasheet.datasheet.oldProduct=true;await n.updateDatasheet(this.duplicateDatasheet.id,this.duplicateDatasheet.datasheet,this.userProfile.uid)}}e?s.dismiss():this.updateSlider()}async cancel(){return s.dismiss()}render(){return t(a,{key:"f282ffa12471d6a857009b8e9f8da66d7504bd2c"},t("app-header-segment-toolbar",{key:"fdb2f5c953fd45a3c6b10dab7a9e2d584f96fb6a",color:m.getAppColor(),swiper:this.slider,titles:this.titles}),t("ion-content",{key:"55e795c99bcad8fe772a1d9690fb56c473a5941e",class:"slides",onIonScroll:e=>this.scrollTop=e.detail.scrollTop},t("swiper-container",{key:"0e14097861f3e5f440a4375e6aede44312845bb3",class:"slider-edit-datasheet swiper"},t("swiper-wrapper",{key:"bbbd40cd7e0eae8737d601bac2704d3692242f19",class:"swiper-wrapper"},t("swiper-slide",{key:"55fa2c880369e0af9912e029a475a70a2c49423f",class:"swiper-slide"},t("ion-list",{key:"adfa4d9a7b58cbd421b03caa4fb2ef55cc45497f",class:"ion-no-padding"},t("app-select-search",{key:"8a37ba76bb10e0eaa9d232c382f37e84ce189ec9",color:"trasteel",label:{tag:"principal",text:"Principal"},labelAddText:"*",value:this.datasheet&&this.datasheet.majorFamilyId?this.datasheet.majorFamilyId:null,lines:"inset",selectFn:e=>this.selectMajorFamily(e),selectOptions:n.getDatasheetMajorFamilies(),selectValueId:"majorFamilyId",selectValueText:["majorFamilyName"]}),t("app-select-search",{key:"da9a35c1fbc737fc350c1233a7068569d884ae48",color:"trasteel",label:{tag:"product",text:"Product"},labelAddText:"*",value:this.datasheet&&this.datasheet.familyId?this.datasheet.familyId:null,lines:"inset",selectFn:e=>this.selectFamily(e),selectOptions:n.getDatasheetFamilies(),selectValueId:"familyId",selectValueText:["familyName"]}),t("app-select-search",{key:"000c3c325772cca8448db291701fd19bf79fafbe",color:"trasteel",label:{tag:"category",text:"Category"},labelAddText:"*",value:this.datasheet&&this.datasheet.categoriesId?this.datasheet.categoriesId:null,lines:"inset",selectFn:e=>this.selectCategory(e),selectOptions:n.getDatasheetCategories(),selectValueId:"categoriesId",selectValueText:["categoriesName"]}),t("app-form-item",{key:"c4d2a59fed363e44039558012307f614f47ac0e7",lines:"inset","label-tag":"tech-no","label-text":"Tech. #",value:this.datasheet.techNo,name:"techNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"8d454b9b741448b2a1644b54e46df6c97ae0b3e0",lines:"inset","label-tag":"revision-no","label-text":"Revision #",value:this.datasheet.revisionNo,name:"revisionNo","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"9484d471c991f44af2fea7cff7e74684ed3ddea6",lines:"inset","label-tag":"old","label-text":"Old",value:this.datasheet.oldProduct,name:"oldProduct","input-type":"boolean",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"10af48d38f7cbfec9798058428519e1627283df2",lines:"inset","label-tag":"issued-on-date","label-text":"Issued on Date",value:this.datasheet.issuedOnDate,name:"issuedOnDate","input-type":"date","date-presentation":"date","prefer-wheel":false,onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"513ced35af53274b4f93dc8acd2bfe11b9eec362",lines:"inset","label-tag":"product-name","label-text":"Product Name",value:this.datasheet.productName,name:"productName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:["required"]}),t("app-form-item",{key:"e8e97ec4e9052f4b166f28f7366852199cda4d5c",lines:"inset","label-tag":"classification","label-text":"Classification",value:this.datasheet.classification,name:"classification","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]}),t("app-form-item",{key:"ad9bfc5d323ddb657cde6aee7afffaba3ce07f3c",lines:"inset","label-tag":"application","label-text":"Application",value:this.datasheet.application,name:"application","input-type":"text",multiLanguage:true,"text-rows":"4",onFormItemChanged:e=>this.handleChange(e),onUpdateSlider:()=>this.updateSlider(),validator:["required"]})),this.datasheetId?t("ion-footer",{class:"ion-no-border"},t("ion-toolbar",null,t("ion-button",{expand:"block",fill:"outline",color:"danger",onClick:()=>this.deleteDatasheet()},t("ion-icon",{slot:"start",name:"trash"}),t("my-transl",{tag:"delete",text:"Delete",isLabel:true})))):undefined),t("swiper-slide",{key:"d35193b8d545a2634b02d816ccfaa096fb487f54",class:"swiper-slide"},t("div",{key:"0e59ce27827c3348e30dc514216b9549208a25f0",id:"properties-grid"},t("ion-grid",{key:"4d1fd37c1fcca21c4612684cacb622a2a0669cab"},t("ion-row",{key:"194859454cdb82fe1eb288bfab019382ee6f5635"},t("ion-col",{key:"a1bc92c0d8d481b0f1a55f2effe538b539589c28",class:"centered"},t("small",{key:"a76b1b8c6943c9ba15ac35ba6fda99c2f43d6bfc"},f.getTransl("type","Type"))),t("ion-col",{key:"e0f2adbefa4997a2721c40988b011fa0975eb0c7",class:"centered"},t("small",{key:"49b1368721134731e3bd8c0e6238a9d80dc874ac"},f.getTransl("name","Name"))),t("ion-col",{key:"5aa3fa40b6f14cd10c3122a54d140489fbcf9beb",class:"centered"},t("small",{key:"d2dca8d8eb0627a9167c7c0efd7d67a8fa32488c"},f.getTransl("typical","Typical"))),t("ion-col",{key:"43ec0ef079af9f83fa77bf4dc62ce7198705b83b",class:"centered"},t("small",{key:"015e5e1538daccf7b2cf4b9d89f83b122ce0bc7d"},f.getTransl("prefix","Prefix"))),t("ion-col",{key:"9cda3b35098828428f1a4fcf087b69689ca4166c",class:"centered"},t("small",{key:"2575d26135610d4544d11fd746636f2ce7c34b3f"},f.getTransl("from","From"))),t("ion-col",{key:"01dbad5c16ad24bf771ea7af748fbc2785e9846c",class:"centered"},t("small",{key:"30755143f98588b61df9329f5c9c2dc9e53d9d37"},f.getTransl("to","To"))),t("ion-col",{key:"21fd7019a2afe8a6a52ae1f0efbd4eeed6c0ff14",size:"1",class:"centered"},t("small",{key:"3365a33d3ec6b2f93f69a77c3bb498ba7a415db1"},f.getTransl("show","Show")+"/"+f.getTransl("delete","Delete")))),this.datasheet.properties.map(((e,a)=>t("ion-row",null,t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.type?e.type:null,lines:"none",selectFn:e=>this.selectPropertyType(a,e),selectOptions:n.getDatasheetPropertyTypes(),selectValueId:"typeId",selectValueText:["typeName"]})),t("ion-col",null,t("app-select-search",{color:"trasteel",value:e.name?e.name:null,lines:"none",disabled:!this.propertyNames[a],selectFn:e=>this.selectPropertyName(a,e),selectOptions:this.propertyNames[a],selectValueId:"nameId",selectValueText:["nameName"]})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.typical,name:"typical","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.prefix,name:"prefix","input-type":"text",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.lower,name:"lower","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("app-form-item",{value:e.higher,name:"higher","input-type":"number",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{size:"1",class:"centered "},t("ion-grid",{class:"remove-background"},t("ion-row",null,t("ion-col",{class:"centered"},t("app-form-item",{class:"ion-no-padding",value:e.show,name:"show","input-type":"boolean",onFormItemChanged:e=>this.handlePropertyChange(a,e)})),t("ion-col",{class:"centered"},t("ion-button",{class:"ion-no-padding","icon-only":true,color:"danger",fill:"clear",onClick:()=>this.deleteProperty(a)},t("ion-icon",{name:"trash"}))))))))))),t("io-item",{key:"8e5565197f61bcdd586796c8a72092b3da5ff048"},t("ion-button",{key:"53566ecd843807f7f170696e7b85ffd630940b20",expand:"full",shape:"round",color:"trasteel",size:"small",onClick:()=>this.addProperty()},"+"))),t("swiper-slide",{key:"27da98cd0b1a48e84ffd25d05647b0a8213054ca",class:"swiper-slide"},t("ion-list",{key:"009396d86a7fb558e8eb870da9bea28cc2d4e9d6"},t("app-form-item",{key:"e9fa9ce87adaa9c5848e36acd3599dd3d31a737d",lines:"inset","label-tag":"producer","label-text":"Producer",value:this.datasheet.producerName,name:"producerName","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"4110a3b9ab638a7e3440d5577cfa39406e2ee0a1",lines:"inset","label-tag":"producer-ref-quality","label-text":"Producer Reference Quality",value:this.datasheet.producerReferenceQuality,name:"producerReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"85fd595c637c9e601175912a9853a2ac7dfb5dcd",lines:"inset","label-tag":"competitor-ref-quality","label-text":"Competitor Reference Quality",value:this.datasheet.competitorReferenceQuality,name:"competitorReferenceQuality","input-type":"text",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"5db89565243268f24972bd108410b9fa1633de51",class:"swiper-slide"},t("ion-list",{key:"a84d1541a4033ddd16fffc5f5b6cfc6e502e627c"},t("app-form-item",{key:"2393f68195b45e69a3e5f17c2cc174b60dbd958f",lines:"inset","label-tag":"comments","label-text":"Comments",value:this.datasheet.comments,name:"comments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}),t("app-form-item",{key:"6583583af31af947d21154deb6aa0f52feecc1e6",lines:"inset","label-tag":"performance-comments","label-text":"Performance Comments",value:this.datasheet.performanceComments,name:"performanceComments","input-type":"text","text-rows":"4",onFormItemChanged:e=>this.handleChange(e),validator:[]}))),t("swiper-slide",{key:"10bdf7441d4ba3556084855b818d0e5a63b7ccee",class:"swiper-slide"},"FILES - TO BE DONE")))),t("app-modal-footer",{key:"f9405b116191498b48f29b3cfc0c5ce4d650c4fa",color:m.getAppColor(),disableSave:!this.validDatasheet,onCancelEmit:()=>this.cancel(),onSaveEmit:()=>this.save()}))}get el(){return i(this)}};y.style=u;export{y as modal_datasheet_update};
//# sourceMappingURL=p-16a99895.entry.js.map