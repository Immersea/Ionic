{"file":"page-dive-trip-details.entry.esm.js","mappings":"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","names":["isArray","toNumber"],"sources":["src/components/udive/pages/dive-trip/page-dive-trip-details/page-dive-trip-details.scss?tag=page-dive-trip-details","src/components/udive/pages/dive-trip/page-dive-trip-details/page-dive-trip-details.tsx"],"sourcesContent":["page-dive-trip-details {\n  ion-segment-button {\n    --color-checked: var(--ion-color-divetrip-contrast);\n  }\n  #chat-slide {\n    width: 100%;\n    height: 100%;\n  }\n}\n","import {Component, h, Prop, State, Element} from \"@stencil/core\";\nimport {DiveTripsService} from \"../../../../../services/udive/diveTrips\";\nimport {DiveTrip} from \"../../../../../interfaces/udive/dive-trip/diveTrip\";\nimport {Marker} from \"../../../../../interfaces/interfaces\";\nimport {RouterService} from \"../../../../../services/common/router\";\nimport {Subscription} from \"rxjs\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {calculateColumns, mapHeight} from \"../../../../../helpers/utils\";\nimport Swiper from \"swiper\";\nimport {isArray, toNumber} from \"lodash\";\n\n@Component({\n  tag: \"page-dive-trip-details\",\n  styleUrl: \"page-dive-trip-details.scss\",\n})\nexport class PageDiveTripDetails {\n  @Element() el: HTMLElement;\n  @Prop() tripid: string;\n  @State() diveTrip: DiveTrip;\n  @State() titles = [\n    {tag: \"dives\"},\n    {tag: \"bookings\"},\n    {tag: \"chat\", disabled: true},\n  ];\n  @State() slider: Swiper;\n  markers: Marker[] = [];\n  mapElement: HTMLAppMapElement;\n  userSub: Subscription;\n  @State() userId: string;\n  @State() columns = {\n    sm: 12,\n    md: 6,\n    lg: 4,\n  };\n  @State() showChat: boolean = false;\n  @State() updateView: boolean = false;\n\n  async componentWillLoad() {\n    this.diveTrip = await DiveTripsService.getDiveTrip(this.tripid);\n    this.userSub = UserService.userProfile$.subscribe((user) => {\n      this.userId = user && user.uid ? user.uid : null;\n      this.showChatSlide();\n    });\n    this.userId =\n      UserService.userProfile && UserService.userProfile.uid\n        ? UserService.userProfile.uid\n        : null;\n\n    this.columns = calculateColumns(this.diveTrip.tripDives.length);\n  }\n\n  showChatSlide() {\n    this.showChat = false;\n    if (this.diveTrip && this.diveTrip.chatId) {\n      this.showChat = this.diveTrip.organiser.id === this.userId; //user is organiser\n      this.showChat =\n        this.showChat || isArray(this.diveTrip.users[this.userId]); //user is in the team\n      this.diveTrip.tripDives.map((tripDive) => {\n        tripDive.bookings.map((booking) => {\n          this.showChat =\n            this.showChat ||\n            (booking.uid === this.userId && booking.confirmedOrganiser); //user is confirmed in the bookings\n        });\n      });\n      this.titles[2].disabled = !this.showChat;\n    }\n  }\n\n  setChatHeigth() {\n    const slideContainer = this.el.querySelector(\"#chat-slide\");\n    slideContainer.setAttribute(\"style\", \"height: \" + mapHeight(null) + \"px\");\n  }\n\n  async componentDidLoad() {\n    this.slider = new Swiper(\".slider-dive-trip\", {\n      speed: 400,\n      spaceBetween: 100,\n      allowTouchMove: true,\n      autoHeight: true,\n    });\n  }\n\n  disconnectedCallback() {\n    this.userSub.unsubscribe();\n  }\n\n  render() {\n    return [\n      <ion-header>\n        <ion-toolbar color=\"divetrip\">\n          <ion-buttons slot=\"start\">\n            <ion-button onClick={() => RouterService.goBack()} icon-only>\n              <ion-icon name=\"arrow-back\"></ion-icon>\n            </ion-button>\n          </ion-buttons>\n          <ion-title>{this.diveTrip.displayName}</ion-title>\n        </ion-toolbar>\n      </ion-header>,\n      <app-header-segment-toolbar\n        color=\"divetrip\"\n        swiper={this.slider}\n        titles={this.titles}\n      ></app-header-segment-toolbar>,\n      <ion-content class=\"slides\">\n        <swiper-container class=\"slider-dive-trip swiper\">\n          <swiper-wrapper class=\"swiper-wrapper\">\n            <swiper-slide class=\"swiper-slide\">\n              <ion-grid>\n                <ion-row class=\"ion-text-start\">\n                  {this.diveTrip.tripDives.map((trip) => (\n                    <ion-col\n                      size-sm={this.columns.sm}\n                      size-md={this.columns.md}\n                      size-lg={this.columns.lg}\n                    >\n                      <app-dive-trip-card tripDive={trip} />\n                    </ion-col>\n                  ))}\n                </ion-row>\n              </ion-grid>\n            </swiper-slide>\n            <swiper-slide class=\"swiper-slide\">\n              <ion-grid>\n                <ion-row class=\"ion-text-start\">\n                  {!this.userId ? (\n                    <div\n                      style={{\n                        marginTop: \"10%\",\n                        marginLeft: \"auto\",\n                        marginRight: \"auto\",\n                      }}\n                    >\n                      <ion-card>\n                        <ion-card-header>\n                          <ion-card-title>\n                            <my-transl\n                              tag=\"please-login\"\n                              text=\"Please login to view this page\"\n                            />\n                          </ion-card-title>\n                        </ion-card-header>\n                      </ion-card>\n                    </div>\n                  ) : (\n                    Object.keys(this.diveTrip.tripDives).map((i) => (\n                      <ion-col\n                        size-sm={this.columns.sm}\n                        size-md={this.columns.md}\n                        size-lg={this.columns.lg}\n                      >\n                        <app-dive-trip-bookings\n                          diveTrip={this.diveTrip}\n                          diveTripId={this.tripid}\n                          tripDiveIndex={toNumber(i)}\n                        />\n                      </ion-col>\n                    ))\n                  )}\n                </ion-row>\n              </ion-grid>\n            </swiper-slide>\n            {this.showChat ? (\n              <swiper-slide class=\"swiper-slide\">\n                <app-chat id=\"chat-slide\" chatId={this.diveTrip.chatId} />\n              </swiper-slide>\n            ) : undefined}\n          </swiper-wrapper>\n        </swiper-container>\n      </ion-content>,\n    ];\n  }\n}\n"],"version":3}