{"file":"app-dive-trip-card.entry.esm.js","mappings":"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","names":["toNumber","format"],"sources":["src/components/udive/app/dive-trips/app-dive-trip-card/app-dive-trip-card.scss?tag=app-dive-trip-card","src/components/udive/app/dive-trips/app-dive-trip-card/app-dive-trip-card.tsx"],"sourcesContent":["app-dive-trip-card {\n  /* Component styles go here */\n  width: 100%;\n  height: 100%;\n}\n","import {\n  Component,\n  h,\n  Prop,\n  Event,\n  EventEmitter,\n  Watch,\n  State,\n  Element,\n} from \"@stencil/core\";\nimport {DivePlanModel} from \"../../../../../interfaces/udive/planner/dive-plan\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {TripDive} from \"../../../../../interfaces/udive/dive-trip/diveTrip\";\nimport {MapDataDiveSite} from \"../../../../../interfaces/udive/dive-site/diveSite\";\nimport {DiveSitesService} from \"../../../../../services/udive/diveSites\";\nimport {MapDataDivingCenter} from \"../../../../../interfaces/udive/diving-center/divingCenter\";\nimport {DivingCentersService} from \"../../../../../services/udive/divingCenters\";\nimport {Subscription} from \"rxjs\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {DivePlansService} from \"../../../../../services/udive/divePlans\";\nimport {format} from \"date-fns\";\nimport {toNumber} from \"lodash\";\nimport {Environment} from \"../../../../../global/env\";\n\n@Component({\n  tag: \"app-dive-trip-card\",\n  styleUrl: \"app-dive-trip-card.scss\",\n})\nexport class AppDiveTripCard {\n  @Element() el: HTMLElement;\n  @Prop({mutable: true}) tripDive: TripDive;\n  diveSites: MapDataDiveSite[] = [];\n  @Prop() editable = false;\n  @Event() updateDiveEmit: EventEmitter<DivePlanModel>;\n  @Event() addDiveEmit: EventEmitter<any>;\n  @Event() removeDiveTripEmit: EventEmitter<any>;\n  @Event() removeTripDiveEmit: EventEmitter<number>;\n  @Prop({mutable: true}) updateView = false;\n  @State() segment: number = 0;\n  divingCenters: MapDataDivingCenter[] = [];\n  userSub: Subscription;\n  userId: string;\n  @State() loogBookButton: boolean;\n\n  @Watch(\"updateView\")\n  update() {\n    this.findDiveSites();\n  }\n\n  componentWillLoad() {\n    this.findDiveSites();\n    this.userSub = UserService.userProfile$.subscribe((user) => {\n      this.userId = user && user.uid ? user.uid : null;\n      this.activateLogbook();\n    });\n    this.userId =\n      UserService.userProfile && UserService.userProfile.uid\n        ? UserService.userProfile.uid\n        : null;\n    this.activateLogbook();\n  }\n\n  activateLogbook() {\n    this.loogBookButton = false;\n    this.tripDive.bookings.map((booking) => {\n      if (booking.uid == this.userId) {\n        this.loogBookButton = true;\n      }\n    });\n  }\n\n  findDiveSites() {\n    this.diveSites = [];\n    this.divingCenters = [];\n    this.tripDive.divePlan.dives.forEach((dive) => {\n      this.diveSites.push(\n        DiveSitesService.diveSitesList.find(\n          (site) => site.id === dive.diveSiteId\n        )\n      );\n      this.divingCenters.push(\n        DivingCentersService.divingCentersList.find(\n          (dc) => dc.id === dive.divingCenterId\n        )\n      );\n    });\n  }\n\n  updateDivePlan(ev, index) {\n    ev.stopPropagation();\n    this.updateDiveEmit.emit(index);\n  }\n\n  removeDiveTrip() {\n    this.removeDiveTripEmit.emit();\n  }\n\n  addDivePlan() {\n    this.addDiveEmit.emit();\n  }\n\n  removeDivePlan(ev, i) {\n    ev.stopPropagation();\n    this.segment = this.segment - 1;\n    this.removeTripDiveEmit.emit(i);\n  }\n\n  segmentChanged(ev) {\n    if (ev.detail.value) {\n      this.segment = toNumber(ev.detail.value);\n    }\n  }\n\n  createDivePlan(plan) {\n    if (plan.configuration) {\n      DivePlansService.createNewDivePlan(plan);\n    } else {\n      //dummy plan\n      DivePlansService.createNewDivePlanWithConfiguration(plan);\n    }\n  }\n\n  render() {\n    return (\n      <ion-card>\n        <ion-card-header>\n          <ion-card-title>\n            <ion-item class=\"ion-no-padding\" lines=\"none\">\n              <ion-label>\n                {format(this.tripDive.divePlan.dives[0].date, \"PP\")}\n              </ion-label>\n              {this.editable\n                ? [\n                    <ion-button\n                      icon-only\n                      slot=\"end\"\n                      color=\"danger\"\n                      fill=\"clear\"\n                      onClick={() => this.removeDiveTrip()}\n                    >\n                      <ion-icon name=\"trash-bin-outline\"></ion-icon>\n                    </ion-button>,\n                    <ion-button\n                      icon-only\n                      slot=\"end\"\n                      color=\"divetrip\"\n                      fill=\"clear\"\n                      onClick={() => this.addDivePlan()}\n                    >\n                      <ion-icon name=\"add-circle\"></ion-icon>\n                    </ion-button>,\n                  ]\n                : undefined}\n            </ion-item>\n          </ion-card-title>\n          <ion-card-subtitle>\n            {this.tripDive.divePlan.title +\n              \" -> \" +\n              TranslationService.getTransl(\n                \"max-participants\",\n                \"Max xxx participants\",\n                {xxx: this.tripDive.numberOfParticipants}\n              )}\n          </ion-card-subtitle>\n        </ion-card-header>\n        <ion-card-content>\n          {this.tripDive.divePlan.dives.length > 1 ? (\n            <ion-toolbar>\n              <ion-segment\n                mode=\"md\"\n                color={Environment.getAppColor()}\n                onIonChange={(ev) => this.segmentChanged(ev)}\n                value={this.segment.toString()}\n              >\n                {Object.keys(this.tripDive.divePlan.dives).map((i) => (\n                  <ion-segment-button value={i}>\n                    <ion-label>\n                      <my-transl tag=\"dive\" text=\"Dive\" />\n                      {\" \" +\n                        (toNumber(i) + 1) +\n                        \": \" +\n                        format(this.tripDive.divePlan.dives[i].date, \"p\")}\n                    </ion-label>\n                  </ion-segment-button>\n                ))}\n              </ion-segment>\n            </ion-toolbar>\n          ) : undefined}\n          <ion-card>\n            {this.diveSites[this.segment] ? (\n              <app-item-cover item={this.diveSites[this.segment]} />\n            ) : undefined}\n            <ion-card-header>\n              <ion-card-subtitle>\n                {this.diveSites[this.segment] ? (\n                  <h2>{this.diveSites[this.segment].displayName}</h2>\n                ) : undefined}\n                {this.divingCenters[this.segment] ? (\n                  <h3>{this.divingCenters[this.segment].displayName}</h3>\n                ) : undefined}\n              </ion-card-subtitle>\n              <ion-card-title>\n                <ion-item class=\"ion-no-padding\" lines=\"none\">\n                  <ion-label>\n                    {format(\n                      this.tripDive.divePlan.dives[this.segment].date,\n                      \"p\"\n                    )}\n                  </ion-label>\n                  {this.editable\n                    ? [\n                        this.segment > 0 ? (\n                          <ion-button\n                            icon-only\n                            slot=\"end\"\n                            color=\"danger\"\n                            fill=\"clear\"\n                            onClick={(ev) =>\n                              this.removeDivePlan(ev, this.segment)\n                            }\n                          >\n                            <ion-icon name=\"trash-bin-outline\"></ion-icon>\n                          </ion-button>\n                        ) : undefined,\n                        <ion-button\n                          icon-only\n                          slot=\"end\"\n                          color=\"primary\"\n                          fill=\"clear\"\n                          onClick={(ev) =>\n                            this.updateDivePlan(ev, this.segment)\n                          }\n                        >\n                          <ion-icon name=\"create\"></ion-icon>\n                        </ion-button>,\n                      ]\n                    : undefined}\n                </ion-item>\n              </ion-card-title>\n            </ion-card-header>\n            {this.tripDive.divePlan.configuration ? (\n              <ion-card-content>\n                {this.tripDive.divePlan.dives[this.segment]\n                  .getProfilePointsDetails()\n                  .map((detail) => (\n                    <p class=\"ion-text-start\">{detail}</p>\n                  ))}\n              </ion-card-content>\n            ) : undefined}\n          </ion-card>\n        </ion-card-content>\n        {!this.editable && this.loogBookButton ? (\n          <ion-button\n            expand=\"full\"\n            color=\"secondary\"\n            onClick={() => this.createDivePlan(this.tripDive.divePlan)}\n          >\n            {this.tripDive.divePlan.dives.length == 1 ? (\n              <my-transl tag=\"log-dive\" text=\"Log Dive\" />\n            ) : (\n              <my-transl tag=\"log-dives\" text=\"Log Dives\" />\n            )}\n          </ion-button>\n        ) : undefined}\n      </ion-card>\n    );\n  }\n}\n"],"version":3}