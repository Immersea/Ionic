import{r as e,h as t}from"./p-cbe60c68.js";import"./p-c7ee7cfe.js";import{b as a}from"./p-5d4a8e1f.js";import{l as s}from"./p-1af05547.js";import{a5 as i,U as n,q as o,m as l,a4 as c,a1 as d,T as r,aF as p,a7 as h,R as f}from"./p-364f0bff.js";import{E as m}from"./p-be6a132e.js";import{S as u}from"./p-a75993af.js";import"./p-3647f076.js";import"./p-9c77ce6f.js";import"./p-694b8ade.js";import"./p-ae1763fb.js";import"./p-c5936999.js";import"./p-6879854f.js";import"./p-e9c4f463.js";import"./p-66796388.js";import"./p-7ee16e8d.js";const b="page-dive-planner{}page-dive-planner .card-margins{margin:10px 5px 5px 10px}";const g=b;const x=class{constructor(t){e(this,t);this.plans=[];this.stdDiveProfile={depth:i.isMetric()?30:100,time:30,fO2:.32,fHe:0,setpoint:1.4};this.isLoaded=false;this.stdConfigurations=[];this.localPlans=[];this.scrollTop=0}componentWillLoad(){this.userSettingsSub$=n.userSettings$.subscribe((e=>{this.userSettings=new o(e);this.loadLocalData()}))}componentDidLoad(){if(!this.userSettings){n.initLocalUser()}this.swiper=new u(".swiper",{speed:400,spaceBetween:100,allowTouchMove:true})}async loadLocalData(){if(this.userSettings&&this.userSettings.settings){this.stdConfigurations=s.exports.cloneDeep(this.userSettings.userConfigurations);this.localPlans=this.userSettings.localPlans;this.orderPlans()}else{const e=await l.getLocalDocument("localplans");this.stdConfigurations=c.getStdConfigurations();if(e){this.localPlans=[];e.forEach((e=>{const t=new d(e);this.localPlans.push(t)}))}else{this.localPlans=c.getDivePlansFromConfigurations(this.stdConfigurations);l.saveLocalDocument("localplans",this.localPlans)}this.orderPlans()}}disconnectedCallback(){this.userSettingsSub$.unsubscribe()}async addDivePlan(){const e=15;if(this.localPlans.length>=e){const t=await a.create({header:r.getTransl("max-plans","Maximum Plans"),message:r.getTransl("max-plans-descr","You can store a maximum of xxx plans. Use the 'Logbook' for additional plans.",{xxx:e}),buttons:[{text:r.getTransl("ok","OK")}]});t.present()}else{let e=[];if(n.userProfile&&n.userProfile){e.push({type:"radio",label:"New Configuration",value:-1,checked:false})}s.exports.forEach(this.stdConfigurations,((t,a)=>{e.push({type:"radio",label:t.stdName,value:a,checked:a==0?true:false})}));const t=await a.create({header:r.getTransl("select-standard-configuration","Select standard configuration"),buttons:[{text:r.getTransl("ok","OK"),handler:async e=>{if(e>-1){this.addDivePlanWithConf(this.stdConfigurations[e])}else{let e=await n.checkLicence("configs",true);if(e){const e=n.userSettings.userConfigurations[0];const t=new p(e);t.stdName="";t.configuration.bottom=[];t.maxDepth=0;t.maxTime=0;const a=new h;a.setConfiguration(t);const s=await f.openModal("modal-dive-configuration",{diveDataToShare:{divePlan:a,showConfigurations:true}});s.onDidDismiss().then((e=>{e=e.data;if(e){const t=new p(e);const a=[t].concat(this.userSettings.userConfigurations);this.userSettings.userConfigurations=a;n.updateUserConfigurations(this.userSettings.userConfigurations);this.addDivePlanWithConf(t)}}))}}}},{text:r.getTransl("cancel","Cancel"),role:"cancel",cssClass:"secondary"}],inputs:e});t.present()}}async addDivePlanWithConf(e){const t=await f.openModal("modal-dive-planner",{selectedConfiguration:e,stdConfigurations:this.stdConfigurations,index:0,user:this.userSettings});t.onDidDismiss().then((e=>{const t=e.data;if(t){this.localPlans.push(t);this.updatePlans()}}))}async viewDive(e){const t=await f.openModal("modal-dive-planner",{addDive:false,divePlanModel:this.localPlans[e],stdConfigurations:this.stdConfigurations,index:0,user:this.userSettings});t.onDidDismiss().then((t=>{const a=t.data;if(a){this.localPlans[e]=a;this.updatePlans()}}))}updatePlans(){if(this.userSettings&&this.userSettings.localPlans){n.updateUserLocalPlans(this.localPlans)}else{l.saveLocalDocument("localplans",this.localPlans);this.loadLocalData()}}orderPlans(){this.localPlans=s.exports.orderBy(this.localPlans,"configuration.stdName")}async removeDive(e,t){e.stopPropagation();const s=await a.create({header:r.getTransl("delete-dive-header","Delete dive?"),message:r.getTransl("delete-dive-message","This dive plan will be deleted! Are you sure?"),buttons:[{text:r.getTransl("cancel","Cancel"),role:"cancel",handler:()=>{}},{text:r.getTransl("ok","OK"),handler:()=>{this.localPlans.splice(t,1);this.updatePlans()}}]});s.present()}render(){return[t("app-navbar",{key:"a15e5f61ffb0bb1f7e1b7b50ca44607340324f7b",tag:"deco-planner",text:"Deco Planner",color:m.isDecoplanner()?"gue-blue":"planner"}),t("ion-content",{key:"08f8cadbcce3e3f38c4fdde60c760f502de79f85"},t("ion-fab",{key:"4c33983221a111c2cc182f5cf77307ef27765f32",vertical:"top",horizontal:"end",slot:"fixed",edge:true},t("ion-fab-button",{key:"3f55abac8f0c2f6ec71f3b86853c0f8554382149",onClick:()=>this.addDivePlan(),color:m.isDecoplanner()?"gue-blue":"planner"},t("ion-icon",{key:"97da6c1984e08939a2a148cedffaa99cbfb397eb",name:"add"}))),this.localPlans.length>0?t("ion-grid",{class:"ion-no-padding"},t("ion-row",{class:"ion-no-padding"},this.localPlans.map(((e,a)=>t("ion-col",{"size-sm":"12","size-md":"6","size-lg":"4",class:"ion-no-padding"},t("ion-card",{onClick:()=>this.viewDive(a),class:"card-margins"},t("ion-card-header",null,t("ion-card-subtitle",null,t("ion-item",{lines:"none",class:"ion-no-padding"},t("ion-button",{"icon-only":true,slot:"end",color:"danger",fill:"clear",onClick:e=>this.removeDive(e,a)},t("ion-icon",{name:"trash-bin-outline"})),t("ion-label",null,t("h1",null,e.configuration.stdName))),e.dives[0].getProfilePointsDetails().map((e=>t("p",{class:"ion-text-start"},e))))),t("ion-card-content",null,e.configuration.configuration.bottom.length>0?t("p",null,t("my-transl",{tag:"bottom-tanks",text:"Bottom Tanks"}),":"):undefined,e.configuration.configuration.bottom.map((e=>t("p",null,e.name+"->"+e.gas.toString()))),e.configuration.configuration.deco.length>0?t("p",null,t("my-transl",{tag:"deco-tanks",text:"Deco Tanks"}),":"):undefined,e.configuration.configuration.deco.map((e=>t("p",null,e.name+"->"+e.gas.toString())))))))))):undefined)]}};x.style=g;export{x as page_dive_planner};
//# sourceMappingURL=p-ff50a70c.entry.js.map