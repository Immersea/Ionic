{"file":"app-upload-covers.entry.esm.js","mappings":"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","names":[],"sources":["src/components/common/app/common/app-upload-covers/app-upload-covers.scss?tag=app-upload-covers","src/components/common/app/common/app-upload-covers/app-upload-covers.tsx"],"sourcesContent":["app-upload-covers {\n  width: 100%;\n  ion-thumbnail {\n    position: relative;\n    margin-top: -100px;\n    margin-left: auto;\n    margin-right: auto;\n    margin-bottom: 0;\n    width: 100px;\n    height: 100px;\n    img {\n      border-radius: 50%;\n      padding: 0.08em;\n      border: solid 0.25em lightsteelblue;\n      background-color: white;\n    }\n    ion-button {\n      top: 50%;\n      left: 50%;\n      margin-right: -50%;\n      transform: translate(-50%, -50%);\n      position: absolute !important;\n      color: #141414; // add a theme for better looks\n      font-size: 24px;\n    }\n  }\n  .cover {\n    position: relative;\n    height: var(--coverHeightModal);\n    background-color: lightblue;\n    background-size: cover;\n    background-position: center;\n    background-repeat: no-repeat;\n    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);\n    width: 100%;\n    ion-button {\n      bottom: 5%;\n      left: 10%;\n      margin-right: -50%;\n      transform: translate(-50%, -50%);\n      position: absolute;\n      color: #141414; // add a theme for better looks\n      font-size: 24px;\n    }\n  }\n\n  .save-item {\n    top: -150px;\n    text-align: center;\n    position: relative;\n    color: #494848;\n    font-size: 20px;\n  }\n}\n","import {Component, State, h, Prop, Event, EventEmitter} from \"@stencil/core\";\nimport {\n  UserService,\n  USERPROFILECOLLECTION,\n} from \"../../../../../services/common/user\";\nimport {\n  DiveSitesService,\n  DIVESITESCOLLECTION,\n} from \"../../../../../services/udive/diveSites\";\nimport {\n  DivingCentersService,\n  DIVECENTERSSCOLLECTION,\n} from \"../../../../../services/udive/divingCenters\";\nimport {\n  DivingSchoolsService,\n  DIVESCHOOLSSCOLLECTION,\n} from \"../../../../../services/udive/divingSchools\";\nimport {\n  ServiceCentersService,\n  SERVICECENTERSCOLLECTION,\n} from \"../../../../../services/udive/serviceCenters\";\nimport {RouterService} from \"../../../../../services/common/router\";\nimport {SYSTEMCOLLECTION} from \"../../../../../services/common/system\";\nimport {StorageService} from \"../../../../../services/common/storage\";\nimport {\n  DIVECOMMUNITIESCOLLECTION,\n  DiveCommunitiesService,\n} from \"../../../../../services/udive/diveCommunities\";\n\n@Component({\n  tag: \"app-upload-covers\",\n  styleUrl: \"app-upload-covers.scss\",\n})\nexport class AppUploadCovers {\n  @State() uploading = false;\n  @Event() coverUploaded: EventEmitter;\n\n  @Prop() item: {\n    collection: string;\n    id: string;\n    photoURL: string;\n    coverURL: string | {[coverId: string]: string};\n  };\n\n  @Prop() showPhotoURL = true;\n\n  @State() photoURL: string;\n  @State() coverURL: string | {[coverId: string]: string};\n\n  @State() addressText: string;\n\n  componentWillLoad() {\n    if (this.item) {\n      this.photoURL = this.item.photoURL;\n      this.coverURL = this.item.coverURL;\n    }\n  }\n\n  async updatePhotoURL(type: string) {\n    var options = null;\n    if (type == \"photo\") {\n      options = {\n        aspectRatio: 1,\n        maxDimensions: 300,\n        round: true,\n      };\n    } else {\n      options = {\n        aspectRatio: 16 / 6,\n        maxDimensions: 2000,\n        round: false,\n      };\n    }\n\n    const uploadModal = await RouterService.openModal(\n      \"modal-upload-image\",\n      options\n    );\n    uploadModal.onDidDismiss().then(async (canvasImg: any) => {\n      if (canvasImg && canvasImg.data) {\n        this.uploading = true;\n        canvasImg.data.toBlob(\n          async (blob) => {\n            const update = await this.uploadImage(blob, type);\n            if (update) {\n              if (type == \"photo\") {\n                this.photoURL = update;\n                this.item.photoURL = this.photoURL;\n              } else {\n                this.coverURL = update;\n                this.item.coverURL = this.coverURL;\n              }\n            }\n            this.coverUploaded.emit({type: type, url: update});\n            this.uploading = false;\n          },\n          \"image/jpeg\",\n          50 //jpeg quality\n        );\n      }\n    });\n    await uploadModal.present();\n  }\n\n  async uploadImage(blob, type) {\n    switch (this.item.collection) {\n      case USERPROFILECOLLECTION:\n        return await UserService.updatePhotoURL(type, this.item.id, blob);\n      case DIVESITESCOLLECTION:\n        return await DiveSitesService.updatePhotoURL(type, this.item.id, blob);\n      case DIVECENTERSSCOLLECTION:\n        return await DivingCentersService.updatePhotoURL(\n          type,\n          this.item.id,\n          blob\n        );\n      case DIVECOMMUNITIESCOLLECTION:\n        return await DiveCommunitiesService.updatePhotoURL(\n          type,\n          this.item.id,\n          blob\n        );\n      case DIVESCHOOLSSCOLLECTION:\n        return await DivingSchoolsService.updatePhotoURL(\n          type,\n          this.item.id,\n          blob\n        );\n      case SERVICECENTERSCOLLECTION:\n        return await ServiceCentersService.updatePhotoURL(\n          type,\n          this.item.id,\n          blob\n        );\n      case SYSTEMCOLLECTION:\n        return await StorageService.updatePhotoURL(\n          SERVICECENTERSCOLLECTION,\n          type,\n          this.item.id,\n          blob\n        );\n    }\n  }\n\n  render() {\n    return [\n      this.uploading ? <ion-progress-bar type=\"indeterminate\" /> : undefined,\n      this.item\n        ? [\n            <div\n              class=\"cover\"\n              style={\n                this.item.coverURL\n                  ? {\n                      backgroundImage: \"url(\" + this.item.coverURL + \")\",\n                    }\n                  : undefined\n              }\n            >\n              <ion-button\n                fill=\"clear\"\n                icon-only\n                onClick={() => this.updatePhotoURL(\"cover\")}\n                disabled={!this.item.id}\n              >\n                <ion-icon name=\"camera\" color=\"light\" />\n              </ion-button>\n            </div>,\n            !this.item.id ? (\n              <div class=\"save-item\">\n                <my-transl\n                  tag=\"save-item-error\"\n                  text=\"Please save the item to upload pictures\"\n                  isLabel\n                />\n              </div>\n            ) : undefined,\n            this.showPhotoURL ? (\n              <ion-thumbnail>\n                <img\n                  src={\n                    this.item.photoURL\n                      ? this.item.photoURL\n                      : \"./assets/images/avatar.png\"\n                  }\n                />\n                <ion-button\n                  fill=\"clear\"\n                  icon-only\n                  onClick={() => this.updatePhotoURL(\"photo\")}\n                  disabled={!this.item.id}\n                >\n                  <ion-icon name=\"camera\" color=\"light\" />\n                </ion-button>\n              </ion-thumbnail>\n            ) : undefined,\n          ]\n        : undefined,\n    ];\n  }\n}\n"],"version":3}