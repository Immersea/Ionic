{"file":"page-lostpsw.entry.esm.js","mappings":"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","names":[],"sources":["src/components/common/pages/user/page-lostpsw/page-lostpsw.scss?tag=page-lostpsw","src/components/common/pages/user/page-lostpsw/page-lostpsw.tsx"],"sourcesContent":["page-lostpsw {\n  .validation-error {\n    padding-left: 18px;\n    font-size: 0.7rem;\n    color: red;\n  }\n}\n","import {Component, h, Prop, State} from \"@stencil/core\";\nimport {AuthService} from \"../../../../../services/common/auth\";\nimport {TranslationService} from \"../../../../../services/common/translations\";\nimport {alertController} from \"@ionic/core\";\nimport {InputValidator} from \"../../../../../interfaces/interfaces\";\nimport {RouterService} from \"../../../../../services/common/router\";\nimport {Environment} from \"../../../../../global/env\";\nimport {SystemService} from \"../../../../../services/common/system\";\nimport {\n  EmailAuthProvider,\n  GoogleAuthProvider,\n  FacebookAuthProvider,\n} from \"firebase/auth\";\n@Component({\n  tag: \"page-lostpsw\",\n  styleUrl: \"page-lostpsw.scss\",\n})\nexport class PageLostpsw {\n  @Prop() email: string = \"\";\n  @State() emailpsw: InputValidator = {\n    name: \"emailpsw\",\n    valid: false,\n    value: \"\",\n  };\n  @State() scrollTop = 0;\n\n  componentWillLoad() {\n    if (this.email) {\n      this.emailpsw = {\n        name: \"emailpsw\",\n        valid: true,\n        value: this.email,\n      };\n    }\n  }\n\n  async showAlert(message) {\n    let header = TranslationService.getTransl(\"login\", \"Login\");\n    let newuser = TranslationService.getTransl(\n      \"new-user\",\n      \"Your email is not registered in our systems. Please register to proceed.\"\n    );\n    let google = TranslationService.getTransl(\n      \"google-registration\",\n      \"You have previously logged-in through Google registration process. Please click on the related button in the login page to proceed.\"\n    );\n    let facebook = TranslationService.getTransl(\n      \"facebook-registration\",\n      \"You have previously logged-in through Facebook registration process. Please click on the related button in the login page to proceed.\"\n    );\n    let pswreset = TranslationService.getTransl(\n      \"pswreset\",\n      \"You will receive shortly an email to reset your password. Please follow the instructions and then come back to the login page.\"\n    );\n    let pswreseterror = TranslationService.getTransl(\n      \"pswreseterror\",\n      \"There was an error in the reset process. Please try again later.\"\n    );\n    let show_message = \"\";\n    switch (message) {\n      case \"newuser\":\n        show_message = newuser;\n        break;\n      case \"google\":\n        show_message = google;\n        break;\n      case \"facebook\":\n        show_message = facebook;\n        break;\n      case \"pswreset\":\n        show_message = pswreset;\n        break;\n      case \"pswreseterror\":\n        show_message = pswreseterror;\n        break;\n    }\n\n    const alert = await alertController.create({\n      header: header,\n      message: show_message,\n      buttons: [\n        {\n          text: TranslationService.getTransl(\"ok\", \"OK\"),\n          handler: async () => {\n            RouterService.push(\"/login\", \"root\");\n          },\n        },\n      ],\n    });\n    AuthService.dismissLoading();\n    alert.present();\n  }\n\n  inputHandler(event) {\n    this[event.detail.name] = event.detail;\n  }\n\n  async checkEmail() {\n    SystemService.presentLoading(\"please-wait\");\n    const methods = await AuthService.fetchSignInMethodsForEmail(\n      this.emailpsw.value\n    );\n    SystemService.dismissLoading();\n    if (methods.length == 0) {\n      //new user\n      SystemService.presentAlertError(\"newuser\");\n    } else {\n      //existing user\n      if (\n        methods.indexOf(EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD) != -1\n      ) {\n        this.sendResetPsw();\n      } else if (\n        methods.indexOf(GoogleAuthProvider.GOOGLE_SIGN_IN_METHOD) != -1\n      ) {\n        this.showAlert(\"google\");\n      } else if (\n        methods.indexOf(FacebookAuthProvider.FACEBOOK_SIGN_IN_METHOD) != -1\n      ) {\n        this.showAlert(\"facebook\");\n      }\n    }\n  }\n\n  sendResetPsw() {\n    SystemService.presentLoading(\"please-wait\");\n    AuthService.passwordReset(this.emailpsw.value)\n      .then(() => {\n        SystemService.dismissLoading();\n        this.showAlert(\"pswreset\");\n      })\n      .catch(() => {\n        SystemService.dismissLoading();\n        this.showAlert(\"pswreseterror\");\n      });\n  }\n\n  render() {\n    return [\n      <app-navbar\n        color={Environment.getAppColor()}\n        tag=\"forgot-psw\"\n        text=\"Forgot Password\"\n        back-button={true}\n      ></app-navbar>,\n      <ion-content\n        scrollEvents\n        onIonScroll={(ev) => (this.scrollTop = ev.detail.scrollTop)}\n      >\n        {Environment.isUdive() || Environment.isDecoplanner() ? (\n          <app-banner\n            scrollTopValue={this.scrollTop}\n            heightPx={250}\n            link=\"./assets/images/friendship2SM.jpg\"\n          ></app-banner>\n        ) : undefined}\n        <ion-grid>\n          <ion-row>\n            <ion-col>\n              <app-form-item\n                label-tag=\"email\"\n                label-text=\"Email\"\n                name=\"emailpsw\"\n                input-type=\"email\"\n                onFormItemChanged={(ev) => this.inputHandler(ev)}\n                validator={[\"required\", \"email\"]}\n              ></app-form-item>\n              <ion-button\n                margin-top\n                expand=\"block\"\n                disabled={!this.emailpsw.valid}\n                onClick={() => this.checkEmail()}\n              >\n                <my-transl\n                  tag=\"login-resetpsw\"\n                  text=\"Reset my password\"\n                ></my-transl>\n              </ion-button>\n            </ion-col>\n          </ion-row>\n        </ion-grid>\n      </ion-content>,\n    ];\n  }\n}\n"],"version":3}