{"file":"page-admin-translations.entry.esm.js","mappings":"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","names":["cloneDeep"],"sources":["src/components/common/pages/admin/page-admin-translations/page-admin-translations.scss?tag=page-admin-translations","src/components/common/pages/admin/page-admin-translations/page-admin-translations.tsx"],"sourcesContent":["page-admin-translations {\n  app-admin-translations {\n    width: 100%;\n    height: 100%;\n  }\n}\n","import {Component, h, State, Element} from \"@stencil/core\";\nimport {UserService} from \"../../../../../services/common/user\";\nimport {SystemService} from \"../../../../../services/common/system\";\nimport {\n  TRANSLATIONSCOLLECTION,\n  TranslationService,\n} from \"../../../../../services/common/translations\";\nimport {Translation} from \"../../../../../interfaces/common/translations/translations\";\nimport {DatabaseService} from \"../../../../../services/common/database\";\nimport {slideHeight} from \"../../../../../helpers/utils\";\nimport {collection, onSnapshot, orderBy, query} from \"firebase/firestore\";\nimport {firestore} from \"../../../../../helpers/firebase\";\nimport Swiper from \"swiper\";\nimport {cloneDeep} from \"lodash\";\nimport {CallableFunctionsService} from \"../../../../../services/common/callableFunctions\";\n\n@Component({\n  tag: \"page-admin-translations\",\n  styleUrl: \"page-admin-translations.scss\",\n})\nexport class PageAdminTranslations {\n  @Element() el: HTMLElement;\n  @State() segment: string = \"translations\";\n  @State() slider: Swiper;\n  languages: any;\n  @State() translations: Translation[] = [];\n  @State() filteredTranslations: Translation[] = [];\n  @State() filter: string = \"\";\n  @State() translationsBackup: Translation[] = [];\n  translationsSub: any;\n  @State() translationsChanged: any = {};\n  selectedLanguage: any;\n  @State() updateView = false;\n\n  componentWillLoad() {\n    this.languages = SystemService.getLanguages();\n    this.selectedLanguage = this.languages[0];\n\n    this.translationsSub = onSnapshot(\n      query(collection(firestore, TRANSLATIONSCOLLECTION), orderBy(\"input\")),\n      (translations) => {\n        this.translations = [];\n        translations.forEach((doc) => {\n          const trans = doc.data() as Translation;\n          trans[\"id\"] = doc.id;\n          this.translations.push(trans);\n        });\n        this.translationsBackup = cloneDeep(this.translations);\n        this.filterTranslations();\n      }\n    );\n  }\n\n  componentDidLoad() {\n    this.setSliderHeight();\n  }\n\n  setSliderHeight() {\n    this.slider = new Swiper(\".slider-translations\", {\n      speed: 400,\n      spaceBetween: 100,\n      allowTouchMove: false,\n      autoHeight: true,\n      on: {\n        slideChange: () => {\n          this.slider ? this.slider.updateAutoHeight() : null;\n          this.slider.updateSize();\n        },\n      },\n    });\n    //reset sliders height inside slider\n    const slideContainers = Array.from(\n      this.el.getElementsByClassName(\"slide-container\")\n    );\n    slideContainers.map((container) => {\n      container.setAttribute(\"style\", \"height: \" + slideHeight(null, 4) + \"px\");\n    });\n    this.slider.updateSize();\n    this.updateView = !this.updateView;\n  }\n\n  disconnectedCallback() {\n    this.translationsSub();\n  }\n\n  segmentChanged(ev) {\n    if (ev.detail.value) {\n      this.segment = ev.detail.value;\n      if (ev.detail.value == \"admin\") {\n        this.slider.slideTo(1);\n      } else if (ev.detail.value == \"translations\") {\n        this.slider.slideTo(0);\n      }\n      this.updateView = !this.updateView;\n    }\n  }\n\n  selectLanguage(ev) {\n    this.selectedLanguage = ev.target.value;\n    this.updateView = !this.updateView;\n  }\n\n  async runTranslationsScript() {\n    try {\n      await CallableFunctionsService.updateTranslations();\n      SystemService.presentAlert(\"Done\", \"Translations saved!\");\n    } catch (error) {\n      console.log(\"error runTranslationsScript\", error);\n    }\n  }\n\n  translationChanged(ev) {\n    if (ev && ev.detail) {\n      const updated = ev.detail;\n      this.translationsChanged[updated.id] = updated;\n      let index = this.translations.findIndex((x) => x.id === updated.id);\n      this.translations[index] = updated;\n      this.translations = [...this.translations];\n      index = this.filteredTranslations.findIndex((x) => x.id === updated.id);\n      this.filteredTranslations[index] = updated;\n      this.filteredTranslations = [...this.filteredTranslations];\n      this.updateView = !this.updateView;\n    }\n  }\n\n  filterTranslations(ev?) {\n    if (ev && ev.target.value) {\n      this.filter = ev.target.value;\n    }\n    if (this.filter && this.filter !== \"\") {\n      this.filteredTranslations = this.translations.filter((trans) =>\n        trans.input.toLowerCase().includes(this.filter.toLowerCase())\n      );\n    } else {\n      this.filteredTranslations = cloneDeep(this.translations);\n    }\n    this.updateView = !this.updateView;\n  }\n\n  close() {\n    this.translations = cloneDeep(this.translationsBackup);\n    this.filterTranslations();\n  }\n\n  async save() {\n    const promises = [];\n    Object.keys(this.translationsChanged).map((transId) => {\n      const translation = this.translationsChanged[transId];\n      //remove id written by query\n      delete translation.id;\n      promises.push(\n        DatabaseService.updateDocument(\n          TRANSLATIONSCOLLECTION,\n          transId,\n          translation\n        )\n      );\n    });\n    //execute writes\n    await Promise.all(promises);\n    this.translationsChanged = [];\n  }\n\n  render() {\n    return [\n      <ion-header>\n        <app-navbar\n          color=\"udive\"\n          tag=\"translations\"\n          text=\"Translations\"\n        ></app-navbar>\n      </ion-header>,\n      UserService.userRoles && UserService.userRoles.isSuperAdmin()\n        ? [\n            <ion-header>\n              <ion-toolbar color=\"udive\" class=\"no-safe-padding\">\n                <ion-segment\n                  mode=\"md\"\n                  onIonChange={(ev) => this.segmentChanged(ev)}\n                  value={this.segment}\n                >\n                  <ion-segment-button value=\"translations\" layout=\"icon-start\">\n                    <ion-label>TRANSLATIONS</ion-label>\n                  </ion-segment-button>\n                  <ion-segment-button value=\"admin\" layout=\"icon-start\">\n                    <ion-label>ADMIN</ion-label>\n                  </ion-segment-button>\n                </ion-segment>\n              </ion-toolbar>\n            </ion-header>,\n            this.segment == \"translations\" ? (\n              <ion-header>\n                <ion-toolbar color=\"udive\">\n                  <ion-searchbar\n                    animated\n                    placeholder={TranslationService.getTransl(\n                      \"search\",\n                      \"Search\"\n                    )}\n                    value={this.filter}\n                    debounce={250}\n                    onIonInput={(ev) => this.filterTranslations(ev)}\n                  ></ion-searchbar>\n                </ion-toolbar>\n                <ion-toolbar color=\"udive\">\n                  <ion-item>\n                    <ion-select\n                      label={TranslationService.getTransl(\n                        \"language\",\n                        \"Language\"\n                      )}\n                      labelPlacement=\"floating\"\n                      interface=\"action-sheet\"\n                      value={this.selectedLanguage}\n                      onIonChange={(ev) => this.selectLanguage(ev)}\n                    >\n                      {this.languages.map((language) => (\n                        <ion-select-option value={language}>\n                          {language.label}\n                        </ion-select-option>\n                      ))}\n                    </ion-select>\n                    <ion-icon\n                      slot=\"end\"\n                      class={\n                        \"flag-icon flag-icon-\" +\n                        (this.selectedLanguage.countryCode == \"en\"\n                          ? \"gb\"\n                          : this.selectedLanguage.countryCode)\n                      }\n                    ></ion-icon>\n                  </ion-item>\n                </ion-toolbar>\n              </ion-header>\n            ) : undefined,\n          ]\n        : undefined,\n      <ion-content>\n        <swiper-container class=\"slider-translations swiper\">\n          <swiper-wrapper class=\"swiper-wrapper\">\n            <swiper-slide class=\"swiper-slide\">\n              <ion-content class=\"slide-container\">\n                <ion-grid>\n                  <ion-row>\n                    <ion-col>\n                      <app-admin-translations\n                        translations={this.filteredTranslations}\n                        language={this.selectedLanguage.value}\n                        onTranslationChanged={(ev) =>\n                          this.translationChanged(ev)\n                        }\n                      />\n                    </ion-col>\n                  </ion-row>\n                </ion-grid>\n              </ion-content>\n            </swiper-slide>\n            {UserService.userRoles && UserService.userRoles.isSuperAdmin() ? (\n              <swiper-slide class=\"swiper-slide\">\n                <ion-content class=\"slide-container\">\n                  <ion-button\n                    size=\"large\"\n                    onClick={() => this.runTranslationsScript()}\n                  >\n                    Run Translations Script\n                  </ion-button>\n                </ion-content>\n              </swiper-slide>\n            ) : undefined}\n          </swiper-wrapper>\n        </swiper-container>\n      </ion-content>,\n      Object.keys(this.translationsChanged).length > 0 ? (\n        <app-modal-footer\n          onCancelEmit={() => this.close()}\n          onSaveEmit={() => this.save()}\n        />\n      ) : undefined,\n    ];\n  }\n}\n"],"version":3}