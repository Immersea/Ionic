{"file":"modal-edit-user-roles.entry.esm.js","mappings":"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","names":[],"sources":["src/services/udive/services.ts","src/components/common/modals/modal-edit-user-roles/modal-edit-user-roles.scss?tag=modal-edit-user-roles","src/components/common/modals/modal-edit-user-roles/modal-edit-user-roles.tsx"],"sourcesContent":["export class UDiveServicesController {\n  getUserRoles() {\n    return [\"registered\", \"translator\", \"superAdmin\"];\n  }\n}\nexport const UDiveService = new UDiveServicesController();\n","modal-edit-user-roles {\n  ion-list {\n    width: 100%;\n  }\n}\n","import {Component, h, Host, Prop, State, Element} from \"@stencil/core\";\nimport {actionSheetController, modalController} from \"@ionic/core\";\nimport {USERROLESCOLLECTION} from \"../../../../services/common/user\";\nimport {UserRoles} from \"../../../../interfaces/common/user/user-roles\";\nimport {Environment} from \"../../../../global/env\";\nimport {DatabaseService} from \"../../../../services/common/database\";\nimport {TrasteelService} from \"../../../../services/trasteel/common/services\";\nimport {UDiveService} from \"../../../../services/udive/services\";\n\n@Component({\n  tag: \"modal-edit-user-roles\",\n  styleUrl: \"modal-edit-user-roles.scss\",\n})\nexport class ModalEditUserRoles {\n  @Element() itemSliding: HTMLElement;\n  @Prop() uid: string = undefined;\n  @State() userRoles: UserRoles;\n  @State() updateView = false;\n\n  async componentWillLoad() {\n    const roles = await DatabaseService.getDocument(\n      USERROLESCOLLECTION,\n      this.uid\n    );\n    this.userRoles = new UserRoles(roles);\n  }\n\n  async save() {\n    await DatabaseService.updateDocument(\n      USERROLESCOLLECTION,\n      this.uid,\n      this.userRoles\n    );\n    modalController.dismiss();\n  }\n\n  async cancel() {\n    modalController.dismiss();\n  }\n\n  async presentActionSheet() {\n    let buttons = [];\n    let roles = [];\n    if (Environment.isTrasteel()) {\n      roles = TrasteelService.getUserRoles();\n    } else if (Environment.isDecoplanner() || Environment.isUdive()) {\n      roles = UDiveService.getUserRoles();\n    }\n    roles.forEach((role) => {\n      if (!this.userRoles.roles.includes(role)) {\n        buttons.push({\n          text: role,\n          handler: () => {\n            this.userRoles.roles.push(role);\n            this.updateView = !this.updateView;\n          },\n        });\n      }\n    });\n    buttons.push({\n      text: \"Close\",\n      icon: \"close\",\n      role: \"cancel\",\n      handler: () => {},\n    });\n    const actionSheet = await actionSheetController.create({\n      header: \"Add\",\n      buttons: buttons,\n    });\n    await actionSheet.present();\n  }\n\n  updateLicense(license, ev) {\n    this.userRoles.licences[license] = ev.detail.checked;\n    this.updateView = !this.updateView;\n  }\n\n  handleChange(ev) {\n    if (ev.detail.name == \"fromDate\") {\n      this.userRoles.licences.trial.fromDate = new Date(ev.detail.value);\n    } else {\n      this.userRoles.licences.trial[ev.detail.name] = ev.detail.value;\n    }\n    this.updateView = !this.updateView;\n  }\n\n  deleteRole(index) {\n    const el = this.itemSliding.getElementsByClassName(\n      \"item-sliding-\" + index\n    )[0] as HTMLIonItemSlidingElement;\n    el.closeOpened();\n    this.userRoles.roles.splice(index, 1);\n    this.updateView = !this.updateView;\n  }\n\n  render() {\n    return (\n      <Host>\n        <ion-header>\n          <ion-toolbar color={Environment.getAppColor()}>\n            <ion-title>User Roles Manager</ion-title>\n          </ion-toolbar>\n        </ion-header>\n        <ion-content>\n          <ion-list>\n            <ion-item>uid: {this.userRoles.uid}</ion-item>\n            <ion-item>email: {this.userRoles.email}</ion-item>\n            {!Environment.isTrasteel &&\n            Object.keys(this.userRoles.licences).length > 0\n              ? [\n                  <ion-item-divider>User Licences</ion-item-divider>,\n                  Object.keys(this.userRoles.licences).map((license) =>\n                    license == \"trial\"\n                      ? [\n                          <ion-item-divider>\n                            <ion-label>Trial</ion-label>\n                          </ion-item-divider>,\n                          <app-form-item\n                            label-tag=\"duration\"\n                            label-text=\"Duration\"\n                            value={this.userRoles.licences.trial.duration}\n                            name=\"duration\"\n                            input-type=\"number\"\n                            onFormItemChanged={(ev) => this.handleChange(ev)}\n                            validator={[]}\n                          ></app-form-item>,\n                          <app-form-item\n                            label-tag=\"fromDate\"\n                            label-text=\"From Date\"\n                            value={\n                              this.userRoles.licences.trial.fromDate !== null\n                                ? this.userRoles.licences.trial.fromDate.toISOString()\n                                : new Date().toISOString()\n                            }\n                            name=\"fromDate\"\n                            input-type=\"date\"\n                            onFormItemChanged={(ev) => this.handleChange(ev)}\n                            validator={[]}\n                          ></app-form-item>,\n                          <app-form-item\n                            label-tag=\"level\"\n                            label-text=\"Level\"\n                            value={this.userRoles.licences.trial.level}\n                            name=\"level\"\n                            input-type=\"string\"\n                            onFormItemChanged={(ev) => this.handleChange(ev)}\n                            validator={[]}\n                          ></app-form-item>,\n                          <ion-item>\n                            <ion-label>\n                              <p>\n                                Trial Days:{\" \"}\n                                {this.userRoles.licences.trialDays()}\n                              </p>\n                            </ion-label>\n                          </ion-item>,\n                        ]\n                      : [\n                          <ion-item>\n                            <ion-label>{license}</ion-label>\n                            <ion-toggle\n                              slot=\"end\"\n                              onIonChange={(ev) =>\n                                this.updateLicense(license, ev)\n                              }\n                              checked={this.userRoles.licences[license]}\n                            ></ion-toggle>\n                          </ion-item>,\n                        ]\n                  ),\n                ]\n              : null}\n          </ion-list>\n          <ion-list>\n            <ion-item-divider>User Roles</ion-item-divider>\n            {this.userRoles.roles.map((role, index) => (\n              <ion-item-sliding class={\"item-sliding-\" + index}>\n                <ion-item>\n                  <ion-label>{role}</ion-label>\n                </ion-item>\n                <ion-item-options>\n                  <ion-item-option\n                    color=\"danger\"\n                    onClick={() => this.deleteRole(index)}\n                  >\n                    Delete\n                  </ion-item-option>\n                </ion-item-options>\n              </ion-item-sliding>\n            ))}\n            <ion-item button onClick={() => this.presentActionSheet()}>\n              <ion-icon name=\"add\"></ion-icon>\n              <ion-label>Add</ion-label>\n            </ion-item>\n          </ion-list>\n        </ion-content>\n        <app-modal-footer\n          color={Environment.getAppColor()}\n          onCancelEmit={() => this.cancel()}\n          onSaveEmit={() => this.save()}\n        />\n      </Host>\n    );\n  }\n}\n"],"version":3}